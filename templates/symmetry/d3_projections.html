{% extends 'pdbase/base.html' %}
{% block 'title' %}D3 projections{% endblock%}
{% block extra_head %}
    <link rel="stylesheet" type="text/css" href="/site_media/static/css/style.css">
{% endblock %}
{% block 'extra_css' %}
<style>
.container {max-width:98%;}
svg {
    width:1000px;
    height:400px;
    border:1px solid grey ;
    margin: 10px;
}
/*.svg-container { width:100%; height:100%;} */

</style>
{% endblock %}

{% block '_footer' %}
{% endblock %}

{% block 'content' %}
<div class="container">
            <h1>D3 projections</h1>
            <h3><b>001</b></h3>
            <svg id="svg_001"></svg>
            <h3><b>010</b></h3>
            <svg id="svg_010"></svg>
            <h3><b>100</b></h3>
            <svg id="svg_100"></svg>
</div>
{% endblock %}

{% block 'extra_scripts' %}
<script src="https://d3js.org/d3.v7.js"></script>
<script type="text/javascript" src="/static/js/planegroups.js"></script>
<script type="text/javascript" src="/static/js/calculate.js"></script>
<script>
var numCells = 10;
var circle_radius = 30;
var d = {{pdb.unit_cell.projections|safe}};
console.log(d);
var a = get_data(d)[0];
var b = get_data(d)[1];
var c = get_data(d)[2];
var alpha = get_data(d)[3];
var beta = get_data(d)[4];
var gamma = get_data(d)[5];
var gammar = get_data(d)[6];
console.log('params =', a, b, c, alpha, beta, gamma, gammar);

function get_data(data) {
    //d3.json('https://alokomp.irb.hr{% url "d3_json" code %}').then(
    //var a, b, c, alpha, beta, gamma, gammar;
    //function (data) {
        let a = data['uc'][0];
        let b = data['uc'][1];
        let c = data['uc'][2];
        let alpha = data['uc'][3];
        let beta = data['uc'][4];
        let gamma = data['uc'][5];
        let gammar = (gamma/180)*Math.PI;
        return [a,b,c,alpha,beta,gamma,gammar];
    };

/*
//d3.json('https://alokomp.irb.hr{% url "d3_json" code %}').then(get_cell_data);
*/

const dd = d['001']['A'];
//console.log("chain_coord = ", dd);

function calculate_cells(p) {
    var cells = []; 
    for (xy of p) {
    cells = cells.concat(generateCells1(xy));
}
    return cells;
}

ddd = calculate_cells(dd);

d3.selectAll('svg')
    .selectAll('circle')
   .data(ddd)
   .join("circle")
   .attr("cx", function(d) {return 3* d[0]; })
   .attr("cy", function(d) {return 3* d[1]; })
   .attr("opacity", function(d) {return d[2]/c; })
   .attr('class', 'circles')
   .attr("r", circle_radius)
   .style("fill", randomColor());

</script>

{% endblock %}
