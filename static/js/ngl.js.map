{"version":3,"file":"ngl.js","sources":["../src/polyfills.js","../node_modules/promise-polyfill/src/index.js","../node_modules/promise-polyfill/src/finally.js","../node_modules/promise-polyfill/src/allSettled.js","../node_modules/three/src/core/EventDispatcher.js","../node_modules/three/src/math/MathUtils.js","../node_modules/three/src/math/Vector2.js","../node_modules/three/src/math/Matrix3.js","../node_modules/three/src/extras/ImageUtils.js","../node_modules/three/src/textures/Texture.js","../node_modules/three/src/math/Vector4.js","../node_modules/three/src/renderers/WebGLRenderTarget.js","../node_modules/three/src/math/Quaternion.js","../node_modules/three/src/math/Vector3.js","../node_modules/three/src/math/Matrix4.js","../node_modules/three/src/math/Euler.js","../node_modules/three/src/core/Layers.js","../node_modules/three/src/core/Object3D.js","../node_modules/three/src/scenes/Scene.js","../node_modules/three/src/math/Box3.js","../node_modules/three/src/math/Sphere.js","../node_modules/three/src/math/Ray.js","../node_modules/three/src/math/Plane.js","../node_modules/three/src/math/Triangle.js","../node_modules/three/src/math/Color.js","../node_modules/three/src/core/Face3.js","../node_modules/three/src/materials/Material.js","../node_modules/three/src/materials/MeshBasicMaterial.js","../node_modules/three/src/core/BufferAttribute.js","../node_modules/three/src/core/DirectGeometry.js","../node_modules/three/src/utils.js","../node_modules/three/src/core/BufferGeometry.js","../node_modules/three/src/objects/Mesh.js","../node_modules/three/src/core/Geometry.js","../node_modules/three/src/geometries/BoxGeometry.js","../node_modules/three/src/renderers/shaders/UniformsUtils.js","../node_modules/three/src/materials/ShaderMaterial.js","../node_modules/three/src/cameras/Camera.js","../node_modules/three/src/cameras/PerspectiveCamera.js","../node_modules/three/src/textures/DataTexture.js","../node_modules/three/src/math/Frustum.js","../node_modules/three/src/renderers/shaders/UniformsLib.js","../node_modules/three/src/renderers/webgl/WebGLAnimation.js","../node_modules/three/src/renderers/webgl/WebGLAttributes.js","../node_modules/three/src/geometries/PlaneGeometry.js","../node_modules/three/src/renderers/webgl/WebGLBackground.js","../node_modules/three/src/renderers/webgl/WebGLBindingStates.js","../node_modules/three/src/renderers/webgl/WebGLBufferRenderer.js","../node_modules/three/src/renderers/webgl/WebGLCapabilities.js","../node_modules/three/src/renderers/webgl/WebGLClipping.js","../node_modules/three/src/renderers/webgl/WebGLExtensions.js","../node_modules/three/src/renderers/webgl/WebGLGeometries.js","../node_modules/three/src/renderers/webgl/WebGLIndexedBufferRenderer.js","../node_modules/three/src/renderers/webgl/WebGLInfo.js","../node_modules/three/src/renderers/webgl/WebGLMorphtargets.js","../node_modules/three/src/renderers/webgl/WebGLObjects.js","../node_modules/three/src/textures/CubeTexture.js","../node_modules/three/src/textures/DataTexture2DArray.js","../node_modules/three/src/textures/DataTexture3D.js","../node_modules/three/src/renderers/shaders/ShaderLib.js","../node_modules/three/src/renderers/webgl/WebGLUniforms.js","../node_modules/three/src/renderers/webgl/WebGLShader.js","../node_modules/three/src/renderers/webgl/WebGLProgram.js","../node_modules/three/src/renderers/webgl/WebGLPrograms.js","../node_modules/three/src/renderers/webgl/WebGLProperties.js","../node_modules/three/src/renderers/webgl/WebGLRenderLists.js","../node_modules/three/src/renderers/webgl/WebGLLights.js","../node_modules/three/src/renderers/webgl/WebGLRenderStates.js","../node_modules/three/src/materials/MeshDepthMaterial.js","../node_modules/three/src/materials/MeshDistanceMaterial.js","../node_modules/three/src/renderers/webgl/WebGLShadowMap.js","../node_modules/three/src/renderers/webgl/WebGLState.js","../node_modules/three/src/renderers/webgl/WebGLTextures.js","../node_modules/three/src/renderers/webgl/WebGLUtils.js","../node_modules/three/src/cameras/ArrayCamera.js","../node_modules/three/src/objects/Group.js","../node_modules/three/src/renderers/webxr/WebXRController.js","../node_modules/three/src/renderers/webxr/WebXRManager.js","../node_modules/three/src/renderers/webgl/WebGLMaterials.js","../node_modules/three/src/renderers/WebGLRenderer.js","../node_modules/three/src/scenes/Fog.js","../node_modules/three/src/materials/LineBasicMaterial.js","../node_modules/three/src/objects/Line.js","../node_modules/three/src/objects/LineSegments.js","../node_modules/three/src/materials/PointsMaterial.js","../node_modules/three/src/objects/Points.js","../node_modules/three/src/textures/CanvasTexture.js","../node_modules/three/src/geometries/PolyhedronGeometry.js","../node_modules/three/src/geometries/TetrahedronGeometry.js","../node_modules/three/src/geometries/OctahedronGeometry.js","../node_modules/three/src/geometries/IcosahedronGeometry.js","../node_modules/three/src/geometries/TorusGeometry.js","../node_modules/three/src/geometries/CylinderGeometry.js","../node_modules/three/src/geometries/ConeGeometry.js","../node_modules/three/src/lights/Light.js","../node_modules/three/src/lights/LightShadow.js","../node_modules/three/src/lights/SpotLightShadow.js","../node_modules/three/src/lights/SpotLight.js","../node_modules/three/src/cameras/OrthographicCamera.js","../node_modules/three/src/lights/AmbientLight.js","../node_modules/three/src/cameras/StereoCamera.js","../node_modules/three/src/core/Uniform.js","../src/utils.ts","../src/utils/registry.ts","../src/math/math-utils.ts","../node_modules/chroma-js/chroma.js","../src/color/colormaker.ts","../src/selection/selection-constants.ts","../node_modules/signals/dist/signals.js","../src/selection/selection-test.ts","../src/selection/selection.ts","../src/selection/selection-parser.ts","../src/color/selection-colormaker.ts","../src/color/colormaker-registry.ts","../src/parser/parser-registry.ts","../src/worker/worker-utils.ts","../src/worker/worker-registry.ts","../src/globals.ts","../src/streamer/streamer.ts","../src/streamer/file-streamer.ts","../src/streamer/network-streamer.ts","../src/loader/loader.ts","../src/loader/parser-loader.ts","../src/script.ts","../src/loader/script-loader.ts","../src/loader/loader-utils.ts","../node_modules/sprintf-js/src/sprintf.js","../src/writer/writer.ts","../src/writer/pdb-writer.ts","../src/writer/sdf-writer.ts","../src/utils/io-buffer.ts","../src/writer/stl-writer.ts","../src/utils/counter.ts","../src/viewer/stats.ts","../src/shader/shader-utils.ts","../src/viewer/viewer-constants.ts","../src/viewer/tiled-renderer.ts","../src/math/math-constants.ts","../src/math/array-utils.ts","../src/viewer/viewer-utils.ts","../src/viewer/gl-utils.ts","../src/viewer/viewer.ts","../src/stage/mouse-observer.ts","../src/constants.ts","../src/controls/trackball-controls.ts","../src/controls/picking-proxy.ts","../src/controls/picking-controls.ts","../src/controls/viewer-controls.ts","../src/animation/animation.ts","../src/controls/animation-controls.ts","../src/utils/queue.ts","../src/representation/representation.ts","../src/worker/worker.ts","../src/worker/worker-pool.ts","../src/math/vector-utils.ts","../src/geometry/dash.ts","../src/geometry/primitive.ts","../src/geometry/spatial-hash.ts","../src/store/store.ts","../src/store/contact-store.ts","../src/utils/bitarray.ts","../src/utils/adjacency-list.ts","../src/chemistry/interactions/features.ts","../src/structure/structure-constants.ts","../src/chemistry/geometry.ts","../src/chemistry/valence-model.ts","../src/structure/data.ts","../src/chemistry/functional-groups.ts","../src/chemistry/interactions/charged.ts","../src/chemistry/interactions/hydrogen-bonds.ts","../src/chemistry/interactions/metal-binding.ts","../src/chemistry/interactions/halogen-bonds.ts","../src/chemistry/interactions/refine-contacts.ts","../src/chemistry/interactions/contact.ts","../src/chemistry/interactions/hydrophobic.ts","../src/utils/picker.ts","../src/surface/marching-cubes.ts","../src/math/matrix-utils.ts","../src/surface/surface-utils.ts","../src/surface/surface.ts","../src/surface/volume.ts","../src/buffer/buffer.ts","../src/buffer/mesh-buffer.ts","../src/buffer/surface-buffer.ts","../src/buffer/doublesided-buffer.ts","../src/buffer/contour-buffer.ts","../src/representation/surface-representation.ts","../src/controls/mouse-actions.ts","../src/controls/mouse-controls.ts","../src/controls/key-actions.ts","../src/controls/key-controls.ts","../src/stage/picking-behavior.ts","../src/stage/mouse-behavior.ts","../src/stage/animation-behavior.ts","../src/stage/key-behavior.ts","../src/component/annotation.ts","../src/controls/component-controls.ts","../src/utils/radius-factory.ts","../src/math/principal-axes.ts","../src/surface/filtered-volume.ts","../src/store/bond-hash.ts","../src/store/bond-store.ts","../src/store/atom-store.ts","../src/store/residue-store.ts","../src/store/chain-store.ts","../src/store/model-store.ts","../src/geometry/helixorient.ts","../src/geometry/helixbundle.ts","../src/utils/binary-heap.ts","../src/utils/kdtree.ts","../src/proxy/atom-proxy.ts","../src/geometry/kdtree.ts","../src/symmetry/symmetry-constants.ts","../src/symmetry/symmetry-utils.ts","../src/symmetry/assembly.ts","../src/structure/structure-builder.ts","../src/structure/structure-utils.ts","../src/store/atom-type.ts","../src/store/atom-map.ts","../src/store/residue-type.ts","../src/store/residue-map.ts","../src/proxy/bond-proxy.ts","../src/proxy/residue-proxy.ts","../src/proxy/polymer.ts","../src/proxy/chain-proxy.ts","../src/proxy/model-proxy.ts","../src/structure/structure.ts","../src/geometry/shape.ts","../src/representation/buffer-representation.ts","../src/buffer/geometry-buffer.ts","../src/buffer/spheregeometry-buffer.ts","../src/buffer/mapped-buffer.ts","../src/buffer/mappedquad-buffer.ts","../src/buffer/sphereimpostor-buffer.ts","../src/buffer/sphere-buffer.ts","../src/buffer/point-buffer.ts","../src/representation/dot-representation.ts","../src/buffer/image-buffer.ts","../src/surface/volume-slice.ts","../src/representation/slice-representation.ts","../src/representation/representation-utils.ts","../src/component/element.ts","../src/component/representation-element.ts","../src/component/component.ts","../src/component/collection.ts","../src/component/representation-collection.ts","../src/component/trajectory-element.ts","../src/trajectory/frames.ts","../src/align/superposition.ts","../src/trajectory/trajectory-player.ts","../src/trajectory/trajectory.ts","../src/trajectory/frames-trajectory.ts","../src/trajectory/structure-trajectory.ts","../src/trajectory/remote-trajectory.ts","../src/trajectory/callback-trajectory.ts","../src/structure/structure-view.ts","../src/align/alignment.ts","../src/align/align-utils.ts","../src/component/structure-component.ts","../src/trajectory/trajectory-utils.ts","../src/component/surface-component.ts","../src/component/volume-component.ts","../src/component/component-collection.ts","../src/stage/stage.ts","../src/component/shape-component.ts","../node_modules/tslib/tslib.es6.js","../src/color/atomindex-colormaker.ts","../src/color/bfactor-colormaker.ts","../src/color/chainid-colormaker.ts","../src/color/chainindex-colormaker.ts","../src/color/chainname-colormaker.ts","../src/color/densityfit-colormaker.ts","../src/color/electrostatic-colormaker.ts","../src/color/element-colormaker.ts","../src/color/entityindex-colormaker.ts","../src/color/entitytype-colormaker.ts","../src/color/geoquality-colormaker.ts","../src/color/hydrophobicity-colormaker.ts","../src/color/modelindex-colormaker.ts","../src/color/moleculetype-colormaker.ts","../src/color/occupancy-colormaker.ts","../src/color/partialcharge-colormaker.ts","../src/color/random-colormaker.ts","../src/color/randomcoilindex-colormaker.ts","../src/color/residueindex-colormaker.ts","../src/color/resname-colormaker.ts","../src/color/sstruc-colormaker.ts","../src/color/structuredata-colormaker.ts","../src/color/uniform-colormaker.ts","../src/color/value-colormaker.ts","../src/color/volume-colormaker.ts","../src/representation/structure-representation.ts","../src/representation/measurement-representation.ts","../src/utils/edt.ts","../src/buffer/text-buffer.ts","../src/buffer/wideline-buffer.ts","../src/representation/angle-representation.ts","../src/buffer/cylindergeometry-buffer.ts","../src/buffer/mappedalignedbox-buffer.ts","../src/buffer/cylinderimpostor-buffer.ts","../src/buffer/cylinder-buffer.ts","../src/representation/axes-representation.ts","../src/representation/ballandstick-representation.ts","../src/representation/backbone-representation.ts","../src/representation/base-representation.ts","../src/geometry/spline.ts","../src/buffer/tubemesh-buffer.ts","../src/representation/cartoon-representation.ts","../src/representation/contact-representation.ts","../src/representation/dihedral-representation.ts","../src/representation/dihedral-histogram-representation.ts","../src/representation/distance-representation.ts","../src/buffer/vector-buffer.ts","../src/representation/helixorient-representation.ts","../src/representation/licorice-representation.ts","../src/buffer/mappedbox-buffer.ts","../src/buffer/hyperballstickimpostor-buffer.ts","../src/buffer/hyperballstick-buffer.ts","../src/representation/hyperball-representation.ts","../src/utils/label-factory.ts","../src/representation/label-representation.ts","../src/representation/line-representation.ts","../src/geometry/grid.ts","../src/surface/edt-surface.ts","../src/surface/av-surface.ts","../src/surface/molecular-surface.ts","../src/representation/molecularsurface-representation.ts","../src/representation/point-representation.ts","../src/buffer/ribbon-buffer.ts","../src/representation/ribbon-representation.ts","../src/representation/rocket-representation.ts","../src/representation/rope-representation.ts","../src/representation/spacefill-representation.ts","../src/buffer/trace-buffer.ts","../src/representation/trace-representation.ts","../src/representation/tube-representation.ts","../src/representation/unitcell-representation.ts","../src/representation/validation-representation.ts","../src/buffer/cone-buffer.ts","../src/viewer/geometry-group.ts","../src/buffer/arrow-buffer.ts","../src/buffer/box-buffer.ts","../src/buffer/ellipsoid-buffer.ts","../src/buffer/octahedron-buffer.ts","../src/buffer/tetrahedron-buffer.ts","../src/buffer/torus-buffer.ts","../src/parser/parser.ts","../src/parser/structure-parser.ts","../src/structure/entity.ts","../src/symmetry/unitcell.ts","../src/parser/pdb-parser.ts","../src/parser/cif-parser.ts","../src/parser/gro-parser.ts","../lib/mmtf.es6.js","../src/parser/mmtf-parser.ts","../src/parser/mol2-parser.ts","../src/parser/pdbqt-parser.ts","../src/parser/pqr-parser.ts","../src/parser/sdf-parser.ts","../src/parser/prmtop-parser.ts","../src/parser/psf-parser.ts","../src/parser/top-parser.ts","../src/parser/trajectory-parser.ts","../src/parser/dcd-parser.ts","../src/utils/netcdf-reader.ts","../src/parser/nctraj-parser.ts","../src/parser/trr-parser.ts","../src/parser/xtc-parser.ts","../src/parser/volume-parser.ts","../src/parser/cube-parser.ts","../src/parser/dsn6-parser.ts","../src/parser/dx-parser.ts","../src/parser/dxbin-parser.ts","../src/parser/mrc-parser.ts","../src/parser/xplor-parser.ts","../src/parser/kin-parser.ts","../src/parser/surface-parser.ts","../src/parser/obj-parser.ts","../src/parser/ply-parser.ts","../src/parser/csv-parser.ts","../src/parser/json-parser.ts","../src/parser/msgpack-parser.ts","../src/parser/netcdf-parser.ts","../src/parser/text-parser.ts","../src/utils/parse-xml.ts","../src/parser/xml-parser.ts","../src/structure/validation.ts","../src/parser/validation-parser.ts","../lib/pako_inflate.es6.js","../src/utils/gzip-decompressor.ts","../src/datasource/datasource.ts","../src/datasource/rcsb-datasource.ts","../src/datasource/pubchem-datasource.ts","../src/datasource/passthrough-datasource.ts","../src/datasource/alphafold-datasource.ts","../src/datasource/static-datasource.ts","../src/datasource/mdsrv-datasource.ts","../src/ui/parameters.ts","../src/ngl.ts"],"sourcesContent":["/**\n * @file shims\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/// ///////////\n// Polyfills\n\nif (typeof window !== 'undefined') {\n  (function () {\n    'use strict'\n    // Console-polyfill. MIT license.\n    // https://github.com/paulmillr/console-polyfill\n    // Make it safe to do console.log() always.\n\n    window.console = window.console || {}\n    var con = window.console\n    var prop, method\n    var empty = {}\n    var dummy = function () {}\n    var properties = 'memory'.split(',')\n    var methods = (\n      'assert,clear,count,debug,dir,dirxml,error,exception,group,' +\n      'groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,' +\n      'show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn'\n    ).split(',')\n\n    while ((prop = properties.pop())) if (!con[prop]) con[prop] = empty\n    while ((method = methods.pop())) if (!con[method]) con[method] = dummy\n  })()\n}\n\nif (typeof window !== 'undefined' && typeof window.HTMLCanvasElement !== 'undefined' && !window.HTMLCanvasElement.prototype.toBlob) {\n  // http://code.google.com/p/chromium/issues/detail?id=67587#57\n  Object.defineProperty(window.HTMLCanvasElement.prototype, 'toBlob', {\n\n    value: function (callback, type, quality) {\n      var bin = window.atob(this.toDataURL(type, quality).split(',')[ 1 ])\n      var len = bin.length\n      var len32 = len >> 2\n      var a8 = new Uint8Array(len)\n      var a32 = new Uint32Array(a8.buffer, 0, len32)\n\n      for (var i = 0, j = 0; i < len32; i++) {\n        a32[i] = (\n          bin.charCodeAt(j++) |\n          bin.charCodeAt(j++) << 8 |\n          bin.charCodeAt(j++) << 16 |\n          bin.charCodeAt(j++) << 24\n        )\n      }\n\n      var tailLength = len & 3\n\n      while (tailLength--) {\n        a8[ j ] = bin.charCodeAt(j++)\n      }\n\n      callback(new window.Blob([ a8 ], { 'type': type || 'image/png' }))\n    }\n\n  })\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/cbrt\nMath.cbrt = Math.cbrt || function (x) {\n  var y = Math.pow(Math.abs(x), 1 / 3)\n  return x < 0 ? -y : y\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/sign\nif (!Math.sign) {\n  Math.sign = function (x) {\n    // If x is NaN, the result is NaN.\n    // If x is -0, the result is -0.\n    // If x is +0, the result is +0.\n    // If x is negative and not -0, the result is -1.\n    // If x is positive and not +0, the result is +1.\n    x = +x // convert to a number\n    if (x === 0 || isNaN(x)) {\n      return Number(x)\n    }\n    return x > 0 ? 1 : -1\n  }\n}\n\nif (!Number.isInteger) {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\n  Number.isInteger = function isInteger (nVal) {\n    return typeof nVal === 'number' && isFinite(nVal) && nVal > -9007199254740992 && nVal < 9007199254740992 && Math.floor(nVal) === nVal\n  }\n}\n\nif (!Number.isNaN) {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isNaN\n  Number.isNaN = function isNaN (value) {\n    return value !== value // eslint-disable-line no-self-compare\n  }\n}\n\nif (!Object.assign) {\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n  Object.defineProperty(Object, 'assign', {\n\n    enumerable: false,\n    configurable: true,\n    writable: true,\n\n    value: function (target/*, firstSource */) {\n      'use strict'\n      if (target === undefined || target === null) { throw new TypeError('Cannot convert first argument to object') }\n\n      var to = Object(target)\n\n      var hasPendingException = false\n      var pendingException\n\n      for (var i = 1; i < arguments.length; i++) {\n        var nextSource = arguments[i]\n        if (nextSource === undefined || nextSource === null) { continue }\n\n        var keysArray = Object.keys(Object(nextSource))\n        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\n          var nextKey = keysArray[nextIndex]\n          try {\n            var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey)\n            if (desc !== undefined && desc.enumerable) { to[nextKey] = nextSource[nextKey] }\n          } catch (e) {\n            if (!hasPendingException) {\n              hasPendingException = true\n              pendingException = e\n            }\n          }\n        }\n\n        if (hasPendingException) { throw pendingException }\n      }\n\n      return to\n    }\n\n  })\n}\n\nif (!String.prototype.startsWith) {\n  /*! https://mths.be/startswith v0.2.0 by @mathias */\n\n  (function () {\n    'use strict' // needed to support `apply`/`call` with `undefined`/`null`\n    var defineProperty = (function () {\n      // IE 8 only supports `Object.defineProperty` on DOM elements\n      var result\n      try {\n        var object = {}\n        var $defineProperty = Object.defineProperty\n        result = $defineProperty(object, object, object) && $defineProperty\n      } catch (error) {} // eslint-disable-line no-empty\n      return result\n    }())\n    var toString = {}.toString\n    var startsWith = function (search) {\n      if (this === null) {\n        throw TypeError()\n      }\n      var string = String(this)\n      if (search && toString.call(search) === '[object RegExp]') {\n        throw TypeError()\n      }\n      var stringLength = string.length\n      var searchString = String(search)\n      var searchLength = searchString.length\n      var position = arguments.length > 1 ? arguments[1] : undefined\n      // `ToInteger`\n      var pos = position ? Number(position) : 0\n      if (Number.isNaN(pos)) {\n        pos = 0\n      }\n      var start = Math.min(Math.max(pos, 0), stringLength)\n      // Avoid the `indexOf` call if no match is possible\n      if (searchLength + start > stringLength) {\n        return false\n      }\n      var index = -1\n      while (++index < searchLength) {\n        if (string.charCodeAt(start + index) !== searchString.charCodeAt(index)) {\n          return false\n        }\n      }\n      return true\n    }\n    if (defineProperty) {\n      defineProperty(String.prototype, 'startsWith', {\n        'value': startsWith,\n        'configurable': true,\n        'writable': true\n      })\n    } else {\n      // eslint-disable-next-line no-extend-native\n      String.prototype.startsWith = startsWith\n    }\n  }())\n}\n\nif (!String.prototype.endsWith) {\n  // eslint-disable-next-line no-extend-native\n  String.prototype.endsWith = function (searchString, position) {\n    var subjectString = this.toString()\n    if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {\n      position = subjectString.length\n    }\n    position -= searchString.length\n    var lastIndex = subjectString.indexOf(searchString, position)\n    return lastIndex !== -1 && lastIndex === position\n  }\n}\n\nif (!String.prototype.repeat) {\n  // eslint-disable-next-line no-extend-native\n  String.prototype.repeat = function (count) {\n    'use strict'\n    if (this === null) {\n      throw new TypeError('can\\'t convert ' + this + ' to object')\n    }\n    var str = '' + this\n    count = +count\n    if (Number.isNaN(count)) {\n      count = 0\n    }\n    if (count < 0) {\n      throw new RangeError('repeat count must be non-negative')\n    }\n    if (count === Infinity) {\n      throw new RangeError('repeat count must be less than infinity')\n    }\n    count = Math.floor(count)\n    if (str.length === 0 || count === 0) {\n      return ''\n    }\n    // Ensuring count is a 31-bit integer allows us to heavily optimize the\n    // main part. But anyway, most current (August 2014) browsers can't handle\n    // strings 1 << 28 chars or longer, so:\n    if (str.length * count >= 1 << 28) {\n      throw new RangeError('repeat count must not overflow maximum string size')\n    }\n    var rpt = ''\n    for (;;) {\n      if ((count & 1) === 1) {\n        rpt += str\n      }\n      count >>>= 1\n      if (count === 0) {\n        break\n      }\n      str += str\n    }\n    // Could we try:\n    // return Array(count + 1).join(this);\n    return rpt\n  }\n}\n\nif (!String.prototype.includes) {\n  // eslint-disable-next-line no-extend-native\n  String.prototype.includes = function (search, start) {\n    'use strict'\n    if (typeof start !== 'number') {\n      start = 0\n    }\n\n    if (start + search.length > this.length) {\n      return false\n    } else {\n      return this.indexOf(search, start) !== -1\n    }\n  }\n}\n\nif (!Array.prototype.includes) {\n  // eslint-disable-next-line no-extend-native\n  Array.prototype.includes = function (searchElement /*, fromIndex */) {\n    'use strict'\n    if (this == null) {\n      throw new TypeError('Array.prototype.includes called on null or undefined')\n    }\n\n    var O = Object(this)\n    var len = parseInt(O.length, 10) || 0\n    if (len === 0) {\n      return false\n    }\n    var n = parseInt(arguments[1], 10) || 0\n    var k\n    if (n >= 0) {\n      k = n\n    } else {\n      k = len + n\n      if (k < 0) { k = 0 }\n    }\n    var currentElement\n    while (k < len) {\n      currentElement = O[k]\n      if (searchElement === currentElement ||\n          (Number.isNaN(searchElement) && Number.isNaN(currentElement))\n      ) {\n        return true\n      }\n      k++\n    }\n    return false\n  }\n}\n\n// Production steps of ECMA-262, Edition 6, 22.1.2.1\n// Reference: https://people.mozilla.org/~jorendorff/es6-draft.html#sec-array.from\nif (!Array.from) {\n  Array.from = (function () {\n    var toStr = Object.prototype.toString\n    var isCallable = function (fn) {\n      return typeof fn === 'function' || toStr.call(fn) === '[object Function]'\n    }\n    var toInteger = function (value) {\n      var number = Number(value)\n      if (isNaN(number)) { return 0 }\n      if (number === 0 || !isFinite(number)) { return number }\n      return (number > 0 ? 1 : -1) * Math.floor(Math.abs(number))\n    }\n    var maxSafeInteger = Math.pow(2, 53) - 1\n    var toLength = function (value) {\n      var len = toInteger(value)\n      return Math.min(Math.max(len, 0), maxSafeInteger)\n    }\n\n    // The length property of the from method is 1.\n    return function from (arrayLike/*, mapFn, thisArg */) {\n      // 1. Let C be the this value.\n      var C = this\n\n      // 2. Let items be ToObject(arrayLike).\n      var items = Object(arrayLike)\n\n      // 3. ReturnIfAbrupt(items).\n      if (arrayLike == null) {\n        throw new TypeError('Array.from requires an array-like object - not null or undefined')\n      }\n\n      // 4. If mapfn is undefined, then let mapping be false.\n      var mapFn = arguments.length > 1 ? arguments[1] : void undefined\n      var T\n      if (typeof mapFn !== 'undefined') {\n        // 5. else\n        // 5. a If IsCallable(mapfn) is false, throw a TypeError exception.\n        if (!isCallable(mapFn)) {\n          throw new TypeError('Array.from: when provided, the second argument must be a function')\n        }\n\n        // 5. b. If thisArg was supplied, let T be thisArg; else let T be undefined.\n        if (arguments.length > 2) {\n          T = arguments[2]\n        }\n      }\n\n      // 10. Let lenValue be Get(items, \"length\").\n      // 11. Let len be ToLength(lenValue).\n      var len = toLength(items.length)\n\n      // 13. If IsConstructor(C) is true, then\n      // 13. a. Let A be the result of calling the [[Construct]] internal method of C with an argument list containing the single item len.\n      // 14. a. Else, Let A be ArrayCreate(len).\n      var A = isCallable(C) ? Object(new C(len)) : new Array(len)\n\n      // 16. Let k be 0.\n      var k = 0\n      // 17. Repeat, while k < len… (also steps a - h)\n      var kValue\n      while (k < len) {\n        kValue = items[k]\n        if (mapFn) {\n          A[k] = typeof T === 'undefined' ? mapFn(kValue, k) : mapFn.call(T, kValue, k)\n        } else {\n          A[k] = kValue\n        }\n        k += 1\n      }\n      // 18. Let putStatus be Put(A, \"length\", len, true).\n      A.length = len\n      // 20. Return A.\n      return A\n    }\n  }())\n}\n\nif (typeof window !== 'undefined') {\n  (function () {\n    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n    // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n    // requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel\n\n    // MIT license\n\n    var lastTime = 0\n    var vendors = [ 'ms', 'moz', 'webkit', 'o' ]\n\n    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n      window.requestAnimationFrame = (\n        window[ vendors[ x ] + 'RequestAnimationFrame' ]\n      )\n\n      window.cancelAnimationFrame = (\n        window[ vendors[ x ] + 'CancelAnimationFrame' ] ||\n        window[ vendors[ x ] + 'CancelRequestAnimationFrame' ]\n      )\n    }\n\n    if (!window.requestAnimationFrame) {\n      window.requestAnimationFrame = function (callback/*, element */) {\n        var currTime = new Date().getTime()\n        var timeToCall = Math.max(0, 16 - (currTime - lastTime))\n\n        var id = window.setTimeout(function () {\n          var time = currTime + timeToCall\n          callback(time)\n        }, timeToCall)\n\n        lastTime = currTime + timeToCall\n\n        return id\n      }\n    }\n\n    if (!window.cancelAnimationFrame) {\n      window.cancelAnimationFrame = function (id) {\n        clearTimeout(id)\n      }\n    }\n  }())\n}\n\nif (Function.prototype.name === undefined && Object.defineProperty !== undefined) {\n  // Missing in IE9-11.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name\n\n  // eslint-disable-next-line no-extend-native\n  Object.defineProperty(Function.prototype, 'name', {\n\n    get: function () {\n      return this.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[ 1 ]\n    }\n\n  })\n}\n\nif (typeof window !== 'undefined') {\n  if (window.performance === undefined) {\n    /* global self */\n    self.performance = {}\n  }\n\n  if (window.performance.now === undefined) {\n    (function () {\n      var start = Date.now()\n\n      window.performance.now = function () {\n        return Date.now() - start\n      }\n    })()\n  }\n}\n\nif (Object.defineProperty !== undefined) {\n  // Missing in IE < 13\n  // MIT license\n  // Copyright (c) 2016 Financial Times\n  // https://github.com/Financial-Times/polyfill-service\n  if (Number.MAX_SAFE_INTEGER === undefined) {\n    Object.defineProperty(Number, 'MAX_SAFE_INTEGER', {\n      enumerable: false,\n      configurable: false,\n      writable: false,\n      value: Math.pow(2, 53) - 1\n    })\n  }\n  if (Number.MIN_SAFE_INTEGER === undefined) {\n    Object.defineProperty(Number, 'MIN_SAFE_INTEGER', {\n      enumerable: false,\n      configurable: false,\n      writable: false,\n      value: -(Math.pow(2, 53) - 1)\n    })\n  }\n}\n","import promiseFinally from './finally';\nimport allSettled from './allSettled';\n\n// Store setTimeout reference so promise-polyfill will be unaffected by\n// other code modifying setTimeout (like sinon.useFakeTimers())\nvar setTimeoutFunc = setTimeout;\n\nfunction isArray(x) {\n  return Boolean(x && typeof x.length !== 'undefined');\n}\n\nfunction noop() {}\n\n// Polyfill for Function.prototype.bind\nfunction bind(fn, thisArg) {\n  return function() {\n    fn.apply(thisArg, arguments);\n  };\n}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError('Promises must be constructed via new');\n  if (typeof fn !== 'function') throw new TypeError('not a function');\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError('A promise cannot be resolved with itself.');\n    if (\n      newValue &&\n      (typeof newValue === 'object' || typeof newValue === 'function')\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === 'function') {\n        doResolve(bind(then, newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n  this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) return;\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) return;\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) return;\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype['catch'] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype['finally'] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.all accepts an array'));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === 'object' || typeof val === 'function')) {\n          var then = val.then;\n          if (typeof then === 'function') {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.allSettled = allSettled;\n\nPromise.resolve = function(value) {\n  if (value && typeof value === 'object' && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!isArray(arr)) {\n      return reject(new TypeError('Promise.race accepts an array'));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn =\n  // @ts-ignore\n  (typeof setImmediate === 'function' &&\n    function(fn) {\n      // @ts-ignore\n      setImmediate(fn);\n    }) ||\n  function(fn) {\n    setTimeoutFunc(fn, 0);\n  };\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n  if (typeof console !== 'undefined' && console) {\n    console.warn('Possible Unhandled Promise Rejection:', err); // eslint-disable-line no-console\n  }\n};\n\nexport default Promise;\n","/**\n * @this {Promise}\n */\nfunction finallyConstructor(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      // @ts-ignore\n      return constructor.resolve(callback()).then(function() {\n        // @ts-ignore\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nexport default finallyConstructor;\n","function allSettled(arr) {\n  var P = this;\n  return new P(function(resolve, reject) {\n    if (!(arr && typeof arr.length !== 'undefined')) {\n      return reject(\n        new TypeError(\n          typeof arr +\n            ' ' +\n            arr +\n            ' is not iterable(cannot read property Symbol(Symbol.iterator))'\n        )\n      );\n    }\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      if (val && (typeof val === 'object' || typeof val === 'function')) {\n        var then = val.then;\n        if (typeof then === 'function') {\n          then.call(\n            val,\n            function(val) {\n              res(i, val);\n            },\n            function(e) {\n              args[i] = { status: 'rejected', reason: e };\n              if (--remaining === 0) {\n                resolve(args);\n              }\n            }\n          );\n          return;\n        }\n      }\n      args[i] = { status: 'fulfilled', value: val };\n      if (--remaining === 0) {\n        resolve(args);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n}\n\nexport default allSettled;\n","/**\n * https://github.com/mrdoob/eventdispatcher.js/\n */\n\nfunction EventDispatcher() {}\n\nObject.assign( EventDispatcher.prototype, {\n\n\taddEventListener: function ( type, listener ) {\n\n\t\tif ( this._listeners === undefined ) this._listeners = {};\n\n\t\tconst listeners = this._listeners;\n\n\t\tif ( listeners[ type ] === undefined ) {\n\n\t\t\tlisteners[ type ] = [];\n\n\t\t}\n\n\t\tif ( listeners[ type ].indexOf( listener ) === - 1 ) {\n\n\t\t\tlisteners[ type ].push( listener );\n\n\t\t}\n\n\t},\n\n\thasEventListener: function ( type, listener ) {\n\n\t\tif ( this._listeners === undefined ) return false;\n\n\t\tconst listeners = this._listeners;\n\n\t\treturn listeners[ type ] !== undefined && listeners[ type ].indexOf( listener ) !== - 1;\n\n\t},\n\n\tremoveEventListener: function ( type, listener ) {\n\n\t\tif ( this._listeners === undefined ) return;\n\n\t\tconst listeners = this._listeners;\n\t\tconst listenerArray = listeners[ type ];\n\n\t\tif ( listenerArray !== undefined ) {\n\n\t\t\tconst index = listenerArray.indexOf( listener );\n\n\t\t\tif ( index !== - 1 ) {\n\n\t\t\t\tlistenerArray.splice( index, 1 );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\tdispatchEvent: function ( event ) {\n\n\t\tif ( this._listeners === undefined ) return;\n\n\t\tconst listeners = this._listeners;\n\t\tconst listenerArray = listeners[ event.type ];\n\n\t\tif ( listenerArray !== undefined ) {\n\n\t\t\tevent.target = this;\n\n\t\t\t// Make a copy, in case listeners are removed while iterating.\n\t\t\tconst array = listenerArray.slice( 0 );\n\n\t\t\tfor ( let i = 0, l = array.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ].call( this, event );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n} );\n\n\nexport { EventDispatcher };\n","/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author thezwap\n */\n\nconst _lut = [];\n\nfor ( let i = 0; i < 256; i ++ ) {\n\n\t_lut[ i ] = ( i < 16 ? '0' : '' ) + ( i ).toString( 16 );\n\n}\n\nconst MathUtils = {\n\n\tDEG2RAD: Math.PI / 180,\n\tRAD2DEG: 180 / Math.PI,\n\n\tgenerateUUID: function () {\n\n\t\t// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136\n\n\t\tconst d0 = Math.random() * 0xffffffff | 0;\n\t\tconst d1 = Math.random() * 0xffffffff | 0;\n\t\tconst d2 = Math.random() * 0xffffffff | 0;\n\t\tconst d3 = Math.random() * 0xffffffff | 0;\n\t\tconst uuid = _lut[ d0 & 0xff ] + _lut[ d0 >> 8 & 0xff ] + _lut[ d0 >> 16 & 0xff ] + _lut[ d0 >> 24 & 0xff ] + '-' +\n\t\t\t_lut[ d1 & 0xff ] + _lut[ d1 >> 8 & 0xff ] + '-' + _lut[ d1 >> 16 & 0x0f | 0x40 ] + _lut[ d1 >> 24 & 0xff ] + '-' +\n\t\t\t_lut[ d2 & 0x3f | 0x80 ] + _lut[ d2 >> 8 & 0xff ] + '-' + _lut[ d2 >> 16 & 0xff ] + _lut[ d2 >> 24 & 0xff ] +\n\t\t\t_lut[ d3 & 0xff ] + _lut[ d3 >> 8 & 0xff ] + _lut[ d3 >> 16 & 0xff ] + _lut[ d3 >> 24 & 0xff ];\n\n\t\t// .toUpperCase() here flattens concatenated strings to save heap memory space.\n\t\treturn uuid.toUpperCase();\n\n\t},\n\n\tclamp: function ( value, min, max ) {\n\n\t\treturn Math.max( min, Math.min( max, value ) );\n\n\t},\n\n\t// compute euclidian modulo of m % n\n\t// https://en.wikipedia.org/wiki/Modulo_operation\n\n\teuclideanModulo: function ( n, m ) {\n\n\t\treturn ( ( n % m ) + m ) % m;\n\n\t},\n\n\t// Linear mapping from range <a1, a2> to range <b1, b2>\n\n\tmapLinear: function ( x, a1, a2, b1, b2 ) {\n\n\t\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\n\n\t},\n\n\t// https://en.wikipedia.org/wiki/Linear_interpolation\n\n\tlerp: function ( x, y, t ) {\n\n\t\treturn ( 1 - t ) * x + t * y;\n\n\t},\n\n\t// http://en.wikipedia.org/wiki/Smoothstep\n\n\tsmoothstep: function ( x, min, max ) {\n\n\t\tif ( x <= min ) return 0;\n\t\tif ( x >= max ) return 1;\n\n\t\tx = ( x - min ) / ( max - min );\n\n\t\treturn x * x * ( 3 - 2 * x );\n\n\t},\n\n\tsmootherstep: function ( x, min, max ) {\n\n\t\tif ( x <= min ) return 0;\n\t\tif ( x >= max ) return 1;\n\n\t\tx = ( x - min ) / ( max - min );\n\n\t\treturn x * x * x * ( x * ( x * 6 - 15 ) + 10 );\n\n\t},\n\n\t// Random integer from <low, high> interval\n\n\trandInt: function ( low, high ) {\n\n\t\treturn low + Math.floor( Math.random() * ( high - low + 1 ) );\n\n\t},\n\n\t// Random float from <low, high> interval\n\n\trandFloat: function ( low, high ) {\n\n\t\treturn low + Math.random() * ( high - low );\n\n\t},\n\n\t// Random float from <-range/2, range/2> interval\n\n\trandFloatSpread: function ( range ) {\n\n\t\treturn range * ( 0.5 - Math.random() );\n\n\t},\n\n\tdegToRad: function ( degrees ) {\n\n\t\treturn degrees * MathUtils.DEG2RAD;\n\n\t},\n\n\tradToDeg: function ( radians ) {\n\n\t\treturn radians * MathUtils.RAD2DEG;\n\n\t},\n\n\tisPowerOfTwo: function ( value ) {\n\n\t\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\n\n\t},\n\n\tceilPowerOfTwo: function ( value ) {\n\n\t\treturn Math.pow( 2, Math.ceil( Math.log( value ) / Math.LN2 ) );\n\n\t},\n\n\tfloorPowerOfTwo: function ( value ) {\n\n\t\treturn Math.pow( 2, Math.floor( Math.log( value ) / Math.LN2 ) );\n\n\t},\n\n\tsetQuaternionFromProperEuler: function ( q, a, b, c, order ) {\n\n\t\t// Intrinsic Proper Euler Angles - see https://en.wikipedia.org/wiki/Euler_angles\n\n\t\t// rotations are applied to the axes in the order specified by 'order'\n\t\t// rotation by angle 'a' is applied first, then by angle 'b', then by angle 'c'\n\t\t// angles are in radians\n\n\t\tconst cos = Math.cos;\n\t\tconst sin = Math.sin;\n\n\t\tconst c2 = cos( b / 2 );\n\t\tconst s2 = sin( b / 2 );\n\n\t\tconst c13 = cos( ( a + c ) / 2 );\n\t\tconst s13 = sin( ( a + c ) / 2 );\n\n\t\tconst c1_3 = cos( ( a - c ) / 2 );\n\t\tconst s1_3 = sin( ( a - c ) / 2 );\n\n\t\tconst c3_1 = cos( ( c - a ) / 2 );\n\t\tconst s3_1 = sin( ( c - a ) / 2 );\n\n\t\tswitch ( order ) {\n\n\t\t\tcase 'XYX':\n\t\t\t\tq.set( c2 * s13, s2 * c1_3, s2 * s1_3, c2 * c13 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'YZY':\n\t\t\t\tq.set( s2 * s1_3, c2 * s13, s2 * c1_3, c2 * c13 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZXZ':\n\t\t\t\tq.set( s2 * c1_3, s2 * s1_3, c2 * s13, c2 * c13 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'XZX':\n\t\t\t\tq.set( c2 * s13, s2 * s3_1, s2 * c3_1, c2 * c13 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'YXY':\n\t\t\t\tq.set( s2 * c3_1, c2 * s13, s2 * s3_1, c2 * c13 );\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZYZ':\n\t\t\t\tq.set( s2 * s3_1, s2 * c3_1, c2 * s13, c2 * c13 );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.warn( 'THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: ' + order );\n\n\t\t}\n\n\t}\n\n};\n\n\nexport { MathUtils };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author philogb / http://blog.thejit.org/\n * @author egraether / http://egraether.com/\n * @author zz85 / http://www.lab4games.net/zz85/blog\n */\n\nfunction Vector2( x = 0, y = 0 ) {\n\n\tthis.x = x;\n\tthis.y = y;\n\n}\n\nObject.defineProperties( Vector2.prototype, {\n\n\t\"width\": {\n\n\t\tget: function () {\n\n\t\t\treturn this.x;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis.x = value;\n\n\t\t}\n\n\t},\n\n\t\"height\": {\n\n\t\tget: function () {\n\n\t\t\treturn this.y;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis.y = value;\n\n\t\t}\n\n\t}\n\n} );\n\nObject.assign( Vector2.prototype, {\n\n\tisVector2: true,\n\n\tset: function ( x, y ) {\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetScalar: function ( scalar ) {\n\n\t\tthis.x = scalar;\n\t\tthis.y = scalar;\n\n\t\treturn this;\n\n\t},\n\n\tsetX: function ( x ) {\n\n\t\tthis.x = x;\n\n\t\treturn this;\n\n\t},\n\n\tsetY: function ( y ) {\n\n\t\tthis.y = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetComponent: function ( index, value ) {\n\n\t\tswitch ( index ) {\n\n\t\t\tcase 0: this.x = value; break;\n\t\t\tcase 1: this.y = value; break;\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tgetComponent: function ( index ) {\n\n\t\tswitch ( index ) {\n\n\t\t\tcase 0: return this.x;\n\t\t\tcase 1: return this.y;\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\n\n\t\t}\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this.x, this.y );\n\n\t},\n\n\tcopy: function ( v ) {\n\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\n\t\treturn this;\n\n\t},\n\n\tadd: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\n\t\t\treturn this.addVectors( v, w );\n\n\t\t}\n\n\t\tthis.x += v.x;\n\t\tthis.y += v.y;\n\n\t\treturn this;\n\n\t},\n\n\taddScalar: function ( s ) {\n\n\t\tthis.x += s;\n\t\tthis.y += s;\n\n\t\treturn this;\n\n\t},\n\n\taddVectors: function ( a, b ) {\n\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\n\t\treturn this;\n\n\t},\n\n\taddScaledVector: function ( v, s ) {\n\n\t\tthis.x += v.x * s;\n\t\tthis.y += v.y * s;\n\n\t\treturn this;\n\n\t},\n\n\tsub: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\n\t\t\treturn this.subVectors( v, w );\n\n\t\t}\n\n\t\tthis.x -= v.x;\n\t\tthis.y -= v.y;\n\n\t\treturn this;\n\n\t},\n\n\tsubScalar: function ( s ) {\n\n\t\tthis.x -= s;\n\t\tthis.y -= s;\n\n\t\treturn this;\n\n\t},\n\n\tsubVectors: function ( a, b ) {\n\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( v ) {\n\n\t\tthis.x *= v.x;\n\t\tthis.y *= v.y;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( scalar ) {\n\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\n\t\treturn this;\n\n\t},\n\n\tdivide: function ( v ) {\n\n\t\tthis.x /= v.x;\n\t\tthis.y /= v.y;\n\n\t\treturn this;\n\n\t},\n\n\tdivideScalar: function ( scalar ) {\n\n\t\treturn this.multiplyScalar( 1 / scalar );\n\n\t},\n\n\tapplyMatrix3: function ( m ) {\n\n\t\tconst x = this.x, y = this.y;\n\t\tconst e = m.elements;\n\n\t\tthis.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ];\n\t\tthis.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ];\n\n\t\treturn this;\n\n\t},\n\n\tmin: function ( v ) {\n\n\t\tthis.x = Math.min( this.x, v.x );\n\t\tthis.y = Math.min( this.y, v.y );\n\n\t\treturn this;\n\n\t},\n\n\tmax: function ( v ) {\n\n\t\tthis.x = Math.max( this.x, v.x );\n\t\tthis.y = Math.max( this.y, v.y );\n\n\t\treturn this;\n\n\t},\n\n\tclamp: function ( min, max ) {\n\n\t\t// assumes min < max, componentwise\n\n\t\tthis.x = Math.max( min.x, Math.min( max.x, this.x ) );\n\t\tthis.y = Math.max( min.y, Math.min( max.y, this.y ) );\n\n\t\treturn this;\n\n\t},\n\n\tclampScalar: function ( minVal, maxVal ) {\n\n\t\tthis.x = Math.max( minVal, Math.min( maxVal, this.x ) );\n\t\tthis.y = Math.max( minVal, Math.min( maxVal, this.y ) );\n\n\t\treturn this;\n\n\t},\n\n\tclampLength: function ( min, max ) {\n\n\t\tconst length = this.length();\n\n\t\treturn this.divideScalar( length || 1 ).multiplyScalar( Math.max( min, Math.min( max, length ) ) );\n\n\t},\n\n\tfloor: function () {\n\n\t\tthis.x = Math.floor( this.x );\n\t\tthis.y = Math.floor( this.y );\n\n\t\treturn this;\n\n\t},\n\n\tceil: function () {\n\n\t\tthis.x = Math.ceil( this.x );\n\t\tthis.y = Math.ceil( this.y );\n\n\t\treturn this;\n\n\t},\n\n\tround: function () {\n\n\t\tthis.x = Math.round( this.x );\n\t\tthis.y = Math.round( this.y );\n\n\t\treturn this;\n\n\t},\n\n\troundToZero: function () {\n\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\n\n\t\treturn this;\n\n\t},\n\n\tnegate: function () {\n\n\t\tthis.x = - this.x;\n\t\tthis.y = - this.y;\n\n\t\treturn this;\n\n\t},\n\n\tdot: function ( v ) {\n\n\t\treturn this.x * v.x + this.y * v.y;\n\n\t},\n\n\tcross: function ( v ) {\n\n\t\treturn this.x * v.y - this.y * v.x;\n\n\t},\n\n\tlengthSq: function () {\n\n\t\treturn this.x * this.x + this.y * this.y;\n\n\t},\n\n\tlength: function () {\n\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y );\n\n\t},\n\n\tmanhattanLength: function () {\n\n\t\treturn Math.abs( this.x ) + Math.abs( this.y );\n\n\t},\n\n\tnormalize: function () {\n\n\t\treturn this.divideScalar( this.length() || 1 );\n\n\t},\n\n\tangle: function () {\n\n\t\t// computes the angle in radians with respect to the positive x-axis\n\n\t\tconst angle = Math.atan2( - this.y, - this.x ) + Math.PI;\n\n\t\treturn angle;\n\n\t},\n\n\tdistanceTo: function ( v ) {\n\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\n\n\t},\n\n\tdistanceToSquared: function ( v ) {\n\n\t\tconst dx = this.x - v.x, dy = this.y - v.y;\n\t\treturn dx * dx + dy * dy;\n\n\t},\n\n\tmanhattanDistanceTo: function ( v ) {\n\n\t\treturn Math.abs( this.x - v.x ) + Math.abs( this.y - v.y );\n\n\t},\n\n\tsetLength: function ( length ) {\n\n\t\treturn this.normalize().multiplyScalar( length );\n\n\t},\n\n\tlerp: function ( v, alpha ) {\n\n\t\tthis.x += ( v.x - this.x ) * alpha;\n\t\tthis.y += ( v.y - this.y ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tlerpVectors: function ( v1, v2, alpha ) {\n\n\t\tthis.x = v1.x + ( v2.x - v1.x ) * alpha;\n\t\tthis.y = v1.y + ( v2.y - v1.y ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( v ) {\n\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) );\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tthis.x = array[ offset ];\n\t\tthis.y = array[ offset + 1 ];\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tarray[ offset ] = this.x;\n\t\tarray[ offset + 1 ] = this.y;\n\n\t\treturn array;\n\n\t},\n\n\tfromBufferAttribute: function ( attribute, index, offset ) {\n\n\t\tif ( offset !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector2: offset has been removed from .fromBufferAttribute().' );\n\n\t\t}\n\n\t\tthis.x = attribute.getX( index );\n\t\tthis.y = attribute.getY( index );\n\n\t\treturn this;\n\n\t},\n\n\trotateAround: function ( center, angle ) {\n\n\t\tconst c = Math.cos( angle ), s = Math.sin( angle );\n\n\t\tconst x = this.x - center.x;\n\t\tconst y = this.y - center.y;\n\n\t\tthis.x = x * c - y * s + center.x;\n\t\tthis.y = x * s + y * c + center.y;\n\n\t\treturn this;\n\n\t},\n\n\trandom: function () {\n\n\t\tthis.x = Math.random();\n\t\tthis.y = Math.random();\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { Vector2 };\n","/**\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author bhouston / http://clara.io\n * @author tschw\n */\n\nfunction Matrix3() {\n\n\tthis.elements = [\n\n\t\t1, 0, 0,\n\t\t0, 1, 0,\n\t\t0, 0, 1\n\n\t];\n\n\tif ( arguments.length > 0 ) {\n\n\t\tconsole.error( 'THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.' );\n\n\t}\n\n}\n\nObject.assign( Matrix3.prototype, {\n\n\tisMatrix3: true,\n\n\tset: function ( n11, n12, n13, n21, n22, n23, n31, n32, n33 ) {\n\n\t\tconst te = this.elements;\n\n\t\tte[ 0 ] = n11; te[ 1 ] = n21; te[ 2 ] = n31;\n\t\tte[ 3 ] = n12; te[ 4 ] = n22; te[ 5 ] = n32;\n\t\tte[ 6 ] = n13; te[ 7 ] = n23; te[ 8 ] = n33;\n\n\t\treturn this;\n\n\t},\n\n\tidentity: function () {\n\n\t\tthis.set(\n\n\t\t\t1, 0, 0,\n\t\t\t0, 1, 0,\n\t\t\t0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().fromArray( this.elements );\n\n\t},\n\n\tcopy: function ( m ) {\n\n\t\tconst te = this.elements;\n\t\tconst me = m.elements;\n\n\t\tte[ 0 ] = me[ 0 ]; te[ 1 ] = me[ 1 ]; te[ 2 ] = me[ 2 ];\n\t\tte[ 3 ] = me[ 3 ]; te[ 4 ] = me[ 4 ]; te[ 5 ] = me[ 5 ];\n\t\tte[ 6 ] = me[ 6 ]; te[ 7 ] = me[ 7 ]; te[ 8 ] = me[ 8 ];\n\n\t\treturn this;\n\n\t},\n\n\textractBasis: function ( xAxis, yAxis, zAxis ) {\n\n\t\txAxis.setFromMatrix3Column( this, 0 );\n\t\tyAxis.setFromMatrix3Column( this, 1 );\n\t\tzAxis.setFromMatrix3Column( this, 2 );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromMatrix4: function ( m ) {\n\n\t\tconst me = m.elements;\n\n\t\tthis.set(\n\n\t\t\tme[ 0 ], me[ 4 ], me[ 8 ],\n\t\t\tme[ 1 ], me[ 5 ], me[ 9 ],\n\t\t\tme[ 2 ], me[ 6 ], me[ 10 ]\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( m ) {\n\n\t\treturn this.multiplyMatrices( this, m );\n\n\t},\n\n\tpremultiply: function ( m ) {\n\n\t\treturn this.multiplyMatrices( m, this );\n\n\t},\n\n\tmultiplyMatrices: function ( a, b ) {\n\n\t\tconst ae = a.elements;\n\t\tconst be = b.elements;\n\t\tconst te = this.elements;\n\n\t\tconst a11 = ae[ 0 ], a12 = ae[ 3 ], a13 = ae[ 6 ];\n\t\tconst a21 = ae[ 1 ], a22 = ae[ 4 ], a23 = ae[ 7 ];\n\t\tconst a31 = ae[ 2 ], a32 = ae[ 5 ], a33 = ae[ 8 ];\n\n\t\tconst b11 = be[ 0 ], b12 = be[ 3 ], b13 = be[ 6 ];\n\t\tconst b21 = be[ 1 ], b22 = be[ 4 ], b23 = be[ 7 ];\n\t\tconst b31 = be[ 2 ], b32 = be[ 5 ], b33 = be[ 8 ];\n\n\t\tte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31;\n\t\tte[ 3 ] = a11 * b12 + a12 * b22 + a13 * b32;\n\t\tte[ 6 ] = a11 * b13 + a12 * b23 + a13 * b33;\n\n\t\tte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31;\n\t\tte[ 4 ] = a21 * b12 + a22 * b22 + a23 * b32;\n\t\tte[ 7 ] = a21 * b13 + a22 * b23 + a23 * b33;\n\n\t\tte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31;\n\t\tte[ 5 ] = a31 * b12 + a32 * b22 + a33 * b32;\n\t\tte[ 8 ] = a31 * b13 + a32 * b23 + a33 * b33;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( s ) {\n\n\t\tconst te = this.elements;\n\n\t\tte[ 0 ] *= s; te[ 3 ] *= s; te[ 6 ] *= s;\n\t\tte[ 1 ] *= s; te[ 4 ] *= s; te[ 7 ] *= s;\n\t\tte[ 2 ] *= s; te[ 5 ] *= s; te[ 8 ] *= s;\n\n\t\treturn this;\n\n\t},\n\n\tdeterminant: function () {\n\n\t\tconst te = this.elements;\n\n\t\tconst a = te[ 0 ], b = te[ 1 ], c = te[ 2 ],\n\t\t\td = te[ 3 ], e = te[ 4 ], f = te[ 5 ],\n\t\t\tg = te[ 6 ], h = te[ 7 ], i = te[ 8 ];\n\n\t\treturn a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n\n\t},\n\n\tgetInverse: function ( matrix, throwOnDegenerate ) {\n\n\t\tif ( throwOnDegenerate !== undefined ) {\n\n\t\t\tconsole.warn( \"THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.\" );\n\n\t\t}\n\n\t\tconst me = matrix.elements,\n\t\t\tte = this.elements,\n\n\t\t\tn11 = me[ 0 ], n21 = me[ 1 ], n31 = me[ 2 ],\n\t\t\tn12 = me[ 3 ], n22 = me[ 4 ], n32 = me[ 5 ],\n\t\t\tn13 = me[ 6 ], n23 = me[ 7 ], n33 = me[ 8 ],\n\n\t\t\tt11 = n33 * n22 - n32 * n23,\n\t\t\tt12 = n32 * n13 - n33 * n12,\n\t\t\tt13 = n23 * n12 - n22 * n13,\n\n\t\t\tdet = n11 * t11 + n21 * t12 + n31 * t13;\n\n\t\tif ( det === 0 ) return this.set( 0, 0, 0, 0, 0, 0, 0, 0, 0 );\n\n\t\tconst detInv = 1 / det;\n\n\t\tte[ 0 ] = t11 * detInv;\n\t\tte[ 1 ] = ( n31 * n23 - n33 * n21 ) * detInv;\n\t\tte[ 2 ] = ( n32 * n21 - n31 * n22 ) * detInv;\n\n\t\tte[ 3 ] = t12 * detInv;\n\t\tte[ 4 ] = ( n33 * n11 - n31 * n13 ) * detInv;\n\t\tte[ 5 ] = ( n31 * n12 - n32 * n11 ) * detInv;\n\n\t\tte[ 6 ] = t13 * detInv;\n\t\tte[ 7 ] = ( n21 * n13 - n23 * n11 ) * detInv;\n\t\tte[ 8 ] = ( n22 * n11 - n21 * n12 ) * detInv;\n\n\t\treturn this;\n\n\t},\n\n\ttranspose: function () {\n\n\t\tlet tmp;\n\t\tconst m = this.elements;\n\n\t\ttmp = m[ 1 ]; m[ 1 ] = m[ 3 ]; m[ 3 ] = tmp;\n\t\ttmp = m[ 2 ]; m[ 2 ] = m[ 6 ]; m[ 6 ] = tmp;\n\t\ttmp = m[ 5 ]; m[ 5 ] = m[ 7 ]; m[ 7 ] = tmp;\n\n\t\treturn this;\n\n\t},\n\n\tgetNormalMatrix: function ( matrix4 ) {\n\n\t\treturn this.setFromMatrix4( matrix4 ).getInverse( this ).transpose();\n\n\t},\n\n\ttransposeIntoArray: function ( r ) {\n\n\t\tconst m = this.elements;\n\n\t\tr[ 0 ] = m[ 0 ];\n\t\tr[ 1 ] = m[ 3 ];\n\t\tr[ 2 ] = m[ 6 ];\n\t\tr[ 3 ] = m[ 1 ];\n\t\tr[ 4 ] = m[ 4 ];\n\t\tr[ 5 ] = m[ 7 ];\n\t\tr[ 6 ] = m[ 2 ];\n\t\tr[ 7 ] = m[ 5 ];\n\t\tr[ 8 ] = m[ 8 ];\n\n\t\treturn this;\n\n\t},\n\n\tsetUvTransform: function ( tx, ty, sx, sy, rotation, cx, cy ) {\n\n\t\tconst c = Math.cos( rotation );\n\t\tconst s = Math.sin( rotation );\n\n\t\tthis.set(\n\t\t\tsx * c, sx * s, - sx * ( c * cx + s * cy ) + cx + tx,\n\t\t\t- sy * s, sy * c, - sy * ( - s * cx + c * cy ) + cy + ty,\n\t\t\t0, 0, 1\n\t\t);\n\n\t},\n\n\tscale: function ( sx, sy ) {\n\n\t\tconst te = this.elements;\n\n\t\tte[ 0 ] *= sx; te[ 3 ] *= sx; te[ 6 ] *= sx;\n\t\tte[ 1 ] *= sy; te[ 4 ] *= sy; te[ 7 ] *= sy;\n\n\t\treturn this;\n\n\t},\n\n\trotate: function ( theta ) {\n\n\t\tconst c = Math.cos( theta );\n\t\tconst s = Math.sin( theta );\n\n\t\tconst te = this.elements;\n\n\t\tconst a11 = te[ 0 ], a12 = te[ 3 ], a13 = te[ 6 ];\n\t\tconst a21 = te[ 1 ], a22 = te[ 4 ], a23 = te[ 7 ];\n\n\t\tte[ 0 ] = c * a11 + s * a21;\n\t\tte[ 3 ] = c * a12 + s * a22;\n\t\tte[ 6 ] = c * a13 + s * a23;\n\n\t\tte[ 1 ] = - s * a11 + c * a21;\n\t\tte[ 4 ] = - s * a12 + c * a22;\n\t\tte[ 7 ] = - s * a13 + c * a23;\n\n\t\treturn this;\n\n\t},\n\n\ttranslate: function ( tx, ty ) {\n\n\t\tconst te = this.elements;\n\n\t\tte[ 0 ] += tx * te[ 2 ]; te[ 3 ] += tx * te[ 5 ]; te[ 6 ] += tx * te[ 8 ];\n\t\tte[ 1 ] += ty * te[ 2 ]; te[ 4 ] += ty * te[ 5 ]; te[ 7 ] += ty * te[ 8 ];\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( matrix ) {\n\n\t\tconst te = this.elements;\n\t\tconst me = matrix.elements;\n\n\t\tfor ( let i = 0; i < 9; i ++ ) {\n\n\t\t\tif ( te[ i ] !== me[ i ] ) return false;\n\n\t\t}\n\n\t\treturn true;\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tfor ( let i = 0; i < 9; i ++ ) {\n\n\t\t\tthis.elements[ i ] = array[ i + offset ];\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tconst te = this.elements;\n\n\t\tarray[ offset ] = te[ 0 ];\n\t\tarray[ offset + 1 ] = te[ 1 ];\n\t\tarray[ offset + 2 ] = te[ 2 ];\n\n\t\tarray[ offset + 3 ] = te[ 3 ];\n\t\tarray[ offset + 4 ] = te[ 4 ];\n\t\tarray[ offset + 5 ] = te[ 5 ];\n\n\t\tarray[ offset + 6 ] = te[ 6 ];\n\t\tarray[ offset + 7 ] = te[ 7 ];\n\t\tarray[ offset + 8 ] = te[ 8 ];\n\n\t\treturn array;\n\n\t}\n\n} );\n\n\nexport { Matrix3 };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author szimek / https://github.com/szimek/\n */\n\nlet _canvas;\n\nconst ImageUtils = {\n\n\tgetDataURL: function ( image ) {\n\n\t\tif ( /^data:/i.test( image.src ) ) {\n\n\t\t\treturn image.src;\n\n\t\t}\n\n\t\tif ( typeof HTMLCanvasElement == 'undefined' ) {\n\n\t\t\treturn image.src;\n\n\t\t}\n\n\t\tlet canvas;\n\n\t\tif ( image instanceof HTMLCanvasElement ) {\n\n\t\t\tcanvas = image;\n\n\t\t} else {\n\n\t\t\tif ( _canvas === undefined ) _canvas = document.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' );\n\n\t\t\t_canvas.width = image.width;\n\t\t\t_canvas.height = image.height;\n\n\t\t\tconst context = _canvas.getContext( '2d' );\n\n\t\t\tif ( image instanceof ImageData ) {\n\n\t\t\t\tcontext.putImageData( image, 0, 0 );\n\n\t\t\t} else {\n\n\t\t\t\tcontext.drawImage( image, 0, 0, image.width, image.height );\n\n\t\t\t}\n\n\t\t\tcanvas = _canvas;\n\n\t\t}\n\n\t\tif ( canvas.width > 2048 || canvas.height > 2048 ) {\n\n\t\t\treturn canvas.toDataURL( 'image/jpeg', 0.6 );\n\n\t\t} else {\n\n\t\t\treturn canvas.toDataURL( 'image/png' );\n\n\t\t}\n\n\t}\n\n};\n\nexport { ImageUtils };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author szimek / https://github.com/szimek/\n */\n\nimport { EventDispatcher } from '../core/EventDispatcher.js';\nimport {\n\tMirroredRepeatWrapping,\n\tClampToEdgeWrapping,\n\tRepeatWrapping,\n\tLinearEncoding,\n\tUnsignedByteType,\n\tRGBAFormat,\n\tLinearMipmapLinearFilter,\n\tLinearFilter,\n\tUVMapping\n} from '../constants.js';\nimport { MathUtils } from '../math/MathUtils.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Matrix3 } from '../math/Matrix3.js';\nimport { ImageUtils } from '../extras/ImageUtils.js';\n\nlet textureId = 0;\n\nfunction Texture( image, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding ) {\n\n\tObject.defineProperty( this, 'id', { value: textureId ++ } );\n\n\tthis.uuid = MathUtils.generateUUID();\n\n\tthis.name = '';\n\n\tthis.image = image !== undefined ? image : Texture.DEFAULT_IMAGE;\n\tthis.mipmaps = [];\n\n\tthis.mapping = mapping !== undefined ? mapping : Texture.DEFAULT_MAPPING;\n\n\tthis.wrapS = wrapS !== undefined ? wrapS : ClampToEdgeWrapping;\n\tthis.wrapT = wrapT !== undefined ? wrapT : ClampToEdgeWrapping;\n\n\tthis.magFilter = magFilter !== undefined ? magFilter : LinearFilter;\n\tthis.minFilter = minFilter !== undefined ? minFilter : LinearMipmapLinearFilter;\n\n\tthis.anisotropy = anisotropy !== undefined ? anisotropy : 1;\n\n\tthis.format = format !== undefined ? format : RGBAFormat;\n\tthis.internalFormat = null;\n\tthis.type = type !== undefined ? type : UnsignedByteType;\n\n\tthis.offset = new Vector2( 0, 0 );\n\tthis.repeat = new Vector2( 1, 1 );\n\tthis.center = new Vector2( 0, 0 );\n\tthis.rotation = 0;\n\n\tthis.matrixAutoUpdate = true;\n\tthis.matrix = new Matrix3();\n\n\tthis.generateMipmaps = true;\n\tthis.premultiplyAlpha = false;\n\tthis.flipY = true;\n\tthis.unpackAlignment = 4;\t// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\n\n\t// Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.\n\t//\n\t// Also changing the encoding after already used by a Material will not automatically make the Material\n\t// update. You need to explicitly call Material.needsUpdate to trigger it to recompile.\n\tthis.encoding = encoding !== undefined ? encoding : LinearEncoding;\n\n\tthis.version = 0;\n\tthis.onUpdate = null;\n\n}\n\nTexture.DEFAULT_IMAGE = undefined;\nTexture.DEFAULT_MAPPING = UVMapping;\n\nTexture.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n\tconstructor: Texture,\n\n\tisTexture: true,\n\n\tupdateMatrix: function () {\n\n\t\tthis.matrix.setUvTransform( this.offset.x, this.offset.y, this.repeat.x, this.repeat.y, this.rotation, this.center.x, this.center.y );\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.name = source.name;\n\n\t\tthis.image = source.image;\n\t\tthis.mipmaps = source.mipmaps.slice( 0 );\n\n\t\tthis.mapping = source.mapping;\n\n\t\tthis.wrapS = source.wrapS;\n\t\tthis.wrapT = source.wrapT;\n\n\t\tthis.magFilter = source.magFilter;\n\t\tthis.minFilter = source.minFilter;\n\n\t\tthis.anisotropy = source.anisotropy;\n\n\t\tthis.format = source.format;\n\t\tthis.internalFormat = source.internalFormat;\n\t\tthis.type = source.type;\n\n\t\tthis.offset.copy( source.offset );\n\t\tthis.repeat.copy( source.repeat );\n\t\tthis.center.copy( source.center );\n\t\tthis.rotation = source.rotation;\n\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\n\t\tthis.matrix.copy( source.matrix );\n\n\t\tthis.generateMipmaps = source.generateMipmaps;\n\t\tthis.premultiplyAlpha = source.premultiplyAlpha;\n\t\tthis.flipY = source.flipY;\n\t\tthis.unpackAlignment = source.unpackAlignment;\n\t\tthis.encoding = source.encoding;\n\n\t\treturn this;\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\tconst isRootObject = ( meta === undefined || typeof meta === 'string' );\n\n\t\tif ( ! isRootObject && meta.textures[ this.uuid ] !== undefined ) {\n\n\t\t\treturn meta.textures[ this.uuid ];\n\n\t\t}\n\n\t\tconst output = {\n\n\t\t\tmetadata: {\n\t\t\t\tversion: 4.5,\n\t\t\t\ttype: 'Texture',\n\t\t\t\tgenerator: 'Texture.toJSON'\n\t\t\t},\n\n\t\t\tuuid: this.uuid,\n\t\t\tname: this.name,\n\n\t\t\tmapping: this.mapping,\n\n\t\t\trepeat: [ this.repeat.x, this.repeat.y ],\n\t\t\toffset: [ this.offset.x, this.offset.y ],\n\t\t\tcenter: [ this.center.x, this.center.y ],\n\t\t\trotation: this.rotation,\n\n\t\t\twrap: [ this.wrapS, this.wrapT ],\n\n\t\t\tformat: this.format,\n\t\t\ttype: this.type,\n\t\t\tencoding: this.encoding,\n\n\t\t\tminFilter: this.minFilter,\n\t\t\tmagFilter: this.magFilter,\n\t\t\tanisotropy: this.anisotropy,\n\n\t\t\tflipY: this.flipY,\n\n\t\t\tpremultiplyAlpha: this.premultiplyAlpha,\n\t\t\tunpackAlignment: this.unpackAlignment\n\n\t\t};\n\n\t\tif ( this.image !== undefined ) {\n\n\t\t\t// TODO: Move to THREE.Image\n\n\t\t\tconst image = this.image;\n\n\t\t\tif ( image.uuid === undefined ) {\n\n\t\t\t\timage.uuid = MathUtils.generateUUID(); // UGH\n\n\t\t\t}\n\n\t\t\tif ( ! isRootObject && meta.images[ image.uuid ] === undefined ) {\n\n\t\t\t\tlet url;\n\n\t\t\t\tif ( Array.isArray( image ) ) {\n\n\t\t\t\t\t// process array of images e.g. CubeTexture\n\n\t\t\t\t\turl = [];\n\n\t\t\t\t\tfor ( let i = 0, l = image.length; i < l; i ++ ) {\n\n\t\t\t\t\t\turl.push( ImageUtils.getDataURL( image[ i ] ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// process single image\n\n\t\t\t\t\turl = ImageUtils.getDataURL( image );\n\n\t\t\t\t}\n\n\t\t\t\tmeta.images[ image.uuid ] = {\n\t\t\t\t\tuuid: image.uuid,\n\t\t\t\t\turl: url\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\toutput.image = image.uuid;\n\n\t\t}\n\n\t\tif ( ! isRootObject ) {\n\n\t\t\tmeta.textures[ this.uuid ] = output;\n\n\t\t}\n\n\t\treturn output;\n\n\t},\n\n\tdispose: function () {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t},\n\n\ttransformUv: function ( uv ) {\n\n\t\tif ( this.mapping !== UVMapping ) return uv;\n\n\t\tuv.applyMatrix3( this.matrix );\n\n\t\tif ( uv.x < 0 || uv.x > 1 ) {\n\n\t\t\tswitch ( this.wrapS ) {\n\n\t\t\t\tcase RepeatWrapping:\n\n\t\t\t\t\tuv.x = uv.x - Math.floor( uv.x );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ClampToEdgeWrapping:\n\n\t\t\t\t\tuv.x = uv.x < 0 ? 0 : 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MirroredRepeatWrapping:\n\n\t\t\t\t\tif ( Math.abs( Math.floor( uv.x ) % 2 ) === 1 ) {\n\n\t\t\t\t\t\tuv.x = Math.ceil( uv.x ) - uv.x;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tuv.x = uv.x - Math.floor( uv.x );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( uv.y < 0 || uv.y > 1 ) {\n\n\t\t\tswitch ( this.wrapT ) {\n\n\t\t\t\tcase RepeatWrapping:\n\n\t\t\t\t\tuv.y = uv.y - Math.floor( uv.y );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase ClampToEdgeWrapping:\n\n\t\t\t\t\tuv.y = uv.y < 0 ? 0 : 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MirroredRepeatWrapping:\n\n\t\t\t\t\tif ( Math.abs( Math.floor( uv.y ) % 2 ) === 1 ) {\n\n\t\t\t\t\t\tuv.y = Math.ceil( uv.y ) - uv.y;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tuv.y = uv.y - Math.floor( uv.y );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.flipY ) {\n\n\t\t\tuv.y = 1 - uv.y;\n\n\t\t}\n\n\t\treturn uv;\n\n\t}\n\n} );\n\nObject.defineProperty( Texture.prototype, \"needsUpdate\", {\n\n\tset: function ( value ) {\n\n\t\tif ( value === true ) this.version ++;\n\n\t}\n\n} );\n\n\nexport { Texture };\n","/**\n * @author supereggbert / http://www.paulbrunt.co.uk/\n * @author philogb / http://blog.thejit.org/\n * @author mikael emtinger / http://gomo.se/\n * @author egraether / http://egraether.com/\n * @author WestLangley / http://github.com/WestLangley\n */\n\nfunction Vector4( x = 0, y = 0, z = 0, w = 1 ) {\n\n\tthis.x = x;\n\tthis.y = y;\n\tthis.z = z;\n\tthis.w = w;\n\n}\n\nObject.defineProperties( Vector4.prototype, {\n\n\t\"width\": {\n\n\t\tget: function () {\n\n\t\t\treturn this.z;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis.z = value;\n\n\t\t}\n\n\t},\n\n\t\"height\": {\n\n\t\tget: function () {\n\n\t\t\treturn this.w;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis.w = value;\n\n\t\t}\n\n\t}\n\n} );\n\nObject.assign( Vector4.prototype, {\n\n\tisVector4: true,\n\n\tset: function ( x, y, z, w ) {\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t\tthis.w = w;\n\n\t\treturn this;\n\n\t},\n\n\tsetScalar: function ( scalar ) {\n\n\t\tthis.x = scalar;\n\t\tthis.y = scalar;\n\t\tthis.z = scalar;\n\t\tthis.w = scalar;\n\n\t\treturn this;\n\n\t},\n\n\tsetX: function ( x ) {\n\n\t\tthis.x = x;\n\n\t\treturn this;\n\n\t},\n\n\tsetY: function ( y ) {\n\n\t\tthis.y = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetZ: function ( z ) {\n\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\n\tsetW: function ( w ) {\n\n\t\tthis.w = w;\n\n\t\treturn this;\n\n\t},\n\n\tsetComponent: function ( index, value ) {\n\n\t\tswitch ( index ) {\n\n\t\t\tcase 0: this.x = value; break;\n\t\t\tcase 1: this.y = value; break;\n\t\t\tcase 2: this.z = value; break;\n\t\t\tcase 3: this.w = value; break;\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tgetComponent: function ( index ) {\n\n\t\tswitch ( index ) {\n\n\t\t\tcase 0: return this.x;\n\t\t\tcase 1: return this.y;\n\t\t\tcase 2: return this.z;\n\t\t\tcase 3: return this.w;\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\n\n\t\t}\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this.x, this.y, this.z, this.w );\n\n\t},\n\n\tcopy: function ( v ) {\n\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\t\tthis.w = ( v.w !== undefined ) ? v.w : 1;\n\n\t\treturn this;\n\n\t},\n\n\tadd: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\n\t\t\treturn this.addVectors( v, w );\n\n\t\t}\n\n\t\tthis.x += v.x;\n\t\tthis.y += v.y;\n\t\tthis.z += v.z;\n\t\tthis.w += v.w;\n\n\t\treturn this;\n\n\t},\n\n\taddScalar: function ( s ) {\n\n\t\tthis.x += s;\n\t\tthis.y += s;\n\t\tthis.z += s;\n\t\tthis.w += s;\n\n\t\treturn this;\n\n\t},\n\n\taddVectors: function ( a, b ) {\n\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\t\tthis.z = a.z + b.z;\n\t\tthis.w = a.w + b.w;\n\n\t\treturn this;\n\n\t},\n\n\taddScaledVector: function ( v, s ) {\n\n\t\tthis.x += v.x * s;\n\t\tthis.y += v.y * s;\n\t\tthis.z += v.z * s;\n\t\tthis.w += v.w * s;\n\n\t\treturn this;\n\n\t},\n\n\tsub: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\n\t\t\treturn this.subVectors( v, w );\n\n\t\t}\n\n\t\tthis.x -= v.x;\n\t\tthis.y -= v.y;\n\t\tthis.z -= v.z;\n\t\tthis.w -= v.w;\n\n\t\treturn this;\n\n\t},\n\n\tsubScalar: function ( s ) {\n\n\t\tthis.x -= s;\n\t\tthis.y -= s;\n\t\tthis.z -= s;\n\t\tthis.w -= s;\n\n\t\treturn this;\n\n\t},\n\n\tsubVectors: function ( a, b ) {\n\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\t\tthis.z = a.z - b.z;\n\t\tthis.w = a.w - b.w;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( scalar ) {\n\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\tthis.z *= scalar;\n\t\tthis.w *= scalar;\n\n\t\treturn this;\n\n\t},\n\n\tapplyMatrix4: function ( m ) {\n\n\t\tconst x = this.x, y = this.y, z = this.z, w = this.w;\n\t\tconst e = m.elements;\n\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] * w;\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] * w;\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] * w;\n\t\tthis.w = e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] * w;\n\n\t\treturn this;\n\n\t},\n\n\tdivideScalar: function ( scalar ) {\n\n\t\treturn this.multiplyScalar( 1 / scalar );\n\n\t},\n\n\tsetAxisAngleFromQuaternion: function ( q ) {\n\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\n\n\t\t// q is assumed to be normalized\n\n\t\tthis.w = 2 * Math.acos( q.w );\n\n\t\tconst s = Math.sqrt( 1 - q.w * q.w );\n\n\t\tif ( s < 0.0001 ) {\n\n\t\t\tthis.x = 1;\n\t\t\tthis.y = 0;\n\t\t\tthis.z = 0;\n\n\t\t} else {\n\n\t\t\tthis.x = q.x / s;\n\t\t\tthis.y = q.y / s;\n\t\t\tthis.z = q.z / s;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetAxisAngleFromRotationMatrix: function ( m ) {\n\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\n\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\n\t\tlet angle, x, y, z; // variables for result\n\t\tconst epsilon = 0.01,\t\t// margin to allow for rounding errors\n\t\t\tepsilon2 = 0.1,\t\t// margin to distinguish between 0 and 180 degrees\n\n\t\t\tte = m.elements,\n\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\n\n\t\tif ( ( Math.abs( m12 - m21 ) < epsilon ) &&\n\t\t     ( Math.abs( m13 - m31 ) < epsilon ) &&\n\t\t     ( Math.abs( m23 - m32 ) < epsilon ) ) {\n\n\t\t\t// singularity found\n\t\t\t// first check for identity matrix which must have +1 for all terms\n\t\t\t// in leading diagonal and zero in other terms\n\n\t\t\tif ( ( Math.abs( m12 + m21 ) < epsilon2 ) &&\n\t\t\t     ( Math.abs( m13 + m31 ) < epsilon2 ) &&\n\t\t\t     ( Math.abs( m23 + m32 ) < epsilon2 ) &&\n\t\t\t     ( Math.abs( m11 + m22 + m33 - 3 ) < epsilon2 ) ) {\n\n\t\t\t\t// this singularity is identity matrix so angle = 0\n\n\t\t\t\tthis.set( 1, 0, 0, 0 );\n\n\t\t\t\treturn this; // zero angle, arbitrary axis\n\n\t\t\t}\n\n\t\t\t// otherwise this singularity is angle = 180\n\n\t\t\tangle = Math.PI;\n\n\t\t\tconst xx = ( m11 + 1 ) / 2;\n\t\t\tconst yy = ( m22 + 1 ) / 2;\n\t\t\tconst zz = ( m33 + 1 ) / 2;\n\t\t\tconst xy = ( m12 + m21 ) / 4;\n\t\t\tconst xz = ( m13 + m31 ) / 4;\n\t\t\tconst yz = ( m23 + m32 ) / 4;\n\n\t\t\tif ( ( xx > yy ) && ( xx > zz ) ) {\n\n\t\t\t\t// m11 is the largest diagonal term\n\n\t\t\t\tif ( xx < epsilon ) {\n\n\t\t\t\t\tx = 0;\n\t\t\t\t\ty = 0.707106781;\n\t\t\t\t\tz = 0.707106781;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tx = Math.sqrt( xx );\n\t\t\t\t\ty = xy / x;\n\t\t\t\t\tz = xz / x;\n\n\t\t\t\t}\n\n\t\t\t} else if ( yy > zz ) {\n\n\t\t\t\t// m22 is the largest diagonal term\n\n\t\t\t\tif ( yy < epsilon ) {\n\n\t\t\t\t\tx = 0.707106781;\n\t\t\t\t\ty = 0;\n\t\t\t\t\tz = 0.707106781;\n\n\t\t\t\t} else {\n\n\t\t\t\t\ty = Math.sqrt( yy );\n\t\t\t\t\tx = xy / y;\n\t\t\t\t\tz = yz / y;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// m33 is the largest diagonal term so base result on this\n\n\t\t\t\tif ( zz < epsilon ) {\n\n\t\t\t\t\tx = 0.707106781;\n\t\t\t\t\ty = 0.707106781;\n\t\t\t\t\tz = 0;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tz = Math.sqrt( zz );\n\t\t\t\t\tx = xz / z;\n\t\t\t\t\ty = yz / z;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.set( x, y, z, angle );\n\n\t\t\treturn this; // return 180 deg rotation\n\n\t\t}\n\n\t\t// as we have reached here there are no singularities so we can handle normally\n\n\t\tlet s = Math.sqrt( ( m32 - m23 ) * ( m32 - m23 ) +\n\t\t\t( m13 - m31 ) * ( m13 - m31 ) +\n\t\t\t( m21 - m12 ) * ( m21 - m12 ) ); // used to normalize\n\n\t\tif ( Math.abs( s ) < 0.001 ) s = 1;\n\n\t\t// prevent divide by zero, should not happen if matrix is orthogonal and should be\n\t\t// caught by singularity test above, but I've left it in just in case\n\n\t\tthis.x = ( m32 - m23 ) / s;\n\t\tthis.y = ( m13 - m31 ) / s;\n\t\tthis.z = ( m21 - m12 ) / s;\n\t\tthis.w = Math.acos( ( m11 + m22 + m33 - 1 ) / 2 );\n\n\t\treturn this;\n\n\t},\n\n\tmin: function ( v ) {\n\n\t\tthis.x = Math.min( this.x, v.x );\n\t\tthis.y = Math.min( this.y, v.y );\n\t\tthis.z = Math.min( this.z, v.z );\n\t\tthis.w = Math.min( this.w, v.w );\n\n\t\treturn this;\n\n\t},\n\n\tmax: function ( v ) {\n\n\t\tthis.x = Math.max( this.x, v.x );\n\t\tthis.y = Math.max( this.y, v.y );\n\t\tthis.z = Math.max( this.z, v.z );\n\t\tthis.w = Math.max( this.w, v.w );\n\n\t\treturn this;\n\n\t},\n\n\tclamp: function ( min, max ) {\n\n\t\t// assumes min < max, componentwise\n\n\t\tthis.x = Math.max( min.x, Math.min( max.x, this.x ) );\n\t\tthis.y = Math.max( min.y, Math.min( max.y, this.y ) );\n\t\tthis.z = Math.max( min.z, Math.min( max.z, this.z ) );\n\t\tthis.w = Math.max( min.w, Math.min( max.w, this.w ) );\n\n\t\treturn this;\n\n\t},\n\n\tclampScalar: function ( minVal, maxVal ) {\n\n\t\tthis.x = Math.max( minVal, Math.min( maxVal, this.x ) );\n\t\tthis.y = Math.max( minVal, Math.min( maxVal, this.y ) );\n\t\tthis.z = Math.max( minVal, Math.min( maxVal, this.z ) );\n\t\tthis.w = Math.max( minVal, Math.min( maxVal, this.w ) );\n\n\t\treturn this;\n\n\t},\n\n\tclampLength: function ( min, max ) {\n\n\t\tconst length = this.length();\n\n\t\treturn this.divideScalar( length || 1 ).multiplyScalar( Math.max( min, Math.min( max, length ) ) );\n\n\t},\n\n\tfloor: function () {\n\n\t\tthis.x = Math.floor( this.x );\n\t\tthis.y = Math.floor( this.y );\n\t\tthis.z = Math.floor( this.z );\n\t\tthis.w = Math.floor( this.w );\n\n\t\treturn this;\n\n\t},\n\n\tceil: function () {\n\n\t\tthis.x = Math.ceil( this.x );\n\t\tthis.y = Math.ceil( this.y );\n\t\tthis.z = Math.ceil( this.z );\n\t\tthis.w = Math.ceil( this.w );\n\n\t\treturn this;\n\n\t},\n\n\tround: function () {\n\n\t\tthis.x = Math.round( this.x );\n\t\tthis.y = Math.round( this.y );\n\t\tthis.z = Math.round( this.z );\n\t\tthis.w = Math.round( this.w );\n\n\t\treturn this;\n\n\t},\n\n\troundToZero: function () {\n\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\n\t\tthis.w = ( this.w < 0 ) ? Math.ceil( this.w ) : Math.floor( this.w );\n\n\t\treturn this;\n\n\t},\n\n\tnegate: function () {\n\n\t\tthis.x = - this.x;\n\t\tthis.y = - this.y;\n\t\tthis.z = - this.z;\n\t\tthis.w = - this.w;\n\n\t\treturn this;\n\n\t},\n\n\tdot: function ( v ) {\n\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\n\n\t},\n\n\tlengthSq: function () {\n\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\n\n\t},\n\n\tlength: function () {\n\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\n\n\t},\n\n\tmanhattanLength: function () {\n\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z ) + Math.abs( this.w );\n\n\t},\n\n\tnormalize: function () {\n\n\t\treturn this.divideScalar( this.length() || 1 );\n\n\t},\n\n\tsetLength: function ( length ) {\n\n\t\treturn this.normalize().multiplyScalar( length );\n\n\t},\n\n\tlerp: function ( v, alpha ) {\n\n\t\tthis.x += ( v.x - this.x ) * alpha;\n\t\tthis.y += ( v.y - this.y ) * alpha;\n\t\tthis.z += ( v.z - this.z ) * alpha;\n\t\tthis.w += ( v.w - this.w ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tlerpVectors: function ( v1, v2, alpha ) {\n\n\t\tthis.x = v1.x + ( v2.x - v1.x ) * alpha;\n\t\tthis.y = v1.y + ( v2.y - v1.y ) * alpha;\n\t\tthis.z = v1.z + ( v2.z - v1.z ) * alpha;\n\t\tthis.w = v1.w + ( v2.w - v1.w ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( v ) {\n\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) && ( v.w === this.w ) );\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tthis.x = array[ offset ];\n\t\tthis.y = array[ offset + 1 ];\n\t\tthis.z = array[ offset + 2 ];\n\t\tthis.w = array[ offset + 3 ];\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tarray[ offset ] = this.x;\n\t\tarray[ offset + 1 ] = this.y;\n\t\tarray[ offset + 2 ] = this.z;\n\t\tarray[ offset + 3 ] = this.w;\n\n\t\treturn array;\n\n\t},\n\n\tfromBufferAttribute: function ( attribute, index, offset ) {\n\n\t\tif ( offset !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector4: offset has been removed from .fromBufferAttribute().' );\n\n\t\t}\n\n\t\tthis.x = attribute.getX( index );\n\t\tthis.y = attribute.getY( index );\n\t\tthis.z = attribute.getZ( index );\n\t\tthis.w = attribute.getW( index );\n\n\t\treturn this;\n\n\t},\n\n\trandom: function () {\n\n\t\tthis.x = Math.random();\n\t\tthis.y = Math.random();\n\t\tthis.z = Math.random();\n\t\tthis.w = Math.random();\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { Vector4 };\n","import { EventDispatcher } from '../core/EventDispatcher.js';\nimport { Texture } from '../textures/Texture.js';\nimport { LinearFilter } from '../constants.js';\nimport { Vector4 } from '../math/Vector4.js';\n\n/**\n * @author szimek / https://github.com/szimek/\n * @author alteredq / http://alteredqualia.com/\n * @author Marius Kintel / https://github.com/kintel\n */\n\n/*\n In options, we can specify:\n * Texture parameters for an auto-generated target texture\n * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers\n*/\nfunction WebGLRenderTarget( width, height, options ) {\n\n\tthis.width = width;\n\tthis.height = height;\n\n\tthis.scissor = new Vector4( 0, 0, width, height );\n\tthis.scissorTest = false;\n\n\tthis.viewport = new Vector4( 0, 0, width, height );\n\n\toptions = options || {};\n\n\tthis.texture = new Texture( undefined, options.mapping, options.wrapS, options.wrapT, options.magFilter, options.minFilter, options.format, options.type, options.anisotropy, options.encoding );\n\n\tthis.texture.image = {};\n\tthis.texture.image.width = width;\n\tthis.texture.image.height = height;\n\n\tthis.texture.generateMipmaps = options.generateMipmaps !== undefined ? options.generateMipmaps : false;\n\tthis.texture.minFilter = options.minFilter !== undefined ? options.minFilter : LinearFilter;\n\n\tthis.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\n\tthis.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : true;\n\tthis.depthTexture = options.depthTexture !== undefined ? options.depthTexture : null;\n\n}\n\nWebGLRenderTarget.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n\tconstructor: WebGLRenderTarget,\n\n\tisWebGLRenderTarget: true,\n\n\tsetSize: function ( width, height ) {\n\n\t\tif ( this.width !== width || this.height !== height ) {\n\n\t\t\tthis.width = width;\n\t\t\tthis.height = height;\n\n\t\t\tthis.texture.image.width = width;\n\t\t\tthis.texture.image.height = height;\n\n\t\t\tthis.dispose();\n\n\t\t}\n\n\t\tthis.viewport.set( 0, 0, width, height );\n\t\tthis.scissor.set( 0, 0, width, height );\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.width = source.width;\n\t\tthis.height = source.height;\n\n\t\tthis.viewport.copy( source.viewport );\n\n\t\tthis.texture = source.texture.clone();\n\n\t\tthis.depthBuffer = source.depthBuffer;\n\t\tthis.stencilBuffer = source.stencilBuffer;\n\t\tthis.depthTexture = source.depthTexture;\n\n\t\treturn this;\n\n\t},\n\n\tdispose: function () {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t}\n\n} );\n\n\nexport { WebGLRenderTarget };\n","/**\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author bhouston / http://clara.io\n */\n\nimport { MathUtils } from './MathUtils.js';\n\nfunction Quaternion( x = 0, y = 0, z = 0, w = 1 ) {\n\n\tthis._x = x;\n\tthis._y = y;\n\tthis._z = z;\n\tthis._w = w;\n\n}\n\nObject.assign( Quaternion, {\n\n\tslerp: function ( qa, qb, qm, t ) {\n\n\t\treturn qm.copy( qa ).slerp( qb, t );\n\n\t},\n\n\tslerpFlat: function ( dst, dstOffset, src0, srcOffset0, src1, srcOffset1, t ) {\n\n\t\t// fuzz-free, array-based Quaternion SLERP operation\n\n\t\tlet x0 = src0[ srcOffset0 + 0 ],\n\t\t\ty0 = src0[ srcOffset0 + 1 ],\n\t\t\tz0 = src0[ srcOffset0 + 2 ],\n\t\t\tw0 = src0[ srcOffset0 + 3 ];\n\n\t\tconst x1 = src1[ srcOffset1 + 0 ],\n\t\t\ty1 = src1[ srcOffset1 + 1 ],\n\t\t\tz1 = src1[ srcOffset1 + 2 ],\n\t\t\tw1 = src1[ srcOffset1 + 3 ];\n\n\t\tif ( w0 !== w1 || x0 !== x1 || y0 !== y1 || z0 !== z1 ) {\n\n\t\t\tlet s = 1 - t,\n\n\t\t\t\tcos = x0 * x1 + y0 * y1 + z0 * z1 + w0 * w1,\n\n\t\t\t\tdir = ( cos >= 0 ? 1 : - 1 ),\n\t\t\t\tsqrSin = 1 - cos * cos;\n\n\t\t\t// Skip the Slerp for tiny steps to avoid numeric problems:\n\t\t\tif ( sqrSin > Number.EPSILON ) {\n\n\t\t\t\tconst sin = Math.sqrt( sqrSin ),\n\t\t\t\t\tlen = Math.atan2( sin, cos * dir );\n\n\t\t\t\ts = Math.sin( s * len ) / sin;\n\t\t\t\tt = Math.sin( t * len ) / sin;\n\n\t\t\t}\n\n\t\t\tconst tDir = t * dir;\n\n\t\t\tx0 = x0 * s + x1 * tDir;\n\t\t\ty0 = y0 * s + y1 * tDir;\n\t\t\tz0 = z0 * s + z1 * tDir;\n\t\t\tw0 = w0 * s + w1 * tDir;\n\n\t\t\t// Normalize in case we just did a lerp:\n\t\t\tif ( s === 1 - t ) {\n\n\t\t\t\tconst f = 1 / Math.sqrt( x0 * x0 + y0 * y0 + z0 * z0 + w0 * w0 );\n\n\t\t\t\tx0 *= f;\n\t\t\t\ty0 *= f;\n\t\t\t\tz0 *= f;\n\t\t\t\tw0 *= f;\n\n\t\t\t}\n\n\t\t}\n\n\t\tdst[ dstOffset ] = x0;\n\t\tdst[ dstOffset + 1 ] = y0;\n\t\tdst[ dstOffset + 2 ] = z0;\n\t\tdst[ dstOffset + 3 ] = w0;\n\n\t},\n\n\tmultiplyQuaternionsFlat: function ( dst, dstOffset, src0, srcOffset0, src1, srcOffset1 ) {\n\n\t\tconst x0 = src0[ srcOffset0 ];\n\t\tconst y0 = src0[ srcOffset0 + 1 ];\n\t\tconst z0 = src0[ srcOffset0 + 2 ];\n\t\tconst w0 = src0[ srcOffset0 + 3 ];\n\n\t\tconst x1 = src1[ srcOffset1 ];\n\t\tconst y1 = src1[ srcOffset1 + 1 ];\n\t\tconst z1 = src1[ srcOffset1 + 2 ];\n\t\tconst w1 = src1[ srcOffset1 + 3 ];\n\n\t\tdst[ dstOffset ] = x0 * w1 + w0 * x1 + y0 * z1 - z0 * y1;\n\t\tdst[ dstOffset + 1 ] = y0 * w1 + w0 * y1 + z0 * x1 - x0 * z1;\n\t\tdst[ dstOffset + 2 ] = z0 * w1 + w0 * z1 + x0 * y1 - y0 * x1;\n\t\tdst[ dstOffset + 3 ] = w0 * w1 - x0 * x1 - y0 * y1 - z0 * z1;\n\n\t\treturn dst;\n\n\t}\n\n} );\n\nObject.defineProperties( Quaternion.prototype, {\n\n\tx: {\n\n\t\tget: function () {\n\n\t\t\treturn this._x;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._x = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t},\n\n\ty: {\n\n\t\tget: function () {\n\n\t\t\treturn this._y;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._y = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t},\n\n\tz: {\n\n\t\tget: function () {\n\n\t\t\treturn this._z;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._z = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t},\n\n\tw: {\n\n\t\tget: function () {\n\n\t\t\treturn this._w;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._w = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t}\n\n} );\n\nObject.assign( Quaternion.prototype, {\n\n\tisQuaternion: true,\n\n\tset: function ( x, y, z, w ) {\n\n\t\tthis._x = x;\n\t\tthis._y = y;\n\t\tthis._z = z;\n\t\tthis._w = w;\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this._x, this._y, this._z, this._w );\n\n\t},\n\n\tcopy: function ( quaternion ) {\n\n\t\tthis._x = quaternion.x;\n\t\tthis._y = quaternion.y;\n\t\tthis._z = quaternion.z;\n\t\tthis._w = quaternion.w;\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tsetFromEuler: function ( euler, update ) {\n\n\t\tif ( ! ( euler && euler.isEuler ) ) {\n\n\t\t\tthrow new Error( 'THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.' );\n\n\t\t}\n\n\t\tconst x = euler._x, y = euler._y, z = euler._z, order = euler.order;\n\n\t\t// http://www.mathworks.com/matlabcentral/fileexchange/\n\t\t// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\n\t\t//\tcontent/SpinCalc.m\n\n\t\tconst cos = Math.cos;\n\t\tconst sin = Math.sin;\n\n\t\tconst c1 = cos( x / 2 );\n\t\tconst c2 = cos( y / 2 );\n\t\tconst c3 = cos( z / 2 );\n\n\t\tconst s1 = sin( x / 2 );\n\t\tconst s2 = sin( y / 2 );\n\t\tconst s3 = sin( z / 2 );\n\n\t\tswitch ( order ) {\n\n\t\t\tcase 'XYZ':\n\t\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\n\t\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\n\t\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\n\t\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\n\t\t\t\tbreak;\n\n\t\t\tcase 'YXZ':\n\t\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\n\t\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\n\t\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\n\t\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZXY':\n\t\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\n\t\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\n\t\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\n\t\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZYX':\n\t\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\n\t\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\n\t\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\n\t\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\n\t\t\t\tbreak;\n\n\t\t\tcase 'YZX':\n\t\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\n\t\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\n\t\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\n\t\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\n\t\t\t\tbreak;\n\n\t\t\tcase 'XZY':\n\t\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\n\t\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\n\t\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\n\t\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.warn( 'THREE.Quaternion: .setFromEuler() encountered an unknown order: ' + order );\n\n\t\t}\n\n\t\tif ( update !== false ) this._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tsetFromAxisAngle: function ( axis, angle ) {\n\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\n\n\t\t// assumes axis is normalized\n\n\t\tconst halfAngle = angle / 2, s = Math.sin( halfAngle );\n\n\t\tthis._x = axis.x * s;\n\t\tthis._y = axis.y * s;\n\t\tthis._z = axis.z * s;\n\t\tthis._w = Math.cos( halfAngle );\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tsetFromRotationMatrix: function ( m ) {\n\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\n\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\n\t\tconst te = m.elements,\n\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ],\n\n\t\t\ttrace = m11 + m22 + m33;\n\n\t\tif ( trace > 0 ) {\n\n\t\t\tconst s = 0.5 / Math.sqrt( trace + 1.0 );\n\n\t\t\tthis._w = 0.25 / s;\n\t\t\tthis._x = ( m32 - m23 ) * s;\n\t\t\tthis._y = ( m13 - m31 ) * s;\n\t\t\tthis._z = ( m21 - m12 ) * s;\n\n\t\t} else if ( m11 > m22 && m11 > m33 ) {\n\n\t\t\tconst s = 2.0 * Math.sqrt( 1.0 + m11 - m22 - m33 );\n\n\t\t\tthis._w = ( m32 - m23 ) / s;\n\t\t\tthis._x = 0.25 * s;\n\t\t\tthis._y = ( m12 + m21 ) / s;\n\t\t\tthis._z = ( m13 + m31 ) / s;\n\n\t\t} else if ( m22 > m33 ) {\n\n\t\t\tconst s = 2.0 * Math.sqrt( 1.0 + m22 - m11 - m33 );\n\n\t\t\tthis._w = ( m13 - m31 ) / s;\n\t\t\tthis._x = ( m12 + m21 ) / s;\n\t\t\tthis._y = 0.25 * s;\n\t\t\tthis._z = ( m23 + m32 ) / s;\n\n\t\t} else {\n\n\t\t\tconst s = 2.0 * Math.sqrt( 1.0 + m33 - m11 - m22 );\n\n\t\t\tthis._w = ( m21 - m12 ) / s;\n\t\t\tthis._x = ( m13 + m31 ) / s;\n\t\t\tthis._y = ( m23 + m32 ) / s;\n\t\t\tthis._z = 0.25 * s;\n\n\t\t}\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tsetFromUnitVectors: function ( vFrom, vTo ) {\n\n\t\t// assumes direction vectors vFrom and vTo are normalized\n\n\t\tconst EPS = 0.000001;\n\n\t\tlet r = vFrom.dot( vTo ) + 1;\n\n\t\tif ( r < EPS ) {\n\n\t\t\tr = 0;\n\n\t\t\tif ( Math.abs( vFrom.x ) > Math.abs( vFrom.z ) ) {\n\n\t\t\t\tthis._x = - vFrom.y;\n\t\t\t\tthis._y = vFrom.x;\n\t\t\t\tthis._z = 0;\n\t\t\t\tthis._w = r;\n\n\t\t\t} else {\n\n\t\t\t\tthis._x = 0;\n\t\t\t\tthis._y = - vFrom.z;\n\t\t\t\tthis._z = vFrom.y;\n\t\t\t\tthis._w = r;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// crossVectors( vFrom, vTo ); // inlined to avoid cyclic dependency on Vector3\n\n\t\t\tthis._x = vFrom.y * vTo.z - vFrom.z * vTo.y;\n\t\t\tthis._y = vFrom.z * vTo.x - vFrom.x * vTo.z;\n\t\t\tthis._z = vFrom.x * vTo.y - vFrom.y * vTo.x;\n\t\t\tthis._w = r;\n\n\t\t}\n\n\t\treturn this.normalize();\n\n\t},\n\n\tangleTo: function ( q ) {\n\n\t\treturn 2 * Math.acos( Math.abs( MathUtils.clamp( this.dot( q ), - 1, 1 ) ) );\n\n\t},\n\n\trotateTowards: function ( q, step ) {\n\n\t\tconst angle = this.angleTo( q );\n\n\t\tif ( angle === 0 ) return this;\n\n\t\tconst t = Math.min( 1, step / angle );\n\n\t\tthis.slerp( q, t );\n\n\t\treturn this;\n\n\t},\n\n\tinverse: function () {\n\n\t\t// quaternion is assumed to have unit length\n\n\t\treturn this.conjugate();\n\n\t},\n\n\tconjugate: function () {\n\n\t\tthis._x *= - 1;\n\t\tthis._y *= - 1;\n\t\tthis._z *= - 1;\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tdot: function ( v ) {\n\n\t\treturn this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\n\n\t},\n\n\tlengthSq: function () {\n\n\t\treturn this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\n\n\t},\n\n\tlength: function () {\n\n\t\treturn Math.sqrt( this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w );\n\n\t},\n\n\tnormalize: function () {\n\n\t\tlet l = this.length();\n\n\t\tif ( l === 0 ) {\n\n\t\t\tthis._x = 0;\n\t\t\tthis._y = 0;\n\t\t\tthis._z = 0;\n\t\t\tthis._w = 1;\n\n\t\t} else {\n\n\t\t\tl = 1 / l;\n\n\t\t\tthis._x = this._x * l;\n\t\t\tthis._y = this._y * l;\n\t\t\tthis._z = this._z * l;\n\t\t\tthis._w = this._w * l;\n\n\t\t}\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( q, p ) {\n\n\t\tif ( p !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.' );\n\t\t\treturn this.multiplyQuaternions( q, p );\n\n\t\t}\n\n\t\treturn this.multiplyQuaternions( this, q );\n\n\t},\n\n\tpremultiply: function ( q ) {\n\n\t\treturn this.multiplyQuaternions( q, this );\n\n\t},\n\n\tmultiplyQuaternions: function ( a, b ) {\n\n\t\t// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\n\n\t\tconst qax = a._x, qay = a._y, qaz = a._z, qaw = a._w;\n\t\tconst qbx = b._x, qby = b._y, qbz = b._z, qbw = b._w;\n\n\t\tthis._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\n\t\tthis._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\n\t\tthis._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\n\t\tthis._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tslerp: function ( qb, t ) {\n\n\t\tif ( t === 0 ) return this;\n\t\tif ( t === 1 ) return this.copy( qb );\n\n\t\tconst x = this._x, y = this._y, z = this._z, w = this._w;\n\n\t\t// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\n\n\t\tlet cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\n\n\t\tif ( cosHalfTheta < 0 ) {\n\n\t\t\tthis._w = - qb._w;\n\t\t\tthis._x = - qb._x;\n\t\t\tthis._y = - qb._y;\n\t\t\tthis._z = - qb._z;\n\n\t\t\tcosHalfTheta = - cosHalfTheta;\n\n\t\t} else {\n\n\t\t\tthis.copy( qb );\n\n\t\t}\n\n\t\tif ( cosHalfTheta >= 1.0 ) {\n\n\t\t\tthis._w = w;\n\t\t\tthis._x = x;\n\t\t\tthis._y = y;\n\t\t\tthis._z = z;\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tconst sqrSinHalfTheta = 1.0 - cosHalfTheta * cosHalfTheta;\n\n\t\tif ( sqrSinHalfTheta <= Number.EPSILON ) {\n\n\t\t\tconst s = 1 - t;\n\t\t\tthis._w = s * w + t * this._w;\n\t\t\tthis._x = s * x + t * this._x;\n\t\t\tthis._y = s * y + t * this._y;\n\t\t\tthis._z = s * z + t * this._z;\n\n\t\t\tthis.normalize();\n\t\t\tthis._onChangeCallback();\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tconst sinHalfTheta = Math.sqrt( sqrSinHalfTheta );\n\t\tconst halfTheta = Math.atan2( sinHalfTheta, cosHalfTheta );\n\t\tconst ratioA = Math.sin( ( 1 - t ) * halfTheta ) / sinHalfTheta,\n\t\t\tratioB = Math.sin( t * halfTheta ) / sinHalfTheta;\n\n\t\tthis._w = ( w * ratioA + this._w * ratioB );\n\t\tthis._x = ( x * ratioA + this._x * ratioB );\n\t\tthis._y = ( y * ratioA + this._y * ratioB );\n\t\tthis._z = ( z * ratioA + this._z * ratioB );\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( quaternion ) {\n\n\t\treturn ( quaternion._x === this._x ) && ( quaternion._y === this._y ) && ( quaternion._z === this._z ) && ( quaternion._w === this._w );\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tthis._x = array[ offset ];\n\t\tthis._y = array[ offset + 1 ];\n\t\tthis._z = array[ offset + 2 ];\n\t\tthis._w = array[ offset + 3 ];\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tarray[ offset ] = this._x;\n\t\tarray[ offset + 1 ] = this._y;\n\t\tarray[ offset + 2 ] = this._z;\n\t\tarray[ offset + 3 ] = this._w;\n\n\t\treturn array;\n\n\t},\n\n\tfromBufferAttribute: function ( attribute, index ) {\n\n\t\tthis._x = attribute.getX( index );\n\t\tthis._y = attribute.getY( index );\n\t\tthis._z = attribute.getZ( index );\n\t\tthis._w = attribute.getW( index );\n\n\t\treturn this;\n\n\t},\n\n\t_onChange: function ( callback ) {\n\n\t\tthis._onChangeCallback = callback;\n\n\t\treturn this;\n\n\t},\n\n\t_onChangeCallback: function () {}\n\n} );\n\n\nexport { Quaternion };\n","import { MathUtils } from './MathUtils.js';\nimport { Quaternion } from './Quaternion.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author kile / http://kile.stravaganza.org/\n * @author philogb / http://blog.thejit.org/\n * @author mikael emtinger / http://gomo.se/\n * @author egraether / http://egraether.com/\n * @author WestLangley / http://github.com/WestLangley\n */\n\nconst _vector = new Vector3();\nconst _quaternion = new Quaternion();\n\nfunction Vector3( x = 0, y = 0, z = 0 ) {\n\n\tthis.x = x;\n\tthis.y = y;\n\tthis.z = z;\n\n}\n\nObject.assign( Vector3.prototype, {\n\n\tisVector3: true,\n\n\tset: function ( x, y, z ) {\n\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\n\tsetScalar: function ( scalar ) {\n\n\t\tthis.x = scalar;\n\t\tthis.y = scalar;\n\t\tthis.z = scalar;\n\n\t\treturn this;\n\n\t},\n\n\tsetX: function ( x ) {\n\n\t\tthis.x = x;\n\n\t\treturn this;\n\n\t},\n\n\tsetY: function ( y ) {\n\n\t\tthis.y = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetZ: function ( z ) {\n\n\t\tthis.z = z;\n\n\t\treturn this;\n\n\t},\n\n\tsetComponent: function ( index, value ) {\n\n\t\tswitch ( index ) {\n\n\t\t\tcase 0: this.x = value; break;\n\t\t\tcase 1: this.y = value; break;\n\t\t\tcase 2: this.z = value; break;\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tgetComponent: function ( index ) {\n\n\t\tswitch ( index ) {\n\n\t\t\tcase 0: return this.x;\n\t\t\tcase 1: return this.y;\n\t\t\tcase 2: return this.z;\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\n\n\t\t}\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this.x, this.y, this.z );\n\n\t},\n\n\tcopy: function ( v ) {\n\n\t\tthis.x = v.x;\n\t\tthis.y = v.y;\n\t\tthis.z = v.z;\n\n\t\treturn this;\n\n\t},\n\n\tadd: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\n\t\t\treturn this.addVectors( v, w );\n\n\t\t}\n\n\t\tthis.x += v.x;\n\t\tthis.y += v.y;\n\t\tthis.z += v.z;\n\n\t\treturn this;\n\n\t},\n\n\taddScalar: function ( s ) {\n\n\t\tthis.x += s;\n\t\tthis.y += s;\n\t\tthis.z += s;\n\n\t\treturn this;\n\n\t},\n\n\taddVectors: function ( a, b ) {\n\n\t\tthis.x = a.x + b.x;\n\t\tthis.y = a.y + b.y;\n\t\tthis.z = a.z + b.z;\n\n\t\treturn this;\n\n\t},\n\n\taddScaledVector: function ( v, s ) {\n\n\t\tthis.x += v.x * s;\n\t\tthis.y += v.y * s;\n\t\tthis.z += v.z * s;\n\n\t\treturn this;\n\n\t},\n\n\tsub: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\n\t\t\treturn this.subVectors( v, w );\n\n\t\t}\n\n\t\tthis.x -= v.x;\n\t\tthis.y -= v.y;\n\t\tthis.z -= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tsubScalar: function ( s ) {\n\n\t\tthis.x -= s;\n\t\tthis.y -= s;\n\t\tthis.z -= s;\n\n\t\treturn this;\n\n\t},\n\n\tsubVectors: function ( a, b ) {\n\n\t\tthis.x = a.x - b.x;\n\t\tthis.y = a.y - b.y;\n\t\tthis.z = a.z - b.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.' );\n\t\t\treturn this.multiplyVectors( v, w );\n\n\t\t}\n\n\t\tthis.x *= v.x;\n\t\tthis.y *= v.y;\n\t\tthis.z *= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( scalar ) {\n\n\t\tthis.x *= scalar;\n\t\tthis.y *= scalar;\n\t\tthis.z *= scalar;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyVectors: function ( a, b ) {\n\n\t\tthis.x = a.x * b.x;\n\t\tthis.y = a.y * b.y;\n\t\tthis.z = a.z * b.z;\n\n\t\treturn this;\n\n\t},\n\n\tapplyEuler: function ( euler ) {\n\n\t\tif ( ! ( euler && euler.isEuler ) ) {\n\n\t\t\tconsole.error( 'THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.' );\n\n\t\t}\n\n\t\treturn this.applyQuaternion( _quaternion.setFromEuler( euler ) );\n\n\t},\n\n\tapplyAxisAngle: function ( axis, angle ) {\n\n\t\treturn this.applyQuaternion( _quaternion.setFromAxisAngle( axis, angle ) );\n\n\t},\n\n\tapplyMatrix3: function ( m ) {\n\n\t\tconst x = this.x, y = this.y, z = this.z;\n\t\tconst e = m.elements;\n\n\t\tthis.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ] * z;\n\t\tthis.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ] * z;\n\t\tthis.z = e[ 2 ] * x + e[ 5 ] * y + e[ 8 ] * z;\n\n\t\treturn this;\n\n\t},\n\n\tapplyNormalMatrix: function ( m ) {\n\n\t\treturn this.applyMatrix3( m ).normalize();\n\n\t},\n\n\tapplyMatrix4: function ( m ) {\n\n\t\tconst x = this.x, y = this.y, z = this.z;\n\t\tconst e = m.elements;\n\n\t\tconst w = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] );\n\n\t\tthis.x = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] ) * w;\n\t\tthis.y = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] ) * w;\n\t\tthis.z = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * w;\n\n\t\treturn this;\n\n\t},\n\n\tapplyQuaternion: function ( q ) {\n\n\t\tconst x = this.x, y = this.y, z = this.z;\n\t\tconst qx = q.x, qy = q.y, qz = q.z, qw = q.w;\n\n\t\t// calculate quat * vector\n\n\t\tconst ix = qw * x + qy * z - qz * y;\n\t\tconst iy = qw * y + qz * x - qx * z;\n\t\tconst iz = qw * z + qx * y - qy * x;\n\t\tconst iw = - qx * x - qy * y - qz * z;\n\n\t\t// calculate result * inverse quat\n\n\t\tthis.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;\n\t\tthis.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;\n\t\tthis.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;\n\n\t\treturn this;\n\n\t},\n\n\tproject: function ( camera ) {\n\n\t\treturn this.applyMatrix4( camera.matrixWorldInverse ).applyMatrix4( camera.projectionMatrix );\n\n\t},\n\n\tunproject: function ( camera ) {\n\n\t\treturn this.applyMatrix4( camera.projectionMatrixInverse ).applyMatrix4( camera.matrixWorld );\n\n\t},\n\n\ttransformDirection: function ( m ) {\n\n\t\t// input: THREE.Matrix4 affine matrix\n\t\t// vector interpreted as a direction\n\n\t\tconst x = this.x, y = this.y, z = this.z;\n\t\tconst e = m.elements;\n\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z;\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z;\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;\n\n\t\treturn this.normalize();\n\n\t},\n\n\tdivide: function ( v ) {\n\n\t\tthis.x /= v.x;\n\t\tthis.y /= v.y;\n\t\tthis.z /= v.z;\n\n\t\treturn this;\n\n\t},\n\n\tdivideScalar: function ( scalar ) {\n\n\t\treturn this.multiplyScalar( 1 / scalar );\n\n\t},\n\n\tmin: function ( v ) {\n\n\t\tthis.x = Math.min( this.x, v.x );\n\t\tthis.y = Math.min( this.y, v.y );\n\t\tthis.z = Math.min( this.z, v.z );\n\n\t\treturn this;\n\n\t},\n\n\tmax: function ( v ) {\n\n\t\tthis.x = Math.max( this.x, v.x );\n\t\tthis.y = Math.max( this.y, v.y );\n\t\tthis.z = Math.max( this.z, v.z );\n\n\t\treturn this;\n\n\t},\n\n\tclamp: function ( min, max ) {\n\n\t\t// assumes min < max, componentwise\n\n\t\tthis.x = Math.max( min.x, Math.min( max.x, this.x ) );\n\t\tthis.y = Math.max( min.y, Math.min( max.y, this.y ) );\n\t\tthis.z = Math.max( min.z, Math.min( max.z, this.z ) );\n\n\t\treturn this;\n\n\t},\n\n\tclampScalar: function ( minVal, maxVal ) {\n\n\t\tthis.x = Math.max( minVal, Math.min( maxVal, this.x ) );\n\t\tthis.y = Math.max( minVal, Math.min( maxVal, this.y ) );\n\t\tthis.z = Math.max( minVal, Math.min( maxVal, this.z ) );\n\n\t\treturn this;\n\n\t},\n\n\tclampLength: function ( min, max ) {\n\n\t\tconst length = this.length();\n\n\t\treturn this.divideScalar( length || 1 ).multiplyScalar( Math.max( min, Math.min( max, length ) ) );\n\n\t},\n\n\tfloor: function () {\n\n\t\tthis.x = Math.floor( this.x );\n\t\tthis.y = Math.floor( this.y );\n\t\tthis.z = Math.floor( this.z );\n\n\t\treturn this;\n\n\t},\n\n\tceil: function () {\n\n\t\tthis.x = Math.ceil( this.x );\n\t\tthis.y = Math.ceil( this.y );\n\t\tthis.z = Math.ceil( this.z );\n\n\t\treturn this;\n\n\t},\n\n\tround: function () {\n\n\t\tthis.x = Math.round( this.x );\n\t\tthis.y = Math.round( this.y );\n\t\tthis.z = Math.round( this.z );\n\n\t\treturn this;\n\n\t},\n\n\troundToZero: function () {\n\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\n\n\t\treturn this;\n\n\t},\n\n\tnegate: function () {\n\n\t\tthis.x = - this.x;\n\t\tthis.y = - this.y;\n\t\tthis.z = - this.z;\n\n\t\treturn this;\n\n\t},\n\n\tdot: function ( v ) {\n\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\n\n\t},\n\n\t// TODO lengthSquared?\n\n\tlengthSq: function () {\n\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\n\n\t},\n\n\tlength: function () {\n\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\n\n\t},\n\n\tmanhattanLength: function () {\n\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z );\n\n\t},\n\n\tnormalize: function () {\n\n\t\treturn this.divideScalar( this.length() || 1 );\n\n\t},\n\n\tsetLength: function ( length ) {\n\n\t\treturn this.normalize().multiplyScalar( length );\n\n\t},\n\n\tlerp: function ( v, alpha ) {\n\n\t\tthis.x += ( v.x - this.x ) * alpha;\n\t\tthis.y += ( v.y - this.y ) * alpha;\n\t\tthis.z += ( v.z - this.z ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tlerpVectors: function ( v1, v2, alpha ) {\n\n\t\tthis.x = v1.x + ( v2.x - v1.x ) * alpha;\n\t\tthis.y = v1.y + ( v2.y - v1.y ) * alpha;\n\t\tthis.z = v1.z + ( v2.z - v1.z ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tcross: function ( v, w ) {\n\n\t\tif ( w !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.' );\n\t\t\treturn this.crossVectors( v, w );\n\n\t\t}\n\n\t\treturn this.crossVectors( this, v );\n\n\t},\n\n\tcrossVectors: function ( a, b ) {\n\n\t\tconst ax = a.x, ay = a.y, az = a.z;\n\t\tconst bx = b.x, by = b.y, bz = b.z;\n\n\t\tthis.x = ay * bz - az * by;\n\t\tthis.y = az * bx - ax * bz;\n\t\tthis.z = ax * by - ay * bx;\n\n\t\treturn this;\n\n\t},\n\n\tprojectOnVector: function ( v ) {\n\n\t\tconst denominator = v.lengthSq();\n\n\t\tif ( denominator === 0 ) return this.set( 0, 0, 0 );\n\n\t\tconst scalar = v.dot( this ) / denominator;\n\n\t\treturn this.copy( v ).multiplyScalar( scalar );\n\n\t},\n\n\tprojectOnPlane: function ( planeNormal ) {\n\n\t\t_vector.copy( this ).projectOnVector( planeNormal );\n\n\t\treturn this.sub( _vector );\n\n\t},\n\n\treflect: function ( normal ) {\n\n\t\t// reflect incident vector off plane orthogonal to normal\n\t\t// normal is assumed to have unit length\n\n\t\treturn this.sub( _vector.copy( normal ).multiplyScalar( 2 * this.dot( normal ) ) );\n\n\t},\n\n\tangleTo: function ( v ) {\n\n\t\tconst denominator = Math.sqrt( this.lengthSq() * v.lengthSq() );\n\n\t\tif ( denominator === 0 ) return Math.PI / 2;\n\n\t\tconst theta = this.dot( v ) / denominator;\n\n\t\t// clamp, to handle numerical problems\n\n\t\treturn Math.acos( MathUtils.clamp( theta, - 1, 1 ) );\n\n\t},\n\n\tdistanceTo: function ( v ) {\n\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\n\n\t},\n\n\tdistanceToSquared: function ( v ) {\n\n\t\tconst dx = this.x - v.x, dy = this.y - v.y, dz = this.z - v.z;\n\n\t\treturn dx * dx + dy * dy + dz * dz;\n\n\t},\n\n\tmanhattanDistanceTo: function ( v ) {\n\n\t\treturn Math.abs( this.x - v.x ) + Math.abs( this.y - v.y ) + Math.abs( this.z - v.z );\n\n\t},\n\n\tsetFromSpherical: function ( s ) {\n\n\t\treturn this.setFromSphericalCoords( s.radius, s.phi, s.theta );\n\n\t},\n\n\tsetFromSphericalCoords: function ( radius, phi, theta ) {\n\n\t\tconst sinPhiRadius = Math.sin( phi ) * radius;\n\n\t\tthis.x = sinPhiRadius * Math.sin( theta );\n\t\tthis.y = Math.cos( phi ) * radius;\n\t\tthis.z = sinPhiRadius * Math.cos( theta );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromCylindrical: function ( c ) {\n\n\t\treturn this.setFromCylindricalCoords( c.radius, c.theta, c.y );\n\n\t},\n\n\tsetFromCylindricalCoords: function ( radius, theta, y ) {\n\n\t\tthis.x = radius * Math.sin( theta );\n\t\tthis.y = y;\n\t\tthis.z = radius * Math.cos( theta );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromMatrixPosition: function ( m ) {\n\n\t\tconst e = m.elements;\n\n\t\tthis.x = e[ 12 ];\n\t\tthis.y = e[ 13 ];\n\t\tthis.z = e[ 14 ];\n\n\t\treturn this;\n\n\t},\n\n\tsetFromMatrixScale: function ( m ) {\n\n\t\tconst sx = this.setFromMatrixColumn( m, 0 ).length();\n\t\tconst sy = this.setFromMatrixColumn( m, 1 ).length();\n\t\tconst sz = this.setFromMatrixColumn( m, 2 ).length();\n\n\t\tthis.x = sx;\n\t\tthis.y = sy;\n\t\tthis.z = sz;\n\n\t\treturn this;\n\n\t},\n\n\tsetFromMatrixColumn: function ( m, index ) {\n\n\t\treturn this.fromArray( m.elements, index * 4 );\n\n\t},\n\n\tsetFromMatrix3Column: function ( m, index ) {\n\n\t\treturn this.fromArray( m.elements, index * 3 );\n\n\t},\n\n\tequals: function ( v ) {\n\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tthis.x = array[ offset ];\n\t\tthis.y = array[ offset + 1 ];\n\t\tthis.z = array[ offset + 2 ];\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tarray[ offset ] = this.x;\n\t\tarray[ offset + 1 ] = this.y;\n\t\tarray[ offset + 2 ] = this.z;\n\n\t\treturn array;\n\n\t},\n\n\tfromBufferAttribute: function ( attribute, index, offset ) {\n\n\t\tif ( offset !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Vector3: offset has been removed from .fromBufferAttribute().' );\n\n\t\t}\n\n\t\tthis.x = attribute.getX( index );\n\t\tthis.y = attribute.getY( index );\n\t\tthis.z = attribute.getZ( index );\n\n\t\treturn this;\n\n\t},\n\n\trandom: function () {\n\n\t\tthis.x = Math.random();\n\t\tthis.y = Math.random();\n\t\tthis.z = Math.random();\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { Vector3 };\n","import { Vector3 } from './Vector3.js';\n\nconst _v1 = new Vector3();\nconst _m1 = new Matrix4();\nconst _zero = new Vector3( 0, 0, 0 );\nconst _one = new Vector3( 1, 1, 1 );\nconst _x = new Vector3();\nconst _y = new Vector3();\nconst _z = new Vector3();\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author supereggbert / http://www.paulbrunt.co.uk/\n * @author philogb / http://blog.thejit.org/\n * @author jordi_ros / http://plattsoft.com\n * @author D1plo1d / http://github.com/D1plo1d\n * @author alteredq / http://alteredqualia.com/\n * @author mikael emtinger / http://gomo.se/\n * @author timknip / http://www.floorplanner.com/\n * @author bhouston / http://clara.io\n * @author WestLangley / http://github.com/WestLangley\n */\n\nfunction Matrix4() {\n\n\tthis.elements = [\n\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1\n\n\t];\n\n\tif ( arguments.length > 0 ) {\n\n\t\tconsole.error( 'THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.' );\n\n\t}\n\n}\n\nObject.assign( Matrix4.prototype, {\n\n\tisMatrix4: true,\n\n\tset: function ( n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 ) {\n\n\t\tconst te = this.elements;\n\n\t\tte[ 0 ] = n11; te[ 4 ] = n12; te[ 8 ] = n13; te[ 12 ] = n14;\n\t\tte[ 1 ] = n21; te[ 5 ] = n22; te[ 9 ] = n23; te[ 13 ] = n24;\n\t\tte[ 2 ] = n31; te[ 6 ] = n32; te[ 10 ] = n33; te[ 14 ] = n34;\n\t\tte[ 3 ] = n41; te[ 7 ] = n42; te[ 11 ] = n43; te[ 15 ] = n44;\n\n\t\treturn this;\n\n\t},\n\n\tidentity: function () {\n\n\t\tthis.set(\n\n\t\t\t1, 0, 0, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new Matrix4().fromArray( this.elements );\n\n\t},\n\n\tcopy: function ( m ) {\n\n\t\tconst te = this.elements;\n\t\tconst me = m.elements;\n\n\t\tte[ 0 ] = me[ 0 ]; te[ 1 ] = me[ 1 ]; te[ 2 ] = me[ 2 ]; te[ 3 ] = me[ 3 ];\n\t\tte[ 4 ] = me[ 4 ]; te[ 5 ] = me[ 5 ]; te[ 6 ] = me[ 6 ]; te[ 7 ] = me[ 7 ];\n\t\tte[ 8 ] = me[ 8 ]; te[ 9 ] = me[ 9 ]; te[ 10 ] = me[ 10 ]; te[ 11 ] = me[ 11 ];\n\t\tte[ 12 ] = me[ 12 ]; te[ 13 ] = me[ 13 ]; te[ 14 ] = me[ 14 ]; te[ 15 ] = me[ 15 ];\n\n\t\treturn this;\n\n\t},\n\n\tcopyPosition: function ( m ) {\n\n\t\tconst te = this.elements, me = m.elements;\n\n\t\tte[ 12 ] = me[ 12 ];\n\t\tte[ 13 ] = me[ 13 ];\n\t\tte[ 14 ] = me[ 14 ];\n\n\t\treturn this;\n\n\t},\n\n\textractBasis: function ( xAxis, yAxis, zAxis ) {\n\n\t\txAxis.setFromMatrixColumn( this, 0 );\n\t\tyAxis.setFromMatrixColumn( this, 1 );\n\t\tzAxis.setFromMatrixColumn( this, 2 );\n\n\t\treturn this;\n\n\t},\n\n\tmakeBasis: function ( xAxis, yAxis, zAxis ) {\n\n\t\tthis.set(\n\t\t\txAxis.x, yAxis.x, zAxis.x, 0,\n\t\t\txAxis.y, yAxis.y, zAxis.y, 0,\n\t\t\txAxis.z, yAxis.z, zAxis.z, 0,\n\t\t\t0, 0, 0, 1\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\textractRotation: function ( m ) {\n\n\t\t// this method does not support reflection matrices\n\n\t\tconst te = this.elements;\n\t\tconst me = m.elements;\n\n\t\tconst scaleX = 1 / _v1.setFromMatrixColumn( m, 0 ).length();\n\t\tconst scaleY = 1 / _v1.setFromMatrixColumn( m, 1 ).length();\n\t\tconst scaleZ = 1 / _v1.setFromMatrixColumn( m, 2 ).length();\n\n\t\tte[ 0 ] = me[ 0 ] * scaleX;\n\t\tte[ 1 ] = me[ 1 ] * scaleX;\n\t\tte[ 2 ] = me[ 2 ] * scaleX;\n\t\tte[ 3 ] = 0;\n\n\t\tte[ 4 ] = me[ 4 ] * scaleY;\n\t\tte[ 5 ] = me[ 5 ] * scaleY;\n\t\tte[ 6 ] = me[ 6 ] * scaleY;\n\t\tte[ 7 ] = 0;\n\n\t\tte[ 8 ] = me[ 8 ] * scaleZ;\n\t\tte[ 9 ] = me[ 9 ] * scaleZ;\n\t\tte[ 10 ] = me[ 10 ] * scaleZ;\n\t\tte[ 11 ] = 0;\n\n\t\tte[ 12 ] = 0;\n\t\tte[ 13 ] = 0;\n\t\tte[ 14 ] = 0;\n\t\tte[ 15 ] = 1;\n\n\t\treturn this;\n\n\t},\n\n\tmakeRotationFromEuler: function ( euler ) {\n\n\t\tif ( ! ( euler && euler.isEuler ) ) {\n\n\t\t\tconsole.error( 'THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );\n\n\t\t}\n\n\t\tconst te = this.elements;\n\n\t\tconst x = euler.x, y = euler.y, z = euler.z;\n\t\tconst a = Math.cos( x ), b = Math.sin( x );\n\t\tconst c = Math.cos( y ), d = Math.sin( y );\n\t\tconst e = Math.cos( z ), f = Math.sin( z );\n\n\t\tif ( euler.order === 'XYZ' ) {\n\n\t\t\tconst ae = a * e, af = a * f, be = b * e, bf = b * f;\n\n\t\t\tte[ 0 ] = c * e;\n\t\t\tte[ 4 ] = - c * f;\n\t\t\tte[ 8 ] = d;\n\n\t\t\tte[ 1 ] = af + be * d;\n\t\t\tte[ 5 ] = ae - bf * d;\n\t\t\tte[ 9 ] = - b * c;\n\n\t\t\tte[ 2 ] = bf - ae * d;\n\t\t\tte[ 6 ] = be + af * d;\n\t\t\tte[ 10 ] = a * c;\n\n\t\t} else if ( euler.order === 'YXZ' ) {\n\n\t\t\tconst ce = c * e, cf = c * f, de = d * e, df = d * f;\n\n\t\t\tte[ 0 ] = ce + df * b;\n\t\t\tte[ 4 ] = de * b - cf;\n\t\t\tte[ 8 ] = a * d;\n\n\t\t\tte[ 1 ] = a * f;\n\t\t\tte[ 5 ] = a * e;\n\t\t\tte[ 9 ] = - b;\n\n\t\t\tte[ 2 ] = cf * b - de;\n\t\t\tte[ 6 ] = df + ce * b;\n\t\t\tte[ 10 ] = a * c;\n\n\t\t} else if ( euler.order === 'ZXY' ) {\n\n\t\t\tconst ce = c * e, cf = c * f, de = d * e, df = d * f;\n\n\t\t\tte[ 0 ] = ce - df * b;\n\t\t\tte[ 4 ] = - a * f;\n\t\t\tte[ 8 ] = de + cf * b;\n\n\t\t\tte[ 1 ] = cf + de * b;\n\t\t\tte[ 5 ] = a * e;\n\t\t\tte[ 9 ] = df - ce * b;\n\n\t\t\tte[ 2 ] = - a * d;\n\t\t\tte[ 6 ] = b;\n\t\t\tte[ 10 ] = a * c;\n\n\t\t} else if ( euler.order === 'ZYX' ) {\n\n\t\t\tconst ae = a * e, af = a * f, be = b * e, bf = b * f;\n\n\t\t\tte[ 0 ] = c * e;\n\t\t\tte[ 4 ] = be * d - af;\n\t\t\tte[ 8 ] = ae * d + bf;\n\n\t\t\tte[ 1 ] = c * f;\n\t\t\tte[ 5 ] = bf * d + ae;\n\t\t\tte[ 9 ] = af * d - be;\n\n\t\t\tte[ 2 ] = - d;\n\t\t\tte[ 6 ] = b * c;\n\t\t\tte[ 10 ] = a * c;\n\n\t\t} else if ( euler.order === 'YZX' ) {\n\n\t\t\tconst ac = a * c, ad = a * d, bc = b * c, bd = b * d;\n\n\t\t\tte[ 0 ] = c * e;\n\t\t\tte[ 4 ] = bd - ac * f;\n\t\t\tte[ 8 ] = bc * f + ad;\n\n\t\t\tte[ 1 ] = f;\n\t\t\tte[ 5 ] = a * e;\n\t\t\tte[ 9 ] = - b * e;\n\n\t\t\tte[ 2 ] = - d * e;\n\t\t\tte[ 6 ] = ad * f + bc;\n\t\t\tte[ 10 ] = ac - bd * f;\n\n\t\t} else if ( euler.order === 'XZY' ) {\n\n\t\t\tconst ac = a * c, ad = a * d, bc = b * c, bd = b * d;\n\n\t\t\tte[ 0 ] = c * e;\n\t\t\tte[ 4 ] = - f;\n\t\t\tte[ 8 ] = d * e;\n\n\t\t\tte[ 1 ] = ac * f + bd;\n\t\t\tte[ 5 ] = a * e;\n\t\t\tte[ 9 ] = ad * f - bc;\n\n\t\t\tte[ 2 ] = bc * f - ad;\n\t\t\tte[ 6 ] = b * e;\n\t\t\tte[ 10 ] = bd * f + ac;\n\n\t\t}\n\n\t\t// bottom row\n\t\tte[ 3 ] = 0;\n\t\tte[ 7 ] = 0;\n\t\tte[ 11 ] = 0;\n\n\t\t// last column\n\t\tte[ 12 ] = 0;\n\t\tte[ 13 ] = 0;\n\t\tte[ 14 ] = 0;\n\t\tte[ 15 ] = 1;\n\n\t\treturn this;\n\n\t},\n\n\tmakeRotationFromQuaternion: function ( q ) {\n\n\t\treturn this.compose( _zero, q, _one );\n\n\t},\n\n\tlookAt: function ( eye, target, up ) {\n\n\t\tconst te = this.elements;\n\n\t\t_z.subVectors( eye, target );\n\n\t\tif ( _z.lengthSq() === 0 ) {\n\n\t\t\t// eye and target are in the same position\n\n\t\t\t_z.z = 1;\n\n\t\t}\n\n\t\t_z.normalize();\n\t\t_x.crossVectors( up, _z );\n\n\t\tif ( _x.lengthSq() === 0 ) {\n\n\t\t\t// up and z are parallel\n\n\t\t\tif ( Math.abs( up.z ) === 1 ) {\n\n\t\t\t\t_z.x += 0.0001;\n\n\t\t\t} else {\n\n\t\t\t\t_z.z += 0.0001;\n\n\t\t\t}\n\n\t\t\t_z.normalize();\n\t\t\t_x.crossVectors( up, _z );\n\n\t\t}\n\n\t\t_x.normalize();\n\t\t_y.crossVectors( _z, _x );\n\n\t\tte[ 0 ] = _x.x; te[ 4 ] = _y.x; te[ 8 ] = _z.x;\n\t\tte[ 1 ] = _x.y; te[ 5 ] = _y.y; te[ 9 ] = _z.y;\n\t\tte[ 2 ] = _x.z; te[ 6 ] = _y.z; te[ 10 ] = _z.z;\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( m, n ) {\n\n\t\tif ( n !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.' );\n\t\t\treturn this.multiplyMatrices( m, n );\n\n\t\t}\n\n\t\treturn this.multiplyMatrices( this, m );\n\n\t},\n\n\tpremultiply: function ( m ) {\n\n\t\treturn this.multiplyMatrices( m, this );\n\n\t},\n\n\tmultiplyMatrices: function ( a, b ) {\n\n\t\tconst ae = a.elements;\n\t\tconst be = b.elements;\n\t\tconst te = this.elements;\n\n\t\tconst a11 = ae[ 0 ], a12 = ae[ 4 ], a13 = ae[ 8 ], a14 = ae[ 12 ];\n\t\tconst a21 = ae[ 1 ], a22 = ae[ 5 ], a23 = ae[ 9 ], a24 = ae[ 13 ];\n\t\tconst a31 = ae[ 2 ], a32 = ae[ 6 ], a33 = ae[ 10 ], a34 = ae[ 14 ];\n\t\tconst a41 = ae[ 3 ], a42 = ae[ 7 ], a43 = ae[ 11 ], a44 = ae[ 15 ];\n\n\t\tconst b11 = be[ 0 ], b12 = be[ 4 ], b13 = be[ 8 ], b14 = be[ 12 ];\n\t\tconst b21 = be[ 1 ], b22 = be[ 5 ], b23 = be[ 9 ], b24 = be[ 13 ];\n\t\tconst b31 = be[ 2 ], b32 = be[ 6 ], b33 = be[ 10 ], b34 = be[ 14 ];\n\t\tconst b41 = be[ 3 ], b42 = be[ 7 ], b43 = be[ 11 ], b44 = be[ 15 ];\n\n\t\tte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\n\t\tte[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\n\t\tte[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\n\t\tte[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\n\n\t\tte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\n\t\tte[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\n\t\tte[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\n\t\tte[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\n\n\t\tte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\n\t\tte[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\n\t\tte[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\n\t\tte[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\n\n\t\tte[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\n\t\tte[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\n\t\tte[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\n\t\tte[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( s ) {\n\n\t\tconst te = this.elements;\n\n\t\tte[ 0 ] *= s; te[ 4 ] *= s; te[ 8 ] *= s; te[ 12 ] *= s;\n\t\tte[ 1 ] *= s; te[ 5 ] *= s; te[ 9 ] *= s; te[ 13 ] *= s;\n\t\tte[ 2 ] *= s; te[ 6 ] *= s; te[ 10 ] *= s; te[ 14 ] *= s;\n\t\tte[ 3 ] *= s; te[ 7 ] *= s; te[ 11 ] *= s; te[ 15 ] *= s;\n\n\t\treturn this;\n\n\t},\n\n\tdeterminant: function () {\n\n\t\tconst te = this.elements;\n\n\t\tconst n11 = te[ 0 ], n12 = te[ 4 ], n13 = te[ 8 ], n14 = te[ 12 ];\n\t\tconst n21 = te[ 1 ], n22 = te[ 5 ], n23 = te[ 9 ], n24 = te[ 13 ];\n\t\tconst n31 = te[ 2 ], n32 = te[ 6 ], n33 = te[ 10 ], n34 = te[ 14 ];\n\t\tconst n41 = te[ 3 ], n42 = te[ 7 ], n43 = te[ 11 ], n44 = te[ 15 ];\n\n\t\t//TODO: make this more efficient\n\t\t//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\n\n\t\treturn (\n\t\t\tn41 * (\n\t\t\t\t+ n14 * n23 * n32\n\t\t\t\t - n13 * n24 * n32\n\t\t\t\t - n14 * n22 * n33\n\t\t\t\t + n12 * n24 * n33\n\t\t\t\t + n13 * n22 * n34\n\t\t\t\t - n12 * n23 * n34\n\t\t\t) +\n\t\t\tn42 * (\n\t\t\t\t+ n11 * n23 * n34\n\t\t\t\t - n11 * n24 * n33\n\t\t\t\t + n14 * n21 * n33\n\t\t\t\t - n13 * n21 * n34\n\t\t\t\t + n13 * n24 * n31\n\t\t\t\t - n14 * n23 * n31\n\t\t\t) +\n\t\t\tn43 * (\n\t\t\t\t+ n11 * n24 * n32\n\t\t\t\t - n11 * n22 * n34\n\t\t\t\t - n14 * n21 * n32\n\t\t\t\t + n12 * n21 * n34\n\t\t\t\t + n14 * n22 * n31\n\t\t\t\t - n12 * n24 * n31\n\t\t\t) +\n\t\t\tn44 * (\n\t\t\t\t- n13 * n22 * n31\n\t\t\t\t - n11 * n23 * n32\n\t\t\t\t + n11 * n22 * n33\n\t\t\t\t + n13 * n21 * n32\n\t\t\t\t - n12 * n21 * n33\n\t\t\t\t + n12 * n23 * n31\n\t\t\t)\n\n\t\t);\n\n\t},\n\n\ttranspose: function () {\n\n\t\tconst te = this.elements;\n\t\tlet tmp;\n\n\t\ttmp = te[ 1 ]; te[ 1 ] = te[ 4 ]; te[ 4 ] = tmp;\n\t\ttmp = te[ 2 ]; te[ 2 ] = te[ 8 ]; te[ 8 ] = tmp;\n\t\ttmp = te[ 6 ]; te[ 6 ] = te[ 9 ]; te[ 9 ] = tmp;\n\n\t\ttmp = te[ 3 ]; te[ 3 ] = te[ 12 ]; te[ 12 ] = tmp;\n\t\ttmp = te[ 7 ]; te[ 7 ] = te[ 13 ]; te[ 13 ] = tmp;\n\t\ttmp = te[ 11 ]; te[ 11 ] = te[ 14 ]; te[ 14 ] = tmp;\n\n\t\treturn this;\n\n\t},\n\n\tsetPosition: function ( x, y, z ) {\n\n\t\tconst te = this.elements;\n\n\t\tif ( x.isVector3 ) {\n\n\t\t\tte[ 12 ] = x.x;\n\t\t\tte[ 13 ] = x.y;\n\t\t\tte[ 14 ] = x.z;\n\n\t\t} else {\n\n\t\t\tte[ 12 ] = x;\n\t\t\tte[ 13 ] = y;\n\t\t\tte[ 14 ] = z;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tgetInverse: function ( m, throwOnDegenerate ) {\n\n\t\tif ( throwOnDegenerate !== undefined ) {\n\n\t\t\tconsole.warn( \"THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.\" );\n\n\t\t}\n\n\t\t// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\n\t\tconst te = this.elements,\n\t\t\tme = m.elements,\n\n\t\t\tn11 = me[ 0 ], n21 = me[ 1 ], n31 = me[ 2 ], n41 = me[ 3 ],\n\t\t\tn12 = me[ 4 ], n22 = me[ 5 ], n32 = me[ 6 ], n42 = me[ 7 ],\n\t\t\tn13 = me[ 8 ], n23 = me[ 9 ], n33 = me[ 10 ], n43 = me[ 11 ],\n\t\t\tn14 = me[ 12 ], n24 = me[ 13 ], n34 = me[ 14 ], n44 = me[ 15 ],\n\n\t\t\tt11 = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44,\n\t\t\tt12 = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44,\n\t\t\tt13 = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44,\n\t\t\tt14 = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\n\n\t\tconst det = n11 * t11 + n21 * t12 + n31 * t13 + n41 * t14;\n\n\t\tif ( det === 0 ) return this.set( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 );\n\n\t\tconst detInv = 1 / det;\n\n\t\tte[ 0 ] = t11 * detInv;\n\t\tte[ 1 ] = ( n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44 ) * detInv;\n\t\tte[ 2 ] = ( n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44 ) * detInv;\n\t\tte[ 3 ] = ( n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43 ) * detInv;\n\n\t\tte[ 4 ] = t12 * detInv;\n\t\tte[ 5 ] = ( n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44 ) * detInv;\n\t\tte[ 6 ] = ( n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44 ) * detInv;\n\t\tte[ 7 ] = ( n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43 ) * detInv;\n\n\t\tte[ 8 ] = t13 * detInv;\n\t\tte[ 9 ] = ( n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44 ) * detInv;\n\t\tte[ 10 ] = ( n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44 ) * detInv;\n\t\tte[ 11 ] = ( n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43 ) * detInv;\n\n\t\tte[ 12 ] = t14 * detInv;\n\t\tte[ 13 ] = ( n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34 ) * detInv;\n\t\tte[ 14 ] = ( n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34 ) * detInv;\n\t\tte[ 15 ] = ( n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33 ) * detInv;\n\n\t\treturn this;\n\n\t},\n\n\tscale: function ( v ) {\n\n\t\tconst te = this.elements;\n\t\tconst x = v.x, y = v.y, z = v.z;\n\n\t\tte[ 0 ] *= x; te[ 4 ] *= y; te[ 8 ] *= z;\n\t\tte[ 1 ] *= x; te[ 5 ] *= y; te[ 9 ] *= z;\n\t\tte[ 2 ] *= x; te[ 6 ] *= y; te[ 10 ] *= z;\n\t\tte[ 3 ] *= x; te[ 7 ] *= y; te[ 11 ] *= z;\n\n\t\treturn this;\n\n\t},\n\n\tgetMaxScaleOnAxis: function () {\n\n\t\tconst te = this.elements;\n\n\t\tconst scaleXSq = te[ 0 ] * te[ 0 ] + te[ 1 ] * te[ 1 ] + te[ 2 ] * te[ 2 ];\n\t\tconst scaleYSq = te[ 4 ] * te[ 4 ] + te[ 5 ] * te[ 5 ] + te[ 6 ] * te[ 6 ];\n\t\tconst scaleZSq = te[ 8 ] * te[ 8 ] + te[ 9 ] * te[ 9 ] + te[ 10 ] * te[ 10 ];\n\n\t\treturn Math.sqrt( Math.max( scaleXSq, scaleYSq, scaleZSq ) );\n\n\t},\n\n\tmakeTranslation: function ( x, y, z ) {\n\n\t\tthis.set(\n\n\t\t\t1, 0, 0, x,\n\t\t\t0, 1, 0, y,\n\t\t\t0, 0, 1, z,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tmakeRotationX: function ( theta ) {\n\n\t\tconst c = Math.cos( theta ), s = Math.sin( theta );\n\n\t\tthis.set(\n\n\t\t\t1, 0, 0, 0,\n\t\t\t0, c, - s, 0,\n\t\t\t0, s, c, 0,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tmakeRotationY: function ( theta ) {\n\n\t\tconst c = Math.cos( theta ), s = Math.sin( theta );\n\n\t\tthis.set(\n\n\t\t\t c, 0, s, 0,\n\t\t\t 0, 1, 0, 0,\n\t\t\t- s, 0, c, 0,\n\t\t\t 0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tmakeRotationZ: function ( theta ) {\n\n\t\tconst c = Math.cos( theta ), s = Math.sin( theta );\n\n\t\tthis.set(\n\n\t\t\tc, - s, 0, 0,\n\t\t\ts, c, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tmakeRotationAxis: function ( axis, angle ) {\n\n\t\t// Based on http://www.gamedev.net/reference/articles/article1199.asp\n\n\t\tconst c = Math.cos( angle );\n\t\tconst s = Math.sin( angle );\n\t\tconst t = 1 - c;\n\t\tconst x = axis.x, y = axis.y, z = axis.z;\n\t\tconst tx = t * x, ty = t * y;\n\n\t\tthis.set(\n\n\t\t\ttx * x + c, tx * y - s * z, tx * z + s * y, 0,\n\t\t\ttx * y + s * z, ty * y + c, ty * z - s * x, 0,\n\t\t\ttx * z - s * y, ty * z + s * x, t * z * z + c, 0,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\t return this;\n\n\t},\n\n\tmakeScale: function ( x, y, z ) {\n\n\t\tthis.set(\n\n\t\t\tx, 0, 0, 0,\n\t\t\t0, y, 0, 0,\n\t\t\t0, 0, z, 0,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tmakeShear: function ( x, y, z ) {\n\n\t\tthis.set(\n\n\t\t\t1, y, z, 0,\n\t\t\tx, 1, z, 0,\n\t\t\tx, y, 1, 0,\n\t\t\t0, 0, 0, 1\n\n\t\t);\n\n\t\treturn this;\n\n\t},\n\n\tcompose: function ( position, quaternion, scale ) {\n\n\t\tconst te = this.elements;\n\n\t\tconst x = quaternion._x, y = quaternion._y, z = quaternion._z, w = quaternion._w;\n\t\tconst x2 = x + x,\ty2 = y + y, z2 = z + z;\n\t\tconst xx = x * x2, xy = x * y2, xz = x * z2;\n\t\tconst yy = y * y2, yz = y * z2, zz = z * z2;\n\t\tconst wx = w * x2, wy = w * y2, wz = w * z2;\n\n\t\tconst sx = scale.x, sy = scale.y, sz = scale.z;\n\n\t\tte[ 0 ] = ( 1 - ( yy + zz ) ) * sx;\n\t\tte[ 1 ] = ( xy + wz ) * sx;\n\t\tte[ 2 ] = ( xz - wy ) * sx;\n\t\tte[ 3 ] = 0;\n\n\t\tte[ 4 ] = ( xy - wz ) * sy;\n\t\tte[ 5 ] = ( 1 - ( xx + zz ) ) * sy;\n\t\tte[ 6 ] = ( yz + wx ) * sy;\n\t\tte[ 7 ] = 0;\n\n\t\tte[ 8 ] = ( xz + wy ) * sz;\n\t\tte[ 9 ] = ( yz - wx ) * sz;\n\t\tte[ 10 ] = ( 1 - ( xx + yy ) ) * sz;\n\t\tte[ 11 ] = 0;\n\n\t\tte[ 12 ] = position.x;\n\t\tte[ 13 ] = position.y;\n\t\tte[ 14 ] = position.z;\n\t\tte[ 15 ] = 1;\n\n\t\treturn this;\n\n\t},\n\n\tdecompose: function ( position, quaternion, scale ) {\n\n\t\tconst te = this.elements;\n\n\t\tlet sx = _v1.set( te[ 0 ], te[ 1 ], te[ 2 ] ).length();\n\t\tlet sy = _v1.set( te[ 4 ], te[ 5 ], te[ 6 ] ).length();\n\t\tlet sz = _v1.set( te[ 8 ], te[ 9 ], te[ 10 ] ).length();\n\n\t\t// if determine is negative, we need to invert one scale\n\t\tconst det = this.determinant();\n\t\tif ( det < 0 ) sx = - sx;\n\n\t\tposition.x = te[ 12 ];\n\t\tposition.y = te[ 13 ];\n\t\tposition.z = te[ 14 ];\n\n\t\t// scale the rotation part\n\t\t_m1.copy( this );\n\n\t\tconst invSX = 1 / sx;\n\t\tconst invSY = 1 / sy;\n\t\tconst invSZ = 1 / sz;\n\n\t\t_m1.elements[ 0 ] *= invSX;\n\t\t_m1.elements[ 1 ] *= invSX;\n\t\t_m1.elements[ 2 ] *= invSX;\n\n\t\t_m1.elements[ 4 ] *= invSY;\n\t\t_m1.elements[ 5 ] *= invSY;\n\t\t_m1.elements[ 6 ] *= invSY;\n\n\t\t_m1.elements[ 8 ] *= invSZ;\n\t\t_m1.elements[ 9 ] *= invSZ;\n\t\t_m1.elements[ 10 ] *= invSZ;\n\n\t\tquaternion.setFromRotationMatrix( _m1 );\n\n\t\tscale.x = sx;\n\t\tscale.y = sy;\n\t\tscale.z = sz;\n\n\t\treturn this;\n\n\t},\n\n\tmakePerspective: function ( left, right, top, bottom, near, far ) {\n\n\t\tif ( far === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.' );\n\n\t\t}\n\n\t\tconst te = this.elements;\n\t\tconst x = 2 * near / ( right - left );\n\t\tconst y = 2 * near / ( top - bottom );\n\n\t\tconst a = ( right + left ) / ( right - left );\n\t\tconst b = ( top + bottom ) / ( top - bottom );\n\t\tconst c = - ( far + near ) / ( far - near );\n\t\tconst d = - 2 * far * near / ( far - near );\n\n\t\tte[ 0 ] = x;\tte[ 4 ] = 0;\tte[ 8 ] = a;\tte[ 12 ] = 0;\n\t\tte[ 1 ] = 0;\tte[ 5 ] = y;\tte[ 9 ] = b;\tte[ 13 ] = 0;\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = c;\tte[ 14 ] = d;\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = - 1;\tte[ 15 ] = 0;\n\n\t\treturn this;\n\n\t},\n\n\tmakeOrthographic: function ( left, right, top, bottom, near, far ) {\n\n\t\tconst te = this.elements;\n\t\tconst w = 1.0 / ( right - left );\n\t\tconst h = 1.0 / ( top - bottom );\n\t\tconst p = 1.0 / ( far - near );\n\n\t\tconst x = ( right + left ) * w;\n\t\tconst y = ( top + bottom ) * h;\n\t\tconst z = ( far + near ) * p;\n\n\t\tte[ 0 ] = 2 * w;\tte[ 4 ] = 0;\tte[ 8 ] = 0;\tte[ 12 ] = - x;\n\t\tte[ 1 ] = 0;\tte[ 5 ] = 2 * h;\tte[ 9 ] = 0;\tte[ 13 ] = - y;\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = - 2 * p;\tte[ 14 ] = - z;\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = 0;\tte[ 15 ] = 1;\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( matrix ) {\n\n\t\tconst te = this.elements;\n\t\tconst me = matrix.elements;\n\n\t\tfor ( let i = 0; i < 16; i ++ ) {\n\n\t\t\tif ( te[ i ] !== me[ i ] ) return false;\n\n\t\t}\n\n\t\treturn true;\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tfor ( let i = 0; i < 16; i ++ ) {\n\n\t\t\tthis.elements[ i ] = array[ i + offset ];\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tconst te = this.elements;\n\n\t\tarray[ offset ] = te[ 0 ];\n\t\tarray[ offset + 1 ] = te[ 1 ];\n\t\tarray[ offset + 2 ] = te[ 2 ];\n\t\tarray[ offset + 3 ] = te[ 3 ];\n\n\t\tarray[ offset + 4 ] = te[ 4 ];\n\t\tarray[ offset + 5 ] = te[ 5 ];\n\t\tarray[ offset + 6 ] = te[ 6 ];\n\t\tarray[ offset + 7 ] = te[ 7 ];\n\n\t\tarray[ offset + 8 ] = te[ 8 ];\n\t\tarray[ offset + 9 ] = te[ 9 ];\n\t\tarray[ offset + 10 ] = te[ 10 ];\n\t\tarray[ offset + 11 ] = te[ 11 ];\n\n\t\tarray[ offset + 12 ] = te[ 12 ];\n\t\tarray[ offset + 13 ] = te[ 13 ];\n\t\tarray[ offset + 14 ] = te[ 14 ];\n\t\tarray[ offset + 15 ] = te[ 15 ];\n\n\t\treturn array;\n\n\t}\n\n} );\n\n\nexport { Matrix4 };\n","import { Quaternion } from './Quaternion.js';\nimport { Vector3 } from './Vector3.js';\nimport { Matrix4 } from './Matrix4.js';\nimport { MathUtils } from './MathUtils.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author bhouston / http://clara.io\n */\n\nconst _matrix = new Matrix4();\nconst _quaternion = new Quaternion();\n\nfunction Euler( x = 0, y = 0, z = 0, order = Euler.DefaultOrder ) {\n\n\tthis._x = x;\n\tthis._y = y;\n\tthis._z = z;\n\tthis._order = order;\n\n}\n\nEuler.RotationOrders = [ 'XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX' ];\n\nEuler.DefaultOrder = 'XYZ';\n\nObject.defineProperties( Euler.prototype, {\n\n\tx: {\n\n\t\tget: function () {\n\n\t\t\treturn this._x;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._x = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t},\n\n\ty: {\n\n\t\tget: function () {\n\n\t\t\treturn this._y;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._y = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t},\n\n\tz: {\n\n\t\tget: function () {\n\n\t\t\treturn this._z;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._z = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t},\n\n\torder: {\n\n\t\tget: function () {\n\n\t\t\treturn this._order;\n\n\t\t},\n\n\t\tset: function ( value ) {\n\n\t\t\tthis._order = value;\n\t\t\tthis._onChangeCallback();\n\n\t\t}\n\n\t}\n\n} );\n\nObject.assign( Euler.prototype, {\n\n\tisEuler: true,\n\n\tset: function ( x, y, z, order ) {\n\n\t\tthis._x = x;\n\t\tthis._y = y;\n\t\tthis._z = z;\n\t\tthis._order = order || this._order;\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this._x, this._y, this._z, this._order );\n\n\t},\n\n\tcopy: function ( euler ) {\n\n\t\tthis._x = euler._x;\n\t\tthis._y = euler._y;\n\t\tthis._z = euler._z;\n\t\tthis._order = euler._order;\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tsetFromRotationMatrix: function ( m, order, update ) {\n\n\t\tconst clamp = MathUtils.clamp;\n\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\n\t\tconst te = m.elements;\n\t\tconst m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ];\n\t\tconst m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ];\n\t\tconst m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\n\n\t\torder = order || this._order;\n\n\t\tswitch ( order ) {\n\n\t\t\tcase 'XYZ':\n\n\t\t\t\tthis._y = Math.asin( clamp( m13, - 1, 1 ) );\n\n\t\t\t\tif ( Math.abs( m13 ) < 0.9999999 ) {\n\n\t\t\t\t\tthis._x = Math.atan2( - m23, m33 );\n\t\t\t\t\tthis._z = Math.atan2( - m12, m11 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._x = Math.atan2( m32, m22 );\n\t\t\t\t\tthis._z = 0;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'YXZ':\n\n\t\t\t\tthis._x = Math.asin( - clamp( m23, - 1, 1 ) );\n\n\t\t\t\tif ( Math.abs( m23 ) < 0.9999999 ) {\n\n\t\t\t\t\tthis._y = Math.atan2( m13, m33 );\n\t\t\t\t\tthis._z = Math.atan2( m21, m22 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._y = Math.atan2( - m31, m11 );\n\t\t\t\t\tthis._z = 0;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZXY':\n\n\t\t\t\tthis._x = Math.asin( clamp( m32, - 1, 1 ) );\n\n\t\t\t\tif ( Math.abs( m32 ) < 0.9999999 ) {\n\n\t\t\t\t\tthis._y = Math.atan2( - m31, m33 );\n\t\t\t\t\tthis._z = Math.atan2( - m12, m22 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._y = 0;\n\t\t\t\t\tthis._z = Math.atan2( m21, m11 );\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'ZYX':\n\n\t\t\t\tthis._y = Math.asin( - clamp( m31, - 1, 1 ) );\n\n\t\t\t\tif ( Math.abs( m31 ) < 0.9999999 ) {\n\n\t\t\t\t\tthis._x = Math.atan2( m32, m33 );\n\t\t\t\t\tthis._z = Math.atan2( m21, m11 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._x = 0;\n\t\t\t\t\tthis._z = Math.atan2( - m12, m22 );\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'YZX':\n\n\t\t\t\tthis._z = Math.asin( clamp( m21, - 1, 1 ) );\n\n\t\t\t\tif ( Math.abs( m21 ) < 0.9999999 ) {\n\n\t\t\t\t\tthis._x = Math.atan2( - m23, m22 );\n\t\t\t\t\tthis._y = Math.atan2( - m31, m11 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._x = 0;\n\t\t\t\t\tthis._y = Math.atan2( m13, m33 );\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'XZY':\n\n\t\t\t\tthis._z = Math.asin( - clamp( m12, - 1, 1 ) );\n\n\t\t\t\tif ( Math.abs( m12 ) < 0.9999999 ) {\n\n\t\t\t\t\tthis._x = Math.atan2( m32, m22 );\n\t\t\t\t\tthis._y = Math.atan2( m13, m11 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._x = Math.atan2( - m23, m33 );\n\t\t\t\t\tthis._y = 0;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tconsole.warn( 'THREE.Euler: .setFromRotationMatrix() encountered an unknown order: ' + order );\n\n\t\t}\n\n\t\tthis._order = order;\n\n\t\tif ( update !== false ) this._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\tsetFromQuaternion: function ( q, order, update ) {\n\n\t\t_matrix.makeRotationFromQuaternion( q );\n\n\t\treturn this.setFromRotationMatrix( _matrix, order, update );\n\n\t},\n\n\tsetFromVector3: function ( v, order ) {\n\n\t\treturn this.set( v.x, v.y, v.z, order || this._order );\n\n\t},\n\n\treorder: function ( newOrder ) {\n\n\t\t// WARNING: this discards revolution information -bhouston\n\n\t\t_quaternion.setFromEuler( this );\n\n\t\treturn this.setFromQuaternion( _quaternion, newOrder );\n\n\t},\n\n\tequals: function ( euler ) {\n\n\t\treturn ( euler._x === this._x ) && ( euler._y === this._y ) && ( euler._z === this._z ) && ( euler._order === this._order );\n\n\t},\n\n\tfromArray: function ( array ) {\n\n\t\tthis._x = array[ 0 ];\n\t\tthis._y = array[ 1 ];\n\t\tthis._z = array[ 2 ];\n\t\tif ( array[ 3 ] !== undefined ) this._order = array[ 3 ];\n\n\t\tthis._onChangeCallback();\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tarray[ offset ] = this._x;\n\t\tarray[ offset + 1 ] = this._y;\n\t\tarray[ offset + 2 ] = this._z;\n\t\tarray[ offset + 3 ] = this._order;\n\n\t\treturn array;\n\n\t},\n\n\ttoVector3: function ( optionalResult ) {\n\n\t\tif ( optionalResult ) {\n\n\t\t\treturn optionalResult.set( this._x, this._y, this._z );\n\n\t\t} else {\n\n\t\t\treturn new Vector3( this._x, this._y, this._z );\n\n\t\t}\n\n\t},\n\n\t_onChange: function ( callback ) {\n\n\t\tthis._onChangeCallback = callback;\n\n\t\treturn this;\n\n\t},\n\n\t_onChangeCallback: function () {}\n\n} );\n\n\nexport { Euler };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction Layers() {\n\n\tthis.mask = 1 | 0;\n\n}\n\nObject.assign( Layers.prototype, {\n\n\tset: function ( channel ) {\n\n\t\tthis.mask = 1 << channel | 0;\n\n\t},\n\n\tenable: function ( channel ) {\n\n\t\tthis.mask |= 1 << channel | 0;\n\n\t},\n\n\tenableAll: function () {\n\n\t\tthis.mask = 0xffffffff | 0;\n\n\t},\n\n\ttoggle: function ( channel ) {\n\n\t\tthis.mask ^= 1 << channel | 0;\n\n\t},\n\n\tdisable: function ( channel ) {\n\n\t\tthis.mask &= ~ ( 1 << channel | 0 );\n\n\t},\n\n\tdisableAll: function () {\n\n\t\tthis.mask = 0;\n\n\t},\n\n\ttest: function ( layers ) {\n\n\t\treturn ( this.mask & layers.mask ) !== 0;\n\n\t}\n\n} );\n\n\nexport { Layers };\n","import { Quaternion } from '../math/Quaternion.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { EventDispatcher } from './EventDispatcher.js';\nimport { Euler } from '../math/Euler.js';\nimport { Layers } from './Layers.js';\nimport { Matrix3 } from '../math/Matrix3.js';\nimport { MathUtils } from '../math/MathUtils.js';\n\nlet _object3DId = 0;\n\nconst _v1 = new Vector3();\nconst _q1 = new Quaternion();\nconst _m1 = new Matrix4();\nconst _target = new Vector3();\n\nconst _position = new Vector3();\nconst _scale = new Vector3();\nconst _quaternion = new Quaternion();\n\nconst _xAxis = new Vector3( 1, 0, 0 );\nconst _yAxis = new Vector3( 0, 1, 0 );\nconst _zAxis = new Vector3( 0, 0, 1 );\n\nconst _addedEvent = { type: 'added' };\nconst _removedEvent = { type: 'removed' };\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author mikael emtinger / http://gomo.se/\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author elephantatwork / www.elephantatwork.ch\n */\n\nfunction Object3D() {\n\n\tObject.defineProperty( this, 'id', { value: _object3DId ++ } );\n\n\tthis.uuid = MathUtils.generateUUID();\n\n\tthis.name = '';\n\tthis.type = 'Object3D';\n\n\tthis.parent = null;\n\tthis.children = [];\n\n\tthis.up = Object3D.DefaultUp.clone();\n\n\tconst position = new Vector3();\n\tconst rotation = new Euler();\n\tconst quaternion = new Quaternion();\n\tconst scale = new Vector3( 1, 1, 1 );\n\n\tfunction onRotationChange() {\n\n\t\tquaternion.setFromEuler( rotation, false );\n\n\t}\n\n\tfunction onQuaternionChange() {\n\n\t\trotation.setFromQuaternion( quaternion, undefined, false );\n\n\t}\n\n\trotation._onChange( onRotationChange );\n\tquaternion._onChange( onQuaternionChange );\n\n\tObject.defineProperties( this, {\n\t\tposition: {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t\tvalue: position\n\t\t},\n\t\trotation: {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t\tvalue: rotation\n\t\t},\n\t\tquaternion: {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t\tvalue: quaternion\n\t\t},\n\t\tscale: {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t\tvalue: scale\n\t\t},\n\t\tmodelViewMatrix: {\n\t\t\tvalue: new Matrix4()\n\t\t},\n\t\tnormalMatrix: {\n\t\t\tvalue: new Matrix3()\n\t\t}\n\t} );\n\n\tthis.matrix = new Matrix4();\n\tthis.matrixWorld = new Matrix4();\n\n\tthis.matrixAutoUpdate = Object3D.DefaultMatrixAutoUpdate;\n\tthis.matrixWorldNeedsUpdate = false;\n\n\tthis.layers = new Layers();\n\tthis.visible = true;\n\n\tthis.castShadow = false;\n\tthis.receiveShadow = false;\n\n\tthis.frustumCulled = true;\n\tthis.renderOrder = 0;\n\n\tthis.userData = {};\n\n}\n\nObject3D.DefaultUp = new Vector3( 0, 1, 0 );\nObject3D.DefaultMatrixAutoUpdate = true;\n\nObject3D.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n\tconstructor: Object3D,\n\n\tisObject3D: true,\n\n\tonBeforeRender: function () {},\n\tonAfterRender: function () {},\n\n\tapplyMatrix4: function ( matrix ) {\n\n\t\tif ( this.matrixAutoUpdate ) this.updateMatrix();\n\n\t\tthis.matrix.premultiply( matrix );\n\n\t\tthis.matrix.decompose( this.position, this.quaternion, this.scale );\n\n\t},\n\n\tapplyQuaternion: function ( q ) {\n\n\t\tthis.quaternion.premultiply( q );\n\n\t\treturn this;\n\n\t},\n\n\tsetRotationFromAxisAngle: function ( axis, angle ) {\n\n\t\t// assumes axis is normalized\n\n\t\tthis.quaternion.setFromAxisAngle( axis, angle );\n\n\t},\n\n\tsetRotationFromEuler: function ( euler ) {\n\n\t\tthis.quaternion.setFromEuler( euler, true );\n\n\t},\n\n\tsetRotationFromMatrix: function ( m ) {\n\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\n\t\tthis.quaternion.setFromRotationMatrix( m );\n\n\t},\n\n\tsetRotationFromQuaternion: function ( q ) {\n\n\t\t// assumes q is normalized\n\n\t\tthis.quaternion.copy( q );\n\n\t},\n\n\trotateOnAxis: function ( axis, angle ) {\n\n\t\t// rotate object on axis in object space\n\t\t// axis is assumed to be normalized\n\n\t\t_q1.setFromAxisAngle( axis, angle );\n\n\t\tthis.quaternion.multiply( _q1 );\n\n\t\treturn this;\n\n\t},\n\n\trotateOnWorldAxis: function ( axis, angle ) {\n\n\t\t// rotate object on axis in world space\n\t\t// axis is assumed to be normalized\n\t\t// method assumes no rotated parent\n\n\t\t_q1.setFromAxisAngle( axis, angle );\n\n\t\tthis.quaternion.premultiply( _q1 );\n\n\t\treturn this;\n\n\t},\n\n\trotateX: function ( angle ) {\n\n\t\treturn this.rotateOnAxis( _xAxis, angle );\n\n\t},\n\n\trotateY: function ( angle ) {\n\n\t\treturn this.rotateOnAxis( _yAxis, angle );\n\n\t},\n\n\trotateZ: function ( angle ) {\n\n\t\treturn this.rotateOnAxis( _zAxis, angle );\n\n\t},\n\n\ttranslateOnAxis: function ( axis, distance ) {\n\n\t\t// translate object by distance along axis in object space\n\t\t// axis is assumed to be normalized\n\n\t\t_v1.copy( axis ).applyQuaternion( this.quaternion );\n\n\t\tthis.position.add( _v1.multiplyScalar( distance ) );\n\n\t\treturn this;\n\n\t},\n\n\ttranslateX: function ( distance ) {\n\n\t\treturn this.translateOnAxis( _xAxis, distance );\n\n\t},\n\n\ttranslateY: function ( distance ) {\n\n\t\treturn this.translateOnAxis( _yAxis, distance );\n\n\t},\n\n\ttranslateZ: function ( distance ) {\n\n\t\treturn this.translateOnAxis( _zAxis, distance );\n\n\t},\n\n\tlocalToWorld: function ( vector ) {\n\n\t\treturn vector.applyMatrix4( this.matrixWorld );\n\n\t},\n\n\tworldToLocal: function ( vector ) {\n\n\t\treturn vector.applyMatrix4( _m1.getInverse( this.matrixWorld ) );\n\n\t},\n\n\tlookAt: function ( x, y, z ) {\n\n\t\t// This method does not support objects having non-uniformly-scaled parent(s)\n\n\t\tif ( x.isVector3 ) {\n\n\t\t\t_target.copy( x );\n\n\t\t} else {\n\n\t\t\t_target.set( x, y, z );\n\n\t\t}\n\n\t\tconst parent = this.parent;\n\n\t\tthis.updateWorldMatrix( true, false );\n\n\t\t_position.setFromMatrixPosition( this.matrixWorld );\n\n\t\tif ( this.isCamera || this.isLight ) {\n\n\t\t\t_m1.lookAt( _position, _target, this.up );\n\n\t\t} else {\n\n\t\t\t_m1.lookAt( _target, _position, this.up );\n\n\t\t}\n\n\t\tthis.quaternion.setFromRotationMatrix( _m1 );\n\n\t\tif ( parent ) {\n\n\t\t\t_m1.extractRotation( parent.matrixWorld );\n\t\t\t_q1.setFromRotationMatrix( _m1 );\n\t\t\tthis.quaternion.premultiply( _q1.inverse() );\n\n\t\t}\n\n\t},\n\n\tadd: function ( object ) {\n\n\t\tif ( arguments.length > 1 ) {\n\n\t\t\tfor ( let i = 0; i < arguments.length; i ++ ) {\n\n\t\t\t\tthis.add( arguments[ i ] );\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tif ( object === this ) {\n\n\t\t\tconsole.error( \"THREE.Object3D.add: object can't be added as a child of itself.\", object );\n\t\t\treturn this;\n\n\t\t}\n\n\t\tif ( ( object && object.isObject3D ) ) {\n\n\t\t\tif ( object.parent !== null ) {\n\n\t\t\t\tobject.parent.remove( object );\n\n\t\t\t}\n\n\t\t\tobject.parent = this;\n\t\t\tthis.children.push( object );\n\n\t\t\tobject.dispatchEvent( _addedEvent );\n\n\t\t} else {\n\n\t\t\tconsole.error( \"THREE.Object3D.add: object not an instance of THREE.Object3D.\", object );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tremove: function ( object ) {\n\n\t\tif ( arguments.length > 1 ) {\n\n\t\t\tfor ( let i = 0; i < arguments.length; i ++ ) {\n\n\t\t\t\tthis.remove( arguments[ i ] );\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\tconst index = this.children.indexOf( object );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tobject.parent = null;\n\t\t\tthis.children.splice( index, 1 );\n\n\t\t\tobject.dispatchEvent( _removedEvent );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tattach: function ( object ) {\n\n\t\t// adds object as a child of this, while maintaining the object's world transform\n\n\t\tthis.updateWorldMatrix( true, false );\n\n\t\t_m1.getInverse( this.matrixWorld );\n\n\t\tif ( object.parent !== null ) {\n\n\t\t\tobject.parent.updateWorldMatrix( true, false );\n\n\t\t\t_m1.multiply( object.parent.matrixWorld );\n\n\t\t}\n\n\t\tobject.applyMatrix4( _m1 );\n\n\t\tobject.updateWorldMatrix( false, false );\n\n\t\tthis.add( object );\n\n\t\treturn this;\n\n\t},\n\n\tgetObjectById: function ( id ) {\n\n\t\treturn this.getObjectByProperty( 'id', id );\n\n\t},\n\n\tgetObjectByName: function ( name ) {\n\n\t\treturn this.getObjectByProperty( 'name', name );\n\n\t},\n\n\tgetObjectByProperty: function ( name, value ) {\n\n\t\tif ( this[ name ] === value ) return this;\n\n\t\tfor ( let i = 0, l = this.children.length; i < l; i ++ ) {\n\n\t\t\tconst child = this.children[ i ];\n\t\t\tconst object = child.getObjectByProperty( name, value );\n\n\t\t\tif ( object !== undefined ) {\n\n\t\t\t\treturn object;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn undefined;\n\n\t},\n\n\tgetWorldPosition: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Object3D: .getWorldPosition() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\tthis.updateMatrixWorld( true );\n\n\t\treturn target.setFromMatrixPosition( this.matrixWorld );\n\n\t},\n\n\tgetWorldQuaternion: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Object3D: .getWorldQuaternion() target is now required' );\n\t\t\ttarget = new Quaternion();\n\n\t\t}\n\n\t\tthis.updateMatrixWorld( true );\n\n\t\tthis.matrixWorld.decompose( _position, target, _scale );\n\n\t\treturn target;\n\n\t},\n\n\tgetWorldScale: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Object3D: .getWorldScale() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\tthis.updateMatrixWorld( true );\n\n\t\tthis.matrixWorld.decompose( _position, _quaternion, target );\n\n\t\treturn target;\n\n\t},\n\n\tgetWorldDirection: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Object3D: .getWorldDirection() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\tthis.updateMatrixWorld( true );\n\n\t\tconst e = this.matrixWorld.elements;\n\n\t\treturn target.set( e[ 8 ], e[ 9 ], e[ 10 ] ).normalize();\n\n\t},\n\n\traycast: function () {},\n\n\ttraverse: function ( callback ) {\n\n\t\tcallback( this );\n\n\t\tconst children = this.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tchildren[ i ].traverse( callback );\n\n\t\t}\n\n\t},\n\n\ttraverseVisible: function ( callback ) {\n\n\t\tif ( this.visible === false ) return;\n\n\t\tcallback( this );\n\n\t\tconst children = this.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tchildren[ i ].traverseVisible( callback );\n\n\t\t}\n\n\t},\n\n\ttraverseAncestors: function ( callback ) {\n\n\t\tconst parent = this.parent;\n\n\t\tif ( parent !== null ) {\n\n\t\t\tcallback( parent );\n\n\t\t\tparent.traverseAncestors( callback );\n\n\t\t}\n\n\t},\n\n\tupdateMatrix: function () {\n\n\t\tthis.matrix.compose( this.position, this.quaternion, this.scale );\n\n\t\tthis.matrixWorldNeedsUpdate = true;\n\n\t},\n\n\tupdateMatrixWorld: function ( force ) {\n\n\t\tif ( this.matrixAutoUpdate ) this.updateMatrix();\n\n\t\tif ( this.matrixWorldNeedsUpdate || force ) {\n\n\t\t\tif ( this.parent === null ) {\n\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\n\n\t\t\t} else {\n\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\n\n\t\t\t}\n\n\t\t\tthis.matrixWorldNeedsUpdate = false;\n\n\t\t\tforce = true;\n\n\t\t}\n\n\t\t// update children\n\n\t\tconst children = this.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tchildren[ i ].updateMatrixWorld( force );\n\n\t\t}\n\n\t},\n\n\tupdateWorldMatrix: function ( updateParents, updateChildren ) {\n\n\t\tconst parent = this.parent;\n\n\t\tif ( updateParents === true && parent !== null ) {\n\n\t\t\tparent.updateWorldMatrix( true, false );\n\n\t\t}\n\n\t\tif ( this.matrixAutoUpdate ) this.updateMatrix();\n\n\t\tif ( this.parent === null ) {\n\n\t\t\tthis.matrixWorld.copy( this.matrix );\n\n\t\t} else {\n\n\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\n\n\t\t}\n\n\t\t// update children\n\n\t\tif ( updateChildren === true ) {\n\n\t\t\tconst children = this.children;\n\n\t\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\t\tchildren[ i ].updateWorldMatrix( false, true );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\t// meta is a string when called from JSON.stringify\n\t\tconst isRootObject = ( meta === undefined || typeof meta === 'string' );\n\n\t\tconst output = {};\n\n\t\t// meta is a hash used to collect geometries, materials.\n\t\t// not providing it implies that this is the root object\n\t\t// being serialized.\n\t\tif ( isRootObject ) {\n\n\t\t\t// initialize meta obj\n\t\t\tmeta = {\n\t\t\t\tgeometries: {},\n\t\t\t\tmaterials: {},\n\t\t\t\ttextures: {},\n\t\t\t\timages: {},\n\t\t\t\tshapes: {}\n\t\t\t};\n\n\t\t\toutput.metadata = {\n\t\t\t\tversion: 4.5,\n\t\t\t\ttype: 'Object',\n\t\t\t\tgenerator: 'Object3D.toJSON'\n\t\t\t};\n\n\t\t}\n\n\t\t// standard Object3D serialization\n\n\t\tconst object = {};\n\n\t\tobject.uuid = this.uuid;\n\t\tobject.type = this.type;\n\n\t\tif ( this.name !== '' ) object.name = this.name;\n\t\tif ( this.castShadow === true ) object.castShadow = true;\n\t\tif ( this.receiveShadow === true ) object.receiveShadow = true;\n\t\tif ( this.visible === false ) object.visible = false;\n\t\tif ( this.frustumCulled === false ) object.frustumCulled = false;\n\t\tif ( this.renderOrder !== 0 ) object.renderOrder = this.renderOrder;\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) object.userData = this.userData;\n\n\t\tobject.layers = this.layers.mask;\n\t\tobject.matrix = this.matrix.toArray();\n\n\t\tif ( this.matrixAutoUpdate === false ) object.matrixAutoUpdate = false;\n\n\t\t// object specific properties\n\n\t\tif ( this.isInstancedMesh ) {\n\n\t\t\tobject.type = 'InstancedMesh';\n\t\t\tobject.count = this.count;\n\t\t\tobject.instanceMatrix = this.instanceMatrix.toJSON();\n\n\t\t}\n\n\t\t//\n\n\t\tfunction serialize( library, element ) {\n\n\t\t\tif ( library[ element.uuid ] === undefined ) {\n\n\t\t\t\tlibrary[ element.uuid ] = element.toJSON( meta );\n\n\t\t\t}\n\n\t\t\treturn element.uuid;\n\n\t\t}\n\n\t\tif ( this.isMesh || this.isLine || this.isPoints ) {\n\n\t\t\tobject.geometry = serialize( meta.geometries, this.geometry );\n\n\t\t\tconst parameters = this.geometry.parameters;\n\n\t\t\tif ( parameters !== undefined && parameters.shapes !== undefined ) {\n\n\t\t\t\tconst shapes = parameters.shapes;\n\n\t\t\t\tif ( Array.isArray( shapes ) ) {\n\n\t\t\t\t\tfor ( let i = 0, l = shapes.length; i < l; i ++ ) {\n\n\t\t\t\t\t\tconst shape = shapes[ i ];\n\n\t\t\t\t\t\tserialize( meta.shapes, shape );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tserialize( meta.shapes, shapes );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.material !== undefined ) {\n\n\t\t\tif ( Array.isArray( this.material ) ) {\n\n\t\t\t\tconst uuids = [];\n\n\t\t\t\tfor ( let i = 0, l = this.material.length; i < l; i ++ ) {\n\n\t\t\t\t\tuuids.push( serialize( meta.materials, this.material[ i ] ) );\n\n\t\t\t\t}\n\n\t\t\t\tobject.material = uuids;\n\n\t\t\t} else {\n\n\t\t\t\tobject.material = serialize( meta.materials, this.material );\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tif ( this.children.length > 0 ) {\n\n\t\t\tobject.children = [];\n\n\t\t\tfor ( let i = 0; i < this.children.length; i ++ ) {\n\n\t\t\t\tobject.children.push( this.children[ i ].toJSON( meta ).object );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( isRootObject ) {\n\n\t\t\tconst geometries = extractFromCache( meta.geometries );\n\t\t\tconst materials = extractFromCache( meta.materials );\n\t\t\tconst textures = extractFromCache( meta.textures );\n\t\t\tconst images = extractFromCache( meta.images );\n\t\t\tconst shapes = extractFromCache( meta.shapes );\n\n\t\t\tif ( geometries.length > 0 ) output.geometries = geometries;\n\t\t\tif ( materials.length > 0 ) output.materials = materials;\n\t\t\tif ( textures.length > 0 ) output.textures = textures;\n\t\t\tif ( images.length > 0 ) output.images = images;\n\t\t\tif ( shapes.length > 0 ) output.shapes = shapes;\n\n\t\t}\n\n\t\toutput.object = object;\n\n\t\treturn output;\n\n\t\t// extract data from the cache hash\n\t\t// remove metadata on each item\n\t\t// and return as array\n\t\tfunction extractFromCache( cache ) {\n\n\t\t\tconst values = [];\n\t\t\tfor ( const key in cache ) {\n\n\t\t\t\tconst data = cache[ key ];\n\t\t\t\tdelete data.metadata;\n\t\t\t\tvalues.push( data );\n\n\t\t\t}\n\n\t\t\treturn values;\n\n\t\t}\n\n\t},\n\n\tclone: function ( recursive ) {\n\n\t\treturn new this.constructor().copy( this, recursive );\n\n\t},\n\n\tcopy: function ( source, recursive ) {\n\n\t\tif ( recursive === undefined ) recursive = true;\n\n\t\tthis.name = source.name;\n\n\t\tthis.up.copy( source.up );\n\n\t\tthis.position.copy( source.position );\n\t\tthis.quaternion.copy( source.quaternion );\n\t\tthis.scale.copy( source.scale );\n\n\t\tthis.matrix.copy( source.matrix );\n\t\tthis.matrixWorld.copy( source.matrixWorld );\n\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\n\t\tthis.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\n\n\t\tthis.layers.mask = source.layers.mask;\n\t\tthis.visible = source.visible;\n\n\t\tthis.castShadow = source.castShadow;\n\t\tthis.receiveShadow = source.receiveShadow;\n\n\t\tthis.frustumCulled = source.frustumCulled;\n\t\tthis.renderOrder = source.renderOrder;\n\n\t\tthis.userData = JSON.parse( JSON.stringify( source.userData ) );\n\n\t\tif ( recursive === true ) {\n\n\t\t\tfor ( let i = 0; i < source.children.length; i ++ ) {\n\n\t\t\t\tconst child = source.children[ i ];\n\t\t\t\tthis.add( child.clone() );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { Object3D };\n","import { Object3D } from '../core/Object3D.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction Scene() {\n\n\tObject3D.call( this );\n\n\tthis.type = 'Scene';\n\n\tthis.background = null;\n\tthis.environment = null;\n\tthis.fog = null;\n\n\tthis.overrideMaterial = null;\n\n\tthis.autoUpdate = true; // checked by the renderer\n\n\tif ( typeof __THREE_DEVTOOLS__ !== 'undefined' ) {\n\n\t\t__THREE_DEVTOOLS__.dispatchEvent( new CustomEvent( 'observe', { detail: this } ) ); // eslint-disable-line no-undef\n\n\t}\n\n}\n\nScene.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Scene,\n\n\tisScene: true,\n\n\tcopy: function ( source, recursive ) {\n\n\t\tObject3D.prototype.copy.call( this, source, recursive );\n\n\t\tif ( source.background !== null ) this.background = source.background.clone();\n\t\tif ( source.environment !== null ) this.environment = source.environment.clone();\n\t\tif ( source.fog !== null ) this.fog = source.fog.clone();\n\n\t\tif ( source.overrideMaterial !== null ) this.overrideMaterial = source.overrideMaterial.clone();\n\n\t\tthis.autoUpdate = source.autoUpdate;\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\n\n\t\treturn this;\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\tconst data = Object3D.prototype.toJSON.call( this, meta );\n\n\t\tif ( this.background !== null ) data.object.background = this.background.toJSON( meta );\n\t\tif ( this.environment !== null ) data.object.environment = this.environment.toJSON( meta );\n\t\tif ( this.fog !== null ) data.object.fog = this.fog.toJSON();\n\n\t\treturn data;\n\n\t},\n\n\tdispose: function () {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t}\n\n} );\n\n\n\nexport { Scene };\n","import { Vector3 } from './Vector3.js';\n\nconst _points = [\n\tnew Vector3(),\n\tnew Vector3(),\n\tnew Vector3(),\n\tnew Vector3(),\n\tnew Vector3(),\n\tnew Vector3(),\n\tnew Vector3(),\n\tnew Vector3()\n];\n\nconst _vector = new Vector3();\n\nconst _box = new Box3();\n\n// triangle centered vertices\n\nconst _v0 = new Vector3();\nconst _v1 = new Vector3();\nconst _v2 = new Vector3();\n\n// triangle edge vectors\n\nconst _f0 = new Vector3();\nconst _f1 = new Vector3();\nconst _f2 = new Vector3();\n\nconst _center = new Vector3();\nconst _extents = new Vector3();\nconst _triangleNormal = new Vector3();\nconst _testAxis = new Vector3();\n\n/**\n * @author bhouston / http://clara.io\n * @author WestLangley / http://github.com/WestLangley\n */\n\nfunction Box3( min, max ) {\n\n\tthis.min = ( min !== undefined ) ? min : new Vector3( + Infinity, + Infinity, + Infinity );\n\tthis.max = ( max !== undefined ) ? max : new Vector3( - Infinity, - Infinity, - Infinity );\n\n}\n\n\nObject.assign( Box3.prototype, {\n\n\tisBox3: true,\n\n\tset: function ( min, max ) {\n\n\t\tthis.min.copy( min );\n\t\tthis.max.copy( max );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromArray: function ( array ) {\n\n\t\tlet minX = + Infinity;\n\t\tlet minY = + Infinity;\n\t\tlet minZ = + Infinity;\n\n\t\tlet maxX = - Infinity;\n\t\tlet maxY = - Infinity;\n\t\tlet maxZ = - Infinity;\n\n\t\tfor ( let i = 0, l = array.length; i < l; i += 3 ) {\n\n\t\t\tconst x = array[ i ];\n\t\t\tconst y = array[ i + 1 ];\n\t\t\tconst z = array[ i + 2 ];\n\n\t\t\tif ( x < minX ) minX = x;\n\t\t\tif ( y < minY ) minY = y;\n\t\t\tif ( z < minZ ) minZ = z;\n\n\t\t\tif ( x > maxX ) maxX = x;\n\t\t\tif ( y > maxY ) maxY = y;\n\t\t\tif ( z > maxZ ) maxZ = z;\n\n\t\t}\n\n\t\tthis.min.set( minX, minY, minZ );\n\t\tthis.max.set( maxX, maxY, maxZ );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromBufferAttribute: function ( attribute ) {\n\n\t\tlet minX = + Infinity;\n\t\tlet minY = + Infinity;\n\t\tlet minZ = + Infinity;\n\n\t\tlet maxX = - Infinity;\n\t\tlet maxY = - Infinity;\n\t\tlet maxZ = - Infinity;\n\n\t\tfor ( let i = 0, l = attribute.count; i < l; i ++ ) {\n\n\t\t\tconst x = attribute.getX( i );\n\t\t\tconst y = attribute.getY( i );\n\t\t\tconst z = attribute.getZ( i );\n\n\t\t\tif ( x < minX ) minX = x;\n\t\t\tif ( y < minY ) minY = y;\n\t\t\tif ( z < minZ ) minZ = z;\n\n\t\t\tif ( x > maxX ) maxX = x;\n\t\t\tif ( y > maxY ) maxY = y;\n\t\t\tif ( z > maxZ ) maxZ = z;\n\n\t\t}\n\n\t\tthis.min.set( minX, minY, minZ );\n\t\tthis.max.set( maxX, maxY, maxZ );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromPoints: function ( points ) {\n\n\t\tthis.makeEmpty();\n\n\t\tfor ( let i = 0, il = points.length; i < il; i ++ ) {\n\n\t\t\tthis.expandByPoint( points[ i ] );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetFromCenterAndSize: function ( center, size ) {\n\n\t\tconst halfSize = _vector.copy( size ).multiplyScalar( 0.5 );\n\n\t\tthis.min.copy( center ).sub( halfSize );\n\t\tthis.max.copy( center ).add( halfSize );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromObject: function ( object ) {\n\n\t\tthis.makeEmpty();\n\n\t\treturn this.expandByObject( object );\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( box ) {\n\n\t\tthis.min.copy( box.min );\n\t\tthis.max.copy( box.max );\n\n\t\treturn this;\n\n\t},\n\n\tmakeEmpty: function () {\n\n\t\tthis.min.x = this.min.y = this.min.z = + Infinity;\n\t\tthis.max.x = this.max.y = this.max.z = - Infinity;\n\n\t\treturn this;\n\n\t},\n\n\tisEmpty: function () {\n\n\t\t// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\n\n\t\treturn ( this.max.x < this.min.x ) || ( this.max.y < this.min.y ) || ( this.max.z < this.min.z );\n\n\t},\n\n\tgetCenter: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Box3: .getCenter() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn this.isEmpty() ? target.set( 0, 0, 0 ) : target.addVectors( this.min, this.max ).multiplyScalar( 0.5 );\n\n\t},\n\n\tgetSize: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Box3: .getSize() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn this.isEmpty() ? target.set( 0, 0, 0 ) : target.subVectors( this.max, this.min );\n\n\t},\n\n\texpandByPoint: function ( point ) {\n\n\t\tthis.min.min( point );\n\t\tthis.max.max( point );\n\n\t\treturn this;\n\n\t},\n\n\texpandByVector: function ( vector ) {\n\n\t\tthis.min.sub( vector );\n\t\tthis.max.add( vector );\n\n\t\treturn this;\n\n\t},\n\n\texpandByScalar: function ( scalar ) {\n\n\t\tthis.min.addScalar( - scalar );\n\t\tthis.max.addScalar( scalar );\n\n\t\treturn this;\n\n\t},\n\n\texpandByObject: function ( object ) {\n\n\t\t// Computes the world-axis-aligned bounding box of an object (including its children),\n\t\t// accounting for both the object's, and children's, world transforms\n\n\t\tobject.updateWorldMatrix( false, false );\n\n\t\tconst geometry = object.geometry;\n\n\t\tif ( geometry !== undefined ) {\n\n\t\t\tif ( geometry.boundingBox === null ) {\n\n\t\t\t\tgeometry.computeBoundingBox();\n\n\t\t\t}\n\n\t\t\t_box.copy( geometry.boundingBox );\n\t\t\t_box.applyMatrix4( object.matrixWorld );\n\n\t\t\tthis.union( _box );\n\n\t\t}\n\n\t\tconst children = object.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tthis.expandByObject( children[ i ] );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcontainsPoint: function ( point ) {\n\n\t\treturn point.x < this.min.x || point.x > this.max.x ||\n\t\t\tpoint.y < this.min.y || point.y > this.max.y ||\n\t\t\tpoint.z < this.min.z || point.z > this.max.z ? false : true;\n\n\t},\n\n\tcontainsBox: function ( box ) {\n\n\t\treturn this.min.x <= box.min.x && box.max.x <= this.max.x &&\n\t\t\tthis.min.y <= box.min.y && box.max.y <= this.max.y &&\n\t\t\tthis.min.z <= box.min.z && box.max.z <= this.max.z;\n\n\t},\n\n\tgetParameter: function ( point, target ) {\n\n\t\t// This can potentially have a divide by zero if the box\n\t\t// has a size dimension of 0.\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Box3: .getParameter() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn target.set(\n\t\t\t( point.x - this.min.x ) / ( this.max.x - this.min.x ),\n\t\t\t( point.y - this.min.y ) / ( this.max.y - this.min.y ),\n\t\t\t( point.z - this.min.z ) / ( this.max.z - this.min.z )\n\t\t);\n\n\t},\n\n\tintersectsBox: function ( box ) {\n\n\t\t// using 6 splitting planes to rule out intersections.\n\t\treturn box.max.x < this.min.x || box.min.x > this.max.x ||\n\t\t\tbox.max.y < this.min.y || box.min.y > this.max.y ||\n\t\t\tbox.max.z < this.min.z || box.min.z > this.max.z ? false : true;\n\n\t},\n\n\tintersectsSphere: function ( sphere ) {\n\n\t\t// Find the point on the AABB closest to the sphere center.\n\t\tthis.clampPoint( sphere.center, _vector );\n\n\t\t// If that point is inside the sphere, the AABB and sphere intersect.\n\t\treturn _vector.distanceToSquared( sphere.center ) <= ( sphere.radius * sphere.radius );\n\n\t},\n\n\tintersectsPlane: function ( plane ) {\n\n\t\t// We compute the minimum and maximum dot product values. If those values\n\t\t// are on the same side (back or front) of the plane, then there is no intersection.\n\n\t\tlet min, max;\n\n\t\tif ( plane.normal.x > 0 ) {\n\n\t\t\tmin = plane.normal.x * this.min.x;\n\t\t\tmax = plane.normal.x * this.max.x;\n\n\t\t} else {\n\n\t\t\tmin = plane.normal.x * this.max.x;\n\t\t\tmax = plane.normal.x * this.min.x;\n\n\t\t}\n\n\t\tif ( plane.normal.y > 0 ) {\n\n\t\t\tmin += plane.normal.y * this.min.y;\n\t\t\tmax += plane.normal.y * this.max.y;\n\n\t\t} else {\n\n\t\t\tmin += plane.normal.y * this.max.y;\n\t\t\tmax += plane.normal.y * this.min.y;\n\n\t\t}\n\n\t\tif ( plane.normal.z > 0 ) {\n\n\t\t\tmin += plane.normal.z * this.min.z;\n\t\t\tmax += plane.normal.z * this.max.z;\n\n\t\t} else {\n\n\t\t\tmin += plane.normal.z * this.max.z;\n\t\t\tmax += plane.normal.z * this.min.z;\n\n\t\t}\n\n\t\treturn ( min <= - plane.constant && max >= - plane.constant );\n\n\t},\n\n\tintersectsTriangle: function ( triangle ) {\n\n\t\tif ( this.isEmpty() ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t\t// compute box center and extents\n\t\tthis.getCenter( _center );\n\t\t_extents.subVectors( this.max, _center );\n\n\t\t// translate triangle to aabb origin\n\t\t_v0.subVectors( triangle.a, _center );\n\t\t_v1.subVectors( triangle.b, _center );\n\t\t_v2.subVectors( triangle.c, _center );\n\n\t\t// compute edge vectors for triangle\n\t\t_f0.subVectors( _v1, _v0 );\n\t\t_f1.subVectors( _v2, _v1 );\n\t\t_f2.subVectors( _v0, _v2 );\n\n\t\t// test against axes that are given by cross product combinations of the edges of the triangle and the edges of the aabb\n\t\t// make an axis testing of each of the 3 sides of the aabb against each of the 3 sides of the triangle = 9 axis of separation\n\t\t// axis_ij = u_i x f_j (u0, u1, u2 = face normals of aabb = x,y,z axes vectors since aabb is axis aligned)\n\t\tlet axes = [\n\t\t\t0, - _f0.z, _f0.y, 0, - _f1.z, _f1.y, 0, - _f2.z, _f2.y,\n\t\t\t_f0.z, 0, - _f0.x, _f1.z, 0, - _f1.x, _f2.z, 0, - _f2.x,\n\t\t\t- _f0.y, _f0.x, 0, - _f1.y, _f1.x, 0, - _f2.y, _f2.x, 0\n\t\t];\n\t\tif ( ! satForAxes( axes, _v0, _v1, _v2, _extents ) ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t\t// test 3 face normals from the aabb\n\t\taxes = [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ];\n\t\tif ( ! satForAxes( axes, _v0, _v1, _v2, _extents ) ) {\n\n\t\t\treturn false;\n\n\t\t}\n\n\t\t// finally testing the face normal of the triangle\n\t\t// use already existing triangle edge vectors here\n\t\t_triangleNormal.crossVectors( _f0, _f1 );\n\t\taxes = [ _triangleNormal.x, _triangleNormal.y, _triangleNormal.z ];\n\n\t\treturn satForAxes( axes, _v0, _v1, _v2, _extents );\n\n\t},\n\n\tclampPoint: function ( point, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Box3: .clampPoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn target.copy( point ).clamp( this.min, this.max );\n\n\t},\n\n\tdistanceToPoint: function ( point ) {\n\n\t\tconst clampedPoint = _vector.copy( point ).clamp( this.min, this.max );\n\n\t\treturn clampedPoint.sub( point ).length();\n\n\t},\n\n\tgetBoundingSphere: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.error( 'THREE.Box3: .getBoundingSphere() target is now required' );\n\t\t\t//target = new Sphere(); // removed to avoid cyclic dependency\n\n\t\t}\n\n\t\tthis.getCenter( target.center );\n\n\t\ttarget.radius = this.getSize( _vector ).length() * 0.5;\n\n\t\treturn target;\n\n\t},\n\n\tintersect: function ( box ) {\n\n\t\tthis.min.max( box.min );\n\t\tthis.max.min( box.max );\n\n\t\t// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.\n\t\tif ( this.isEmpty() ) this.makeEmpty();\n\n\t\treturn this;\n\n\t},\n\n\tunion: function ( box ) {\n\n\t\tthis.min.min( box.min );\n\t\tthis.max.max( box.max );\n\n\t\treturn this;\n\n\t},\n\n\tapplyMatrix4: function ( matrix ) {\n\n\t\t// transform of empty box is an empty box.\n\t\tif ( this.isEmpty() ) return this;\n\n\t\t// NOTE: I am using a binary pattern to specify all 2^3 combinations below\n\t\t_points[ 0 ].set( this.min.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 000\n\t\t_points[ 1 ].set( this.min.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 001\n\t\t_points[ 2 ].set( this.min.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 010\n\t\t_points[ 3 ].set( this.min.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 011\n\t\t_points[ 4 ].set( this.max.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 100\n\t\t_points[ 5 ].set( this.max.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 101\n\t\t_points[ 6 ].set( this.max.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 110\n\t\t_points[ 7 ].set( this.max.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 111\n\n\t\tthis.setFromPoints( _points );\n\n\t\treturn this;\n\n\t},\n\n\ttranslate: function ( offset ) {\n\n\t\tthis.min.add( offset );\n\t\tthis.max.add( offset );\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( box ) {\n\n\t\treturn box.min.equals( this.min ) && box.max.equals( this.max );\n\n\t}\n\n} );\n\nfunction satForAxes( axes, v0, v1, v2, extents ) {\n\n\tfor ( let i = 0, j = axes.length - 3; i <= j; i += 3 ) {\n\n\t\t_testAxis.fromArray( axes, i );\n\t\t// project the aabb onto the seperating axis\n\t\tconst r = extents.x * Math.abs( _testAxis.x ) + extents.y * Math.abs( _testAxis.y ) + extents.z * Math.abs( _testAxis.z );\n\t\t// project all 3 vertices of the triangle onto the seperating axis\n\t\tconst p0 = v0.dot( _testAxis );\n\t\tconst p1 = v1.dot( _testAxis );\n\t\tconst p2 = v2.dot( _testAxis );\n\t\t// actual test, basically see if either of the most extreme of the triangle points intersects r\n\t\tif ( Math.max( - Math.max( p0, p1, p2 ), Math.min( p0, p1, p2 ) ) > r ) {\n\n\t\t\t// points of the projected triangle are outside the projected half-length of the aabb\n\t\t\t// the axis is seperating and we can exit\n\t\t\treturn false;\n\n\t\t}\n\n\t}\n\n\treturn true;\n\n}\n\nexport { Box3 };\n","import { Box3 } from './Box3.js';\nimport { Vector3 } from './Vector3.js';\n\nconst _box = new Box3();\n\n/**\n * @author bhouston / http://clara.io\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction Sphere( center, radius ) {\n\n\tthis.center = ( center !== undefined ) ? center : new Vector3();\n\tthis.radius = ( radius !== undefined ) ? radius : - 1;\n\n}\n\nObject.assign( Sphere.prototype, {\n\n\tset: function ( center, radius ) {\n\n\t\tthis.center.copy( center );\n\t\tthis.radius = radius;\n\n\t\treturn this;\n\n\t},\n\n\tsetFromPoints: function ( points, optionalCenter ) {\n\n\t\tconst center = this.center;\n\n\t\tif ( optionalCenter !== undefined ) {\n\n\t\t\tcenter.copy( optionalCenter );\n\n\t\t} else {\n\n\t\t\t_box.setFromPoints( points ).getCenter( center );\n\n\t\t}\n\n\t\tlet maxRadiusSq = 0;\n\n\t\tfor ( let i = 0, il = points.length; i < il; i ++ ) {\n\n\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( points[ i ] ) );\n\n\t\t}\n\n\t\tthis.radius = Math.sqrt( maxRadiusSq );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( sphere ) {\n\n\t\tthis.center.copy( sphere.center );\n\t\tthis.radius = sphere.radius;\n\n\t\treturn this;\n\n\t},\n\n\tisEmpty: function () {\n\n\t\treturn ( this.radius < 0 );\n\n\t},\n\n\tmakeEmpty: function () {\n\n\t\tthis.center.set( 0, 0, 0 );\n\t\tthis.radius = - 1;\n\n\t\treturn this;\n\n\t},\n\n\tcontainsPoint: function ( point ) {\n\n\t\treturn ( point.distanceToSquared( this.center ) <= ( this.radius * this.radius ) );\n\n\t},\n\n\tdistanceToPoint: function ( point ) {\n\n\t\treturn ( point.distanceTo( this.center ) - this.radius );\n\n\t},\n\n\tintersectsSphere: function ( sphere ) {\n\n\t\tconst radiusSum = this.radius + sphere.radius;\n\n\t\treturn sphere.center.distanceToSquared( this.center ) <= ( radiusSum * radiusSum );\n\n\t},\n\n\tintersectsBox: function ( box ) {\n\n\t\treturn box.intersectsSphere( this );\n\n\t},\n\n\tintersectsPlane: function ( plane ) {\n\n\t\treturn Math.abs( plane.distanceToPoint( this.center ) ) <= this.radius;\n\n\t},\n\n\tclampPoint: function ( point, target ) {\n\n\t\tconst deltaLengthSq = this.center.distanceToSquared( point );\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Sphere: .clampPoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\ttarget.copy( point );\n\n\t\tif ( deltaLengthSq > ( this.radius * this.radius ) ) {\n\n\t\t\ttarget.sub( this.center ).normalize();\n\t\t\ttarget.multiplyScalar( this.radius ).add( this.center );\n\n\t\t}\n\n\t\treturn target;\n\n\t},\n\n\tgetBoundingBox: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Sphere: .getBoundingBox() target is now required' );\n\t\t\ttarget = new Box3();\n\n\t\t}\n\n\t\tif ( this.isEmpty() ) {\n\n\t\t\t// Empty sphere produces empty bounding box\n\t\t\ttarget.makeEmpty();\n\t\t\treturn target;\n\n\t\t}\n\n\t\ttarget.set( this.center, this.center );\n\t\ttarget.expandByScalar( this.radius );\n\n\t\treturn target;\n\n\t},\n\n\tapplyMatrix4: function ( matrix ) {\n\n\t\tthis.center.applyMatrix4( matrix );\n\t\tthis.radius = this.radius * matrix.getMaxScaleOnAxis();\n\n\t\treturn this;\n\n\t},\n\n\ttranslate: function ( offset ) {\n\n\t\tthis.center.add( offset );\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( sphere ) {\n\n\t\treturn sphere.center.equals( this.center ) && ( sphere.radius === this.radius );\n\n\t}\n\n} );\n\n\nexport { Sphere };\n","import { Vector3 } from './Vector3.js';\n\nconst _vector = new Vector3();\nconst _segCenter = new Vector3();\nconst _segDir = new Vector3();\nconst _diff = new Vector3();\n\nconst _edge1 = new Vector3();\nconst _edge2 = new Vector3();\nconst _normal = new Vector3();\n\n/**\n * @author bhouston / http://clara.io\n */\n\nfunction Ray( origin, direction ) {\n\n\tthis.origin = ( origin !== undefined ) ? origin : new Vector3();\n\tthis.direction = ( direction !== undefined ) ? direction : new Vector3( 0, 0, - 1 );\n\n}\n\nObject.assign( Ray.prototype, {\n\n\tset: function ( origin, direction ) {\n\n\t\tthis.origin.copy( origin );\n\t\tthis.direction.copy( direction );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( ray ) {\n\n\t\tthis.origin.copy( ray.origin );\n\t\tthis.direction.copy( ray.direction );\n\n\t\treturn this;\n\n\t},\n\n\tat: function ( t, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Ray: .at() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn target.copy( this.direction ).multiplyScalar( t ).add( this.origin );\n\n\t},\n\n\tlookAt: function ( v ) {\n\n\t\tthis.direction.copy( v ).sub( this.origin ).normalize();\n\n\t\treturn this;\n\n\t},\n\n\trecast: function ( t ) {\n\n\t\tthis.origin.copy( this.at( t, _vector ) );\n\n\t\treturn this;\n\n\t},\n\n\tclosestPointToPoint: function ( point, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Ray: .closestPointToPoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\ttarget.subVectors( point, this.origin );\n\n\t\tconst directionDistance = target.dot( this.direction );\n\n\t\tif ( directionDistance < 0 ) {\n\n\t\t\treturn target.copy( this.origin );\n\n\t\t}\n\n\t\treturn target.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\n\n\t},\n\n\tdistanceToPoint: function ( point ) {\n\n\t\treturn Math.sqrt( this.distanceSqToPoint( point ) );\n\n\t},\n\n\tdistanceSqToPoint: function ( point ) {\n\n\t\tconst directionDistance = _vector.subVectors( point, this.origin ).dot( this.direction );\n\n\t\t// point behind the ray\n\n\t\tif ( directionDistance < 0 ) {\n\n\t\t\treturn this.origin.distanceToSquared( point );\n\n\t\t}\n\n\t\t_vector.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\n\n\t\treturn _vector.distanceToSquared( point );\n\n\t},\n\n\tdistanceSqToSegment: function ( v0, v1, optionalPointOnRay, optionalPointOnSegment ) {\n\n\t\t// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteDistRaySegment.h\n\t\t// It returns the min distance between the ray and the segment\n\t\t// defined by v0 and v1\n\t\t// It can also set two optional targets :\n\t\t// - The closest point on the ray\n\t\t// - The closest point on the segment\n\n\t\t_segCenter.copy( v0 ).add( v1 ).multiplyScalar( 0.5 );\n\t\t_segDir.copy( v1 ).sub( v0 ).normalize();\n\t\t_diff.copy( this.origin ).sub( _segCenter );\n\n\t\tconst segExtent = v0.distanceTo( v1 ) * 0.5;\n\t\tconst a01 = - this.direction.dot( _segDir );\n\t\tconst b0 = _diff.dot( this.direction );\n\t\tconst b1 = - _diff.dot( _segDir );\n\t\tconst c = _diff.lengthSq();\n\t\tconst det = Math.abs( 1 - a01 * a01 );\n\t\tlet s0, s1, sqrDist, extDet;\n\n\t\tif ( det > 0 ) {\n\n\t\t\t// The ray and segment are not parallel.\n\n\t\t\ts0 = a01 * b1 - b0;\n\t\t\ts1 = a01 * b0 - b1;\n\t\t\textDet = segExtent * det;\n\n\t\t\tif ( s0 >= 0 ) {\n\n\t\t\t\tif ( s1 >= - extDet ) {\n\n\t\t\t\t\tif ( s1 <= extDet ) {\n\n\t\t\t\t\t\t// region 0\n\t\t\t\t\t\t// Minimum at interior points of ray and segment.\n\n\t\t\t\t\t\tconst invDet = 1 / det;\n\t\t\t\t\t\ts0 *= invDet;\n\t\t\t\t\t\ts1 *= invDet;\n\t\t\t\t\t\tsqrDist = s0 * ( s0 + a01 * s1 + 2 * b0 ) + s1 * ( a01 * s0 + s1 + 2 * b1 ) + c;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// region 1\n\n\t\t\t\t\t\ts1 = segExtent;\n\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// region 5\n\n\t\t\t\t\ts1 = - segExtent;\n\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\n\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( s1 <= - extDet ) {\n\n\t\t\t\t\t// region 4\n\n\t\t\t\t\ts0 = Math.max( 0, - ( - a01 * segExtent + b0 ) );\n\t\t\t\t\ts1 = ( s0 > 0 ) ? - segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\n\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\n\n\t\t\t\t} else if ( s1 <= extDet ) {\n\n\t\t\t\t\t// region 3\n\n\t\t\t\t\ts0 = 0;\n\t\t\t\t\ts1 = Math.min( Math.max( - segExtent, - b1 ), segExtent );\n\t\t\t\t\tsqrDist = s1 * ( s1 + 2 * b1 ) + c;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// region 2\n\n\t\t\t\t\ts0 = Math.max( 0, - ( a01 * segExtent + b0 ) );\n\t\t\t\t\ts1 = ( s0 > 0 ) ? segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\n\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// Ray and segment are parallel.\n\n\t\t\ts1 = ( a01 > 0 ) ? - segExtent : segExtent;\n\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\n\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\n\n\t\t}\n\n\t\tif ( optionalPointOnRay ) {\n\n\t\t\toptionalPointOnRay.copy( this.direction ).multiplyScalar( s0 ).add( this.origin );\n\n\t\t}\n\n\t\tif ( optionalPointOnSegment ) {\n\n\t\t\toptionalPointOnSegment.copy( _segDir ).multiplyScalar( s1 ).add( _segCenter );\n\n\t\t}\n\n\t\treturn sqrDist;\n\n\t},\n\n\tintersectSphere: function ( sphere, target ) {\n\n\t\t_vector.subVectors( sphere.center, this.origin );\n\t\tconst tca = _vector.dot( this.direction );\n\t\tconst d2 = _vector.dot( _vector ) - tca * tca;\n\t\tconst radius2 = sphere.radius * sphere.radius;\n\n\t\tif ( d2 > radius2 ) return null;\n\n\t\tconst thc = Math.sqrt( radius2 - d2 );\n\n\t\t// t0 = first intersect point - entrance on front of sphere\n\t\tconst t0 = tca - thc;\n\n\t\t// t1 = second intersect point - exit point on back of sphere\n\t\tconst t1 = tca + thc;\n\n\t\t// test to see if both t0 and t1 are behind the ray - if so, return null\n\t\tif ( t0 < 0 && t1 < 0 ) return null;\n\n\t\t// test to see if t0 is behind the ray:\n\t\t// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\n\t\t// in order to always return an intersect point that is in front of the ray.\n\t\tif ( t0 < 0 ) return this.at( t1, target );\n\n\t\t// else t0 is in front of the ray, so return the first collision point scaled by t0\n\t\treturn this.at( t0, target );\n\n\t},\n\n\tintersectsSphere: function ( sphere ) {\n\n\t\treturn this.distanceSqToPoint( sphere.center ) <= ( sphere.radius * sphere.radius );\n\n\t},\n\n\tdistanceToPlane: function ( plane ) {\n\n\t\tconst denominator = plane.normal.dot( this.direction );\n\n\t\tif ( denominator === 0 ) {\n\n\t\t\t// line is coplanar, return origin\n\t\t\tif ( plane.distanceToPoint( this.origin ) === 0 ) {\n\n\t\t\t\treturn 0;\n\n\t\t\t}\n\n\t\t\t// Null is preferable to undefined since undefined means.... it is undefined\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst t = - ( this.origin.dot( plane.normal ) + plane.constant ) / denominator;\n\n\t\t// Return if the ray never intersects the plane\n\n\t\treturn t >= 0 ? t : null;\n\n\t},\n\n\tintersectPlane: function ( plane, target ) {\n\n\t\tconst t = this.distanceToPlane( plane );\n\n\t\tif ( t === null ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\treturn this.at( t, target );\n\n\t},\n\n\tintersectsPlane: function ( plane ) {\n\n\t\t// check if the ray lies on the plane first\n\n\t\tconst distToPoint = plane.distanceToPoint( this.origin );\n\n\t\tif ( distToPoint === 0 ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\tconst denominator = plane.normal.dot( this.direction );\n\n\t\tif ( denominator * distToPoint < 0 ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\t// ray origin is behind the plane (and is pointing behind it)\n\n\t\treturn false;\n\n\t},\n\n\tintersectBox: function ( box, target ) {\n\n\t\tlet tmin, tmax, tymin, tymax, tzmin, tzmax;\n\n\t\tconst invdirx = 1 / this.direction.x,\n\t\t\tinvdiry = 1 / this.direction.y,\n\t\t\tinvdirz = 1 / this.direction.z;\n\n\t\tconst origin = this.origin;\n\n\t\tif ( invdirx >= 0 ) {\n\n\t\t\ttmin = ( box.min.x - origin.x ) * invdirx;\n\t\t\ttmax = ( box.max.x - origin.x ) * invdirx;\n\n\t\t} else {\n\n\t\t\ttmin = ( box.max.x - origin.x ) * invdirx;\n\t\t\ttmax = ( box.min.x - origin.x ) * invdirx;\n\n\t\t}\n\n\t\tif ( invdiry >= 0 ) {\n\n\t\t\ttymin = ( box.min.y - origin.y ) * invdiry;\n\t\t\ttymax = ( box.max.y - origin.y ) * invdiry;\n\n\t\t} else {\n\n\t\t\ttymin = ( box.max.y - origin.y ) * invdiry;\n\t\t\ttymax = ( box.min.y - origin.y ) * invdiry;\n\n\t\t}\n\n\t\tif ( ( tmin > tymax ) || ( tymin > tmax ) ) return null;\n\n\t\t// These lines also handle the case where tmin or tmax is NaN\n\t\t// (result of 0 * Infinity). x !== x returns true if x is NaN\n\n\t\tif ( tymin > tmin || tmin !== tmin ) tmin = tymin;\n\n\t\tif ( tymax < tmax || tmax !== tmax ) tmax = tymax;\n\n\t\tif ( invdirz >= 0 ) {\n\n\t\t\ttzmin = ( box.min.z - origin.z ) * invdirz;\n\t\t\ttzmax = ( box.max.z - origin.z ) * invdirz;\n\n\t\t} else {\n\n\t\t\ttzmin = ( box.max.z - origin.z ) * invdirz;\n\t\t\ttzmax = ( box.min.z - origin.z ) * invdirz;\n\n\t\t}\n\n\t\tif ( ( tmin > tzmax ) || ( tzmin > tmax ) ) return null;\n\n\t\tif ( tzmin > tmin || tmin !== tmin ) tmin = tzmin;\n\n\t\tif ( tzmax < tmax || tmax !== tmax ) tmax = tzmax;\n\n\t\t//return point closest to the ray (positive side)\n\n\t\tif ( tmax < 0 ) return null;\n\n\t\treturn this.at( tmin >= 0 ? tmin : tmax, target );\n\n\t},\n\n\tintersectsBox: function ( box ) {\n\n\t\treturn this.intersectBox( box, _vector ) !== null;\n\n\t},\n\n\tintersectTriangle: function ( a, b, c, backfaceCulling, target ) {\n\n\t\t// Compute the offset origin, edges, and normal.\n\n\t\t// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h\n\n\t\t_edge1.subVectors( b, a );\n\t\t_edge2.subVectors( c, a );\n\t\t_normal.crossVectors( _edge1, _edge2 );\n\n\t\t// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\n\t\t// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\n\t\t//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\n\t\t//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\n\t\t//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\n\t\tlet DdN = this.direction.dot( _normal );\n\t\tlet sign;\n\n\t\tif ( DdN > 0 ) {\n\n\t\t\tif ( backfaceCulling ) return null;\n\t\t\tsign = 1;\n\n\t\t} else if ( DdN < 0 ) {\n\n\t\t\tsign = - 1;\n\t\t\tDdN = - DdN;\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t_diff.subVectors( this.origin, a );\n\t\tconst DdQxE2 = sign * this.direction.dot( _edge2.crossVectors( _diff, _edge2 ) );\n\n\t\t// b1 < 0, no intersection\n\t\tif ( DdQxE2 < 0 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst DdE1xQ = sign * this.direction.dot( _edge1.cross( _diff ) );\n\n\t\t// b2 < 0, no intersection\n\t\tif ( DdE1xQ < 0 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// b1+b2 > 1, no intersection\n\t\tif ( DdQxE2 + DdE1xQ > DdN ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// Line intersects triangle, check if ray does.\n\t\tconst QdN = - sign * _diff.dot( _normal );\n\n\t\t// t < 0, no intersection\n\t\tif ( QdN < 0 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// Ray intersects triangle.\n\t\treturn this.at( QdN / DdN, target );\n\n\t},\n\n\tapplyMatrix4: function ( matrix4 ) {\n\n\t\tthis.origin.applyMatrix4( matrix4 );\n\t\tthis.direction.transformDirection( matrix4 );\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( ray ) {\n\n\t\treturn ray.origin.equals( this.origin ) && ray.direction.equals( this.direction );\n\n\t}\n\n} );\n\n\nexport { Ray };\n","import { Matrix3 } from './Matrix3.js';\nimport { Vector3 } from './Vector3.js';\n\n/**\n * @author bhouston / http://clara.io\n */\n\nconst _vector1 = new Vector3();\nconst _vector2 = new Vector3();\nconst _normalMatrix = new Matrix3();\n\nfunction Plane( normal, constant ) {\n\n\t// normal is assumed to be normalized\n\n\tthis.normal = ( normal !== undefined ) ? normal : new Vector3( 1, 0, 0 );\n\tthis.constant = ( constant !== undefined ) ? constant : 0;\n\n}\n\nObject.assign( Plane.prototype, {\n\n\tisPlane: true,\n\n\tset: function ( normal, constant ) {\n\n\t\tthis.normal.copy( normal );\n\t\tthis.constant = constant;\n\n\t\treturn this;\n\n\t},\n\n\tsetComponents: function ( x, y, z, w ) {\n\n\t\tthis.normal.set( x, y, z );\n\t\tthis.constant = w;\n\n\t\treturn this;\n\n\t},\n\n\tsetFromNormalAndCoplanarPoint: function ( normal, point ) {\n\n\t\tthis.normal.copy( normal );\n\t\tthis.constant = - point.dot( this.normal );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromCoplanarPoints: function ( a, b, c ) {\n\n\t\tconst normal = _vector1.subVectors( c, b ).cross( _vector2.subVectors( a, b ) ).normalize();\n\n\t\t// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\n\n\t\tthis.setFromNormalAndCoplanarPoint( normal, a );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( plane ) {\n\n\t\tthis.normal.copy( plane.normal );\n\t\tthis.constant = plane.constant;\n\n\t\treturn this;\n\n\t},\n\n\tnormalize: function () {\n\n\t\t// Note: will lead to a divide by zero if the plane is invalid.\n\n\t\tconst inverseNormalLength = 1.0 / this.normal.length();\n\t\tthis.normal.multiplyScalar( inverseNormalLength );\n\t\tthis.constant *= inverseNormalLength;\n\n\t\treturn this;\n\n\t},\n\n\tnegate: function () {\n\n\t\tthis.constant *= - 1;\n\t\tthis.normal.negate();\n\n\t\treturn this;\n\n\t},\n\n\tdistanceToPoint: function ( point ) {\n\n\t\treturn this.normal.dot( point ) + this.constant;\n\n\t},\n\n\tdistanceToSphere: function ( sphere ) {\n\n\t\treturn this.distanceToPoint( sphere.center ) - sphere.radius;\n\n\t},\n\n\tprojectPoint: function ( point, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Plane: .projectPoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn target.copy( this.normal ).multiplyScalar( - this.distanceToPoint( point ) ).add( point );\n\n\t},\n\n\tintersectLine: function ( line, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Plane: .intersectLine() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\tconst direction = line.delta( _vector1 );\n\n\t\tconst denominator = this.normal.dot( direction );\n\n\t\tif ( denominator === 0 ) {\n\n\t\t\t// line is coplanar, return origin\n\t\t\tif ( this.distanceToPoint( line.start ) === 0 ) {\n\n\t\t\t\treturn target.copy( line.start );\n\n\t\t\t}\n\n\t\t\t// Unsure if this is the correct method to handle this case.\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\tconst t = - ( line.start.dot( this.normal ) + this.constant ) / denominator;\n\n\t\tif ( t < 0 || t > 1 ) {\n\n\t\t\treturn undefined;\n\n\t\t}\n\n\t\treturn target.copy( direction ).multiplyScalar( t ).add( line.start );\n\n\t},\n\n\tintersectsLine: function ( line ) {\n\n\t\t// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\n\n\t\tconst startSign = this.distanceToPoint( line.start );\n\t\tconst endSign = this.distanceToPoint( line.end );\n\n\t\treturn ( startSign < 0 && endSign > 0 ) || ( endSign < 0 && startSign > 0 );\n\n\t},\n\n\tintersectsBox: function ( box ) {\n\n\t\treturn box.intersectsPlane( this );\n\n\t},\n\n\tintersectsSphere: function ( sphere ) {\n\n\t\treturn sphere.intersectsPlane( this );\n\n\t},\n\n\tcoplanarPoint: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Plane: .coplanarPoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn target.copy( this.normal ).multiplyScalar( - this.constant );\n\n\t},\n\n\tapplyMatrix4: function ( matrix, optionalNormalMatrix ) {\n\n\t\tconst normalMatrix = optionalNormalMatrix || _normalMatrix.getNormalMatrix( matrix );\n\n\t\tconst referencePoint = this.coplanarPoint( _vector1 ).applyMatrix4( matrix );\n\n\t\tconst normal = this.normal.applyMatrix3( normalMatrix ).normalize();\n\n\t\tthis.constant = - referencePoint.dot( normal );\n\n\t\treturn this;\n\n\t},\n\n\ttranslate: function ( offset ) {\n\n\t\tthis.constant -= offset.dot( this.normal );\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( plane ) {\n\n\t\treturn plane.normal.equals( this.normal ) && ( plane.constant === this.constant );\n\n\t}\n\n} );\n\n\nexport { Plane };\n","import { Vector3 } from './Vector3.js';\nimport { Plane } from './Plane.js';\n\n/**\n * @author bhouston / http://clara.io\n * @author mrdoob / http://mrdoob.com/\n */\n\nconst _v0 = new Vector3();\nconst _v1 = new Vector3();\nconst _v2 = new Vector3();\nconst _v3 = new Vector3();\n\nconst _vab = new Vector3();\nconst _vac = new Vector3();\nconst _vbc = new Vector3();\nconst _vap = new Vector3();\nconst _vbp = new Vector3();\nconst _vcp = new Vector3();\n\nfunction Triangle( a, b, c ) {\n\n\tthis.a = ( a !== undefined ) ? a : new Vector3();\n\tthis.b = ( b !== undefined ) ? b : new Vector3();\n\tthis.c = ( c !== undefined ) ? c : new Vector3();\n\n}\n\nObject.assign( Triangle, {\n\n\tgetNormal: function ( a, b, c, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Triangle: .getNormal() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\ttarget.subVectors( c, b );\n\t\t_v0.subVectors( a, b );\n\t\ttarget.cross( _v0 );\n\n\t\tconst targetLengthSq = target.lengthSq();\n\t\tif ( targetLengthSq > 0 ) {\n\n\t\t\treturn target.multiplyScalar( 1 / Math.sqrt( targetLengthSq ) );\n\n\t\t}\n\n\t\treturn target.set( 0, 0, 0 );\n\n\t},\n\n\t// static/instance method to calculate barycentric coordinates\n\t// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\n\tgetBarycoord: function ( point, a, b, c, target ) {\n\n\t\t_v0.subVectors( c, a );\n\t\t_v1.subVectors( b, a );\n\t\t_v2.subVectors( point, a );\n\n\t\tconst dot00 = _v0.dot( _v0 );\n\t\tconst dot01 = _v0.dot( _v1 );\n\t\tconst dot02 = _v0.dot( _v2 );\n\t\tconst dot11 = _v1.dot( _v1 );\n\t\tconst dot12 = _v1.dot( _v2 );\n\n\t\tconst denom = ( dot00 * dot11 - dot01 * dot01 );\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Triangle: .getBarycoord() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\t// collinear or singular triangle\n\t\tif ( denom === 0 ) {\n\n\t\t\t// arbitrary location outside of triangle?\n\t\t\t// not sure if this is the best idea, maybe should be returning undefined\n\t\t\treturn target.set( - 2, - 1, - 1 );\n\n\t\t}\n\n\t\tconst invDenom = 1 / denom;\n\t\tconst u = ( dot11 * dot02 - dot01 * dot12 ) * invDenom;\n\t\tconst v = ( dot00 * dot12 - dot01 * dot02 ) * invDenom;\n\n\t\t// barycentric coordinates must always sum to 1\n\t\treturn target.set( 1 - u - v, v, u );\n\n\t},\n\n\tcontainsPoint: function ( point, a, b, c ) {\n\n\t\tTriangle.getBarycoord( point, a, b, c, _v3 );\n\n\t\treturn ( _v3.x >= 0 ) && ( _v3.y >= 0 ) && ( ( _v3.x + _v3.y ) <= 1 );\n\n\t},\n\n\tgetUV: function ( point, p1, p2, p3, uv1, uv2, uv3, target ) {\n\n\t\tthis.getBarycoord( point, p1, p2, p3, _v3 );\n\n\t\ttarget.set( 0, 0 );\n\t\ttarget.addScaledVector( uv1, _v3.x );\n\t\ttarget.addScaledVector( uv2, _v3.y );\n\t\ttarget.addScaledVector( uv3, _v3.z );\n\n\t\treturn target;\n\n\t},\n\n\tisFrontFacing: function ( a, b, c, direction ) {\n\n\t\t_v0.subVectors( c, b );\n\t\t_v1.subVectors( a, b );\n\n\t\t// strictly front facing\n\t\treturn ( _v0.cross( _v1 ).dot( direction ) < 0 ) ? true : false;\n\n\t}\n\n} );\n\nObject.assign( Triangle.prototype, {\n\n\tset: function ( a, b, c ) {\n\n\t\tthis.a.copy( a );\n\t\tthis.b.copy( b );\n\t\tthis.c.copy( c );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromPointsAndIndices: function ( points, i0, i1, i2 ) {\n\n\t\tthis.a.copy( points[ i0 ] );\n\t\tthis.b.copy( points[ i1 ] );\n\t\tthis.c.copy( points[ i2 ] );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( triangle ) {\n\n\t\tthis.a.copy( triangle.a );\n\t\tthis.b.copy( triangle.b );\n\t\tthis.c.copy( triangle.c );\n\n\t\treturn this;\n\n\t},\n\n\tgetArea: function () {\n\n\t\t_v0.subVectors( this.c, this.b );\n\t\t_v1.subVectors( this.a, this.b );\n\n\t\treturn _v0.cross( _v1 ).length() * 0.5;\n\n\t},\n\n\tgetMidpoint: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Triangle: .getMidpoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\treturn target.addVectors( this.a, this.b ).add( this.c ).multiplyScalar( 1 / 3 );\n\n\t},\n\n\tgetNormal: function ( target ) {\n\n\t\treturn Triangle.getNormal( this.a, this.b, this.c, target );\n\n\t},\n\n\tgetPlane: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Triangle: .getPlane() target is now required' );\n\t\t\ttarget = new Plane();\n\n\t\t}\n\n\t\treturn target.setFromCoplanarPoints( this.a, this.b, this.c );\n\n\t},\n\n\tgetBarycoord: function ( point, target ) {\n\n\t\treturn Triangle.getBarycoord( point, this.a, this.b, this.c, target );\n\n\t},\n\n\tgetUV: function ( point, uv1, uv2, uv3, target ) {\n\n\t\treturn Triangle.getUV( point, this.a, this.b, this.c, uv1, uv2, uv3, target );\n\n\t},\n\n\tcontainsPoint: function ( point ) {\n\n\t\treturn Triangle.containsPoint( point, this.a, this.b, this.c );\n\n\t},\n\n\tisFrontFacing: function ( direction ) {\n\n\t\treturn Triangle.isFrontFacing( this.a, this.b, this.c, direction );\n\n\t},\n\n\tintersectsBox: function ( box ) {\n\n\t\treturn box.intersectsTriangle( this );\n\n\t},\n\n\tclosestPointToPoint: function ( p, target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Triangle: .closestPointToPoint() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\tconst a = this.a, b = this.b, c = this.c;\n\t\tlet v, w;\n\n\t\t// algorithm thanks to Real-Time Collision Detection by Christer Ericson,\n\t\t// published by Morgan Kaufmann Publishers, (c) 2005 Elsevier Inc.,\n\t\t// under the accompanying license; see chapter 5.1.5 for detailed explanation.\n\t\t// basically, we're distinguishing which of the voronoi regions of the triangle\n\t\t// the point lies in with the minimum amount of redundant computation.\n\n\t\t_vab.subVectors( b, a );\n\t\t_vac.subVectors( c, a );\n\t\t_vap.subVectors( p, a );\n\t\tconst d1 = _vab.dot( _vap );\n\t\tconst d2 = _vac.dot( _vap );\n\t\tif ( d1 <= 0 && d2 <= 0 ) {\n\n\t\t\t// vertex region of A; barycentric coords (1, 0, 0)\n\t\t\treturn target.copy( a );\n\n\t\t}\n\n\t\t_vbp.subVectors( p, b );\n\t\tconst d3 = _vab.dot( _vbp );\n\t\tconst d4 = _vac.dot( _vbp );\n\t\tif ( d3 >= 0 && d4 <= d3 ) {\n\n\t\t\t// vertex region of B; barycentric coords (0, 1, 0)\n\t\t\treturn target.copy( b );\n\n\t\t}\n\n\t\tconst vc = d1 * d4 - d3 * d2;\n\t\tif ( vc <= 0 && d1 >= 0 && d3 <= 0 ) {\n\n\t\t\tv = d1 / ( d1 - d3 );\n\t\t\t// edge region of AB; barycentric coords (1-v, v, 0)\n\t\t\treturn target.copy( a ).addScaledVector( _vab, v );\n\n\t\t}\n\n\t\t_vcp.subVectors( p, c );\n\t\tconst d5 = _vab.dot( _vcp );\n\t\tconst d6 = _vac.dot( _vcp );\n\t\tif ( d6 >= 0 && d5 <= d6 ) {\n\n\t\t\t// vertex region of C; barycentric coords (0, 0, 1)\n\t\t\treturn target.copy( c );\n\n\t\t}\n\n\t\tconst vb = d5 * d2 - d1 * d6;\n\t\tif ( vb <= 0 && d2 >= 0 && d6 <= 0 ) {\n\n\t\t\tw = d2 / ( d2 - d6 );\n\t\t\t// edge region of AC; barycentric coords (1-w, 0, w)\n\t\t\treturn target.copy( a ).addScaledVector( _vac, w );\n\n\t\t}\n\n\t\tconst va = d3 * d6 - d5 * d4;\n\t\tif ( va <= 0 && ( d4 - d3 ) >= 0 && ( d5 - d6 ) >= 0 ) {\n\n\t\t\t_vbc.subVectors( c, b );\n\t\t\tw = ( d4 - d3 ) / ( ( d4 - d3 ) + ( d5 - d6 ) );\n\t\t\t// edge region of BC; barycentric coords (0, 1-w, w)\n\t\t\treturn target.copy( b ).addScaledVector( _vbc, w ); // edge region of BC\n\n\t\t}\n\n\t\t// face region\n\t\tconst denom = 1 / ( va + vb + vc );\n\t\t// u = va * denom\n\t\tv = vb * denom;\n\t\tw = vc * denom;\n\n\t\treturn target.copy( a ).addScaledVector( _vab, v ).addScaledVector( _vac, w );\n\n\t},\n\n\tequals: function ( triangle ) {\n\n\t\treturn triangle.a.equals( this.a ) && triangle.b.equals( this.b ) && triangle.c.equals( this.c );\n\n\t}\n\n} );\n\n\nexport { Triangle };\n","import { MathUtils } from './MathUtils.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nconst _colorKeywords = { 'aliceblue': 0xF0F8FF, 'antiquewhite': 0xFAEBD7, 'aqua': 0x00FFFF, 'aquamarine': 0x7FFFD4, 'azure': 0xF0FFFF,\n\t'beige': 0xF5F5DC, 'bisque': 0xFFE4C4, 'black': 0x000000, 'blanchedalmond': 0xFFEBCD, 'blue': 0x0000FF, 'blueviolet': 0x8A2BE2,\n\t'brown': 0xA52A2A, 'burlywood': 0xDEB887, 'cadetblue': 0x5F9EA0, 'chartreuse': 0x7FFF00, 'chocolate': 0xD2691E, 'coral': 0xFF7F50,\n\t'cornflowerblue': 0x6495ED, 'cornsilk': 0xFFF8DC, 'crimson': 0xDC143C, 'cyan': 0x00FFFF, 'darkblue': 0x00008B, 'darkcyan': 0x008B8B,\n\t'darkgoldenrod': 0xB8860B, 'darkgray': 0xA9A9A9, 'darkgreen': 0x006400, 'darkgrey': 0xA9A9A9, 'darkkhaki': 0xBDB76B, 'darkmagenta': 0x8B008B,\n\t'darkolivegreen': 0x556B2F, 'darkorange': 0xFF8C00, 'darkorchid': 0x9932CC, 'darkred': 0x8B0000, 'darksalmon': 0xE9967A, 'darkseagreen': 0x8FBC8F,\n\t'darkslateblue': 0x483D8B, 'darkslategray': 0x2F4F4F, 'darkslategrey': 0x2F4F4F, 'darkturquoise': 0x00CED1, 'darkviolet': 0x9400D3,\n\t'deeppink': 0xFF1493, 'deepskyblue': 0x00BFFF, 'dimgray': 0x696969, 'dimgrey': 0x696969, 'dodgerblue': 0x1E90FF, 'firebrick': 0xB22222,\n\t'floralwhite': 0xFFFAF0, 'forestgreen': 0x228B22, 'fuchsia': 0xFF00FF, 'gainsboro': 0xDCDCDC, 'ghostwhite': 0xF8F8FF, 'gold': 0xFFD700,\n\t'goldenrod': 0xDAA520, 'gray': 0x808080, 'green': 0x008000, 'greenyellow': 0xADFF2F, 'grey': 0x808080, 'honeydew': 0xF0FFF0, 'hotpink': 0xFF69B4,\n\t'indianred': 0xCD5C5C, 'indigo': 0x4B0082, 'ivory': 0xFFFFF0, 'khaki': 0xF0E68C, 'lavender': 0xE6E6FA, 'lavenderblush': 0xFFF0F5, 'lawngreen': 0x7CFC00,\n\t'lemonchiffon': 0xFFFACD, 'lightblue': 0xADD8E6, 'lightcoral': 0xF08080, 'lightcyan': 0xE0FFFF, 'lightgoldenrodyellow': 0xFAFAD2, 'lightgray': 0xD3D3D3,\n\t'lightgreen': 0x90EE90, 'lightgrey': 0xD3D3D3, 'lightpink': 0xFFB6C1, 'lightsalmon': 0xFFA07A, 'lightseagreen': 0x20B2AA, 'lightskyblue': 0x87CEFA,\n\t'lightslategray': 0x778899, 'lightslategrey': 0x778899, 'lightsteelblue': 0xB0C4DE, 'lightyellow': 0xFFFFE0, 'lime': 0x00FF00, 'limegreen': 0x32CD32,\n\t'linen': 0xFAF0E6, 'magenta': 0xFF00FF, 'maroon': 0x800000, 'mediumaquamarine': 0x66CDAA, 'mediumblue': 0x0000CD, 'mediumorchid': 0xBA55D3,\n\t'mediumpurple': 0x9370DB, 'mediumseagreen': 0x3CB371, 'mediumslateblue': 0x7B68EE, 'mediumspringgreen': 0x00FA9A, 'mediumturquoise': 0x48D1CC,\n\t'mediumvioletred': 0xC71585, 'midnightblue': 0x191970, 'mintcream': 0xF5FFFA, 'mistyrose': 0xFFE4E1, 'moccasin': 0xFFE4B5, 'navajowhite': 0xFFDEAD,\n\t'navy': 0x000080, 'oldlace': 0xFDF5E6, 'olive': 0x808000, 'olivedrab': 0x6B8E23, 'orange': 0xFFA500, 'orangered': 0xFF4500, 'orchid': 0xDA70D6,\n\t'palegoldenrod': 0xEEE8AA, 'palegreen': 0x98FB98, 'paleturquoise': 0xAFEEEE, 'palevioletred': 0xDB7093, 'papayawhip': 0xFFEFD5, 'peachpuff': 0xFFDAB9,\n\t'peru': 0xCD853F, 'pink': 0xFFC0CB, 'plum': 0xDDA0DD, 'powderblue': 0xB0E0E6, 'purple': 0x800080, 'rebeccapurple': 0x663399, 'red': 0xFF0000, 'rosybrown': 0xBC8F8F,\n\t'royalblue': 0x4169E1, 'saddlebrown': 0x8B4513, 'salmon': 0xFA8072, 'sandybrown': 0xF4A460, 'seagreen': 0x2E8B57, 'seashell': 0xFFF5EE,\n\t'sienna': 0xA0522D, 'silver': 0xC0C0C0, 'skyblue': 0x87CEEB, 'slateblue': 0x6A5ACD, 'slategray': 0x708090, 'slategrey': 0x708090, 'snow': 0xFFFAFA,\n\t'springgreen': 0x00FF7F, 'steelblue': 0x4682B4, 'tan': 0xD2B48C, 'teal': 0x008080, 'thistle': 0xD8BFD8, 'tomato': 0xFF6347, 'turquoise': 0x40E0D0,\n\t'violet': 0xEE82EE, 'wheat': 0xF5DEB3, 'white': 0xFFFFFF, 'whitesmoke': 0xF5F5F5, 'yellow': 0xFFFF00, 'yellowgreen': 0x9ACD32 };\n\nconst _hslA = { h: 0, s: 0, l: 0 };\nconst _hslB = { h: 0, s: 0, l: 0 };\n\nfunction Color( r, g, b ) {\n\n\tif ( g === undefined && b === undefined ) {\n\n\t\t// r is THREE.Color, hex or string\n\t\treturn this.set( r );\n\n\t}\n\n\treturn this.setRGB( r, g, b );\n\n}\n\nfunction hue2rgb( p, q, t ) {\n\n\tif ( t < 0 ) t += 1;\n\tif ( t > 1 ) t -= 1;\n\tif ( t < 1 / 6 ) return p + ( q - p ) * 6 * t;\n\tif ( t < 1 / 2 ) return q;\n\tif ( t < 2 / 3 ) return p + ( q - p ) * 6 * ( 2 / 3 - t );\n\treturn p;\n\n}\n\nfunction SRGBToLinear( c ) {\n\n\treturn ( c < 0.04045 ) ? c * 0.0773993808 : Math.pow( c * 0.9478672986 + 0.0521327014, 2.4 );\n\n}\n\nfunction LinearToSRGB( c ) {\n\n\treturn ( c < 0.0031308 ) ? c * 12.92 : 1.055 * ( Math.pow( c, 0.41666 ) ) - 0.055;\n\n}\n\nObject.assign( Color.prototype, {\n\n\tisColor: true,\n\n\tr: 1, g: 1, b: 1,\n\n\tset: function ( value ) {\n\n\t\tif ( value && value.isColor ) {\n\n\t\t\tthis.copy( value );\n\n\t\t} else if ( typeof value === 'number' ) {\n\n\t\t\tthis.setHex( value );\n\n\t\t} else if ( typeof value === 'string' ) {\n\n\t\t\tthis.setStyle( value );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetScalar: function ( scalar ) {\n\n\t\tthis.r = scalar;\n\t\tthis.g = scalar;\n\t\tthis.b = scalar;\n\n\t\treturn this;\n\n\t},\n\n\tsetHex: function ( hex ) {\n\n\t\thex = Math.floor( hex );\n\n\t\tthis.r = ( hex >> 16 & 255 ) / 255;\n\t\tthis.g = ( hex >> 8 & 255 ) / 255;\n\t\tthis.b = ( hex & 255 ) / 255;\n\n\t\treturn this;\n\n\t},\n\n\tsetRGB: function ( r, g, b ) {\n\n\t\tthis.r = r;\n\t\tthis.g = g;\n\t\tthis.b = b;\n\n\t\treturn this;\n\n\t},\n\n\tsetHSL: function ( h, s, l ) {\n\n\t\t// h,s,l ranges are in 0.0 - 1.0\n\t\th = MathUtils.euclideanModulo( h, 1 );\n\t\ts = MathUtils.clamp( s, 0, 1 );\n\t\tl = MathUtils.clamp( l, 0, 1 );\n\n\t\tif ( s === 0 ) {\n\n\t\t\tthis.r = this.g = this.b = l;\n\n\t\t} else {\n\n\t\t\tconst p = l <= 0.5 ? l * ( 1 + s ) : l + s - ( l * s );\n\t\t\tconst q = ( 2 * l ) - p;\n\n\t\t\tthis.r = hue2rgb( q, p, h + 1 / 3 );\n\t\t\tthis.g = hue2rgb( q, p, h );\n\t\t\tthis.b = hue2rgb( q, p, h - 1 / 3 );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetStyle: function ( style ) {\n\n\t\tfunction handleAlpha( string ) {\n\n\t\t\tif ( string === undefined ) return;\n\n\t\t\tif ( parseFloat( string ) < 1 ) {\n\n\t\t\t\tconsole.warn( 'THREE.Color: Alpha component of ' + style + ' will be ignored.' );\n\n\t\t\t}\n\n\t\t}\n\n\n\t\tlet m;\n\n\t\tif ( m = /^((?:rgb|hsl)a?)\\(\\s*([^\\)]*)\\)/.exec( style ) ) {\n\n\t\t\t// rgb / hsl\n\n\t\t\tlet color;\n\t\t\tconst name = m[ 1 ];\n\t\t\tconst components = m[ 2 ];\n\n\t\t\tswitch ( name ) {\n\n\t\t\t\tcase 'rgb':\n\t\t\t\tcase 'rgba':\n\n\t\t\t\t\tif ( color = /^(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec( components ) ) {\n\n\t\t\t\t\t\t// rgb(255,0,0) rgba(255,0,0,0.5)\n\t\t\t\t\t\tthis.r = Math.min( 255, parseInt( color[ 1 ], 10 ) ) / 255;\n\t\t\t\t\t\tthis.g = Math.min( 255, parseInt( color[ 2 ], 10 ) ) / 255;\n\t\t\t\t\t\tthis.b = Math.min( 255, parseInt( color[ 3 ], 10 ) ) / 255;\n\n\t\t\t\t\t\thandleAlpha( color[ 5 ] );\n\n\t\t\t\t\t\treturn this;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( color = /^(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec( components ) ) {\n\n\t\t\t\t\t\t// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)\n\t\t\t\t\t\tthis.r = Math.min( 100, parseInt( color[ 1 ], 10 ) ) / 100;\n\t\t\t\t\t\tthis.g = Math.min( 100, parseInt( color[ 2 ], 10 ) ) / 100;\n\t\t\t\t\t\tthis.b = Math.min( 100, parseInt( color[ 3 ], 10 ) ) / 100;\n\n\t\t\t\t\t\thandleAlpha( color[ 5 ] );\n\n\t\t\t\t\t\treturn this;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'hsl':\n\t\t\t\tcase 'hsla':\n\n\t\t\t\t\tif ( color = /^([0-9]*\\.?[0-9]+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(,\\s*([0-9]*\\.?[0-9]+)\\s*)?$/.exec( components ) ) {\n\n\t\t\t\t\t\t// hsl(120,50%,50%) hsla(120,50%,50%,0.5)\n\t\t\t\t\t\tconst h = parseFloat( color[ 1 ] ) / 360;\n\t\t\t\t\t\tconst s = parseInt( color[ 2 ], 10 ) / 100;\n\t\t\t\t\t\tconst l = parseInt( color[ 3 ], 10 ) / 100;\n\n\t\t\t\t\t\thandleAlpha( color[ 5 ] );\n\n\t\t\t\t\t\treturn this.setHSL( h, s, l );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t} else if ( m = /^\\#([A-Fa-f0-9]+)$/.exec( style ) ) {\n\n\t\t\t// hex color\n\n\t\t\tconst hex = m[ 1 ];\n\t\t\tconst size = hex.length;\n\n\t\t\tif ( size === 3 ) {\n\n\t\t\t\t// #ff0\n\t\t\t\tthis.r = parseInt( hex.charAt( 0 ) + hex.charAt( 0 ), 16 ) / 255;\n\t\t\t\tthis.g = parseInt( hex.charAt( 1 ) + hex.charAt( 1 ), 16 ) / 255;\n\t\t\t\tthis.b = parseInt( hex.charAt( 2 ) + hex.charAt( 2 ), 16 ) / 255;\n\n\t\t\t\treturn this;\n\n\t\t\t} else if ( size === 6 ) {\n\n\t\t\t\t// #ff0000\n\t\t\t\tthis.r = parseInt( hex.charAt( 0 ) + hex.charAt( 1 ), 16 ) / 255;\n\t\t\t\tthis.g = parseInt( hex.charAt( 2 ) + hex.charAt( 3 ), 16 ) / 255;\n\t\t\t\tthis.b = parseInt( hex.charAt( 4 ) + hex.charAt( 5 ), 16 ) / 255;\n\n\t\t\t\treturn this;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( style && style.length > 0 ) {\n\n\t\t\treturn this.setColorName( style );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetColorName: function ( style ) {\n\n\t\t// color keywords\n\t\tconst hex = _colorKeywords[ style ];\n\n\t\tif ( hex !== undefined ) {\n\n\t\t\t// red\n\t\t\tthis.setHex( hex );\n\n\t\t} else {\n\n\t\t\t// unknown color\n\t\t\tconsole.warn( 'THREE.Color: Unknown color ' + style );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this.r, this.g, this.b );\n\n\t},\n\n\tcopy: function ( color ) {\n\n\t\tthis.r = color.r;\n\t\tthis.g = color.g;\n\t\tthis.b = color.b;\n\n\t\treturn this;\n\n\t},\n\n\tcopyGammaToLinear: function ( color, gammaFactor ) {\n\n\t\tif ( gammaFactor === undefined ) gammaFactor = 2.0;\n\n\t\tthis.r = Math.pow( color.r, gammaFactor );\n\t\tthis.g = Math.pow( color.g, gammaFactor );\n\t\tthis.b = Math.pow( color.b, gammaFactor );\n\n\t\treturn this;\n\n\t},\n\n\tcopyLinearToGamma: function ( color, gammaFactor ) {\n\n\t\tif ( gammaFactor === undefined ) gammaFactor = 2.0;\n\n\t\tconst safeInverse = ( gammaFactor > 0 ) ? ( 1.0 / gammaFactor ) : 1.0;\n\n\t\tthis.r = Math.pow( color.r, safeInverse );\n\t\tthis.g = Math.pow( color.g, safeInverse );\n\t\tthis.b = Math.pow( color.b, safeInverse );\n\n\t\treturn this;\n\n\t},\n\n\tconvertGammaToLinear: function ( gammaFactor ) {\n\n\t\tthis.copyGammaToLinear( this, gammaFactor );\n\n\t\treturn this;\n\n\t},\n\n\tconvertLinearToGamma: function ( gammaFactor ) {\n\n\t\tthis.copyLinearToGamma( this, gammaFactor );\n\n\t\treturn this;\n\n\t},\n\n\tcopySRGBToLinear: function ( color ) {\n\n\t\tthis.r = SRGBToLinear( color.r );\n\t\tthis.g = SRGBToLinear( color.g );\n\t\tthis.b = SRGBToLinear( color.b );\n\n\t\treturn this;\n\n\t},\n\n\tcopyLinearToSRGB: function ( color ) {\n\n\t\tthis.r = LinearToSRGB( color.r );\n\t\tthis.g = LinearToSRGB( color.g );\n\t\tthis.b = LinearToSRGB( color.b );\n\n\t\treturn this;\n\n\t},\n\n\tconvertSRGBToLinear: function () {\n\n\t\tthis.copySRGBToLinear( this );\n\n\t\treturn this;\n\n\t},\n\n\tconvertLinearToSRGB: function () {\n\n\t\tthis.copyLinearToSRGB( this );\n\n\t\treturn this;\n\n\t},\n\n\tgetHex: function () {\n\n\t\treturn ( this.r * 255 ) << 16 ^ ( this.g * 255 ) << 8 ^ ( this.b * 255 ) << 0;\n\n\t},\n\n\tgetHexString: function () {\n\n\t\treturn ( '000000' + this.getHex().toString( 16 ) ).slice( - 6 );\n\n\t},\n\n\tgetHSL: function ( target ) {\n\n\t\t// h,s,l ranges are in 0.0 - 1.0\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Color: .getHSL() target is now required' );\n\t\t\ttarget = { h: 0, s: 0, l: 0 };\n\n\t\t}\n\n\t\tconst r = this.r, g = this.g, b = this.b;\n\n\t\tconst max = Math.max( r, g, b );\n\t\tconst min = Math.min( r, g, b );\n\n\t\tlet hue, saturation;\n\t\tconst lightness = ( min + max ) / 2.0;\n\n\t\tif ( min === max ) {\n\n\t\t\thue = 0;\n\t\t\tsaturation = 0;\n\n\t\t} else {\n\n\t\t\tconst delta = max - min;\n\n\t\t\tsaturation = lightness <= 0.5 ? delta / ( max + min ) : delta / ( 2 - max - min );\n\n\t\t\tswitch ( max ) {\n\n\t\t\t\tcase r: hue = ( g - b ) / delta + ( g < b ? 6 : 0 ); break;\n\t\t\t\tcase g: hue = ( b - r ) / delta + 2; break;\n\t\t\t\tcase b: hue = ( r - g ) / delta + 4; break;\n\n\t\t\t}\n\n\t\t\thue /= 6;\n\n\t\t}\n\n\t\ttarget.h = hue;\n\t\ttarget.s = saturation;\n\t\ttarget.l = lightness;\n\n\t\treturn target;\n\n\t},\n\n\tgetStyle: function () {\n\n\t\treturn 'rgb(' + ( ( this.r * 255 ) | 0 ) + ',' + ( ( this.g * 255 ) | 0 ) + ',' + ( ( this.b * 255 ) | 0 ) + ')';\n\n\t},\n\n\toffsetHSL: function ( h, s, l ) {\n\n\t\tthis.getHSL( _hslA );\n\n\t\t_hslA.h += h; _hslA.s += s; _hslA.l += l;\n\n\t\tthis.setHSL( _hslA.h, _hslA.s, _hslA.l );\n\n\t\treturn this;\n\n\t},\n\n\tadd: function ( color ) {\n\n\t\tthis.r += color.r;\n\t\tthis.g += color.g;\n\t\tthis.b += color.b;\n\n\t\treturn this;\n\n\t},\n\n\taddColors: function ( color1, color2 ) {\n\n\t\tthis.r = color1.r + color2.r;\n\t\tthis.g = color1.g + color2.g;\n\t\tthis.b = color1.b + color2.b;\n\n\t\treturn this;\n\n\t},\n\n\taddScalar: function ( s ) {\n\n\t\tthis.r += s;\n\t\tthis.g += s;\n\t\tthis.b += s;\n\n\t\treturn this;\n\n\t},\n\n\tsub: function ( color ) {\n\n\t\tthis.r = Math.max( 0, this.r - color.r );\n\t\tthis.g = Math.max( 0, this.g - color.g );\n\t\tthis.b = Math.max( 0, this.b - color.b );\n\n\t\treturn this;\n\n\t},\n\n\tmultiply: function ( color ) {\n\n\t\tthis.r *= color.r;\n\t\tthis.g *= color.g;\n\t\tthis.b *= color.b;\n\n\t\treturn this;\n\n\t},\n\n\tmultiplyScalar: function ( s ) {\n\n\t\tthis.r *= s;\n\t\tthis.g *= s;\n\t\tthis.b *= s;\n\n\t\treturn this;\n\n\t},\n\n\tlerp: function ( color, alpha ) {\n\n\t\tthis.r += ( color.r - this.r ) * alpha;\n\t\tthis.g += ( color.g - this.g ) * alpha;\n\t\tthis.b += ( color.b - this.b ) * alpha;\n\n\t\treturn this;\n\n\t},\n\n\tlerpHSL: function ( color, alpha ) {\n\n\t\tthis.getHSL( _hslA );\n\t\tcolor.getHSL( _hslB );\n\n\t\tconst h = MathUtils.lerp( _hslA.h, _hslB.h, alpha );\n\t\tconst s = MathUtils.lerp( _hslA.s, _hslB.s, alpha );\n\t\tconst l = MathUtils.lerp( _hslA.l, _hslB.l, alpha );\n\n\t\tthis.setHSL( h, s, l );\n\n\t\treturn this;\n\n\t},\n\n\tequals: function ( c ) {\n\n\t\treturn ( c.r === this.r ) && ( c.g === this.g ) && ( c.b === this.b );\n\n\t},\n\n\tfromArray: function ( array, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tthis.r = array[ offset ];\n\t\tthis.g = array[ offset + 1 ];\n\t\tthis.b = array[ offset + 2 ];\n\n\t\treturn this;\n\n\t},\n\n\ttoArray: function ( array, offset ) {\n\n\t\tif ( array === undefined ) array = [];\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tarray[ offset ] = this.r;\n\t\tarray[ offset + 1 ] = this.g;\n\t\tarray[ offset + 2 ] = this.b;\n\n\t\treturn array;\n\n\t},\n\n\tfromBufferAttribute: function ( attribute, index ) {\n\n\t\tthis.r = attribute.getX( index );\n\t\tthis.g = attribute.getY( index );\n\t\tthis.b = attribute.getZ( index );\n\n\t\tif ( attribute.normalized === true ) {\n\n\t\t\t// assuming Uint8Array\n\n\t\t\tthis.r /= 255;\n\t\t\tthis.g /= 255;\n\t\t\tthis.b /= 255;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\ttoJSON: function () {\n\n\t\treturn this.getHex();\n\n\t}\n\n} );\n\nColor.NAMES = _colorKeywords;\n\nexport { Color };\n","import { Color } from '../math/Color.js';\nimport { Vector3 } from '../math/Vector3.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\n\nfunction Face3( a, b, c, normal, color, materialIndex ) {\n\n\tthis.a = a;\n\tthis.b = b;\n\tthis.c = c;\n\n\tthis.normal = ( normal && normal.isVector3 ) ? normal : new Vector3();\n\tthis.vertexNormals = Array.isArray( normal ) ? normal : [];\n\n\tthis.color = ( color && color.isColor ) ? color : new Color();\n\tthis.vertexColors = Array.isArray( color ) ? color : [];\n\n\tthis.materialIndex = materialIndex !== undefined ? materialIndex : 0;\n\n}\n\nObject.assign( Face3.prototype, {\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.a = source.a;\n\t\tthis.b = source.b;\n\t\tthis.c = source.c;\n\n\t\tthis.normal.copy( source.normal );\n\t\tthis.color.copy( source.color );\n\n\t\tthis.materialIndex = source.materialIndex;\n\n\t\tfor ( let i = 0, il = source.vertexNormals.length; i < il; i ++ ) {\n\n\t\t\tthis.vertexNormals[ i ] = source.vertexNormals[ i ].clone();\n\n\t\t}\n\n\t\tfor ( let i = 0, il = source.vertexColors.length; i < il; i ++ ) {\n\n\t\t\tthis.vertexColors[ i ] = source.vertexColors[ i ].clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { Face3 };\n","import { EventDispatcher } from '../core/EventDispatcher.js';\nimport { FrontSide, FlatShading, NormalBlending, LessEqualDepth, AddEquation, OneMinusSrcAlphaFactor, SrcAlphaFactor, AlwaysStencilFunc, KeepStencilOp } from '../constants.js';\nimport { MathUtils } from '../math/MathUtils.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\n\nlet materialId = 0;\n\nfunction Material() {\n\n\tObject.defineProperty( this, 'id', { value: materialId ++ } );\n\n\tthis.uuid = MathUtils.generateUUID();\n\n\tthis.name = '';\n\tthis.type = 'Material';\n\n\tthis.fog = true;\n\n\tthis.blending = NormalBlending;\n\tthis.side = FrontSide;\n\tthis.flatShading = false;\n\tthis.vertexColors = false;\n\n\tthis.opacity = 1;\n\tthis.transparent = false;\n\n\tthis.blendSrc = SrcAlphaFactor;\n\tthis.blendDst = OneMinusSrcAlphaFactor;\n\tthis.blendEquation = AddEquation;\n\tthis.blendSrcAlpha = null;\n\tthis.blendDstAlpha = null;\n\tthis.blendEquationAlpha = null;\n\n\tthis.depthFunc = LessEqualDepth;\n\tthis.depthTest = true;\n\tthis.depthWrite = true;\n\n\tthis.stencilWriteMask = 0xff;\n\tthis.stencilFunc = AlwaysStencilFunc;\n\tthis.stencilRef = 0;\n\tthis.stencilFuncMask = 0xff;\n\tthis.stencilFail = KeepStencilOp;\n\tthis.stencilZFail = KeepStencilOp;\n\tthis.stencilZPass = KeepStencilOp;\n\tthis.stencilWrite = false;\n\n\tthis.clippingPlanes = null;\n\tthis.clipIntersection = false;\n\tthis.clipShadows = false;\n\n\tthis.shadowSide = null;\n\n\tthis.colorWrite = true;\n\n\tthis.precision = null; // override the renderer's default precision for this material\n\n\tthis.polygonOffset = false;\n\tthis.polygonOffsetFactor = 0;\n\tthis.polygonOffsetUnits = 0;\n\n\tthis.dithering = false;\n\n\tthis.alphaTest = 0;\n\tthis.premultipliedAlpha = false;\n\n\tthis.visible = true;\n\n\tthis.toneMapped = true;\n\n\tthis.userData = {};\n\n\tthis.version = 0;\n\n}\n\nMaterial.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n\tconstructor: Material,\n\n\tisMaterial: true,\n\n\tonBeforeCompile: function ( /* shaderobject, renderer */ ) {},\n\n\tcustomProgramCacheKey: function () {\n\n\t\treturn this.onBeforeCompile.toString();\n\n\t},\n\n\tsetValues: function ( values ) {\n\n\t\tif ( values === undefined ) return;\n\n\t\tfor ( const key in values ) {\n\n\t\t\tconst newValue = values[ key ];\n\n\t\t\tif ( newValue === undefined ) {\n\n\t\t\t\tconsole.warn( \"THREE.Material: '\" + key + \"' parameter is undefined.\" );\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\t// for backward compatability if shading is set in the constructor\n\t\t\tif ( key === 'shading' ) {\n\n\t\t\t\tconsole.warn( 'THREE.' + this.type + ': .shading has been removed. Use the boolean .flatShading instead.' );\n\t\t\t\tthis.flatShading = ( newValue === FlatShading ) ? true : false;\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\tconst currentValue = this[ key ];\n\n\t\t\tif ( currentValue === undefined ) {\n\n\t\t\t\tconsole.warn( \"THREE.\" + this.type + \": '\" + key + \"' is not a property of this material.\" );\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\tif ( currentValue && currentValue.isColor ) {\n\n\t\t\t\tcurrentValue.set( newValue );\n\n\t\t\t} else if ( ( currentValue && currentValue.isVector3 ) && ( newValue && newValue.isVector3 ) ) {\n\n\t\t\t\tcurrentValue.copy( newValue );\n\n\t\t\t} else {\n\n\t\t\t\tthis[ key ] = newValue;\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\tconst isRoot = ( meta === undefined || typeof meta === 'string' );\n\n\t\tif ( isRoot ) {\n\n\t\t\tmeta = {\n\t\t\t\ttextures: {},\n\t\t\t\timages: {}\n\t\t\t};\n\n\t\t}\n\n\t\tconst data = {\n\t\t\tmetadata: {\n\t\t\t\tversion: 4.5,\n\t\t\t\ttype: 'Material',\n\t\t\t\tgenerator: 'Material.toJSON'\n\t\t\t}\n\t\t};\n\n\t\t// standard Material serialization\n\t\tdata.uuid = this.uuid;\n\t\tdata.type = this.type;\n\n\t\tif ( this.name !== '' ) data.name = this.name;\n\n\t\tif ( this.color && this.color.isColor ) data.color = this.color.getHex();\n\n\t\tif ( this.roughness !== undefined ) data.roughness = this.roughness;\n\t\tif ( this.metalness !== undefined ) data.metalness = this.metalness;\n\n\t\tif ( this.sheen && this.sheen.isColor ) data.sheen = this.sheen.getHex();\n\t\tif ( this.emissive && this.emissive.isColor ) data.emissive = this.emissive.getHex();\n\t\tif ( this.emissiveIntensity && this.emissiveIntensity !== 1 ) data.emissiveIntensity = this.emissiveIntensity;\n\n\t\tif ( this.specular && this.specular.isColor ) data.specular = this.specular.getHex();\n\t\tif ( this.shininess !== undefined ) data.shininess = this.shininess;\n\t\tif ( this.clearcoat !== undefined ) data.clearcoat = this.clearcoat;\n\t\tif ( this.clearcoatRoughness !== undefined ) data.clearcoatRoughness = this.clearcoatRoughness;\n\n\t\tif ( this.clearcoatMap && this.clearcoatMap.isTexture ) {\n\n\t\t\tdata.clearcoatMap = this.clearcoatMap.toJSON( meta ).uuid;\n\n\t\t}\n\n\t\tif ( this.clearcoatRoughnessMap && this.clearcoatRoughnessMap.isTexture ) {\n\n\t\t\tdata.clearcoatRoughnessMap = this.clearcoatRoughnessMap.toJSON( meta ).uuid;\n\n\t\t}\n\n\t\tif ( this.clearcoatNormalMap && this.clearcoatNormalMap.isTexture ) {\n\n\t\t\tdata.clearcoatNormalMap = this.clearcoatNormalMap.toJSON( meta ).uuid;\n\t\t\tdata.clearcoatNormalScale = this.clearcoatNormalScale.toArray();\n\n\t\t}\n\n\t\tif ( this.map && this.map.isTexture ) data.map = this.map.toJSON( meta ).uuid;\n\t\tif ( this.matcap && this.matcap.isTexture ) data.matcap = this.matcap.toJSON( meta ).uuid;\n\t\tif ( this.alphaMap && this.alphaMap.isTexture ) data.alphaMap = this.alphaMap.toJSON( meta ).uuid;\n\t\tif ( this.lightMap && this.lightMap.isTexture ) data.lightMap = this.lightMap.toJSON( meta ).uuid;\n\n\t\tif ( this.aoMap && this.aoMap.isTexture ) {\n\n\t\t\tdata.aoMap = this.aoMap.toJSON( meta ).uuid;\n\t\t\tdata.aoMapIntensity = this.aoMapIntensity;\n\n\t\t}\n\n\t\tif ( this.bumpMap && this.bumpMap.isTexture ) {\n\n\t\t\tdata.bumpMap = this.bumpMap.toJSON( meta ).uuid;\n\t\t\tdata.bumpScale = this.bumpScale;\n\n\t\t}\n\n\t\tif ( this.normalMap && this.normalMap.isTexture ) {\n\n\t\t\tdata.normalMap = this.normalMap.toJSON( meta ).uuid;\n\t\t\tdata.normalMapType = this.normalMapType;\n\t\t\tdata.normalScale = this.normalScale.toArray();\n\n\t\t}\n\n\t\tif ( this.displacementMap && this.displacementMap.isTexture ) {\n\n\t\t\tdata.displacementMap = this.displacementMap.toJSON( meta ).uuid;\n\t\t\tdata.displacementScale = this.displacementScale;\n\t\t\tdata.displacementBias = this.displacementBias;\n\n\t\t}\n\n\t\tif ( this.roughnessMap && this.roughnessMap.isTexture ) data.roughnessMap = this.roughnessMap.toJSON( meta ).uuid;\n\t\tif ( this.metalnessMap && this.metalnessMap.isTexture ) data.metalnessMap = this.metalnessMap.toJSON( meta ).uuid;\n\n\t\tif ( this.emissiveMap && this.emissiveMap.isTexture ) data.emissiveMap = this.emissiveMap.toJSON( meta ).uuid;\n\t\tif ( this.specularMap && this.specularMap.isTexture ) data.specularMap = this.specularMap.toJSON( meta ).uuid;\n\n\t\tif ( this.envMap && this.envMap.isTexture ) {\n\n\t\t\tdata.envMap = this.envMap.toJSON( meta ).uuid;\n\t\t\tdata.reflectivity = this.reflectivity; // Scale behind envMap\n\t\t\tdata.refractionRatio = this.refractionRatio;\n\n\t\t\tif ( this.combine !== undefined ) data.combine = this.combine;\n\t\t\tif ( this.envMapIntensity !== undefined ) data.envMapIntensity = this.envMapIntensity;\n\n\t\t}\n\n\t\tif ( this.gradientMap && this.gradientMap.isTexture ) {\n\n\t\t\tdata.gradientMap = this.gradientMap.toJSON( meta ).uuid;\n\n\t\t}\n\n\t\tif ( this.size !== undefined ) data.size = this.size;\n\t\tif ( this.sizeAttenuation !== undefined ) data.sizeAttenuation = this.sizeAttenuation;\n\n\t\tif ( this.blending !== NormalBlending ) data.blending = this.blending;\n\t\tif ( this.flatShading === true ) data.flatShading = this.flatShading;\n\t\tif ( this.side !== FrontSide ) data.side = this.side;\n\t\tif ( this.vertexColors ) data.vertexColors = true;\n\n\t\tif ( this.opacity < 1 ) data.opacity = this.opacity;\n\t\tif ( this.transparent === true ) data.transparent = this.transparent;\n\n\t\tdata.depthFunc = this.depthFunc;\n\t\tdata.depthTest = this.depthTest;\n\t\tdata.depthWrite = this.depthWrite;\n\n\t\tdata.stencilWrite = this.stencilWrite;\n\t\tdata.stencilWriteMask = this.stencilWriteMask;\n\t\tdata.stencilFunc = this.stencilFunc;\n\t\tdata.stencilRef = this.stencilRef;\n\t\tdata.stencilFuncMask = this.stencilFuncMask;\n\t\tdata.stencilFail = this.stencilFail;\n\t\tdata.stencilZFail = this.stencilZFail;\n\t\tdata.stencilZPass = this.stencilZPass;\n\n\t\t// rotation (SpriteMaterial)\n\t\tif ( this.rotation && this.rotation !== 0 ) data.rotation = this.rotation;\n\n\t\tif ( this.polygonOffset === true ) data.polygonOffset = true;\n\t\tif ( this.polygonOffsetFactor !== 0 ) data.polygonOffsetFactor = this.polygonOffsetFactor;\n\t\tif ( this.polygonOffsetUnits !== 0 ) data.polygonOffsetUnits = this.polygonOffsetUnits;\n\n\t\tif ( this.linewidth && this.linewidth !== 1 ) data.linewidth = this.linewidth;\n\t\tif ( this.dashSize !== undefined ) data.dashSize = this.dashSize;\n\t\tif ( this.gapSize !== undefined ) data.gapSize = this.gapSize;\n\t\tif ( this.scale !== undefined ) data.scale = this.scale;\n\n\t\tif ( this.dithering === true ) data.dithering = true;\n\n\t\tif ( this.alphaTest > 0 ) data.alphaTest = this.alphaTest;\n\t\tif ( this.premultipliedAlpha === true ) data.premultipliedAlpha = this.premultipliedAlpha;\n\n\t\tif ( this.wireframe === true ) data.wireframe = this.wireframe;\n\t\tif ( this.wireframeLinewidth > 1 ) data.wireframeLinewidth = this.wireframeLinewidth;\n\t\tif ( this.wireframeLinecap !== 'round' ) data.wireframeLinecap = this.wireframeLinecap;\n\t\tif ( this.wireframeLinejoin !== 'round' ) data.wireframeLinejoin = this.wireframeLinejoin;\n\n\t\tif ( this.morphTargets === true ) data.morphTargets = true;\n\t\tif ( this.morphNormals === true ) data.morphNormals = true;\n\t\tif ( this.skinning === true ) data.skinning = true;\n\n\t\tif ( this.visible === false ) data.visible = false;\n\n\t\tif ( this.toneMapped === false ) data.toneMapped = false;\n\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) data.userData = this.userData;\n\n\t\t// TODO: Copied from Object3D.toJSON\n\n\t\tfunction extractFromCache( cache ) {\n\n\t\t\tconst values = [];\n\n\t\t\tfor ( const key in cache ) {\n\n\t\t\t\tconst data = cache[ key ];\n\t\t\t\tdelete data.metadata;\n\t\t\t\tvalues.push( data );\n\n\t\t\t}\n\n\t\t\treturn values;\n\n\t\t}\n\n\t\tif ( isRoot ) {\n\n\t\t\tconst textures = extractFromCache( meta.textures );\n\t\t\tconst images = extractFromCache( meta.images );\n\n\t\t\tif ( textures.length > 0 ) data.textures = textures;\n\t\t\tif ( images.length > 0 ) data.images = images;\n\n\t\t}\n\n\t\treturn data;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.name = source.name;\n\n\t\tthis.fog = source.fog;\n\n\t\tthis.blending = source.blending;\n\t\tthis.side = source.side;\n\t\tthis.flatShading = source.flatShading;\n\t\tthis.vertexColors = source.vertexColors;\n\n\t\tthis.opacity = source.opacity;\n\t\tthis.transparent = source.transparent;\n\n\t\tthis.blendSrc = source.blendSrc;\n\t\tthis.blendDst = source.blendDst;\n\t\tthis.blendEquation = source.blendEquation;\n\t\tthis.blendSrcAlpha = source.blendSrcAlpha;\n\t\tthis.blendDstAlpha = source.blendDstAlpha;\n\t\tthis.blendEquationAlpha = source.blendEquationAlpha;\n\n\t\tthis.depthFunc = source.depthFunc;\n\t\tthis.depthTest = source.depthTest;\n\t\tthis.depthWrite = source.depthWrite;\n\n\t\tthis.stencilWriteMask = source.stencilWriteMask;\n\t\tthis.stencilFunc = source.stencilFunc;\n\t\tthis.stencilRef = source.stencilRef;\n\t\tthis.stencilFuncMask = source.stencilFuncMask;\n\t\tthis.stencilFail = source.stencilFail;\n\t\tthis.stencilZFail = source.stencilZFail;\n\t\tthis.stencilZPass = source.stencilZPass;\n\t\tthis.stencilWrite = source.stencilWrite;\n\n\t\tconst srcPlanes = source.clippingPlanes;\n\t\tlet dstPlanes = null;\n\n\t\tif ( srcPlanes !== null ) {\n\n\t\t\tconst n = srcPlanes.length;\n\t\t\tdstPlanes = new Array( n );\n\n\t\t\tfor ( let i = 0; i !== n; ++ i ) {\n\n\t\t\t\tdstPlanes[ i ] = srcPlanes[ i ].clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.clippingPlanes = dstPlanes;\n\t\tthis.clipIntersection = source.clipIntersection;\n\t\tthis.clipShadows = source.clipShadows;\n\n\t\tthis.shadowSide = source.shadowSide;\n\n\t\tthis.colorWrite = source.colorWrite;\n\n\t\tthis.precision = source.precision;\n\n\t\tthis.polygonOffset = source.polygonOffset;\n\t\tthis.polygonOffsetFactor = source.polygonOffsetFactor;\n\t\tthis.polygonOffsetUnits = source.polygonOffsetUnits;\n\n\t\tthis.dithering = source.dithering;\n\n\t\tthis.alphaTest = source.alphaTest;\n\t\tthis.premultipliedAlpha = source.premultipliedAlpha;\n\n\t\tthis.visible = source.visible;\n\n\t\tthis.toneMapped = source.toneMapped;\n\n\t\tthis.userData = JSON.parse( JSON.stringify( source.userData ) );\n\n\t\treturn this;\n\n\t},\n\n\tdispose: function () {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t}\n\n} );\n\nObject.defineProperty( Material.prototype, 'needsUpdate', {\n\n\tset: function ( value ) {\n\n\t\tif ( value === true ) this.version ++;\n\n\t}\n\n} );\n\nexport { Material };\n","import { Material } from './Material.js';\nimport { MultiplyOperation } from '../constants.js';\nimport { Color } from '../math/Color.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *  map: new THREE.Texture( <Image> ),\n *\n *  lightMap: new THREE.Texture( <Image> ),\n *  lightMapIntensity: <float>\n *\n *  aoMap: new THREE.Texture( <Image> ),\n *  aoMapIntensity: <float>\n *\n *  specularMap: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\n *  combine: THREE.Multiply,\n *  reflectivity: <float>,\n *  refractionRatio: <float>,\n *\n *  depthTest: <bool>,\n *  depthWrite: <bool>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>\n * }\n */\n\nfunction MeshBasicMaterial( parameters ) {\n\n\tMaterial.call( this );\n\n\tthis.type = 'MeshBasicMaterial';\n\n\tthis.color = new Color( 0xffffff ); // emissive\n\n\tthis.map = null;\n\n\tthis.lightMap = null;\n\tthis.lightMapIntensity = 1.0;\n\n\tthis.aoMap = null;\n\tthis.aoMapIntensity = 1.0;\n\n\tthis.specularMap = null;\n\n\tthis.alphaMap = null;\n\n\tthis.envMap = null;\n\tthis.combine = MultiplyOperation;\n\tthis.reflectivity = 1;\n\tthis.refractionRatio = 0.98;\n\n\tthis.wireframe = false;\n\tthis.wireframeLinewidth = 1;\n\tthis.wireframeLinecap = 'round';\n\tthis.wireframeLinejoin = 'round';\n\n\tthis.skinning = false;\n\tthis.morphTargets = false;\n\n\tthis.setValues( parameters );\n\n}\n\nMeshBasicMaterial.prototype = Object.create( Material.prototype );\nMeshBasicMaterial.prototype.constructor = MeshBasicMaterial;\n\nMeshBasicMaterial.prototype.isMeshBasicMaterial = true;\n\nMeshBasicMaterial.prototype.copy = function ( source ) {\n\n\tMaterial.prototype.copy.call( this, source );\n\n\tthis.color.copy( source.color );\n\n\tthis.map = source.map;\n\n\tthis.lightMap = source.lightMap;\n\tthis.lightMapIntensity = source.lightMapIntensity;\n\n\tthis.aoMap = source.aoMap;\n\tthis.aoMapIntensity = source.aoMapIntensity;\n\n\tthis.specularMap = source.specularMap;\n\n\tthis.alphaMap = source.alphaMap;\n\n\tthis.envMap = source.envMap;\n\tthis.combine = source.combine;\n\tthis.reflectivity = source.reflectivity;\n\tthis.refractionRatio = source.refractionRatio;\n\n\tthis.wireframe = source.wireframe;\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\n\tthis.wireframeLinecap = source.wireframeLinecap;\n\tthis.wireframeLinejoin = source.wireframeLinejoin;\n\n\tthis.skinning = source.skinning;\n\tthis.morphTargets = source.morphTargets;\n\n\treturn this;\n\n};\n\n\nexport { MeshBasicMaterial };\n","import { Vector4 } from '../math/Vector4.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Color } from '../math/Color.js';\nimport { StaticDrawUsage } from '../constants.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nconst _vector = new Vector3();\nconst _vector2 = new Vector2();\n\nfunction BufferAttribute( array, itemSize, normalized ) {\n\n\tif ( Array.isArray( array ) ) {\n\n\t\tthrow new TypeError( 'THREE.BufferAttribute: array should be a Typed Array.' );\n\n\t}\n\n\tthis.name = '';\n\n\tthis.array = array;\n\tthis.itemSize = itemSize;\n\tthis.count = array !== undefined ? array.length / itemSize : 0;\n\tthis.normalized = normalized === true;\n\n\tthis.usage = StaticDrawUsage;\n\tthis.updateRange = { offset: 0, count: - 1 };\n\n\tthis.version = 0;\n\n}\n\nObject.defineProperty( BufferAttribute.prototype, 'needsUpdate', {\n\n\tset: function ( value ) {\n\n\t\tif ( value === true ) this.version ++;\n\n\t}\n\n} );\n\nObject.assign( BufferAttribute.prototype, {\n\n\tisBufferAttribute: true,\n\n\tonUploadCallback: function () {},\n\n\tsetUsage: function ( value ) {\n\n\t\tthis.usage = value;\n\n\t\treturn this;\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.name = source.name;\n\t\tthis.array = new source.array.constructor( source.array );\n\t\tthis.itemSize = source.itemSize;\n\t\tthis.count = source.count;\n\t\tthis.normalized = source.normalized;\n\n\t\tthis.usage = source.usage;\n\n\t\treturn this;\n\n\t},\n\n\tcopyAt: function ( index1, attribute, index2 ) {\n\n\t\tindex1 *= this.itemSize;\n\t\tindex2 *= attribute.itemSize;\n\n\t\tfor ( let i = 0, l = this.itemSize; i < l; i ++ ) {\n\n\t\t\tthis.array[ index1 + i ] = attribute.array[ index2 + i ];\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcopyArray: function ( array ) {\n\n\t\tthis.array.set( array );\n\n\t\treturn this;\n\n\t},\n\n\tcopyColorsArray: function ( colors ) {\n\n\t\tconst array = this.array;\n\t\tlet offset = 0;\n\n\t\tfor ( let i = 0, l = colors.length; i < l; i ++ ) {\n\n\t\t\tlet color = colors[ i ];\n\n\t\t\tif ( color === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyColorsArray(): color is undefined', i );\n\t\t\t\tcolor = new Color();\n\n\t\t\t}\n\n\t\t\tarray[ offset ++ ] = color.r;\n\t\t\tarray[ offset ++ ] = color.g;\n\t\t\tarray[ offset ++ ] = color.b;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcopyVector2sArray: function ( vectors ) {\n\n\t\tconst array = this.array;\n\t\tlet offset = 0;\n\n\t\tfor ( let i = 0, l = vectors.length; i < l; i ++ ) {\n\n\t\t\tlet vector = vectors[ i ];\n\n\t\t\tif ( vector === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector2sArray(): vector is undefined', i );\n\t\t\t\tvector = new Vector2();\n\n\t\t\t}\n\n\t\t\tarray[ offset ++ ] = vector.x;\n\t\t\tarray[ offset ++ ] = vector.y;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcopyVector3sArray: function ( vectors ) {\n\n\t\tconst array = this.array;\n\t\tlet offset = 0;\n\n\t\tfor ( let i = 0, l = vectors.length; i < l; i ++ ) {\n\n\t\t\tlet vector = vectors[ i ];\n\n\t\t\tif ( vector === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector3sArray(): vector is undefined', i );\n\t\t\t\tvector = new Vector3();\n\n\t\t\t}\n\n\t\t\tarray[ offset ++ ] = vector.x;\n\t\t\tarray[ offset ++ ] = vector.y;\n\t\t\tarray[ offset ++ ] = vector.z;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcopyVector4sArray: function ( vectors ) {\n\n\t\tconst array = this.array;\n\t\tlet offset = 0;\n\n\t\tfor ( let i = 0, l = vectors.length; i < l; i ++ ) {\n\n\t\t\tlet vector = vectors[ i ];\n\n\t\t\tif ( vector === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector4sArray(): vector is undefined', i );\n\t\t\t\tvector = new Vector4();\n\n\t\t\t}\n\n\t\t\tarray[ offset ++ ] = vector.x;\n\t\t\tarray[ offset ++ ] = vector.y;\n\t\t\tarray[ offset ++ ] = vector.z;\n\t\t\tarray[ offset ++ ] = vector.w;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tapplyMatrix3: function ( m ) {\n\n\t\tif ( this.itemSize === 2 ) {\n\n\t\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\n\n\t\t\t\t_vector2.fromBufferAttribute( this, i );\n\t\t\t\t_vector2.applyMatrix3( m );\n\n\t\t\t\tthis.setXY( i, _vector2.x, _vector2.y, );\n\n\t\t\t}\n\n\t\t} else if ( this.itemSize === 3 ) {\n\n\t\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\n\n\t\t\t\t_vector.fromBufferAttribute( this, i );\n\t\t\t\t_vector.applyMatrix3( m );\n\n\t\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tapplyMatrix4: function ( m ) {\n\n\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\n\n\t\t\t_vector.x = this.getX( i );\n\t\t\t_vector.y = this.getY( i );\n\t\t\t_vector.z = this.getZ( i );\n\n\t\t\t_vector.applyMatrix4( m );\n\n\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tapplyNormalMatrix: function ( m ) {\n\n\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\n\n\t\t\t_vector.x = this.getX( i );\n\t\t\t_vector.y = this.getY( i );\n\t\t\t_vector.z = this.getZ( i );\n\n\t\t\t_vector.applyNormalMatrix( m );\n\n\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\ttransformDirection: function ( m ) {\n\n\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\n\n\t\t\t_vector.x = this.getX( i );\n\t\t\t_vector.y = this.getY( i );\n\t\t\t_vector.z = this.getZ( i );\n\n\t\t\t_vector.transformDirection( m );\n\n\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tset: function ( value, offset ) {\n\n\t\tif ( offset === undefined ) offset = 0;\n\n\t\tthis.array.set( value, offset );\n\n\t\treturn this;\n\n\t},\n\n\tgetX: function ( index ) {\n\n\t\treturn this.array[ index * this.itemSize ];\n\n\t},\n\n\tsetX: function ( index, x ) {\n\n\t\tthis.array[ index * this.itemSize ] = x;\n\n\t\treturn this;\n\n\t},\n\n\tgetY: function ( index ) {\n\n\t\treturn this.array[ index * this.itemSize + 1 ];\n\n\t},\n\n\tsetY: function ( index, y ) {\n\n\t\tthis.array[ index * this.itemSize + 1 ] = y;\n\n\t\treturn this;\n\n\t},\n\n\tgetZ: function ( index ) {\n\n\t\treturn this.array[ index * this.itemSize + 2 ];\n\n\t},\n\n\tsetZ: function ( index, z ) {\n\n\t\tthis.array[ index * this.itemSize + 2 ] = z;\n\n\t\treturn this;\n\n\t},\n\n\tgetW: function ( index ) {\n\n\t\treturn this.array[ index * this.itemSize + 3 ];\n\n\t},\n\n\tsetW: function ( index, w ) {\n\n\t\tthis.array[ index * this.itemSize + 3 ] = w;\n\n\t\treturn this;\n\n\t},\n\n\tsetXY: function ( index, x, y ) {\n\n\t\tindex *= this.itemSize;\n\n\t\tthis.array[ index + 0 ] = x;\n\t\tthis.array[ index + 1 ] = y;\n\n\t\treturn this;\n\n\t},\n\n\tsetXYZ: function ( index, x, y, z ) {\n\n\t\tindex *= this.itemSize;\n\n\t\tthis.array[ index + 0 ] = x;\n\t\tthis.array[ index + 1 ] = y;\n\t\tthis.array[ index + 2 ] = z;\n\n\t\treturn this;\n\n\t},\n\n\tsetXYZW: function ( index, x, y, z, w ) {\n\n\t\tindex *= this.itemSize;\n\n\t\tthis.array[ index + 0 ] = x;\n\t\tthis.array[ index + 1 ] = y;\n\t\tthis.array[ index + 2 ] = z;\n\t\tthis.array[ index + 3 ] = w;\n\n\t\treturn this;\n\n\t},\n\n\tonUpload: function ( callback ) {\n\n\t\tthis.onUploadCallback = callback;\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor( this.array, this.itemSize ).copy( this );\n\n\t},\n\n\ttoJSON: function () {\n\n\t\treturn {\n\t\t\titemSize: this.itemSize,\n\t\t\ttype: this.array.constructor.name,\n\t\t\tarray: Array.prototype.slice.call( this.array ),\n\t\t\tnormalized: this.normalized\n\t\t};\n\n\t}\n\n} );\n\n//\n\nfunction Int8BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Int8Array( array ), itemSize, normalized );\n\n}\n\nInt8BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nInt8BufferAttribute.prototype.constructor = Int8BufferAttribute;\n\n\nfunction Uint8BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Uint8Array( array ), itemSize, normalized );\n\n}\n\nUint8BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nUint8BufferAttribute.prototype.constructor = Uint8BufferAttribute;\n\n\nfunction Uint8ClampedBufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Uint8ClampedArray( array ), itemSize, normalized );\n\n}\n\nUint8ClampedBufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nUint8ClampedBufferAttribute.prototype.constructor = Uint8ClampedBufferAttribute;\n\n\nfunction Int16BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Int16Array( array ), itemSize, normalized );\n\n}\n\nInt16BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nInt16BufferAttribute.prototype.constructor = Int16BufferAttribute;\n\n\nfunction Uint16BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Uint16Array( array ), itemSize, normalized );\n\n}\n\nUint16BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nUint16BufferAttribute.prototype.constructor = Uint16BufferAttribute;\n\n\nfunction Int32BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Int32Array( array ), itemSize, normalized );\n\n}\n\nInt32BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nInt32BufferAttribute.prototype.constructor = Int32BufferAttribute;\n\n\nfunction Uint32BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Uint32Array( array ), itemSize, normalized );\n\n}\n\nUint32BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nUint32BufferAttribute.prototype.constructor = Uint32BufferAttribute;\n\n\nfunction Float32BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Float32Array( array ), itemSize, normalized );\n\n}\n\nFloat32BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nFloat32BufferAttribute.prototype.constructor = Float32BufferAttribute;\n\n\nfunction Float64BufferAttribute( array, itemSize, normalized ) {\n\n\tBufferAttribute.call( this, new Float64Array( array ), itemSize, normalized );\n\n}\n\nFloat64BufferAttribute.prototype = Object.create( BufferAttribute.prototype );\nFloat64BufferAttribute.prototype.constructor = Float64BufferAttribute;\n\n//\n\nexport {\n\tFloat64BufferAttribute,\n\tFloat32BufferAttribute,\n\tUint32BufferAttribute,\n\tInt32BufferAttribute,\n\tUint16BufferAttribute,\n\tInt16BufferAttribute,\n\tUint8ClampedBufferAttribute,\n\tUint8BufferAttribute,\n\tInt8BufferAttribute,\n\tBufferAttribute\n};\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { Vector2 } from '../math/Vector2.js';\n\nfunction DirectGeometry() {\n\n\tthis.vertices = [];\n\tthis.normals = [];\n\tthis.colors = [];\n\tthis.uvs = [];\n\tthis.uvs2 = [];\n\n\tthis.groups = [];\n\n\tthis.morphTargets = {};\n\n\tthis.skinWeights = [];\n\tthis.skinIndices = [];\n\n\t// this.lineDistances = [];\n\n\tthis.boundingBox = null;\n\tthis.boundingSphere = null;\n\n\t// update flags\n\n\tthis.verticesNeedUpdate = false;\n\tthis.normalsNeedUpdate = false;\n\tthis.colorsNeedUpdate = false;\n\tthis.uvsNeedUpdate = false;\n\tthis.groupsNeedUpdate = false;\n\n}\n\nObject.assign( DirectGeometry.prototype, {\n\n\tcomputeGroups: function ( geometry ) {\n\n\t\tconst groups = [];\n\n\t\tlet group, i;\n\t\tlet materialIndex = undefined;\n\n\t\tconst faces = geometry.faces;\n\n\t\tfor ( i = 0; i < faces.length; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\n\t\t\t// materials\n\n\t\t\tif ( face.materialIndex !== materialIndex ) {\n\n\t\t\t\tmaterialIndex = face.materialIndex;\n\n\t\t\t\tif ( group !== undefined ) {\n\n\t\t\t\t\tgroup.count = ( i * 3 ) - group.start;\n\t\t\t\t\tgroups.push( group );\n\n\t\t\t\t}\n\n\t\t\t\tgroup = {\n\t\t\t\t\tstart: i * 3,\n\t\t\t\t\tmaterialIndex: materialIndex\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( group !== undefined ) {\n\n\t\t\tgroup.count = ( i * 3 ) - group.start;\n\t\t\tgroups.push( group );\n\n\t\t}\n\n\t\tthis.groups = groups;\n\n\t},\n\n\tfromGeometry: function ( geometry ) {\n\n\t\tconst faces = geometry.faces;\n\t\tconst vertices = geometry.vertices;\n\t\tconst faceVertexUvs = geometry.faceVertexUvs;\n\n\t\tconst hasFaceVertexUv = faceVertexUvs[ 0 ] && faceVertexUvs[ 0 ].length > 0;\n\t\tconst hasFaceVertexUv2 = faceVertexUvs[ 1 ] && faceVertexUvs[ 1 ].length > 0;\n\n\t\t// morphs\n\n\t\tconst morphTargets = geometry.morphTargets;\n\t\tconst morphTargetsLength = morphTargets.length;\n\n\t\tlet morphTargetsPosition;\n\n\t\tif ( morphTargetsLength > 0 ) {\n\n\t\t\tmorphTargetsPosition = [];\n\n\t\t\tfor ( let i = 0; i < morphTargetsLength; i ++ ) {\n\n\t\t\t\tmorphTargetsPosition[ i ] = {\n\t\t\t\t\tname: morphTargets[ i ].name,\n\t\t\t\t \tdata: []\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis.morphTargets.position = morphTargetsPosition;\n\n\t\t}\n\n\t\tconst morphNormals = geometry.morphNormals;\n\t\tconst morphNormalsLength = morphNormals.length;\n\n\t\tlet morphTargetsNormal;\n\n\t\tif ( morphNormalsLength > 0 ) {\n\n\t\t\tmorphTargetsNormal = [];\n\n\t\t\tfor ( let i = 0; i < morphNormalsLength; i ++ ) {\n\n\t\t\t\tmorphTargetsNormal[ i ] = {\n\t\t\t\t\tname: morphNormals[ i ].name,\n\t\t\t\t \tdata: []\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tthis.morphTargets.normal = morphTargetsNormal;\n\n\t\t}\n\n\t\t// skins\n\n\t\tconst skinIndices = geometry.skinIndices;\n\t\tconst skinWeights = geometry.skinWeights;\n\n\t\tconst hasSkinIndices = skinIndices.length === vertices.length;\n\t\tconst hasSkinWeights = skinWeights.length === vertices.length;\n\n\t\t//\n\n\t\tif ( vertices.length > 0 && faces.length === 0 ) {\n\n\t\t\tconsole.error( 'THREE.DirectGeometry: Faceless geometries are not supported.' );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < faces.length; i ++ ) {\n\n\t\t\tconst face = faces[ i ];\n\n\t\t\tthis.vertices.push( vertices[ face.a ], vertices[ face.b ], vertices[ face.c ] );\n\n\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\tif ( vertexNormals.length === 3 ) {\n\n\t\t\t\tthis.normals.push( vertexNormals[ 0 ], vertexNormals[ 1 ], vertexNormals[ 2 ] );\n\n\t\t\t} else {\n\n\t\t\t\tconst normal = face.normal;\n\n\t\t\t\tthis.normals.push( normal, normal, normal );\n\n\t\t\t}\n\n\t\t\tconst vertexColors = face.vertexColors;\n\n\t\t\tif ( vertexColors.length === 3 ) {\n\n\t\t\t\tthis.colors.push( vertexColors[ 0 ], vertexColors[ 1 ], vertexColors[ 2 ] );\n\n\t\t\t} else {\n\n\t\t\t\tconst color = face.color;\n\n\t\t\t\tthis.colors.push( color, color, color );\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexUv === true ) {\n\n\t\t\t\tconst vertexUvs = faceVertexUvs[ 0 ][ i ];\n\n\t\t\t\tif ( vertexUvs !== undefined ) {\n\n\t\t\t\t\tthis.uvs.push( vertexUvs[ 0 ], vertexUvs[ 1 ], vertexUvs[ 2 ] );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ', i );\n\n\t\t\t\t\tthis.uvs.push( new Vector2(), new Vector2(), new Vector2() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexUv2 === true ) {\n\n\t\t\t\tconst vertexUvs = faceVertexUvs[ 1 ][ i ];\n\n\t\t\t\tif ( vertexUvs !== undefined ) {\n\n\t\t\t\t\tthis.uvs2.push( vertexUvs[ 0 ], vertexUvs[ 1 ], vertexUvs[ 2 ] );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ', i );\n\n\t\t\t\t\tthis.uvs2.push( new Vector2(), new Vector2(), new Vector2() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// morphs\n\n\t\t\tfor ( let j = 0; j < morphTargetsLength; j ++ ) {\n\n\t\t\t\tconst morphTarget = morphTargets[ j ].vertices;\n\n\t\t\t\tmorphTargetsPosition[ j ].data.push( morphTarget[ face.a ], morphTarget[ face.b ], morphTarget[ face.c ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0; j < morphNormalsLength; j ++ ) {\n\n\t\t\t\tconst morphNormal = morphNormals[ j ].vertexNormals[ i ];\n\n\t\t\t\tmorphTargetsNormal[ j ].data.push( morphNormal.a, morphNormal.b, morphNormal.c );\n\n\t\t\t}\n\n\t\t\t// skins\n\n\t\t\tif ( hasSkinIndices ) {\n\n\t\t\t\tthis.skinIndices.push( skinIndices[ face.a ], skinIndices[ face.b ], skinIndices[ face.c ] );\n\n\t\t\t}\n\n\t\t\tif ( hasSkinWeights ) {\n\n\t\t\t\tthis.skinWeights.push( skinWeights[ face.a ], skinWeights[ face.b ], skinWeights[ face.c ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.computeGroups( geometry );\n\n\t\tthis.verticesNeedUpdate = geometry.verticesNeedUpdate;\n\t\tthis.normalsNeedUpdate = geometry.normalsNeedUpdate;\n\t\tthis.colorsNeedUpdate = geometry.colorsNeedUpdate;\n\t\tthis.uvsNeedUpdate = geometry.uvsNeedUpdate;\n\t\tthis.groupsNeedUpdate = geometry.groupsNeedUpdate;\n\n\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t}\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { DirectGeometry };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction arrayMin( array ) {\n\n\tif ( array.length === 0 ) return Infinity;\n\n\tlet min = array[ 0 ];\n\n\tfor ( let i = 1, l = array.length; i < l; ++ i ) {\n\n\t\tif ( array[ i ] < min ) min = array[ i ];\n\n\t}\n\n\treturn min;\n\n}\n\nfunction arrayMax( array ) {\n\n\tif ( array.length === 0 ) return - Infinity;\n\n\tlet max = array[ 0 ];\n\n\tfor ( let i = 1, l = array.length; i < l; ++ i ) {\n\n\t\tif ( array[ i ] > max ) max = array[ i ];\n\n\t}\n\n\treturn max;\n\n}\n\nexport { arrayMin, arrayMax };\n","import { Vector3 } from '../math/Vector3.js';\nimport { Box3 } from '../math/Box3.js';\nimport { EventDispatcher } from './EventDispatcher.js';\nimport { BufferAttribute, Float32BufferAttribute, Uint16BufferAttribute, Uint32BufferAttribute } from './BufferAttribute.js';\nimport { Sphere } from '../math/Sphere.js';\nimport { DirectGeometry } from './DirectGeometry.js';\nimport { Object3D } from './Object3D.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { Matrix3 } from '../math/Matrix3.js';\nimport { MathUtils } from '../math/MathUtils.js';\nimport { arrayMax } from '../utils.js';\n\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */\n\nlet _bufferGeometryId = 1; // BufferGeometry uses odd numbers as Id\n\nconst _m1 = new Matrix4();\nconst _obj = new Object3D();\nconst _offset = new Vector3();\nconst _box = new Box3();\nconst _boxMorphTargets = new Box3();\nconst _vector = new Vector3();\n\nfunction BufferGeometry() {\n\n\tObject.defineProperty( this, 'id', { value: _bufferGeometryId += 2 } );\n\n\tthis.uuid = MathUtils.generateUUID();\n\n\tthis.name = '';\n\tthis.type = 'BufferGeometry';\n\n\tthis.index = null;\n\tthis.attributes = {};\n\n\tthis.morphAttributes = {};\n\tthis.morphTargetsRelative = false;\n\n\tthis.groups = [];\n\n\tthis.boundingBox = null;\n\tthis.boundingSphere = null;\n\n\tthis.drawRange = { start: 0, count: Infinity };\n\n\tthis.userData = {};\n\n}\n\nBufferGeometry.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n\tconstructor: BufferGeometry,\n\n\tisBufferGeometry: true,\n\n\tgetIndex: function () {\n\n\t\treturn this.index;\n\n\t},\n\n\tsetIndex: function ( index ) {\n\n\t\tif ( Array.isArray( index ) ) {\n\n\t\t\tthis.index = new ( arrayMax( index ) > 65535 ? Uint32BufferAttribute : Uint16BufferAttribute )( index, 1 );\n\n\t\t} else {\n\n\t\t\tthis.index = index;\n\n\t\t}\n\n\t},\n\n\tgetAttribute: function ( name ) {\n\n\t\treturn this.attributes[ name ];\n\n\t},\n\n\tsetAttribute: function ( name, attribute ) {\n\n\t\tthis.attributes[ name ] = attribute;\n\n\t\treturn this;\n\n\t},\n\n\tdeleteAttribute: function ( name ) {\n\n\t\tdelete this.attributes[ name ];\n\n\t\treturn this;\n\n\t},\n\n\taddGroup: function ( start, count, materialIndex ) {\n\n\t\tthis.groups.push( {\n\n\t\t\tstart: start,\n\t\t\tcount: count,\n\t\t\tmaterialIndex: materialIndex !== undefined ? materialIndex : 0\n\n\t\t} );\n\n\t},\n\n\tclearGroups: function () {\n\n\t\tthis.groups = [];\n\n\t},\n\n\tsetDrawRange: function ( start, count ) {\n\n\t\tthis.drawRange.start = start;\n\t\tthis.drawRange.count = count;\n\n\t},\n\n\tapplyMatrix4: function ( matrix ) {\n\n\t\tconst position = this.attributes.position;\n\n\t\tif ( position !== undefined ) {\n\n\t\t\tposition.applyMatrix4( matrix );\n\n\t\t\tposition.needsUpdate = true;\n\n\t\t}\n\n\t\tconst normal = this.attributes.normal;\n\n\t\tif ( normal !== undefined ) {\n\n\t\t\tconst normalMatrix = new Matrix3().getNormalMatrix( matrix );\n\n\t\t\tnormal.applyNormalMatrix( normalMatrix );\n\n\t\t\tnormal.needsUpdate = true;\n\n\t\t}\n\n\t\tconst tangent = this.attributes.tangent;\n\n\t\tif ( tangent !== undefined ) {\n\n\t\t\ttangent.transformDirection( matrix );\n\n\t\t\ttangent.needsUpdate = true;\n\n\t\t}\n\n\t\tif ( this.boundingBox !== null ) {\n\n\t\t\tthis.computeBoundingBox();\n\n\t\t}\n\n\t\tif ( this.boundingSphere !== null ) {\n\n\t\t\tthis.computeBoundingSphere();\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\trotateX: function ( angle ) {\n\n\t\t// rotate geometry around world x-axis\n\n\t\t_m1.makeRotationX( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\trotateY: function ( angle ) {\n\n\t\t// rotate geometry around world y-axis\n\n\t\t_m1.makeRotationY( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\trotateZ: function ( angle ) {\n\n\t\t// rotate geometry around world z-axis\n\n\t\t_m1.makeRotationZ( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\ttranslate: function ( x, y, z ) {\n\n\t\t// translate geometry\n\n\t\t_m1.makeTranslation( x, y, z );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\tscale: function ( x, y, z ) {\n\n\t\t// scale geometry\n\n\t\t_m1.makeScale( x, y, z );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\tlookAt: function ( vector ) {\n\n\t\t_obj.lookAt( vector );\n\n\t\t_obj.updateMatrix();\n\n\t\tthis.applyMatrix4( _obj.matrix );\n\n\t\treturn this;\n\n\t},\n\n\tcenter: function () {\n\n\t\tthis.computeBoundingBox();\n\n\t\tthis.boundingBox.getCenter( _offset ).negate();\n\n\t\tthis.translate( _offset.x, _offset.y, _offset.z );\n\n\t\treturn this;\n\n\t},\n\n\tsetFromObject: function ( object ) {\n\n\t\t// console.log( 'THREE.BufferGeometry.setFromObject(). Converting', object, this );\n\n\t\tconst geometry = object.geometry;\n\n\t\tif ( object.isPoints || object.isLine ) {\n\n\t\t\tconst positions = new Float32BufferAttribute( geometry.vertices.length * 3, 3 );\n\t\t\tconst colors = new Float32BufferAttribute( geometry.colors.length * 3, 3 );\n\n\t\t\tthis.setAttribute( 'position', positions.copyVector3sArray( geometry.vertices ) );\n\t\t\tthis.setAttribute( 'color', colors.copyColorsArray( geometry.colors ) );\n\n\t\t\tif ( geometry.lineDistances && geometry.lineDistances.length === geometry.vertices.length ) {\n\n\t\t\t\tconst lineDistances = new Float32BufferAttribute( geometry.lineDistances.length, 1 );\n\n\t\t\t\tthis.setAttribute( 'lineDistance', lineDistances.copyArray( geometry.lineDistances ) );\n\n\t\t\t}\n\n\t\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t\t}\n\n\t\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\t\tthis.boundingBox = geometry.boundingBox.clone();\n\n\t\t\t}\n\n\t\t} else if ( object.isMesh ) {\n\n\t\t\tif ( geometry && geometry.isGeometry ) {\n\n\t\t\t\tthis.fromGeometry( geometry );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetFromPoints: function ( points ) {\n\n\t\tconst position = [];\n\n\t\tfor ( let i = 0, l = points.length; i < l; i ++ ) {\n\n\t\t\tconst point = points[ i ];\n\t\t\tposition.push( point.x, point.y, point.z || 0 );\n\n\t\t}\n\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( position, 3 ) );\n\n\t\treturn this;\n\n\t},\n\n\tupdateFromObject: function ( object ) {\n\n\t\tlet geometry = object.geometry;\n\n\t\tif ( object.isMesh ) {\n\n\t\t\tlet direct = geometry.__directGeometry;\n\n\t\t\tif ( geometry.elementsNeedUpdate === true ) {\n\n\t\t\t\tdirect = undefined;\n\t\t\t\tgeometry.elementsNeedUpdate = false;\n\n\t\t\t}\n\n\t\t\tif ( direct === undefined ) {\n\n\t\t\t\treturn this.fromGeometry( geometry );\n\n\t\t\t}\n\n\t\t\tdirect.verticesNeedUpdate = geometry.verticesNeedUpdate;\n\t\t\tdirect.normalsNeedUpdate = geometry.normalsNeedUpdate;\n\t\t\tdirect.colorsNeedUpdate = geometry.colorsNeedUpdate;\n\t\t\tdirect.uvsNeedUpdate = geometry.uvsNeedUpdate;\n\t\t\tdirect.groupsNeedUpdate = geometry.groupsNeedUpdate;\n\n\t\t\tgeometry.verticesNeedUpdate = false;\n\t\t\tgeometry.normalsNeedUpdate = false;\n\t\t\tgeometry.colorsNeedUpdate = false;\n\t\t\tgeometry.uvsNeedUpdate = false;\n\t\t\tgeometry.groupsNeedUpdate = false;\n\n\t\t\tgeometry = direct;\n\n\t\t}\n\n\t\tif ( geometry.verticesNeedUpdate === true ) {\n\n\t\t\tconst attribute = this.attributes.position;\n\n\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\tattribute.copyVector3sArray( geometry.vertices );\n\t\t\t\tattribute.needsUpdate = true;\n\n\t\t\t}\n\n\t\t\tgeometry.verticesNeedUpdate = false;\n\n\t\t}\n\n\t\tif ( geometry.normalsNeedUpdate === true ) {\n\n\t\t\tconst attribute = this.attributes.normal;\n\n\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\tattribute.copyVector3sArray( geometry.normals );\n\t\t\t\tattribute.needsUpdate = true;\n\n\t\t\t}\n\n\t\t\tgeometry.normalsNeedUpdate = false;\n\n\t\t}\n\n\t\tif ( geometry.colorsNeedUpdate === true ) {\n\n\t\t\tconst attribute = this.attributes.color;\n\n\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\tattribute.copyColorsArray( geometry.colors );\n\t\t\t\tattribute.needsUpdate = true;\n\n\t\t\t}\n\n\t\t\tgeometry.colorsNeedUpdate = false;\n\n\t\t}\n\n\t\tif ( geometry.uvsNeedUpdate ) {\n\n\t\t\tconst attribute = this.attributes.uv;\n\n\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\tattribute.copyVector2sArray( geometry.uvs );\n\t\t\t\tattribute.needsUpdate = true;\n\n\t\t\t}\n\n\t\t\tgeometry.uvsNeedUpdate = false;\n\n\t\t}\n\n\t\tif ( geometry.lineDistancesNeedUpdate ) {\n\n\t\t\tconst attribute = this.attributes.lineDistance;\n\n\t\t\tif ( attribute !== undefined ) {\n\n\t\t\t\tattribute.copyArray( geometry.lineDistances );\n\t\t\t\tattribute.needsUpdate = true;\n\n\t\t\t}\n\n\t\t\tgeometry.lineDistancesNeedUpdate = false;\n\n\t\t}\n\n\t\tif ( geometry.groupsNeedUpdate ) {\n\n\t\t\tgeometry.computeGroups( object.geometry );\n\t\t\tthis.groups = geometry.groups;\n\n\t\t\tgeometry.groupsNeedUpdate = false;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tfromGeometry: function ( geometry ) {\n\n\t\tgeometry.__directGeometry = new DirectGeometry().fromGeometry( geometry );\n\n\t\treturn this.fromDirectGeometry( geometry.__directGeometry );\n\n\t},\n\n\tfromDirectGeometry: function ( geometry ) {\n\n\t\tconst positions = new Float32Array( geometry.vertices.length * 3 );\n\t\tthis.setAttribute( 'position', new BufferAttribute( positions, 3 ).copyVector3sArray( geometry.vertices ) );\n\n\t\tif ( geometry.normals.length > 0 ) {\n\n\t\t\tconst normals = new Float32Array( geometry.normals.length * 3 );\n\t\t\tthis.setAttribute( 'normal', new BufferAttribute( normals, 3 ).copyVector3sArray( geometry.normals ) );\n\n\t\t}\n\n\t\tif ( geometry.colors.length > 0 ) {\n\n\t\t\tconst colors = new Float32Array( geometry.colors.length * 3 );\n\t\t\tthis.setAttribute( 'color', new BufferAttribute( colors, 3 ).copyColorsArray( geometry.colors ) );\n\n\t\t}\n\n\t\tif ( geometry.uvs.length > 0 ) {\n\n\t\t\tconst uvs = new Float32Array( geometry.uvs.length * 2 );\n\t\t\tthis.setAttribute( 'uv', new BufferAttribute( uvs, 2 ).copyVector2sArray( geometry.uvs ) );\n\n\t\t}\n\n\t\tif ( geometry.uvs2.length > 0 ) {\n\n\t\t\tconst uvs2 = new Float32Array( geometry.uvs2.length * 2 );\n\t\t\tthis.setAttribute( 'uv2', new BufferAttribute( uvs2, 2 ).copyVector2sArray( geometry.uvs2 ) );\n\n\t\t}\n\n\t\t// groups\n\n\t\tthis.groups = geometry.groups;\n\n\t\t// morphs\n\n\t\tfor ( const name in geometry.morphTargets ) {\n\n\t\t\tconst array = [];\n\t\t\tconst morphTargets = geometry.morphTargets[ name ];\n\n\t\t\tfor ( let i = 0, l = morphTargets.length; i < l; i ++ ) {\n\n\t\t\t\tconst morphTarget = morphTargets[ i ];\n\n\t\t\t\tconst attribute = new Float32BufferAttribute( morphTarget.data.length * 3, 3 );\n\t\t\t\tattribute.name = morphTarget.name;\n\n\t\t\t\tarray.push( attribute.copyVector3sArray( morphTarget.data ) );\n\n\t\t\t}\n\n\t\t\tthis.morphAttributes[ name ] = array;\n\n\t\t}\n\n\t\t// skinning\n\n\t\tif ( geometry.skinIndices.length > 0 ) {\n\n\t\t\tconst skinIndices = new Float32BufferAttribute( geometry.skinIndices.length * 4, 4 );\n\t\t\tthis.setAttribute( 'skinIndex', skinIndices.copyVector4sArray( geometry.skinIndices ) );\n\n\t\t}\n\n\t\tif ( geometry.skinWeights.length > 0 ) {\n\n\t\t\tconst skinWeights = new Float32BufferAttribute( geometry.skinWeights.length * 4, 4 );\n\t\t\tthis.setAttribute( 'skinWeight', skinWeights.copyVector4sArray( geometry.skinWeights ) );\n\n\t\t}\n\n\t\t//\n\n\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t}\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcomputeBoundingBox: function () {\n\n\t\tif ( this.boundingBox === null ) {\n\n\t\t\tthis.boundingBox = new Box3();\n\n\t\t}\n\n\t\tconst position = this.attributes.position;\n\t\tconst morphAttributesPosition = this.morphAttributes.position;\n\n\t\tif ( position !== undefined ) {\n\n\t\t\tthis.boundingBox.setFromBufferAttribute( position );\n\n\t\t\t// process morph attributes if present\n\n\t\t\tif ( morphAttributesPosition ) {\n\n\t\t\t\tfor ( let i = 0, il = morphAttributesPosition.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst morphAttribute = morphAttributesPosition[ i ];\n\t\t\t\t\t_box.setFromBufferAttribute( morphAttribute );\n\n\t\t\t\t\tif ( this.morphTargetsRelative ) {\n\n\t\t\t\t\t\t_vector.addVectors( this.boundingBox.min, _box.min );\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _vector );\n\n\t\t\t\t\t\t_vector.addVectors( this.boundingBox.max, _box.max );\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _vector );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _box.min );\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _box.max );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tthis.boundingBox.makeEmpty();\n\n\t\t}\n\n\t\tif ( isNaN( this.boundingBox.min.x ) || isNaN( this.boundingBox.min.y ) || isNaN( this.boundingBox.min.z ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.', this );\n\n\t\t}\n\n\t},\n\n\tcomputeBoundingSphere: function () {\n\n\t\tif ( this.boundingSphere === null ) {\n\n\t\t\tthis.boundingSphere = new Sphere();\n\n\t\t}\n\n\t\tconst position = this.attributes.position;\n\t\tconst morphAttributesPosition = this.morphAttributes.position;\n\n\t\tif ( position ) {\n\n\t\t\t// first, find the center of the bounding sphere\n\n\t\t\tconst center = this.boundingSphere.center;\n\n\t\t\t_box.setFromBufferAttribute( position );\n\n\t\t\t// process morph attributes if present\n\n\t\t\tif ( morphAttributesPosition ) {\n\n\t\t\t\tfor ( let i = 0, il = morphAttributesPosition.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst morphAttribute = morphAttributesPosition[ i ];\n\t\t\t\t\t_boxMorphTargets.setFromBufferAttribute( morphAttribute );\n\n\t\t\t\t\tif ( this.morphTargetsRelative ) {\n\n\t\t\t\t\t\t_vector.addVectors( _box.min, _boxMorphTargets.min );\n\t\t\t\t\t\t_box.expandByPoint( _vector );\n\n\t\t\t\t\t\t_vector.addVectors( _box.max, _boxMorphTargets.max );\n\t\t\t\t\t\t_box.expandByPoint( _vector );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t_box.expandByPoint( _boxMorphTargets.min );\n\t\t\t\t\t\t_box.expandByPoint( _boxMorphTargets.max );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_box.getCenter( center );\n\n\t\t\t// second, try to find a boundingSphere with a radius smaller than the\n\t\t\t// boundingSphere of the boundingBox: sqrt(3) smaller in the best case\n\n\t\t\tlet maxRadiusSq = 0;\n\n\t\t\tfor ( let i = 0, il = position.count; i < il; i ++ ) {\n\n\t\t\t\t_vector.fromBufferAttribute( position, i );\n\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\n\n\t\t\t}\n\n\t\t\t// process morph attributes if present\n\n\t\t\tif ( morphAttributesPosition ) {\n\n\t\t\t\tfor ( let i = 0, il = morphAttributesPosition.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst morphAttribute = morphAttributesPosition[ i ];\n\t\t\t\t\tconst morphTargetsRelative = this.morphTargetsRelative;\n\n\t\t\t\t\tfor ( let j = 0, jl = morphAttribute.count; j < jl; j ++ ) {\n\n\t\t\t\t\t\t_vector.fromBufferAttribute( morphAttribute, j );\n\n\t\t\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t\t\t_offset.fromBufferAttribute( position, j );\n\t\t\t\t\t\t\t_vector.add( _offset );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.boundingSphere.radius = Math.sqrt( maxRadiusSq );\n\n\t\t\tif ( isNaN( this.boundingSphere.radius ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.', this );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\tcomputeFaceNormals: function () {\n\n\t\t// backwards compatibility\n\n\t},\n\n\tcomputeVertexNormals: function () {\n\n\t\tconst index = this.index;\n\t\tconst positionAttribute = this.getAttribute( 'position' );\n\n\t\tif ( positionAttribute !== undefined ) {\n\n\t\t\tlet normalAttribute = this.getAttribute( 'normal' );\n\n\t\t\tif ( normalAttribute === undefined ) {\n\n\t\t\t\tnormalAttribute = new BufferAttribute( new Float32Array( positionAttribute.count * 3 ), 3 );\n\t\t\t\tthis.setAttribute( 'normal', normalAttribute );\n\n\t\t\t} else {\n\n\t\t\t\t// reset existing normals to zero\n\n\t\t\t\tfor ( let i = 0, il = normalAttribute.count; i < il; i ++ ) {\n\n\t\t\t\t\tnormalAttribute.setXYZ( i, 0, 0, 0 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst pA = new Vector3(), pB = new Vector3(), pC = new Vector3();\n\t\t\tconst nA = new Vector3(), nB = new Vector3(), nC = new Vector3();\n\t\t\tconst cb = new Vector3(), ab = new Vector3();\n\n\t\t\t// indexed elements\n\n\t\t\tif ( index ) {\n\n\t\t\t\tfor ( let i = 0, il = index.count; i < il; i += 3 ) {\n\n\t\t\t\t\tconst vA = index.getX( i + 0 );\n\t\t\t\t\tconst vB = index.getX( i + 1 );\n\t\t\t\t\tconst vC = index.getX( i + 2 );\n\n\t\t\t\t\tpA.fromBufferAttribute( positionAttribute, vA );\n\t\t\t\t\tpB.fromBufferAttribute( positionAttribute, vB );\n\t\t\t\t\tpC.fromBufferAttribute( positionAttribute, vC );\n\n\t\t\t\t\tcb.subVectors( pC, pB );\n\t\t\t\t\tab.subVectors( pA, pB );\n\t\t\t\t\tcb.cross( ab );\n\n\t\t\t\t\tnA.fromBufferAttribute( normalAttribute, vA );\n\t\t\t\t\tnB.fromBufferAttribute( normalAttribute, vB );\n\t\t\t\t\tnC.fromBufferAttribute( normalAttribute, vC );\n\n\t\t\t\t\tnA.add( cb );\n\t\t\t\t\tnB.add( cb );\n\t\t\t\t\tnC.add( cb );\n\n\t\t\t\t\tnormalAttribute.setXYZ( vA, nA.x, nA.y, nA.z );\n\t\t\t\t\tnormalAttribute.setXYZ( vB, nB.x, nB.y, nB.z );\n\t\t\t\t\tnormalAttribute.setXYZ( vC, nC.x, nC.y, nC.z );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// non-indexed elements (unconnected triangle soup)\n\n\t\t\t\tfor ( let i = 0, il = positionAttribute.count; i < il; i += 3 ) {\n\n\t\t\t\t\tpA.fromBufferAttribute( positionAttribute, i + 0 );\n\t\t\t\t\tpB.fromBufferAttribute( positionAttribute, i + 1 );\n\t\t\t\t\tpC.fromBufferAttribute( positionAttribute, i + 2 );\n\n\t\t\t\t\tcb.subVectors( pC, pB );\n\t\t\t\t\tab.subVectors( pA, pB );\n\t\t\t\t\tcb.cross( ab );\n\n\t\t\t\t\tnormalAttribute.setXYZ( i + 0, cb.x, cb.y, cb.z );\n\t\t\t\t\tnormalAttribute.setXYZ( i + 1, cb.x, cb.y, cb.z );\n\t\t\t\t\tnormalAttribute.setXYZ( i + 2, cb.x, cb.y, cb.z );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.normalizeNormals();\n\n\t\t\tnormalAttribute.needsUpdate = true;\n\n\t\t}\n\n\t},\n\n\tmerge: function ( geometry, offset ) {\n\n\t\tif ( ! ( geometry && geometry.isBufferGeometry ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( offset === undefined ) {\n\n\t\t\toffset = 0;\n\n\t\t\tconsole.warn(\n\t\t\t\t'THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. '\n\t\t\t\t+ 'Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.'\n\t\t\t);\n\n\t\t}\n\n\t\tconst attributes = this.attributes;\n\n\t\tfor ( const key in attributes ) {\n\n\t\t\tif ( geometry.attributes[ key ] === undefined ) continue;\n\n\t\t\tconst attribute1 = attributes[ key ];\n\t\t\tconst attributeArray1 = attribute1.array;\n\n\t\t\tconst attribute2 = geometry.attributes[ key ];\n\t\t\tconst attributeArray2 = attribute2.array;\n\n\t\t\tconst attributeOffset = attribute2.itemSize * offset;\n\t\t\tconst length = Math.min( attributeArray2.length, attributeArray1.length - attributeOffset );\n\n\t\t\tfor ( let i = 0, j = attributeOffset; i < length; i ++, j ++ ) {\n\n\t\t\t\tattributeArray1[ j ] = attributeArray2[ i ];\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tnormalizeNormals: function () {\n\n\t\tconst normals = this.attributes.normal;\n\n\t\tfor ( let i = 0, il = normals.count; i < il; i ++ ) {\n\n\t\t\t_vector.fromBufferAttribute( normals, i );\n\n\t\t\t_vector.normalize();\n\n\t\t\tnormals.setXYZ( i, _vector.x, _vector.y, _vector.z );\n\n\t\t}\n\n\t},\n\n\ttoNonIndexed: function () {\n\n\t\tfunction convertBufferAttribute( attribute, indices ) {\n\n\t\t\tconst array = attribute.array;\n\t\t\tconst itemSize = attribute.itemSize;\n\t\t\tconst normalized = attribute.normalized;\n\n\t\t\tconst array2 = new array.constructor( indices.length * itemSize );\n\n\t\t\tlet index = 0, index2 = 0;\n\n\t\t\tfor ( let i = 0, l = indices.length; i < l; i ++ ) {\n\n\t\t\t\tindex = indices[ i ] * itemSize;\n\n\t\t\t\tfor ( let j = 0; j < itemSize; j ++ ) {\n\n\t\t\t\t\tarray2[ index2 ++ ] = array[ index ++ ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new BufferAttribute( array2, itemSize, normalized );\n\n\t\t}\n\n\t\t//\n\n\t\tif ( this.index === null ) {\n\n\t\t\tconsole.warn( 'THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.' );\n\t\t\treturn this;\n\n\t\t}\n\n\t\tconst geometry2 = new BufferGeometry();\n\n\t\tconst indices = this.index.array;\n\t\tconst attributes = this.attributes;\n\n\t\t// attributes\n\n\t\tfor ( const name in attributes ) {\n\n\t\t\tconst attribute = attributes[ name ];\n\n\t\t\tconst newAttribute = convertBufferAttribute( attribute, indices );\n\n\t\t\tgeometry2.setAttribute( name, newAttribute );\n\n\t\t}\n\n\t\t// morph attributes\n\n\t\tconst morphAttributes = this.morphAttributes;\n\n\t\tfor ( const name in morphAttributes ) {\n\n\t\t\tconst morphArray = [];\n\t\t\tconst morphAttribute = morphAttributes[ name ]; // morphAttribute: array of Float32BufferAttributes\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst attribute = morphAttribute[ i ];\n\n\t\t\t\tconst newAttribute = convertBufferAttribute( attribute, indices );\n\n\t\t\t\tmorphArray.push( newAttribute );\n\n\t\t\t}\n\n\t\t\tgeometry2.morphAttributes[ name ] = morphArray;\n\n\t\t}\n\n\t\tgeometry2.morphTargetsRelative = this.morphTargetsRelative;\n\n\t\t// groups\n\n\t\tconst groups = this.groups;\n\n\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\n\n\t\t\tconst group = groups[ i ];\n\t\t\tgeometry2.addGroup( group.start, group.count, group.materialIndex );\n\n\t\t}\n\n\t\treturn geometry2;\n\n\t},\n\n\ttoJSON: function () {\n\n\t\tconst data = {\n\t\t\tmetadata: {\n\t\t\t\tversion: 4.5,\n\t\t\t\ttype: 'BufferGeometry',\n\t\t\t\tgenerator: 'BufferGeometry.toJSON'\n\t\t\t}\n\t\t};\n\n\t\t// standard BufferGeometry serialization\n\n\t\tdata.uuid = this.uuid;\n\t\tdata.type = this.type;\n\t\tif ( this.name !== '' ) data.name = this.name;\n\t\tif ( Object.keys( this.userData ).length > 0 ) data.userData = this.userData;\n\n\t\tif ( this.parameters !== undefined ) {\n\n\t\t\tconst parameters = this.parameters;\n\n\t\t\tfor ( const key in parameters ) {\n\n\t\t\t\tif ( parameters[ key ] !== undefined ) data[ key ] = parameters[ key ];\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tdata.data = { attributes: {} };\n\n\t\tconst index = this.index;\n\n\t\tif ( index !== null ) {\n\n\t\t\tdata.data.index = {\n\t\t\t\ttype: index.array.constructor.name,\n\t\t\t\tarray: Array.prototype.slice.call( index.array )\n\t\t\t};\n\n\t\t}\n\n\t\tconst attributes = this.attributes;\n\n\t\tfor ( const key in attributes ) {\n\n\t\t\tconst attribute = attributes[ key ];\n\n\t\t\tconst attributeData = attribute.toJSON( data.data );\n\n\t\t\tif ( attribute.name !== '' ) attributeData.name = attribute.name;\n\n\t\t\tdata.data.attributes[ key ] = attributeData;\n\n\t\t}\n\n\t\tconst morphAttributes = {};\n\t\tlet hasMorphAttributes = false;\n\n\t\tfor ( const key in this.morphAttributes ) {\n\n\t\t\tconst attributeArray = this.morphAttributes[ key ];\n\n\t\t\tconst array = [];\n\n\t\t\tfor ( let i = 0, il = attributeArray.length; i < il; i ++ ) {\n\n\t\t\t\tconst attribute = attributeArray[ i ];\n\n\t\t\t\tconst attributeData = attribute.toJSON( data.data );\n\n\t\t\t\tif ( attribute.name !== '' ) attributeData.name = attribute.name;\n\n\t\t\t\tarray.push( attributeData );\n\n\t\t\t}\n\n\t\t\tif ( array.length > 0 ) {\n\n\t\t\t\tmorphAttributes[ key ] = array;\n\n\t\t\t\thasMorphAttributes = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( hasMorphAttributes ) {\n\n\t\t\tdata.data.morphAttributes = morphAttributes;\n\t\t\tdata.data.morphTargetsRelative = this.morphTargetsRelative;\n\n\t\t}\n\n\t\tconst groups = this.groups;\n\n\t\tif ( groups.length > 0 ) {\n\n\t\t\tdata.data.groups = JSON.parse( JSON.stringify( groups ) );\n\n\t\t}\n\n\t\tconst boundingSphere = this.boundingSphere;\n\n\t\tif ( boundingSphere !== null ) {\n\n\t\t\tdata.data.boundingSphere = {\n\t\t\t\tcenter: boundingSphere.center.toArray(),\n\t\t\t\tradius: boundingSphere.radius\n\t\t\t};\n\n\t\t}\n\n\t\treturn data;\n\n\t},\n\n\tclone: function () {\n\n\t\t/*\n\t\t // Handle primitives\n\n\t\t const parameters = this.parameters;\n\n\t\t if ( parameters !== undefined ) {\n\n\t\t const values = [];\n\n\t\t for ( const key in parameters ) {\n\n\t\t values.push( parameters[ key ] );\n\n\t\t }\n\n\t\t const geometry = Object.create( this.constructor.prototype );\n\t\t this.constructor.apply( geometry, values );\n\t\t return geometry;\n\n\t\t }\n\n\t\t return new this.constructor().copy( this );\n\t\t */\n\n\t\treturn new BufferGeometry().copy( this );\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\t// reset\n\n\t\tthis.index = null;\n\t\tthis.attributes = {};\n\t\tthis.morphAttributes = {};\n\t\tthis.groups = [];\n\t\tthis.boundingBox = null;\n\t\tthis.boundingSphere = null;\n\n\t\t// used for storing cloned, shared data\n\n\t\tconst data = {};\n\n\t\t// name\n\n\t\tthis.name = source.name;\n\n\t\t// index\n\n\t\tconst index = source.index;\n\n\t\tif ( index !== null ) {\n\n\t\t\tthis.setIndex( index.clone( data ) );\n\n\t\t}\n\n\t\t// attributes\n\n\t\tconst attributes = source.attributes;\n\n\t\tfor ( const name in attributes ) {\n\n\t\t\tconst attribute = attributes[ name ];\n\t\t\tthis.setAttribute( name, attribute.clone( data ) );\n\n\t\t}\n\n\t\t// morph attributes\n\n\t\tconst morphAttributes = source.morphAttributes;\n\n\t\tfor ( const name in morphAttributes ) {\n\n\t\t\tconst array = [];\n\t\t\tconst morphAttribute = morphAttributes[ name ]; // morphAttribute: array of Float32BufferAttributes\n\n\t\t\tfor ( let i = 0, l = morphAttribute.length; i < l; i ++ ) {\n\n\t\t\t\tarray.push( morphAttribute[ i ].clone( data ) );\n\n\t\t\t}\n\n\t\t\tthis.morphAttributes[ name ] = array;\n\n\t\t}\n\n\t\tthis.morphTargetsRelative = source.morphTargetsRelative;\n\n\t\t// groups\n\n\t\tconst groups = source.groups;\n\n\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\n\n\t\t\tconst group = groups[ i ];\n\t\t\tthis.addGroup( group.start, group.count, group.materialIndex );\n\n\t\t}\n\n\t\t// bounding box\n\n\t\tconst boundingBox = source.boundingBox;\n\n\t\tif ( boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = boundingBox.clone();\n\n\t\t}\n\n\t\t// bounding sphere\n\n\t\tconst boundingSphere = source.boundingSphere;\n\n\t\tif ( boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = boundingSphere.clone();\n\n\t\t}\n\n\t\t// draw range\n\n\t\tthis.drawRange.start = source.drawRange.start;\n\t\tthis.drawRange.count = source.drawRange.count;\n\n\t\t// user data\n\n\t\tthis.userData = source.userData;\n\n\t\treturn this;\n\n\t},\n\n\tdispose: function () {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t}\n\n} );\n\n\nexport { BufferGeometry };\n","import { Vector3 } from '../math/Vector3.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Sphere } from '../math/Sphere.js';\nimport { Ray } from '../math/Ray.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { Object3D } from '../core/Object3D.js';\nimport { Triangle } from '../math/Triangle.js';\nimport { Face3 } from '../core/Face3.js';\nimport { DoubleSide, BackSide } from '../constants.js';\nimport { MeshBasicMaterial } from '../materials/MeshBasicMaterial.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author mikael emtinger / http://gomo.se/\n * @author jonobr1 / http://jonobr1.com/\n */\n\nconst _inverseMatrix = new Matrix4();\nconst _ray = new Ray();\nconst _sphere = new Sphere();\n\nconst _vA = new Vector3();\nconst _vB = new Vector3();\nconst _vC = new Vector3();\n\nconst _tempA = new Vector3();\nconst _tempB = new Vector3();\nconst _tempC = new Vector3();\n\nconst _morphA = new Vector3();\nconst _morphB = new Vector3();\nconst _morphC = new Vector3();\n\nconst _uvA = new Vector2();\nconst _uvB = new Vector2();\nconst _uvC = new Vector2();\n\nconst _intersectionPoint = new Vector3();\nconst _intersectionPointWorld = new Vector3();\n\nfunction Mesh( geometry, material ) {\n\n\tObject3D.call( this );\n\n\tthis.type = 'Mesh';\n\n\tthis.geometry = geometry !== undefined ? geometry : new BufferGeometry();\n\tthis.material = material !== undefined ? material : new MeshBasicMaterial();\n\n\tthis.updateMorphTargets();\n\n}\n\nMesh.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Mesh,\n\n\tisMesh: true,\n\n\tcopy: function ( source ) {\n\n\t\tObject3D.prototype.copy.call( this, source );\n\n\t\tif ( source.morphTargetInfluences !== undefined ) {\n\n\t\t\tthis.morphTargetInfluences = source.morphTargetInfluences.slice();\n\n\t\t}\n\n\t\tif ( source.morphTargetDictionary !== undefined ) {\n\n\t\t\tthis.morphTargetDictionary = Object.assign( {}, source.morphTargetDictionary );\n\n\t\t}\n\n\t\tthis.material = source.material;\n\t\tthis.geometry = source.geometry;\n\n\t\treturn this;\n\n\t},\n\n\tupdateMorphTargets: function () {\n\n\t\tconst geometry = this.geometry;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tconst morphAttributes = geometry.morphAttributes;\n\t\t\tconst keys = Object.keys( morphAttributes );\n\n\t\t\tif ( keys.length > 0 ) {\n\n\t\t\t\tconst morphAttribute = morphAttributes[ keys[ 0 ] ];\n\n\t\t\t\tif ( morphAttribute !== undefined ) {\n\n\t\t\t\t\tthis.morphTargetInfluences = [];\n\t\t\t\t\tthis.morphTargetDictionary = {};\n\n\t\t\t\t\tfor ( let m = 0, ml = morphAttribute.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\tconst name = morphAttribute[ m ].name || String( m );\n\n\t\t\t\t\t\tthis.morphTargetInfluences.push( 0 );\n\t\t\t\t\t\tthis.morphTargetDictionary[ name ] = m;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst morphTargets = geometry.morphTargets;\n\n\t\t\tif ( morphTargets !== undefined && morphTargets.length > 0 ) {\n\n\t\t\t\tconsole.error( 'THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.' );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\traycast: function ( raycaster, intersects ) {\n\n\t\tconst geometry = this.geometry;\n\t\tconst material = this.material;\n\t\tconst matrixWorld = this.matrixWorld;\n\n\t\tif ( material === undefined ) return;\n\n\t\t// Checking boundingSphere distance to ray\n\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\n\n\t\t_sphere.copy( geometry.boundingSphere );\n\t\t_sphere.applyMatrix4( matrixWorld );\n\n\t\tif ( raycaster.ray.intersectsSphere( _sphere ) === false ) return;\n\n\t\t//\n\n\t\t_inverseMatrix.getInverse( matrixWorld );\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\n\n\t\t// Check boundingBox before continuing\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tif ( _ray.intersectsBox( geometry.boundingBox ) === false ) return;\n\n\t\t}\n\n\t\tlet intersection;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tconst index = geometry.index;\n\t\t\tconst position = geometry.attributes.position;\n\t\t\tconst morphPosition = geometry.morphAttributes.position;\n\t\t\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\t\t\tconst uv = geometry.attributes.uv;\n\t\t\tconst uv2 = geometry.attributes.uv2;\n\t\t\tconst groups = geometry.groups;\n\t\t\tconst drawRange = geometry.drawRange;\n\n\t\t\tif ( index !== null ) {\n\n\t\t\t\t// indexed buffer geometry\n\n\t\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\t\tfor ( let i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\t\t\tconst group = groups[ i ];\n\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\n\n\t\t\t\t\t\tconst start = Math.max( group.start, drawRange.start );\n\t\t\t\t\t\tconst end = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\t\t\tfor ( let j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\t\t\tconst a = index.getX( j );\n\t\t\t\t\t\t\tconst b = index.getX( j + 1 );\n\t\t\t\t\t\t\tconst c = index.getX( j + 2 );\n\n\t\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, groupMaterial, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\n\n\t\t\t\t\t\t\tif ( intersection ) {\n\n\t\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( j / 3 ); // triangle number in indexed buffer semantics\n\t\t\t\t\t\t\t\tintersection.face.materialIndex = group.materialIndex;\n\t\t\t\t\t\t\t\tintersects.push( intersection );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconst start = Math.max( 0, drawRange.start );\n\t\t\t\t\tconst end = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\t\t\tfor ( let i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\t\t\tconst a = index.getX( i );\n\t\t\t\t\t\tconst b = index.getX( i + 1 );\n\t\t\t\t\t\tconst c = index.getX( i + 2 );\n\n\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, material, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\n\n\t\t\t\t\t\tif ( intersection ) {\n\n\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( i / 3 ); // triangle number in indexed buffer semantics\n\t\t\t\t\t\t\tintersects.push( intersection );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( position !== undefined ) {\n\n\t\t\t\t// non-indexed buffer geometry\n\n\t\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\t\tfor ( let i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\t\t\tconst group = groups[ i ];\n\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\n\n\t\t\t\t\t\tconst start = Math.max( group.start, drawRange.start );\n\t\t\t\t\t\tconst end = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\t\t\tfor ( let j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\t\t\tconst a = j;\n\t\t\t\t\t\t\tconst b = j + 1;\n\t\t\t\t\t\t\tconst c = j + 2;\n\n\t\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, groupMaterial, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\n\n\t\t\t\t\t\t\tif ( intersection ) {\n\n\t\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( j / 3 ); // triangle number in non-indexed buffer semantics\n\t\t\t\t\t\t\t\tintersection.face.materialIndex = group.materialIndex;\n\t\t\t\t\t\t\t\tintersects.push( intersection );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconst start = Math.max( 0, drawRange.start );\n\t\t\t\t\tconst end = Math.min( position.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\t\t\tfor ( let i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\t\t\tconst a = i;\n\t\t\t\t\t\tconst b = i + 1;\n\t\t\t\t\t\tconst c = i + 2;\n\n\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, material, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\n\n\t\t\t\t\t\tif ( intersection ) {\n\n\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( i / 3 ); // triangle number in non-indexed buffer semantics\n\t\t\t\t\t\t\tintersects.push( intersection );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( geometry.isGeometry ) {\n\n\t\t\tconst isMultiMaterial = Array.isArray( material );\n\n\t\t\tconst vertices = geometry.vertices;\n\t\t\tconst faces = geometry.faces;\n\t\t\tlet uvs;\n\n\t\t\tconst faceVertexUvs = geometry.faceVertexUvs[ 0 ];\n\t\t\tif ( faceVertexUvs.length > 0 ) uvs = faceVertexUvs;\n\n\t\t\tfor ( let f = 0, fl = faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = faces[ f ];\n\t\t\t\tconst faceMaterial = isMultiMaterial ? material[ face.materialIndex ] : material;\n\n\t\t\t\tif ( faceMaterial === undefined ) continue;\n\n\t\t\t\tconst fvA = vertices[ face.a ];\n\t\t\t\tconst fvB = vertices[ face.b ];\n\t\t\t\tconst fvC = vertices[ face.c ];\n\n\t\t\t\tintersection = checkIntersection( this, faceMaterial, raycaster, _ray, fvA, fvB, fvC, _intersectionPoint );\n\n\t\t\t\tif ( intersection ) {\n\n\t\t\t\t\tif ( uvs && uvs[ f ] ) {\n\n\t\t\t\t\t\tconst uvs_f = uvs[ f ];\n\t\t\t\t\t\t_uvA.copy( uvs_f[ 0 ] );\n\t\t\t\t\t\t_uvB.copy( uvs_f[ 1 ] );\n\t\t\t\t\t\t_uvC.copy( uvs_f[ 2 ] );\n\n\t\t\t\t\t\tintersection.uv = Triangle.getUV( _intersectionPoint, fvA, fvB, fvC, _uvA, _uvB, _uvC, new Vector2() );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tintersection.face = face;\n\t\t\t\t\tintersection.faceIndex = f;\n\t\t\t\t\tintersects.push( intersection );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n} );\n\nfunction checkIntersection( object, material, raycaster, ray, pA, pB, pC, point ) {\n\n\tlet intersect;\n\n\tif ( material.side === BackSide ) {\n\n\t\tintersect = ray.intersectTriangle( pC, pB, pA, true, point );\n\n\t} else {\n\n\t\tintersect = ray.intersectTriangle( pA, pB, pC, material.side !== DoubleSide, point );\n\n\t}\n\n\tif ( intersect === null ) return null;\n\n\t_intersectionPointWorld.copy( point );\n\t_intersectionPointWorld.applyMatrix4( object.matrixWorld );\n\n\tconst distance = raycaster.ray.origin.distanceTo( _intersectionPointWorld );\n\n\tif ( distance < raycaster.near || distance > raycaster.far ) return null;\n\n\treturn {\n\t\tdistance: distance,\n\t\tpoint: _intersectionPointWorld.clone(),\n\t\tobject: object\n\t};\n\n}\n\nfunction checkBufferGeometryIntersection( object, material, raycaster, ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c ) {\n\n\t_vA.fromBufferAttribute( position, a );\n\t_vB.fromBufferAttribute( position, b );\n\t_vC.fromBufferAttribute( position, c );\n\n\tconst morphInfluences = object.morphTargetInfluences;\n\n\tif ( material.morphTargets && morphPosition && morphInfluences ) {\n\n\t\t_morphA.set( 0, 0, 0 );\n\t\t_morphB.set( 0, 0, 0 );\n\t\t_morphC.set( 0, 0, 0 );\n\n\t\tfor ( let i = 0, il = morphPosition.length; i < il; i ++ ) {\n\n\t\t\tconst influence = morphInfluences[ i ];\n\t\t\tconst morphAttribute = morphPosition[ i ];\n\n\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t_tempA.fromBufferAttribute( morphAttribute, a );\n\t\t\t_tempB.fromBufferAttribute( morphAttribute, b );\n\t\t\t_tempC.fromBufferAttribute( morphAttribute, c );\n\n\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t} else {\n\n\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t}\n\n\t\t}\n\n\t\t_vA.add( _morphA );\n\t\t_vB.add( _morphB );\n\t\t_vC.add( _morphC );\n\n\t}\n\n\tif ( object.isSkinnedMesh ) {\n\n\t\tobject.boneTransform( a, _vA );\n\t\tobject.boneTransform( b, _vB );\n\t\tobject.boneTransform( c, _vC );\n\n\t}\n\n\tconst intersection = checkIntersection( object, material, raycaster, ray, _vA, _vB, _vC, _intersectionPoint );\n\n\tif ( intersection ) {\n\n\t\tif ( uv ) {\n\n\t\t\t_uvA.fromBufferAttribute( uv, a );\n\t\t\t_uvB.fromBufferAttribute( uv, b );\n\t\t\t_uvC.fromBufferAttribute( uv, c );\n\n\t\t\tintersection.uv = Triangle.getUV( _intersectionPoint, _vA, _vB, _vC, _uvA, _uvB, _uvC, new Vector2() );\n\n\t\t}\n\n\t\tif ( uv2 ) {\n\n\t\t\t_uvA.fromBufferAttribute( uv2, a );\n\t\t\t_uvB.fromBufferAttribute( uv2, b );\n\t\t\t_uvC.fromBufferAttribute( uv2, c );\n\n\t\t\tintersection.uv2 = Triangle.getUV( _intersectionPoint, _vA, _vB, _vC, _uvA, _uvB, _uvC, new Vector2() );\n\n\t\t}\n\n\t\tconst face = new Face3( a, b, c );\n\t\tTriangle.getNormal( _vA, _vB, _vC, face.normal );\n\n\t\tintersection.face = face;\n\n\t}\n\n\treturn intersection;\n\n}\n\nexport { Mesh };\n","import { EventDispatcher } from './EventDispatcher.js';\nimport { Face3 } from './Face3.js';\nimport { Matrix3 } from '../math/Matrix3.js';\nimport { Sphere } from '../math/Sphere.js';\nimport { Box3 } from '../math/Box3.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Color } from '../math/Color.js';\nimport { Object3D } from './Object3D.js';\nimport { MathUtils } from '../math/MathUtils.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author kile / http://kile.stravaganza.org/\n * @author alteredq / http://alteredqualia.com/\n * @author mikael emtinger / http://gomo.se/\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * @author bhouston / http://clara.io\n */\n\nlet _geometryId = 0; // Geometry uses even numbers as Id\nconst _m1 = new Matrix4();\nconst _obj = new Object3D();\nconst _offset = new Vector3();\n\nfunction Geometry() {\n\n\tObject.defineProperty( this, 'id', { value: _geometryId += 2 } );\n\n\tthis.uuid = MathUtils.generateUUID();\n\n\tthis.name = '';\n\tthis.type = 'Geometry';\n\n\tthis.vertices = [];\n\tthis.colors = [];\n\tthis.faces = [];\n\tthis.faceVertexUvs = [[]];\n\n\tthis.morphTargets = [];\n\tthis.morphNormals = [];\n\n\tthis.skinWeights = [];\n\tthis.skinIndices = [];\n\n\tthis.lineDistances = [];\n\n\tthis.boundingBox = null;\n\tthis.boundingSphere = null;\n\n\t// update flags\n\n\tthis.elementsNeedUpdate = false;\n\tthis.verticesNeedUpdate = false;\n\tthis.uvsNeedUpdate = false;\n\tthis.normalsNeedUpdate = false;\n\tthis.colorsNeedUpdate = false;\n\tthis.lineDistancesNeedUpdate = false;\n\tthis.groupsNeedUpdate = false;\n\n}\n\nGeometry.prototype = Object.assign( Object.create( EventDispatcher.prototype ), {\n\n\tconstructor: Geometry,\n\n\tisGeometry: true,\n\n\tapplyMatrix4: function ( matrix ) {\n\n\t\tconst normalMatrix = new Matrix3().getNormalMatrix( matrix );\n\n\t\tfor ( let i = 0, il = this.vertices.length; i < il; i ++ ) {\n\n\t\t\tconst vertex = this.vertices[ i ];\n\t\t\tvertex.applyMatrix4( matrix );\n\n\t\t}\n\n\t\tfor ( let i = 0, il = this.faces.length; i < il; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\t\t\tface.normal.applyMatrix3( normalMatrix ).normalize();\n\n\t\t\tfor ( let j = 0, jl = face.vertexNormals.length; j < jl; j ++ ) {\n\n\t\t\t\tface.vertexNormals[ j ].applyMatrix3( normalMatrix ).normalize();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.boundingBox !== null ) {\n\n\t\t\tthis.computeBoundingBox();\n\n\t\t}\n\n\t\tif ( this.boundingSphere !== null ) {\n\n\t\t\tthis.computeBoundingSphere();\n\n\t\t}\n\n\t\tthis.verticesNeedUpdate = true;\n\t\tthis.normalsNeedUpdate = true;\n\n\t\treturn this;\n\n\t},\n\n\trotateX: function ( angle ) {\n\n\t\t// rotate geometry around world x-axis\n\n\t\t_m1.makeRotationX( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\trotateY: function ( angle ) {\n\n\t\t// rotate geometry around world y-axis\n\n\t\t_m1.makeRotationY( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\trotateZ: function ( angle ) {\n\n\t\t// rotate geometry around world z-axis\n\n\t\t_m1.makeRotationZ( angle );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\ttranslate: function ( x, y, z ) {\n\n\t\t// translate geometry\n\n\t\t_m1.makeTranslation( x, y, z );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\tscale: function ( x, y, z ) {\n\n\t\t// scale geometry\n\n\t\t_m1.makeScale( x, y, z );\n\n\t\tthis.applyMatrix4( _m1 );\n\n\t\treturn this;\n\n\t},\n\n\tlookAt: function ( vector ) {\n\n\t\t_obj.lookAt( vector );\n\n\t\t_obj.updateMatrix();\n\n\t\tthis.applyMatrix4( _obj.matrix );\n\n\t\treturn this;\n\n\t},\n\n\tfromBufferGeometry: function ( geometry ) {\n\n\t\tconst scope = this;\n\n\t\tconst index = geometry.index !== null ? geometry.index : undefined;\n\t\tconst attributes = geometry.attributes;\n\n\t\tif ( attributes.position === undefined ) {\n\n\t\t\tconsole.error( 'THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.' );\n\t\t\treturn this;\n\n\t\t}\n\n\t\tconst position = attributes.position;\n\t\tconst normal = attributes.normal;\n\t\tconst color = attributes.color;\n\t\tconst uv = attributes.uv;\n\t\tconst uv2 = attributes.uv2;\n\n\t\tif ( uv2 !== undefined ) this.faceVertexUvs[ 1 ] = [];\n\n\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\tscope.vertices.push( new Vector3().fromBufferAttribute( position, i ) );\n\n\t\t\tif ( color !== undefined ) {\n\n\t\t\t\tscope.colors.push( new Color().fromBufferAttribute( color, i ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction addFace( a, b, c, materialIndex ) {\n\n\t\t\tconst vertexColors = ( color === undefined ) ? [] : [\n\t\t\t\tscope.colors[ a ].clone(),\n\t\t\t\tscope.colors[ b ].clone(),\n\t\t\t\tscope.colors[ c ].clone()\n\t\t\t];\n\n\t\t\tconst vertexNormals = ( normal === undefined ) ? [] : [\n\t\t\t\tnew Vector3().fromBufferAttribute( normal, a ),\n\t\t\t\tnew Vector3().fromBufferAttribute( normal, b ),\n\t\t\t\tnew Vector3().fromBufferAttribute( normal, c )\n\t\t\t];\n\n\t\t\tconst face = new Face3( a, b, c, vertexNormals, vertexColors, materialIndex );\n\n\t\t\tscope.faces.push( face );\n\n\t\t\tif ( uv !== undefined ) {\n\n\t\t\t\tscope.faceVertexUvs[ 0 ].push( [\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv, a ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv, b ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv, c )\n\t\t\t\t] );\n\n\t\t\t}\n\n\t\t\tif ( uv2 !== undefined ) {\n\n\t\t\t\tscope.faceVertexUvs[ 1 ].push( [\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv2, a ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv2, b ),\n\t\t\t\t\tnew Vector2().fromBufferAttribute( uv2, c )\n\t\t\t\t] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst groups = geometry.groups;\n\n\t\tif ( groups.length > 0 ) {\n\n\t\t\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\t\t\tconst group = groups[ i ];\n\n\t\t\t\tconst start = group.start;\n\t\t\t\tconst count = group.count;\n\n\t\t\t\tfor ( let j = start, jl = start + count; j < jl; j += 3 ) {\n\n\t\t\t\t\tif ( index !== undefined ) {\n\n\t\t\t\t\t\taddFace( index.getX( j ), index.getX( j + 1 ), index.getX( j + 2 ), group.materialIndex );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\taddFace( j, j + 1, j + 2, group.materialIndex );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif ( index !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < index.count; i += 3 ) {\n\n\t\t\t\t\taddFace( index.getX( i ), index.getX( i + 1 ), index.getX( i + 2 ) );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i += 3 ) {\n\n\t\t\t\t\taddFace( i, i + 1, i + 2 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.computeFaceNormals();\n\n\t\tif ( geometry.boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = geometry.boundingBox.clone();\n\n\t\t}\n\n\t\tif ( geometry.boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = geometry.boundingSphere.clone();\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tcenter: function () {\n\n\t\tthis.computeBoundingBox();\n\n\t\tthis.boundingBox.getCenter( _offset ).negate();\n\n\t\tthis.translate( _offset.x, _offset.y, _offset.z );\n\n\t\treturn this;\n\n\t},\n\n\tnormalize: function () {\n\n\t\tthis.computeBoundingSphere();\n\n\t\tconst center = this.boundingSphere.center;\n\t\tconst radius = this.boundingSphere.radius;\n\n\t\tconst s = radius === 0 ? 1 : 1.0 / radius;\n\n\t\tconst matrix = new Matrix4();\n\t\tmatrix.set(\n\t\t\ts, 0, 0, - s * center.x,\n\t\t\t0, s, 0, - s * center.y,\n\t\t\t0, 0, s, - s * center.z,\n\t\t\t0, 0, 0, 1\n\t\t);\n\n\t\tthis.applyMatrix4( matrix );\n\n\t\treturn this;\n\n\t},\n\n\tcomputeFaceNormals: function () {\n\n\t\tconst cb = new Vector3(), ab = new Vector3();\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tconst vA = this.vertices[ face.a ];\n\t\t\tconst vB = this.vertices[ face.b ];\n\t\t\tconst vC = this.vertices[ face.c ];\n\n\t\t\tcb.subVectors( vC, vB );\n\t\t\tab.subVectors( vA, vB );\n\t\t\tcb.cross( ab );\n\n\t\t\tcb.normalize();\n\n\t\t\tface.normal.copy( cb );\n\n\t\t}\n\n\t},\n\n\tcomputeVertexNormals: function ( areaWeighted ) {\n\n\t\tif ( areaWeighted === undefined ) areaWeighted = true;\n\n\t\tconst vertices = new Array( this.vertices.length );\n\n\t\tfor ( let v = 0, vl = this.vertices.length; v < vl; v ++ ) {\n\n\t\t\tvertices[ v ] = new Vector3();\n\n\t\t}\n\n\t\tif ( areaWeighted ) {\n\n\t\t\t// vertex normals weighted by triangle areas\n\t\t\t// http://www.iquilezles.org/www/articles/normals/normals.htm\n\n\t\t\tconst cb = new Vector3(), ab = new Vector3();\n\n\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = this.faces[ f ];\n\n\t\t\t\tconst vA = this.vertices[ face.a ];\n\t\t\t\tconst vB = this.vertices[ face.b ];\n\t\t\t\tconst vC = this.vertices[ face.c ];\n\n\t\t\t\tcb.subVectors( vC, vB );\n\t\t\t\tab.subVectors( vA, vB );\n\t\t\t\tcb.cross( ab );\n\n\t\t\t\tvertices[ face.a ].add( cb );\n\t\t\t\tvertices[ face.b ].add( cb );\n\t\t\t\tvertices[ face.c ].add( cb );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tthis.computeFaceNormals();\n\n\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = this.faces[ f ];\n\n\t\t\t\tvertices[ face.a ].add( face.normal );\n\t\t\t\tvertices[ face.b ].add( face.normal );\n\t\t\t\tvertices[ face.c ].add( face.normal );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let v = 0, vl = this.vertices.length; v < vl; v ++ ) {\n\n\t\t\tvertices[ v ].normalize();\n\n\t\t}\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\tif ( vertexNormals.length === 3 ) {\n\n\t\t\t\tvertexNormals[ 0 ].copy( vertices[ face.a ] );\n\t\t\t\tvertexNormals[ 1 ].copy( vertices[ face.b ] );\n\t\t\t\tvertexNormals[ 2 ].copy( vertices[ face.c ] );\n\n\t\t\t} else {\n\n\t\t\t\tvertexNormals[ 0 ] = vertices[ face.a ].clone();\n\t\t\t\tvertexNormals[ 1 ] = vertices[ face.b ].clone();\n\t\t\t\tvertexNormals[ 2 ] = vertices[ face.c ].clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.faces.length > 0 ) {\n\n\t\t\tthis.normalsNeedUpdate = true;\n\n\t\t}\n\n\t},\n\n\tcomputeFlatVertexNormals: function () {\n\n\t\tthis.computeFaceNormals();\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\tif ( vertexNormals.length === 3 ) {\n\n\t\t\t\tvertexNormals[ 0 ].copy( face.normal );\n\t\t\t\tvertexNormals[ 1 ].copy( face.normal );\n\t\t\t\tvertexNormals[ 2 ].copy( face.normal );\n\n\t\t\t} else {\n\n\t\t\t\tvertexNormals[ 0 ] = face.normal.clone();\n\t\t\t\tvertexNormals[ 1 ] = face.normal.clone();\n\t\t\t\tvertexNormals[ 2 ] = face.normal.clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( this.faces.length > 0 ) {\n\n\t\t\tthis.normalsNeedUpdate = true;\n\n\t\t}\n\n\t},\n\n\tcomputeMorphNormals: function () {\n\n\t\t// save original normals\n\t\t// - create temp variables on first access\n\t\t//   otherwise just copy (for faster repeated calls)\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tif ( ! face.__originalFaceNormal ) {\n\n\t\t\t\tface.__originalFaceNormal = face.normal.clone();\n\n\t\t\t} else {\n\n\t\t\t\tface.__originalFaceNormal.copy( face.normal );\n\n\t\t\t}\n\n\t\t\tif ( ! face.__originalVertexNormals ) face.__originalVertexNormals = [];\n\n\t\t\tfor ( let i = 0, il = face.vertexNormals.length; i < il; i ++ ) {\n\n\t\t\t\tif ( ! face.__originalVertexNormals[ i ] ) {\n\n\t\t\t\t\tface.__originalVertexNormals[ i ] = face.vertexNormals[ i ].clone();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tface.__originalVertexNormals[ i ].copy( face.vertexNormals[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// use temp geometry to compute face and vertex normals for each morph\n\n\t\tconst tmpGeo = new Geometry();\n\t\ttmpGeo.faces = this.faces;\n\n\t\tfor ( let i = 0, il = this.morphTargets.length; i < il; i ++ ) {\n\n\t\t\t// create on first access\n\n\t\t\tif ( ! this.morphNormals[ i ] ) {\n\n\t\t\t\tthis.morphNormals[ i ] = {};\n\t\t\t\tthis.morphNormals[ i ].faceNormals = [];\n\t\t\t\tthis.morphNormals[ i ].vertexNormals = [];\n\n\t\t\t\tconst dstNormalsFace = this.morphNormals[ i ].faceNormals;\n\t\t\t\tconst dstNormalsVertex = this.morphNormals[ i ].vertexNormals;\n\n\t\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\t\tconst faceNormal = new Vector3();\n\t\t\t\t\tconst vertexNormals = { a: new Vector3(), b: new Vector3(), c: new Vector3() };\n\n\t\t\t\t\tdstNormalsFace.push( faceNormal );\n\t\t\t\t\tdstNormalsVertex.push( vertexNormals );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst morphNormals = this.morphNormals[ i ];\n\n\t\t\t// set vertices to morph target\n\n\t\t\ttmpGeo.vertices = this.morphTargets[ i ].vertices;\n\n\t\t\t// compute morph normals\n\n\t\t\ttmpGeo.computeFaceNormals();\n\t\t\ttmpGeo.computeVertexNormals();\n\n\t\t\t// store morph normals\n\n\t\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\t\tconst face = this.faces[ f ];\n\n\t\t\t\tconst faceNormal = morphNormals.faceNormals[ f ];\n\t\t\t\tconst vertexNormals = morphNormals.vertexNormals[ f ];\n\n\t\t\t\tfaceNormal.copy( face.normal );\n\n\t\t\t\tvertexNormals.a.copy( face.vertexNormals[ 0 ] );\n\t\t\t\tvertexNormals.b.copy( face.vertexNormals[ 1 ] );\n\t\t\t\tvertexNormals.c.copy( face.vertexNormals[ 2 ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// restore original normals\n\n\t\tfor ( let f = 0, fl = this.faces.length; f < fl; f ++ ) {\n\n\t\t\tconst face = this.faces[ f ];\n\n\t\t\tface.normal = face.__originalFaceNormal;\n\t\t\tface.vertexNormals = face.__originalVertexNormals;\n\n\t\t}\n\n\t},\n\n\tcomputeBoundingBox: function () {\n\n\t\tif ( this.boundingBox === null ) {\n\n\t\t\tthis.boundingBox = new Box3();\n\n\t\t}\n\n\t\tthis.boundingBox.setFromPoints( this.vertices );\n\n\t},\n\n\tcomputeBoundingSphere: function () {\n\n\t\tif ( this.boundingSphere === null ) {\n\n\t\t\tthis.boundingSphere = new Sphere();\n\n\t\t}\n\n\t\tthis.boundingSphere.setFromPoints( this.vertices );\n\n\t},\n\n\tmerge: function ( geometry, matrix, materialIndexOffset ) {\n\n\t\tif ( ! ( geometry && geometry.isGeometry ) ) {\n\n\t\t\tconsole.error( 'THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.', geometry );\n\t\t\treturn;\n\n\t\t}\n\n\t\tlet normalMatrix,\n\t\t\tvertexOffset = this.vertices.length,\n\t\t\tvertices1 = this.vertices,\n\t\t\tvertices2 = geometry.vertices,\n\t\t\tfaces1 = this.faces,\n\t\t\tfaces2 = geometry.faces,\n\t\t\tcolors1 = this.colors,\n\t\t\tcolors2 = geometry.colors;\n\n\t\tif ( materialIndexOffset === undefined ) materialIndexOffset = 0;\n\n\t\tif ( matrix !== undefined ) {\n\n\t\t\tnormalMatrix = new Matrix3().getNormalMatrix( matrix );\n\n\t\t}\n\n\t\t// vertices\n\n\t\tfor ( let i = 0, il = vertices2.length; i < il; i ++ ) {\n\n\t\t\tconst vertex = vertices2[ i ];\n\n\t\t\tconst vertexCopy = vertex.clone();\n\n\t\t\tif ( matrix !== undefined ) vertexCopy.applyMatrix4( matrix );\n\n\t\t\tvertices1.push( vertexCopy );\n\n\t\t}\n\n\t\t// colors\n\n\t\tfor ( let i = 0, il = colors2.length; i < il; i ++ ) {\n\n\t\t\tcolors1.push( colors2[ i ].clone() );\n\n\t\t}\n\n\t\t// faces\n\n\t\tfor ( let i = 0, il = faces2.length; i < il; i ++ ) {\n\n\t\t\tlet face = faces2[ i ], faceCopy, normal, color,\n\t\t\t\tfaceVertexNormals = face.vertexNormals,\n\t\t\t\tfaceVertexColors = face.vertexColors;\n\n\t\t\tfaceCopy = new Face3( face.a + vertexOffset, face.b + vertexOffset, face.c + vertexOffset );\n\t\t\tfaceCopy.normal.copy( face.normal );\n\n\t\t\tif ( normalMatrix !== undefined ) {\n\n\t\t\t\tfaceCopy.normal.applyMatrix3( normalMatrix ).normalize();\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = faceVertexNormals.length; j < jl; j ++ ) {\n\n\t\t\t\tnormal = faceVertexNormals[ j ].clone();\n\n\t\t\t\tif ( normalMatrix !== undefined ) {\n\n\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\n\n\t\t\t\t}\n\n\t\t\t\tfaceCopy.vertexNormals.push( normal );\n\n\t\t\t}\n\n\t\t\tfaceCopy.color.copy( face.color );\n\n\t\t\tfor ( let j = 0, jl = faceVertexColors.length; j < jl; j ++ ) {\n\n\t\t\t\tcolor = faceVertexColors[ j ];\n\t\t\t\tfaceCopy.vertexColors.push( color.clone() );\n\n\t\t\t}\n\n\t\t\tfaceCopy.materialIndex = face.materialIndex + materialIndexOffset;\n\n\t\t\tfaces1.push( faceCopy );\n\n\t\t}\n\n\t\t// uvs\n\n\t\tfor ( let i = 0, il = geometry.faceVertexUvs.length; i < il; i ++ ) {\n\n\t\t\tconst faceVertexUvs2 = geometry.faceVertexUvs[ i ];\n\n\t\t\tif ( this.faceVertexUvs[ i ] === undefined ) this.faceVertexUvs[ i ] = [];\n\n\t\t\tfor ( let j = 0, jl = faceVertexUvs2.length; j < jl; j ++ ) {\n\n\t\t\t\tconst uvs2 = faceVertexUvs2[ j ], uvsCopy = [];\n\n\t\t\t\tfor ( let k = 0, kl = uvs2.length; k < kl; k ++ ) {\n\n\t\t\t\t\tuvsCopy.push( uvs2[ k ].clone() );\n\n\t\t\t\t}\n\n\t\t\t\tthis.faceVertexUvs[ i ].push( uvsCopy );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\tmergeMesh: function ( mesh ) {\n\n\t\tif ( ! ( mesh && mesh.isMesh ) ) {\n\n\t\t\tconsole.error( 'THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.', mesh );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( mesh.matrixAutoUpdate ) mesh.updateMatrix();\n\n\t\tthis.merge( mesh.geometry, mesh.matrix );\n\n\t},\n\n\t/*\n\t * Checks for duplicate vertices with hashmap.\n\t * Duplicated vertices are removed\n\t * and faces' vertices are updated.\n\t */\n\n\tmergeVertices: function () {\n\n\t\tconst verticesMap = {}; // Hashmap for looking up vertices by position coordinates (and making sure they are unique)\n\t\tconst unique = [], changes = [];\n\n\t\tconst precisionPoints = 4; // number of decimal points, e.g. 4 for epsilon of 0.0001\n\t\tconst precision = Math.pow( 10, precisionPoints );\n\n\t\tfor ( let i = 0, il = this.vertices.length; i < il; i ++ ) {\n\n\t\t\tconst v = this.vertices[ i ];\n\t\t\tconst key = Math.round( v.x * precision ) + '_' + Math.round( v.y * precision ) + '_' + Math.round( v.z * precision );\n\n\t\t\tif ( verticesMap[ key ] === undefined ) {\n\n\t\t\t\tverticesMap[ key ] = i;\n\t\t\t\tunique.push( this.vertices[ i ] );\n\t\t\t\tchanges[ i ] = unique.length - 1;\n\n\t\t\t} else {\n\n\t\t\t\t//console.log('Duplicate vertex found. ', i, ' could be using ', verticesMap[key]);\n\t\t\t\tchanges[ i ] = changes[ verticesMap[ key ] ];\n\n\t\t\t}\n\n\t\t}\n\n\n\t\t// if faces are completely degenerate after merging vertices, we\n\t\t// have to remove them from the geometry.\n\t\tconst faceIndicesToRemove = [];\n\n\t\tfor ( let i = 0, il = this.faces.length; i < il; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\n\t\t\tface.a = changes[ face.a ];\n\t\t\tface.b = changes[ face.b ];\n\t\t\tface.c = changes[ face.c ];\n\n\t\t\tconst indices = [ face.a, face.b, face.c ];\n\n\t\t\t// if any duplicate vertices are found in a Face3\n\t\t\t// we have to remove the face as nothing can be saved\n\t\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\t\tif ( indices[ n ] === indices[ ( n + 1 ) % 3 ] ) {\n\n\t\t\t\t\tfaceIndicesToRemove.push( i );\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let i = faceIndicesToRemove.length - 1; i >= 0; i -- ) {\n\n\t\t\tconst idx = faceIndicesToRemove[ i ];\n\n\t\t\tthis.faces.splice( idx, 1 );\n\n\t\t\tfor ( let j = 0, jl = this.faceVertexUvs.length; j < jl; j ++ ) {\n\n\t\t\t\tthis.faceVertexUvs[ j ].splice( idx, 1 );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Use unique set of vertices\n\n\t\tconst diff = this.vertices.length - unique.length;\n\t\tthis.vertices = unique;\n\t\treturn diff;\n\n\t},\n\n\tsetFromPoints: function ( points ) {\n\n\t\tthis.vertices = [];\n\n\t\tfor ( let i = 0, l = points.length; i < l; i ++ ) {\n\n\t\t\tconst point = points[ i ];\n\t\t\tthis.vertices.push( new Vector3( point.x, point.y, point.z || 0 ) );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsortFacesByMaterialIndex: function () {\n\n\t\tconst faces = this.faces;\n\t\tconst length = faces.length;\n\n\t\t// tag faces\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tfaces[ i ]._id = i;\n\n\t\t}\n\n\t\t// sort faces\n\n\t\tfunction materialIndexSort( a, b ) {\n\n\t\t\treturn a.materialIndex - b.materialIndex;\n\n\t\t}\n\n\t\tfaces.sort( materialIndexSort );\n\n\t\t// sort uvs\n\n\t\tconst uvs1 = this.faceVertexUvs[ 0 ];\n\t\tconst uvs2 = this.faceVertexUvs[ 1 ];\n\n\t\tlet newUvs1, newUvs2;\n\n\t\tif ( uvs1 && uvs1.length === length ) newUvs1 = [];\n\t\tif ( uvs2 && uvs2.length === length ) newUvs2 = [];\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tconst id = faces[ i ]._id;\n\n\t\t\tif ( newUvs1 ) newUvs1.push( uvs1[ id ] );\n\t\t\tif ( newUvs2 ) newUvs2.push( uvs2[ id ] );\n\n\t\t}\n\n\t\tif ( newUvs1 ) this.faceVertexUvs[ 0 ] = newUvs1;\n\t\tif ( newUvs2 ) this.faceVertexUvs[ 1 ] = newUvs2;\n\n\t},\n\n\ttoJSON: function () {\n\n\t\tconst data = {\n\t\t\tmetadata: {\n\t\t\t\tversion: 4.5,\n\t\t\t\ttype: 'Geometry',\n\t\t\t\tgenerator: 'Geometry.toJSON'\n\t\t\t}\n\t\t};\n\n\t\t// standard Geometry serialization\n\n\t\tdata.uuid = this.uuid;\n\t\tdata.type = this.type;\n\t\tif ( this.name !== '' ) data.name = this.name;\n\n\t\tif ( this.parameters !== undefined ) {\n\n\t\t\tconst parameters = this.parameters;\n\n\t\t\tfor ( const key in parameters ) {\n\n\t\t\t\tif ( parameters[ key ] !== undefined ) data[ key ] = parameters[ key ];\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tconst vertices = [];\n\n\t\tfor ( let i = 0; i < this.vertices.length; i ++ ) {\n\n\t\t\tconst vertex = this.vertices[ i ];\n\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t}\n\n\t\tconst faces = [];\n\t\tconst normals = [];\n\t\tconst normalsHash = {};\n\t\tconst colors = [];\n\t\tconst colorsHash = {};\n\t\tconst uvs = [];\n\t\tconst uvsHash = {};\n\n\t\tfor ( let i = 0; i < this.faces.length; i ++ ) {\n\n\t\t\tconst face = this.faces[ i ];\n\n\t\t\tconst hasMaterial = true;\n\t\t\tconst hasFaceUv = false; // deprecated\n\t\t\tconst hasFaceVertexUv = this.faceVertexUvs[ 0 ][ i ] !== undefined;\n\t\t\tconst hasFaceNormal = face.normal.length() > 0;\n\t\t\tconst hasFaceVertexNormal = face.vertexNormals.length > 0;\n\t\t\tconst hasFaceColor = face.color.r !== 1 || face.color.g !== 1 || face.color.b !== 1;\n\t\t\tconst hasFaceVertexColor = face.vertexColors.length > 0;\n\n\t\t\tlet faceType = 0;\n\n\t\t\tfaceType = setBit( faceType, 0, 0 ); // isQuad\n\t\t\tfaceType = setBit( faceType, 1, hasMaterial );\n\t\t\tfaceType = setBit( faceType, 2, hasFaceUv );\n\t\t\tfaceType = setBit( faceType, 3, hasFaceVertexUv );\n\t\t\tfaceType = setBit( faceType, 4, hasFaceNormal );\n\t\t\tfaceType = setBit( faceType, 5, hasFaceVertexNormal );\n\t\t\tfaceType = setBit( faceType, 6, hasFaceColor );\n\t\t\tfaceType = setBit( faceType, 7, hasFaceVertexColor );\n\n\t\t\tfaces.push( faceType );\n\t\t\tfaces.push( face.a, face.b, face.c );\n\t\t\tfaces.push( face.materialIndex );\n\n\t\t\tif ( hasFaceVertexUv ) {\n\n\t\t\t\tconst faceVertexUvs = this.faceVertexUvs[ 0 ][ i ];\n\n\t\t\t\tfaces.push(\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 0 ] ),\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 1 ] ),\n\t\t\t\t\tgetUvIndex( faceVertexUvs[ 2 ] )\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t\tif ( hasFaceNormal ) {\n\n\t\t\t\tfaces.push( getNormalIndex( face.normal ) );\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexNormal ) {\n\n\t\t\t\tconst vertexNormals = face.vertexNormals;\n\n\t\t\t\tfaces.push(\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 0 ] ),\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 1 ] ),\n\t\t\t\t\tgetNormalIndex( vertexNormals[ 2 ] )\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t\tif ( hasFaceColor ) {\n\n\t\t\t\tfaces.push( getColorIndex( face.color ) );\n\n\t\t\t}\n\n\t\t\tif ( hasFaceVertexColor ) {\n\n\t\t\t\tconst vertexColors = face.vertexColors;\n\n\t\t\t\tfaces.push(\n\t\t\t\t\tgetColorIndex( vertexColors[ 0 ] ),\n\t\t\t\t\tgetColorIndex( vertexColors[ 1 ] ),\n\t\t\t\t\tgetColorIndex( vertexColors[ 2 ] )\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction setBit( value, position, enabled ) {\n\n\t\t\treturn enabled ? value | ( 1 << position ) : value & ( ~ ( 1 << position ) );\n\n\t\t}\n\n\t\tfunction getNormalIndex( normal ) {\n\n\t\t\tconst hash = normal.x.toString() + normal.y.toString() + normal.z.toString();\n\n\t\t\tif ( normalsHash[ hash ] !== undefined ) {\n\n\t\t\t\treturn normalsHash[ hash ];\n\n\t\t\t}\n\n\t\t\tnormalsHash[ hash ] = normals.length / 3;\n\t\t\tnormals.push( normal.x, normal.y, normal.z );\n\n\t\t\treturn normalsHash[ hash ];\n\n\t\t}\n\n\t\tfunction getColorIndex( color ) {\n\n\t\t\tconst hash = color.r.toString() + color.g.toString() + color.b.toString();\n\n\t\t\tif ( colorsHash[ hash ] !== undefined ) {\n\n\t\t\t\treturn colorsHash[ hash ];\n\n\t\t\t}\n\n\t\t\tcolorsHash[ hash ] = colors.length;\n\t\t\tcolors.push( color.getHex() );\n\n\t\t\treturn colorsHash[ hash ];\n\n\t\t}\n\n\t\tfunction getUvIndex( uv ) {\n\n\t\t\tconst hash = uv.x.toString() + uv.y.toString();\n\n\t\t\tif ( uvsHash[ hash ] !== undefined ) {\n\n\t\t\t\treturn uvsHash[ hash ];\n\n\t\t\t}\n\n\t\t\tuvsHash[ hash ] = uvs.length / 2;\n\t\t\tuvs.push( uv.x, uv.y );\n\n\t\t\treturn uvsHash[ hash ];\n\n\t\t}\n\n\t\tdata.data = {};\n\n\t\tdata.data.vertices = vertices;\n\t\tdata.data.normals = normals;\n\t\tif ( colors.length > 0 ) data.data.colors = colors;\n\t\tif ( uvs.length > 0 ) data.data.uvs = [ uvs ]; // temporal backward compatibility\n\t\tdata.data.faces = faces;\n\n\t\treturn data;\n\n\t},\n\n\tclone: function () {\n\n\t\t/*\n\t\t // Handle primitives\n\n\t\t const parameters = this.parameters;\n\n\t\t if ( parameters !== undefined ) {\n\n\t\t const values = [];\n\n\t\t for ( const key in parameters ) {\n\n\t\t values.push( parameters[ key ] );\n\n\t\t }\n\n\t\t const geometry = Object.create( this.constructor.prototype );\n\t\t this.constructor.apply( geometry, values );\n\t\t return geometry;\n\n\t\t }\n\n\t\t return new this.constructor().copy( this );\n\t\t */\n\n\t\treturn new Geometry().copy( this );\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\t// reset\n\n\t\tthis.vertices = [];\n\t\tthis.colors = [];\n\t\tthis.faces = [];\n\t\tthis.faceVertexUvs = [[]];\n\t\tthis.morphTargets = [];\n\t\tthis.morphNormals = [];\n\t\tthis.skinWeights = [];\n\t\tthis.skinIndices = [];\n\t\tthis.lineDistances = [];\n\t\tthis.boundingBox = null;\n\t\tthis.boundingSphere = null;\n\n\t\t// name\n\n\t\tthis.name = source.name;\n\n\t\t// vertices\n\n\t\tconst vertices = source.vertices;\n\n\t\tfor ( let i = 0, il = vertices.length; i < il; i ++ ) {\n\n\t\t\tthis.vertices.push( vertices[ i ].clone() );\n\n\t\t}\n\n\t\t// colors\n\n\t\tconst colors = source.colors;\n\n\t\tfor ( let i = 0, il = colors.length; i < il; i ++ ) {\n\n\t\t\tthis.colors.push( colors[ i ].clone() );\n\n\t\t}\n\n\t\t// faces\n\n\t\tconst faces = source.faces;\n\n\t\tfor ( let i = 0, il = faces.length; i < il; i ++ ) {\n\n\t\t\tthis.faces.push( faces[ i ].clone() );\n\n\t\t}\n\n\t\t// face vertex uvs\n\n\t\tfor ( let i = 0, il = source.faceVertexUvs.length; i < il; i ++ ) {\n\n\t\t\tconst faceVertexUvs = source.faceVertexUvs[ i ];\n\n\t\t\tif ( this.faceVertexUvs[ i ] === undefined ) {\n\n\t\t\t\tthis.faceVertexUvs[ i ] = [];\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = faceVertexUvs.length; j < jl; j ++ ) {\n\n\t\t\t\tconst uvs = faceVertexUvs[ j ], uvsCopy = [];\n\n\t\t\t\tfor ( let k = 0, kl = uvs.length; k < kl; k ++ ) {\n\n\t\t\t\t\tconst uv = uvs[ k ];\n\n\t\t\t\t\tuvsCopy.push( uv.clone() );\n\n\t\t\t\t}\n\n\t\t\t\tthis.faceVertexUvs[ i ].push( uvsCopy );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// morph targets\n\n\t\tconst morphTargets = source.morphTargets;\n\n\t\tfor ( let i = 0, il = morphTargets.length; i < il; i ++ ) {\n\n\t\t\tconst morphTarget = {};\n\t\t\tmorphTarget.name = morphTargets[ i ].name;\n\n\t\t\t// vertices\n\n\t\t\tif ( morphTargets[ i ].vertices !== undefined ) {\n\n\t\t\t\tmorphTarget.vertices = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphTargets[ i ].vertices.length; j < jl; j ++ ) {\n\n\t\t\t\t\tmorphTarget.vertices.push( morphTargets[ i ].vertices[ j ].clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// normals\n\n\t\t\tif ( morphTargets[ i ].normals !== undefined ) {\n\n\t\t\t\tmorphTarget.normals = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphTargets[ i ].normals.length; j < jl; j ++ ) {\n\n\t\t\t\t\tmorphTarget.normals.push( morphTargets[ i ].normals[ j ].clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.morphTargets.push( morphTarget );\n\n\t\t}\n\n\t\t// morph normals\n\n\t\tconst morphNormals = source.morphNormals;\n\n\t\tfor ( let i = 0, il = morphNormals.length; i < il; i ++ ) {\n\n\t\t\tconst morphNormal = {};\n\n\t\t\t// vertex normals\n\n\t\t\tif ( morphNormals[ i ].vertexNormals !== undefined ) {\n\n\t\t\t\tmorphNormal.vertexNormals = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphNormals[ i ].vertexNormals.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst srcVertexNormal = morphNormals[ i ].vertexNormals[ j ];\n\t\t\t\t\tconst destVertexNormal = {};\n\n\t\t\t\t\tdestVertexNormal.a = srcVertexNormal.a.clone();\n\t\t\t\t\tdestVertexNormal.b = srcVertexNormal.b.clone();\n\t\t\t\t\tdestVertexNormal.c = srcVertexNormal.c.clone();\n\n\t\t\t\t\tmorphNormal.vertexNormals.push( destVertexNormal );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// face normals\n\n\t\t\tif ( morphNormals[ i ].faceNormals !== undefined ) {\n\n\t\t\t\tmorphNormal.faceNormals = [];\n\n\t\t\t\tfor ( let j = 0, jl = morphNormals[ i ].faceNormals.length; j < jl; j ++ ) {\n\n\t\t\t\t\tmorphNormal.faceNormals.push( morphNormals[ i ].faceNormals[ j ].clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tthis.morphNormals.push( morphNormal );\n\n\t\t}\n\n\t\t// skin weights\n\n\t\tconst skinWeights = source.skinWeights;\n\n\t\tfor ( let i = 0, il = skinWeights.length; i < il; i ++ ) {\n\n\t\t\tthis.skinWeights.push( skinWeights[ i ].clone() );\n\n\t\t}\n\n\t\t// skin indices\n\n\t\tconst skinIndices = source.skinIndices;\n\n\t\tfor ( let i = 0, il = skinIndices.length; i < il; i ++ ) {\n\n\t\t\tthis.skinIndices.push( skinIndices[ i ].clone() );\n\n\t\t}\n\n\t\t// line distances\n\n\t\tconst lineDistances = source.lineDistances;\n\n\t\tfor ( let i = 0, il = lineDistances.length; i < il; i ++ ) {\n\n\t\t\tthis.lineDistances.push( lineDistances[ i ] );\n\n\t\t}\n\n\t\t// bounding box\n\n\t\tconst boundingBox = source.boundingBox;\n\n\t\tif ( boundingBox !== null ) {\n\n\t\t\tthis.boundingBox = boundingBox.clone();\n\n\t\t}\n\n\t\t// bounding sphere\n\n\t\tconst boundingSphere = source.boundingSphere;\n\n\t\tif ( boundingSphere !== null ) {\n\n\t\t\tthis.boundingSphere = boundingSphere.clone();\n\n\t\t}\n\n\t\t// update flags\n\n\t\tthis.elementsNeedUpdate = source.elementsNeedUpdate;\n\t\tthis.verticesNeedUpdate = source.verticesNeedUpdate;\n\t\tthis.uvsNeedUpdate = source.uvsNeedUpdate;\n\t\tthis.normalsNeedUpdate = source.normalsNeedUpdate;\n\t\tthis.colorsNeedUpdate = source.colorsNeedUpdate;\n\t\tthis.lineDistancesNeedUpdate = source.lineDistancesNeedUpdate;\n\t\tthis.groupsNeedUpdate = source.groupsNeedUpdate;\n\n\t\treturn this;\n\n\t},\n\n\tdispose: function () {\n\n\t\tthis.dispatchEvent( { type: 'dispose' } );\n\n\t}\n\n} );\n\n\nexport { Geometry };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\nimport { Vector3 } from '../math/Vector3.js';\n\n// BoxGeometry\n\nclass BoxGeometry extends Geometry {\n\n\tconstructor( width, height, depth, widthSegments, heightSegments, depthSegments ) {\n\n\t\tsuper();\n\n\t\tthis.type = 'BoxGeometry';\n\n\t\tthis.parameters = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tdepth: depth,\n\t\t\twidthSegments: widthSegments,\n\t\t\theightSegments: heightSegments,\n\t\t\tdepthSegments: depthSegments\n\t\t};\n\n\t\tthis.fromBufferGeometry( new BoxBufferGeometry( width, height, depth, widthSegments, heightSegments, depthSegments ) );\n\t\tthis.mergeVertices();\n\n\t}\n\n}\n\n// BoxBufferGeometry\n\nclass BoxBufferGeometry extends BufferGeometry {\n\n\tconstructor( width, height, depth, widthSegments, heightSegments, depthSegments ) {\n\n\t\tsuper();\n\n\t\tthis.type = 'BoxBufferGeometry';\n\n\t\tthis.parameters = {\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tdepth: depth,\n\t\t\twidthSegments: widthSegments,\n\t\t\theightSegments: heightSegments,\n\t\t\tdepthSegments: depthSegments\n\t\t};\n\n\t\tconst scope = this;\n\n\t\twidth = width || 1;\n\t\theight = height || 1;\n\t\tdepth = depth || 1;\n\n\t\t// segments\n\n\t\twidthSegments = Math.floor( widthSegments ) || 1;\n\t\theightSegments = Math.floor( heightSegments ) || 1;\n\t\tdepthSegments = Math.floor( depthSegments ) || 1;\n\n\t\t// buffers\n\n\t\tconst indices = [];\n\t\tconst vertices = [];\n\t\tconst normals = [];\n\t\tconst uvs = [];\n\n\t\t// helper variables\n\n\t\tlet numberOfVertices = 0;\n\t\tlet groupStart = 0;\n\n\t\t// build each side of the box geometry\n\n\t\tbuildPlane( 'z', 'y', 'x', - 1, - 1, depth, height, width, depthSegments, heightSegments, 0 ); // px\n\t\tbuildPlane( 'z', 'y', 'x', 1, - 1, depth, height, - width, depthSegments, heightSegments, 1 ); // nx\n\t\tbuildPlane( 'x', 'z', 'y', 1, 1, width, depth, height, widthSegments, depthSegments, 2 ); // py\n\t\tbuildPlane( 'x', 'z', 'y', 1, - 1, width, depth, - height, widthSegments, depthSegments, 3 ); // ny\n\t\tbuildPlane( 'x', 'y', 'z', 1, - 1, width, height, depth, widthSegments, heightSegments, 4 ); // pz\n\t\tbuildPlane( 'x', 'y', 'z', - 1, - 1, width, height, - depth, widthSegments, heightSegments, 5 ); // nz\n\n\t\t// build geometry\n\n\t\tthis.setIndex( indices );\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\t\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\n\t\tfunction buildPlane( u, v, w, udir, vdir, width, height, depth, gridX, gridY, materialIndex ) {\n\n\t\t\tconst segmentWidth = width / gridX;\n\t\t\tconst segmentHeight = height / gridY;\n\n\t\t\tconst widthHalf = width / 2;\n\t\t\tconst heightHalf = height / 2;\n\t\t\tconst depthHalf = depth / 2;\n\n\t\t\tconst gridX1 = gridX + 1;\n\t\t\tconst gridY1 = gridY + 1;\n\n\t\t\tlet vertexCounter = 0;\n\t\t\tlet groupCount = 0;\n\n\t\t\tconst vector = new Vector3();\n\n\t\t\t// generate vertices, normals and uvs\n\n\t\t\tfor ( let iy = 0; iy < gridY1; iy ++ ) {\n\n\t\t\t\tconst y = iy * segmentHeight - heightHalf;\n\n\t\t\t\tfor ( let ix = 0; ix < gridX1; ix ++ ) {\n\n\t\t\t\t\tconst x = ix * segmentWidth - widthHalf;\n\n\t\t\t\t\t// set values to correct vector component\n\n\t\t\t\t\tvector[ u ] = x * udir;\n\t\t\t\t\tvector[ v ] = y * vdir;\n\t\t\t\t\tvector[ w ] = depthHalf;\n\n\t\t\t\t\t// now apply vector to vertex buffer\n\n\t\t\t\t\tvertices.push( vector.x, vector.y, vector.z );\n\n\t\t\t\t\t// set values to correct vector component\n\n\t\t\t\t\tvector[ u ] = 0;\n\t\t\t\t\tvector[ v ] = 0;\n\t\t\t\t\tvector[ w ] = depth > 0 ? 1 : - 1;\n\n\t\t\t\t\t// now apply vector to normal buffer\n\n\t\t\t\t\tnormals.push( vector.x, vector.y, vector.z );\n\n\t\t\t\t\t// uvs\n\n\t\t\t\t\tuvs.push( ix / gridX );\n\t\t\t\t\tuvs.push( 1 - ( iy / gridY ) );\n\n\t\t\t\t\t// counters\n\n\t\t\t\t\tvertexCounter += 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// indices\n\n\t\t\t// 1. you need three indices to draw a single face\n\t\t\t// 2. a single segment consists of two faces\n\t\t\t// 3. so we need to generate six (2*3) indices per segment\n\n\t\t\tfor ( let iy = 0; iy < gridY; iy ++ ) {\n\n\t\t\t\tfor ( let ix = 0; ix < gridX; ix ++ ) {\n\n\t\t\t\t\tconst a = numberOfVertices + ix + gridX1 * iy;\n\t\t\t\t\tconst b = numberOfVertices + ix + gridX1 * ( iy + 1 );\n\t\t\t\t\tconst c = numberOfVertices + ( ix + 1 ) + gridX1 * ( iy + 1 );\n\t\t\t\t\tconst d = numberOfVertices + ( ix + 1 ) + gridX1 * iy;\n\n\t\t\t\t\t// faces\n\n\t\t\t\t\tindices.push( a, b, d );\n\t\t\t\t\tindices.push( b, c, d );\n\n\t\t\t\t\t// increase counter\n\n\t\t\t\t\tgroupCount += 6;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// add a group to the geometry. this will ensure multi material support\n\n\t\t\tscope.addGroup( groupStart, groupCount, materialIndex );\n\n\t\t\t// calculate new start value for groups\n\n\t\t\tgroupStart += groupCount;\n\n\t\t\t// update total number of vertices\n\n\t\t\tnumberOfVertices += vertexCounter;\n\n\t\t}\n\n\t}\n\n}\n\nexport { BoxGeometry, BoxBufferGeometry };\n","/**\n * Uniform Utilities\n */\n\nexport function cloneUniforms( src ) {\n\n\tconst dst = {};\n\n\tfor ( const u in src ) {\n\n\t\tdst[ u ] = {};\n\n\t\tfor ( const p in src[ u ] ) {\n\n\t\t\tconst property = src[ u ][ p ];\n\n\t\t\tif ( property && ( property.isColor ||\n\t\t\t\tproperty.isMatrix3 || property.isMatrix4 ||\n\t\t\t\tproperty.isVector2 || property.isVector3 || property.isVector4 ||\n\t\t\t\tproperty.isTexture ) ) {\n\n\t\t\t\tdst[ u ][ p ] = property.clone();\n\n\t\t\t} else if ( Array.isArray( property ) ) {\n\n\t\t\t\tdst[ u ][ p ] = property.slice();\n\n\t\t\t} else {\n\n\t\t\t\tdst[ u ][ p ] = property;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn dst;\n\n}\n\nexport function mergeUniforms( uniforms ) {\n\n\tconst merged = {};\n\n\tfor ( let u = 0; u < uniforms.length; u ++ ) {\n\n\t\tconst tmp = cloneUniforms( uniforms[ u ] );\n\n\t\tfor ( const p in tmp ) {\n\n\t\t\tmerged[ p ] = tmp[ p ];\n\n\t\t}\n\n\t}\n\n\treturn merged;\n\n}\n\n// Legacy\n\nconst UniformsUtils = { clone: cloneUniforms, merge: mergeUniforms };\n\nexport { UniformsUtils };\n","/**\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  defines: { \"label\" : \"value\" },\n *  uniforms: { \"parameter1\": { value: 1.0 }, \"parameter2\": { value2: 2 } },\n *\n *  fragmentShader: <string>,\n *  vertexShader: <string>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>,\n *\n *  lights: <bool>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *  morphNormals: <bool>\n * }\n */\n\nimport { Material } from './Material.js';\nimport { cloneUniforms } from '../renderers/shaders/UniformsUtils.js';\n\nimport default_vertex from '../renderers/shaders/ShaderChunk/default_vertex.glsl.js';\nimport default_fragment from '../renderers/shaders/ShaderChunk/default_fragment.glsl.js';\n\nfunction ShaderMaterial( parameters ) {\n\n\tMaterial.call( this );\n\n\tthis.type = 'ShaderMaterial';\n\n\tthis.defines = {};\n\tthis.uniforms = {};\n\n\tthis.vertexShader = default_vertex;\n\tthis.fragmentShader = default_fragment;\n\n\tthis.linewidth = 1;\n\n\tthis.wireframe = false;\n\tthis.wireframeLinewidth = 1;\n\n\tthis.fog = false; // set to use scene fog\n\tthis.lights = false; // set to use scene lights\n\tthis.clipping = false; // set to use user-defined clipping planes\n\n\tthis.skinning = false; // set to use skinning attribute streams\n\tthis.morphTargets = false; // set to use morph targets\n\tthis.morphNormals = false; // set to use morph normals\n\n\tthis.extensions = {\n\t\tderivatives: false, // set to use derivatives\n\t\tfragDepth: false, // set to use fragment depth values\n\t\tdrawBuffers: false, // set to use draw buffers\n\t\tshaderTextureLOD: false // set to use shader texture LOD\n\t};\n\n\t// When rendered geometry doesn't include these attributes but the material does,\n\t// use these default values in WebGL. This avoids errors when buffer data is missing.\n\tthis.defaultAttributeValues = {\n\t\t'color': [ 1, 1, 1 ],\n\t\t'uv': [ 0, 0 ],\n\t\t'uv2': [ 0, 0 ]\n\t};\n\n\tthis.index0AttributeName = undefined;\n\tthis.uniformsNeedUpdate = false;\n\n\tif ( parameters !== undefined ) {\n\n\t\tif ( parameters.attributes !== undefined ) {\n\n\t\t\tconsole.error( 'THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.' );\n\n\t\t}\n\n\t\tthis.setValues( parameters );\n\n\t}\n\n}\n\nShaderMaterial.prototype = Object.create( Material.prototype );\nShaderMaterial.prototype.constructor = ShaderMaterial;\n\nShaderMaterial.prototype.isShaderMaterial = true;\n\nShaderMaterial.prototype.copy = function ( source ) {\n\n\tMaterial.prototype.copy.call( this, source );\n\n\tthis.fragmentShader = source.fragmentShader;\n\tthis.vertexShader = source.vertexShader;\n\n\tthis.uniforms = cloneUniforms( source.uniforms );\n\n\tthis.defines = Object.assign( {}, source.defines );\n\n\tthis.wireframe = source.wireframe;\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\n\n\tthis.lights = source.lights;\n\tthis.clipping = source.clipping;\n\n\tthis.skinning = source.skinning;\n\n\tthis.morphTargets = source.morphTargets;\n\tthis.morphNormals = source.morphNormals;\n\n\tthis.extensions = Object.assign( {}, source.extensions );\n\n\treturn this;\n\n};\n\nShaderMaterial.prototype.toJSON = function ( meta ) {\n\n\tconst data = Material.prototype.toJSON.call( this, meta );\n\n\tdata.uniforms = {};\n\n\tfor ( const name in this.uniforms ) {\n\n\t\tconst uniform = this.uniforms[ name ];\n\t\tconst value = uniform.value;\n\n\t\tif ( value && value.isTexture ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 't',\n\t\t\t\tvalue: value.toJSON( meta ).uuid\n\t\t\t};\n\n\t\t} else if ( value && value.isColor ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 'c',\n\t\t\t\tvalue: value.getHex()\n\t\t\t};\n\n\t\t} else if ( value && value.isVector2 ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 'v2',\n\t\t\t\tvalue: value.toArray()\n\t\t\t};\n\n\t\t} else if ( value && value.isVector3 ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 'v3',\n\t\t\t\tvalue: value.toArray()\n\t\t\t};\n\n\t\t} else if ( value && value.isVector4 ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 'v4',\n\t\t\t\tvalue: value.toArray()\n\t\t\t};\n\n\t\t} else if ( value && value.isMatrix3 ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 'm3',\n\t\t\t\tvalue: value.toArray()\n\t\t\t};\n\n\t\t} else if ( value && value.isMatrix4 ) {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\ttype: 'm4',\n\t\t\t\tvalue: value.toArray()\n\t\t\t};\n\n\t\t} else {\n\n\t\t\tdata.uniforms[ name ] = {\n\t\t\t\tvalue: value\n\t\t\t};\n\n\t\t\t// note: the array variants v2v, v3v, v4v, m4v and tv are not supported so far\n\n\t\t}\n\n\t}\n\n\tif ( Object.keys( this.defines ).length > 0 ) data.defines = this.defines;\n\n\tdata.vertexShader = this.vertexShader;\n\tdata.fragmentShader = this.fragmentShader;\n\n\tconst extensions = {};\n\n\tfor ( const key in this.extensions ) {\n\n\t\tif ( this.extensions[ key ] === true ) extensions[ key ] = true;\n\n\t}\n\n\tif ( Object.keys( extensions ).length > 0 ) data.extensions = extensions;\n\n\treturn data;\n\n};\n\n\nexport { ShaderMaterial };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author mikael emtinger / http://gomo.se/\n * @author WestLangley / http://github.com/WestLangley\n*/\n\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { Object3D } from '../core/Object3D.js';\nimport { Vector3 } from '../math/Vector3.js';\n\nfunction Camera() {\n\n\tObject3D.call( this );\n\n\tthis.type = 'Camera';\n\n\tthis.matrixWorldInverse = new Matrix4();\n\n\tthis.projectionMatrix = new Matrix4();\n\tthis.projectionMatrixInverse = new Matrix4();\n\n}\n\nCamera.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Camera,\n\n\tisCamera: true,\n\n\tcopy: function ( source, recursive ) {\n\n\t\tObject3D.prototype.copy.call( this, source, recursive );\n\n\t\tthis.matrixWorldInverse.copy( source.matrixWorldInverse );\n\n\t\tthis.projectionMatrix.copy( source.projectionMatrix );\n\t\tthis.projectionMatrixInverse.copy( source.projectionMatrixInverse );\n\n\t\treturn this;\n\n\t},\n\n\tgetWorldDirection: function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.Camera: .getWorldDirection() target is now required' );\n\t\t\ttarget = new Vector3();\n\n\t\t}\n\n\t\tthis.updateMatrixWorld( true );\n\n\t\tconst e = this.matrixWorld.elements;\n\n\t\treturn target.set( - e[ 8 ], - e[ 9 ], - e[ 10 ] ).normalize();\n\n\t},\n\n\tupdateMatrixWorld: function ( force ) {\n\n\t\tObject3D.prototype.updateMatrixWorld.call( this, force );\n\n\t\tthis.matrixWorldInverse.getInverse( this.matrixWorld );\n\n\t},\n\n\tupdateWorldMatrix: function ( updateParents, updateChildren ) {\n\n\t\tObject3D.prototype.updateWorldMatrix.call( this, updateParents, updateChildren );\n\n\t\tthis.matrixWorldInverse.getInverse( this.matrixWorld );\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t}\n\n} );\n\nexport { Camera };\n","import { Camera } from './Camera.js';\nimport { Object3D } from '../core/Object3D.js';\nimport { MathUtils } from '../math/MathUtils.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author greggman / http://games.greggman.com/\n * @author zz85 / http://www.lab4games.net/zz85/blog\n * @author tschw\n */\n\nfunction PerspectiveCamera( fov, aspect, near, far ) {\n\n\tCamera.call( this );\n\n\tthis.type = 'PerspectiveCamera';\n\n\tthis.fov = fov !== undefined ? fov : 50;\n\tthis.zoom = 1;\n\n\tthis.near = near !== undefined ? near : 0.1;\n\tthis.far = far !== undefined ? far : 2000;\n\tthis.focus = 10;\n\n\tthis.aspect = aspect !== undefined ? aspect : 1;\n\tthis.view = null;\n\n\tthis.filmGauge = 35;\t// width of the film (default in millimeters)\n\tthis.filmOffset = 0;\t// horizontal film offset (same unit as gauge)\n\n\tthis.updateProjectionMatrix();\n\n}\n\nPerspectiveCamera.prototype = Object.assign( Object.create( Camera.prototype ), {\n\n\tconstructor: PerspectiveCamera,\n\n\tisPerspectiveCamera: true,\n\n\tcopy: function ( source, recursive ) {\n\n\t\tCamera.prototype.copy.call( this, source, recursive );\n\n\t\tthis.fov = source.fov;\n\t\tthis.zoom = source.zoom;\n\n\t\tthis.near = source.near;\n\t\tthis.far = source.far;\n\t\tthis.focus = source.focus;\n\n\t\tthis.aspect = source.aspect;\n\t\tthis.view = source.view === null ? null : Object.assign( {}, source.view );\n\n\t\tthis.filmGauge = source.filmGauge;\n\t\tthis.filmOffset = source.filmOffset;\n\n\t\treturn this;\n\n\t},\n\n\t/**\n\t * Sets the FOV by focal length in respect to the current .filmGauge.\n\t *\n\t * The default film gauge is 35, so that the focal length can be specified for\n\t * a 35mm (full frame) camera.\n\t *\n\t * Values for focal length and film gauge must have the same unit.\n\t */\n\tsetFocalLength: function ( focalLength ) {\n\n\t\t// see http://www.bobatkins.com/photography/technical/field_of_view.html\n\t\tconst vExtentSlope = 0.5 * this.getFilmHeight() / focalLength;\n\n\t\tthis.fov = MathUtils.RAD2DEG * 2 * Math.atan( vExtentSlope );\n\t\tthis.updateProjectionMatrix();\n\n\t},\n\n\t/**\n\t * Calculates the focal length from the current .fov and .filmGauge.\n\t */\n\tgetFocalLength: function () {\n\n\t\tconst vExtentSlope = Math.tan( MathUtils.DEG2RAD * 0.5 * this.fov );\n\n\t\treturn 0.5 * this.getFilmHeight() / vExtentSlope;\n\n\t},\n\n\tgetEffectiveFOV: function () {\n\n\t\treturn MathUtils.RAD2DEG * 2 * Math.atan(\n\t\t\tMath.tan( MathUtils.DEG2RAD * 0.5 * this.fov ) / this.zoom );\n\n\t},\n\n\tgetFilmWidth: function () {\n\n\t\t// film not completely covered in portrait format (aspect < 1)\n\t\treturn this.filmGauge * Math.min( this.aspect, 1 );\n\n\t},\n\n\tgetFilmHeight: function () {\n\n\t\t// film not completely covered in landscape format (aspect > 1)\n\t\treturn this.filmGauge / Math.max( this.aspect, 1 );\n\n\t},\n\n\t/**\n\t * Sets an offset in a larger frustum. This is useful for multi-window or\n\t * multi-monitor/multi-machine setups.\n\t *\n\t * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\n\t * the monitors are in grid like this\n\t *\n\t *   +---+---+---+\n\t *   | A | B | C |\n\t *   +---+---+---+\n\t *   | D | E | F |\n\t *   +---+---+---+\n\t *\n\t * then for each monitor you would call it like this\n\t *\n\t *   const w = 1920;\n\t *   const h = 1080;\n\t *   const fullWidth = w * 3;\n\t *   const fullHeight = h * 2;\n\t *\n\t *   --A--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\n\t *   --B--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\n\t *   --C--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\n\t *   --D--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\n\t *   --E--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\n\t *   --F--\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\n\t *\n\t *   Note there is no reason monitors have to be the same size or in a grid.\n\t */\n\tsetViewOffset: function ( fullWidth, fullHeight, x, y, width, height ) {\n\n\t\tthis.aspect = fullWidth / fullHeight;\n\n\t\tif ( this.view === null ) {\n\n\t\t\tthis.view = {\n\t\t\t\tenabled: true,\n\t\t\t\tfullWidth: 1,\n\t\t\t\tfullHeight: 1,\n\t\t\t\toffsetX: 0,\n\t\t\t\toffsetY: 0,\n\t\t\t\twidth: 1,\n\t\t\t\theight: 1\n\t\t\t};\n\n\t\t}\n\n\t\tthis.view.enabled = true;\n\t\tthis.view.fullWidth = fullWidth;\n\t\tthis.view.fullHeight = fullHeight;\n\t\tthis.view.offsetX = x;\n\t\tthis.view.offsetY = y;\n\t\tthis.view.width = width;\n\t\tthis.view.height = height;\n\n\t\tthis.updateProjectionMatrix();\n\n\t},\n\n\tclearViewOffset: function () {\n\n\t\tif ( this.view !== null ) {\n\n\t\t\tthis.view.enabled = false;\n\n\t\t}\n\n\t\tthis.updateProjectionMatrix();\n\n\t},\n\n\tupdateProjectionMatrix: function () {\n\n\t\tlet near = this.near,\n\t\t\ttop = near * Math.tan( MathUtils.DEG2RAD * 0.5 * this.fov ) / this.zoom,\n\t\t\theight = 2 * top,\n\t\t\twidth = this.aspect * height,\n\t\t\tleft = - 0.5 * width,\n\t\t\tview = this.view;\n\n\t\tif ( this.view !== null && this.view.enabled ) {\n\n\t\t\tconst fullWidth = view.fullWidth,\n\t\t\t\tfullHeight = view.fullHeight;\n\n\t\t\tleft += view.offsetX * width / fullWidth;\n\t\t\ttop -= view.offsetY * height / fullHeight;\n\t\t\twidth *= view.width / fullWidth;\n\t\t\theight *= view.height / fullHeight;\n\n\t\t}\n\n\t\tconst skew = this.filmOffset;\n\t\tif ( skew !== 0 ) left += near * skew / this.getFilmWidth();\n\n\t\tthis.projectionMatrix.makePerspective( left, left + width, top, top - height, near, this.far );\n\n\t\tthis.projectionMatrixInverse.getInverse( this.projectionMatrix );\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\tconst data = Object3D.prototype.toJSON.call( this, meta );\n\n\t\tdata.object.fov = this.fov;\n\t\tdata.object.zoom = this.zoom;\n\n\t\tdata.object.near = this.near;\n\t\tdata.object.far = this.far;\n\t\tdata.object.focus = this.focus;\n\n\t\tdata.object.aspect = this.aspect;\n\n\t\tif ( this.view !== null ) data.object.view = Object.assign( {}, this.view );\n\n\t\tdata.object.filmGauge = this.filmGauge;\n\t\tdata.object.filmOffset = this.filmOffset;\n\n\t\treturn data;\n\n\t}\n\n} );\n\n\nexport { PerspectiveCamera };\n","/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport { Texture } from './Texture.js';\nimport { NearestFilter } from '../constants.js';\n\nfunction DataTexture( data, width, height, format, type, mapping, wrapS, wrapT, magFilter, minFilter, anisotropy, encoding ) {\n\n\tTexture.call( this, null, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding );\n\n\tthis.image = { data: data || null, width: width || 1, height: height || 1 };\n\n\tthis.magFilter = magFilter !== undefined ? magFilter : NearestFilter;\n\tthis.minFilter = minFilter !== undefined ? minFilter : NearestFilter;\n\n\tthis.generateMipmaps = false;\n\tthis.flipY = false;\n\tthis.unpackAlignment = 1;\n\n\tthis.needsUpdate = true;\n\n}\n\nDataTexture.prototype = Object.create( Texture.prototype );\nDataTexture.prototype.constructor = DataTexture;\n\nDataTexture.prototype.isDataTexture = true;\n\n\nexport { DataTexture };\n","import { Vector3 } from './Vector3.js';\nimport { Sphere } from './Sphere.js';\nimport { Plane } from './Plane.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author bhouston / http://clara.io\n */\n\nconst _sphere = new Sphere();\nconst _vector = new Vector3();\n\nfunction Frustum( p0, p1, p2, p3, p4, p5 ) {\n\n\tthis.planes = [\n\n\t\t( p0 !== undefined ) ? p0 : new Plane(),\n\t\t( p1 !== undefined ) ? p1 : new Plane(),\n\t\t( p2 !== undefined ) ? p2 : new Plane(),\n\t\t( p3 !== undefined ) ? p3 : new Plane(),\n\t\t( p4 !== undefined ) ? p4 : new Plane(),\n\t\t( p5 !== undefined ) ? p5 : new Plane()\n\n\t];\n\n}\n\nObject.assign( Frustum.prototype, {\n\n\tset: function ( p0, p1, p2, p3, p4, p5 ) {\n\n\t\tconst planes = this.planes;\n\n\t\tplanes[ 0 ].copy( p0 );\n\t\tplanes[ 1 ].copy( p1 );\n\t\tplanes[ 2 ].copy( p2 );\n\t\tplanes[ 3 ].copy( p3 );\n\t\tplanes[ 4 ].copy( p4 );\n\t\tplanes[ 5 ].copy( p5 );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\tcopy: function ( frustum ) {\n\n\t\tconst planes = this.planes;\n\n\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\tplanes[ i ].copy( frustum.planes[ i ] );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tsetFromProjectionMatrix: function ( m ) {\n\n\t\tconst planes = this.planes;\n\t\tconst me = m.elements;\n\t\tconst me0 = me[ 0 ], me1 = me[ 1 ], me2 = me[ 2 ], me3 = me[ 3 ];\n\t\tconst me4 = me[ 4 ], me5 = me[ 5 ], me6 = me[ 6 ], me7 = me[ 7 ];\n\t\tconst me8 = me[ 8 ], me9 = me[ 9 ], me10 = me[ 10 ], me11 = me[ 11 ];\n\t\tconst me12 = me[ 12 ], me13 = me[ 13 ], me14 = me[ 14 ], me15 = me[ 15 ];\n\n\t\tplanes[ 0 ].setComponents( me3 - me0, me7 - me4, me11 - me8, me15 - me12 ).normalize();\n\t\tplanes[ 1 ].setComponents( me3 + me0, me7 + me4, me11 + me8, me15 + me12 ).normalize();\n\t\tplanes[ 2 ].setComponents( me3 + me1, me7 + me5, me11 + me9, me15 + me13 ).normalize();\n\t\tplanes[ 3 ].setComponents( me3 - me1, me7 - me5, me11 - me9, me15 - me13 ).normalize();\n\t\tplanes[ 4 ].setComponents( me3 - me2, me7 - me6, me11 - me10, me15 - me14 ).normalize();\n\t\tplanes[ 5 ].setComponents( me3 + me2, me7 + me6, me11 + me10, me15 + me14 ).normalize();\n\n\t\treturn this;\n\n\t},\n\n\tintersectsObject: function ( object ) {\n\n\t\tconst geometry = object.geometry;\n\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\n\n\t\t_sphere.copy( geometry.boundingSphere ).applyMatrix4( object.matrixWorld );\n\n\t\treturn this.intersectsSphere( _sphere );\n\n\t},\n\n\tintersectsSprite: function ( sprite ) {\n\n\t\t_sphere.center.set( 0, 0, 0 );\n\t\t_sphere.radius = 0.7071067811865476;\n\t\t_sphere.applyMatrix4( sprite.matrixWorld );\n\n\t\treturn this.intersectsSphere( _sphere );\n\n\t},\n\n\tintersectsSphere: function ( sphere ) {\n\n\t\tconst planes = this.planes;\n\t\tconst center = sphere.center;\n\t\tconst negRadius = - sphere.radius;\n\n\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\tconst distance = planes[ i ].distanceToPoint( center );\n\n\t\t\tif ( distance < negRadius ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t},\n\n\tintersectsBox: function ( box ) {\n\n\t\tconst planes = this.planes;\n\n\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\tconst plane = planes[ i ];\n\n\t\t\t// corner at max distance\n\n\t\t\t_vector.x = plane.normal.x > 0 ? box.max.x : box.min.x;\n\t\t\t_vector.y = plane.normal.y > 0 ? box.max.y : box.min.y;\n\t\t\t_vector.z = plane.normal.z > 0 ? box.max.z : box.min.z;\n\n\t\t\tif ( plane.distanceToPoint( _vector ) < 0 ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t},\n\n\tcontainsPoint: function ( point ) {\n\n\t\tconst planes = this.planes;\n\n\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\tif ( planes[ i ].distanceToPoint( point ) < 0 ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n} );\n\n\nexport { Frustum };\n","import { Color } from '../../math/Color.js';\nimport { Vector2 } from '../../math/Vector2.js';\nimport { Matrix3 } from '../../math/Matrix3.js';\n\n/**\n * Uniforms library for shared webgl shaders\n */\n\nconst UniformsLib = {\n\n\tcommon: {\n\n\t\tdiffuse: { value: new Color( 0xeeeeee ) },\n\t\topacity: { value: 1.0 },\n\n\t\tmap: { value: null },\n\t\tuvTransform: { value: new Matrix3() },\n\t\tuv2Transform: { value: new Matrix3() },\n\n\t\talphaMap: { value: null },\n\n\t},\n\n\tspecularmap: {\n\n\t\tspecularMap: { value: null },\n\n\t},\n\n\tenvmap: {\n\n\t\tenvMap: { value: null },\n\t\tflipEnvMap: { value: - 1 },\n\t\treflectivity: { value: 1.0 },\n\t\trefractionRatio: { value: 0.98 },\n\t\tmaxMipLevel: { value: 0 }\n\n\t},\n\n\taomap: {\n\n\t\taoMap: { value: null },\n\t\taoMapIntensity: { value: 1 }\n\n\t},\n\n\tlightmap: {\n\n\t\tlightMap: { value: null },\n\t\tlightMapIntensity: { value: 1 }\n\n\t},\n\n\temissivemap: {\n\n\t\temissiveMap: { value: null }\n\n\t},\n\n\tbumpmap: {\n\n\t\tbumpMap: { value: null },\n\t\tbumpScale: { value: 1 }\n\n\t},\n\n\tnormalmap: {\n\n\t\tnormalMap: { value: null },\n\t\tnormalScale: { value: new Vector2( 1, 1 ) }\n\n\t},\n\n\tdisplacementmap: {\n\n\t\tdisplacementMap: { value: null },\n\t\tdisplacementScale: { value: 1 },\n\t\tdisplacementBias: { value: 0 }\n\n\t},\n\n\troughnessmap: {\n\n\t\troughnessMap: { value: null }\n\n\t},\n\n\tmetalnessmap: {\n\n\t\tmetalnessMap: { value: null }\n\n\t},\n\n\tgradientmap: {\n\n\t\tgradientMap: { value: null }\n\n\t},\n\n\tfog: {\n\n\t\tfogDensity: { value: 0.00025 },\n\t\tfogNear: { value: 1 },\n\t\tfogFar: { value: 2000 },\n\t\tfogColor: { value: new Color( 0xffffff ) }\n\n\t},\n\n\tlights: {\n\n\t\tambientLightColor: { value: [] },\n\n\t\tlightProbe: { value: [] },\n\n\t\tdirectionalLights: { value: [], properties: {\n\t\t\tdirection: {},\n\t\t\tcolor: {}\n\t\t} },\n\n\t\tdirectionalLightShadows: { value: [], properties: {\n\t\t\tshadowBias: {},\n\t\t\tshadowNormalBias: {},\n\t\t\tshadowRadius: {},\n\t\t\tshadowMapSize: {}\n\t\t} },\n\n\t\tdirectionalShadowMap: { value: [] },\n\t\tdirectionalShadowMatrix: { value: [] },\n\n\t\tspotLights: { value: [], properties: {\n\t\t\tcolor: {},\n\t\t\tposition: {},\n\t\t\tdirection: {},\n\t\t\tdistance: {},\n\t\t\tconeCos: {},\n\t\t\tpenumbraCos: {},\n\t\t\tdecay: {}\n\t\t} },\n\n\t\tspotLightShadows: { value: [], properties: {\n\t\t\tshadowBias: {},\n\t\t\tshadowNormalBias: {},\n\t\t\tshadowRadius: {},\n\t\t\tshadowMapSize: {}\n\t\t} },\n\n\t\tspotShadowMap: { value: [] },\n\t\tspotShadowMatrix: { value: [] },\n\n\t\tpointLights: { value: [], properties: {\n\t\t\tcolor: {},\n\t\t\tposition: {},\n\t\t\tdecay: {},\n\t\t\tdistance: {}\n\t\t} },\n\n\t\tpointLightShadows: { value: [], properties: {\n\t\t\tshadowBias: {},\n\t\t\tshadowNormalBias: {},\n\t\t\tshadowRadius: {},\n\t\t\tshadowMapSize: {},\n\t\t\tshadowCameraNear: {},\n\t\t\tshadowCameraFar: {}\n\t\t} },\n\n\t\tpointShadowMap: { value: [] },\n\t\tpointShadowMatrix: { value: [] },\n\n\t\themisphereLights: { value: [], properties: {\n\t\t\tdirection: {},\n\t\t\tskyColor: {},\n\t\t\tgroundColor: {}\n\t\t} },\n\n\t\t// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src\n\t\trectAreaLights: { value: [], properties: {\n\t\t\tcolor: {},\n\t\t\tposition: {},\n\t\t\twidth: {},\n\t\t\theight: {}\n\t\t} }\n\n\t},\n\n\tpoints: {\n\n\t\tdiffuse: { value: new Color( 0xeeeeee ) },\n\t\topacity: { value: 1.0 },\n\t\tsize: { value: 1.0 },\n\t\tscale: { value: 1.0 },\n\t\tmap: { value: null },\n\t\talphaMap: { value: null },\n\t\tuvTransform: { value: new Matrix3() }\n\n\t},\n\n\tsprite: {\n\n\t\tdiffuse: { value: new Color( 0xeeeeee ) },\n\t\topacity: { value: 1.0 },\n\t\tcenter: { value: new Vector2( 0.5, 0.5 ) },\n\t\trotation: { value: 0.0 },\n\t\tmap: { value: null },\n\t\talphaMap: { value: null },\n\t\tuvTransform: { value: new Matrix3() }\n\n\t}\n\n};\n\nexport { UniformsLib };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLAnimation() {\n\n\tlet context = null;\n\tlet isAnimating = false;\n\tlet animationLoop = null;\n\tlet requestId = null;\n\n\tfunction onAnimationFrame( time, frame ) {\n\n\t\tanimationLoop( time, frame );\n\n\t\trequestId = context.requestAnimationFrame( onAnimationFrame );\n\n\t}\n\n\treturn {\n\n\t\tstart: function () {\n\n\t\t\tif ( isAnimating === true ) return;\n\t\t\tif ( animationLoop === null ) return;\n\n\t\t\trequestId = context.requestAnimationFrame( onAnimationFrame );\n\n\t\t\tisAnimating = true;\n\n\t\t},\n\n\t\tstop: function () {\n\n\t\t\tcontext.cancelAnimationFrame( requestId );\n\n\t\t\tisAnimating = false;\n\n\t\t},\n\n\t\tsetAnimationLoop: function ( callback ) {\n\n\t\t\tanimationLoop = callback;\n\n\t\t},\n\n\t\tsetContext: function ( value ) {\n\n\t\t\tcontext = value;\n\n\t\t}\n\n\t};\n\n}\n\nexport { WebGLAnimation };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLAttributes( gl, capabilities ) {\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\n\tconst buffers = new WeakMap();\n\n\tfunction createBuffer( attribute, bufferType ) {\n\n\t\tconst array = attribute.array;\n\t\tconst usage = attribute.usage;\n\n\t\tconst buffer = gl.createBuffer();\n\n\t\tgl.bindBuffer( bufferType, buffer );\n\t\tgl.bufferData( bufferType, array, usage );\n\n\t\tattribute.onUploadCallback();\n\n\t\tlet type = gl.FLOAT;\n\n\t\tif ( array instanceof Float32Array ) {\n\n\t\t\ttype = gl.FLOAT;\n\n\t\t} else if ( array instanceof Float64Array ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.' );\n\n\t\t} else if ( array instanceof Uint16Array ) {\n\n\t\t\ttype = gl.UNSIGNED_SHORT;\n\n\t\t} else if ( array instanceof Int16Array ) {\n\n\t\t\ttype = gl.SHORT;\n\n\t\t} else if ( array instanceof Uint32Array ) {\n\n\t\t\ttype = gl.UNSIGNED_INT;\n\n\t\t} else if ( array instanceof Int32Array ) {\n\n\t\t\ttype = gl.INT;\n\n\t\t} else if ( array instanceof Int8Array ) {\n\n\t\t\ttype = gl.BYTE;\n\n\t\t} else if ( array instanceof Uint8Array ) {\n\n\t\t\ttype = gl.UNSIGNED_BYTE;\n\n\t\t}\n\n\t\treturn {\n\t\t\tbuffer: buffer,\n\t\t\ttype: type,\n\t\t\tbytesPerElement: array.BYTES_PER_ELEMENT,\n\t\t\tversion: attribute.version\n\t\t};\n\n\t}\n\n\tfunction updateBuffer( buffer, attribute, bufferType ) {\n\n\t\tconst array = attribute.array;\n\t\tconst updateRange = attribute.updateRange;\n\n\t\tgl.bindBuffer( bufferType, buffer );\n\n\t\tif ( updateRange.count === - 1 ) {\n\n\t\t\t// Not using update ranges\n\n\t\t\tgl.bufferSubData( bufferType, 0, array );\n\n\t\t} else {\n\n\t\t\tif ( isWebGL2 ) {\n\n\t\t\t\tgl.bufferSubData( bufferType, updateRange.offset * array.BYTES_PER_ELEMENT,\n\t\t\t\t\tarray, updateRange.offset, updateRange.count );\n\n\t\t\t} else {\n\n\t\t\t\tgl.bufferSubData( bufferType, updateRange.offset * array.BYTES_PER_ELEMENT,\n\t\t\t\t\tarray.subarray( updateRange.offset, updateRange.offset + updateRange.count ) );\n\n\t\t\t}\n\n\t\t\tupdateRange.count = - 1; // reset range\n\n\t\t}\n\n\t}\n\n\t//\n\n\tfunction get( attribute ) {\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\n\n\t\treturn buffers.get( attribute );\n\n\t}\n\n\tfunction remove( attribute ) {\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\n\n\t\tconst data = buffers.get( attribute );\n\n\t\tif ( data ) {\n\n\t\t\tgl.deleteBuffer( data.buffer );\n\n\t\t\tbuffers.delete( attribute );\n\n\t\t}\n\n\t}\n\n\tfunction update( attribute, bufferType ) {\n\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\n\n\t\tconst data = buffers.get( attribute );\n\n\t\tif ( data === undefined ) {\n\n\t\t\tbuffers.set( attribute, createBuffer( attribute, bufferType ) );\n\n\t\t} else if ( data.version < attribute.version ) {\n\n\t\t\tupdateBuffer( data.buffer, attribute, bufferType );\n\n\t\t\tdata.version = attribute.version;\n\n\t\t}\n\n\t}\n\n\treturn {\n\n\t\tget: get,\n\t\tremove: remove,\n\t\tupdate: update\n\n\t};\n\n}\n\n\nexport { WebGLAttributes };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\n\n// PlaneGeometry\n\nfunction PlaneGeometry( width, height, widthSegments, heightSegments ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'PlaneGeometry';\n\n\tthis.parameters = {\n\t\twidth: width,\n\t\theight: height,\n\t\twidthSegments: widthSegments,\n\t\theightSegments: heightSegments\n\t};\n\n\tthis.fromBufferGeometry( new PlaneBufferGeometry( width, height, widthSegments, heightSegments ) );\n\tthis.mergeVertices();\n\n}\n\nPlaneGeometry.prototype = Object.create( Geometry.prototype );\nPlaneGeometry.prototype.constructor = PlaneGeometry;\n\n// PlaneBufferGeometry\n\nfunction PlaneBufferGeometry( width, height, widthSegments, heightSegments ) {\n\n\tBufferGeometry.call( this );\n\n\tthis.type = 'PlaneBufferGeometry';\n\n\tthis.parameters = {\n\t\twidth: width,\n\t\theight: height,\n\t\twidthSegments: widthSegments,\n\t\theightSegments: heightSegments\n\t};\n\n\twidth = width || 1;\n\theight = height || 1;\n\n\tconst width_half = width / 2;\n\tconst height_half = height / 2;\n\n\tconst gridX = Math.floor( widthSegments ) || 1;\n\tconst gridY = Math.floor( heightSegments ) || 1;\n\n\tconst gridX1 = gridX + 1;\n\tconst gridY1 = gridY + 1;\n\n\tconst segment_width = width / gridX;\n\tconst segment_height = height / gridY;\n\n\t// buffers\n\n\tconst indices = [];\n\tconst vertices = [];\n\tconst normals = [];\n\tconst uvs = [];\n\n\t// generate vertices, normals and uvs\n\n\tfor ( let iy = 0; iy < gridY1; iy ++ ) {\n\n\t\tconst y = iy * segment_height - height_half;\n\n\t\tfor ( let ix = 0; ix < gridX1; ix ++ ) {\n\n\t\t\tconst x = ix * segment_width - width_half;\n\n\t\t\tvertices.push( x, - y, 0 );\n\n\t\t\tnormals.push( 0, 0, 1 );\n\n\t\t\tuvs.push( ix / gridX );\n\t\t\tuvs.push( 1 - ( iy / gridY ) );\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tfor ( let iy = 0; iy < gridY; iy ++ ) {\n\n\t\tfor ( let ix = 0; ix < gridX; ix ++ ) {\n\n\t\t\tconst a = ix + gridX1 * iy;\n\t\t\tconst b = ix + gridX1 * ( iy + 1 );\n\t\t\tconst c = ( ix + 1 ) + gridX1 * ( iy + 1 );\n\t\t\tconst d = ( ix + 1 ) + gridX1 * iy;\n\n\t\t\t// faces\n\n\t\t\tindices.push( a, b, d );\n\t\t\tindices.push( b, c, d );\n\n\t\t}\n\n\t}\n\n\t// build geometry\n\n\tthis.setIndex( indices );\n\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\n}\n\nPlaneBufferGeometry.prototype = Object.create( BufferGeometry.prototype );\nPlaneBufferGeometry.prototype.constructor = PlaneBufferGeometry;\n\n\nexport { PlaneGeometry, PlaneBufferGeometry };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { BackSide, FrontSide, CubeUVReflectionMapping } from '../../constants.js';\nimport { BoxBufferGeometry } from '../../geometries/BoxGeometry.js';\nimport { PlaneBufferGeometry } from '../../geometries/PlaneGeometry.js';\nimport { ShaderMaterial } from '../../materials/ShaderMaterial.js';\nimport { Color } from '../../math/Color.js';\nimport { Mesh } from '../../objects/Mesh.js';\nimport { ShaderLib } from '../shaders/ShaderLib.js';\nimport { cloneUniforms } from '../shaders/UniformsUtils.js';\n\nfunction WebGLBackground( renderer, state, objects, premultipliedAlpha ) {\n\n\tconst clearColor = new Color( 0x000000 );\n\tlet clearAlpha = 0;\n\n\tlet planeMesh;\n\tlet boxMesh;\n\n\tlet currentBackground = null;\n\tlet currentBackgroundVersion = 0;\n\tlet currentTonemapping = null;\n\n\tfunction render( renderList, scene, camera, forceClear ) {\n\n\t\tlet background = scene.isScene === true ? scene.background : null;\n\n\t\t// Ignore background in AR\n\t\t// TODO: Reconsider this.\n\n\t\tconst xr = renderer.xr;\n\t\tconst session = xr.getSession && xr.getSession();\n\n\t\tif ( session && session.environmentBlendMode === 'additive' ) {\n\n\t\t\tbackground = null;\n\n\t\t}\n\n\t\tif ( background === null ) {\n\n\t\t\tsetClear( clearColor, clearAlpha );\n\n\t\t} else if ( background && background.isColor ) {\n\n\t\t\tsetClear( background, 1 );\n\t\t\tforceClear = true;\n\n\t\t}\n\n\t\tif ( renderer.autoClear || forceClear ) {\n\n\t\t\trenderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\n\n\t\t}\n\n\t\tif ( background && ( background.isCubeTexture || background.isWebGLCubeRenderTarget || background.mapping === CubeUVReflectionMapping ) ) {\n\n\t\t\tif ( boxMesh === undefined ) {\n\n\t\t\t\tboxMesh = new Mesh(\n\t\t\t\t\tnew BoxBufferGeometry( 1, 1, 1 ),\n\t\t\t\t\tnew ShaderMaterial( {\n\t\t\t\t\t\tname: 'BackgroundCubeMaterial',\n\t\t\t\t\t\tuniforms: cloneUniforms( ShaderLib.cube.uniforms ),\n\t\t\t\t\t\tvertexShader: ShaderLib.cube.vertexShader,\n\t\t\t\t\t\tfragmentShader: ShaderLib.cube.fragmentShader,\n\t\t\t\t\t\tside: BackSide,\n\t\t\t\t\t\tdepthTest: false,\n\t\t\t\t\t\tdepthWrite: false,\n\t\t\t\t\t\tfog: false\n\t\t\t\t\t} )\n\t\t\t\t);\n\n\t\t\t\tboxMesh.geometry.deleteAttribute( 'normal' );\n\t\t\t\tboxMesh.geometry.deleteAttribute( 'uv' );\n\n\t\t\t\tboxMesh.onBeforeRender = function ( renderer, scene, camera ) {\n\n\t\t\t\t\tthis.matrixWorld.copyPosition( camera.matrixWorld );\n\n\t\t\t\t};\n\n\t\t\t\t// enable code injection for non-built-in material\n\t\t\t\tObject.defineProperty( boxMesh.material, 'envMap', {\n\n\t\t\t\t\tget: function () {\n\n\t\t\t\t\t\treturn this.uniforms.envMap.value;\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tobjects.update( boxMesh );\n\n\t\t\t}\n\n\t\t\tconst texture = background.isWebGLCubeRenderTarget ? background.texture : background;\n\n\t\t\tboxMesh.material.uniforms.envMap.value = texture;\n\t\t\tboxMesh.material.uniforms.flipEnvMap.value = texture.isCubeTexture ? - 1 : 1;\n\n\t\t\tif ( currentBackground !== background ||\n\t\t\t\tcurrentBackgroundVersion !== texture.version ||\n\t\t\t\tcurrentTonemapping !== renderer.toneMapping ) {\n\n\t\t\t\tboxMesh.material.needsUpdate = true;\n\n\t\t\t\tcurrentBackground = background;\n\t\t\t\tcurrentBackgroundVersion = texture.version;\n\t\t\t\tcurrentTonemapping = renderer.toneMapping;\n\n\t\t\t}\n\n\t\t\t// push to the pre-sorted opaque render list\n\t\t\trenderList.unshift( boxMesh, boxMesh.geometry, boxMesh.material, 0, 0, null );\n\n\t\t} else if ( background && background.isTexture ) {\n\n\t\t\tif ( planeMesh === undefined ) {\n\n\t\t\t\tplaneMesh = new Mesh(\n\t\t\t\t\tnew PlaneBufferGeometry( 2, 2 ),\n\t\t\t\t\tnew ShaderMaterial( {\n\t\t\t\t\t\tname: 'BackgroundMaterial',\n\t\t\t\t\t\tuniforms: cloneUniforms( ShaderLib.background.uniforms ),\n\t\t\t\t\t\tvertexShader: ShaderLib.background.vertexShader,\n\t\t\t\t\t\tfragmentShader: ShaderLib.background.fragmentShader,\n\t\t\t\t\t\tside: FrontSide,\n\t\t\t\t\t\tdepthTest: false,\n\t\t\t\t\t\tdepthWrite: false,\n\t\t\t\t\t\tfog: false\n\t\t\t\t\t} )\n\t\t\t\t);\n\n\t\t\t\tplaneMesh.geometry.deleteAttribute( 'normal' );\n\n\t\t\t\t// enable code injection for non-built-in material\n\t\t\t\tObject.defineProperty( planeMesh.material, 'map', {\n\n\t\t\t\t\tget: function () {\n\n\t\t\t\t\t\treturn this.uniforms.t2D.value;\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tobjects.update( planeMesh );\n\n\t\t\t}\n\n\t\t\tplaneMesh.material.uniforms.t2D.value = background;\n\n\t\t\tif ( background.matrixAutoUpdate === true ) {\n\n\t\t\t\tbackground.updateMatrix();\n\n\t\t\t}\n\n\t\t\tplaneMesh.material.uniforms.uvTransform.value.copy( background.matrix );\n\n\t\t\tif ( currentBackground !== background ||\n\t\t\t\tcurrentBackgroundVersion !== background.version ||\n\t\t\t\tcurrentTonemapping !== renderer.toneMapping ) {\n\n\t\t\t\tplaneMesh.material.needsUpdate = true;\n\n\t\t\t\tcurrentBackground = background;\n\t\t\t\tcurrentBackgroundVersion = background.version;\n\t\t\t\tcurrentTonemapping = renderer.toneMapping;\n\n\t\t\t}\n\n\n\t\t\t// push to the pre-sorted opaque render list\n\t\t\trenderList.unshift( planeMesh, planeMesh.geometry, planeMesh.material, 0, 0, null );\n\n\t\t}\n\n\t}\n\n\tfunction setClear( color, alpha ) {\n\n\t\tstate.buffers.color.setClear( color.r, color.g, color.b, alpha, premultipliedAlpha );\n\n\t}\n\n\treturn {\n\n\t\tgetClearColor: function () {\n\n\t\t\treturn clearColor;\n\n\t\t},\n\t\tsetClearColor: function ( color, alpha ) {\n\n\t\t\tclearColor.set( color );\n\t\t\tclearAlpha = alpha !== undefined ? alpha : 1;\n\t\t\tsetClear( clearColor, clearAlpha );\n\n\t\t},\n\t\tgetClearAlpha: function () {\n\n\t\t\treturn clearAlpha;\n\n\t\t},\n\t\tsetClearAlpha: function ( alpha ) {\n\n\t\t\tclearAlpha = alpha;\n\t\t\tsetClear( clearColor, clearAlpha );\n\n\t\t},\n\t\trender: render\n\n\t};\n\n}\n\n\nexport { WebGLBackground };\n","﻿/**\n * @author Mugen87 / https://github.com/Mugen87\n * @author Takahiro / https://github.com/takahirox\n */\n\nfunction WebGLBindingStates( gl, extensions, attributes, capabilities ) {\n\n\tconst maxVertexAttributes = gl.getParameter( gl.MAX_VERTEX_ATTRIBS );\n\n\tconst extension = capabilities.isWebGL2 ? null : extensions.get( 'OES_vertex_array_object' );\n\tconst vaoAvailable = capabilities.isWebGL2 || extension !== null;\n\n\tconst bindingStates = {};\n\n\tconst defaultState = createBindingState( null );\n\tlet currentState = defaultState;\n\n\tfunction setup( object, material, program, geometry, index ) {\n\n\t\tlet updateBuffers = false;\n\n\t\tif ( vaoAvailable ) {\n\n\t\t\tconst state = getBindingState( geometry, program, material );\n\n\t\t\tif ( currentState !== state ) {\n\n\t\t\t\tcurrentState = state;\n\t\t\t\tbindVertexArrayObject( currentState.object );\n\n\t\t\t}\n\n\t\t\tupdateBuffers = needsUpdate( geometry );\n\n\t\t\tif ( updateBuffers ) saveCache( geometry );\n\n\t\t} else {\n\n\t\t\tconst wireframe = ( material.wireframe === true );\n\n\t\t\tif ( currentState.geometry !== geometry.id ||\n\t\t\t\tcurrentState.program !== program.id ||\n\t\t\t\tcurrentState.wireframe !== wireframe ) {\n\n\t\t\t\tcurrentState.geometry = geometry.id;\n\t\t\t\tcurrentState.program = program.id;\n\t\t\t\tcurrentState.wireframe = wireframe;\n\n\t\t\t\tupdateBuffers = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( object.isInstancedMesh === true ) {\n\n\t\t\tupdateBuffers = true;\n\n\t\t}\n\n\t\tif ( index !== null ) {\n\n\t\t\tattributes.update( index, gl.ELEMENT_ARRAY_BUFFER );\n\n\t\t}\n\n\t\tif ( updateBuffers ) {\n\n\t\t\tsetupVertexAttributes( object, material, program, geometry );\n\n\t\t\tif ( index !== null ) {\n\n\t\t\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, attributes.get( index ).buffer );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction createVertexArrayObject() {\n\n\t\tif ( capabilities.isWebGL2 ) return gl.createVertexArray();\n\n\t\treturn extension.createVertexArrayOES();\n\n\t}\n\n\tfunction bindVertexArrayObject( vao ) {\n\n\t\tif ( capabilities.isWebGL2 ) return gl.bindVertexArray( vao );\n\n\t\treturn extension.bindVertexArrayOES( vao );\n\n\t}\n\n\tfunction deleteVertexArrayObject( vao ) {\n\n\t\tif ( capabilities.isWebGL2 ) return gl.deleteVertexArray( vao );\n\n\t\treturn extension.deleteVertexArrayOES( vao );\n\n\t}\n\n\tfunction getBindingState( geometry, program, material ) {\n\n\t\tconst wireframe = ( material.wireframe === true );\n\n\t\tlet programMap = bindingStates[ geometry.id ];\n\n\t\tif ( programMap === undefined ) {\n\n\t\t\tprogramMap = {};\n\t\t\tbindingStates[ geometry.id ] = programMap;\n\n\t\t}\n\n\t\tlet stateMap = programMap[ program.id ];\n\n\t\tif ( stateMap === undefined ) {\n\n\t\t\tstateMap = {};\n\t\t\tprogramMap[ program.id ] = stateMap;\n\n\t\t}\n\n\t\tlet state = stateMap[ wireframe ];\n\n\t\tif ( state === undefined ) {\n\n\t\t\tstate = createBindingState( createVertexArrayObject() );\n\t\t\tstateMap[ wireframe ] = state;\n\n\t\t}\n\n\t\treturn state;\n\n\t}\n\n\tfunction createBindingState( vao ) {\n\n\t\tconst newAttributes = [];\n\t\tconst enabledAttributes = [];\n\t\tconst attributeDivisors = [];\n\n\t\tfor ( let i = 0; i < maxVertexAttributes; i ++ ) {\n\n\t\t\tnewAttributes[ i ] = 0;\n\t\t\tenabledAttributes[ i ] = 0;\n\t\t\tattributeDivisors[ i ] = 0;\n\n\t\t}\n\n\t\treturn {\n\n\t\t\t// for backward compatibility on non-VAO support browser\n\t\t\tgeometry: null,\n\t\t\tprogram: null,\n\t\t\twireframe: false,\n\n\t\t\tnewAttributes: newAttributes,\n\t\t\tenabledAttributes: enabledAttributes,\n\t\t\tattributeDivisors: attributeDivisors,\n\t\t\tobject: vao,\n\t\t\tattributes: {}\n\n\t\t};\n\n\t}\n\n\tfunction needsUpdate( geometry ) {\n\n\t\tconst cachedAttributes = currentState.attributes;\n\t\tconst geometryAttributes = geometry.attributes;\n\n\t\tif ( Object.keys( cachedAttributes ).length !== Object.keys( geometryAttributes ).length ) return true;\n\n\t\tfor ( const key in geometryAttributes ) {\n\n\t\t\tconst cachedAttribute = cachedAttributes[ key ];\n\t\t\tconst geometryAttribute = geometryAttributes[ key ];\n\n\t\t\tif ( cachedAttribute.attribute !== geometryAttribute ) return true;\n\n\t\t\tif ( cachedAttribute.data !== geometryAttribute.data ) return true;\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tfunction saveCache( geometry ) {\n\n\t\tconst cache = {};\n\t\tconst attributes = geometry.attributes;\n\n\t\tfor ( const key in attributes ) {\n\n\t\t\tconst attribute = attributes[ key ];\n\n\t\t\tconst data = {};\n\t\t\tdata.attribute = attribute;\n\n\t\t\tif ( attribute.data ) {\n\n\t\t\t\tdata.data = attribute.data;\n\n\t\t\t}\n\n\t\t\tcache[ key ] = data;\n\n\t\t}\n\n\t\tcurrentState.attributes = cache;\n\n\t}\n\n\tfunction initAttributes() {\n\n\t\tconst newAttributes = currentState.newAttributes;\n\n\t\tfor ( let i = 0, il = newAttributes.length; i < il; i ++ ) {\n\n\t\t\tnewAttributes[ i ] = 0;\n\n\t\t}\n\n\t}\n\n\tfunction enableAttribute( attribute ) {\n\n\t\tenableAttributeAndDivisor( attribute, 0 );\n\n\t}\n\n\tfunction enableAttributeAndDivisor( attribute, meshPerAttribute ) {\n\n\t\tconst newAttributes = currentState.newAttributes;\n\t\tconst enabledAttributes = currentState.enabledAttributes;\n\t\tconst attributeDivisors = currentState.attributeDivisors;\n\n\t\tnewAttributes[ attribute ] = 1;\n\n\t\tif ( enabledAttributes[ attribute ] === 0 ) {\n\n\t\t\tgl.enableVertexAttribArray( attribute );\n\t\t\tenabledAttributes[ attribute ] = 1;\n\n\t\t}\n\n\t\tif ( attributeDivisors[ attribute ] !== meshPerAttribute ) {\n\n\t\t\tconst extension = capabilities.isWebGL2 ? gl : extensions.get( 'ANGLE_instanced_arrays' );\n\n\t\t\textension[ capabilities.isWebGL2 ? 'vertexAttribDivisor' : 'vertexAttribDivisorANGLE' ]( attribute, meshPerAttribute );\n\t\t\tattributeDivisors[ attribute ] = meshPerAttribute;\n\n\t\t}\n\n\t}\n\n\tfunction disableUnusedAttributes() {\n\n\t\tconst newAttributes = currentState.newAttributes;\n\t\tconst enabledAttributes = currentState.enabledAttributes;\n\n\t\tfor ( let i = 0, il = enabledAttributes.length; i < il; i ++ ) {\n\n\t\t\tif ( enabledAttributes[ i ] !== newAttributes[ i ] ) {\n\n\t\t\t\tgl.disableVertexAttribArray( i );\n\t\t\t\tenabledAttributes[ i ] = 0;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction vertexAttribPointer( index, size, type, normalized, stride, offset ) {\n\n\t\tif ( capabilities.isWebGL2 === true && ( type === gl.INT || type === gl.UNSIGNED_INT ) ) {\n\n\t\t\tgl.vertexAttribIPointer( index, size, type, normalized, stride, offset );\n\n\t\t} else {\n\n\t\t\tgl.vertexAttribPointer( index, size, type, normalized, stride, offset );\n\n\t\t}\n\n\t}\n\n\tfunction setupVertexAttributes( object, material, program, geometry ) {\n\n\t\tif ( capabilities.isWebGL2 === false && ( object.isInstancedMesh || geometry.isInstancedBufferGeometry ) ) {\n\n\t\t\tif ( extensions.get( 'ANGLE_instanced_arrays' ) === null ) return;\n\n\t\t}\n\n\t\tinitAttributes();\n\n\t\tconst geometryAttributes = geometry.attributes;\n\n\t\tconst programAttributes = program.getAttributes();\n\n\t\tconst materialDefaultAttributeValues = material.defaultAttributeValues;\n\n\t\tfor ( const name in programAttributes ) {\n\n\t\t\tconst programAttribute = programAttributes[ name ];\n\n\t\t\tif ( programAttribute >= 0 ) {\n\n\t\t\t\tconst geometryAttribute = geometryAttributes[ name ];\n\n\t\t\t\tif ( geometryAttribute !== undefined ) {\n\n\t\t\t\t\tconst normalized = geometryAttribute.normalized;\n\t\t\t\t\tconst size = geometryAttribute.itemSize;\n\n\t\t\t\t\tconst attribute = attributes.get( geometryAttribute );\n\n\t\t\t\t\t// TODO Attribute may not be available on context restore\n\n\t\t\t\t\tif ( attribute === undefined ) continue;\n\n\t\t\t\t\tconst buffer = attribute.buffer;\n\t\t\t\t\tconst type = attribute.type;\n\t\t\t\t\tconst bytesPerElement = attribute.bytesPerElement;\n\n\t\t\t\t\tif ( geometryAttribute.isInterleavedBufferAttribute ) {\n\n\t\t\t\t\t\tconst data = geometryAttribute.data;\n\t\t\t\t\t\tconst stride = data.stride;\n\t\t\t\t\t\tconst offset = geometryAttribute.offset;\n\n\t\t\t\t\t\tif ( data && data.isInstancedInterleavedBuffer ) {\n\n\t\t\t\t\t\t\tenableAttributeAndDivisor( programAttribute, data.meshPerAttribute );\n\n\t\t\t\t\t\t\tif ( geometry._maxInstanceCount === undefined ) {\n\n\t\t\t\t\t\t\t\tgeometry._maxInstanceCount = data.meshPerAttribute * data.count;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tenableAttribute( programAttribute );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\n\t\t\t\t\t\tvertexAttribPointer( programAttribute, size, type, normalized, stride * bytesPerElement, offset * bytesPerElement );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tif ( geometryAttribute.isInstancedBufferAttribute ) {\n\n\t\t\t\t\t\t\tenableAttributeAndDivisor( programAttribute, geometryAttribute.meshPerAttribute );\n\n\t\t\t\t\t\t\tif ( geometry._maxInstanceCount === undefined ) {\n\n\t\t\t\t\t\t\t\tgeometry._maxInstanceCount = geometryAttribute.meshPerAttribute * geometryAttribute.count;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tenableAttribute( programAttribute );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\n\t\t\t\t\t\tvertexAttribPointer( programAttribute, size, type, normalized, 0, 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( name === 'instanceMatrix' ) {\n\n\t\t\t\t\tconst attribute = attributes.get( object.instanceMatrix );\n\n\t\t\t\t\t// TODO Attribute may not be available on context restore\n\n\t\t\t\t\tif ( attribute === undefined ) continue;\n\n\t\t\t\t\tconst buffer = attribute.buffer;\n\t\t\t\t\tconst type = attribute.type;\n\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 0, 1 );\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 1, 1 );\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 2, 1 );\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 3, 1 );\n\n\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\n\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 0, 4, type, false, 64, 0 );\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 1, 4, type, false, 64, 16 );\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 2, 4, type, false, 64, 32 );\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 3, 4, type, false, 64, 48 );\n\n\t\t\t\t} else if ( materialDefaultAttributeValues !== undefined ) {\n\n\t\t\t\t\tconst value = materialDefaultAttributeValues[ name ];\n\n\t\t\t\t\tif ( value !== undefined ) {\n\n\t\t\t\t\t\tswitch ( value.length ) {\n\n\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\tgl.vertexAttrib2fv( programAttribute, value );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\tgl.vertexAttrib3fv( programAttribute, value );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\tgl.vertexAttrib4fv( programAttribute, value );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tgl.vertexAttrib1fv( programAttribute, value );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tdisableUnusedAttributes();\n\n\t}\n\n\tfunction dispose() {\n\n\t\treset();\n\n\t\tfor ( const geometryId in bindingStates ) {\n\n\t\t\tconst programMap = bindingStates[ geometryId ];\n\n\t\t\tfor ( const programId in programMap ) {\n\n\t\t\t\tconst stateMap = programMap[ programId ];\n\n\t\t\t\tfor ( const wireframe in stateMap ) {\n\n\t\t\t\t\tdeleteVertexArrayObject( stateMap[ wireframe ].object );\n\n\t\t\t\t\tdelete stateMap[ wireframe ];\n\n\t\t\t\t}\n\n\t\t\t\tdelete programMap[ programId ];\n\n\t\t\t}\n\n\t\t\tdelete bindingStates[ geometryId ];\n\n\t\t}\n\n\t}\n\n\tfunction releaseStatesOfGeometry( geometry ) {\n\n\t\tif ( bindingStates[ geometry.id ] === undefined ) return;\n\n\t\tconst programMap = bindingStates[ geometry.id ];\n\n\t\tfor ( const programId in programMap ) {\n\n\t\t\tconst stateMap = programMap[ programId ];\n\n\t\t\tfor ( const wireframe in stateMap ) {\n\n\t\t\t\tdeleteVertexArrayObject( stateMap[ wireframe ].object );\n\n\t\t\t\tdelete stateMap[ wireframe ];\n\n\t\t\t}\n\n\t\t\tdelete programMap[ programId ];\n\n\t\t}\n\n\t\tdelete bindingStates[ geometry.id ];\n\n\t}\n\n\tfunction releaseStatesOfProgram( program ) {\n\n\t\tfor ( const geometryId in bindingStates ) {\n\n\t\t\tconst programMap = bindingStates[ geometryId ];\n\n\t\t\tif ( programMap[ program.id ] === undefined ) continue;\n\n\t\t\tconst stateMap = programMap[ program.id ];\n\n\t\t\tfor ( const wireframe in stateMap ) {\n\n\t\t\t\tdeleteVertexArrayObject( stateMap[ wireframe ].object );\n\n\t\t\t\tdelete stateMap[ wireframe ];\n\n\t\t\t}\n\n\t\t\tdelete programMap[ program.id ];\n\n\t\t}\n\n\t}\n\n\tfunction reset() {\n\n\t\tresetDefaultState();\n\n\t\tif ( currentState === defaultState ) return;\n\n\t\tcurrentState = defaultState;\n\t\tbindVertexArrayObject( currentState.object );\n\n\t}\n\n\t// for backward-compatilibity\n\n\tfunction resetDefaultState() {\n\n\t\tdefaultState.geometry = null;\n\t\tdefaultState.program = null;\n\t\tdefaultState.wireframe = false;\n\n\t}\n\n\treturn {\n\n\t\tsetup: setup,\n\t\treset: reset,\n\t\tresetDefaultState: resetDefaultState,\n\t\tdispose: dispose,\n\t\treleaseStatesOfGeometry: releaseStatesOfGeometry,\n\t\treleaseStatesOfProgram: releaseStatesOfProgram,\n\n\t\tinitAttributes: initAttributes,\n\t\tenableAttribute: enableAttribute,\n\t\tdisableUnusedAttributes: disableUnusedAttributes\n\n\t};\n\n}\n\n\nexport { WebGLBindingStates };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLBufferRenderer( gl, extensions, info, capabilities ) {\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\n\tlet mode;\n\n\tfunction setMode( value ) {\n\n\t\tmode = value;\n\n\t}\n\n\tfunction render( start, count ) {\n\n\t\tgl.drawArrays( mode, start, count );\n\n\t\tinfo.update( count, mode );\n\n\t}\n\n\tfunction renderInstances( geometry, start, count, primcount ) {\n\n\t\tif ( primcount === 0 ) return;\n\n\t\tlet extension, methodName;\n\n\t\tif ( isWebGL2 ) {\n\n\t\t\textension = gl;\n\t\t\tmethodName = 'drawArraysInstanced';\n\n\t\t} else {\n\n\t\t\textension = extensions.get( 'ANGLE_instanced_arrays' );\n\t\t\tmethodName = 'drawArraysInstancedANGLE';\n\n\t\t\tif ( extension === null ) {\n\n\t\t\t\tconsole.error( 'THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t}\n\n\t\textension[ methodName ]( mode, start, count, primcount );\n\n\t\tinfo.update( count, mode, primcount );\n\n\t}\n\n\t//\n\n\tthis.setMode = setMode;\n\tthis.render = render;\n\tthis.renderInstances = renderInstances;\n\n}\n\n\nexport { WebGLBufferRenderer };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLCapabilities( gl, extensions, parameters ) {\n\n\tlet maxAnisotropy;\n\n\tfunction getMaxAnisotropy() {\n\n\t\tif ( maxAnisotropy !== undefined ) return maxAnisotropy;\n\n\t\tconst extension = extensions.get( 'EXT_texture_filter_anisotropic' );\n\n\t\tif ( extension !== null ) {\n\n\t\t\tmaxAnisotropy = gl.getParameter( extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT );\n\n\t\t} else {\n\n\t\t\tmaxAnisotropy = 0;\n\n\t\t}\n\n\t\treturn maxAnisotropy;\n\n\t}\n\n\tfunction getMaxPrecision( precision ) {\n\n\t\tif ( precision === 'highp' ) {\n\n\t\t\tif ( gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.HIGH_FLOAT ).precision > 0 &&\n\t\t\t\tgl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.HIGH_FLOAT ).precision > 0 ) {\n\n\t\t\t\treturn 'highp';\n\n\t\t\t}\n\n\t\t\tprecision = 'mediump';\n\n\t\t}\n\n\t\tif ( precision === 'mediump' ) {\n\n\t\t\tif ( gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.MEDIUM_FLOAT ).precision > 0 &&\n\t\t\t\tgl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT ).precision > 0 ) {\n\n\t\t\t\treturn 'mediump';\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn 'lowp';\n\n\t}\n\n\t/* eslint-disable no-undef */\n\tconst isWebGL2 = ( typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext ) ||\n\t\t( typeof WebGL2ComputeRenderingContext !== 'undefined' && gl instanceof WebGL2ComputeRenderingContext );\n\t/* eslint-enable no-undef */\n\n\tlet precision = parameters.precision !== undefined ? parameters.precision : 'highp';\n\tconst maxPrecision = getMaxPrecision( precision );\n\n\tif ( maxPrecision !== precision ) {\n\n\t\tconsole.warn( 'THREE.WebGLRenderer:', precision, 'not supported, using', maxPrecision, 'instead.' );\n\t\tprecision = maxPrecision;\n\n\t}\n\n\tconst logarithmicDepthBuffer = parameters.logarithmicDepthBuffer === true;\n\n\tconst maxTextures = gl.getParameter( gl.MAX_TEXTURE_IMAGE_UNITS );\n\tconst maxVertexTextures = gl.getParameter( gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS );\n\tconst maxTextureSize = gl.getParameter( gl.MAX_TEXTURE_SIZE );\n\tconst maxCubemapSize = gl.getParameter( gl.MAX_CUBE_MAP_TEXTURE_SIZE );\n\n\tconst maxAttributes = gl.getParameter( gl.MAX_VERTEX_ATTRIBS );\n\tconst maxVertexUniforms = gl.getParameter( gl.MAX_VERTEX_UNIFORM_VECTORS );\n\tconst maxVaryings = gl.getParameter( gl.MAX_VARYING_VECTORS );\n\tconst maxFragmentUniforms = gl.getParameter( gl.MAX_FRAGMENT_UNIFORM_VECTORS );\n\n\tconst vertexTextures = maxVertexTextures > 0;\n\tconst floatFragmentTextures = isWebGL2 || !! extensions.get( 'OES_texture_float' );\n\tconst floatVertexTextures = vertexTextures && floatFragmentTextures;\n\n\tconst maxSamples = isWebGL2 ? gl.getParameter( gl.MAX_SAMPLES ) : 0;\n\n\treturn {\n\n\t\tisWebGL2: isWebGL2,\n\n\t\tgetMaxAnisotropy: getMaxAnisotropy,\n\t\tgetMaxPrecision: getMaxPrecision,\n\n\t\tprecision: precision,\n\t\tlogarithmicDepthBuffer: logarithmicDepthBuffer,\n\n\t\tmaxTextures: maxTextures,\n\t\tmaxVertexTextures: maxVertexTextures,\n\t\tmaxTextureSize: maxTextureSize,\n\t\tmaxCubemapSize: maxCubemapSize,\n\n\t\tmaxAttributes: maxAttributes,\n\t\tmaxVertexUniforms: maxVertexUniforms,\n\t\tmaxVaryings: maxVaryings,\n\t\tmaxFragmentUniforms: maxFragmentUniforms,\n\n\t\tvertexTextures: vertexTextures,\n\t\tfloatFragmentTextures: floatFragmentTextures,\n\t\tfloatVertexTextures: floatVertexTextures,\n\n\t\tmaxSamples: maxSamples\n\n\t};\n\n}\n\n\nexport { WebGLCapabilities };\n","/**\n * @author tschw\n */\n\nimport { Matrix3 } from '../../math/Matrix3.js';\nimport { Plane } from '../../math/Plane.js';\n\nfunction WebGLClipping() {\n\n\tconst scope = this;\n\n\tlet globalState = null,\n\t\tnumGlobalPlanes = 0,\n\t\tlocalClippingEnabled = false,\n\t\trenderingShadows = false;\n\n\tconst plane = new Plane(),\n\t\tviewNormalMatrix = new Matrix3(),\n\n\t\tuniform = { value: null, needsUpdate: false };\n\n\tthis.uniform = uniform;\n\tthis.numPlanes = 0;\n\tthis.numIntersection = 0;\n\n\tthis.init = function ( planes, enableLocalClipping, camera ) {\n\n\t\tconst enabled =\n\t\t\tplanes.length !== 0 ||\n\t\t\tenableLocalClipping ||\n\t\t\t// enable state of previous frame - the clipping code has to\n\t\t\t// run another frame in order to reset the state:\n\t\t\tnumGlobalPlanes !== 0 ||\n\t\t\tlocalClippingEnabled;\n\n\t\tlocalClippingEnabled = enableLocalClipping;\n\n\t\tglobalState = projectPlanes( planes, camera, 0 );\n\t\tnumGlobalPlanes = planes.length;\n\n\t\treturn enabled;\n\n\t};\n\n\tthis.beginShadows = function () {\n\n\t\trenderingShadows = true;\n\t\tprojectPlanes( null );\n\n\t};\n\n\tthis.endShadows = function () {\n\n\t\trenderingShadows = false;\n\t\tresetGlobalState();\n\n\t};\n\n\tthis.setState = function ( planes, clipIntersection, clipShadows, camera, cache, fromCache ) {\n\n\t\tif ( ! localClippingEnabled || planes === null || planes.length === 0 || renderingShadows && ! clipShadows ) {\n\n\t\t\t// there's no local clipping\n\n\t\t\tif ( renderingShadows ) {\n\n\t\t\t\t// there's no global clipping\n\n\t\t\t\tprojectPlanes( null );\n\n\t\t\t} else {\n\n\t\t\t\tresetGlobalState();\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst nGlobal = renderingShadows ? 0 : numGlobalPlanes,\n\t\t\t\tlGlobal = nGlobal * 4;\n\n\t\t\tlet dstArray = cache.clippingState || null;\n\n\t\t\tuniform.value = dstArray; // ensure unique state\n\n\t\t\tdstArray = projectPlanes( planes, camera, lGlobal, fromCache );\n\n\t\t\tfor ( let i = 0; i !== lGlobal; ++ i ) {\n\n\t\t\t\tdstArray[ i ] = globalState[ i ];\n\n\t\t\t}\n\n\t\t\tcache.clippingState = dstArray;\n\t\t\tthis.numIntersection = clipIntersection ? this.numPlanes : 0;\n\t\t\tthis.numPlanes += nGlobal;\n\n\t\t}\n\n\n\t};\n\n\tfunction resetGlobalState() {\n\n\t\tif ( uniform.value !== globalState ) {\n\n\t\t\tuniform.value = globalState;\n\t\t\tuniform.needsUpdate = numGlobalPlanes > 0;\n\n\t\t}\n\n\t\tscope.numPlanes = numGlobalPlanes;\n\t\tscope.numIntersection = 0;\n\n\t}\n\n\tfunction projectPlanes( planes, camera, dstOffset, skipTransform ) {\n\n\t\tlet nPlanes = planes !== null ? planes.length : 0,\n\t\t\tdstArray = null;\n\n\t\tif ( nPlanes !== 0 ) {\n\n\t\t\tdstArray = uniform.value;\n\n\t\t\tif ( skipTransform !== true || dstArray === null ) {\n\n\t\t\t\tconst flatSize = dstOffset + nPlanes * 4,\n\t\t\t\t\tviewMatrix = camera.matrixWorldInverse;\n\n\t\t\t\tviewNormalMatrix.getNormalMatrix( viewMatrix );\n\n\t\t\t\tif ( dstArray === null || dstArray.length < flatSize ) {\n\n\t\t\t\t\tdstArray = new Float32Array( flatSize );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, i4 = dstOffset; i !== nPlanes; ++ i, i4 += 4 ) {\n\n\t\t\t\t\tplane.copy( planes[ i ] ).applyMatrix4( viewMatrix, viewNormalMatrix );\n\n\t\t\t\t\tplane.normal.toArray( dstArray, i4 );\n\t\t\t\t\tdstArray[ i4 + 3 ] = plane.constant;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tuniform.value = dstArray;\n\t\t\tuniform.needsUpdate = true;\n\n\t\t}\n\n\t\tscope.numPlanes = nPlanes;\n\t\tscope.numIntersection = 0;\n\n\t\treturn dstArray;\n\n\t}\n\n}\n\n\nexport { WebGLClipping };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLExtensions( gl ) {\n\n\tconst extensions = {};\n\n\treturn {\n\n\t\tget: function ( name ) {\n\n\t\t\tif ( extensions[ name ] !== undefined ) {\n\n\t\t\t\treturn extensions[ name ];\n\n\t\t\t}\n\n\t\t\tlet extension;\n\n\t\t\tswitch ( name ) {\n\n\t\t\t\tcase 'WEBGL_depth_texture':\n\t\t\t\t\textension = gl.getExtension( 'WEBGL_depth_texture' ) || gl.getExtension( 'MOZ_WEBGL_depth_texture' ) || gl.getExtension( 'WEBKIT_WEBGL_depth_texture' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'EXT_texture_filter_anisotropic':\n\t\t\t\t\textension = gl.getExtension( 'EXT_texture_filter_anisotropic' ) || gl.getExtension( 'MOZ_EXT_texture_filter_anisotropic' ) || gl.getExtension( 'WEBKIT_EXT_texture_filter_anisotropic' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'WEBGL_compressed_texture_s3tc':\n\t\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'MOZ_WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_s3tc' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'WEBGL_compressed_texture_pvrtc':\n\t\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_pvrtc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_pvrtc' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\textension = gl.getExtension( name );\n\n\t\t\t}\n\n\t\t\tif ( extension === null ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: ' + name + ' extension not supported.' );\n\n\t\t\t}\n\n\t\t\textensions[ name ] = extension;\n\n\t\t\treturn extension;\n\n\t\t}\n\n\t};\n\n}\n\n\nexport { WebGLExtensions };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { Uint16BufferAttribute, Uint32BufferAttribute } from '../../core/BufferAttribute.js';\nimport { BufferGeometry } from '../../core/BufferGeometry.js';\nimport { arrayMax } from '../../utils.js';\n\nfunction WebGLGeometries( gl, attributes, info, bindingStates ) {\n\n\tconst geometries = new WeakMap();\n\tconst wireframeAttributes = new WeakMap();\n\n\tfunction onGeometryDispose( event ) {\n\n\t\tconst geometry = event.target;\n\t\tconst buffergeometry = geometries.get( geometry );\n\n\t\tif ( buffergeometry.index !== null ) {\n\n\t\t\tattributes.remove( buffergeometry.index );\n\n\t\t}\n\n\t\tfor ( const name in buffergeometry.attributes ) {\n\n\t\t\tattributes.remove( buffergeometry.attributes[ name ] );\n\n\t\t}\n\n\t\tgeometry.removeEventListener( 'dispose', onGeometryDispose );\n\n\t\tgeometries.delete( geometry );\n\n\t\tconst attribute = wireframeAttributes.get( buffergeometry );\n\n\t\tif ( attribute ) {\n\n\t\t\tattributes.remove( attribute );\n\t\t\twireframeAttributes.delete( buffergeometry );\n\n\t\t}\n\n\t\tbindingStates.releaseStatesOfGeometry( geometry );\n\n\t\tif ( geometry.isInstancedBufferGeometry === true ) {\n\n\t\t\tdelete geometry._maxInstanceCount;\n\n\t\t}\n\n\t\t//\n\n\t\tinfo.memory.geometries --;\n\n\t}\n\n\tfunction get( object, geometry ) {\n\n\t\tlet buffergeometry = geometries.get( geometry );\n\n\t\tif ( buffergeometry ) return buffergeometry;\n\n\t\tgeometry.addEventListener( 'dispose', onGeometryDispose );\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tbuffergeometry = geometry;\n\n\t\t} else if ( geometry.isGeometry ) {\n\n\t\t\tif ( geometry._bufferGeometry === undefined ) {\n\n\t\t\t\tgeometry._bufferGeometry = new BufferGeometry().setFromObject( object );\n\n\t\t\t}\n\n\t\t\tbuffergeometry = geometry._bufferGeometry;\n\n\t\t}\n\n\t\tgeometries.set( geometry, buffergeometry );\n\n\t\tinfo.memory.geometries ++;\n\n\t\treturn buffergeometry;\n\n\t}\n\n\tfunction update( geometry ) {\n\n\t\tconst geometryAttributes = geometry.attributes;\n\n\t\t// Updating index buffer in VAO now. See WebGLBindingStates.\n\n\t\tfor ( const name in geometryAttributes ) {\n\n\t\t\tattributes.update( geometryAttributes[ name ], gl.ARRAY_BUFFER );\n\n\t\t}\n\n\t\t// morph targets\n\n\t\tconst morphAttributes = geometry.morphAttributes;\n\n\t\tfor ( const name in morphAttributes ) {\n\n\t\t\tconst array = morphAttributes[ name ];\n\n\t\t\tfor ( let i = 0, l = array.length; i < l; i ++ ) {\n\n\t\t\t\tattributes.update( array[ i ], gl.ARRAY_BUFFER );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction updateWireframeAttribute( geometry ) {\n\n\t\tconst indices = [];\n\n\t\tconst geometryIndex = geometry.index;\n\t\tconst geometryPosition = geometry.attributes.position;\n\t\tlet version = 0;\n\n\t\tif ( geometryIndex !== null ) {\n\n\t\t\tconst array = geometryIndex.array;\n\t\t\tversion = geometryIndex.version;\n\n\t\t\tfor ( let i = 0, l = array.length; i < l; i += 3 ) {\n\n\t\t\t\tconst a = array[ i + 0 ];\n\t\t\t\tconst b = array[ i + 1 ];\n\t\t\t\tconst c = array[ i + 2 ];\n\n\t\t\t\tindices.push( a, b, b, c, c, a );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst array = geometryPosition.array;\n\t\t\tversion = geometryPosition.version;\n\n\t\t\tfor ( let i = 0, l = ( array.length / 3 ) - 1; i < l; i += 3 ) {\n\n\t\t\t\tconst a = i + 0;\n\t\t\t\tconst b = i + 1;\n\t\t\t\tconst c = i + 2;\n\n\t\t\t\tindices.push( a, b, b, c, c, a );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst attribute = new ( arrayMax( indices ) > 65535 ? Uint32BufferAttribute : Uint16BufferAttribute )( indices, 1 );\n\t\tattribute.version = version;\n\n\t\t// Updating index buffer in VAO now. See WebGLBindingStates\n\n\t\t//\n\n\t\tconst previousAttribute = wireframeAttributes.get( geometry );\n\n\t\tif ( previousAttribute ) attributes.remove( previousAttribute );\n\n\t\t//\n\n\t\twireframeAttributes.set( geometry, attribute );\n\n\t}\n\n\tfunction getWireframeAttribute( geometry ) {\n\n\t\tconst currentAttribute = wireframeAttributes.get( geometry );\n\n\t\tif ( currentAttribute ) {\n\n\t\t\tconst geometryIndex = geometry.index;\n\n\t\t\tif ( geometryIndex !== null ) {\n\n\t\t\t\t// if the attribute is obsolete, create a new one\n\n\t\t\t\tif ( currentAttribute.version < geometryIndex.version ) {\n\n\t\t\t\t\tupdateWireframeAttribute( geometry );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tupdateWireframeAttribute( geometry );\n\n\t\t}\n\n\t\treturn wireframeAttributes.get( geometry );\n\n\t}\n\n\treturn {\n\n\t\tget: get,\n\t\tupdate: update,\n\n\t\tgetWireframeAttribute: getWireframeAttribute\n\n\t};\n\n}\n\n\nexport { WebGLGeometries };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLIndexedBufferRenderer( gl, extensions, info, capabilities ) {\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\n\tlet mode;\n\n\tfunction setMode( value ) {\n\n\t\tmode = value;\n\n\t}\n\n\tlet type, bytesPerElement;\n\n\tfunction setIndex( value ) {\n\n\t\ttype = value.type;\n\t\tbytesPerElement = value.bytesPerElement;\n\n\t}\n\n\tfunction render( start, count ) {\n\n\t\tgl.drawElements( mode, count, type, start * bytesPerElement );\n\n\t\tinfo.update( count, mode );\n\n\t}\n\n\tfunction renderInstances( geometry, start, count, primcount ) {\n\n\t\tif ( primcount === 0 ) return;\n\n\t\tlet extension, methodName;\n\n\t\tif ( isWebGL2 ) {\n\n\t\t\textension = gl;\n\t\t\tmethodName = 'drawElementsInstanced';\n\n\t\t} else {\n\n\t\t\textension = extensions.get( 'ANGLE_instanced_arrays' );\n\t\t\tmethodName = 'drawElementsInstancedANGLE';\n\n\t\t\tif ( extension === null ) {\n\n\t\t\t\tconsole.error( 'THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t}\n\n\t\textension[ methodName ]( mode, count, type, start * bytesPerElement, primcount );\n\n\t\tinfo.update( count, mode, primcount );\n\n\t}\n\n\t//\n\n\tthis.setMode = setMode;\n\tthis.setIndex = setIndex;\n\tthis.render = render;\n\tthis.renderInstances = renderInstances;\n\n}\n\n\nexport { WebGLIndexedBufferRenderer };\n","/**\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nfunction WebGLInfo( gl ) {\n\n\tconst memory = {\n\t\tgeometries: 0,\n\t\ttextures: 0\n\t};\n\n\tconst render = {\n\t\tframe: 0,\n\t\tcalls: 0,\n\t\ttriangles: 0,\n\t\tpoints: 0,\n\t\tlines: 0\n\t};\n\n\tfunction update( count, mode, instanceCount ) {\n\n\t\tinstanceCount = instanceCount || 1;\n\n\t\trender.calls ++;\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase gl.TRIANGLES:\n\t\t\t\trender.triangles += instanceCount * ( count / 3 );\n\t\t\t\tbreak;\n\n\t\t\tcase gl.LINES:\n\t\t\t\trender.lines += instanceCount * ( count / 2 );\n\t\t\t\tbreak;\n\n\t\t\tcase gl.LINE_STRIP:\n\t\t\t\trender.lines += instanceCount * ( count - 1 );\n\t\t\t\tbreak;\n\n\t\t\tcase gl.LINE_LOOP:\n\t\t\t\trender.lines += instanceCount * count;\n\t\t\t\tbreak;\n\n\t\t\tcase gl.POINTS:\n\t\t\t\trender.points += instanceCount * count;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'THREE.WebGLInfo: Unknown draw mode:', mode );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction reset() {\n\n\t\trender.frame ++;\n\t\trender.calls = 0;\n\t\trender.triangles = 0;\n\t\trender.points = 0;\n\t\trender.lines = 0;\n\n\t}\n\n\treturn {\n\t\tmemory: memory,\n\t\trender: render,\n\t\tprograms: null,\n\t\tautoReset: true,\n\t\treset: reset,\n\t\tupdate: update\n\t};\n\n}\n\n\nexport { WebGLInfo };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction numericalSort( a, b ) {\n\n\treturn a[ 0 ] - b[ 0 ];\n\n}\n\nfunction absNumericalSort( a, b ) {\n\n\treturn Math.abs( b[ 1 ] ) - Math.abs( a[ 1 ] );\n\n}\n\nfunction WebGLMorphtargets( gl ) {\n\n\tconst influencesList = {};\n\tconst morphInfluences = new Float32Array( 8 );\n\n\tconst workInfluences = [];\n\n\tfor ( let i = 0; i < 8; i ++ ) {\n\n\t\tworkInfluences[ i ] = [ i, 0 ];\n\n\t}\n\n\tfunction update( object, geometry, material, program ) {\n\n\t\tconst objectInfluences = object.morphTargetInfluences;\n\n\t\t// When object doesn't have morph target influences defined, we treat it as a 0-length array\n\t\t// This is important to make sure we set up morphTargetBaseInfluence / morphTargetInfluences\n\n\t\tconst length = objectInfluences === undefined ? 0 : objectInfluences.length;\n\n\t\tlet influences = influencesList[ geometry.id ];\n\n\t\tif ( influences === undefined ) {\n\n\t\t\t// initialise list\n\n\t\t\tinfluences = [];\n\n\t\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\t\tinfluences[ i ] = [ i, 0 ];\n\n\t\t\t}\n\n\t\t\tinfluencesList[ geometry.id ] = influences;\n\n\t\t}\n\n\t\t// Collect influences\n\n\t\tfor ( let i = 0; i < length; i ++ ) {\n\n\t\t\tconst influence = influences[ i ];\n\n\t\t\tinfluence[ 0 ] = i;\n\t\t\tinfluence[ 1 ] = objectInfluences[ i ];\n\n\t\t}\n\n\t\tinfluences.sort( absNumericalSort );\n\n\t\tfor ( let i = 0; i < 8; i ++ ) {\n\n\t\t\tif ( i < length && influences[ i ][ 1 ] ) {\n\n\t\t\t\tworkInfluences[ i ][ 0 ] = influences[ i ][ 0 ];\n\t\t\t\tworkInfluences[ i ][ 1 ] = influences[ i ][ 1 ];\n\n\t\t\t} else {\n\n\t\t\t\tworkInfluences[ i ][ 0 ] = Number.MAX_SAFE_INTEGER;\n\t\t\t\tworkInfluences[ i ][ 1 ] = 0;\n\n\t\t\t}\n\n\t\t}\n\n\t\tworkInfluences.sort( numericalSort );\n\n\t\tconst morphTargets = material.morphTargets && geometry.morphAttributes.position;\n\t\tconst morphNormals = material.morphNormals && geometry.morphAttributes.normal;\n\n\t\tlet morphInfluencesSum = 0;\n\n\t\tfor ( let i = 0; i < 8; i ++ ) {\n\n\t\t\tconst influence = workInfluences[ i ];\n\t\t\tconst index = influence[ 0 ];\n\t\t\tconst value = influence[ 1 ];\n\n\t\t\tif ( index !== Number.MAX_SAFE_INTEGER && value ) {\n\n\t\t\t\tif ( morphTargets && geometry.getAttribute( 'morphTarget' + i ) !== morphTargets[ index ] ) {\n\n\t\t\t\t\tgeometry.setAttribute( 'morphTarget' + i, morphTargets[ index ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( morphNormals && geometry.getAttribute( 'morphNormal' + i ) !== morphNormals[ index ] ) {\n\n\t\t\t\t\tgeometry.setAttribute( 'morphNormal' + i, morphNormals[ index ] );\n\n\t\t\t\t}\n\n\t\t\t\tmorphInfluences[ i ] = value;\n\t\t\t\tmorphInfluencesSum += value;\n\n\t\t\t} else {\n\n\t\t\t\tif ( morphTargets && geometry.getAttribute( 'morphTarget' + i ) !== undefined ) {\n\n\t\t\t\t\tgeometry.deleteAttribute( 'morphTarget' + i );\n\n\t\t\t\t}\n\n\t\t\t\tif ( morphNormals && geometry.getAttribute( 'morphNormal' + i ) !== undefined ) {\n\n\t\t\t\t\tgeometry.deleteAttribute( 'morphNormal' + i );\n\n\t\t\t\t}\n\n\t\t\t\tmorphInfluences[ i ] = 0;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// GLSL shader uses formula baseinfluence * base + sum(target * influence)\n\t\t// This allows us to switch between absolute morphs and relative morphs without changing shader code\n\t\t// When baseinfluence = 1 - sum(influence), the above is equivalent to sum((target - base) * influence)\n\t\tconst morphBaseInfluence = geometry.morphTargetsRelative ? 1 : 1 - morphInfluencesSum;\n\n\t\tprogram.getUniforms().setValue( gl, 'morphTargetBaseInfluence', morphBaseInfluence );\n\t\tprogram.getUniforms().setValue( gl, 'morphTargetInfluences', morphInfluences );\n\n\t}\n\n\treturn {\n\n\t\tupdate: update\n\n\t};\n\n}\n\n\nexport { WebGLMorphtargets };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLObjects( gl, geometries, attributes, info ) {\n\n\tlet updateMap = new WeakMap();\n\n\tfunction update( object ) {\n\n\t\tconst frame = info.render.frame;\n\n\t\tconst geometry = object.geometry;\n\t\tconst buffergeometry = geometries.get( object, geometry );\n\n\t\t// Update once per frame\n\n\t\tif ( updateMap.get( buffergeometry ) !== frame ) {\n\n\t\t\tif ( geometry.isGeometry ) {\n\n\t\t\t\tbuffergeometry.updateFromObject( object );\n\n\t\t\t}\n\n\t\t\tgeometries.update( buffergeometry );\n\n\t\t\tupdateMap.set( buffergeometry, frame );\n\n\t\t}\n\n\t\tif ( object.isInstancedMesh ) {\n\n\t\t\tattributes.update( object.instanceMatrix, gl.ARRAY_BUFFER );\n\n\t\t}\n\n\t\treturn buffergeometry;\n\n\t}\n\n\tfunction dispose() {\n\n\t\tupdateMap = new WeakMap();\n\n\t}\n\n\treturn {\n\n\t\tupdate: update,\n\t\tdispose: dispose\n\n\t};\n\n}\n\n\nexport { WebGLObjects };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { Texture } from './Texture.js';\nimport { CubeReflectionMapping, RGBFormat } from '../constants.js';\n\nfunction CubeTexture( images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding ) {\n\n\timages = images !== undefined ? images : [];\n\tmapping = mapping !== undefined ? mapping : CubeReflectionMapping;\n\tformat = format !== undefined ? format : RGBFormat;\n\n\tTexture.call( this, images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding );\n\n\tthis.flipY = false;\n\n}\n\nCubeTexture.prototype = Object.create( Texture.prototype );\nCubeTexture.prototype.constructor = CubeTexture;\n\nCubeTexture.prototype.isCubeTexture = true;\n\nObject.defineProperty( CubeTexture.prototype, 'images', {\n\n\tget: function () {\n\n\t\treturn this.image;\n\n\t},\n\n\tset: function ( value ) {\n\n\t\tthis.image = value;\n\n\t}\n\n} );\n\n\nexport { CubeTexture };\n","/**\n * @author Takahiro https://github.com/takahirox\n */\n\nimport { Texture } from './Texture.js';\nimport { ClampToEdgeWrapping, NearestFilter } from '../constants.js';\n\nfunction DataTexture2DArray( data, width, height, depth ) {\n\n\tTexture.call( this, null );\n\n\tthis.image = { data: data || null, width: width || 1, height: height || 1, depth: depth || 1 };\n\n\tthis.magFilter = NearestFilter;\n\tthis.minFilter = NearestFilter;\n\n\tthis.wrapR = ClampToEdgeWrapping;\n\n\tthis.generateMipmaps = false;\n\tthis.flipY = false;\n\n\tthis.needsUpdate = true;\n\n}\n\nDataTexture2DArray.prototype = Object.create( Texture.prototype );\nDataTexture2DArray.prototype.constructor = DataTexture2DArray;\nDataTexture2DArray.prototype.isDataTexture2DArray = true;\n\nexport { DataTexture2DArray };\n","/**\n * @author Artur Trzesiok\n */\n\nimport { Texture } from './Texture.js';\nimport { ClampToEdgeWrapping, NearestFilter } from '../constants.js';\n\nfunction DataTexture3D( data, width, height, depth ) {\n\n\t// We're going to add .setXXX() methods for setting properties later.\n\t// Users can still set in DataTexture3D directly.\n\t//\n\t//\tconst texture = new THREE.DataTexture3D( data, width, height, depth );\n\t// \ttexture.anisotropy = 16;\n\t//\n\t// See #14839\n\n\tTexture.call( this, null );\n\n\tthis.image = { data: data || null, width: width || 1, height: height || 1, depth: depth || 1 };\n\n\tthis.magFilter = NearestFilter;\n\tthis.minFilter = NearestFilter;\n\n\tthis.wrapR = ClampToEdgeWrapping;\n\n\tthis.generateMipmaps = false;\n\tthis.flipY = false;\n\n\tthis.needsUpdate = true;\n\n\n}\n\nDataTexture3D.prototype = Object.create( Texture.prototype );\nDataTexture3D.prototype.constructor = DataTexture3D;\nDataTexture3D.prototype.isDataTexture3D = true;\n\nexport { DataTexture3D };\n","import { ShaderChunk } from './ShaderChunk.js';\nimport { mergeUniforms } from './UniformsUtils.js';\nimport { Vector2 } from '../../math/Vector2.js';\nimport { Vector3 } from '../../math/Vector3.js';\nimport { UniformsLib } from './UniformsLib.js';\nimport { Color } from '../../math/Color.js';\nimport { Matrix3 } from '../../math/Matrix3.js';\n\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n * @author mikael emtinger / http://gomo.se/\n */\n\nconst ShaderLib = {\n\n\tbasic: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.specularmap,\n\t\t\tUniformsLib.envmap,\n\t\t\tUniformsLib.aomap,\n\t\t\tUniformsLib.lightmap,\n\t\t\tUniformsLib.fog\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.meshbasic_vert,\n\t\tfragmentShader: ShaderChunk.meshbasic_frag\n\n\t},\n\n\tlambert: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.specularmap,\n\t\t\tUniformsLib.envmap,\n\t\t\tUniformsLib.aomap,\n\t\t\tUniformsLib.lightmap,\n\t\t\tUniformsLib.emissivemap,\n\t\t\tUniformsLib.fog,\n\t\t\tUniformsLib.lights,\n\t\t\t{\n\t\t\t\temissive: { value: new Color( 0x000000 ) }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.meshlambert_vert,\n\t\tfragmentShader: ShaderChunk.meshlambert_frag\n\n\t},\n\n\tphong: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.specularmap,\n\t\t\tUniformsLib.envmap,\n\t\t\tUniformsLib.aomap,\n\t\t\tUniformsLib.lightmap,\n\t\t\tUniformsLib.emissivemap,\n\t\t\tUniformsLib.bumpmap,\n\t\t\tUniformsLib.normalmap,\n\t\t\tUniformsLib.displacementmap,\n\t\t\tUniformsLib.fog,\n\t\t\tUniformsLib.lights,\n\t\t\t{\n\t\t\t\temissive: { value: new Color( 0x000000 ) },\n\t\t\t\tspecular: { value: new Color( 0x111111 ) },\n\t\t\t\tshininess: { value: 30 }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.meshphong_vert,\n\t\tfragmentShader: ShaderChunk.meshphong_frag\n\n\t},\n\n\tstandard: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.envmap,\n\t\t\tUniformsLib.aomap,\n\t\t\tUniformsLib.lightmap,\n\t\t\tUniformsLib.emissivemap,\n\t\t\tUniformsLib.bumpmap,\n\t\t\tUniformsLib.normalmap,\n\t\t\tUniformsLib.displacementmap,\n\t\t\tUniformsLib.roughnessmap,\n\t\t\tUniformsLib.metalnessmap,\n\t\t\tUniformsLib.fog,\n\t\t\tUniformsLib.lights,\n\t\t\t{\n\t\t\t\temissive: { value: new Color( 0x000000 ) },\n\t\t\t\troughness: { value: 1.0 },\n\t\t\t\tmetalness: { value: 0.0 },\n\t\t\t\tenvMapIntensity: { value: 1 } // temporary\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.meshphysical_vert,\n\t\tfragmentShader: ShaderChunk.meshphysical_frag\n\n\t},\n\n\ttoon: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.aomap,\n\t\t\tUniformsLib.lightmap,\n\t\t\tUniformsLib.emissivemap,\n\t\t\tUniformsLib.bumpmap,\n\t\t\tUniformsLib.normalmap,\n\t\t\tUniformsLib.displacementmap,\n\t\t\tUniformsLib.gradientmap,\n\t\t\tUniformsLib.fog,\n\t\t\tUniformsLib.lights,\n\t\t\t{\n\t\t\t\temissive: { value: new Color( 0x000000 ) }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.meshtoon_vert,\n\t\tfragmentShader: ShaderChunk.meshtoon_frag\n\n\t},\n\n\tmatcap: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.bumpmap,\n\t\t\tUniformsLib.normalmap,\n\t\t\tUniformsLib.displacementmap,\n\t\t\tUniformsLib.fog,\n\t\t\t{\n\t\t\t\tmatcap: { value: null }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.meshmatcap_vert,\n\t\tfragmentShader: ShaderChunk.meshmatcap_frag\n\n\t},\n\n\tpoints: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.points,\n\t\t\tUniformsLib.fog\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.points_vert,\n\t\tfragmentShader: ShaderChunk.points_frag\n\n\t},\n\n\tdashed: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.fog,\n\t\t\t{\n\t\t\t\tscale: { value: 1 },\n\t\t\t\tdashSize: { value: 1 },\n\t\t\t\ttotalSize: { value: 2 }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.linedashed_vert,\n\t\tfragmentShader: ShaderChunk.linedashed_frag\n\n\t},\n\n\tdepth: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.displacementmap\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.depth_vert,\n\t\tfragmentShader: ShaderChunk.depth_frag\n\n\t},\n\n\tnormal: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.bumpmap,\n\t\t\tUniformsLib.normalmap,\n\t\t\tUniformsLib.displacementmap,\n\t\t\t{\n\t\t\t\topacity: { value: 1.0 }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.normal_vert,\n\t\tfragmentShader: ShaderChunk.normal_frag\n\n\t},\n\n\tsprite: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.sprite,\n\t\t\tUniformsLib.fog\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.sprite_vert,\n\t\tfragmentShader: ShaderChunk.sprite_frag\n\n\t},\n\n\tbackground: {\n\n\t\tuniforms: {\n\t\t\tuvTransform: { value: new Matrix3() },\n\t\t\tt2D: { value: null },\n\t\t},\n\n\t\tvertexShader: ShaderChunk.background_vert,\n\t\tfragmentShader: ShaderChunk.background_frag\n\n\t},\n\t/* -------------------------------------------------------------------------\n\t//\tCube map shader\n\t ------------------------------------------------------------------------- */\n\n\tcube: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.envmap,\n\t\t\t{\n\t\t\t\topacity: { value: 1.0 }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.cube_vert,\n\t\tfragmentShader: ShaderChunk.cube_frag\n\n\t},\n\n\tequirect: {\n\n\t\tuniforms: {\n\t\t\ttEquirect: { value: null },\n\t\t},\n\n\t\tvertexShader: ShaderChunk.equirect_vert,\n\t\tfragmentShader: ShaderChunk.equirect_frag\n\n\t},\n\n\tdistanceRGBA: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.common,\n\t\t\tUniformsLib.displacementmap,\n\t\t\t{\n\t\t\t\treferencePosition: { value: new Vector3() },\n\t\t\t\tnearDistance: { value: 1 },\n\t\t\t\tfarDistance: { value: 1000 }\n\t\t\t}\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.distanceRGBA_vert,\n\t\tfragmentShader: ShaderChunk.distanceRGBA_frag\n\n\t},\n\n\tshadow: {\n\n\t\tuniforms: mergeUniforms( [\n\t\t\tUniformsLib.lights,\n\t\t\tUniformsLib.fog,\n\t\t\t{\n\t\t\t\tcolor: { value: new Color( 0x00000 ) },\n\t\t\t\topacity: { value: 1.0 }\n\t\t\t},\n\t\t] ),\n\n\t\tvertexShader: ShaderChunk.shadow_vert,\n\t\tfragmentShader: ShaderChunk.shadow_frag\n\n\t}\n\n};\n\nShaderLib.physical = {\n\n\tuniforms: mergeUniforms( [\n\t\tShaderLib.standard.uniforms,\n\t\t{\n\t\t\tclearcoat: { value: 0 },\n\t\t\tclearcoatMap: { value: null },\n\t\t\tclearcoatRoughness: { value: 0 },\n\t\t\tclearcoatRoughnessMap: { value: null },\n\t\t\tclearcoatNormalScale: { value: new Vector2( 1, 1 ) },\n\t\t\tclearcoatNormalMap: { value: null },\n\t\t\tsheen: { value: new Color( 0x000000 ) },\n\t\t\ttransparency: { value: 0 },\n\t\t}\n\t] ),\n\n\tvertexShader: ShaderChunk.meshphysical_vert,\n\tfragmentShader: ShaderChunk.meshphysical_frag\n\n};\n\n\nexport { ShaderLib };\n","/**\n * @author tschw\n * @author Mugen87 / https://github.com/Mugen87\n * @author mrdoob / http://mrdoob.com/\n *\n * Uniforms of a program.\n * Those form a tree structure with a special top-level container for the root,\n * which you get by calling 'new WebGLUniforms( gl, program )'.\n *\n *\n * Properties of inner nodes including the top-level container:\n *\n * .seq - array of nested uniforms\n * .map - nested uniforms by name\n *\n *\n * Methods of all nodes except the top-level container:\n *\n * .setValue( gl, value, [textures] )\n *\n * \t\tuploads a uniform value(s)\n *  \tthe 'textures' parameter is needed for sampler uniforms\n *\n *\n * Static methods of the top-level container (textures factorizations):\n *\n * .upload( gl, seq, values, textures )\n *\n * \t\tsets uniforms in 'seq' to 'values[id].value'\n *\n * .seqWithValue( seq, values ) : filteredSeq\n *\n * \t\tfilters 'seq' entries with corresponding entry in values\n *\n *\n * Methods of the top-level container (textures factorizations):\n *\n * .setValue( gl, name, value, textures )\n *\n * \t\tsets uniform with  name 'name' to 'value'\n *\n * .setOptional( gl, obj, prop )\n *\n * \t\tlike .set for an optional property of the object\n *\n */\n\nimport { CubeTexture } from '../../textures/CubeTexture.js';\nimport { Texture } from '../../textures/Texture.js';\nimport { DataTexture2DArray } from '../../textures/DataTexture2DArray.js';\nimport { DataTexture3D } from '../../textures/DataTexture3D.js';\n\nconst emptyTexture = new Texture();\nconst emptyTexture2dArray = new DataTexture2DArray();\nconst emptyTexture3d = new DataTexture3D();\nconst emptyCubeTexture = new CubeTexture();\n\n// --- Utilities ---\n\n// Array Caches (provide typed arrays for temporary by size)\n\nconst arrayCacheF32 = [];\nconst arrayCacheI32 = [];\n\n// Float32Array caches used for uploading Matrix uniforms\n\nconst mat4array = new Float32Array( 16 );\nconst mat3array = new Float32Array( 9 );\nconst mat2array = new Float32Array( 4 );\n\n// Flattening for arrays of vectors and matrices\n\nfunction flatten( array, nBlocks, blockSize ) {\n\n\tconst firstElem = array[ 0 ];\n\n\tif ( firstElem <= 0 || firstElem > 0 ) return array;\n\t// unoptimized: ! isNaN( firstElem )\n\t// see http://jacksondunstan.com/articles/983\n\n\tlet n = nBlocks * blockSize,\n\t\tr = arrayCacheF32[ n ];\n\n\tif ( r === undefined ) {\n\n\t\tr = new Float32Array( n );\n\t\tarrayCacheF32[ n ] = r;\n\n\t}\n\n\tif ( nBlocks !== 0 ) {\n\n\t\tfirstElem.toArray( r, 0 );\n\n\t\tfor ( let i = 1, offset = 0; i !== nBlocks; ++ i ) {\n\n\t\t\toffset += blockSize;\n\t\t\tarray[ i ].toArray( r, offset );\n\n\t\t}\n\n\t}\n\n\treturn r;\n\n}\n\nfunction arraysEqual( a, b ) {\n\n\tif ( a.length !== b.length ) return false;\n\n\tfor ( let i = 0, l = a.length; i < l; i ++ ) {\n\n\t\tif ( a[ i ] !== b[ i ] ) return false;\n\n\t}\n\n\treturn true;\n\n}\n\nfunction copyArray( a, b ) {\n\n\tfor ( let i = 0, l = b.length; i < l; i ++ ) {\n\n\t\ta[ i ] = b[ i ];\n\n\t}\n\n}\n\n// Texture unit allocation\n\nfunction allocTexUnits( textures, n ) {\n\n\tlet r = arrayCacheI32[ n ];\n\n\tif ( r === undefined ) {\n\n\t\tr = new Int32Array( n );\n\t\tarrayCacheI32[ n ] = r;\n\n\t}\n\n\tfor ( let i = 0; i !== n; ++ i ) {\n\n\t\tr[ i ] = textures.allocateTextureUnit();\n\n\t}\n\n\treturn r;\n\n}\n\n// --- Setters ---\n\n// Note: Defining these methods externally, because they come in a bunch\n// and this way their names minify.\n\n// Single scalar\n\nfunction setValueV1f( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( cache[ 0 ] === v ) return;\n\n\tgl.uniform1f( this.addr, v );\n\n\tcache[ 0 ] = v;\n\n}\n\n// Single float vector (from flat array or THREE.VectorN)\n\nfunction setValueV2f( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( v.x !== undefined ) {\n\n\t\tif ( cache[ 0 ] !== v.x || cache[ 1 ] !== v.y ) {\n\n\t\t\tgl.uniform2f( this.addr, v.x, v.y );\n\n\t\t\tcache[ 0 ] = v.x;\n\t\t\tcache[ 1 ] = v.y;\n\n\t\t}\n\n\t} else {\n\n\t\tif ( arraysEqual( cache, v ) ) return;\n\n\t\tgl.uniform2fv( this.addr, v );\n\n\t\tcopyArray( cache, v );\n\n\t}\n\n}\n\nfunction setValueV3f( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( v.x !== undefined ) {\n\n\t\tif ( cache[ 0 ] !== v.x || cache[ 1 ] !== v.y || cache[ 2 ] !== v.z ) {\n\n\t\t\tgl.uniform3f( this.addr, v.x, v.y, v.z );\n\n\t\t\tcache[ 0 ] = v.x;\n\t\t\tcache[ 1 ] = v.y;\n\t\t\tcache[ 2 ] = v.z;\n\n\t\t}\n\n\t} else if ( v.r !== undefined ) {\n\n\t\tif ( cache[ 0 ] !== v.r || cache[ 1 ] !== v.g || cache[ 2 ] !== v.b ) {\n\n\t\t\tgl.uniform3f( this.addr, v.r, v.g, v.b );\n\n\t\t\tcache[ 0 ] = v.r;\n\t\t\tcache[ 1 ] = v.g;\n\t\t\tcache[ 2 ] = v.b;\n\n\t\t}\n\n\t} else {\n\n\t\tif ( arraysEqual( cache, v ) ) return;\n\n\t\tgl.uniform3fv( this.addr, v );\n\n\t\tcopyArray( cache, v );\n\n\t}\n\n}\n\nfunction setValueV4f( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( v.x !== undefined ) {\n\n\t\tif ( cache[ 0 ] !== v.x || cache[ 1 ] !== v.y || cache[ 2 ] !== v.z || cache[ 3 ] !== v.w ) {\n\n\t\t\tgl.uniform4f( this.addr, v.x, v.y, v.z, v.w );\n\n\t\t\tcache[ 0 ] = v.x;\n\t\t\tcache[ 1 ] = v.y;\n\t\t\tcache[ 2 ] = v.z;\n\t\t\tcache[ 3 ] = v.w;\n\n\t\t}\n\n\t} else {\n\n\t\tif ( arraysEqual( cache, v ) ) return;\n\n\t\tgl.uniform4fv( this.addr, v );\n\n\t\tcopyArray( cache, v );\n\n\t}\n\n}\n\n// Single matrix (from flat array or MatrixN)\n\nfunction setValueM2( gl, v ) {\n\n\tconst cache = this.cache;\n\tconst elements = v.elements;\n\n\tif ( elements === undefined ) {\n\n\t\tif ( arraysEqual( cache, v ) ) return;\n\n\t\tgl.uniformMatrix2fv( this.addr, false, v );\n\n\t\tcopyArray( cache, v );\n\n\t} else {\n\n\t\tif ( arraysEqual( cache, elements ) ) return;\n\n\t\tmat2array.set( elements );\n\n\t\tgl.uniformMatrix2fv( this.addr, false, mat2array );\n\n\t\tcopyArray( cache, elements );\n\n\t}\n\n}\n\nfunction setValueM3( gl, v ) {\n\n\tconst cache = this.cache;\n\tconst elements = v.elements;\n\n\tif ( elements === undefined ) {\n\n\t\tif ( arraysEqual( cache, v ) ) return;\n\n\t\tgl.uniformMatrix3fv( this.addr, false, v );\n\n\t\tcopyArray( cache, v );\n\n\t} else {\n\n\t\tif ( arraysEqual( cache, elements ) ) return;\n\n\t\tmat3array.set( elements );\n\n\t\tgl.uniformMatrix3fv( this.addr, false, mat3array );\n\n\t\tcopyArray( cache, elements );\n\n\t}\n\n}\n\nfunction setValueM4( gl, v ) {\n\n\tconst cache = this.cache;\n\tconst elements = v.elements;\n\n\tif ( elements === undefined ) {\n\n\t\tif ( arraysEqual( cache, v ) ) return;\n\n\t\tgl.uniformMatrix4fv( this.addr, false, v );\n\n\t\tcopyArray( cache, v );\n\n\t} else {\n\n\t\tif ( arraysEqual( cache, elements ) ) return;\n\n\t\tmat4array.set( elements );\n\n\t\tgl.uniformMatrix4fv( this.addr, false, mat4array );\n\n\t\tcopyArray( cache, elements );\n\n\t}\n\n}\n\n// Single texture (2D / Cube)\n\nfunction setValueT1( gl, v, textures ) {\n\n\tconst cache = this.cache;\n\tconst unit = textures.allocateTextureUnit();\n\n\tif ( cache[ 0 ] !== unit ) {\n\n\t\tgl.uniform1i( this.addr, unit );\n\t\tcache[ 0 ] = unit;\n\n\t}\n\n\ttextures.safeSetTexture2D( v || emptyTexture, unit );\n\n}\n\nfunction setValueT2DArray1( gl, v, textures ) {\n\n\tconst cache = this.cache;\n\tconst unit = textures.allocateTextureUnit();\n\n\tif ( cache[ 0 ] !== unit ) {\n\n\t\tgl.uniform1i( this.addr, unit );\n\t\tcache[ 0 ] = unit;\n\n\t}\n\n\ttextures.setTexture2DArray( v || emptyTexture2dArray, unit );\n\n}\n\nfunction setValueT3D1( gl, v, textures ) {\n\n\tconst cache = this.cache;\n\tconst unit = textures.allocateTextureUnit();\n\n\tif ( cache[ 0 ] !== unit ) {\n\n\t\tgl.uniform1i( this.addr, unit );\n\t\tcache[ 0 ] = unit;\n\n\t}\n\n\ttextures.setTexture3D( v || emptyTexture3d, unit );\n\n}\n\nfunction setValueT6( gl, v, textures ) {\n\n\tconst cache = this.cache;\n\tconst unit = textures.allocateTextureUnit();\n\n\tif ( cache[ 0 ] !== unit ) {\n\n\t\tgl.uniform1i( this.addr, unit );\n\t\tcache[ 0 ] = unit;\n\n\t}\n\n\ttextures.safeSetTextureCube( v || emptyCubeTexture, unit );\n\n}\n\n// Integer / Boolean vectors or arrays thereof (always flat arrays)\n\nfunction setValueV1i( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( cache[ 0 ] === v ) return;\n\n\tgl.uniform1i( this.addr, v );\n\n\tcache[ 0 ] = v;\n\n}\n\nfunction setValueV2i( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( arraysEqual( cache, v ) ) return;\n\n\tgl.uniform2iv( this.addr, v );\n\n\tcopyArray( cache, v );\n\n}\n\nfunction setValueV3i( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( arraysEqual( cache, v ) ) return;\n\n\tgl.uniform3iv( this.addr, v );\n\n\tcopyArray( cache, v );\n\n}\n\nfunction setValueV4i( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( arraysEqual( cache, v ) ) return;\n\n\tgl.uniform4iv( this.addr, v );\n\n\tcopyArray( cache, v );\n\n}\n\n// uint\n\nfunction setValueV1ui( gl, v ) {\n\n\tconst cache = this.cache;\n\n\tif ( cache[ 0 ] === v ) return;\n\n\tgl.uniform1ui( this.addr, v );\n\n\tcache[ 0 ] = v;\n\n}\n\n// Helper to pick the right setter for the singular case\n\nfunction getSingularSetter( type ) {\n\n\tswitch ( type ) {\n\n\t\tcase 0x1406: return setValueV1f; // FLOAT\n\t\tcase 0x8b50: return setValueV2f; // _VEC2\n\t\tcase 0x8b51: return setValueV3f; // _VEC3\n\t\tcase 0x8b52: return setValueV4f; // _VEC4\n\n\t\tcase 0x8b5a: return setValueM2; // _MAT2\n\t\tcase 0x8b5b: return setValueM3; // _MAT3\n\t\tcase 0x8b5c: return setValueM4; // _MAT4\n\n\t\tcase 0x1404: case 0x8b56: return setValueV1i; // INT, BOOL\n\t\tcase 0x8b53: case 0x8b57: return setValueV2i; // _VEC2\n\t\tcase 0x8b54: case 0x8b58: return setValueV3i; // _VEC3\n\t\tcase 0x8b55: case 0x8b59: return setValueV4i; // _VEC4\n\n\t\tcase 0x1405: return setValueV1ui; // UINT\n\n\t\tcase 0x8b5e: // SAMPLER_2D\n\t\tcase 0x8d66: // SAMPLER_EXTERNAL_OES\n\t\tcase 0x8dca: // INT_SAMPLER_2D\n\t\tcase 0x8dd2: // UNSIGNED_INT_SAMPLER_2D\n\t\tcase 0x8b62: // SAMPLER_2D_SHADOW\n\t\t\treturn setValueT1;\n\n\t\tcase 0x8b5f: // SAMPLER_3D\n\t\tcase 0x8dcb: // INT_SAMPLER_3D\n\t\tcase 0x8dd3: // UNSIGNED_INT_SAMPLER_3D\n\t\t\treturn setValueT3D1;\n\n\t\tcase 0x8b60: // SAMPLER_CUBE\n\t\tcase 0x8dcc: // INT_SAMPLER_CUBE\n\t\tcase 0x8dd4: // UNSIGNED_INT_SAMPLER_CUBE\n\t\tcase 0x8dc5: // SAMPLER_CUBE_SHADOW\n\t\t\treturn setValueT6;\n\n\t\tcase 0x8dc1: // SAMPLER_2D_ARRAY\n\t\tcase 0x8dcf: // INT_SAMPLER_2D_ARRAY\n\t\tcase 0x8dd7: // UNSIGNED_INT_SAMPLER_2D_ARRAY\n\t\tcase 0x8dc4: // SAMPLER_2D_ARRAY_SHADOW\n\t\t\treturn setValueT2DArray1;\n\n\t}\n\n}\n\n// Array of scalars\nfunction setValueV1fArray( gl, v ) {\n\n\tgl.uniform1fv( this.addr, v );\n\n}\n\n// Integer / Boolean vectors or arrays thereof (always flat arrays)\nfunction setValueV1iArray( gl, v ) {\n\n\tgl.uniform1iv( this.addr, v );\n\n}\n\nfunction setValueV2iArray( gl, v ) {\n\n\tgl.uniform2iv( this.addr, v );\n\n}\n\nfunction setValueV3iArray( gl, v ) {\n\n\tgl.uniform3iv( this.addr, v );\n\n}\n\nfunction setValueV4iArray( gl, v ) {\n\n\tgl.uniform4iv( this.addr, v );\n\n}\n\n\n// Array of vectors (flat or from THREE classes)\n\nfunction setValueV2fArray( gl, v ) {\n\n\tconst data = flatten( v, this.size, 2 );\n\n\tgl.uniform2fv( this.addr, data );\n\n}\n\nfunction setValueV3fArray( gl, v ) {\n\n\tconst data = flatten( v, this.size, 3 );\n\n\tgl.uniform3fv( this.addr, data );\n\n}\n\nfunction setValueV4fArray( gl, v ) {\n\n\tconst data = flatten( v, this.size, 4 );\n\n\tgl.uniform4fv( this.addr, data );\n\n}\n\n// Array of matrices (flat or from THREE clases)\n\nfunction setValueM2Array( gl, v ) {\n\n\tconst data = flatten( v, this.size, 4 );\n\n\tgl.uniformMatrix2fv( this.addr, false, data );\n\n}\n\nfunction setValueM3Array( gl, v ) {\n\n\tconst data = flatten( v, this.size, 9 );\n\n\tgl.uniformMatrix3fv( this.addr, false, data );\n\n}\n\nfunction setValueM4Array( gl, v ) {\n\n\tconst data = flatten( v, this.size, 16 );\n\n\tgl.uniformMatrix4fv( this.addr, false, data );\n\n}\n\n// Array of textures (2D / Cube)\n\nfunction setValueT1Array( gl, v, textures ) {\n\n\tconst n = v.length;\n\n\tconst units = allocTexUnits( textures, n );\n\n\tgl.uniform1iv( this.addr, units );\n\n\tfor ( let i = 0; i !== n; ++ i ) {\n\n\t\ttextures.safeSetTexture2D( v[ i ] || emptyTexture, units[ i ] );\n\n\t}\n\n}\n\nfunction setValueT6Array( gl, v, textures ) {\n\n\tconst n = v.length;\n\n\tconst units = allocTexUnits( textures, n );\n\n\tgl.uniform1iv( this.addr, units );\n\n\tfor ( let i = 0; i !== n; ++ i ) {\n\n\t\ttextures.safeSetTextureCube( v[ i ] || emptyCubeTexture, units[ i ] );\n\n\t}\n\n}\n\n// Helper to pick the right setter for a pure (bottom-level) array\n\nfunction getPureArraySetter( type ) {\n\n\tswitch ( type ) {\n\n\t\tcase 0x1406: return setValueV1fArray; // FLOAT\n\t\tcase 0x8b50: return setValueV2fArray; // _VEC2\n\t\tcase 0x8b51: return setValueV3fArray; // _VEC3\n\t\tcase 0x8b52: return setValueV4fArray; // _VEC4\n\n\t\tcase 0x8b5a: return setValueM2Array; // _MAT2\n\t\tcase 0x8b5b: return setValueM3Array; // _MAT3\n\t\tcase 0x8b5c: return setValueM4Array; // _MAT4\n\n\t\tcase 0x1404: case 0x8b56: return setValueV1iArray; // INT, BOOL\n\t\tcase 0x8b53: case 0x8b57: return setValueV2iArray; // _VEC2\n\t\tcase 0x8b54: case 0x8b58: return setValueV3iArray; // _VEC3\n\t\tcase 0x8b55: case 0x8b59: return setValueV4iArray; // _VEC4\n\n\t\tcase 0x8b5e: // SAMPLER_2D\n\t\tcase 0x8d66: // SAMPLER_EXTERNAL_OES\n\t\tcase 0x8dca: // INT_SAMPLER_2D\n\t\tcase 0x8dd2: // UNSIGNED_INT_SAMPLER_2D\n\t\tcase 0x8b62: // SAMPLER_2D_SHADOW\n\t\t\treturn setValueT1Array;\n\n\t\tcase 0x8b60: // SAMPLER_CUBE\n\t\tcase 0x8dcc: // INT_SAMPLER_CUBE\n\t\tcase 0x8dd4: // UNSIGNED_INT_SAMPLER_CUBE\n\t\tcase 0x8dc5: // SAMPLER_CUBE_SHADOW\n\t\t\treturn setValueT6Array;\n\n\t}\n\n}\n\n// --- Uniform Classes ---\n\nfunction SingleUniform( id, activeInfo, addr ) {\n\n\tthis.id = id;\n\tthis.addr = addr;\n\tthis.cache = [];\n\tthis.setValue = getSingularSetter( activeInfo.type );\n\n\t// this.path = activeInfo.name; // DEBUG\n\n}\n\nfunction PureArrayUniform( id, activeInfo, addr ) {\n\n\tthis.id = id;\n\tthis.addr = addr;\n\tthis.cache = [];\n\tthis.size = activeInfo.size;\n\tthis.setValue = getPureArraySetter( activeInfo.type );\n\n\t// this.path = activeInfo.name; // DEBUG\n\n}\n\nPureArrayUniform.prototype.updateCache = function ( data ) {\n\n\tlet cache = this.cache;\n\n\tif ( data instanceof Float32Array && cache.length !== data.length ) {\n\n\t\tthis.cache = new Float32Array( data.length );\n\n\t}\n\n\tcopyArray( cache, data );\n\n};\n\nfunction StructuredUniform( id ) {\n\n\tthis.id = id;\n\n\tthis.seq = [];\n\tthis.map = {};\n\n}\n\nStructuredUniform.prototype.setValue = function ( gl, value, textures ) {\n\n\tconst seq = this.seq;\n\n\tfor ( let i = 0, n = seq.length; i !== n; ++ i ) {\n\n\t\tconst u = seq[ i ];\n\t\tu.setValue( gl, value[ u.id ], textures );\n\n\t}\n\n};\n\n// --- Top-level ---\n\n// Parser - builds up the property tree from the path strings\n\nconst RePathPart = /([\\w\\d_]+)(\\])?(\\[|\\.)?/g;\n\n// extracts\n// \t- the identifier (member name or array index)\n//  - followed by an optional right bracket (found when array index)\n//  - followed by an optional left bracket or dot (type of subscript)\n//\n// Note: These portions can be read in a non-overlapping fashion and\n// allow straightforward parsing of the hierarchy that WebGL encodes\n// in the uniform names.\n\nfunction addUniform( container, uniformObject ) {\n\n\tcontainer.seq.push( uniformObject );\n\tcontainer.map[ uniformObject.id ] = uniformObject;\n\n}\n\nfunction parseUniform( activeInfo, addr, container ) {\n\n\tconst path = activeInfo.name,\n\t\tpathLength = path.length;\n\n\t// reset RegExp object, because of the early exit of a previous run\n\tRePathPart.lastIndex = 0;\n\n\twhile ( true ) {\n\n\t\tconst match = RePathPart.exec( path ),\n\t\t\tmatchEnd = RePathPart.lastIndex;\n\n\t\tlet id = match[ 1 ],\n\t\t\tidIsIndex = match[ 2 ] === ']',\n\t\t\tsubscript = match[ 3 ];\n\n\t\tif ( idIsIndex ) id = id | 0; // convert to integer\n\n\t\tif ( subscript === undefined || subscript === '[' && matchEnd + 2 === pathLength ) {\n\n\t\t\t// bare name or \"pure\" bottom-level array \"[0]\" suffix\n\n\t\t\taddUniform( container, subscript === undefined ?\n\t\t\t\tnew SingleUniform( id, activeInfo, addr ) :\n\t\t\t\tnew PureArrayUniform( id, activeInfo, addr ) );\n\n\t\t\tbreak;\n\n\t\t} else {\n\n\t\t\t// step into inner node / create it in case it doesn't exist\n\n\t\t\tconst map = container.map;\n\t\t\tlet next = map[ id ];\n\n\t\t\tif ( next === undefined ) {\n\n\t\t\t\tnext = new StructuredUniform( id );\n\t\t\t\taddUniform( container, next );\n\n\t\t\t}\n\n\t\t\tcontainer = next;\n\n\t\t}\n\n\t}\n\n}\n\n// Root Container\n\nfunction WebGLUniforms( gl, program ) {\n\n\tthis.seq = [];\n\tthis.map = {};\n\n\tconst n = gl.getProgramParameter( program, gl.ACTIVE_UNIFORMS );\n\n\tfor ( let i = 0; i < n; ++ i ) {\n\n\t\tconst info = gl.getActiveUniform( program, i ),\n\t\t\taddr = gl.getUniformLocation( program, info.name );\n\n\t\tparseUniform( info, addr, this );\n\n\t}\n\n}\n\nWebGLUniforms.prototype.setValue = function ( gl, name, value, textures ) {\n\n\tconst u = this.map[ name ];\n\n\tif ( u !== undefined ) u.setValue( gl, value, textures );\n\n};\n\nWebGLUniforms.prototype.setOptional = function ( gl, object, name ) {\n\n\tconst v = object[ name ];\n\n\tif ( v !== undefined ) this.setValue( gl, name, v );\n\n};\n\n\n// Static interface\n\nWebGLUniforms.upload = function ( gl, seq, values, textures ) {\n\n\tfor ( let i = 0, n = seq.length; i !== n; ++ i ) {\n\n\t\tconst u = seq[ i ],\n\t\t\tv = values[ u.id ];\n\n\t\tif ( v.needsUpdate !== false ) {\n\n\t\t\t// note: always updating when .needsUpdate is undefined\n\t\t\tu.setValue( gl, v.value, textures );\n\n\t\t}\n\n\t}\n\n};\n\nWebGLUniforms.seqWithValue = function ( seq, values ) {\n\n\tconst r = [];\n\n\tfor ( let i = 0, n = seq.length; i !== n; ++ i ) {\n\n\t\tconst u = seq[ i ];\n\t\tif ( u.id in values ) r.push( u );\n\n\t}\n\n\treturn r;\n\n};\n\nexport { WebGLUniforms };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction WebGLShader( gl, type, string ) {\n\n\tconst shader = gl.createShader( type );\n\n\tgl.shaderSource( shader, string );\n\tgl.compileShader( shader );\n\n\treturn shader;\n\n}\n\nexport { WebGLShader };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { WebGLUniforms } from './WebGLUniforms.js';\nimport { WebGLShader } from './WebGLShader.js';\nimport { ShaderChunk } from '../shaders/ShaderChunk.js';\nimport { NoToneMapping, AddOperation, MixOperation, MultiplyOperation, EquirectangularRefractionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, CubeUVRefractionMapping, CubeUVReflectionMapping, CubeReflectionMapping, PCFSoftShadowMap, PCFShadowMap, VSMShadowMap, ACESFilmicToneMapping, CineonToneMapping, CustomToneMapping, ReinhardToneMapping, LinearToneMapping, GammaEncoding, RGBDEncoding, RGBM16Encoding, RGBM7Encoding, RGBEEncoding, sRGBEncoding, LinearEncoding, LogLuvEncoding } from '../../constants.js';\n\nlet programIdCount = 0;\n\nfunction addLineNumbers( string ) {\n\n\tconst lines = string.split( '\\n' );\n\n\tfor ( let i = 0; i < lines.length; i ++ ) {\n\n\t\tlines[ i ] = ( i + 1 ) + ': ' + lines[ i ];\n\n\t}\n\n\treturn lines.join( '\\n' );\n\n}\n\nfunction getEncodingComponents( encoding ) {\n\n\tswitch ( encoding ) {\n\n\t\tcase LinearEncoding:\n\t\t\treturn [ 'Linear', '( value )' ];\n\t\tcase sRGBEncoding:\n\t\t\treturn [ 'sRGB', '( value )' ];\n\t\tcase RGBEEncoding:\n\t\t\treturn [ 'RGBE', '( value )' ];\n\t\tcase RGBM7Encoding:\n\t\t\treturn [ 'RGBM', '( value, 7.0 )' ];\n\t\tcase RGBM16Encoding:\n\t\t\treturn [ 'RGBM', '( value, 16.0 )' ];\n\t\tcase RGBDEncoding:\n\t\t\treturn [ 'RGBD', '( value, 256.0 )' ];\n\t\tcase GammaEncoding:\n\t\t\treturn [ 'Gamma', '( value, float( GAMMA_FACTOR ) )' ];\n\t\tcase LogLuvEncoding:\n\t\t\treturn [ 'LogLuv', '( value )' ];\n\t\tdefault:\n\t\t\tconsole.warn( 'THREE.WebGLProgram: Unsupported encoding:', encoding );\n\t\t\treturn [ 'Linear', '( value )' ];\n\n\t}\n\n}\n\nfunction getShaderErrors( gl, shader, type ) {\n\n\tconst status = gl.getShaderParameter( shader, gl.COMPILE_STATUS );\n\tconst log = gl.getShaderInfoLog( shader ).trim();\n\n\tif ( status && log === '' ) return '';\n\n\t// --enable-privileged-webgl-extension\n\t// console.log( '**' + type + '**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\n\n\tconst source = gl.getShaderSource( shader );\n\n\treturn 'THREE.WebGLShader: gl.getShaderInfoLog() ' + type + '\\n' + log + addLineNumbers( source );\n\n}\n\nfunction getTexelDecodingFunction( functionName, encoding ) {\n\n\tconst components = getEncodingComponents( encoding );\n\treturn 'vec4 ' + functionName + '( vec4 value ) { return ' + components[ 0 ] + 'ToLinear' + components[ 1 ] + '; }';\n\n}\n\nfunction getTexelEncodingFunction( functionName, encoding ) {\n\n\tconst components = getEncodingComponents( encoding );\n\treturn 'vec4 ' + functionName + '( vec4 value ) { return LinearTo' + components[ 0 ] + components[ 1 ] + '; }';\n\n}\n\nfunction getToneMappingFunction( functionName, toneMapping ) {\n\n\tlet toneMappingName;\n\n\tswitch ( toneMapping ) {\n\n\t\tcase LinearToneMapping:\n\t\t\ttoneMappingName = 'Linear';\n\t\t\tbreak;\n\n\t\tcase ReinhardToneMapping:\n\t\t\ttoneMappingName = 'Reinhard';\n\t\t\tbreak;\n\n\t\tcase CineonToneMapping:\n\t\t\ttoneMappingName = 'OptimizedCineon';\n\t\t\tbreak;\n\n\t\tcase ACESFilmicToneMapping:\n\t\t\ttoneMappingName = 'ACESFilmic';\n\t\t\tbreak;\n\n\t\tcase CustomToneMapping:\n\t\t\ttoneMappingName = 'Custom';\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tconsole.warn( 'THREE.WebGLProgram: Unsupported toneMapping:', toneMapping );\n\t\t\ttoneMappingName = 'Linear';\n\n\t}\n\n\treturn 'vec3 ' + functionName + '( vec3 color ) { return ' + toneMappingName + 'ToneMapping( color ); }';\n\n}\n\nfunction generateExtensions( parameters ) {\n\n\tconst chunks = [\n\t\t( parameters.extensionDerivatives || parameters.envMapCubeUV || parameters.bumpMap || parameters.tangentSpaceNormalMap || parameters.clearcoatNormalMap || parameters.flatShading || parameters.shaderID === 'physical' ) ? '#extension GL_OES_standard_derivatives : enable' : '',\n\t\t( parameters.extensionFragDepth || parameters.logarithmicDepthBuffer ) && parameters.rendererExtensionFragDepth ? '#extension GL_EXT_frag_depth : enable' : '',\n\t\t( parameters.extensionDrawBuffers && parameters.rendererExtensionDrawBuffers ) ? '#extension GL_EXT_draw_buffers : require' : '',\n\t\t( parameters.extensionShaderTextureLOD || parameters.envMap ) && parameters.rendererExtensionShaderTextureLod ? '#extension GL_EXT_shader_texture_lod : enable' : ''\n\t];\n\n\treturn chunks.filter( filterEmptyLine ).join( '\\n' );\n\n}\n\nfunction generateDefines( defines ) {\n\n\tconst chunks = [];\n\n\tfor ( const name in defines ) {\n\n\t\tconst value = defines[ name ];\n\n\t\tif ( value === false ) continue;\n\n\t\tchunks.push( '#define ' + name + ' ' + value );\n\n\t}\n\n\treturn chunks.join( '\\n' );\n\n}\n\nfunction fetchAttributeLocations( gl, program ) {\n\n\tconst attributes = {};\n\n\tconst n = gl.getProgramParameter( program, gl.ACTIVE_ATTRIBUTES );\n\n\tfor ( let i = 0; i < n; i ++ ) {\n\n\t\tconst info = gl.getActiveAttrib( program, i );\n\t\tconst name = info.name;\n\n\t\t// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );\n\n\t\tattributes[ name ] = gl.getAttribLocation( program, name );\n\n\t}\n\n\treturn attributes;\n\n}\n\nfunction filterEmptyLine( string ) {\n\n\treturn string !== '';\n\n}\n\nfunction replaceLightNums( string, parameters ) {\n\n\treturn string\n\t\t.replace( /NUM_DIR_LIGHTS/g, parameters.numDirLights )\n\t\t.replace( /NUM_SPOT_LIGHTS/g, parameters.numSpotLights )\n\t\t.replace( /NUM_RECT_AREA_LIGHTS/g, parameters.numRectAreaLights )\n\t\t.replace( /NUM_POINT_LIGHTS/g, parameters.numPointLights )\n\t\t.replace( /NUM_HEMI_LIGHTS/g, parameters.numHemiLights )\n\t\t.replace( /NUM_DIR_LIGHT_SHADOWS/g, parameters.numDirLightShadows )\n\t\t.replace( /NUM_SPOT_LIGHT_SHADOWS/g, parameters.numSpotLightShadows )\n\t\t.replace( /NUM_POINT_LIGHT_SHADOWS/g, parameters.numPointLightShadows );\n\n}\n\nfunction replaceClippingPlaneNums( string, parameters ) {\n\n\treturn string\n\t\t.replace( /NUM_CLIPPING_PLANES/g, parameters.numClippingPlanes )\n\t\t.replace( /UNION_CLIPPING_PLANES/g, ( parameters.numClippingPlanes - parameters.numClipIntersection ) );\n\n}\n\n// Resolve Includes\n\nconst includePattern = /^[ \\t]*#include +<([\\w\\d./]+)>/gm;\n\nfunction resolveIncludes( string ) {\n\n\treturn string.replace( includePattern, includeReplacer );\n\n}\n\nfunction includeReplacer( match, include ) {\n\n\tconst string = ShaderChunk[ include ];\n\n\tif ( string === undefined ) {\n\n\t\tthrow new Error( 'Can not resolve #include <' + include + '>' );\n\n\t}\n\n\treturn resolveIncludes( string );\n\n}\n\n// Unroll Loops\n\nconst deprecatedUnrollLoopPattern = /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g;\nconst unrollLoopPattern = /#pragma unroll_loop_start[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}[\\s]+?#pragma unroll_loop_end/g;\n\nfunction unrollLoops( string ) {\n\n\treturn string\n\t\t.replace( unrollLoopPattern, loopReplacer )\n\t\t.replace( deprecatedUnrollLoopPattern, deprecatedLoopReplacer );\n\n}\n\nfunction deprecatedLoopReplacer( match, start, end, snippet ) {\n\n\tconsole.warn( 'WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.' );\n\treturn loopReplacer( match, start, end, snippet );\n\n}\n\nfunction loopReplacer( match, start, end, snippet ) {\n\n\tlet string = '';\n\n\tfor ( let i = parseInt( start ); i < parseInt( end ); i ++ ) {\n\n\t\tstring += snippet\n\t\t\t.replace( /\\[ i \\]/g, '[ ' + i + ' ]' )\n\t\t\t.replace( /UNROLLED_LOOP_INDEX/g, i );\n\n\t}\n\n\treturn string;\n\n}\n\n//\n\nfunction generatePrecision( parameters ) {\n\n\tlet precisionstring = \"precision \" + parameters.precision + \" float;\\nprecision \" + parameters.precision + \" int;\";\n\n\tif ( parameters.precision === \"highp\" ) {\n\n\t\tprecisionstring += \"\\n#define HIGH_PRECISION\";\n\n\t} else if ( parameters.precision === \"mediump\" ) {\n\n\t\tprecisionstring += \"\\n#define MEDIUM_PRECISION\";\n\n\t} else if ( parameters.precision === \"lowp\" ) {\n\n\t\tprecisionstring += \"\\n#define LOW_PRECISION\";\n\n\t}\n\n\treturn precisionstring;\n\n}\n\nfunction generateShadowMapTypeDefine( parameters ) {\n\n\tlet shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\n\n\tif ( parameters.shadowMapType === PCFShadowMap ) {\n\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\n\n\t} else if ( parameters.shadowMapType === PCFSoftShadowMap ) {\n\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\n\n\t} else if ( parameters.shadowMapType === VSMShadowMap ) {\n\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_VSM';\n\n\t}\n\n\treturn shadowMapTypeDefine;\n\n}\n\nfunction generateEnvMapTypeDefine( parameters ) {\n\n\tlet envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n\n\tif ( parameters.envMap ) {\n\n\t\tswitch ( parameters.envMapMode ) {\n\n\t\t\tcase CubeReflectionMapping:\n\t\t\tcase CubeRefractionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE';\n\t\t\t\tbreak;\n\n\t\t\tcase CubeUVReflectionMapping:\n\t\t\tcase CubeUVRefractionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE_UV';\n\t\t\t\tbreak;\n\n\t\t\tcase EquirectangularReflectionMapping:\n\t\t\tcase EquirectangularRefractionMapping:\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_EQUIREC';\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\treturn envMapTypeDefine;\n\n}\n\nfunction generateEnvMapModeDefine( parameters ) {\n\n\tlet envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\n\n\tif ( parameters.envMap ) {\n\n\t\tswitch ( parameters.envMapMode ) {\n\n\t\t\tcase CubeRefractionMapping:\n\t\t\tcase EquirectangularRefractionMapping:\n\t\t\t\tenvMapModeDefine = 'ENVMAP_MODE_REFRACTION';\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\treturn envMapModeDefine;\n\n}\n\nfunction generateEnvMapBlendingDefine( parameters ) {\n\n\tlet envMapBlendingDefine = 'ENVMAP_BLENDING_NONE';\n\n\tif ( parameters.envMap ) {\n\n\t\tswitch ( parameters.combine ) {\n\n\t\t\tcase MultiplyOperation:\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\n\t\t\t\tbreak;\n\n\t\t\tcase MixOperation:\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\n\t\t\t\tbreak;\n\n\t\t\tcase AddOperation:\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\treturn envMapBlendingDefine;\n\n}\n\nfunction WebGLProgram( renderer, cacheKey, parameters, bindingStates ) {\n\n\tconst gl = renderer.getContext();\n\n\tconst defines = parameters.defines;\n\n\tlet vertexShader = parameters.vertexShader;\n\tlet fragmentShader = parameters.fragmentShader;\n\n\tconst shadowMapTypeDefine = generateShadowMapTypeDefine( parameters );\n\tconst envMapTypeDefine = generateEnvMapTypeDefine( parameters );\n\tconst envMapModeDefine = generateEnvMapModeDefine( parameters );\n\tconst envMapBlendingDefine = generateEnvMapBlendingDefine( parameters );\n\n\n\tconst gammaFactorDefine = ( renderer.gammaFactor > 0 ) ? renderer.gammaFactor : 1.0;\n\n\tconst customExtensions = parameters.isWebGL2 ? '' : generateExtensions( parameters );\n\n\tconst customDefines = generateDefines( defines );\n\n\tconst program = gl.createProgram();\n\n\tlet prefixVertex, prefixFragment;\n\n\tif ( parameters.isRawShaderMaterial ) {\n\n\t\tprefixVertex = [\n\n\t\t\tcustomDefines\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t\tif ( prefixVertex.length > 0 ) {\n\n\t\t\tprefixVertex += '\\n';\n\n\t\t}\n\n\t\tprefixFragment = [\n\n\t\t\tcustomExtensions,\n\t\t\tcustomDefines\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t\tif ( prefixFragment.length > 0 ) {\n\n\t\t\tprefixFragment += '\\n';\n\n\t\t}\n\n\t} else {\n\n\t\tprefixVertex = [\n\n\t\t\tgeneratePrecision( parameters ),\n\n\t\t\t'#define SHADER_NAME ' + parameters.shaderName,\n\n\t\t\tcustomDefines,\n\n\t\t\tparameters.instancing ? '#define USE_INSTANCING' : '',\n\t\t\tparameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\n\n\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\n\n\t\t\t'#define MAX_BONES ' + parameters.maxBones,\n\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\n\t\t\t( parameters.useFog && parameters.fogExp2 ) ? '#define FOG_EXP2' : '',\n\n\t\t\tparameters.map ? '#define USE_MAP' : '',\n\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\n\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\n\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\n\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\n\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\n\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\n\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.objectSpaceNormalMap ) ? '#define OBJECTSPACE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.tangentSpaceNormalMap ) ? '#define TANGENTSPACE_NORMALMAP' : '',\n\n\t\t\tparameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '',\n\t\t\tparameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '',\n\t\t\tparameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '',\n\t\t\tparameters.displacementMap && parameters.supportsVertexTextures ? '#define USE_DISPLACEMENTMAP' : '',\n\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\n\t\t\tparameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '',\n\t\t\tparameters.metalnessMap ? '#define USE_METALNESSMAP' : '',\n\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\n\n\t\t\tparameters.vertexTangents ? '#define USE_TANGENT' : '',\n\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\n\t\t\tparameters.vertexUvs ? '#define USE_UV' : '',\n\t\t\tparameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '',\n\n\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\n\n\t\t\tparameters.skinning ? '#define USE_SKINNING' : '',\n\t\t\tparameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\n\n\t\t\tparameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\n\t\t\tparameters.morphNormals && parameters.flatShading === false ? '#define USE_MORPHNORMALS' : '',\n\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\n\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\n\n\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\n\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\n\n\t\t\tparameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\n\n\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\n\t\t\t( parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\n\n\t\t\t'uniform mat4 modelMatrix;',\n\t\t\t'uniform mat4 modelViewMatrix;',\n\t\t\t'uniform mat4 projectionMatrix;',\n\t\t\t'uniform mat4 viewMatrix;',\n\t\t\t'uniform mat3 normalMatrix;',\n\t\t\t'uniform vec3 cameraPosition;',\n\t\t\t'uniform bool isOrthographic;',\n\n\t\t\t'#ifdef USE_INSTANCING',\n\n\t\t\t' attribute mat4 instanceMatrix;',\n\n\t\t\t'#endif',\n\n\t\t\t'attribute vec3 position;',\n\t\t\t'attribute vec3 normal;',\n\t\t\t'attribute vec2 uv;',\n\n\t\t\t'#ifdef USE_TANGENT',\n\n\t\t\t'\tattribute vec4 tangent;',\n\n\t\t\t'#endif',\n\n\t\t\t'#ifdef USE_COLOR',\n\n\t\t\t'\tattribute vec3 color;',\n\n\t\t\t'#endif',\n\n\t\t\t'#ifdef USE_MORPHTARGETS',\n\n\t\t\t'\tattribute vec3 morphTarget0;',\n\t\t\t'\tattribute vec3 morphTarget1;',\n\t\t\t'\tattribute vec3 morphTarget2;',\n\t\t\t'\tattribute vec3 morphTarget3;',\n\n\t\t\t'\t#ifdef USE_MORPHNORMALS',\n\n\t\t\t'\t\tattribute vec3 morphNormal0;',\n\t\t\t'\t\tattribute vec3 morphNormal1;',\n\t\t\t'\t\tattribute vec3 morphNormal2;',\n\t\t\t'\t\tattribute vec3 morphNormal3;',\n\n\t\t\t'\t#else',\n\n\t\t\t'\t\tattribute vec3 morphTarget4;',\n\t\t\t'\t\tattribute vec3 morphTarget5;',\n\t\t\t'\t\tattribute vec3 morphTarget6;',\n\t\t\t'\t\tattribute vec3 morphTarget7;',\n\n\t\t\t'\t#endif',\n\n\t\t\t'#endif',\n\n\t\t\t'#ifdef USE_SKINNING',\n\n\t\t\t'\tattribute vec4 skinIndex;',\n\t\t\t'\tattribute vec4 skinWeight;',\n\n\t\t\t'#endif',\n\n\t\t\t'\\n'\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t\tprefixFragment = [\n\n\t\t\tcustomExtensions,\n\n\t\t\tgeneratePrecision( parameters ),\n\n\t\t\t'#define SHADER_NAME ' + parameters.shaderName,\n\n\t\t\tcustomDefines,\n\n\t\t\tparameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest + ( parameters.alphaTest % 1 ? '' : '.0' ) : '', // add '.0' if integer\n\n\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\n\n\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\n\t\t\t( parameters.useFog && parameters.fogExp2 ) ? '#define FOG_EXP2' : '',\n\n\t\t\tparameters.map ? '#define USE_MAP' : '',\n\t\t\tparameters.matcap ? '#define USE_MATCAP' : '',\n\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\n\t\t\tparameters.envMap ? '#define ' + envMapTypeDefine : '',\n\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\n\t\t\tparameters.envMap ? '#define ' + envMapBlendingDefine : '',\n\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\n\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\n\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\n\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\n\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.objectSpaceNormalMap ) ? '#define OBJECTSPACE_NORMALMAP' : '',\n\t\t\t( parameters.normalMap && parameters.tangentSpaceNormalMap ) ? '#define TANGENTSPACE_NORMALMAP' : '',\n\t\t\tparameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '',\n\t\t\tparameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '',\n\t\t\tparameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '',\n\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\n\t\t\tparameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '',\n\t\t\tparameters.metalnessMap ? '#define USE_METALNESSMAP' : '',\n\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\n\n\t\t\tparameters.sheen ? '#define USE_SHEEN' : '',\n\n\t\t\tparameters.vertexTangents ? '#define USE_TANGENT' : '',\n\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\n\t\t\tparameters.vertexUvs ? '#define USE_UV' : '',\n\t\t\tparameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '',\n\n\t\t\tparameters.gradientMap ? '#define USE_GRADIENTMAP' : '',\n\n\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\n\n\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\n\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\n\n\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\n\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\n\n\t\t\tparameters.premultipliedAlpha ? '#define PREMULTIPLIED_ALPHA' : '',\n\n\t\t\tparameters.physicallyCorrectLights ? '#define PHYSICALLY_CORRECT_LIGHTS' : '',\n\n\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\n\t\t\t( parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\n\n\t\t\t( ( parameters.extensionShaderTextureLOD || parameters.envMap ) && parameters.rendererExtensionShaderTextureLod ) ? '#define TEXTURE_LOD_EXT' : '',\n\n\t\t\t'uniform mat4 viewMatrix;',\n\t\t\t'uniform vec3 cameraPosition;',\n\t\t\t'uniform bool isOrthographic;',\n\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? '#define TONE_MAPPING' : '',\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? ShaderChunk[ 'tonemapping_pars_fragment' ] : '', // this code is required here because it is used by the toneMapping() function defined below\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? getToneMappingFunction( 'toneMapping', parameters.toneMapping ) : '',\n\n\t\t\tparameters.dithering ? '#define DITHERING' : '',\n\n\t\t\tShaderChunk[ 'encodings_pars_fragment' ], // this code is required here because it is used by the various encoding/decoding function defined below\n\t\t\tparameters.map ? getTexelDecodingFunction( 'mapTexelToLinear', parameters.mapEncoding ) : '',\n\t\t\tparameters.matcap ? getTexelDecodingFunction( 'matcapTexelToLinear', parameters.matcapEncoding ) : '',\n\t\t\tparameters.envMap ? getTexelDecodingFunction( 'envMapTexelToLinear', parameters.envMapEncoding ) : '',\n\t\t\tparameters.emissiveMap ? getTexelDecodingFunction( 'emissiveMapTexelToLinear', parameters.emissiveMapEncoding ) : '',\n\t\t\tparameters.lightMap ? getTexelDecodingFunction( 'lightMapTexelToLinear', parameters.lightMapEncoding ) : '',\n\t\t\tgetTexelEncodingFunction( 'linearToOutputTexel', parameters.outputEncoding ),\n\n\t\t\tparameters.depthPacking ? '#define DEPTH_PACKING ' + parameters.depthPacking : '',\n\n\t\t\t'\\n'\n\n\t\t].filter( filterEmptyLine ).join( '\\n' );\n\n\t}\n\n\tvertexShader = resolveIncludes( vertexShader );\n\tvertexShader = replaceLightNums( vertexShader, parameters );\n\tvertexShader = replaceClippingPlaneNums( vertexShader, parameters );\n\n\tfragmentShader = resolveIncludes( fragmentShader );\n\tfragmentShader = replaceLightNums( fragmentShader, parameters );\n\tfragmentShader = replaceClippingPlaneNums( fragmentShader, parameters );\n\n\tvertexShader = unrollLoops( vertexShader );\n\tfragmentShader = unrollLoops( fragmentShader );\n\n\tif ( parameters.isWebGL2 && ! parameters.isRawShaderMaterial ) {\n\n\t\tlet isGLSL3ShaderMaterial = false;\n\n\t\tconst versionRegex = /^\\s*#version\\s+300\\s+es\\s*\\n/;\n\n\t\tif ( parameters.isShaderMaterial &&\n\t\t\tvertexShader.match( versionRegex ) !== null &&\n\t\t\tfragmentShader.match( versionRegex ) !== null ) {\n\n\t\t\tisGLSL3ShaderMaterial = true;\n\n\t\t\tvertexShader = vertexShader.replace( versionRegex, '' );\n\t\t\tfragmentShader = fragmentShader.replace( versionRegex, '' );\n\n\t\t}\n\n\t\t// GLSL 3.0 conversion\n\n\t\tprefixVertex = [\n\t\t\t'#version 300 es\\n',\n\t\t\t'#define attribute in',\n\t\t\t'#define varying out',\n\t\t\t'#define texture2D texture'\n\t\t].join( '\\n' ) + '\\n' + prefixVertex;\n\n\t\tprefixFragment = [\n\t\t\t'#version 300 es\\n',\n\t\t\t'#define varying in',\n\t\t\tisGLSL3ShaderMaterial ? '' : 'out highp vec4 pc_fragColor;',\n\t\t\tisGLSL3ShaderMaterial ? '' : '#define gl_FragColor pc_fragColor',\n\t\t\t'#define gl_FragDepthEXT gl_FragDepth',\n\t\t\t'#define texture2D texture',\n\t\t\t'#define textureCube texture',\n\t\t\t'#define texture2DProj textureProj',\n\t\t\t'#define texture2DLodEXT textureLod',\n\t\t\t'#define texture2DProjLodEXT textureProjLod',\n\t\t\t'#define textureCubeLodEXT textureLod',\n\t\t\t'#define texture2DGradEXT textureGrad',\n\t\t\t'#define texture2DProjGradEXT textureProjGrad',\n\t\t\t'#define textureCubeGradEXT textureGrad'\n\t\t].join( '\\n' ) + '\\n' + prefixFragment;\n\n\t}\n\n\tconst vertexGlsl = prefixVertex + vertexShader;\n\tconst fragmentGlsl = prefixFragment + fragmentShader;\n\n\t// console.log( '*VERTEX*', vertexGlsl );\n\t// console.log( '*FRAGMENT*', fragmentGlsl );\n\n\tconst glVertexShader = WebGLShader( gl, gl.VERTEX_SHADER, vertexGlsl );\n\tconst glFragmentShader = WebGLShader( gl, gl.FRAGMENT_SHADER, fragmentGlsl );\n\n\tgl.attachShader( program, glVertexShader );\n\tgl.attachShader( program, glFragmentShader );\n\n\t// Force a particular attribute to index 0.\n\n\tif ( parameters.index0AttributeName !== undefined ) {\n\n\t\tgl.bindAttribLocation( program, 0, parameters.index0AttributeName );\n\n\t} else if ( parameters.morphTargets === true ) {\n\n\t\t// programs with morphTargets displace position out of attribute 0\n\t\tgl.bindAttribLocation( program, 0, 'position' );\n\n\t}\n\n\tgl.linkProgram( program );\n\n\t// check for link errors\n\tif ( renderer.debug.checkShaderErrors ) {\n\n\t\tconst programLog = gl.getProgramInfoLog( program ).trim();\n\t\tconst vertexLog = gl.getShaderInfoLog( glVertexShader ).trim();\n\t\tconst fragmentLog = gl.getShaderInfoLog( glFragmentShader ).trim();\n\n\t\tlet runnable = true;\n\t\tlet haveDiagnostics = true;\n\n\t\tif ( gl.getProgramParameter( program, gl.LINK_STATUS ) === false ) {\n\n\t\t\trunnable = false;\n\n\t\t\tconst vertexErrors = getShaderErrors( gl, glVertexShader, 'vertex' );\n\t\t\tconst fragmentErrors = getShaderErrors( gl, glFragmentShader, 'fragment' );\n\n\t\t\tconsole.error( 'THREE.WebGLProgram: shader error: ', gl.getError(), 'gl.VALIDATE_STATUS', gl.getProgramParameter( program, gl.VALIDATE_STATUS ), 'gl.getProgramInfoLog', programLog, vertexErrors, fragmentErrors );\n\n\t\t} else if ( programLog !== '' ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLProgram: gl.getProgramInfoLog()', programLog );\n\n\t\t} else if ( vertexLog === '' || fragmentLog === '' ) {\n\n\t\t\thaveDiagnostics = false;\n\n\t\t}\n\n\t\tif ( haveDiagnostics ) {\n\n\t\t\tthis.diagnostics = {\n\n\t\t\t\trunnable: runnable,\n\n\t\t\t\tprogramLog: programLog,\n\n\t\t\t\tvertexShader: {\n\n\t\t\t\t\tlog: vertexLog,\n\t\t\t\t\tprefix: prefixVertex\n\n\t\t\t\t},\n\n\t\t\t\tfragmentShader: {\n\n\t\t\t\t\tlog: fragmentLog,\n\t\t\t\t\tprefix: prefixFragment\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t}\n\n\t// Clean up\n\n\t// Crashes in iOS9 and iOS10. #18402\n\t// gl.detachShader( program, glVertexShader );\n\t// gl.detachShader( program, glFragmentShader );\n\n\tgl.deleteShader( glVertexShader );\n\tgl.deleteShader( glFragmentShader );\n\n\t// set up caching for uniform locations\n\n\tlet cachedUniforms;\n\n\tthis.getUniforms = function () {\n\n\t\tif ( cachedUniforms === undefined ) {\n\n\t\t\tcachedUniforms = new WebGLUniforms( gl, program );\n\n\t\t}\n\n\t\treturn cachedUniforms;\n\n\t};\n\n\t// set up caching for attribute locations\n\n\tlet cachedAttributes;\n\n\tthis.getAttributes = function () {\n\n\t\tif ( cachedAttributes === undefined ) {\n\n\t\t\tcachedAttributes = fetchAttributeLocations( gl, program );\n\n\t\t}\n\n\t\treturn cachedAttributes;\n\n\t};\n\n\t// free resource\n\n\tthis.destroy = function () {\n\n\t\tbindingStates.releaseStatesOfProgram( this );\n\n\t\tgl.deleteProgram( program );\n\t\tthis.program = undefined;\n\n\t};\n\n\t//\n\n\tthis.name = parameters.shaderName;\n\tthis.id = programIdCount ++;\n\tthis.cacheKey = cacheKey;\n\tthis.usedTimes = 1;\n\tthis.program = program;\n\tthis.vertexShader = glVertexShader;\n\tthis.fragmentShader = glFragmentShader;\n\n\treturn this;\n\n}\n\nexport { WebGLProgram };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { BackSide, DoubleSide, CubeUVRefractionMapping, CubeUVReflectionMapping, LinearEncoding, ObjectSpaceNormalMap, TangentSpaceNormalMap, NoToneMapping } from '../../constants.js';\nimport { WebGLProgram } from './WebGLProgram.js';\nimport { ShaderLib } from '../shaders/ShaderLib.js';\nimport { UniformsUtils } from '../shaders/UniformsUtils.js';\n\nfunction WebGLPrograms( renderer, extensions, capabilities, bindingStates ) {\n\n\tconst programs = [];\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\tconst logarithmicDepthBuffer = capabilities.logarithmicDepthBuffer;\n\tconst floatVertexTextures = capabilities.floatVertexTextures;\n\tconst maxVertexUniforms = capabilities.maxVertexUniforms;\n\tconst vertexTextures = capabilities.vertexTextures;\n\n\tlet precision = capabilities.precision;\n\n\tconst shaderIDs = {\n\t\tMeshDepthMaterial: 'depth',\n\t\tMeshDistanceMaterial: 'distanceRGBA',\n\t\tMeshNormalMaterial: 'normal',\n\t\tMeshBasicMaterial: 'basic',\n\t\tMeshLambertMaterial: 'lambert',\n\t\tMeshPhongMaterial: 'phong',\n\t\tMeshToonMaterial: 'toon',\n\t\tMeshStandardMaterial: 'physical',\n\t\tMeshPhysicalMaterial: 'physical',\n\t\tMeshMatcapMaterial: 'matcap',\n\t\tLineBasicMaterial: 'basic',\n\t\tLineDashedMaterial: 'dashed',\n\t\tPointsMaterial: 'points',\n\t\tShadowMaterial: 'shadow',\n\t\tSpriteMaterial: 'sprite'\n\t};\n\n\tconst parameterNames = [\n\t\t\"precision\", \"isWebGL2\", \"supportsVertexTextures\", \"outputEncoding\", \"instancing\",\n\t\t\"map\", \"mapEncoding\", \"matcap\", \"matcapEncoding\", \"envMap\", \"envMapMode\", \"envMapEncoding\", \"envMapCubeUV\",\n\t\t\"lightMap\", \"lightMapEncoding\", \"aoMap\", \"emissiveMap\", \"emissiveMapEncoding\", \"bumpMap\", \"normalMap\", \"objectSpaceNormalMap\", \"tangentSpaceNormalMap\", \"clearcoatMap\", \"clearcoatRoughnessMap\", \"clearcoatNormalMap\", \"displacementMap\", \"specularMap\",\n\t\t\"roughnessMap\", \"metalnessMap\", \"gradientMap\",\n\t\t\"alphaMap\", \"combine\", \"vertexColors\", \"vertexTangents\", \"vertexUvs\", \"uvsVertexOnly\", \"fog\", \"useFog\", \"fogExp2\",\n\t\t\"flatShading\", \"sizeAttenuation\", \"logarithmicDepthBuffer\", \"skinning\",\n\t\t\"maxBones\", \"useVertexTexture\", \"morphTargets\", \"morphNormals\",\n\t\t\"maxMorphTargets\", \"maxMorphNormals\", \"premultipliedAlpha\",\n\t\t\"numDirLights\", \"numPointLights\", \"numSpotLights\", \"numHemiLights\", \"numRectAreaLights\",\n\t\t\"numDirLightShadows\", \"numPointLightShadows\", \"numSpotLightShadows\",\n\t\t\"shadowMapEnabled\", \"shadowMapType\", \"toneMapping\", 'physicallyCorrectLights',\n\t\t\"alphaTest\", \"doubleSided\", \"flipSided\", \"numClippingPlanes\", \"numClipIntersection\", \"depthPacking\", \"dithering\",\n\t\t\"sheen\"\n\t];\n\n\tfunction getShaderObject( material, shaderID ) {\n\n\t\tlet shaderobject;\n\n\t\tif ( shaderID ) {\n\n\t\t\tconst shader = ShaderLib[ shaderID ];\n\n\t\t\tshaderobject = {\n\t\t\t\tname: material.name || material.type,\n\t\t\t\tuniforms: UniformsUtils.clone( shader.uniforms ),\n\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\tfragmentShader: shader.fragmentShader\n\t\t\t};\n\n\t\t} else {\n\n\t\t\tshaderobject = {\n\t\t\t\tname: material.name || material.type,\n\t\t\t\tuniforms: material.uniforms,\n\t\t\t\tvertexShader: material.vertexShader,\n\t\t\t\tfragmentShader: material.fragmentShader\n\t\t\t};\n\n\t\t}\n\n\t\treturn shaderobject;\n\n\t}\n\n\tfunction allocateBones( object ) {\n\n\t\tconst skeleton = object.skeleton;\n\t\tconst bones = skeleton.bones;\n\n\t\tif ( floatVertexTextures ) {\n\n\t\t\treturn 1024;\n\n\t\t} else {\n\n\t\t\t// default for when object is not specified\n\t\t\t// ( for example when prebuilding shader to be used with multiple objects )\n\t\t\t//\n\t\t\t//  - leave some extra space for other uniforms\n\t\t\t//  - limit here is ANGLE's 254 max uniform vectors\n\t\t\t//    (up to 54 should be safe)\n\n\t\t\tconst nVertexUniforms = maxVertexUniforms;\n\t\t\tconst nVertexMatrices = Math.floor( ( nVertexUniforms - 20 ) / 4 );\n\n\t\t\tconst maxBones = Math.min( nVertexMatrices, bones.length );\n\n\t\t\tif ( maxBones < bones.length ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Skeleton has ' + bones.length + ' bones. This GPU supports ' + maxBones + '.' );\n\t\t\t\treturn 0;\n\n\t\t\t}\n\n\t\t\treturn maxBones;\n\n\t\t}\n\n\t}\n\n\tfunction getTextureEncodingFromMap( map ) {\n\n\t\tlet encoding;\n\n\t\tif ( ! map ) {\n\n\t\t\tencoding = LinearEncoding;\n\n\t\t} else if ( map.isTexture ) {\n\n\t\t\tencoding = map.encoding;\n\n\t\t} else if ( map.isWebGLRenderTarget ) {\n\n\t\t\tconsole.warn( \"THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.\" );\n\t\t\tencoding = map.texture.encoding;\n\n\t\t}\n\n\t\treturn encoding;\n\n\t}\n\n\tfunction getParameters( material, lights, shadows, scene, nClipPlanes, nClipIntersection, object ) {\n\n\t\tconst fog = scene.fog;\n\t\tconst environment = material.isMeshStandardMaterial ? scene.environment : null;\n\n\t\tconst envMap = material.envMap || environment;\n\n\t\tconst shaderID = shaderIDs[ material.type ];\n\n\t\t// heuristics to create shader parameters according to lights in the scene\n\t\t// (not to blow over maxLights budget)\n\n\t\tconst maxBones = object.isSkinnedMesh ? allocateBones( object ) : 0;\n\n\t\tif ( material.precision !== null ) {\n\n\t\t\tprecision = capabilities.getMaxPrecision( material.precision );\n\n\t\t\tif ( precision !== material.precision ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLProgram.getParameters:', material.precision, 'not supported, using', precision, 'instead.' );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst shaderobject = getShaderObject( material, shaderID );\n\t\tmaterial.onBeforeCompile( shaderobject, renderer );\n\n\t\tconst currentRenderTarget = renderer.getRenderTarget();\n\n\t\tconst parameters = {\n\n\t\t\tisWebGL2: isWebGL2,\n\n\t\t\tshaderID: shaderID,\n\t\t\tshaderName: shaderobject.name,\n\n\t\t\tuniforms: shaderobject.uniforms,\n\t\t\tvertexShader: shaderobject.vertexShader,\n\t\t\tfragmentShader: shaderobject.fragmentShader,\n\t\t\tdefines: material.defines,\n\n\t\t\tisRawShaderMaterial: material.isRawShaderMaterial,\n\t\t\tisShaderMaterial: material.isShaderMaterial,\n\n\t\t\tprecision: precision,\n\n\t\t\tinstancing: object.isInstancedMesh === true,\n\n\t\t\tsupportsVertexTextures: vertexTextures,\n\t\t\toutputEncoding: ( currentRenderTarget !== null ) ? getTextureEncodingFromMap( currentRenderTarget.texture ) : renderer.outputEncoding,\n\t\t\tmap: !! material.map,\n\t\t\tmapEncoding: getTextureEncodingFromMap( material.map ),\n\t\t\tmatcap: !! material.matcap,\n\t\t\tmatcapEncoding: getTextureEncodingFromMap( material.matcap ),\n\t\t\tenvMap: !! envMap,\n\t\t\tenvMapMode: envMap && envMap.mapping,\n\t\t\tenvMapEncoding: getTextureEncodingFromMap( envMap ),\n\t\t\tenvMapCubeUV: ( !! envMap ) && ( ( envMap.mapping === CubeUVReflectionMapping ) || ( envMap.mapping === CubeUVRefractionMapping ) ),\n\t\t\tlightMap: !! material.lightMap,\n\t\t\tlightMapEncoding: getTextureEncodingFromMap( material.lightMap ),\n\t\t\taoMap: !! material.aoMap,\n\t\t\temissiveMap: !! material.emissiveMap,\n\t\t\temissiveMapEncoding: getTextureEncodingFromMap( material.emissiveMap ),\n\t\t\tbumpMap: !! material.bumpMap,\n\t\t\tnormalMap: !! material.normalMap,\n\t\t\tobjectSpaceNormalMap: material.normalMapType === ObjectSpaceNormalMap,\n\t\t\ttangentSpaceNormalMap: material.normalMapType === TangentSpaceNormalMap,\n\t\t\tclearcoatMap: !! material.clearcoatMap,\n\t\t\tclearcoatRoughnessMap: !! material.clearcoatRoughnessMap,\n\t\t\tclearcoatNormalMap: !! material.clearcoatNormalMap,\n\t\t\tdisplacementMap: !! material.displacementMap,\n\t\t\troughnessMap: !! material.roughnessMap,\n\t\t\tmetalnessMap: !! material.metalnessMap,\n\t\t\tspecularMap: !! material.specularMap,\n\t\t\talphaMap: !! material.alphaMap,\n\n\t\t\tgradientMap: !! material.gradientMap,\n\n\t\t\tsheen: !! material.sheen,\n\n\t\t\tcombine: material.combine,\n\n\t\t\tvertexTangents: ( material.normalMap && material.vertexTangents ),\n\t\t\tvertexColors: material.vertexColors,\n\t\t\tvertexUvs: !! material.map || !! material.bumpMap || !! material.normalMap || !! material.specularMap || !! material.alphaMap || !! material.emissiveMap || !! material.roughnessMap || !! material.metalnessMap || !! material.clearcoatMap || !! material.clearcoatRoughnessMap || !! material.clearcoatNormalMap || !! material.displacementMap,\n\t\t\tuvsVertexOnly: ! ( !! material.map || !! material.bumpMap || !! material.normalMap || !! material.specularMap || !! material.alphaMap || !! material.emissiveMap || !! material.roughnessMap || !! material.metalnessMap || !! material.clearcoatNormalMap ) && !! material.displacementMap,\n\n\t\t\tfog: !! fog,\n\t\t\tuseFog: material.fog,\n\t\t\tfogExp2: ( fog && fog.isFogExp2 ),\n\n\t\t\tflatShading: material.flatShading,\n\n\t\t\tsizeAttenuation: material.sizeAttenuation,\n\t\t\tlogarithmicDepthBuffer: logarithmicDepthBuffer,\n\n\t\t\tskinning: material.skinning && maxBones > 0,\n\t\t\tmaxBones: maxBones,\n\t\t\tuseVertexTexture: floatVertexTextures,\n\n\t\t\tmorphTargets: material.morphTargets,\n\t\t\tmorphNormals: material.morphNormals,\n\t\t\tmaxMorphTargets: renderer.maxMorphTargets,\n\t\t\tmaxMorphNormals: renderer.maxMorphNormals,\n\n\t\t\tnumDirLights: lights.directional.length,\n\t\t\tnumPointLights: lights.point.length,\n\t\t\tnumSpotLights: lights.spot.length,\n\t\t\tnumRectAreaLights: lights.rectArea.length,\n\t\t\tnumHemiLights: lights.hemi.length,\n\n\t\t\tnumDirLightShadows: lights.directionalShadowMap.length,\n\t\t\tnumPointLightShadows: lights.pointShadowMap.length,\n\t\t\tnumSpotLightShadows: lights.spotShadowMap.length,\n\n\t\t\tnumClippingPlanes: nClipPlanes,\n\t\t\tnumClipIntersection: nClipIntersection,\n\n\t\t\tdithering: material.dithering,\n\n\t\t\tshadowMapEnabled: renderer.shadowMap.enabled && shadows.length > 0,\n\t\t\tshadowMapType: renderer.shadowMap.type,\n\n\t\t\ttoneMapping: material.toneMapped ? renderer.toneMapping : NoToneMapping,\n\t\t\tphysicallyCorrectLights: renderer.physicallyCorrectLights,\n\n\t\t\tpremultipliedAlpha: material.premultipliedAlpha,\n\n\t\t\talphaTest: material.alphaTest,\n\t\t\tdoubleSided: material.side === DoubleSide,\n\t\t\tflipSided: material.side === BackSide,\n\n\t\t\tdepthPacking: ( material.depthPacking !== undefined ) ? material.depthPacking : false,\n\n\t\t\tindex0AttributeName: material.index0AttributeName,\n\n\t\t\textensionDerivatives: material.extensions && material.extensions.derivatives,\n\t\t\textensionFragDepth: material.extensions && material.extensions.fragDepth,\n\t\t\textensionDrawBuffers: material.extensions && material.extensions.drawBuffers,\n\t\t\textensionShaderTextureLOD: material.extensions && material.extensions.shaderTextureLOD,\n\n\t\t\trendererExtensionFragDepth: isWebGL2 || extensions.get( 'EXT_frag_depth' ) !== null,\n\t\t\trendererExtensionDrawBuffers: isWebGL2 || extensions.get( 'WEBGL_draw_buffers' ) !== null,\n\t\t\trendererExtensionShaderTextureLod: isWebGL2 || extensions.get( 'EXT_shader_texture_lod' ) !== null,\n\n\t\t\tcustomProgramCacheKey: material.customProgramCacheKey()\n\n\t\t};\n\n\t\treturn parameters;\n\n\t}\n\n\tfunction getProgramCacheKey( parameters ) {\n\n\t\tconst array = [];\n\n\t\tif ( parameters.shaderID ) {\n\n\t\t\tarray.push( parameters.shaderID );\n\n\t\t} else {\n\n\t\t\tarray.push( parameters.fragmentShader );\n\t\t\tarray.push( parameters.vertexShader );\n\n\t\t}\n\n\t\tif ( parameters.defines !== undefined ) {\n\n\t\t\tfor ( const name in parameters.defines ) {\n\n\t\t\t\tarray.push( name );\n\t\t\t\tarray.push( parameters.defines[ name ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( parameters.isRawShaderMaterial === undefined ) {\n\n\t\t\tfor ( let i = 0; i < parameterNames.length; i ++ ) {\n\n\t\t\t\tarray.push( parameters[ parameterNames[ i ] ] );\n\n\t\t\t}\n\n\t\t\tarray.push( renderer.outputEncoding );\n\t\t\tarray.push( renderer.gammaFactor );\n\n\t\t}\n\n\t\tarray.push( parameters.customProgramCacheKey );\n\n\t\treturn array.join();\n\n\t}\n\n\tfunction acquireProgram( parameters, cacheKey ) {\n\n\t\tlet program;\n\n\t\t// Check if code has been already compiled\n\t\tfor ( let p = 0, pl = programs.length; p < pl; p ++ ) {\n\n\t\t\tconst preexistingProgram = programs[ p ];\n\n\t\t\tif ( preexistingProgram.cacheKey === cacheKey ) {\n\n\t\t\t\tprogram = preexistingProgram;\n\t\t\t\t++ program.usedTimes;\n\n\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( program === undefined ) {\n\n\t\t\tprogram = new WebGLProgram( renderer, cacheKey, parameters, bindingStates );\n\t\t\tprograms.push( program );\n\n\t\t}\n\n\t\treturn program;\n\n\t}\n\n\tfunction releaseProgram( program ) {\n\n\t\tif ( -- program.usedTimes === 0 ) {\n\n\t\t\t// Remove from unordered set\n\t\t\tconst i = programs.indexOf( program );\n\t\t\tprograms[ i ] = programs[ programs.length - 1 ];\n\t\t\tprograms.pop();\n\n\t\t\t// Free WebGL resources\n\t\t\tprogram.destroy();\n\n\t\t}\n\n\t}\n\n\treturn {\n\t\tgetParameters: getParameters,\n\t\tgetProgramCacheKey: getProgramCacheKey,\n\t\tacquireProgram: acquireProgram,\n\t\treleaseProgram: releaseProgram,\n\t\t// Exposed for resource monitoring & error feedback via renderer.info:\n\t\tprograms: programs\n\t};\n\n}\n\n\nexport { WebGLPrograms };\n","/**\n * @author fordacious / fordacious.github.io\n */\n\nfunction WebGLProperties() {\n\n\tlet properties = new WeakMap();\n\n\tfunction get( object ) {\n\n\t\tlet map = properties.get( object );\n\n\t\tif ( map === undefined ) {\n\n\t\t\tmap = {};\n\t\t\tproperties.set( object, map );\n\n\t\t}\n\n\t\treturn map;\n\n\t}\n\n\tfunction remove( object ) {\n\n\t\tproperties.delete( object );\n\n\t}\n\n\tfunction update( object, key, value ) {\n\n\t\tproperties.get( object )[ key ] = value;\n\n\t}\n\n\tfunction dispose() {\n\n\t\tproperties = new WeakMap();\n\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tremove: remove,\n\t\tupdate: update,\n\t\tdispose: dispose\n\t};\n\n}\n\n\nexport { WebGLProperties };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction painterSortStable( a, b ) {\n\n\tif ( a.groupOrder !== b.groupOrder ) {\n\n\t\treturn a.groupOrder - b.groupOrder;\n\n\t} else if ( a.renderOrder !== b.renderOrder ) {\n\n\t\treturn a.renderOrder - b.renderOrder;\n\n\t} else if ( a.program !== b.program ) {\n\n\t\treturn a.program.id - b.program.id;\n\n\t} else if ( a.material.id !== b.material.id ) {\n\n\t\treturn a.material.id - b.material.id;\n\n\t} else if ( a.z !== b.z ) {\n\n\t\treturn a.z - b.z;\n\n\t} else {\n\n\t\treturn a.id - b.id;\n\n\t}\n\n}\n\nfunction reversePainterSortStable( a, b ) {\n\n\tif ( a.groupOrder !== b.groupOrder ) {\n\n\t\treturn a.groupOrder - b.groupOrder;\n\n\t} else if ( a.renderOrder !== b.renderOrder ) {\n\n\t\treturn a.renderOrder - b.renderOrder;\n\n\t} else if ( a.z !== b.z ) {\n\n\t\treturn b.z - a.z;\n\n\t} else {\n\n\t\treturn a.id - b.id;\n\n\t}\n\n}\n\n\nfunction WebGLRenderList() {\n\n\tconst renderItems = [];\n\tlet renderItemsIndex = 0;\n\n\tconst opaque = [];\n\tconst transparent = [];\n\n\tconst defaultProgram = { id: - 1 };\n\n\tfunction init() {\n\n\t\trenderItemsIndex = 0;\n\n\t\topaque.length = 0;\n\t\ttransparent.length = 0;\n\n\t}\n\n\tfunction getNextRenderItem( object, geometry, material, groupOrder, z, group ) {\n\n\t\tlet renderItem = renderItems[ renderItemsIndex ];\n\n\t\tif ( renderItem === undefined ) {\n\n\t\t\trenderItem = {\n\t\t\t\tid: object.id,\n\t\t\t\tobject: object,\n\t\t\t\tgeometry: geometry,\n\t\t\t\tmaterial: material,\n\t\t\t\tprogram: material.program || defaultProgram,\n\t\t\t\tgroupOrder: groupOrder,\n\t\t\t\trenderOrder: object.renderOrder,\n\t\t\t\tz: z,\n\t\t\t\tgroup: group\n\t\t\t};\n\n\t\t\trenderItems[ renderItemsIndex ] = renderItem;\n\n\t\t} else {\n\n\t\t\trenderItem.id = object.id;\n\t\t\trenderItem.object = object;\n\t\t\trenderItem.geometry = geometry;\n\t\t\trenderItem.material = material;\n\t\t\trenderItem.program = material.program || defaultProgram;\n\t\t\trenderItem.groupOrder = groupOrder;\n\t\t\trenderItem.renderOrder = object.renderOrder;\n\t\t\trenderItem.z = z;\n\t\t\trenderItem.group = group;\n\n\t\t}\n\n\t\trenderItemsIndex ++;\n\n\t\treturn renderItem;\n\n\t}\n\n\tfunction push( object, geometry, material, groupOrder, z, group ) {\n\n\t\tconst renderItem = getNextRenderItem( object, geometry, material, groupOrder, z, group );\n\n\t\t( material.transparent === true ? transparent : opaque ).push( renderItem );\n\n\t}\n\n\tfunction unshift( object, geometry, material, groupOrder, z, group ) {\n\n\t\tconst renderItem = getNextRenderItem( object, geometry, material, groupOrder, z, group );\n\n\t\t( material.transparent === true ? transparent : opaque ).unshift( renderItem );\n\n\t}\n\n\tfunction sort( customOpaqueSort, customTransparentSort ) {\n\n\t\tif ( opaque.length > 1 ) opaque.sort( customOpaqueSort || painterSortStable );\n\t\tif ( transparent.length > 1 ) transparent.sort( customTransparentSort || reversePainterSortStable );\n\n\t}\n\n\tfunction finish() {\n\n\t\t// Clear references from inactive renderItems in the list\n\n\t\tfor ( let i = renderItemsIndex, il = renderItems.length; i < il; i ++ ) {\n\n\t\t\tconst renderItem = renderItems[ i ];\n\n\t\t\tif ( renderItem.id === null ) break;\n\n\t\t\trenderItem.id = null;\n\t\t\trenderItem.object = null;\n\t\t\trenderItem.geometry = null;\n\t\t\trenderItem.material = null;\n\t\t\trenderItem.program = null;\n\t\t\trenderItem.group = null;\n\n\t\t}\n\n\t}\n\n\treturn {\n\t\topaque: opaque,\n\t\ttransparent: transparent,\n\n\t\tinit: init,\n\t\tpush: push,\n\t\tunshift: unshift,\n\t\tfinish: finish,\n\n\t\tsort: sort\n\t};\n\n}\n\nfunction WebGLRenderLists() {\n\n\tlet lists = new WeakMap();\n\n\tfunction onSceneDispose( event ) {\n\n\t\tconst scene = event.target;\n\n\t\tscene.removeEventListener( 'dispose', onSceneDispose );\n\n\t\tlists.delete( scene );\n\n\t}\n\n\tfunction get( scene, camera ) {\n\n\t\tconst cameras = lists.get( scene );\n\t\tlet list;\n\n\t\tif ( cameras === undefined ) {\n\n\t\t\tlist = new WebGLRenderList();\n\t\t\tlists.set( scene, new WeakMap() );\n\t\t\tlists.get( scene ).set( camera, list );\n\n\t\t\tscene.addEventListener( 'dispose', onSceneDispose );\n\n\t\t} else {\n\n\t\t\tlist = cameras.get( camera );\n\t\t\tif ( list === undefined ) {\n\n\t\t\t\tlist = new WebGLRenderList();\n\t\t\t\tcameras.set( camera, list );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn list;\n\n\t}\n\n\tfunction dispose() {\n\n\t\tlists = new WeakMap();\n\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tdispose: dispose\n\t};\n\n}\n\n\nexport { WebGLRenderLists };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { Color } from '../../math/Color.js';\nimport { Matrix4 } from '../../math/Matrix4.js';\nimport { Vector2 } from '../../math/Vector2.js';\nimport { Vector3 } from '../../math/Vector3.js';\n\nfunction UniformsCache() {\n\n\tconst lights = {};\n\n\treturn {\n\n\t\tget: function ( light ) {\n\n\t\t\tif ( lights[ light.id ] !== undefined ) {\n\n\t\t\t\treturn lights[ light.id ];\n\n\t\t\t}\n\n\t\t\tlet uniforms;\n\n\t\t\tswitch ( light.type ) {\n\n\t\t\t\tcase 'DirectionalLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tdirection: new Vector3(),\n\t\t\t\t\t\tcolor: new Color()\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'SpotLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tposition: new Vector3(),\n\t\t\t\t\t\tdirection: new Vector3(),\n\t\t\t\t\t\tcolor: new Color(),\n\t\t\t\t\t\tdistance: 0,\n\t\t\t\t\t\tconeCos: 0,\n\t\t\t\t\t\tpenumbraCos: 0,\n\t\t\t\t\t\tdecay: 0\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'PointLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tposition: new Vector3(),\n\t\t\t\t\t\tcolor: new Color(),\n\t\t\t\t\t\tdistance: 0,\n\t\t\t\t\t\tdecay: 0\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'HemisphereLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tdirection: new Vector3(),\n\t\t\t\t\t\tskyColor: new Color(),\n\t\t\t\t\t\tgroundColor: new Color()\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'RectAreaLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tcolor: new Color(),\n\t\t\t\t\t\tposition: new Vector3(),\n\t\t\t\t\t\thalfWidth: new Vector3(),\n\t\t\t\t\t\thalfHeight: new Vector3()\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tlights[ light.id ] = uniforms;\n\n\t\t\treturn uniforms;\n\n\t\t}\n\n\t};\n\n}\n\nfunction ShadowUniformsCache() {\n\n\tconst lights = {};\n\n\treturn {\n\n\t\tget: function ( light ) {\n\n\t\t\tif ( lights[ light.id ] !== undefined ) {\n\n\t\t\t\treturn lights[ light.id ];\n\n\t\t\t}\n\n\t\t\tlet uniforms;\n\n\t\t\tswitch ( light.type ) {\n\n\t\t\t\tcase 'DirectionalLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tshadowBias: 0,\n\t\t\t\t\t\tshadowNormalBias: 0,\n\t\t\t\t\t\tshadowRadius: 1,\n\t\t\t\t\t\tshadowMapSize: new Vector2()\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'SpotLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tshadowBias: 0,\n\t\t\t\t\t\tshadowNormalBias: 0,\n\t\t\t\t\t\tshadowRadius: 1,\n\t\t\t\t\t\tshadowMapSize: new Vector2()\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'PointLight':\n\t\t\t\t\tuniforms = {\n\t\t\t\t\t\tshadowBias: 0,\n\t\t\t\t\t\tshadowNormalBias: 0,\n\t\t\t\t\t\tshadowRadius: 1,\n\t\t\t\t\t\tshadowMapSize: new Vector2(),\n\t\t\t\t\t\tshadowCameraNear: 1,\n\t\t\t\t\t\tshadowCameraFar: 1000\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\t// TODO (abelnation): set RectAreaLight shadow uniforms\n\n\t\t\t}\n\n\t\t\tlights[ light.id ] = uniforms;\n\n\t\t\treturn uniforms;\n\n\t\t}\n\n\t};\n\n}\n\n\n\nlet nextVersion = 0;\n\nfunction shadowCastingLightsFirst( lightA, lightB ) {\n\n\treturn ( lightB.castShadow ? 1 : 0 ) - ( lightA.castShadow ? 1 : 0 );\n\n}\n\nfunction WebGLLights() {\n\n\tconst cache = new UniformsCache();\n\n\tconst shadowCache = ShadowUniformsCache();\n\n\tconst state = {\n\n\t\tversion: 0,\n\n\t\thash: {\n\t\t\tdirectionalLength: - 1,\n\t\t\tpointLength: - 1,\n\t\t\tspotLength: - 1,\n\t\t\trectAreaLength: - 1,\n\t\t\themiLength: - 1,\n\n\t\t\tnumDirectionalShadows: - 1,\n\t\t\tnumPointShadows: - 1,\n\t\t\tnumSpotShadows: - 1\n\t\t},\n\n\t\tambient: [ 0, 0, 0 ],\n\t\tprobe: [],\n\t\tdirectional: [],\n\t\tdirectionalShadow: [],\n\t\tdirectionalShadowMap: [],\n\t\tdirectionalShadowMatrix: [],\n\t\tspot: [],\n\t\tspotShadow: [],\n\t\tspotShadowMap: [],\n\t\tspotShadowMatrix: [],\n\t\trectArea: [],\n\t\tpoint: [],\n\t\tpointShadow: [],\n\t\tpointShadowMap: [],\n\t\tpointShadowMatrix: [],\n\t\themi: []\n\n\t};\n\n\tfor ( let i = 0; i < 9; i ++ ) state.probe.push( new Vector3() );\n\n\tconst vector3 = new Vector3();\n\tconst matrix4 = new Matrix4();\n\tconst matrix42 = new Matrix4();\n\n\tfunction setup( lights, shadows, camera ) {\n\n\t\tlet r = 0, g = 0, b = 0;\n\n\t\tfor ( let i = 0; i < 9; i ++ ) state.probe[ i ].set( 0, 0, 0 );\n\n\t\tlet directionalLength = 0;\n\t\tlet pointLength = 0;\n\t\tlet spotLength = 0;\n\t\tlet rectAreaLength = 0;\n\t\tlet hemiLength = 0;\n\n\t\tlet numDirectionalShadows = 0;\n\t\tlet numPointShadows = 0;\n\t\tlet numSpotShadows = 0;\n\n\t\tconst viewMatrix = camera.matrixWorldInverse;\n\n\t\tlights.sort( shadowCastingLightsFirst );\n\n\t\tfor ( let i = 0, l = lights.length; i < l; i ++ ) {\n\n\t\t\tconst light = lights[ i ];\n\n\t\t\tconst color = light.color;\n\t\t\tconst intensity = light.intensity;\n\t\t\tconst distance = light.distance;\n\n\t\t\tconst shadowMap = ( light.shadow && light.shadow.map ) ? light.shadow.map.texture : null;\n\n\t\t\tif ( light.isAmbientLight ) {\n\n\t\t\t\tr += color.r * intensity;\n\t\t\t\tg += color.g * intensity;\n\t\t\t\tb += color.b * intensity;\n\n\t\t\t} else if ( light.isLightProbe ) {\n\n\t\t\t\tfor ( let j = 0; j < 9; j ++ ) {\n\n\t\t\t\t\tstate.probe[ j ].addScaledVector( light.sh.coefficients[ j ], intensity );\n\n\t\t\t\t}\n\n\t\t\t} else if ( light.isDirectionalLight ) {\n\n\t\t\t\tconst uniforms = cache.get( light );\n\n\t\t\t\tuniforms.color.copy( light.color ).multiplyScalar( light.intensity );\n\t\t\t\tuniforms.direction.setFromMatrixPosition( light.matrixWorld );\n\t\t\t\tvector3.setFromMatrixPosition( light.target.matrixWorld );\n\t\t\t\tuniforms.direction.sub( vector3 );\n\t\t\t\tuniforms.direction.transformDirection( viewMatrix );\n\n\t\t\t\tif ( light.castShadow ) {\n\n\t\t\t\t\tconst shadow = light.shadow;\n\n\t\t\t\t\tconst shadowUniforms = shadowCache.get( light );\n\n\t\t\t\t\tshadowUniforms.shadowBias = shadow.bias;\n\t\t\t\t\tshadowUniforms.shadowNormalBias = shadow.normalBias;\n\t\t\t\t\tshadowUniforms.shadowRadius = shadow.radius;\n\t\t\t\t\tshadowUniforms.shadowMapSize = shadow.mapSize;\n\n\t\t\t\t\tstate.directionalShadow[ directionalLength ] = shadowUniforms;\n\t\t\t\t\tstate.directionalShadowMap[ directionalLength ] = shadowMap;\n\t\t\t\t\tstate.directionalShadowMatrix[ directionalLength ] = light.shadow.matrix;\n\n\t\t\t\t\tnumDirectionalShadows ++;\n\n\t\t\t\t}\n\n\t\t\t\tstate.directional[ directionalLength ] = uniforms;\n\n\t\t\t\tdirectionalLength ++;\n\n\t\t\t} else if ( light.isSpotLight ) {\n\n\t\t\t\tconst uniforms = cache.get( light );\n\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\n\t\t\t\tuniforms.position.applyMatrix4( viewMatrix );\n\n\t\t\t\tuniforms.color.copy( color ).multiplyScalar( intensity );\n\t\t\t\tuniforms.distance = distance;\n\n\t\t\t\tuniforms.direction.setFromMatrixPosition( light.matrixWorld );\n\t\t\t\tvector3.setFromMatrixPosition( light.target.matrixWorld );\n\t\t\t\tuniforms.direction.sub( vector3 );\n\t\t\t\tuniforms.direction.transformDirection( viewMatrix );\n\n\t\t\t\tuniforms.coneCos = Math.cos( light.angle );\n\t\t\t\tuniforms.penumbraCos = Math.cos( light.angle * ( 1 - light.penumbra ) );\n\t\t\t\tuniforms.decay = light.decay;\n\n\t\t\t\tif ( light.castShadow ) {\n\n\t\t\t\t\tconst shadow = light.shadow;\n\n\t\t\t\t\tconst shadowUniforms = shadowCache.get( light );\n\n\t\t\t\t\tshadowUniforms.shadowBias = shadow.bias;\n\t\t\t\t\tshadowUniforms.shadowNormalBias = shadow.normalBias;\n\t\t\t\t\tshadowUniforms.shadowRadius = shadow.radius;\n\t\t\t\t\tshadowUniforms.shadowMapSize = shadow.mapSize;\n\n\t\t\t\t\tstate.spotShadow[ spotLength ] = shadowUniforms;\n\t\t\t\t\tstate.spotShadowMap[ spotLength ] = shadowMap;\n\t\t\t\t\tstate.spotShadowMatrix[ spotLength ] = light.shadow.matrix;\n\n\t\t\t\t\tnumSpotShadows ++;\n\n\t\t\t\t}\n\n\t\t\t\tstate.spot[ spotLength ] = uniforms;\n\n\t\t\t\tspotLength ++;\n\n\t\t\t} else if ( light.isRectAreaLight ) {\n\n\t\t\t\tconst uniforms = cache.get( light );\n\n\t\t\t\t// (a) intensity is the total visible light emitted\n\t\t\t\t//uniforms.color.copy( color ).multiplyScalar( intensity / ( light.width * light.height * Math.PI ) );\n\n\t\t\t\t// (b) intensity is the brightness of the light\n\t\t\t\tuniforms.color.copy( color ).multiplyScalar( intensity );\n\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\n\t\t\t\tuniforms.position.applyMatrix4( viewMatrix );\n\n\t\t\t\t// extract local rotation of light to derive width/height half vectors\n\t\t\t\tmatrix42.identity();\n\t\t\t\tmatrix4.copy( light.matrixWorld );\n\t\t\t\tmatrix4.premultiply( viewMatrix );\n\t\t\t\tmatrix42.extractRotation( matrix4 );\n\n\t\t\t\tuniforms.halfWidth.set( light.width * 0.5, 0.0, 0.0 );\n\t\t\t\tuniforms.halfHeight.set( 0.0, light.height * 0.5, 0.0 );\n\n\t\t\t\tuniforms.halfWidth.applyMatrix4( matrix42 );\n\t\t\t\tuniforms.halfHeight.applyMatrix4( matrix42 );\n\n\t\t\t\t// TODO (abelnation): RectAreaLight distance?\n\t\t\t\t// uniforms.distance = distance;\n\n\t\t\t\tstate.rectArea[ rectAreaLength ] = uniforms;\n\n\t\t\t\trectAreaLength ++;\n\n\t\t\t} else if ( light.isPointLight ) {\n\n\t\t\t\tconst uniforms = cache.get( light );\n\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\n\t\t\t\tuniforms.position.applyMatrix4( viewMatrix );\n\n\t\t\t\tuniforms.color.copy( light.color ).multiplyScalar( light.intensity );\n\t\t\t\tuniforms.distance = light.distance;\n\t\t\t\tuniforms.decay = light.decay;\n\n\t\t\t\tif ( light.castShadow ) {\n\n\t\t\t\t\tconst shadow = light.shadow;\n\n\t\t\t\t\tconst shadowUniforms = shadowCache.get( light );\n\n\t\t\t\t\tshadowUniforms.shadowBias = shadow.bias;\n\t\t\t\t\tshadowUniforms.shadowNormalBias = shadow.normalBias;\n\t\t\t\t\tshadowUniforms.shadowRadius = shadow.radius;\n\t\t\t\t\tshadowUniforms.shadowMapSize = shadow.mapSize;\n\t\t\t\t\tshadowUniforms.shadowCameraNear = shadow.camera.near;\n\t\t\t\t\tshadowUniforms.shadowCameraFar = shadow.camera.far;\n\n\t\t\t\t\tstate.pointShadow[ pointLength ] = shadowUniforms;\n\t\t\t\t\tstate.pointShadowMap[ pointLength ] = shadowMap;\n\t\t\t\t\tstate.pointShadowMatrix[ pointLength ] = light.shadow.matrix;\n\n\t\t\t\t\tnumPointShadows ++;\n\n\t\t\t\t}\n\n\t\t\t\tstate.point[ pointLength ] = uniforms;\n\n\t\t\t\tpointLength ++;\n\n\t\t\t} else if ( light.isHemisphereLight ) {\n\n\t\t\t\tconst uniforms = cache.get( light );\n\n\t\t\t\tuniforms.direction.setFromMatrixPosition( light.matrixWorld );\n\t\t\t\tuniforms.direction.transformDirection( viewMatrix );\n\t\t\t\tuniforms.direction.normalize();\n\n\t\t\t\tuniforms.skyColor.copy( light.color ).multiplyScalar( intensity );\n\t\t\t\tuniforms.groundColor.copy( light.groundColor ).multiplyScalar( intensity );\n\n\t\t\t\tstate.hemi[ hemiLength ] = uniforms;\n\n\t\t\t\themiLength ++;\n\n\t\t\t}\n\n\t\t}\n\n\t\tstate.ambient[ 0 ] = r;\n\t\tstate.ambient[ 1 ] = g;\n\t\tstate.ambient[ 2 ] = b;\n\n\t\tconst hash = state.hash;\n\n\t\tif ( hash.directionalLength !== directionalLength ||\n\t\t\thash.pointLength !== pointLength ||\n\t\t\thash.spotLength !== spotLength ||\n\t\t\thash.rectAreaLength !== rectAreaLength ||\n\t\t\thash.hemiLength !== hemiLength ||\n\t\t\thash.numDirectionalShadows !== numDirectionalShadows ||\n\t\t\thash.numPointShadows !== numPointShadows ||\n\t\t\thash.numSpotShadows !== numSpotShadows ) {\n\n\t\t\tstate.directional.length = directionalLength;\n\t\t\tstate.spot.length = spotLength;\n\t\t\tstate.rectArea.length = rectAreaLength;\n\t\t\tstate.point.length = pointLength;\n\t\t\tstate.hemi.length = hemiLength;\n\n\t\t\tstate.directionalShadow.length = numDirectionalShadows;\n\t\t\tstate.directionalShadowMap.length = numDirectionalShadows;\n\t\t\tstate.pointShadow.length = numPointShadows;\n\t\t\tstate.pointShadowMap.length = numPointShadows;\n\t\t\tstate.spotShadow.length = numSpotShadows;\n\t\t\tstate.spotShadowMap.length = numSpotShadows;\n\t\t\tstate.directionalShadowMatrix.length = numDirectionalShadows;\n\t\t\tstate.pointShadowMatrix.length = numPointShadows;\n\t\t\tstate.spotShadowMatrix.length = numSpotShadows;\n\n\t\t\thash.directionalLength = directionalLength;\n\t\t\thash.pointLength = pointLength;\n\t\t\thash.spotLength = spotLength;\n\t\t\thash.rectAreaLength = rectAreaLength;\n\t\t\thash.hemiLength = hemiLength;\n\n\t\t\thash.numDirectionalShadows = numDirectionalShadows;\n\t\t\thash.numPointShadows = numPointShadows;\n\t\t\thash.numSpotShadows = numSpotShadows;\n\n\t\t\tstate.version = nextVersion ++;\n\n\t\t}\n\n\t}\n\n\treturn {\n\t\tsetup: setup,\n\t\tstate: state\n\t};\n\n}\n\n\nexport { WebGLLights };\n","/**\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { WebGLLights } from './WebGLLights.js';\n\nfunction WebGLRenderState() {\n\n\tconst lights = new WebGLLights();\n\n\tconst lightsArray = [];\n\tconst shadowsArray = [];\n\n\tfunction init() {\n\n\t\tlightsArray.length = 0;\n\t\tshadowsArray.length = 0;\n\n\t}\n\n\tfunction pushLight( light ) {\n\n\t\tlightsArray.push( light );\n\n\t}\n\n\tfunction pushShadow( shadowLight ) {\n\n\t\tshadowsArray.push( shadowLight );\n\n\t}\n\n\tfunction setupLights( camera ) {\n\n\t\tlights.setup( lightsArray, shadowsArray, camera );\n\n\t}\n\n\tconst state = {\n\t\tlightsArray: lightsArray,\n\t\tshadowsArray: shadowsArray,\n\n\t\tlights: lights\n\t};\n\n\treturn {\n\t\tinit: init,\n\t\tstate: state,\n\t\tsetupLights: setupLights,\n\n\t\tpushLight: pushLight,\n\t\tpushShadow: pushShadow\n\t};\n\n}\n\nfunction WebGLRenderStates() {\n\n\tlet renderStates = new WeakMap();\n\n\tfunction onSceneDispose( event ) {\n\n\t\tconst scene = event.target;\n\n\t\tscene.removeEventListener( 'dispose', onSceneDispose );\n\n\t\trenderStates.delete( scene );\n\n\t}\n\n\tfunction get( scene, camera ) {\n\n\t\tlet renderState;\n\n\t\tif ( renderStates.has( scene ) === false ) {\n\n\t\t\trenderState = new WebGLRenderState();\n\t\t\trenderStates.set( scene, new WeakMap() );\n\t\t\trenderStates.get( scene ).set( camera, renderState );\n\n\t\t\tscene.addEventListener( 'dispose', onSceneDispose );\n\n\t\t} else {\n\n\t\t\tif ( renderStates.get( scene ).has( camera ) === false ) {\n\n\t\t\t\trenderState = new WebGLRenderState();\n\t\t\t\trenderStates.get( scene ).set( camera, renderState );\n\n\t\t\t} else {\n\n\t\t\t\trenderState = renderStates.get( scene ).get( camera );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn renderState;\n\n\t}\n\n\tfunction dispose() {\n\n\t\trenderStates = new WeakMap();\n\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tdispose: dispose\n\t};\n\n}\n\n\nexport { WebGLRenderStates };\n","import { Material } from './Material.js';\nimport { BasicDepthPacking } from '../constants.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author bhouston / https://clara.io\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *\n *  opacity: <float>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>,\n *\n *  wireframe: <boolean>,\n *  wireframeLinewidth: <float>\n * }\n */\n\nfunction MeshDepthMaterial( parameters ) {\n\n\tMaterial.call( this );\n\n\tthis.type = 'MeshDepthMaterial';\n\n\tthis.depthPacking = BasicDepthPacking;\n\n\tthis.skinning = false;\n\tthis.morphTargets = false;\n\n\tthis.map = null;\n\n\tthis.alphaMap = null;\n\n\tthis.displacementMap = null;\n\tthis.displacementScale = 1;\n\tthis.displacementBias = 0;\n\n\tthis.wireframe = false;\n\tthis.wireframeLinewidth = 1;\n\n\tthis.fog = false;\n\n\tthis.setValues( parameters );\n\n}\n\nMeshDepthMaterial.prototype = Object.create( Material.prototype );\nMeshDepthMaterial.prototype.constructor = MeshDepthMaterial;\n\nMeshDepthMaterial.prototype.isMeshDepthMaterial = true;\n\nMeshDepthMaterial.prototype.copy = function ( source ) {\n\n\tMaterial.prototype.copy.call( this, source );\n\n\tthis.depthPacking = source.depthPacking;\n\n\tthis.skinning = source.skinning;\n\tthis.morphTargets = source.morphTargets;\n\n\tthis.map = source.map;\n\n\tthis.alphaMap = source.alphaMap;\n\n\tthis.displacementMap = source.displacementMap;\n\tthis.displacementScale = source.displacementScale;\n\tthis.displacementBias = source.displacementBias;\n\n\tthis.wireframe = source.wireframe;\n\tthis.wireframeLinewidth = source.wireframeLinewidth;\n\n\treturn this;\n\n};\n\n\nexport { MeshDepthMaterial };\n","import { Material } from './Material.js';\nimport { Vector3 } from '../math/Vector3.js';\n\n/**\n * @author WestLangley / http://github.com/WestLangley\n *\n * parameters = {\n *\n *  referencePosition: <float>,\n *  nearDistance: <float>,\n *  farDistance: <float>,\n *\n *  skinning: <bool>,\n *  morphTargets: <bool>,\n *\n *  map: new THREE.Texture( <Image> ),\n *\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  displacementMap: new THREE.Texture( <Image> ),\n *  displacementScale: <float>,\n *  displacementBias: <float>\n *\n * }\n */\n\nfunction MeshDistanceMaterial( parameters ) {\n\n\tMaterial.call( this );\n\n\tthis.type = 'MeshDistanceMaterial';\n\n\tthis.referencePosition = new Vector3();\n\tthis.nearDistance = 1;\n\tthis.farDistance = 1000;\n\n\tthis.skinning = false;\n\tthis.morphTargets = false;\n\n\tthis.map = null;\n\n\tthis.alphaMap = null;\n\n\tthis.displacementMap = null;\n\tthis.displacementScale = 1;\n\tthis.displacementBias = 0;\n\n\tthis.fog = false;\n\n\tthis.setValues( parameters );\n\n}\n\nMeshDistanceMaterial.prototype = Object.create( Material.prototype );\nMeshDistanceMaterial.prototype.constructor = MeshDistanceMaterial;\n\nMeshDistanceMaterial.prototype.isMeshDistanceMaterial = true;\n\nMeshDistanceMaterial.prototype.copy = function ( source ) {\n\n\tMaterial.prototype.copy.call( this, source );\n\n\tthis.referencePosition.copy( source.referencePosition );\n\tthis.nearDistance = source.nearDistance;\n\tthis.farDistance = source.farDistance;\n\n\tthis.skinning = source.skinning;\n\tthis.morphTargets = source.morphTargets;\n\n\tthis.map = source.map;\n\n\tthis.alphaMap = source.alphaMap;\n\n\tthis.displacementMap = source.displacementMap;\n\tthis.displacementScale = source.displacementScale;\n\tthis.displacementBias = source.displacementBias;\n\n\treturn this;\n\n};\n\n\nexport { MeshDistanceMaterial };\n","/**\n * @author alteredq / http://alteredqualia.com/\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { FrontSide, BackSide, DoubleSide, RGBAFormat, NearestFilter, LinearFilter, PCFShadowMap, VSMShadowMap, RGBADepthPacking, NoBlending } from '../../constants.js';\nimport { WebGLRenderTarget } from '../WebGLRenderTarget.js';\nimport { MeshDepthMaterial } from '../../materials/MeshDepthMaterial.js';\nimport { MeshDistanceMaterial } from '../../materials/MeshDistanceMaterial.js';\nimport { ShaderMaterial } from '../../materials/ShaderMaterial.js';\nimport { BufferAttribute } from '../../core/BufferAttribute.js';\nimport { BufferGeometry } from '../../core/BufferGeometry.js';\nimport { Mesh } from '../../objects/Mesh.js';\nimport { Vector4 } from '../../math/Vector4.js';\nimport { Vector2 } from '../../math/Vector2.js';\nimport { Frustum } from '../../math/Frustum.js';\n\nimport vsm_frag from '../shaders/ShaderLib/vsm_frag.glsl.js';\nimport vsm_vert from '../shaders/ShaderLib/vsm_vert.glsl.js';\n\nfunction WebGLShadowMap( _renderer, _objects, maxTextureSize ) {\n\n\tlet _frustum = new Frustum();\n\n\tconst _shadowMapSize = new Vector2(),\n\t\t_viewportSize = new Vector2(),\n\n\t\t_viewport = new Vector4(),\n\n\t\t_depthMaterials = [],\n\t\t_distanceMaterials = [],\n\n\t\t_materialCache = {};\n\n\tconst shadowSide = { 0: BackSide, 1: FrontSide, 2: DoubleSide };\n\n\tconst shadowMaterialVertical = new ShaderMaterial( {\n\n\t\tdefines: {\n\t\t\tSAMPLE_RATE: 2.0 / 8.0,\n\t\t\tHALF_SAMPLE_RATE: 1.0 / 8.0\n\t\t},\n\n\t\tuniforms: {\n\t\t\tshadow_pass: { value: null },\n\t\t\tresolution: { value: new Vector2() },\n\t\t\tradius: { value: 4.0 }\n\t\t},\n\n\t\tvertexShader: vsm_vert,\n\n\t\tfragmentShader: vsm_frag\n\n\t} );\n\n\tconst shadowMaterialHorizonal = shadowMaterialVertical.clone();\n\tshadowMaterialHorizonal.defines.HORIZONAL_PASS = 1;\n\n\tconst fullScreenTri = new BufferGeometry();\n\tfullScreenTri.setAttribute(\n\t\t\"position\",\n\t\tnew BufferAttribute(\n\t\t\tnew Float32Array( [ - 1, - 1, 0.5, 3, - 1, 0.5, - 1, 3, 0.5 ] ),\n\t\t\t3\n\t\t)\n\t);\n\n\tconst fullScreenMesh = new Mesh( fullScreenTri, shadowMaterialVertical );\n\n\tconst scope = this;\n\n\tthis.enabled = false;\n\n\tthis.autoUpdate = true;\n\tthis.needsUpdate = false;\n\n\tthis.type = PCFShadowMap;\n\n\tthis.render = function ( lights, scene, camera ) {\n\n\t\tif ( scope.enabled === false ) return;\n\t\tif ( scope.autoUpdate === false && scope.needsUpdate === false ) return;\n\n\t\tif ( lights.length === 0 ) return;\n\n\t\tconst currentRenderTarget = _renderer.getRenderTarget();\n\t\tconst activeCubeFace = _renderer.getActiveCubeFace();\n\t\tconst activeMipmapLevel = _renderer.getActiveMipmapLevel();\n\n\t\tconst _state = _renderer.state;\n\n\t\t// Set GL state for depth map.\n\t\t_state.setBlending( NoBlending );\n\t\t_state.buffers.color.setClear( 1, 1, 1, 1 );\n\t\t_state.buffers.depth.setTest( true );\n\t\t_state.setScissorTest( false );\n\n\t\t// render depth map\n\n\t\tfor ( let i = 0, il = lights.length; i < il; i ++ ) {\n\n\t\t\tconst light = lights[ i ];\n\t\t\tconst shadow = light.shadow;\n\n\t\t\tif ( shadow.autoUpdate === false && shadow.needsUpdate === false ) continue;\n\n\t\t\tif ( shadow === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLShadowMap:', light, 'has no shadow.' );\n\t\t\t\tcontinue;\n\n\t\t\t}\n\n\t\t\t_shadowMapSize.copy( shadow.mapSize );\n\n\t\t\tconst shadowFrameExtents = shadow.getFrameExtents();\n\n\t\t\t_shadowMapSize.multiply( shadowFrameExtents );\n\n\t\t\t_viewportSize.copy( shadow.mapSize );\n\n\t\t\tif ( _shadowMapSize.x > maxTextureSize || _shadowMapSize.y > maxTextureSize ) {\n\n\t\t\t\tif ( _shadowMapSize.x > maxTextureSize ) {\n\n\t\t\t\t\t_viewportSize.x = Math.floor( maxTextureSize / shadowFrameExtents.x );\n\t\t\t\t\t_shadowMapSize.x = _viewportSize.x * shadowFrameExtents.x;\n\t\t\t\t\tshadow.mapSize.x = _viewportSize.x;\n\n\t\t\t\t}\n\n\t\t\t\tif ( _shadowMapSize.y > maxTextureSize ) {\n\n\t\t\t\t\t_viewportSize.y = Math.floor( maxTextureSize / shadowFrameExtents.y );\n\t\t\t\t\t_shadowMapSize.y = _viewportSize.y * shadowFrameExtents.y;\n\t\t\t\t\tshadow.mapSize.y = _viewportSize.y;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( shadow.map === null && ! shadow.isPointLightShadow && this.type === VSMShadowMap ) {\n\n\t\t\t\tconst pars = { minFilter: LinearFilter, magFilter: LinearFilter, format: RGBAFormat };\n\n\t\t\t\tshadow.map = new WebGLRenderTarget( _shadowMapSize.x, _shadowMapSize.y, pars );\n\t\t\t\tshadow.map.texture.name = light.name + \".shadowMap\";\n\n\t\t\t\tshadow.mapPass = new WebGLRenderTarget( _shadowMapSize.x, _shadowMapSize.y, pars );\n\n\t\t\t\tshadow.camera.updateProjectionMatrix();\n\n\t\t\t}\n\n\t\t\tif ( shadow.map === null ) {\n\n\t\t\t\tconst pars = { minFilter: NearestFilter, magFilter: NearestFilter, format: RGBAFormat };\n\n\t\t\t\tshadow.map = new WebGLRenderTarget( _shadowMapSize.x, _shadowMapSize.y, pars );\n\t\t\t\tshadow.map.texture.name = light.name + \".shadowMap\";\n\n\t\t\t\tshadow.camera.updateProjectionMatrix();\n\n\t\t\t}\n\n\t\t\t_renderer.setRenderTarget( shadow.map );\n\t\t\t_renderer.clear();\n\n\t\t\tconst viewportCount = shadow.getViewportCount();\n\n\t\t\tfor ( let vp = 0; vp < viewportCount; vp ++ ) {\n\n\t\t\t\tconst viewport = shadow.getViewport( vp );\n\n\t\t\t\t_viewport.set(\n\t\t\t\t\t_viewportSize.x * viewport.x,\n\t\t\t\t\t_viewportSize.y * viewport.y,\n\t\t\t\t\t_viewportSize.x * viewport.z,\n\t\t\t\t\t_viewportSize.y * viewport.w\n\t\t\t\t);\n\n\t\t\t\t_state.viewport( _viewport );\n\n\t\t\t\tshadow.updateMatrices( light, vp );\n\n\t\t\t\t_frustum = shadow.getFrustum();\n\n\t\t\t\trenderObject( scene, camera, shadow.camera, light, this.type );\n\n\t\t\t}\n\n\t\t\t// do blur pass for VSM\n\n\t\t\tif ( ! shadow.isPointLightShadow && this.type === VSMShadowMap ) {\n\n\t\t\t\tVSMPass( shadow, camera );\n\n\t\t\t}\n\n\t\t\tshadow.needsUpdate = false;\n\n\t\t}\n\n\t\tscope.needsUpdate = false;\n\n\t\t_renderer.setRenderTarget( currentRenderTarget, activeCubeFace, activeMipmapLevel );\n\n\t};\n\n\tfunction VSMPass( shadow, camera ) {\n\n\t\tconst geometry = _objects.update( fullScreenMesh );\n\n\t\t// vertical pass\n\n\t\tshadowMaterialVertical.uniforms.shadow_pass.value = shadow.map.texture;\n\t\tshadowMaterialVertical.uniforms.resolution.value = shadow.mapSize;\n\t\tshadowMaterialVertical.uniforms.radius.value = shadow.radius;\n\t\t_renderer.setRenderTarget( shadow.mapPass );\n\t\t_renderer.clear();\n\t\t_renderer.renderBufferDirect( camera, null, geometry, shadowMaterialVertical, fullScreenMesh, null );\n\n\t\t// horizonal pass\n\n\t\tshadowMaterialHorizonal.uniforms.shadow_pass.value = shadow.mapPass.texture;\n\t\tshadowMaterialHorizonal.uniforms.resolution.value = shadow.mapSize;\n\t\tshadowMaterialHorizonal.uniforms.radius.value = shadow.radius;\n\t\t_renderer.setRenderTarget( shadow.map );\n\t\t_renderer.clear();\n\t\t_renderer.renderBufferDirect( camera, null, geometry, shadowMaterialHorizonal, fullScreenMesh, null );\n\n\t}\n\n\tfunction getDepthMaterialVariant( useMorphing, useSkinning, useInstancing ) {\n\n\t\tconst index = useMorphing << 0 | useSkinning << 1 | useInstancing << 2;\n\n\t\tlet material = _depthMaterials[ index ];\n\n\t\tif ( material === undefined ) {\n\n\t\t\tmaterial = new MeshDepthMaterial( {\n\n\t\t\t\tdepthPacking: RGBADepthPacking,\n\n\t\t\t\tmorphTargets: useMorphing,\n\t\t\t\tskinning: useSkinning\n\n\t\t\t} );\n\n\t\t\t_depthMaterials[ index ] = material;\n\n\t\t}\n\n\t\treturn material;\n\n\t}\n\n\tfunction getDistanceMaterialVariant( useMorphing, useSkinning, useInstancing ) {\n\n\t\tconst index = useMorphing << 0 | useSkinning << 1 | useInstancing << 2;\n\n\t\tlet material = _distanceMaterials[ index ];\n\n\t\tif ( material === undefined ) {\n\n\t\t\tmaterial = new MeshDistanceMaterial( {\n\n\t\t\t\tmorphTargets: useMorphing,\n\t\t\t\tskinning: useSkinning\n\n\t\t\t} );\n\n\t\t\t_distanceMaterials[ index ] = material;\n\n\t\t}\n\n\t\treturn material;\n\n\t}\n\n\tfunction getDepthMaterial( object, geometry, material, light, shadowCameraNear, shadowCameraFar, type ) {\n\n\t\tlet result = null;\n\n\t\tlet getMaterialVariant = getDepthMaterialVariant;\n\t\tlet customMaterial = object.customDepthMaterial;\n\n\t\tif ( light.isPointLight === true ) {\n\n\t\t\tgetMaterialVariant = getDistanceMaterialVariant;\n\t\t\tcustomMaterial = object.customDistanceMaterial;\n\n\t\t}\n\n\t\tif ( customMaterial === undefined ) {\n\n\t\t\tlet useMorphing = false;\n\n\t\t\tif ( material.morphTargets === true ) {\n\n\t\t\t\tuseMorphing = geometry.morphAttributes && geometry.morphAttributes.position && geometry.morphAttributes.position.length > 0;\n\n\t\t\t}\n\n\t\t\tlet useSkinning = false;\n\n\t\t\tif ( object.isSkinnedMesh === true ) {\n\n\t\t\t\tif ( material.skinning === true ) {\n\n\t\t\t\t\tuseSkinning = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:', object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst useInstancing = object.isInstancedMesh === true;\n\n\t\t\tresult = getMaterialVariant( useMorphing, useSkinning, useInstancing );\n\n\t\t} else {\n\n\t\t\tresult = customMaterial;\n\n\t\t}\n\n\t\tif ( _renderer.localClippingEnabled &&\n\t\t\t\tmaterial.clipShadows === true &&\n\t\t\t\tmaterial.clippingPlanes.length !== 0 ) {\n\n\t\t\t// in this case we need a unique material instance reflecting the\n\t\t\t// appropriate state\n\n\t\t\tconst keyA = result.uuid, keyB = material.uuid;\n\n\t\t\tlet materialsForVariant = _materialCache[ keyA ];\n\n\t\t\tif ( materialsForVariant === undefined ) {\n\n\t\t\t\tmaterialsForVariant = {};\n\t\t\t\t_materialCache[ keyA ] = materialsForVariant;\n\n\t\t\t}\n\n\t\t\tlet cachedMaterial = materialsForVariant[ keyB ];\n\n\t\t\tif ( cachedMaterial === undefined ) {\n\n\t\t\t\tcachedMaterial = result.clone();\n\t\t\t\tmaterialsForVariant[ keyB ] = cachedMaterial;\n\n\t\t\t}\n\n\t\t\tresult = cachedMaterial;\n\n\t\t}\n\n\t\tresult.visible = material.visible;\n\t\tresult.wireframe = material.wireframe;\n\n\t\tif ( type === VSMShadowMap ) {\n\n\t\t\tresult.side = ( material.shadowSide !== null ) ? material.shadowSide : material.side;\n\n\t\t} else {\n\n\t\t\tresult.side = ( material.shadowSide !== null ) ? material.shadowSide : shadowSide[ material.side ];\n\n\t\t}\n\n\t\tresult.clipShadows = material.clipShadows;\n\t\tresult.clippingPlanes = material.clippingPlanes;\n\t\tresult.clipIntersection = material.clipIntersection;\n\n\t\tresult.wireframeLinewidth = material.wireframeLinewidth;\n\t\tresult.linewidth = material.linewidth;\n\n\t\tif ( light.isPointLight === true && result.isMeshDistanceMaterial === true ) {\n\n\t\t\tresult.referencePosition.setFromMatrixPosition( light.matrixWorld );\n\t\t\tresult.nearDistance = shadowCameraNear;\n\t\t\tresult.farDistance = shadowCameraFar;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tfunction renderObject( object, camera, shadowCamera, light, type ) {\n\n\t\tif ( object.visible === false ) return;\n\n\t\tconst visible = object.layers.test( camera.layers );\n\n\t\tif ( visible && ( object.isMesh || object.isLine || object.isPoints ) ) {\n\n\t\t\tif ( ( object.castShadow || ( object.receiveShadow && type === VSMShadowMap ) ) && ( ! object.frustumCulled || _frustum.intersectsObject( object ) ) ) {\n\n\t\t\t\tobject.modelViewMatrix.multiplyMatrices( shadowCamera.matrixWorldInverse, object.matrixWorld );\n\n\t\t\t\tconst geometry = _objects.update( object );\n\t\t\t\tconst material = object.material;\n\n\t\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\t\tconst groups = geometry.groups;\n\n\t\t\t\t\tfor ( let k = 0, kl = groups.length; k < kl; k ++ ) {\n\n\t\t\t\t\t\tconst group = groups[ k ];\n\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\n\n\t\t\t\t\t\tif ( groupMaterial && groupMaterial.visible ) {\n\n\t\t\t\t\t\t\tconst depthMaterial = getDepthMaterial( object, geometry, groupMaterial, light, shadowCamera.near, shadowCamera.far, type );\n\n\t\t\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, null, geometry, depthMaterial, object, group );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( material.visible ) {\n\n\t\t\t\t\tconst depthMaterial = getDepthMaterial( object, geometry, material, light, shadowCamera.near, shadowCamera.far, type );\n\n\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, null, geometry, depthMaterial, object, null );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst children = object.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\trenderObject( children[ i ], camera, shadowCamera, light, type );\n\n\t\t}\n\n\t}\n\n}\n\n\nexport { WebGLShadowMap };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { NotEqualDepth, GreaterDepth, GreaterEqualDepth, EqualDepth, LessEqualDepth, LessDepth, AlwaysDepth, NeverDepth, CullFaceFront, CullFaceBack, CullFaceNone, DoubleSide, BackSide, CustomBlending, MultiplyBlending, SubtractiveBlending, AdditiveBlending, NoBlending, NormalBlending, AddEquation, SubtractEquation, ReverseSubtractEquation, MinEquation, MaxEquation, ZeroFactor, OneFactor, SrcColorFactor, SrcAlphaFactor, SrcAlphaSaturateFactor, DstColorFactor, DstAlphaFactor, OneMinusSrcColorFactor, OneMinusSrcAlphaFactor, OneMinusDstColorFactor, OneMinusDstAlphaFactor } from '../../constants.js';\nimport { Vector4 } from '../../math/Vector4.js';\n\nfunction WebGLState( gl, extensions, capabilities ) {\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\n\tfunction ColorBuffer() {\n\n\t\tlet locked = false;\n\n\t\tconst color = new Vector4();\n\t\tlet currentColorMask = null;\n\t\tconst currentColorClear = new Vector4( 0, 0, 0, 0 );\n\n\t\treturn {\n\n\t\t\tsetMask: function ( colorMask ) {\n\n\t\t\t\tif ( currentColorMask !== colorMask && ! locked ) {\n\n\t\t\t\t\tgl.colorMask( colorMask, colorMask, colorMask, colorMask );\n\t\t\t\t\tcurrentColorMask = colorMask;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetLocked: function ( lock ) {\n\n\t\t\t\tlocked = lock;\n\n\t\t\t},\n\n\t\t\tsetClear: function ( r, g, b, a, premultipliedAlpha ) {\n\n\t\t\t\tif ( premultipliedAlpha === true ) {\n\n\t\t\t\t\tr *= a; g *= a; b *= a;\n\n\t\t\t\t}\n\n\t\t\t\tcolor.set( r, g, b, a );\n\n\t\t\t\tif ( currentColorClear.equals( color ) === false ) {\n\n\t\t\t\t\tgl.clearColor( r, g, b, a );\n\t\t\t\t\tcurrentColorClear.copy( color );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\treset: function () {\n\n\t\t\t\tlocked = false;\n\n\t\t\t\tcurrentColorMask = null;\n\t\t\t\tcurrentColorClear.set( - 1, 0, 0, 0 ); // set to invalid state\n\n\t\t\t}\n\n\t\t};\n\n\t}\n\n\tfunction DepthBuffer() {\n\n\t\tlet locked = false;\n\n\t\tlet currentDepthMask = null;\n\t\tlet currentDepthFunc = null;\n\t\tlet currentDepthClear = null;\n\n\t\treturn {\n\n\t\t\tsetTest: function ( depthTest ) {\n\n\t\t\t\tif ( depthTest ) {\n\n\t\t\t\t\tenable( gl.DEPTH_TEST );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdisable( gl.DEPTH_TEST );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetMask: function ( depthMask ) {\n\n\t\t\t\tif ( currentDepthMask !== depthMask && ! locked ) {\n\n\t\t\t\t\tgl.depthMask( depthMask );\n\t\t\t\t\tcurrentDepthMask = depthMask;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetFunc: function ( depthFunc ) {\n\n\t\t\t\tif ( currentDepthFunc !== depthFunc ) {\n\n\t\t\t\t\tif ( depthFunc ) {\n\n\t\t\t\t\t\tswitch ( depthFunc ) {\n\n\t\t\t\t\t\t\tcase NeverDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.NEVER );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase AlwaysDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.ALWAYS );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase LessDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.LESS );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase LessEqualDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase EqualDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.EQUAL );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase GreaterEqualDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.GEQUAL );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase GreaterDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.GREATER );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase NotEqualDepth:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.NOTEQUAL );\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentDepthFunc = depthFunc;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetLocked: function ( lock ) {\n\n\t\t\t\tlocked = lock;\n\n\t\t\t},\n\n\t\t\tsetClear: function ( depth ) {\n\n\t\t\t\tif ( currentDepthClear !== depth ) {\n\n\t\t\t\t\tgl.clearDepth( depth );\n\t\t\t\t\tcurrentDepthClear = depth;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\treset: function () {\n\n\t\t\t\tlocked = false;\n\n\t\t\t\tcurrentDepthMask = null;\n\t\t\t\tcurrentDepthFunc = null;\n\t\t\t\tcurrentDepthClear = null;\n\n\t\t\t}\n\n\t\t};\n\n\t}\n\n\tfunction StencilBuffer() {\n\n\t\tlet locked = false;\n\n\t\tlet currentStencilMask = null;\n\t\tlet currentStencilFunc = null;\n\t\tlet currentStencilRef = null;\n\t\tlet currentStencilFuncMask = null;\n\t\tlet currentStencilFail = null;\n\t\tlet currentStencilZFail = null;\n\t\tlet currentStencilZPass = null;\n\t\tlet currentStencilClear = null;\n\n\t\treturn {\n\n\t\t\tsetTest: function ( stencilTest ) {\n\n\t\t\t\tif ( ! locked ) {\n\n\t\t\t\t\tif ( stencilTest ) {\n\n\t\t\t\t\t\tenable( gl.STENCIL_TEST );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tdisable( gl.STENCIL_TEST );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetMask: function ( stencilMask ) {\n\n\t\t\t\tif ( currentStencilMask !== stencilMask && ! locked ) {\n\n\t\t\t\t\tgl.stencilMask( stencilMask );\n\t\t\t\t\tcurrentStencilMask = stencilMask;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetFunc: function ( stencilFunc, stencilRef, stencilMask ) {\n\n\t\t\t\tif ( currentStencilFunc !== stencilFunc ||\n\t\t\t\t     currentStencilRef \t!== stencilRef \t||\n\t\t\t\t     currentStencilFuncMask !== stencilMask ) {\n\n\t\t\t\t\tgl.stencilFunc( stencilFunc, stencilRef, stencilMask );\n\n\t\t\t\t\tcurrentStencilFunc = stencilFunc;\n\t\t\t\t\tcurrentStencilRef = stencilRef;\n\t\t\t\t\tcurrentStencilFuncMask = stencilMask;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetOp: function ( stencilFail, stencilZFail, stencilZPass ) {\n\n\t\t\t\tif ( currentStencilFail\t !== stencilFail \t||\n\t\t\t\t     currentStencilZFail !== stencilZFail ||\n\t\t\t\t     currentStencilZPass !== stencilZPass ) {\n\n\t\t\t\t\tgl.stencilOp( stencilFail, stencilZFail, stencilZPass );\n\n\t\t\t\t\tcurrentStencilFail = stencilFail;\n\t\t\t\t\tcurrentStencilZFail = stencilZFail;\n\t\t\t\t\tcurrentStencilZPass = stencilZPass;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tsetLocked: function ( lock ) {\n\n\t\t\t\tlocked = lock;\n\n\t\t\t},\n\n\t\t\tsetClear: function ( stencil ) {\n\n\t\t\t\tif ( currentStencilClear !== stencil ) {\n\n\t\t\t\t\tgl.clearStencil( stencil );\n\t\t\t\t\tcurrentStencilClear = stencil;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\treset: function () {\n\n\t\t\t\tlocked = false;\n\n\t\t\t\tcurrentStencilMask = null;\n\t\t\t\tcurrentStencilFunc = null;\n\t\t\t\tcurrentStencilRef = null;\n\t\t\t\tcurrentStencilFuncMask = null;\n\t\t\t\tcurrentStencilFail = null;\n\t\t\t\tcurrentStencilZFail = null;\n\t\t\t\tcurrentStencilZPass = null;\n\t\t\t\tcurrentStencilClear = null;\n\n\t\t\t}\n\n\t\t};\n\n\t}\n\n\t//\n\n\tconst colorBuffer = new ColorBuffer();\n\tconst depthBuffer = new DepthBuffer();\n\tconst stencilBuffer = new StencilBuffer();\n\n\tlet enabledCapabilities = {};\n\n\tlet currentProgram = null;\n\n\tlet currentBlendingEnabled = null;\n\tlet currentBlending = null;\n\tlet currentBlendEquation = null;\n\tlet currentBlendSrc = null;\n\tlet currentBlendDst = null;\n\tlet currentBlendEquationAlpha = null;\n\tlet currentBlendSrcAlpha = null;\n\tlet currentBlendDstAlpha = null;\n\tlet currentPremultipledAlpha = false;\n\n\tlet currentFlipSided = null;\n\tlet currentCullFace = null;\n\n\tlet currentLineWidth = null;\n\n\tlet currentPolygonOffsetFactor = null;\n\tlet currentPolygonOffsetUnits = null;\n\n\tconst maxTextures = gl.getParameter( gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS );\n\n\tlet lineWidthAvailable = false;\n\tlet version = 0;\n\tconst glVersion = gl.getParameter( gl.VERSION );\n\n\tif ( glVersion.indexOf( 'WebGL' ) !== - 1 ) {\n\n\t\tversion = parseFloat( /^WebGL\\ ([0-9])/.exec( glVersion )[ 1 ] );\n\t\tlineWidthAvailable = ( version >= 1.0 );\n\n\t} else if ( glVersion.indexOf( 'OpenGL ES' ) !== - 1 ) {\n\n\t\tversion = parseFloat( /^OpenGL\\ ES\\ ([0-9])/.exec( glVersion )[ 1 ] );\n\t\tlineWidthAvailable = ( version >= 2.0 );\n\n\t}\n\n\tlet currentTextureSlot = null;\n\tlet currentBoundTextures = {};\n\n\tconst currentScissor = new Vector4();\n\tconst currentViewport = new Vector4();\n\n\tfunction createTexture( type, target, count ) {\n\n\t\tconst data = new Uint8Array( 4 ); // 4 is required to match default unpack alignment of 4.\n\t\tconst texture = gl.createTexture();\n\n\t\tgl.bindTexture( type, texture );\n\t\tgl.texParameteri( type, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\n\t\tgl.texParameteri( type, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\n\n\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\tgl.texImage2D( target + i, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, data );\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\tconst emptyTextures = {};\n\temptyTextures[ gl.TEXTURE_2D ] = createTexture( gl.TEXTURE_2D, gl.TEXTURE_2D, 1 );\n\temptyTextures[ gl.TEXTURE_CUBE_MAP ] = createTexture( gl.TEXTURE_CUBE_MAP, gl.TEXTURE_CUBE_MAP_POSITIVE_X, 6 );\n\n\t// init\n\n\tcolorBuffer.setClear( 0, 0, 0, 1 );\n\tdepthBuffer.setClear( 1 );\n\tstencilBuffer.setClear( 0 );\n\n\tenable( gl.DEPTH_TEST );\n\tdepthBuffer.setFunc( LessEqualDepth );\n\n\tsetFlipSided( false );\n\tsetCullFace( CullFaceBack );\n\tenable( gl.CULL_FACE );\n\n\tsetBlending( NoBlending );\n\n\t//\n\n\tfunction enable( id ) {\n\n\t\tif ( enabledCapabilities[ id ] !== true ) {\n\n\t\t\tgl.enable( id );\n\t\t\tenabledCapabilities[ id ] = true;\n\n\t\t}\n\n\t}\n\n\tfunction disable( id ) {\n\n\t\tif ( enabledCapabilities[ id ] !== false ) {\n\n\t\t\tgl.disable( id );\n\t\t\tenabledCapabilities[ id ] = false;\n\n\t\t}\n\n\t}\n\n\tfunction useProgram( program ) {\n\n\t\tif ( currentProgram !== program ) {\n\n\t\t\tgl.useProgram( program );\n\n\t\t\tcurrentProgram = program;\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\tconst equationToGL = {\n\t\t[ AddEquation ]: gl.FUNC_ADD,\n\t\t[ SubtractEquation ]: gl.FUNC_SUBTRACT,\n\t\t[ ReverseSubtractEquation ]: gl.FUNC_REVERSE_SUBTRACT\n\t};\n\n\tif ( isWebGL2 ) {\n\n\t\tequationToGL[ MinEquation ] = gl.MIN;\n\t\tequationToGL[ MaxEquation ] = gl.MAX;\n\n\t} else {\n\n\t\tconst extension = extensions.get( 'EXT_blend_minmax' );\n\n\t\tif ( extension !== null ) {\n\n\t\t\tequationToGL[ MinEquation ] = extension.MIN_EXT;\n\t\t\tequationToGL[ MaxEquation ] = extension.MAX_EXT;\n\n\t\t}\n\n\t}\n\n\tconst factorToGL = {\n\t\t[ ZeroFactor ]: gl.ZERO,\n\t\t[ OneFactor ]: gl.ONE,\n\t\t[ SrcColorFactor ]: gl.SRC_COLOR,\n\t\t[ SrcAlphaFactor ]: gl.SRC_ALPHA,\n\t\t[ SrcAlphaSaturateFactor ]: gl.SRC_ALPHA_SATURATE,\n\t\t[ DstColorFactor ]: gl.DST_COLOR,\n\t\t[ DstAlphaFactor ]: gl.DST_ALPHA,\n\t\t[ OneMinusSrcColorFactor ]: gl.ONE_MINUS_SRC_COLOR,\n\t\t[ OneMinusSrcAlphaFactor ]: gl.ONE_MINUS_SRC_ALPHA,\n\t\t[ OneMinusDstColorFactor ]: gl.ONE_MINUS_DST_COLOR,\n\t\t[ OneMinusDstAlphaFactor ]: gl.ONE_MINUS_DST_ALPHA\n\t};\n\n\tfunction setBlending( blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha, premultipliedAlpha ) {\n\n\t\tif ( blending === NoBlending ) {\n\n\t\t\tif ( currentBlendingEnabled ) {\n\n\t\t\t\tdisable( gl.BLEND );\n\t\t\t\tcurrentBlendingEnabled = false;\n\n\t\t\t}\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( ! currentBlendingEnabled ) {\n\n\t\t\tenable( gl.BLEND );\n\t\t\tcurrentBlendingEnabled = true;\n\n\t\t}\n\n\t\tif ( blending !== CustomBlending ) {\n\n\t\t\tif ( blending !== currentBlending || premultipliedAlpha !== currentPremultipledAlpha ) {\n\n\t\t\t\tif ( currentBlendEquation !== AddEquation || currentBlendEquationAlpha !== AddEquation ) {\n\n\t\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\n\n\t\t\t\t\tcurrentBlendEquation = AddEquation;\n\t\t\t\t\tcurrentBlendEquationAlpha = AddEquation;\n\n\t\t\t\t}\n\n\t\t\t\tif ( premultipliedAlpha ) {\n\n\t\t\t\t\tswitch ( blending ) {\n\n\t\t\t\t\t\tcase NormalBlending:\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase AdditiveBlending:\n\t\t\t\t\t\t\tgl.blendFunc( gl.ONE, gl.ONE );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase SubtractiveBlending:\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.ZERO, gl.ZERO, gl.ONE_MINUS_SRC_COLOR, gl.ONE_MINUS_SRC_ALPHA );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase MultiplyBlending:\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.ZERO, gl.SRC_COLOR, gl.ZERO, gl.SRC_ALPHA );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'THREE.WebGLState: Invalid blending: ', blending );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tswitch ( blending ) {\n\n\t\t\t\t\t\tcase NormalBlending:\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase AdditiveBlending:\n\t\t\t\t\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase SubtractiveBlending:\n\t\t\t\t\t\t\tgl.blendFunc( gl.ZERO, gl.ONE_MINUS_SRC_COLOR );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase MultiplyBlending:\n\t\t\t\t\t\t\tgl.blendFunc( gl.ZERO, gl.SRC_COLOR );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'THREE.WebGLState: Invalid blending: ', blending );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tcurrentBlendSrc = null;\n\t\t\t\tcurrentBlendDst = null;\n\t\t\t\tcurrentBlendSrcAlpha = null;\n\t\t\t\tcurrentBlendDstAlpha = null;\n\n\t\t\t\tcurrentBlending = blending;\n\t\t\t\tcurrentPremultipledAlpha = premultipliedAlpha;\n\n\t\t\t}\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t// custom blending\n\n\t\tblendEquationAlpha = blendEquationAlpha || blendEquation;\n\t\tblendSrcAlpha = blendSrcAlpha || blendSrc;\n\t\tblendDstAlpha = blendDstAlpha || blendDst;\n\n\t\tif ( blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha ) {\n\n\t\t\tgl.blendEquationSeparate( equationToGL[ blendEquation ], equationToGL[ blendEquationAlpha ] );\n\n\t\t\tcurrentBlendEquation = blendEquation;\n\t\t\tcurrentBlendEquationAlpha = blendEquationAlpha;\n\n\t\t}\n\n\t\tif ( blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha ) {\n\n\t\t\tgl.blendFuncSeparate( factorToGL[ blendSrc ], factorToGL[ blendDst ], factorToGL[ blendSrcAlpha ], factorToGL[ blendDstAlpha ] );\n\n\t\t\tcurrentBlendSrc = blendSrc;\n\t\t\tcurrentBlendDst = blendDst;\n\t\t\tcurrentBlendSrcAlpha = blendSrcAlpha;\n\t\t\tcurrentBlendDstAlpha = blendDstAlpha;\n\n\t\t}\n\n\t\tcurrentBlending = blending;\n\t\tcurrentPremultipledAlpha = null;\n\n\t}\n\n\tfunction setMaterial( material, frontFaceCW ) {\n\n\t\tmaterial.side === DoubleSide\n\t\t\t? disable( gl.CULL_FACE )\n\t\t\t: enable( gl.CULL_FACE );\n\n\t\tlet flipSided = ( material.side === BackSide );\n\t\tif ( frontFaceCW ) flipSided = ! flipSided;\n\n\t\tsetFlipSided( flipSided );\n\n\t\t( material.blending === NormalBlending && material.transparent === false )\n\t\t\t? setBlending( NoBlending )\n\t\t\t: setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha, material.premultipliedAlpha );\n\n\t\tdepthBuffer.setFunc( material.depthFunc );\n\t\tdepthBuffer.setTest( material.depthTest );\n\t\tdepthBuffer.setMask( material.depthWrite );\n\t\tcolorBuffer.setMask( material.colorWrite );\n\n\t\tconst stencilWrite = material.stencilWrite;\n\t\tstencilBuffer.setTest( stencilWrite );\n\t\tif ( stencilWrite ) {\n\n\t\t\tstencilBuffer.setMask( material.stencilWriteMask );\n\t\t\tstencilBuffer.setFunc( material.stencilFunc, material.stencilRef, material.stencilFuncMask );\n\t\t\tstencilBuffer.setOp( material.stencilFail, material.stencilZFail, material.stencilZPass );\n\n\t\t}\n\n\t\tsetPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );\n\n\t}\n\n\t//\n\n\tfunction setFlipSided( flipSided ) {\n\n\t\tif ( currentFlipSided !== flipSided ) {\n\n\t\t\tif ( flipSided ) {\n\n\t\t\t\tgl.frontFace( gl.CW );\n\n\t\t\t} else {\n\n\t\t\t\tgl.frontFace( gl.CCW );\n\n\t\t\t}\n\n\t\t\tcurrentFlipSided = flipSided;\n\n\t\t}\n\n\t}\n\n\tfunction setCullFace( cullFace ) {\n\n\t\tif ( cullFace !== CullFaceNone ) {\n\n\t\t\tenable( gl.CULL_FACE );\n\n\t\t\tif ( cullFace !== currentCullFace ) {\n\n\t\t\t\tif ( cullFace === CullFaceBack ) {\n\n\t\t\t\t\tgl.cullFace( gl.BACK );\n\n\t\t\t\t} else if ( cullFace === CullFaceFront ) {\n\n\t\t\t\t\tgl.cullFace( gl.FRONT );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tgl.cullFace( gl.FRONT_AND_BACK );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tdisable( gl.CULL_FACE );\n\n\t\t}\n\n\t\tcurrentCullFace = cullFace;\n\n\t}\n\n\tfunction setLineWidth( width ) {\n\n\t\tif ( width !== currentLineWidth ) {\n\n\t\t\tif ( lineWidthAvailable ) gl.lineWidth( width );\n\n\t\t\tcurrentLineWidth = width;\n\n\t\t}\n\n\t}\n\n\tfunction setPolygonOffset( polygonOffset, factor, units ) {\n\n\t\tif ( polygonOffset ) {\n\n\t\t\tenable( gl.POLYGON_OFFSET_FILL );\n\n\t\t\tif ( currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units ) {\n\n\t\t\t\tgl.polygonOffset( factor, units );\n\n\t\t\t\tcurrentPolygonOffsetFactor = factor;\n\t\t\t\tcurrentPolygonOffsetUnits = units;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tdisable( gl.POLYGON_OFFSET_FILL );\n\n\t\t}\n\n\t}\n\n\tfunction setScissorTest( scissorTest ) {\n\n\t\tif ( scissorTest ) {\n\n\t\t\tenable( gl.SCISSOR_TEST );\n\n\t\t} else {\n\n\t\t\tdisable( gl.SCISSOR_TEST );\n\n\t\t}\n\n\t}\n\n\t// texture\n\n\tfunction activeTexture( webglSlot ) {\n\n\t\tif ( webglSlot === undefined ) webglSlot = gl.TEXTURE0 + maxTextures - 1;\n\n\t\tif ( currentTextureSlot !== webglSlot ) {\n\n\t\t\tgl.activeTexture( webglSlot );\n\t\t\tcurrentTextureSlot = webglSlot;\n\n\t\t}\n\n\t}\n\n\tfunction bindTexture( webglType, webglTexture ) {\n\n\t\tif ( currentTextureSlot === null ) {\n\n\t\t\tactiveTexture();\n\n\t\t}\n\n\t\tlet boundTexture = currentBoundTextures[ currentTextureSlot ];\n\n\t\tif ( boundTexture === undefined ) {\n\n\t\t\tboundTexture = { type: undefined, texture: undefined };\n\t\t\tcurrentBoundTextures[ currentTextureSlot ] = boundTexture;\n\n\t\t}\n\n\t\tif ( boundTexture.type !== webglType || boundTexture.texture !== webglTexture ) {\n\n\t\t\tgl.bindTexture( webglType, webglTexture || emptyTextures[ webglType ] );\n\n\t\t\tboundTexture.type = webglType;\n\t\t\tboundTexture.texture = webglTexture;\n\n\t\t}\n\n\t}\n\n\tfunction unbindTexture() {\n\n\t\tconst boundTexture = currentBoundTextures[ currentTextureSlot ];\n\n\t\tif ( boundTexture !== undefined && boundTexture.type !== undefined ) {\n\n\t\t\tgl.bindTexture( boundTexture.type, null );\n\n\t\t\tboundTexture.type = undefined;\n\t\t\tboundTexture.texture = undefined;\n\n\t\t}\n\n\t}\n\n\tfunction compressedTexImage2D() {\n\n\t\ttry {\n\n\t\t\tgl.compressedTexImage2D.apply( gl, arguments );\n\n\t\t} catch ( error ) {\n\n\t\t\tconsole.error( 'THREE.WebGLState:', error );\n\n\t\t}\n\n\t}\n\n\tfunction texImage2D() {\n\n\t\ttry {\n\n\t\t\tgl.texImage2D.apply( gl, arguments );\n\n\t\t} catch ( error ) {\n\n\t\t\tconsole.error( 'THREE.WebGLState:', error );\n\n\t\t}\n\n\t}\n\n\tfunction texImage3D() {\n\n\t\ttry {\n\n\t\t\tgl.texImage3D.apply( gl, arguments );\n\n\t\t} catch ( error ) {\n\n\t\t\tconsole.error( 'THREE.WebGLState:', error );\n\n\t\t}\n\n\t}\n\n\t//\n\n\tfunction scissor( scissor ) {\n\n\t\tif ( currentScissor.equals( scissor ) === false ) {\n\n\t\t\tgl.scissor( scissor.x, scissor.y, scissor.z, scissor.w );\n\t\t\tcurrentScissor.copy( scissor );\n\n\t\t}\n\n\t}\n\n\tfunction viewport( viewport ) {\n\n\t\tif ( currentViewport.equals( viewport ) === false ) {\n\n\t\t\tgl.viewport( viewport.x, viewport.y, viewport.z, viewport.w );\n\t\t\tcurrentViewport.copy( viewport );\n\n\t\t}\n\n\t}\n\n\t//\n\n\tfunction reset() {\n\n\t\tenabledCapabilities = {};\n\n\t\tcurrentTextureSlot = null;\n\t\tcurrentBoundTextures = {};\n\n\t\tcurrentProgram = null;\n\n\t\tcurrentBlending = null;\n\n\t\tcurrentFlipSided = null;\n\t\tcurrentCullFace = null;\n\n\t\tcolorBuffer.reset();\n\t\tdepthBuffer.reset();\n\t\tstencilBuffer.reset();\n\n\t}\n\n\treturn {\n\n\t\tbuffers: {\n\t\t\tcolor: colorBuffer,\n\t\t\tdepth: depthBuffer,\n\t\t\tstencil: stencilBuffer\n\t\t},\n\n\t\tenable: enable,\n\t\tdisable: disable,\n\n\t\tuseProgram: useProgram,\n\n\t\tsetBlending: setBlending,\n\t\tsetMaterial: setMaterial,\n\n\t\tsetFlipSided: setFlipSided,\n\t\tsetCullFace: setCullFace,\n\n\t\tsetLineWidth: setLineWidth,\n\t\tsetPolygonOffset: setPolygonOffset,\n\n\t\tsetScissorTest: setScissorTest,\n\n\t\tactiveTexture: activeTexture,\n\t\tbindTexture: bindTexture,\n\t\tunbindTexture: unbindTexture,\n\t\tcompressedTexImage2D: compressedTexImage2D,\n\t\ttexImage2D: texImage2D,\n\t\ttexImage3D: texImage3D,\n\n\t\tscissor: scissor,\n\t\tviewport: viewport,\n\n\t\treset: reset\n\n\t};\n\n}\n\nexport { WebGLState };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { LinearFilter, LinearMipmapLinearFilter, LinearMipmapNearestFilter, NearestFilter, NearestMipmapLinearFilter, NearestMipmapNearestFilter, RGBFormat, RGBAFormat, DepthFormat, DepthStencilFormat, UnsignedShortType, UnsignedIntType, UnsignedInt248Type, FloatType, HalfFloatType, MirroredRepeatWrapping, ClampToEdgeWrapping, RepeatWrapping } from '../../constants.js';\nimport { MathUtils } from '../../math/MathUtils.js';\n\nfunction WebGLTextures( _gl, extensions, state, properties, capabilities, utils, info ) {\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\tconst maxTextures = capabilities.maxTextures;\n\tconst maxCubemapSize = capabilities.maxCubemapSize;\n\tconst maxTextureSize = capabilities.maxTextureSize;\n\tconst maxSamples = capabilities.maxSamples;\n\n\tconst _videoTextures = new WeakMap();\n\tlet _canvas;\n\n\t// cordova iOS (as of 5.0) still uses UIWebView, which provides OffscreenCanvas,\n\t// also OffscreenCanvas.getContext(\"webgl\"), but not OffscreenCanvas.getContext(\"2d\")!\n\t// Some implementations may only implement OffscreenCanvas partially (e.g. lacking 2d).\n\n\tlet useOffscreenCanvas = false;\n\n\ttry {\n\n\t\tuseOffscreenCanvas = typeof OffscreenCanvas !== 'undefined'\n\t\t\t&& ( new OffscreenCanvas( 1, 1 ).getContext( \"2d\" ) ) !== null;\n\n\t} catch ( err ) {\n\n\t\t// Ignore any errors\n\n\t}\n\n\tfunction createCanvas( width, height ) {\n\n\t\t// Use OffscreenCanvas when available. Specially needed in web workers\n\n\t\treturn useOffscreenCanvas ?\n\t\t\tnew OffscreenCanvas( width, height ) :\n\t\t\tdocument.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' );\n\n\t}\n\n\tfunction resizeImage( image, needsPowerOfTwo, needsNewCanvas, maxSize ) {\n\n\t\tlet scale = 1;\n\n\t\t// handle case if texture exceeds max size\n\n\t\tif ( image.width > maxSize || image.height > maxSize ) {\n\n\t\t\tscale = maxSize / Math.max( image.width, image.height );\n\n\t\t}\n\n\t\t// only perform resize if necessary\n\n\t\tif ( scale < 1 || needsPowerOfTwo === true ) {\n\n\t\t\t// only perform resize for certain image types\n\n\t\t\tif ( ( typeof HTMLImageElement !== 'undefined' && image instanceof HTMLImageElement ) ||\n\t\t\t\t( typeof HTMLCanvasElement !== 'undefined' && image instanceof HTMLCanvasElement ) ||\n\t\t\t\t( typeof ImageBitmap !== 'undefined' && image instanceof ImageBitmap ) ) {\n\n\t\t\t\tconst floor = needsPowerOfTwo ? MathUtils.floorPowerOfTwo : Math.floor;\n\n\t\t\t\tconst width = floor( scale * image.width );\n\t\t\t\tconst height = floor( scale * image.height );\n\n\t\t\t\tif ( _canvas === undefined ) _canvas = createCanvas( width, height );\n\n\t\t\t\t// cube textures can't reuse the same canvas\n\n\t\t\t\tconst canvas = needsNewCanvas ? createCanvas( width, height ) : _canvas;\n\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\n\t\t\t\tconst context = canvas.getContext( '2d' );\n\t\t\t\tcontext.drawImage( image, 0, 0, width, height );\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture has been resized from (' + image.width + 'x' + image.height + ') to (' + width + 'x' + height + ').' );\n\n\t\t\t\treturn canvas;\n\n\t\t\t} else {\n\n\t\t\t\tif ( 'data' in image ) {\n\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Image in DataTexture is too big (' + image.width + 'x' + image.height + ').' );\n\n\t\t\t\t}\n\n\t\t\t\treturn image;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn image;\n\n\t}\n\n\tfunction isPowerOfTwo( image ) {\n\n\t\treturn MathUtils.isPowerOfTwo( image.width ) && MathUtils.isPowerOfTwo( image.height );\n\n\t}\n\n\tfunction textureNeedsPowerOfTwo( texture ) {\n\n\t\tif ( isWebGL2 ) return false;\n\n\t\treturn ( texture.wrapS !== ClampToEdgeWrapping || texture.wrapT !== ClampToEdgeWrapping ) ||\n\t\t\t( texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter );\n\n\t}\n\n\tfunction textureNeedsGenerateMipmaps( texture, supportsMips ) {\n\n\t\treturn texture.generateMipmaps && supportsMips &&\n\t\t\ttexture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter;\n\n\t}\n\n\tfunction generateMipmap( target, texture, width, height ) {\n\n\t\t_gl.generateMipmap( target );\n\n\t\tconst textureProperties = properties.get( texture );\n\n\t\t// Note: Math.log( x ) * Math.LOG2E used instead of Math.log2( x ) which is not supported by IE11\n\t\ttextureProperties.__maxMipLevel = Math.log( Math.max( width, height ) ) * Math.LOG2E;\n\n\t}\n\n\tfunction getInternalFormat( internalFormatName, glFormat, glType ) {\n\n\t\tif ( isWebGL2 === false ) return glFormat;\n\n\t\tif ( internalFormatName !== null ) {\n\n\t\t\tif ( _gl[ internalFormatName ] !== undefined ) return _gl[ internalFormatName ];\n\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format \\'' + internalFormatName + '\\'' );\n\n\t\t}\n\n\t\tlet internalFormat = glFormat;\n\n\t\tif ( glFormat === _gl.RED ) {\n\n\t\t\tif ( glType === _gl.FLOAT ) internalFormat = _gl.R32F;\n\t\t\tif ( glType === _gl.HALF_FLOAT ) internalFormat = _gl.R16F;\n\t\t\tif ( glType === _gl.UNSIGNED_BYTE ) internalFormat = _gl.R8;\n\n\t\t}\n\n\t\tif ( glFormat === _gl.RGB ) {\n\n\t\t\tif ( glType === _gl.FLOAT ) internalFormat = _gl.RGB32F;\n\t\t\tif ( glType === _gl.HALF_FLOAT ) internalFormat = _gl.RGB16F;\n\t\t\tif ( glType === _gl.UNSIGNED_BYTE ) internalFormat = _gl.RGB8;\n\n\t\t}\n\n\t\tif ( glFormat === _gl.RGBA ) {\n\n\t\t\tif ( glType === _gl.FLOAT ) internalFormat = _gl.RGBA32F;\n\t\t\tif ( glType === _gl.HALF_FLOAT ) internalFormat = _gl.RGBA16F;\n\t\t\tif ( glType === _gl.UNSIGNED_BYTE ) internalFormat = _gl.RGBA8;\n\n\t\t}\n\n\t\tif ( internalFormat === _gl.R16F || internalFormat === _gl.R32F ||\n\t\t\tinternalFormat === _gl.RGBA16F || internalFormat === _gl.RGBA32F ) {\n\n\t\t\textensions.get( 'EXT_color_buffer_float' );\n\n\t\t}\n\n\t\treturn internalFormat;\n\n\t}\n\n\t// Fallback filters for non-power-of-2 textures\n\n\tfunction filterFallback( f ) {\n\n\t\tif ( f === NearestFilter || f === NearestMipmapNearestFilter || f === NearestMipmapLinearFilter ) {\n\n\t\t\treturn _gl.NEAREST;\n\n\t\t}\n\n\t\treturn _gl.LINEAR;\n\n\t}\n\n\t//\n\n\tfunction onTextureDispose( event ) {\n\n\t\tconst texture = event.target;\n\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\n\n\t\tdeallocateTexture( texture );\n\n\t\tif ( texture.isVideoTexture ) {\n\n\t\t\t_videoTextures.delete( texture );\n\n\t\t}\n\n\t\tinfo.memory.textures --;\n\n\t}\n\n\tfunction onRenderTargetDispose( event ) {\n\n\t\tconst renderTarget = event.target;\n\n\t\trenderTarget.removeEventListener( 'dispose', onRenderTargetDispose );\n\n\t\tdeallocateRenderTarget( renderTarget );\n\n\t\tinfo.memory.textures --;\n\n\t}\n\n\t//\n\n\tfunction deallocateTexture( texture ) {\n\n\t\tconst textureProperties = properties.get( texture );\n\n\t\tif ( textureProperties.__webglInit === undefined ) return;\n\n\t\t_gl.deleteTexture( textureProperties.__webglTexture );\n\n\t\tproperties.remove( texture );\n\n\t}\n\n\tfunction deallocateRenderTarget( renderTarget ) {\n\n\t\tconst renderTargetProperties = properties.get( renderTarget );\n\t\tconst textureProperties = properties.get( renderTarget.texture );\n\n\t\tif ( ! renderTarget ) return;\n\n\t\tif ( textureProperties.__webglTexture !== undefined ) {\n\n\t\t\t_gl.deleteTexture( textureProperties.__webglTexture );\n\n\t\t}\n\n\t\tif ( renderTarget.depthTexture ) {\n\n\t\t\trenderTarget.depthTexture.dispose();\n\n\t\t}\n\n\t\tif ( renderTarget.isWebGLCubeRenderTarget ) {\n\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\t_gl.deleteFramebuffer( renderTargetProperties.__webglFramebuffer[ i ] );\n\t\t\t\tif ( renderTargetProperties.__webglDepthbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglDepthbuffer[ i ] );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t_gl.deleteFramebuffer( renderTargetProperties.__webglFramebuffer );\n\t\t\tif ( renderTargetProperties.__webglDepthbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglDepthbuffer );\n\t\t\tif ( renderTargetProperties.__webglMultisampledFramebuffer ) _gl.deleteFramebuffer( renderTargetProperties.__webglMultisampledFramebuffer );\n\t\t\tif ( renderTargetProperties.__webglColorRenderbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglColorRenderbuffer );\n\t\t\tif ( renderTargetProperties.__webglDepthRenderbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglDepthRenderbuffer );\n\n\t\t}\n\n\t\tproperties.remove( renderTarget.texture );\n\t\tproperties.remove( renderTarget );\n\n\t}\n\n\t//\n\n\tlet textureUnits = 0;\n\n\tfunction resetTextureUnits() {\n\n\t\ttextureUnits = 0;\n\n\t}\n\n\tfunction allocateTextureUnit() {\n\n\t\tconst textureUnit = textureUnits;\n\n\t\tif ( textureUnit >= maxTextures ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLTextures: Trying to use ' + textureUnit + ' texture units while this GPU supports only ' + maxTextures );\n\n\t\t}\n\n\t\ttextureUnits += 1;\n\n\t\treturn textureUnit;\n\n\t}\n\n\t//\n\n\tfunction setTexture2D( texture, slot ) {\n\n\t\tconst textureProperties = properties.get( texture );\n\n\t\tif ( texture.isVideoTexture ) updateVideoTexture( texture );\n\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\n\n\t\t\tconst image = texture.image;\n\n\t\t\tif ( image === undefined ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture marked for update but image is undefined' );\n\n\t\t\t} else if ( image.complete === false ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture marked for update but image is incomplete' );\n\n\t\t\t} else {\n\n\t\t\t\tuploadTexture( textureProperties, texture, slot );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t}\n\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\tstate.bindTexture( _gl.TEXTURE_2D, textureProperties.__webglTexture );\n\n\t}\n\n\tfunction setTexture2DArray( texture, slot ) {\n\n\t\tconst textureProperties = properties.get( texture );\n\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\n\n\t\t\tuploadTexture( textureProperties, texture, slot );\n\t\t\treturn;\n\n\t\t}\n\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\tstate.bindTexture( _gl.TEXTURE_2D_ARRAY, textureProperties.__webglTexture );\n\n\t}\n\n\tfunction setTexture3D( texture, slot ) {\n\n\t\tconst textureProperties = properties.get( texture );\n\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\n\n\t\t\tuploadTexture( textureProperties, texture, slot );\n\t\t\treturn;\n\n\t\t}\n\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\tstate.bindTexture( _gl.TEXTURE_3D, textureProperties.__webglTexture );\n\n\t}\n\n\tfunction setTextureCube( texture, slot ) {\n\n\t\tif ( texture.image.length !== 6 ) return;\n\n\t\tconst textureProperties = properties.get( texture );\n\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\n\n\t\t\tinitTexture( textureProperties, texture );\n\n\t\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__webglTexture );\n\n\t\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\n\n\t\t\tconst isCompressed = ( texture && ( texture.isCompressedTexture || texture.image[ 0 ].isCompressedTexture ) );\n\t\t\tconst isDataTexture = ( texture.image[ 0 ] && texture.image[ 0 ].isDataTexture );\n\n\t\t\tconst cubeImage = [];\n\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\tif ( ! isCompressed && ! isDataTexture ) {\n\n\t\t\t\t\tcubeImage[ i ] = resizeImage( texture.image[ i ], false, true, maxCubemapSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tcubeImage[ i ] = isDataTexture ? texture.image[ i ].image : texture.image[ i ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst image = cubeImage[ 0 ],\n\t\t\t\tsupportsMips = isPowerOfTwo( image ) || isWebGL2,\n\t\t\t\tglFormat = utils.convert( texture.format ),\n\t\t\t\tglType = utils.convert( texture.type ),\n\t\t\t\tglInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\n\n\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, texture, supportsMips );\n\n\t\t\tlet mipmaps;\n\n\t\t\tif ( isCompressed ) {\n\n\t\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\t\tmipmaps = cubeImage[ i ].mipmaps;\n\n\t\t\t\t\tfor ( let j = 0; j < mipmaps.length; j ++ ) {\n\n\t\t\t\t\t\tconst mipmap = mipmaps[ j ];\n\n\t\t\t\t\t\tif ( texture.format !== RGBAFormat && texture.format !== RGBFormat ) {\n\n\t\t\t\t\t\t\tif ( glFormat !== null ) {\n\n\t\t\t\t\t\t\t\tstate.compressedTexImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glInternalFormat, mipmap.width, mipmap.height, 0, mipmap.data );\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()' );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glInternalFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\n\n\t\t\t} else {\n\n\t\t\t\tmipmaps = texture.mipmaps;\n\n\t\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\t\tif ( isDataTexture ) {\n\n\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glInternalFormat, cubeImage[ i ].width, cubeImage[ i ].height, 0, glFormat, glType, cubeImage[ i ].data );\n\n\t\t\t\t\t\tfor ( let j = 0; j < mipmaps.length; j ++ ) {\n\n\t\t\t\t\t\t\tconst mipmap = mipmaps[ j ];\n\t\t\t\t\t\t\tconst mipmapImage = mipmap.image[ i ].image;\n\n\t\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j + 1, glInternalFormat, mipmapImage.width, mipmapImage.height, 0, glFormat, glType, mipmapImage.data );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glInternalFormat, glFormat, glType, cubeImage[ i ] );\n\n\t\t\t\t\t\tfor ( let j = 0; j < mipmaps.length; j ++ ) {\n\n\t\t\t\t\t\t\tconst mipmap = mipmaps[ j ];\n\n\t\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j + 1, glInternalFormat, glFormat, glType, mipmap.image[ i ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\ttextureProperties.__maxMipLevel = mipmaps.length;\n\n\t\t\t}\n\n\t\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\n\n\t\t\t\t// We assume images for cube map have the same size.\n\t\t\t\tgenerateMipmap( _gl.TEXTURE_CUBE_MAP, texture, image.width, image.height );\n\n\t\t\t}\n\n\t\t\ttextureProperties.__version = texture.version;\n\n\t\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\n\n\t\t} else {\n\n\t\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__webglTexture );\n\n\t\t}\n\n\t}\n\n\tfunction setTextureCubeDynamic( texture, slot ) {\n\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, properties.get( texture ).__webglTexture );\n\n\t}\n\n\tconst wrappingToGL = {\n\t\t[ RepeatWrapping ]: _gl.REPEAT,\n\t\t[ ClampToEdgeWrapping ]: _gl.CLAMP_TO_EDGE,\n\t\t[ MirroredRepeatWrapping ]: _gl.MIRRORED_REPEAT\n\t};\n\n\tconst filterToGL = {\n\t\t[ NearestFilter ]: _gl.NEAREST,\n\t\t[ NearestMipmapNearestFilter ]: _gl.NEAREST_MIPMAP_NEAREST,\n\t\t[ NearestMipmapLinearFilter ]: _gl.NEAREST_MIPMAP_LINEAR,\n\n\t\t[ LinearFilter ]: _gl.LINEAR,\n\t\t[ LinearMipmapNearestFilter ]: _gl.LINEAR_MIPMAP_NEAREST,\n\t\t[ LinearMipmapLinearFilter ]: _gl.LINEAR_MIPMAP_LINEAR\n\t};\n\n\tfunction setTextureParameters( textureType, texture, supportsMips ) {\n\n\t\tif ( supportsMips ) {\n\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, wrappingToGL[ texture.wrapS ] );\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, wrappingToGL[ texture.wrapT ] );\n\n\t\t\tif ( textureType === _gl.TEXTURE_3D || textureType === _gl.TEXTURE_2D_ARRAY ) {\n\n\t\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_R, wrappingToGL[ texture.wrapR ] );\n\n\t\t\t}\n\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterToGL[ texture.magFilter ] );\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterToGL[ texture.minFilter ] );\n\n\t\t} else {\n\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE );\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE );\n\n\t\t\tif ( textureType === _gl.TEXTURE_3D || textureType === _gl.TEXTURE_2D_ARRAY ) {\n\n\t\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_R, _gl.CLAMP_TO_EDGE );\n\n\t\t\t}\n\n\t\t\tif ( texture.wrapS !== ClampToEdgeWrapping || texture.wrapT !== ClampToEdgeWrapping ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.' );\n\n\t\t\t}\n\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterFallback( texture.magFilter ) );\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterFallback( texture.minFilter ) );\n\n\t\t\tif ( texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter ) {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.' );\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extension = extensions.get( 'EXT_texture_filter_anisotropic' );\n\n\t\tif ( extension ) {\n\n\t\t\tif ( texture.type === FloatType && extensions.get( 'OES_texture_float_linear' ) === null ) return;\n\t\t\tif ( texture.type === HalfFloatType && ( isWebGL2 || extensions.get( 'OES_texture_half_float_linear' ) ) === null ) return;\n\n\t\t\tif ( texture.anisotropy > 1 || properties.get( texture ).__currentAnisotropy ) {\n\n\t\t\t\t_gl.texParameterf( textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min( texture.anisotropy, capabilities.getMaxAnisotropy() ) );\n\t\t\t\tproperties.get( texture ).__currentAnisotropy = texture.anisotropy;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction initTexture( textureProperties, texture ) {\n\n\t\tif ( textureProperties.__webglInit === undefined ) {\n\n\t\t\ttextureProperties.__webglInit = true;\n\n\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\n\n\t\t\ttextureProperties.__webglTexture = _gl.createTexture();\n\n\t\t\tinfo.memory.textures ++;\n\n\t\t}\n\n\t}\n\n\tfunction uploadTexture( textureProperties, texture, slot ) {\n\n\t\tlet textureType = _gl.TEXTURE_2D;\n\n\t\tif ( texture.isDataTexture2DArray ) textureType = _gl.TEXTURE_2D_ARRAY;\n\t\tif ( texture.isDataTexture3D ) textureType = _gl.TEXTURE_3D;\n\n\t\tinitTexture( textureProperties, texture );\n\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\n\t\tstate.bindTexture( textureType, textureProperties.__webglTexture );\n\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha );\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, texture.unpackAlignment );\n\n\t\tconst needsPowerOfTwo = textureNeedsPowerOfTwo( texture ) && isPowerOfTwo( texture.image ) === false;\n\t\tconst image = resizeImage( texture.image, needsPowerOfTwo, false, maxTextureSize );\n\n\t\tconst supportsMips = isPowerOfTwo( image ) || isWebGL2,\n\t\t\tglFormat = utils.convert( texture.format );\n\n\t\tlet glType = utils.convert( texture.type ),\n\t\t\tglInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\n\n\t\tsetTextureParameters( textureType, texture, supportsMips );\n\n\t\tlet mipmap;\n\t\tconst mipmaps = texture.mipmaps;\n\n\t\tif ( texture.isDepthTexture ) {\n\n\t\t\t// populate depth texture with dummy data\n\n\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT;\n\n\t\t\tif ( isWebGL2 ) {\n\n\t\t\t\tif ( texture.type === FloatType ) {\n\n\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT32F;\n\n\t\t\t\t} else if ( texture.type === UnsignedIntType ) {\n\n\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT24;\n\n\t\t\t\t} else if ( texture.type === UnsignedInt248Type ) {\n\n\t\t\t\t\tglInternalFormat = _gl.DEPTH24_STENCIL8;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT16; // WebGL2 requires sized internalformat for glTexImage2D\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( texture.type === FloatType ) {\n\n\t\t\t\t\tconsole.error( 'WebGLRenderer: Floating point depth texture requires WebGL2.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// validation checks for WebGL 1\n\n\t\t\tif ( texture.format === DepthFormat && glInternalFormat === _gl.DEPTH_COMPONENT ) {\n\n\t\t\t\t// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\n\t\t\t\t// DEPTH_COMPONENT and type is not UNSIGNED_SHORT or UNSIGNED_INT\n\t\t\t\t// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\n\t\t\t\tif ( texture.type !== UnsignedShortType && texture.type !== UnsignedIntType ) {\n\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.' );\n\n\t\t\t\t\ttexture.type = UnsignedShortType;\n\t\t\t\t\tglType = utils.convert( texture.type );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( texture.format === DepthStencilFormat && glInternalFormat === _gl.DEPTH_COMPONENT ) {\n\n\t\t\t\t// Depth stencil textures need the DEPTH_STENCIL internal format\n\t\t\t\t// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\n\t\t\t\tglInternalFormat = _gl.DEPTH_STENCIL;\n\n\t\t\t\t// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\n\t\t\t\t// DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.\n\t\t\t\t// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\n\t\t\t\tif ( texture.type !== UnsignedInt248Type ) {\n\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.' );\n\n\t\t\t\t\ttexture.type = UnsignedInt248Type;\n\t\t\t\t\tglType = utils.convert( texture.type );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glInternalFormat, image.width, image.height, 0, glFormat, glType, null );\n\n\t\t} else if ( texture.isDataTexture ) {\n\n\t\t\t// use manually created mipmaps if available\n\t\t\t// if there are no manual mipmaps\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\n\n\t\t\tif ( mipmaps.length > 0 && supportsMips ) {\n\n\t\t\t\tfor ( let i = 0, il = mipmaps.length; i < il; i ++ ) {\n\n\t\t\t\t\tmipmap = mipmaps[ i ];\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glInternalFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\n\n\t\t\t\t}\n\n\t\t\t\ttexture.generateMipmaps = false;\n\t\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\n\n\t\t\t} else {\n\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glInternalFormat, image.width, image.height, 0, glFormat, glType, image.data );\n\t\t\t\ttextureProperties.__maxMipLevel = 0;\n\n\t\t\t}\n\n\t\t} else if ( texture.isCompressedTexture ) {\n\n\t\t\tfor ( let i = 0, il = mipmaps.length; i < il; i ++ ) {\n\n\t\t\t\tmipmap = mipmaps[ i ];\n\n\t\t\t\tif ( texture.format !== RGBAFormat && texture.format !== RGBFormat ) {\n\n\t\t\t\t\tif ( glFormat !== null ) {\n\n\t\t\t\t\t\tstate.compressedTexImage2D( _gl.TEXTURE_2D, i, glInternalFormat, mipmap.width, mipmap.height, 0, mipmap.data );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()' );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glInternalFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\n\n\t\t} else if ( texture.isDataTexture2DArray ) {\n\n\t\t\tstate.texImage3D( _gl.TEXTURE_2D_ARRAY, 0, glInternalFormat, image.width, image.height, image.depth, 0, glFormat, glType, image.data );\n\t\t\ttextureProperties.__maxMipLevel = 0;\n\n\t\t} else if ( texture.isDataTexture3D ) {\n\n\t\t\tstate.texImage3D( _gl.TEXTURE_3D, 0, glInternalFormat, image.width, image.height, image.depth, 0, glFormat, glType, image.data );\n\t\t\ttextureProperties.__maxMipLevel = 0;\n\n\t\t} else {\n\n\t\t\t// regular Texture (image, video, canvas)\n\n\t\t\t// use manually created mipmaps if available\n\t\t\t// if there are no manual mipmaps\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\n\n\t\t\tif ( mipmaps.length > 0 && supportsMips ) {\n\n\t\t\t\tfor ( let i = 0, il = mipmaps.length; i < il; i ++ ) {\n\n\t\t\t\t\tmipmap = mipmaps[ i ];\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glInternalFormat, glFormat, glType, mipmap );\n\n\t\t\t\t}\n\n\t\t\t\ttexture.generateMipmaps = false;\n\t\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\n\n\t\t\t} else {\n\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glInternalFormat, glFormat, glType, image );\n\t\t\t\ttextureProperties.__maxMipLevel = 0;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\n\n\t\t\tgenerateMipmap( textureType, texture, image.width, image.height );\n\n\t\t}\n\n\t\ttextureProperties.__version = texture.version;\n\n\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\n\n\t}\n\n\t// Render targets\n\n\t// Setup storage for target texture and bind it to correct framebuffer\n\tfunction setupFrameBufferTexture( framebuffer, renderTarget, attachment, textureTarget ) {\n\n\t\tconst glFormat = utils.convert( renderTarget.texture.format );\n\t\tconst glType = utils.convert( renderTarget.texture.type );\n\t\tconst glInternalFormat = getInternalFormat( renderTarget.texture.internalFormat, glFormat, glType );\n\t\tstate.texImage2D( textureTarget, 0, glInternalFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );\n\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\n\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, attachment, textureTarget, properties.get( renderTarget.texture ).__webglTexture, 0 );\n\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, null );\n\n\t}\n\n\t// Setup storage for internal depth/stencil buffers and bind to correct framebuffer\n\tfunction setupRenderBufferStorage( renderbuffer, renderTarget, isMultisample ) {\n\n\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderbuffer );\n\n\t\tif ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {\n\n\t\t\tlet glInternalFormat = _gl.DEPTH_COMPONENT16;\n\n\t\t\tif ( isMultisample ) {\n\n\t\t\t\tconst depthTexture = renderTarget.depthTexture;\n\n\t\t\t\tif ( depthTexture && depthTexture.isDepthTexture ) {\n\n\t\t\t\t\tif ( depthTexture.type === FloatType ) {\n\n\t\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT32F;\n\n\t\t\t\t\t} else if ( depthTexture.type === UnsignedIntType ) {\n\n\t\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT24;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\n\n\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, glInternalFormat, renderTarget.width, renderTarget.height );\n\n\t\t\t} else {\n\n\t\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, glInternalFormat, renderTarget.width, renderTarget.height );\n\n\t\t\t}\n\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\n\n\t\t} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\n\n\t\t\tif ( isMultisample ) {\n\n\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\n\n\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, _gl.DEPTH24_STENCIL8, renderTarget.width, renderTarget.height );\n\n\t\t\t} else {\n\n\t\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height );\n\n\t\t\t}\n\n\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\n\n\t\t} else {\n\n\t\t\tconst glFormat = utils.convert( renderTarget.texture.format );\n\t\t\tconst glType = utils.convert( renderTarget.texture.type );\n\t\t\tconst glInternalFormat = getInternalFormat( renderTarget.texture.internalFormat, glFormat, glType );\n\n\t\t\tif ( isMultisample ) {\n\n\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\n\n\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, glInternalFormat, renderTarget.width, renderTarget.height );\n\n\t\t\t} else {\n\n\t\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, glInternalFormat, renderTarget.width, renderTarget.height );\n\n\t\t\t}\n\n\t\t}\n\n\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );\n\n\t}\n\n\t// Setup resources for a Depth Texture for a FBO (needs an extension)\n\tfunction setupDepthTexture( framebuffer, renderTarget ) {\n\n\t\tconst isCube = ( renderTarget && renderTarget.isWebGLCubeRenderTarget );\n\t\tif ( isCube ) throw new Error( 'Depth Texture with cube render targets is not supported' );\n\n\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\n\n\t\tif ( ! ( renderTarget.depthTexture && renderTarget.depthTexture.isDepthTexture ) ) {\n\n\t\t\tthrow new Error( 'renderTarget.depthTexture must be an instance of THREE.DepthTexture' );\n\n\t\t}\n\n\t\t// upload an empty depth texture with framebuffer size\n\t\tif ( ! properties.get( renderTarget.depthTexture ).__webglTexture ||\n\t\t\t\trenderTarget.depthTexture.image.width !== renderTarget.width ||\n\t\t\t\trenderTarget.depthTexture.image.height !== renderTarget.height ) {\n\n\t\t\trenderTarget.depthTexture.image.width = renderTarget.width;\n\t\t\trenderTarget.depthTexture.image.height = renderTarget.height;\n\t\t\trenderTarget.depthTexture.needsUpdate = true;\n\n\t\t}\n\n\t\tsetTexture2D( renderTarget.depthTexture, 0 );\n\n\t\tconst webglDepthTexture = properties.get( renderTarget.depthTexture ).__webglTexture;\n\n\t\tif ( renderTarget.depthTexture.format === DepthFormat ) {\n\n\t\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.TEXTURE_2D, webglDepthTexture, 0 );\n\n\t\t} else if ( renderTarget.depthTexture.format === DepthStencilFormat ) {\n\n\t\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.TEXTURE_2D, webglDepthTexture, 0 );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'Unknown depthTexture format' );\n\n\t\t}\n\n\t}\n\n\t// Setup GL resources for a non-texture depth buffer\n\tfunction setupDepthRenderbuffer( renderTarget ) {\n\n\t\tconst renderTargetProperties = properties.get( renderTarget );\n\n\t\tconst isCube = ( renderTarget.isWebGLCubeRenderTarget === true );\n\n\t\tif ( renderTarget.depthTexture ) {\n\n\t\t\tif ( isCube ) throw new Error( 'target.depthTexture not supported in Cube render targets' );\n\n\t\t\tsetupDepthTexture( renderTargetProperties.__webglFramebuffer, renderTarget );\n\n\t\t} else {\n\n\t\t\tif ( isCube ) {\n\n\t\t\t\trenderTargetProperties.__webglDepthbuffer = [];\n\n\t\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglFramebuffer[ i ] );\n\t\t\t\t\trenderTargetProperties.__webglDepthbuffer[ i ] = _gl.createRenderbuffer();\n\t\t\t\t\tsetupRenderBufferStorage( renderTargetProperties.__webglDepthbuffer[ i ], renderTarget, false );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglFramebuffer );\n\t\t\t\trenderTargetProperties.__webglDepthbuffer = _gl.createRenderbuffer();\n\t\t\t\tsetupRenderBufferStorage( renderTargetProperties.__webglDepthbuffer, renderTarget, false );\n\n\t\t\t}\n\n\t\t}\n\n\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, null );\n\n\t}\n\n\t// Set up GL resources for the render target\n\tfunction setupRenderTarget( renderTarget ) {\n\n\t\tconst renderTargetProperties = properties.get( renderTarget );\n\t\tconst textureProperties = properties.get( renderTarget.texture );\n\n\t\trenderTarget.addEventListener( 'dispose', onRenderTargetDispose );\n\n\t\ttextureProperties.__webglTexture = _gl.createTexture();\n\n\t\tinfo.memory.textures ++;\n\n\t\tconst isCube = ( renderTarget.isWebGLCubeRenderTarget === true );\n\t\tconst isMultisample = ( renderTarget.isWebGLMultisampleRenderTarget === true );\n\t\tconst supportsMips = isPowerOfTwo( renderTarget ) || isWebGL2;\n\n\t\t// Handles WebGL2 RGBFormat fallback - #18858\n\n\t\tif ( isWebGL2 && renderTarget.texture.format === RGBFormat && ( renderTarget.texture.type === FloatType || renderTarget.texture.type === HalfFloatType ) ) {\n\n\t\t\trenderTarget.texture.format = RGBAFormat;\n\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.' );\n\n\t\t}\n\n\t\t// Setup framebuffer\n\n\t\tif ( isCube ) {\n\n\t\t\trenderTargetProperties.__webglFramebuffer = [];\n\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\trenderTargetProperties.__webglFramebuffer[ i ] = _gl.createFramebuffer();\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\trenderTargetProperties.__webglFramebuffer = _gl.createFramebuffer();\n\n\t\t\tif ( isMultisample ) {\n\n\t\t\t\tif ( isWebGL2 ) {\n\n\t\t\t\t\trenderTargetProperties.__webglMultisampledFramebuffer = _gl.createFramebuffer();\n\t\t\t\t\trenderTargetProperties.__webglColorRenderbuffer = _gl.createRenderbuffer();\n\n\t\t\t\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderTargetProperties.__webglColorRenderbuffer );\n\n\t\t\t\t\tconst glFormat = utils.convert( renderTarget.texture.format );\n\t\t\t\t\tconst glType = utils.convert( renderTarget.texture.type );\n\t\t\t\t\tconst glInternalFormat = getInternalFormat( renderTarget.texture.internalFormat, glFormat, glType );\n\t\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\n\t\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, glInternalFormat, renderTarget.width, renderTarget.height );\n\n\t\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglMultisampledFramebuffer );\n\t\t\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, _gl.RENDERBUFFER, renderTargetProperties.__webglColorRenderbuffer );\n\t\t\t\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );\n\n\t\t\t\t\tif ( renderTarget.depthBuffer ) {\n\n\t\t\t\t\t\trenderTargetProperties.__webglDepthRenderbuffer = _gl.createRenderbuffer();\n\t\t\t\t\t\tsetupRenderBufferStorage( renderTargetProperties.__webglDepthRenderbuffer, renderTarget, true );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, null );\n\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Setup color buffer\n\n\t\tif ( isCube ) {\n\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__webglTexture );\n\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, renderTarget.texture, supportsMips );\n\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\t\t\tsetupFrameBufferTexture( renderTargetProperties.__webglFramebuffer[ i ], renderTarget, _gl.COLOR_ATTACHMENT0, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i );\n\n\t\t\t}\n\n\t\t\tif ( textureNeedsGenerateMipmaps( renderTarget.texture, supportsMips ) ) {\n\n\t\t\t\tgenerateMipmap( _gl.TEXTURE_CUBE_MAP, renderTarget.texture, renderTarget.width, renderTarget.height );\n\n\t\t\t}\n\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, null );\n\n\t\t} else {\n\n\t\t\tstate.bindTexture( _gl.TEXTURE_2D, textureProperties.__webglTexture );\n\t\t\tsetTextureParameters( _gl.TEXTURE_2D, renderTarget.texture, supportsMips );\n\t\t\tsetupFrameBufferTexture( renderTargetProperties.__webglFramebuffer, renderTarget, _gl.COLOR_ATTACHMENT0, _gl.TEXTURE_2D );\n\n\t\t\tif ( textureNeedsGenerateMipmaps( renderTarget.texture, supportsMips ) ) {\n\n\t\t\t\tgenerateMipmap( _gl.TEXTURE_2D, renderTarget.texture, renderTarget.width, renderTarget.height );\n\n\t\t\t}\n\n\t\t\tstate.bindTexture( _gl.TEXTURE_2D, null );\n\n\t\t}\n\n\t\t// Setup depth and stencil buffers\n\n\t\tif ( renderTarget.depthBuffer ) {\n\n\t\t\tsetupDepthRenderbuffer( renderTarget );\n\n\t\t}\n\n\t}\n\n\tfunction updateRenderTargetMipmap( renderTarget ) {\n\n\t\tconst texture = renderTarget.texture;\n\t\tconst supportsMips = isPowerOfTwo( renderTarget ) || isWebGL2;\n\n\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\n\n\t\t\tconst target = renderTarget.isWebGLCubeRenderTarget ? _gl.TEXTURE_CUBE_MAP : _gl.TEXTURE_2D;\n\t\t\tconst webglTexture = properties.get( texture ).__webglTexture;\n\n\t\t\tstate.bindTexture( target, webglTexture );\n\t\t\tgenerateMipmap( target, texture, renderTarget.width, renderTarget.height );\n\t\t\tstate.bindTexture( target, null );\n\n\t\t}\n\n\t}\n\n\tfunction updateMultisampleRenderTarget( renderTarget ) {\n\n\t\tif ( renderTarget.isWebGLMultisampleRenderTarget ) {\n\n\t\t\tif ( isWebGL2 ) {\n\n\t\t\t\tconst renderTargetProperties = properties.get( renderTarget );\n\n\t\t\t\t_gl.bindFramebuffer( _gl.READ_FRAMEBUFFER, renderTargetProperties.__webglMultisampledFramebuffer );\n\t\t\t\t_gl.bindFramebuffer( _gl.DRAW_FRAMEBUFFER, renderTargetProperties.__webglFramebuffer );\n\n\t\t\t\tconst width = renderTarget.width;\n\t\t\t\tconst height = renderTarget.height;\n\t\t\t\tlet mask = _gl.COLOR_BUFFER_BIT;\n\n\t\t\t\tif ( renderTarget.depthBuffer ) mask |= _gl.DEPTH_BUFFER_BIT;\n\t\t\t\tif ( renderTarget.stencilBuffer ) mask |= _gl.STENCIL_BUFFER_BIT;\n\n\t\t\t\t_gl.blitFramebuffer( 0, 0, width, height, 0, 0, width, height, mask, _gl.NEAREST );\n\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglMultisampledFramebuffer ); // see #18905\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.' );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction getRenderTargetSamples( renderTarget ) {\n\n\t\treturn ( isWebGL2 && renderTarget.isWebGLMultisampleRenderTarget ) ?\n\t\t\tMath.min( maxSamples, renderTarget.samples ) : 0;\n\n\t}\n\n\tfunction updateVideoTexture( texture ) {\n\n\t\tconst frame = info.render.frame;\n\n\t\t// Check the last frame we updated the VideoTexture\n\n\t\tif ( _videoTextures.get( texture ) !== frame ) {\n\n\t\t\t_videoTextures.set( texture, frame );\n\t\t\ttexture.update();\n\n\t\t}\n\n\t}\n\n\t// backwards compatibility\n\n\tlet warnedTexture2D = false;\n\tlet warnedTextureCube = false;\n\n\tfunction safeSetTexture2D( texture, slot ) {\n\n\t\tif ( texture && texture.isWebGLRenderTarget ) {\n\n\t\t\tif ( warnedTexture2D === false ) {\n\n\t\t\t\tconsole.warn( \"THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead.\" );\n\t\t\t\twarnedTexture2D = true;\n\n\t\t\t}\n\n\t\t\ttexture = texture.texture;\n\n\t\t}\n\n\t\tsetTexture2D( texture, slot );\n\n\t}\n\n\tfunction safeSetTextureCube( texture, slot ) {\n\n\t\tif ( texture && texture.isWebGLCubeRenderTarget ) {\n\n\t\t\tif ( warnedTextureCube === false ) {\n\n\t\t\t\tconsole.warn( \"THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead.\" );\n\t\t\t\twarnedTextureCube = true;\n\n\t\t\t}\n\n\t\t\ttexture = texture.texture;\n\n\t\t}\n\n\t\t// currently relying on the fact that WebGLCubeRenderTarget.texture is a Texture and NOT a CubeTexture\n\t\t// TODO: unify these code paths\n\t\tif ( ( texture && texture.isCubeTexture ) ||\n\t\t\t( Array.isArray( texture.image ) && texture.image.length === 6 ) ) {\n\n\t\t\t// CompressedTexture can have Array in image :/\n\n\t\t\t// this function alone should take care of cube textures\n\t\t\tsetTextureCube( texture, slot );\n\n\t\t} else {\n\n\t\t\t// assumed: texture property of THREE.WebGLCubeRenderTarget\n\t\t\tsetTextureCubeDynamic( texture, slot );\n\n\t\t}\n\n\t}\n\n\t//\n\n\tthis.allocateTextureUnit = allocateTextureUnit;\n\tthis.resetTextureUnits = resetTextureUnits;\n\n\tthis.setTexture2D = setTexture2D;\n\tthis.setTexture2DArray = setTexture2DArray;\n\tthis.setTexture3D = setTexture3D;\n\tthis.setTextureCube = setTextureCube;\n\tthis.setTextureCubeDynamic = setTextureCubeDynamic;\n\tthis.setupRenderTarget = setupRenderTarget;\n\tthis.updateRenderTargetMipmap = updateRenderTargetMipmap;\n\tthis.updateMultisampleRenderTarget = updateMultisampleRenderTarget;\n\n\tthis.safeSetTexture2D = safeSetTexture2D;\n\tthis.safeSetTextureCube = safeSetTextureCube;\n\n}\n\nexport { WebGLTextures };\n","/**\n * @author thespite / http://www.twitter.com/thespite\n */\n\nimport { RGBA_ASTC_4x4_Format, RGBA_ASTC_5x4_Format, RGBA_ASTC_5x5_Format, RGBA_ASTC_6x5_Format, RGBA_ASTC_6x6_Format, RGBA_ASTC_8x5_Format, RGBA_ASTC_8x6_Format, RGBA_ASTC_8x8_Format, RGBA_ASTC_10x5_Format, RGBA_ASTC_10x6_Format, RGBA_ASTC_10x8_Format, RGBA_ASTC_10x10_Format, RGBA_ASTC_12x10_Format, RGBA_ASTC_12x12_Format, RGB_ETC1_Format, RGB_ETC2_Format, RGBA_ETC2_EAC_Format, RGBA_PVRTC_2BPPV1_Format, RGBA_PVRTC_4BPPV1_Format, RGB_PVRTC_2BPPV1_Format, RGB_PVRTC_4BPPV1_Format, RGBA_S3TC_DXT5_Format, RGBA_S3TC_DXT3_Format, RGBA_S3TC_DXT1_Format, RGB_S3TC_DXT1_Format, DepthFormat, DepthStencilFormat, LuminanceAlphaFormat, LuminanceFormat, RedFormat, RGBAFormat, RGBFormat, AlphaFormat, RedIntegerFormat, RGFormat, RGIntegerFormat, RGBIntegerFormat, RGBAIntegerFormat, HalfFloatType, FloatType, UnsignedIntType, IntType, UnsignedShortType, ShortType, ByteType, UnsignedInt248Type, UnsignedShort565Type, UnsignedShort5551Type, UnsignedShort4444Type, UnsignedByteType, SRGB8_ALPHA8_ASTC_4x4_Format, SRGB8_ALPHA8_ASTC_5x4_Format, SRGB8_ALPHA8_ASTC_5x5_Format, SRGB8_ALPHA8_ASTC_6x5_Format, SRGB8_ALPHA8_ASTC_6x6_Format, SRGB8_ALPHA8_ASTC_8x5_Format, SRGB8_ALPHA8_ASTC_8x6_Format, SRGB8_ALPHA8_ASTC_8x8_Format, SRGB8_ALPHA8_ASTC_10x5_Format, SRGB8_ALPHA8_ASTC_10x6_Format, SRGB8_ALPHA8_ASTC_10x8_Format, SRGB8_ALPHA8_ASTC_10x10_Format, SRGB8_ALPHA8_ASTC_12x10_Format, SRGB8_ALPHA8_ASTC_12x12_Format, RGBA_BPTC_Format } from '../../constants.js';\n\nfunction WebGLUtils( gl, extensions, capabilities ) {\n\n\tconst isWebGL2 = capabilities.isWebGL2;\n\n\tfunction convert( p ) {\n\n\t\tlet extension;\n\n\t\tif ( p === UnsignedByteType ) return gl.UNSIGNED_BYTE;\n\t\tif ( p === UnsignedShort4444Type ) return gl.UNSIGNED_SHORT_4_4_4_4;\n\t\tif ( p === UnsignedShort5551Type ) return gl.UNSIGNED_SHORT_5_5_5_1;\n\t\tif ( p === UnsignedShort565Type ) return gl.UNSIGNED_SHORT_5_6_5;\n\n\t\tif ( p === ByteType ) return gl.BYTE;\n\t\tif ( p === ShortType ) return gl.SHORT;\n\t\tif ( p === UnsignedShortType ) return gl.UNSIGNED_SHORT;\n\t\tif ( p === IntType ) return gl.INT;\n\t\tif ( p === UnsignedIntType ) return gl.UNSIGNED_INT;\n\t\tif ( p === FloatType ) return gl.FLOAT;\n\n\t\tif ( p === HalfFloatType ) {\n\n\t\t\tif ( isWebGL2 ) return gl.HALF_FLOAT;\n\n\t\t\textension = extensions.get( 'OES_texture_half_float' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\treturn extension.HALF_FLOAT_OES;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === AlphaFormat ) return gl.ALPHA;\n\t\tif ( p === RGBFormat ) return gl.RGB;\n\t\tif ( p === RGBAFormat ) return gl.RGBA;\n\t\tif ( p === LuminanceFormat ) return gl.LUMINANCE;\n\t\tif ( p === LuminanceAlphaFormat ) return gl.LUMINANCE_ALPHA;\n\t\tif ( p === DepthFormat ) return gl.DEPTH_COMPONENT;\n\t\tif ( p === DepthStencilFormat ) return gl.DEPTH_STENCIL;\n\t\tif ( p === RedFormat ) return gl.RED;\n\n\t\t// WebGL2 formats.\n\n\t\tif ( p === RedIntegerFormat ) return gl.RED_INTEGER;\n\t\tif ( p === RGFormat ) return gl.RG;\n\t\tif ( p === RGIntegerFormat ) return gl.RG_INTEGER;\n\t\tif ( p === RGBIntegerFormat ) return gl.RGB_INTEGER;\n\t\tif ( p === RGBAIntegerFormat ) return gl.RGBA_INTEGER;\n\n\t\tif ( p === RGB_S3TC_DXT1_Format || p === RGBA_S3TC_DXT1_Format ||\n\t\t\tp === RGBA_S3TC_DXT3_Format || p === RGBA_S3TC_DXT5_Format ) {\n\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_s3tc' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\tif ( p === RGB_S3TC_DXT1_Format ) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\n\t\t\t\tif ( p === RGBA_S3TC_DXT1_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\n\t\t\t\tif ( p === RGBA_S3TC_DXT3_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\n\t\t\t\tif ( p === RGBA_S3TC_DXT5_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === RGB_PVRTC_4BPPV1_Format || p === RGB_PVRTC_2BPPV1_Format ||\n\t\t\tp === RGBA_PVRTC_4BPPV1_Format || p === RGBA_PVRTC_2BPPV1_Format ) {\n\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_pvrtc' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\tif ( p === RGB_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\n\t\t\t\tif ( p === RGB_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\n\t\t\t\tif ( p === RGBA_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\n\t\t\t\tif ( p === RGBA_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === RGB_ETC1_Format ) {\n\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_etc1' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\treturn extension.COMPRESSED_RGB_ETC1_WEBGL;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === RGB_ETC2_Format || p === RGBA_ETC2_EAC_Format ) {\n\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_etc' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\tif ( p === RGB_ETC2_Format ) return extension.COMPRESSED_RGB8_ETC2;\n\t\t\t\tif ( p === RGBA_ETC2_EAC_Format ) return extension.COMPRESSED_RGBA8_ETC2_EAC;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === RGBA_ASTC_4x4_Format || p === RGBA_ASTC_5x4_Format || p === RGBA_ASTC_5x5_Format ||\n\t\t\tp === RGBA_ASTC_6x5_Format || p === RGBA_ASTC_6x6_Format || p === RGBA_ASTC_8x5_Format ||\n\t\t\tp === RGBA_ASTC_8x6_Format || p === RGBA_ASTC_8x8_Format || p === RGBA_ASTC_10x5_Format ||\n\t\t\tp === RGBA_ASTC_10x6_Format || p === RGBA_ASTC_10x8_Format || p === RGBA_ASTC_10x10_Format ||\n\t\t\tp === RGBA_ASTC_12x10_Format || p === RGBA_ASTC_12x12_Format ||\n\t\t\tp === SRGB8_ALPHA8_ASTC_4x4_Format || p === SRGB8_ALPHA8_ASTC_5x4_Format || p === SRGB8_ALPHA8_ASTC_5x5_Format ||\n\t\t\tp === SRGB8_ALPHA8_ASTC_6x5_Format || p === SRGB8_ALPHA8_ASTC_6x6_Format || p === SRGB8_ALPHA8_ASTC_8x5_Format ||\n\t\t\tp === SRGB8_ALPHA8_ASTC_8x6_Format || p === SRGB8_ALPHA8_ASTC_8x8_Format || p === SRGB8_ALPHA8_ASTC_10x5_Format ||\n\t\t\tp === SRGB8_ALPHA8_ASTC_10x6_Format || p === SRGB8_ALPHA8_ASTC_10x8_Format || p === SRGB8_ALPHA8_ASTC_10x10_Format ||\n\t\t\tp === SRGB8_ALPHA8_ASTC_12x10_Format || p === SRGB8_ALPHA8_ASTC_12x12_Format ) {\n\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_astc' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\t// TODO Complete?\n\n\t\t\t\treturn p;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === RGBA_BPTC_Format ) {\n\n\t\t\textension = extensions.get( 'EXT_texture_compression_bptc' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\t// TODO Complete?\n\n\t\t\t\treturn p;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( p === UnsignedInt248Type ) {\n\n\t\t\tif ( isWebGL2 ) return gl.UNSIGNED_INT_24_8;\n\n\t\t\textension = extensions.get( 'WEBGL_depth_texture' );\n\n\t\t\tif ( extension !== null ) {\n\n\t\t\t\treturn extension.UNSIGNED_INT_24_8_WEBGL;\n\n\t\t\t} else {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn { convert: convert };\n\n}\n\n\nexport { WebGLUtils };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { PerspectiveCamera } from './PerspectiveCamera.js';\n\nfunction ArrayCamera( array ) {\n\n\tPerspectiveCamera.call( this );\n\n\tthis.cameras = array || [];\n\n}\n\nArrayCamera.prototype = Object.assign( Object.create( PerspectiveCamera.prototype ), {\n\n\tconstructor: ArrayCamera,\n\n\tisArrayCamera: true\n\n} );\n\n\nexport { ArrayCamera };\n","import { Object3D } from '../core/Object3D.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction Group() {\n\n\tObject3D.call( this );\n\n\tthis.type = 'Group';\n\n}\n\nGroup.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Group,\n\n\tisGroup: true\n\n} );\n\n\nexport { Group };\n","import { Group } from '../../objects/Group.js';\n\n/**\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nfunction WebXRController() {\n\n\tthis._targetRay = null;\n\tthis._grip = null;\n\n}\n\nObject.assign( WebXRController.prototype, {\n\n\tconstructor: WebXRController,\n\n\tgetTargetRaySpace: function () {\n\n\t\tif ( this._targetRay === null ) {\n\n\t\t\tthis._targetRay = new Group();\n\t\t\tthis._targetRay.matrixAutoUpdate = false;\n\t\t\tthis._targetRay.visible = false;\n\n\t\t}\n\n\t\treturn this._targetRay;\n\n\t},\n\n\tgetGripSpace: function () {\n\n\t\tif ( this._grip === null ) {\n\n\t\t\tthis._grip = new Group();\n\t\t\tthis._grip.matrixAutoUpdate = false;\n\t\t\tthis._grip.visible = false;\n\n\t\t}\n\n\t\treturn this._grip;\n\n\t},\n\n\tdispatchEvent: function ( event ) {\n\n\t\tif ( this._targetRay !== null ) {\n\n\t\t\tthis._targetRay.dispatchEvent( event );\n\n\t\t}\n\n\t\tif ( this._grip !== null ) {\n\n\t\t\tthis._grip.dispatchEvent( event );\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tdisconnect: function ( inputSource ) {\n\n\t\tthis.dispatchEvent( { type: 'disconnected', data: inputSource } );\n\n\t\tif ( this._targetRay !== null ) {\n\n\t\t\tthis._targetRay.visible = false;\n\n\t\t}\n\n\t\tif ( this._grip !== null ) {\n\n\t\t\tthis._grip.visible = false;\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\tupdate: function ( inputSource, frame, referenceSpace ) {\n\n\t\tlet inputPose = null;\n\t\tlet gripPose = null;\n\n\t\tconst targetRay = this._targetRay;\n\t\tconst grip = this._grip;\n\n\t\tif ( inputSource ) {\n\n\t\t\tif ( targetRay !== null ) {\n\n\t\t\t\tinputPose = frame.getPose( inputSource.targetRaySpace, referenceSpace );\n\n\t\t\t\tif ( inputPose !== null ) {\n\n\t\t\t\t\ttargetRay.matrix.fromArray( inputPose.transform.matrix );\n\t\t\t\t\ttargetRay.matrix.decompose( targetRay.position, targetRay.rotation, targetRay.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( grip !== null && inputSource.gripSpace ) {\n\n\t\t\t\tgripPose = frame.getPose( inputSource.gripSpace, referenceSpace );\n\n\t\t\t\tif ( gripPose !== null ) {\n\n\t\t\t\t\tgrip.matrix.fromArray( gripPose.transform.matrix );\n\t\t\t\t\tgrip.matrix.decompose( grip.position, grip.rotation, grip.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( targetRay !== null ) {\n\n\t\t\ttargetRay.visible = ( inputPose !== null );\n\n\t\t}\n\n\t\tif ( grip !== null ) {\n\n\t\t\tgrip.visible = ( gripPose !== null );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { WebXRController };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { ArrayCamera } from '../../cameras/ArrayCamera.js';\nimport { EventDispatcher } from '../../core/EventDispatcher.js';\nimport { PerspectiveCamera } from '../../cameras/PerspectiveCamera.js';\nimport { Vector3 } from '../../math/Vector3.js';\nimport { Vector4 } from '../../math/Vector4.js';\nimport { WebGLAnimation } from '../webgl/WebGLAnimation.js';\nimport { WebXRController } from './WebXRController.js';\n\nfunction WebXRManager( renderer, gl ) {\n\n\tconst scope = this;\n\n\tlet session = null;\n\n\tlet framebufferScaleFactor = 1.0;\n\n\tlet referenceSpace = null;\n\tlet referenceSpaceType = 'local-floor';\n\n\tlet pose = null;\n\n\tconst controllers = [];\n\tconst inputSourcesMap = new Map();\n\n\t//\n\n\tconst cameraL = new PerspectiveCamera();\n\tcameraL.layers.enable( 1 );\n\tcameraL.viewport = new Vector4();\n\n\tconst cameraR = new PerspectiveCamera();\n\tcameraR.layers.enable( 2 );\n\tcameraR.viewport = new Vector4();\n\n\tconst cameras = [ cameraL, cameraR ];\n\n\tconst cameraVR = new ArrayCamera();\n\tcameraVR.layers.enable( 1 );\n\tcameraVR.layers.enable( 2 );\n\n\tlet _currentDepthNear = null;\n\tlet _currentDepthFar = null;\n\n\t//\n\n\tthis.enabled = false;\n\n\tthis.isPresenting = false;\n\n\tthis.getController = function ( index ) {\n\n\t\tlet controller = controllers[ index ];\n\n\t\tif ( controller === undefined ) {\n\n\t\t\tcontroller = new WebXRController();\n\t\t\tcontrollers[ index ] = controller;\n\n\t\t}\n\n\t\treturn controller.getTargetRaySpace();\n\n\t};\n\n\tthis.getControllerGrip = function ( index ) {\n\n\t\tlet controller = controllers[ index ];\n\n\t\tif ( controller === undefined ) {\n\n\t\t\tcontroller = new WebXRController();\n\t\t\tcontrollers[ index ] = controller;\n\n\t\t}\n\n\t\treturn controller.getGripSpace();\n\n\t};\n\n\t//\n\n\tfunction onSessionEvent( event ) {\n\n\t\tconst controller = inputSourcesMap.get( event.inputSource );\n\n\t\tif ( controller ) {\n\n\t\t\tcontroller.dispatchEvent( { type: event.type } );\n\n\t\t}\n\n\t}\n\n\tfunction onSessionEnd() {\n\n\t\tinputSourcesMap.forEach( function ( controller, inputSource ) {\n\n\t\t\tcontroller.disconnect( inputSource );\n\n\t\t} );\n\n\t\tinputSourcesMap.clear();\n\n\t\t//\n\n\t\trenderer.setFramebuffer( null );\n\t\trenderer.setRenderTarget( renderer.getRenderTarget() ); // Hack #15830\n\t\tanimation.stop();\n\n\t\tscope.isPresenting = false;\n\n\t\tscope.dispatchEvent( { type: 'sessionend' } );\n\n\t}\n\n\tfunction onRequestReferenceSpace( value ) {\n\n\t\treferenceSpace = value;\n\n\t\tanimation.setContext( session );\n\t\tanimation.start();\n\n\t\tscope.isPresenting = true;\n\n\t\tscope.dispatchEvent( { type: 'sessionstart' } );\n\n\t}\n\n\tthis.setFramebufferScaleFactor = function ( value ) {\n\n\t\tframebufferScaleFactor = value;\n\n\t\tif ( scope.isPresenting === true ) {\n\n\t\t\tconsole.warn( 'THREE.WebXRManager: Cannot change framebuffer scale while presenting.' );\n\n\t\t}\n\n\t};\n\n\tthis.setReferenceSpaceType = function ( value ) {\n\n\t\treferenceSpaceType = value;\n\n\t\tif ( scope.isPresenting === true ) {\n\n\t\t\tconsole.warn( 'THREE.WebXRManager: Cannot change reference space type while presenting.' );\n\n\t\t}\n\n\t};\n\n\tthis.getReferenceSpace = function () {\n\n\t\treturn referenceSpace;\n\n\t};\n\n\tthis.getSession = function () {\n\n\t\treturn session;\n\n\t};\n\n\tthis.setSession = function ( value ) {\n\n\t\tsession = value;\n\n\t\tif ( session !== null ) {\n\n\t\t\tsession.addEventListener( 'select', onSessionEvent );\n\t\t\tsession.addEventListener( 'selectstart', onSessionEvent );\n\t\t\tsession.addEventListener( 'selectend', onSessionEvent );\n\t\t\tsession.addEventListener( 'squeeze', onSessionEvent );\n\t\t\tsession.addEventListener( 'squeezestart', onSessionEvent );\n\t\t\tsession.addEventListener( 'squeezeend', onSessionEvent );\n\t\t\tsession.addEventListener( 'end', onSessionEnd );\n\n\t\t\tconst attributes = gl.getContextAttributes();\n\n\t\t\tif ( attributes.xrCompatible !== true ) {\n\n\t\t\t\tgl.makeXRCompatible();\n\n\t\t\t}\n\n\t\t\tconst layerInit = {\n\t\t\t\tantialias: attributes.antialias,\n\t\t\t\talpha: attributes.alpha,\n\t\t\t\tdepth: attributes.depth,\n\t\t\t\tstencil: attributes.stencil,\n\t\t\t\tframebufferScaleFactor: framebufferScaleFactor\n\t\t\t};\n\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tconst baseLayer = new XRWebGLLayer( session, gl, layerInit );\n\n\t\t\tsession.updateRenderState( { baseLayer: baseLayer } );\n\n\t\t\tsession.requestReferenceSpace( referenceSpaceType ).then( onRequestReferenceSpace );\n\n\t\t\t//\n\n\t\t\tsession.addEventListener( 'inputsourceschange', updateInputSources );\n\n\t\t}\n\n\t};\n\n\tfunction updateInputSources( event ) {\n\n\t\tconst inputSources = session.inputSources;\n\n\t\t// Assign inputSources to available controllers\n\n\t\tfor ( let i = 0; i < controllers.length; i ++ ) {\n\n\t\t\tinputSourcesMap.set( inputSources[ i ], controllers[ i ] );\n\n\t\t}\n\n\t\t// Notify disconnected\n\n\t\tfor ( let i = 0; i < event.removed.length; i ++ ) {\n\n\t\t\tconst inputSource = event.removed[ i ];\n\t\t\tconst controller = inputSourcesMap.get( inputSource );\n\n\t\t\tif ( controller ) {\n\n\t\t\t\tcontroller.dispatchEvent( { type: 'disconnected', data: inputSource } );\n\t\t\t\tinputSourcesMap.delete( inputSource );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Notify connected\n\n\t\tfor ( let i = 0; i < event.added.length; i ++ ) {\n\n\t\t\tconst inputSource = event.added[ i ];\n\t\t\tconst controller = inputSourcesMap.get( inputSource );\n\n\t\t\tif ( controller ) {\n\n\t\t\t\tcontroller.dispatchEvent( { type: 'connected', data: inputSource } );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t//\n\n\tconst cameraLPos = new Vector3();\n\tconst cameraRPos = new Vector3();\n\n\t/**\n\t * @author jsantell / https://www.jsantell.com/\n\t *\n\t * Assumes 2 cameras that are parallel and share an X-axis, and that\n\t * the cameras' projection and world matrices have already been set.\n\t * And that near and far planes are identical for both cameras.\n\t * Visualization of this technique: https://computergraphics.stackexchange.com/a/4765\n\t */\n\tfunction setProjectionFromUnion( camera, cameraL, cameraR ) {\n\n\t\tcameraLPos.setFromMatrixPosition( cameraL.matrixWorld );\n\t\tcameraRPos.setFromMatrixPosition( cameraR.matrixWorld );\n\n\t\tconst ipd = cameraLPos.distanceTo( cameraRPos );\n\n\t\tconst projL = cameraL.projectionMatrix.elements;\n\t\tconst projR = cameraR.projectionMatrix.elements;\n\n\t\t// VR systems will have identical far and near planes, and\n\t\t// most likely identical top and bottom frustum extents.\n\t\t// Use the left camera for these values.\n\t\tconst near = projL[ 14 ] / ( projL[ 10 ] - 1 );\n\t\tconst far = projL[ 14 ] / ( projL[ 10 ] + 1 );\n\t\tconst topFov = ( projL[ 9 ] + 1 ) / projL[ 5 ];\n\t\tconst bottomFov = ( projL[ 9 ] - 1 ) / projL[ 5 ];\n\n\t\tconst leftFov = ( projL[ 8 ] - 1 ) / projL[ 0 ];\n\t\tconst rightFov = ( projR[ 8 ] + 1 ) / projR[ 0 ];\n\t\tconst left = near * leftFov;\n\t\tconst right = near * rightFov;\n\n\t\t// Calculate the new camera's position offset from the\n\t\t// left camera. xOffset should be roughly half `ipd`.\n\t\tconst zOffset = ipd / ( - leftFov + rightFov );\n\t\tconst xOffset = zOffset * - leftFov;\n\n\t\t// TODO: Better way to apply this offset?\n\t\tcameraL.matrixWorld.decompose( camera.position, camera.quaternion, camera.scale );\n\t\tcamera.translateX( xOffset );\n\t\tcamera.translateZ( zOffset );\n\t\tcamera.matrixWorld.compose( camera.position, camera.quaternion, camera.scale );\n\t\tcamera.matrixWorldInverse.getInverse( camera.matrixWorld );\n\n\t\t// Find the union of the frustum values of the cameras and scale\n\t\t// the values so that the near plane's position does not change in world space,\n\t\t// although must now be relative to the new union camera.\n\t\tconst near2 = near + zOffset;\n\t\tconst far2 = far + zOffset;\n\t\tconst left2 = left - xOffset;\n\t\tconst right2 = right + ( ipd - xOffset );\n\t\tconst top2 = topFov * far / far2 * near2;\n\t\tconst bottom2 = bottomFov * far / far2 * near2;\n\n\t\tcamera.projectionMatrix.makePerspective( left2, right2, top2, bottom2, near2, far2 );\n\n\t}\n\n\tfunction updateCamera( camera, parent ) {\n\n\t\tif ( parent === null ) {\n\n\t\t\tcamera.matrixWorld.copy( camera.matrix );\n\n\t\t} else {\n\n\t\t\tcamera.matrixWorld.multiplyMatrices( parent.matrixWorld, camera.matrix );\n\n\t\t}\n\n\t\tcamera.matrixWorldInverse.getInverse( camera.matrixWorld );\n\n\t}\n\n\tthis.getCamera = function ( camera ) {\n\n\t\tcameraVR.near = cameraR.near = cameraL.near = camera.near;\n\t\tcameraVR.far = cameraR.far = cameraL.far = camera.far;\n\n\t\tif ( _currentDepthNear !== cameraVR.near || _currentDepthFar !== cameraVR.far ) {\n\n\t\t\t// Note that the new renderState won't apply until the next frame. See #18320\n\n\t\t\tsession.updateRenderState( {\n\t\t\t\tdepthNear: cameraVR.near,\n\t\t\t\tdepthFar: cameraVR.far\n\t\t\t} );\n\n\t\t\t_currentDepthNear = cameraVR.near;\n\t\t\t_currentDepthFar = cameraVR.far;\n\n\t\t}\n\n\t\tconst parent = camera.parent;\n\t\tconst cameras = cameraVR.cameras;\n\n\t\tupdateCamera( cameraVR, parent );\n\n\t\tfor ( let i = 0; i < cameras.length; i ++ ) {\n\n\t\t\tupdateCamera( cameras[ i ], parent );\n\n\t\t}\n\n\t\t// update camera and its children\n\n\t\tcamera.matrixWorld.copy( cameraVR.matrixWorld );\n\n\t\tconst children = camera.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tchildren[ i ].updateMatrixWorld( true );\n\n\t\t}\n\n\t\t// update projection matrix for proper view frustum culling\n\n\t\tif ( cameras.length === 2 ) {\n\n\t\t\tsetProjectionFromUnion( cameraVR, cameraL, cameraR );\n\n\t\t} else {\n\n\t\t\t// assume single camera setup (AR)\n\n\t\t\tcameraVR.projectionMatrix.copy( cameraL.projectionMatrix );\n\n\t\t}\n\n\t\treturn cameraVR;\n\n\t};\n\n\t// Animation Loop\n\n\tlet onAnimationFrameCallback = null;\n\n\tfunction onAnimationFrame( time, frame ) {\n\n\t\tpose = frame.getViewerPose( referenceSpace );\n\n\t\tif ( pose !== null ) {\n\n\t\t\tconst views = pose.views;\n\t\t\tconst baseLayer = session.renderState.baseLayer;\n\n\t\t\trenderer.setFramebuffer( baseLayer.framebuffer );\n\n\t\t\tlet cameraVRNeedsUpdate = false;\n\n\t\t\t// check if it's necessary to rebuild cameraVR's camera list\n\n\t\t\tif ( views.length !== cameraVR.cameras.length ) {\n\n\t\t\t\tcameraVR.cameras.length = 0;\n\t\t\t\tcameraVRNeedsUpdate = true;\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0; i < views.length; i ++ ) {\n\n\t\t\t\tconst view = views[ i ];\n\t\t\t\tconst viewport = baseLayer.getViewport( view );\n\n\t\t\t\tconst camera = cameras[ i ];\n\t\t\t\tcamera.matrix.fromArray( view.transform.matrix );\n\t\t\t\tcamera.projectionMatrix.fromArray( view.projectionMatrix );\n\t\t\t\tcamera.viewport.set( viewport.x, viewport.y, viewport.width, viewport.height );\n\n\t\t\t\tif ( i === 0 ) {\n\n\t\t\t\t\tcameraVR.matrix.copy( camera.matrix );\n\n\t\t\t\t}\n\n\t\t\t\tif ( cameraVRNeedsUpdate === true ) {\n\n\t\t\t\t\tcameraVR.cameras.push( camera );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst inputSources = session.inputSources;\n\n\t\tfor ( let i = 0; i < controllers.length; i ++ ) {\n\n\t\t\tconst controller = controllers[ i ];\n\t\t\tconst inputSource = inputSources[ i ];\n\n\t\t\tcontroller.update( inputSource, frame, referenceSpace );\n\n\t\t}\n\n\t\tif ( onAnimationFrameCallback ) onAnimationFrameCallback( time, frame );\n\n\t}\n\n\tconst animation = new WebGLAnimation();\n\tanimation.setAnimationLoop( onAnimationFrame );\n\n\tthis.setAnimationLoop = function ( callback ) {\n\n\t\tonAnimationFrameCallback = callback;\n\n\t};\n\n\tthis.dispose = function () {};\n\n}\n\nObject.assign( WebXRManager.prototype, EventDispatcher.prototype );\n\nexport { WebXRManager };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { BackSide } from \"../../constants.js\";\n\nfunction WebGLMaterials( properties ) {\n\n\tfunction refreshFogUniforms( uniforms, fog ) {\n\n\t\tuniforms.fogColor.value.copy( fog.color );\n\n\t\tif ( fog.isFog ) {\n\n\t\t\tuniforms.fogNear.value = fog.near;\n\t\t\tuniforms.fogFar.value = fog.far;\n\n\t\t} else if ( fog.isFogExp2 ) {\n\n\t\t\tuniforms.fogDensity.value = fog.density;\n\n\t\t}\n\n\t}\n\n\tfunction refreshMaterialUniforms( uniforms, material, environment, pixelRatio, height ) {\n\n\t\tif ( material.isMeshBasicMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\n\t\t} else if ( material.isMeshLambertMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsLambert( uniforms, material );\n\n\t\t} else if ( material.isMeshToonMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsToon( uniforms, material );\n\n\t\t} else if ( material.isMeshPhongMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsPhong( uniforms, material );\n\n\t\t} else if ( material.isMeshStandardMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material, environment );\n\n\t\t\tif ( material.isMeshPhysicalMaterial ) {\n\n\t\t\t\trefreshUniformsPhysical( uniforms, material, environment );\n\n\t\t\t} else {\n\n\t\t\t\trefreshUniformsStandard( uniforms, material, environment );\n\n\t\t\t}\n\n\t\t} else if ( material.isMeshMatcapMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsMatcap( uniforms, material );\n\n\t\t} else if ( material.isMeshDepthMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsDepth( uniforms, material );\n\n\t\t} else if ( material.isMeshDistanceMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsDistance( uniforms, material );\n\n\t\t} else if ( material.isMeshNormalMaterial ) {\n\n\t\t\trefreshUniformsCommon( uniforms, material );\n\t\t\trefreshUniformsNormal( uniforms, material );\n\n\t\t} else if ( material.isLineBasicMaterial ) {\n\n\t\t\trefreshUniformsLine( uniforms, material );\n\n\t\t\tif ( material.isLineDashedMaterial ) {\n\n\t\t\t\trefreshUniformsDash( uniforms, material );\n\n\t\t\t}\n\n\t\t} else if ( material.isPointsMaterial ) {\n\n\t\t\trefreshUniformsPoints( uniforms, material, pixelRatio, height );\n\n\t\t} else if ( material.isSpriteMaterial ) {\n\n\t\t\trefreshUniformsSprites( uniforms, material );\n\n\t\t} else if ( material.isShadowMaterial ) {\n\n\t\t\tuniforms.color.value.copy( material.color );\n\t\t\tuniforms.opacity.value = material.opacity;\n\n\t\t} else if ( material.isShaderMaterial ) {\n\n\t\t\tmaterial.uniformsNeedUpdate = false; // #15581\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsCommon( uniforms, material, environment ) {\n\n\t\tuniforms.opacity.value = material.opacity;\n\n\t\tif ( material.color ) {\n\n\t\t\tuniforms.diffuse.value.copy( material.color );\n\n\t\t}\n\n\t\tif ( material.emissive ) {\n\n\t\t\tuniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\n\n\t\t}\n\n\t\tif ( material.map ) {\n\n\t\t\tuniforms.map.value = material.map;\n\n\t\t}\n\n\t\tif ( material.alphaMap ) {\n\n\t\t\tuniforms.alphaMap.value = material.alphaMap;\n\n\t\t}\n\n\t\tif ( material.specularMap ) {\n\n\t\t\tuniforms.specularMap.value = material.specularMap;\n\n\t\t}\n\n\t\tconst envMap = material.envMap || environment;\n\n\t\tif ( envMap ) {\n\n\t\t\tuniforms.envMap.value = envMap;\n\n\t\t\tuniforms.flipEnvMap.value = envMap.isCubeTexture ? - 1 : 1;\n\n\t\t\tuniforms.reflectivity.value = material.reflectivity;\n\t\t\tuniforms.refractionRatio.value = material.refractionRatio;\n\n\t\t\tuniforms.maxMipLevel.value = properties.get( envMap ).__maxMipLevel;\n\n\t\t}\n\n\t\tif ( material.lightMap ) {\n\n\t\t\tuniforms.lightMap.value = material.lightMap;\n\t\t\tuniforms.lightMapIntensity.value = material.lightMapIntensity;\n\n\t\t}\n\n\t\tif ( material.aoMap ) {\n\n\t\t\tuniforms.aoMap.value = material.aoMap;\n\t\t\tuniforms.aoMapIntensity.value = material.aoMapIntensity;\n\n\t\t}\n\n\t\t// uv repeat and offset setting priorities\n\t\t// 1. color map\n\t\t// 2. specular map\n\t\t// 3. normal map\n\t\t// 4. bump map\n\t\t// 5. alpha map\n\t\t// 6. emissive map\n\n\t\tlet uvScaleMap;\n\n\t\tif ( material.map ) {\n\n\t\t\tuvScaleMap = material.map;\n\n\t\t} else if ( material.specularMap ) {\n\n\t\t\tuvScaleMap = material.specularMap;\n\n\t\t} else if ( material.displacementMap ) {\n\n\t\t\tuvScaleMap = material.displacementMap;\n\n\t\t} else if ( material.normalMap ) {\n\n\t\t\tuvScaleMap = material.normalMap;\n\n\t\t} else if ( material.bumpMap ) {\n\n\t\t\tuvScaleMap = material.bumpMap;\n\n\t\t} else if ( material.roughnessMap ) {\n\n\t\t\tuvScaleMap = material.roughnessMap;\n\n\t\t} else if ( material.metalnessMap ) {\n\n\t\t\tuvScaleMap = material.metalnessMap;\n\n\t\t} else if ( material.alphaMap ) {\n\n\t\t\tuvScaleMap = material.alphaMap;\n\n\t\t} else if ( material.emissiveMap ) {\n\n\t\t\tuvScaleMap = material.emissiveMap;\n\n\t\t}\n\n\t\tif ( uvScaleMap !== undefined ) {\n\n\t\t\t// backwards compatibility\n\t\t\tif ( uvScaleMap.isWebGLRenderTarget ) {\n\n\t\t\t\tuvScaleMap = uvScaleMap.texture;\n\n\t\t\t}\n\n\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\n\n\t\t\t\tuvScaleMap.updateMatrix();\n\n\t\t\t}\n\n\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\n\n\t\t}\n\n\t\t// uv repeat and offset setting priorities for uv2\n\t\t// 1. ao map\n\t\t// 2. light map\n\n\t\tlet uv2ScaleMap;\n\n\t\tif ( material.aoMap ) {\n\n\t\t\tuv2ScaleMap = material.aoMap;\n\n\t\t} else if ( material.lightMap ) {\n\n\t\t\tuv2ScaleMap = material.lightMap;\n\n\t\t}\n\n\t\tif ( uv2ScaleMap !== undefined ) {\n\n\t\t\t// backwards compatibility\n\t\t\tif ( uv2ScaleMap.isWebGLRenderTarget ) {\n\n\t\t\t\tuv2ScaleMap = uv2ScaleMap.texture;\n\n\t\t\t}\n\n\t\t\tif ( uv2ScaleMap.matrixAutoUpdate === true ) {\n\n\t\t\t\tuv2ScaleMap.updateMatrix();\n\n\t\t\t}\n\n\t\t\tuniforms.uv2Transform.value.copy( uv2ScaleMap.matrix );\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsLine( uniforms, material ) {\n\n\t\tuniforms.diffuse.value.copy( material.color );\n\t\tuniforms.opacity.value = material.opacity;\n\n\t}\n\n\tfunction refreshUniformsDash( uniforms, material ) {\n\n\t\tuniforms.dashSize.value = material.dashSize;\n\t\tuniforms.totalSize.value = material.dashSize + material.gapSize;\n\t\tuniforms.scale.value = material.scale;\n\n\t}\n\n\tfunction refreshUniformsPoints( uniforms, material, pixelRatio, height ) {\n\n\t\tuniforms.diffuse.value.copy( material.color );\n\t\tuniforms.opacity.value = material.opacity;\n\t\tuniforms.size.value = material.size * pixelRatio;\n\t\tuniforms.scale.value = height * 0.5;\n\n\t\tif ( material.map ) {\n\n\t\t\tuniforms.map.value = material.map;\n\n\t\t}\n\n\t\tif ( material.alphaMap ) {\n\n\t\t\tuniforms.alphaMap.value = material.alphaMap;\n\n\t\t}\n\n\t\t// uv repeat and offset setting priorities\n\t\t// 1. color map\n\t\t// 2. alpha map\n\n\t\tlet uvScaleMap;\n\n\t\tif ( material.map ) {\n\n\t\t\tuvScaleMap = material.map;\n\n\t\t} else if ( material.alphaMap ) {\n\n\t\t\tuvScaleMap = material.alphaMap;\n\n\t\t}\n\n\t\tif ( uvScaleMap !== undefined ) {\n\n\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\n\n\t\t\t\tuvScaleMap.updateMatrix();\n\n\t\t\t}\n\n\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsSprites( uniforms, material ) {\n\n\t\tuniforms.diffuse.value.copy( material.color );\n\t\tuniforms.opacity.value = material.opacity;\n\t\tuniforms.rotation.value = material.rotation;\n\n\t\tif ( material.map ) {\n\n\t\t\tuniforms.map.value = material.map;\n\n\t\t}\n\n\t\tif ( material.alphaMap ) {\n\n\t\t\tuniforms.alphaMap.value = material.alphaMap;\n\n\t\t}\n\n\t\t// uv repeat and offset setting priorities\n\t\t// 1. color map\n\t\t// 2. alpha map\n\n\t\tlet uvScaleMap;\n\n\t\tif ( material.map ) {\n\n\t\t\tuvScaleMap = material.map;\n\n\t\t} else if ( material.alphaMap ) {\n\n\t\t\tuvScaleMap = material.alphaMap;\n\n\t\t}\n\n\t\tif ( uvScaleMap !== undefined ) {\n\n\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\n\n\t\t\t\tuvScaleMap.updateMatrix();\n\n\t\t\t}\n\n\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsLambert( uniforms, material ) {\n\n\t\tif ( material.emissiveMap ) {\n\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsPhong( uniforms, material ) {\n\n\t\tuniforms.specular.value.copy( material.specular );\n\t\tuniforms.shininess.value = Math.max( material.shininess, 1e-4 ); // to prevent pow( 0.0, 0.0 )\n\n\t\tif ( material.emissiveMap ) {\n\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\n\n\t\t}\n\n\t\tif ( material.bumpMap ) {\n\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\n\n\t\t}\n\n\t\tif ( material.normalMap ) {\n\n\t\t\tuniforms.normalMap.value = material.normalMap;\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\n\n\t\t}\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsToon( uniforms, material ) {\n\n\t\tif ( material.gradientMap ) {\n\n\t\t\tuniforms.gradientMap.value = material.gradientMap;\n\n\t\t}\n\n\t\tif ( material.emissiveMap ) {\n\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\n\n\t\t}\n\n\t\tif ( material.bumpMap ) {\n\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\n\n\t\t}\n\n\t\tif ( material.normalMap ) {\n\n\t\t\tuniforms.normalMap.value = material.normalMap;\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\n\n\t\t}\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsStandard( uniforms, material, environment ) {\n\n\t\tuniforms.roughness.value = material.roughness;\n\t\tuniforms.metalness.value = material.metalness;\n\n\t\tif ( material.roughnessMap ) {\n\n\t\t\tuniforms.roughnessMap.value = material.roughnessMap;\n\n\t\t}\n\n\t\tif ( material.metalnessMap ) {\n\n\t\t\tuniforms.metalnessMap.value = material.metalnessMap;\n\n\t\t}\n\n\t\tif ( material.emissiveMap ) {\n\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\n\n\t\t}\n\n\t\tif ( material.bumpMap ) {\n\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\n\n\t\t}\n\n\t\tif ( material.normalMap ) {\n\n\t\t\tuniforms.normalMap.value = material.normalMap;\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\n\n\t\t}\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t\tif ( material.envMap || environment ) {\n\n\t\t\t//uniforms.envMap.value = material.envMap; // part of uniforms common\n\t\t\tuniforms.envMapIntensity.value = material.envMapIntensity;\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsPhysical( uniforms, material, environment ) {\n\n\t\trefreshUniformsStandard( uniforms, material, environment );\n\n\t\tuniforms.reflectivity.value = material.reflectivity; // also part of uniforms common\n\n\t\tuniforms.clearcoat.value = material.clearcoat;\n\t\tuniforms.clearcoatRoughness.value = material.clearcoatRoughness;\n\t\tif ( material.sheen ) uniforms.sheen.value.copy( material.sheen );\n\n\t\tif ( material.clearcoatMap ) {\n\n\t\t\tuniforms.clearcoatMap.value = material.clearcoatMap;\n\n\t\t}\n\n\t\tif ( material.clearcoatRoughnessMap ) {\n\n\t\t\tuniforms.clearcoatRoughnessMap.value = material.clearcoatRoughnessMap;\n\n\t\t}\n\n\t\tif ( material.clearcoatNormalMap ) {\n\n\t\t\tuniforms.clearcoatNormalScale.value.copy( material.clearcoatNormalScale );\n\t\t\tuniforms.clearcoatNormalMap.value = material.clearcoatNormalMap;\n\n\t\t\tif ( material.side === BackSide ) {\n\n\t\t\t\tuniforms.clearcoatNormalScale.value.negate();\n\n\t\t\t}\n\n\t\t}\n\n\t\tuniforms.transparency.value = material.transparency;\n\n\t}\n\n\tfunction refreshUniformsMatcap( uniforms, material ) {\n\n\t\tif ( material.matcap ) {\n\n\t\t\tuniforms.matcap.value = material.matcap;\n\n\t\t}\n\n\t\tif ( material.bumpMap ) {\n\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\n\n\t\t}\n\n\t\tif ( material.normalMap ) {\n\n\t\t\tuniforms.normalMap.value = material.normalMap;\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\n\n\t\t}\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsDepth( uniforms, material ) {\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t}\n\n\tfunction refreshUniformsDistance( uniforms, material ) {\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t\tuniforms.referencePosition.value.copy( material.referencePosition );\n\t\tuniforms.nearDistance.value = material.nearDistance;\n\t\tuniforms.farDistance.value = material.farDistance;\n\n\t}\n\n\tfunction refreshUniformsNormal( uniforms, material ) {\n\n\t\tif ( material.bumpMap ) {\n\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\n\n\t\t}\n\n\t\tif ( material.normalMap ) {\n\n\t\t\tuniforms.normalMap.value = material.normalMap;\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\n\n\t\t}\n\n\t\tif ( material.displacementMap ) {\n\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\n\n\t\t}\n\n\t}\n\n\treturn {\n\t\trefreshFogUniforms: refreshFogUniforms,\n\t\trefreshMaterialUniforms: refreshMaterialUniforms\n\t};\n\n}\n\nexport { WebGLMaterials };\n","/**\n * @author supereggbert / http://www.paulbrunt.co.uk/\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n * @author szimek / https://github.com/szimek/\n * @author tschw\n */\n\nimport {\n\tRGBAFormat,\n\tHalfFloatType,\n\tFloatType,\n\tUnsignedByteType,\n\tLinearEncoding,\n\tNoToneMapping\n} from '../constants.js';\nimport { MathUtils } from '../math/MathUtils.js';\nimport { DataTexture } from '../textures/DataTexture.js';\nimport { Frustum } from '../math/Frustum.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { UniformsLib } from './shaders/UniformsLib.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector4 } from '../math/Vector4.js';\nimport { WebGLAnimation } from './webgl/WebGLAnimation.js';\nimport { WebGLAttributes } from './webgl/WebGLAttributes.js';\nimport { WebGLBackground } from './webgl/WebGLBackground.js';\nimport { WebGLBindingStates } from './webgl/WebGLBindingStates.js';\nimport { WebGLBufferRenderer } from './webgl/WebGLBufferRenderer.js';\nimport { WebGLCapabilities } from './webgl/WebGLCapabilities.js';\nimport { WebGLClipping } from './webgl/WebGLClipping.js';\nimport { WebGLExtensions } from './webgl/WebGLExtensions.js';\nimport { WebGLGeometries } from './webgl/WebGLGeometries.js';\nimport { WebGLIndexedBufferRenderer } from './webgl/WebGLIndexedBufferRenderer.js';\nimport { WebGLInfo } from './webgl/WebGLInfo.js';\nimport { WebGLMorphtargets } from './webgl/WebGLMorphtargets.js';\nimport { WebGLObjects } from './webgl/WebGLObjects.js';\nimport { WebGLPrograms } from './webgl/WebGLPrograms.js';\nimport { WebGLProperties } from './webgl/WebGLProperties.js';\nimport { WebGLRenderLists } from './webgl/WebGLRenderLists.js';\nimport { WebGLRenderStates } from './webgl/WebGLRenderStates.js';\nimport { WebGLShadowMap } from './webgl/WebGLShadowMap.js';\nimport { WebGLState } from './webgl/WebGLState.js';\nimport { WebGLTextures } from './webgl/WebGLTextures.js';\nimport { WebGLUniforms } from './webgl/WebGLUniforms.js';\nimport { WebGLUtils } from './webgl/WebGLUtils.js';\nimport { WebXRManager } from './webxr/WebXRManager.js';\nimport { WebGLMaterials } from \"./webgl/WebGLMaterials.js\";\n\nfunction WebGLRenderer( parameters ) {\n\n\tparameters = parameters || {};\n\n\tconst _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' ),\n\t\t_context = parameters.context !== undefined ? parameters.context : null,\n\n\t\t_alpha = parameters.alpha !== undefined ? parameters.alpha : false,\n\t\t_depth = parameters.depth !== undefined ? parameters.depth : true,\n\t\t_stencil = parameters.stencil !== undefined ? parameters.stencil : true,\n\t\t_antialias = parameters.antialias !== undefined ? parameters.antialias : false,\n\t\t_premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\n\t\t_preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\n\t\t_powerPreference = parameters.powerPreference !== undefined ? parameters.powerPreference : 'default',\n\t\t_failIfMajorPerformanceCaveat = parameters.failIfMajorPerformanceCaveat !== undefined ? parameters.failIfMajorPerformanceCaveat : false;\n\n\tlet currentRenderList = null;\n\tlet currentRenderState = null;\n\n\t// public properties\n\n\tthis.domElement = _canvas;\n\n\t// Debug configuration container\n\tthis.debug = {\n\n\t\t/**\n\t\t * Enables error checking and reporting when shader programs are being compiled\n\t\t * @type {boolean}\n\t\t */\n\t\tcheckShaderErrors: true\n\t};\n\n\t// clearing\n\n\tthis.autoClear = true;\n\tthis.autoClearColor = true;\n\tthis.autoClearDepth = true;\n\tthis.autoClearStencil = true;\n\n\t// scene graph\n\n\tthis.sortObjects = true;\n\n\t// user-defined clipping\n\n\tthis.clippingPlanes = [];\n\tthis.localClippingEnabled = false;\n\n\t// physically based shading\n\n\tthis.gammaFactor = 2.0;\t// for backwards compatibility\n\tthis.outputEncoding = LinearEncoding;\n\n\t// physical lights\n\n\tthis.physicallyCorrectLights = false;\n\n\t// tone mapping\n\n\tthis.toneMapping = NoToneMapping;\n\tthis.toneMappingExposure = 1.0;\n\n\t// morphs\n\n\tthis.maxMorphTargets = 8;\n\tthis.maxMorphNormals = 4;\n\n\t// internal properties\n\n\tconst _this = this;\n\n\tlet _isContextLost = false;\n\n\t// internal state cache\n\n\tlet _framebuffer = null;\n\n\tlet _currentActiveCubeFace = 0;\n\tlet _currentActiveMipmapLevel = 0;\n\tlet _currentRenderTarget = null;\n\tlet _currentFramebuffer = null;\n\tlet _currentMaterialId = - 1;\n\n\tlet _currentCamera = null;\n\tlet _currentArrayCamera = null;\n\n\tconst _currentViewport = new Vector4();\n\tconst _currentScissor = new Vector4();\n\tlet _currentScissorTest = null;\n\n\t//\n\n\tlet _width = _canvas.width;\n\tlet _height = _canvas.height;\n\n\tlet _pixelRatio = 1;\n\tlet _opaqueSort = null;\n\tlet _transparentSort = null;\n\n\tconst _viewport = new Vector4( 0, 0, _width, _height );\n\tconst _scissor = new Vector4( 0, 0, _width, _height );\n\tlet _scissorTest = false;\n\n\t// frustum\n\n\tconst _frustum = new Frustum();\n\n\t// clipping\n\n\tconst _clipping = new WebGLClipping();\n\tlet _clippingEnabled = false;\n\tlet _localClippingEnabled = false;\n\n\t// camera matrices cache\n\n\tconst _projScreenMatrix = new Matrix4();\n\n\tconst _vector3 = new Vector3();\n\n\tconst _emptyScene = { background: null, fog: null, environment: null, overrideMaterial: null, isScene: true };\n\n\tfunction getTargetPixelRatio() {\n\n\t\treturn _currentRenderTarget === null ? _pixelRatio : 1;\n\n\t}\n\n\t// initialize\n\n\tlet _gl = _context;\n\n\tfunction getContext( contextNames, contextAttributes ) {\n\n\t\tfor ( let i = 0; i < contextNames.length; i ++ ) {\n\n\t\t\tconst contextName = contextNames[ i ];\n\t\t\tconst context = _canvas.getContext( contextName, contextAttributes );\n\t\t\tif ( context !== null ) return context;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\ttry {\n\n\t\tconst contextAttributes = {\n\t\t\talpha: _alpha,\n\t\t\tdepth: _depth,\n\t\t\tstencil: _stencil,\n\t\t\tantialias: _antialias,\n\t\t\tpremultipliedAlpha: _premultipliedAlpha,\n\t\t\tpreserveDrawingBuffer: _preserveDrawingBuffer,\n\t\t\tpowerPreference: _powerPreference,\n\t\t\tfailIfMajorPerformanceCaveat: _failIfMajorPerformanceCaveat\n\t\t};\n\n\t\t// event listeners must be registered before WebGL context is created, see #12753\n\n\t\t_canvas.addEventListener( 'webglcontextlost', onContextLost, false );\n\t\t_canvas.addEventListener( 'webglcontextrestored', onContextRestore, false );\n\n\t\tif ( _gl === null ) {\n\n\t\t\tconst contextNames = [ 'webgl2', 'webgl', 'experimental-webgl' ];\n\n\t\t\tif ( _this.isWebGL1Renderer === true ) {\n\n\t\t\t\tcontextNames.shift();\n\n\t\t\t}\n\n\t\t\t_gl = getContext( contextNames, contextAttributes );\n\n\t\t\tif ( _gl === null ) {\n\n\t\t\t\tif ( getContext( contextNames ) ) {\n\n\t\t\t\t\tthrow new Error( 'Error creating WebGL context with your selected attributes.' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'Error creating WebGL context.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Some experimental-webgl implementations do not have getShaderPrecisionFormat\n\n\t\tif ( _gl.getShaderPrecisionFormat === undefined ) {\n\n\t\t\t_gl.getShaderPrecisionFormat = function () {\n\n\t\t\t\treturn { 'rangeMin': 1, 'rangeMax': 1, 'precision': 1 };\n\n\t\t\t};\n\n\t\t}\n\n\t} catch ( error ) {\n\n\t\tconsole.error( 'THREE.WebGLRenderer: ' + error.message );\n\t\tthrow error;\n\n\t}\n\n\tlet extensions, capabilities, state, info;\n\tlet properties, textures, attributes, geometries, objects;\n\tlet programCache, materials, renderLists, renderStates;\n\n\tlet background, morphtargets, bufferRenderer, indexedBufferRenderer;\n\n\tlet utils, bindingStates;\n\n\tfunction initGLContext() {\n\n\t\textensions = new WebGLExtensions( _gl );\n\n\t\tcapabilities = new WebGLCapabilities( _gl, extensions, parameters );\n\n\t\tif ( capabilities.isWebGL2 === false ) {\n\n\t\t\textensions.get( 'WEBGL_depth_texture' );\n\t\t\textensions.get( 'OES_texture_float' );\n\t\t\textensions.get( 'OES_texture_half_float' );\n\t\t\textensions.get( 'OES_texture_half_float_linear' );\n\t\t\textensions.get( 'OES_standard_derivatives' );\n\t\t\textensions.get( 'OES_element_index_uint' );\n\t\t\textensions.get( 'OES_vertex_array_object' );\n\t\t\textensions.get( 'ANGLE_instanced_arrays' );\n\n\t\t}\n\n\t\textensions.get( 'OES_texture_float_linear' );\n\n\t\tutils = new WebGLUtils( _gl, extensions, capabilities );\n\n\t\tstate = new WebGLState( _gl, extensions, capabilities );\n\t\tstate.scissor( _currentScissor.copy( _scissor ).multiplyScalar( _pixelRatio ).floor() );\n\t\tstate.viewport( _currentViewport.copy( _viewport ).multiplyScalar( _pixelRatio ).floor() );\n\n\t\tinfo = new WebGLInfo( _gl );\n\t\tproperties = new WebGLProperties();\n\t\ttextures = new WebGLTextures( _gl, extensions, state, properties, capabilities, utils, info );\n\t\tattributes = new WebGLAttributes( _gl, capabilities );\n\t\tbindingStates = new WebGLBindingStates( _gl, extensions, attributes, capabilities );\n\t\tgeometries = new WebGLGeometries( _gl, attributes, info, bindingStates );\n\t\tobjects = new WebGLObjects( _gl, geometries, attributes, info );\n\t\tmorphtargets = new WebGLMorphtargets( _gl );\n\t\tprogramCache = new WebGLPrograms( _this, extensions, capabilities, bindingStates );\n\t\tmaterials = new WebGLMaterials( properties );\n\t\trenderLists = new WebGLRenderLists();\n\t\trenderStates = new WebGLRenderStates();\n\n\t\tbackground = new WebGLBackground( _this, state, objects, _premultipliedAlpha );\n\n\t\tbufferRenderer = new WebGLBufferRenderer( _gl, extensions, info, capabilities );\n\t\tindexedBufferRenderer = new WebGLIndexedBufferRenderer( _gl, extensions, info, capabilities );\n\n\t\tinfo.programs = programCache.programs;\n\n\t\t_this.capabilities = capabilities;\n\t\t_this.extensions = extensions;\n\t\t_this.properties = properties;\n\t\t_this.renderLists = renderLists;\n\t\t_this.state = state;\n\t\t_this.info = info;\n\n\t}\n\n\tinitGLContext();\n\n\t// xr\n\n\tconst xr = new WebXRManager( _this, _gl );\n\n\tthis.xr = xr;\n\n\t// shadow map\n\n\tconst shadowMap = new WebGLShadowMap( _this, objects, capabilities.maxTextureSize );\n\n\tthis.shadowMap = shadowMap;\n\n\t// API\n\n\tthis.getContext = function () {\n\n\t\treturn _gl;\n\n\t};\n\n\tthis.getContextAttributes = function () {\n\n\t\treturn _gl.getContextAttributes();\n\n\t};\n\n\tthis.forceContextLoss = function () {\n\n\t\tconst extension = extensions.get( 'WEBGL_lose_context' );\n\t\tif ( extension ) extension.loseContext();\n\n\t};\n\n\tthis.forceContextRestore = function () {\n\n\t\tconst extension = extensions.get( 'WEBGL_lose_context' );\n\t\tif ( extension ) extension.restoreContext();\n\n\t};\n\n\tthis.getPixelRatio = function () {\n\n\t\treturn _pixelRatio;\n\n\t};\n\n\tthis.setPixelRatio = function ( value ) {\n\n\t\tif ( value === undefined ) return;\n\n\t\t_pixelRatio = value;\n\n\t\tthis.setSize( _width, _height, false );\n\n\t};\n\n\tthis.getSize = function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'WebGLRenderer: .getsize() now requires a Vector2 as an argument' );\n\n\t\t\ttarget = new Vector2();\n\n\t\t}\n\n\t\treturn target.set( _width, _height );\n\n\t};\n\n\tthis.setSize = function ( width, height, updateStyle ) {\n\n\t\tif ( xr.isPresenting ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: Can\\'t change size while VR device is presenting.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\t_width = width;\n\t\t_height = height;\n\n\t\t_canvas.width = Math.floor( width * _pixelRatio );\n\t\t_canvas.height = Math.floor( height * _pixelRatio );\n\n\t\tif ( updateStyle !== false ) {\n\n\t\t\t_canvas.style.width = width + 'px';\n\t\t\t_canvas.style.height = height + 'px';\n\n\t\t}\n\n\t\tthis.setViewport( 0, 0, width, height );\n\n\t};\n\n\tthis.getDrawingBufferSize = function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument' );\n\n\t\t\ttarget = new Vector2();\n\n\t\t}\n\n\t\treturn target.set( _width * _pixelRatio, _height * _pixelRatio ).floor();\n\n\t};\n\n\tthis.setDrawingBufferSize = function ( width, height, pixelRatio ) {\n\n\t\t_width = width;\n\t\t_height = height;\n\n\t\t_pixelRatio = pixelRatio;\n\n\t\t_canvas.width = Math.floor( width * pixelRatio );\n\t\t_canvas.height = Math.floor( height * pixelRatio );\n\n\t\tthis.setViewport( 0, 0, width, height );\n\n\t};\n\n\tthis.getCurrentViewport = function ( target ) {\n\n\t\tif ( target === undefined ) {\n\n\t\t\tconsole.warn( 'WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument' );\n\n\t\t\ttarget = new Vector4();\n\n\t\t}\n\n\t\treturn target.copy( _currentViewport );\n\n\t};\n\n\tthis.getViewport = function ( target ) {\n\n\t\treturn target.copy( _viewport );\n\n\t};\n\n\tthis.setViewport = function ( x, y, width, height ) {\n\n\t\tif ( x.isVector4 ) {\n\n\t\t\t_viewport.set( x.x, x.y, x.z, x.w );\n\n\t\t} else {\n\n\t\t\t_viewport.set( x, y, width, height );\n\n\t\t}\n\n\t\tstate.viewport( _currentViewport.copy( _viewport ).multiplyScalar( _pixelRatio ).floor() );\n\n\t};\n\n\tthis.getScissor = function ( target ) {\n\n\t\treturn target.copy( _scissor );\n\n\t};\n\n\tthis.setScissor = function ( x, y, width, height ) {\n\n\t\tif ( x.isVector4 ) {\n\n\t\t\t_scissor.set( x.x, x.y, x.z, x.w );\n\n\t\t} else {\n\n\t\t\t_scissor.set( x, y, width, height );\n\n\t\t}\n\n\t\tstate.scissor( _currentScissor.copy( _scissor ).multiplyScalar( _pixelRatio ).floor() );\n\n\t};\n\n\tthis.getScissorTest = function () {\n\n\t\treturn _scissorTest;\n\n\t};\n\n\tthis.setScissorTest = function ( boolean ) {\n\n\t\tstate.setScissorTest( _scissorTest = boolean );\n\n\t};\n\n\tthis.setOpaqueSort = function ( method ) {\n\n\t\t_opaqueSort = method;\n\n\t};\n\n\tthis.setTransparentSort = function ( method ) {\n\n\t\t_transparentSort = method;\n\n\t};\n\n\t// Clearing\n\n\tthis.getClearColor = function () {\n\n\t\treturn background.getClearColor();\n\n\t};\n\n\tthis.setClearColor = function () {\n\n\t\tbackground.setClearColor.apply( background, arguments );\n\n\t};\n\n\tthis.getClearAlpha = function () {\n\n\t\treturn background.getClearAlpha();\n\n\t};\n\n\tthis.setClearAlpha = function () {\n\n\t\tbackground.setClearAlpha.apply( background, arguments );\n\n\t};\n\n\tthis.clear = function ( color, depth, stencil ) {\n\n\t\tlet bits = 0;\n\n\t\tif ( color === undefined || color ) bits |= _gl.COLOR_BUFFER_BIT;\n\t\tif ( depth === undefined || depth ) bits |= _gl.DEPTH_BUFFER_BIT;\n\t\tif ( stencil === undefined || stencil ) bits |= _gl.STENCIL_BUFFER_BIT;\n\n\t\t_gl.clear( bits );\n\n\t};\n\n\tthis.clearColor = function () {\n\n\t\tthis.clear( true, false, false );\n\n\t};\n\n\tthis.clearDepth = function () {\n\n\t\tthis.clear( false, true, false );\n\n\t};\n\n\tthis.clearStencil = function () {\n\n\t\tthis.clear( false, false, true );\n\n\t};\n\n\t//\n\n\tthis.dispose = function () {\n\n\t\t_canvas.removeEventListener( 'webglcontextlost', onContextLost, false );\n\t\t_canvas.removeEventListener( 'webglcontextrestored', onContextRestore, false );\n\n\t\trenderLists.dispose();\n\t\trenderStates.dispose();\n\t\tproperties.dispose();\n\t\tobjects.dispose();\n\t\tbindingStates.dispose();\n\n\t\txr.dispose();\n\n\t\tanimation.stop();\n\n\t};\n\n\t// Events\n\n\tfunction onContextLost( event ) {\n\n\t\tevent.preventDefault();\n\n\t\tconsole.log( 'THREE.WebGLRenderer: Context Lost.' );\n\n\t\t_isContextLost = true;\n\n\t}\n\n\tfunction onContextRestore( /* event */ ) {\n\n\t\tconsole.log( 'THREE.WebGLRenderer: Context Restored.' );\n\n\t\t_isContextLost = false;\n\n\t\tinitGLContext();\n\n\t}\n\n\tfunction onMaterialDispose( event ) {\n\n\t\tconst material = event.target;\n\n\t\tmaterial.removeEventListener( 'dispose', onMaterialDispose );\n\n\t\tdeallocateMaterial( material );\n\n\t}\n\n\t// Buffer deallocation\n\n\tfunction deallocateMaterial( material ) {\n\n\t\treleaseMaterialProgramReference( material );\n\n\t\tproperties.remove( material );\n\n\t}\n\n\n\tfunction releaseMaterialProgramReference( material ) {\n\n\t\tconst programInfo = properties.get( material ).program;\n\n\t\tmaterial.program = undefined;\n\n\t\tif ( programInfo !== undefined ) {\n\n\t\t\tprogramCache.releaseProgram( programInfo );\n\n\t\t}\n\n\t}\n\n\t// Buffer rendering\n\n\tfunction renderObjectImmediate( object, program ) {\n\n\t\tobject.render( function ( object ) {\n\n\t\t\t_this.renderBufferImmediate( object, program );\n\n\t\t} );\n\n\t}\n\n\tthis.renderBufferImmediate = function ( object, program ) {\n\n\t\tbindingStates.initAttributes();\n\n\t\tconst buffers = properties.get( object );\n\n\t\tif ( object.hasPositions && ! buffers.position ) buffers.position = _gl.createBuffer();\n\t\tif ( object.hasNormals && ! buffers.normal ) buffers.normal = _gl.createBuffer();\n\t\tif ( object.hasUvs && ! buffers.uv ) buffers.uv = _gl.createBuffer();\n\t\tif ( object.hasColors && ! buffers.color ) buffers.color = _gl.createBuffer();\n\n\t\tconst programAttributes = program.getAttributes();\n\n\t\tif ( object.hasPositions ) {\n\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.position );\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW );\n\n\t\t\tbindingStates.enableAttribute( programAttributes.position );\n\t\t\t_gl.vertexAttribPointer( programAttributes.position, 3, _gl.FLOAT, false, 0, 0 );\n\n\t\t}\n\n\t\tif ( object.hasNormals ) {\n\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.normal );\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW );\n\n\t\t\tbindingStates.enableAttribute( programAttributes.normal );\n\t\t\t_gl.vertexAttribPointer( programAttributes.normal, 3, _gl.FLOAT, false, 0, 0 );\n\n\t\t}\n\n\t\tif ( object.hasUvs ) {\n\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.uv );\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW );\n\n\t\t\tbindingStates.enableAttribute( programAttributes.uv );\n\t\t\t_gl.vertexAttribPointer( programAttributes.uv, 2, _gl.FLOAT, false, 0, 0 );\n\n\t\t}\n\n\t\tif ( object.hasColors ) {\n\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.color );\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW );\n\n\t\t\tbindingStates.enableAttribute( programAttributes.color );\n\t\t\t_gl.vertexAttribPointer( programAttributes.color, 3, _gl.FLOAT, false, 0, 0 );\n\n\t\t}\n\n\t\tbindingStates.disableUnusedAttributes();\n\n\t\t_gl.drawArrays( _gl.TRIANGLES, 0, object.count );\n\n\t\tobject.count = 0;\n\n\t};\n\n\tthis.renderBufferDirect = function ( camera, scene, geometry, material, object, group ) {\n\n\t\tif ( scene === null ) scene = _emptyScene; // renderBufferDirect second parameter used to be fog (could be null)\n\n\t\tconst frontFaceCW = ( object.isMesh && object.matrixWorld.determinant() < 0 );\n\n\t\tconst program = setProgram( camera, scene, material, object );\n\n\t\tstate.setMaterial( material, frontFaceCW );\n\n\t\t//\n\n\t\tlet index = geometry.index;\n\t\tconst position = geometry.attributes.position;\n\n\t\t//\n\n\t\tif ( index === null ) {\n\n\t\t\tif ( position === undefined || position.count === 0 ) return;\n\n\t\t} else if ( index.count === 0 ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t//\n\n\t\tlet rangeFactor = 1;\n\n\t\tif ( material.wireframe === true ) {\n\n\t\t\tindex = geometries.getWireframeAttribute( geometry );\n\t\t\trangeFactor = 2;\n\n\t\t}\n\n\t\tif ( material.morphTargets || material.morphNormals ) {\n\n\t\t\tmorphtargets.update( object, geometry, material, program );\n\n\t\t}\n\n\t\tbindingStates.setup( object, material, program, geometry, index );\n\n\t\tlet attribute;\n\t\tlet renderer = bufferRenderer;\n\n\t\tif ( index !== null ) {\n\n\t\t\tattribute = attributes.get( index );\n\n\t\t\trenderer = indexedBufferRenderer;\n\t\t\trenderer.setIndex( attribute );\n\n\t\t}\n\n\t\t//\n\n\t\tconst dataCount = ( index !== null ) ? index.count : position.count;\n\n\t\tconst rangeStart = geometry.drawRange.start * rangeFactor;\n\t\tconst rangeCount = geometry.drawRange.count * rangeFactor;\n\n\t\tconst groupStart = group !== null ? group.start * rangeFactor : 0;\n\t\tconst groupCount = group !== null ? group.count * rangeFactor : Infinity;\n\n\t\tconst drawStart = Math.max( rangeStart, groupStart );\n\t\tconst drawEnd = Math.min( dataCount, rangeStart + rangeCount, groupStart + groupCount ) - 1;\n\n\t\tconst drawCount = Math.max( 0, drawEnd - drawStart + 1 );\n\n\t\tif ( drawCount === 0 ) return;\n\n\t\t//\n\n\t\tif ( object.isMesh ) {\n\n\t\t\tif ( material.wireframe === true ) {\n\n\t\t\t\tstate.setLineWidth( material.wireframeLinewidth * getTargetPixelRatio() );\n\t\t\t\trenderer.setMode( _gl.LINES );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setMode( _gl.TRIANGLES );\n\n\t\t\t}\n\n\t\t} else if ( object.isLine ) {\n\n\t\t\tlet lineWidth = material.linewidth;\n\n\t\t\tif ( lineWidth === undefined ) lineWidth = 1; // Not using Line*Material\n\n\t\t\tstate.setLineWidth( lineWidth * getTargetPixelRatio() );\n\n\t\t\tif ( object.isLineSegments ) {\n\n\t\t\t\trenderer.setMode( _gl.LINES );\n\n\t\t\t} else if ( object.isLineLoop ) {\n\n\t\t\t\trenderer.setMode( _gl.LINE_LOOP );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setMode( _gl.LINE_STRIP );\n\n\t\t\t}\n\n\t\t} else if ( object.isPoints ) {\n\n\t\t\trenderer.setMode( _gl.POINTS );\n\n\t\t} else if ( object.isSprite ) {\n\n\t\t\trenderer.setMode( _gl.TRIANGLES );\n\n\t\t}\n\n\t\tif ( object.isInstancedMesh ) {\n\n\t\t\trenderer.renderInstances( geometry, drawStart, drawCount, object.count );\n\n\t\t} else if ( geometry.isInstancedBufferGeometry ) {\n\n\t\t\tconst instanceCount = Math.min( geometry.instanceCount, geometry._maxInstanceCount );\n\n\t\t\trenderer.renderInstances( geometry, drawStart, drawCount, instanceCount );\n\n\t\t} else {\n\n\t\t\trenderer.render( drawStart, drawCount );\n\n\t\t}\n\n\t};\n\n\t// Compile\n\n\tthis.compile = function ( scene, camera ) {\n\n\t\tcurrentRenderState = renderStates.get( scene, camera );\n\t\tcurrentRenderState.init();\n\n\t\tscene.traverse( function ( object ) {\n\n\t\t\tif ( object.isLight ) {\n\n\t\t\t\tcurrentRenderState.pushLight( object );\n\n\t\t\t\tif ( object.castShadow ) {\n\n\t\t\t\t\tcurrentRenderState.pushShadow( object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t\tcurrentRenderState.setupLights( camera );\n\n\t\tconst compiled = new WeakMap();\n\n\t\tscene.traverse( function ( object ) {\n\n\t\t\tlet material = object.material;\n\n\t\t\tif ( material ) {\n\n\t\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\t\tfor ( let i = 0; i < material.length; i ++ ) {\n\n\t\t\t\t\t\tlet material2 = material[ i ];\n\n\t\t\t\t\t\tif ( compiled.has( material2 ) === false ) {\n\n\t\t\t\t\t\t\tinitMaterial( material2, scene, object );\n\t\t\t\t\t\t\tcompiled.set( material2 );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( compiled.has( material ) === false ) {\n\n\t\t\t\t\tinitMaterial( material, scene, object );\n\t\t\t\t\tcompiled.set( material );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} );\n\n\t};\n\n\t// Animation Loop\n\n\tlet onAnimationFrameCallback = null;\n\n\tfunction onAnimationFrame( time ) {\n\n\t\tif ( xr.isPresenting ) return;\n\t\tif ( onAnimationFrameCallback ) onAnimationFrameCallback( time );\n\n\t}\n\n\tconst animation = new WebGLAnimation();\n\tanimation.setAnimationLoop( onAnimationFrame );\n\n\tif ( typeof window !== 'undefined' ) animation.setContext( window );\n\n\tthis.setAnimationLoop = function ( callback ) {\n\n\t\tonAnimationFrameCallback = callback;\n\t\txr.setAnimationLoop( callback );\n\n\t\t( callback === null ) ? animation.stop() : animation.start();\n\n\t};\n\n\t// Rendering\n\n\tthis.render = function ( scene, camera ) {\n\n\t\tlet renderTarget, forceClear;\n\n\t\tif ( arguments[ 2 ] !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead.' );\n\t\t\trenderTarget = arguments[ 2 ];\n\n\t\t}\n\n\t\tif ( arguments[ 3 ] !== undefined ) {\n\n\t\t\tconsole.warn( 'THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead.' );\n\t\t\tforceClear = arguments[ 3 ];\n\n\t\t}\n\n\t\tif ( camera !== undefined && camera.isCamera !== true ) {\n\n\t\t\tconsole.error( 'THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( _isContextLost === true ) return;\n\n\t\t// reset caching for this frame\n\n\t\tbindingStates.resetDefaultState();\n\t\t_currentMaterialId = - 1;\n\t\t_currentCamera = null;\n\n\t\t// update scene graph\n\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\n\n\t\t// update camera matrices and frustum\n\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\tif ( xr.enabled === true && xr.isPresenting === true ) {\n\n\t\t\tcamera = xr.getCamera( camera );\n\n\t\t}\n\n\t\t//\n\t\tif ( scene.isScene === true ) scene.onBeforeRender( _this, scene, camera, renderTarget || _currentRenderTarget );\n\n\t\tcurrentRenderState = renderStates.get( scene, camera );\n\t\tcurrentRenderState.init();\n\n\t\t_projScreenMatrix.multiplyMatrices( camera.projectionMatrix, camera.matrixWorldInverse );\n\t\t_frustum.setFromProjectionMatrix( _projScreenMatrix );\n\n\t\t_localClippingEnabled = this.localClippingEnabled;\n\t\t_clippingEnabled = _clipping.init( this.clippingPlanes, _localClippingEnabled, camera );\n\n\t\tcurrentRenderList = renderLists.get( scene, camera );\n\t\tcurrentRenderList.init();\n\n\t\tprojectObject( scene, camera, 0, _this.sortObjects );\n\n\t\tcurrentRenderList.finish();\n\n\t\tif ( _this.sortObjects === true ) {\n\n\t\t\tcurrentRenderList.sort( _opaqueSort, _transparentSort );\n\n\t\t}\n\n\t\t//\n\n\t\tif ( _clippingEnabled === true ) _clipping.beginShadows();\n\n\t\tconst shadowsArray = currentRenderState.state.shadowsArray;\n\n\t\tshadowMap.render( shadowsArray, scene, camera );\n\n\t\tcurrentRenderState.setupLights( camera );\n\n\t\tif ( _clippingEnabled === true ) _clipping.endShadows();\n\n\t\t//\n\n\t\tif ( this.info.autoReset === true ) this.info.reset();\n\n\t\tif ( renderTarget !== undefined ) {\n\n\t\t\tthis.setRenderTarget( renderTarget );\n\n\t\t}\n\n\t\t//\n\n\t\tbackground.render( currentRenderList, scene, camera, forceClear );\n\n\t\t// render scene\n\n\t\tconst opaqueObjects = currentRenderList.opaque;\n\t\tconst transparentObjects = currentRenderList.transparent;\n\n\t\tif ( opaqueObjects.length > 0 ) renderObjects( opaqueObjects, scene, camera );\n\t\tif ( transparentObjects.length > 0 ) renderObjects( transparentObjects, scene, camera );\n\n\t\t//\n\n\t\tif ( scene.isScene === true ) scene.onAfterRender( _this, scene, camera );\n\n\t\t//\n\n\t\tif ( _currentRenderTarget !== null ) {\n\n\t\t\t// Generate mipmap if we're using any kind of mipmap filtering\n\n\t\t\ttextures.updateRenderTargetMipmap( _currentRenderTarget );\n\n\t\t\t// resolve multisample renderbuffers to a single-sample texture if necessary\n\n\t\t\ttextures.updateMultisampleRenderTarget( _currentRenderTarget );\n\n\t\t}\n\n\t\t// Ensure depth buffer writing is enabled so it can be cleared on next render\n\n\t\tstate.buffers.depth.setTest( true );\n\t\tstate.buffers.depth.setMask( true );\n\t\tstate.buffers.color.setMask( true );\n\n\t\tstate.setPolygonOffset( false );\n\n\t\t// _gl.finish();\n\n\t\tcurrentRenderList = null;\n\t\tcurrentRenderState = null;\n\n\t};\n\n\tfunction projectObject( object, camera, groupOrder, sortObjects ) {\n\n\t\tif ( object.visible === false ) return;\n\n\t\tconst visible = object.layers.test( camera.layers );\n\n\t\tif ( visible ) {\n\n\t\t\tif ( object.isGroup ) {\n\n\t\t\t\tgroupOrder = object.renderOrder;\n\n\t\t\t} else if ( object.isLOD ) {\n\n\t\t\t\tif ( object.autoUpdate === true ) object.update( camera );\n\n\t\t\t} else if ( object.isLight ) {\n\n\t\t\t\tcurrentRenderState.pushLight( object );\n\n\t\t\t\tif ( object.castShadow ) {\n\n\t\t\t\t\tcurrentRenderState.pushShadow( object );\n\n\t\t\t\t}\n\n\t\t\t} else if ( object.isSprite ) {\n\n\t\t\t\tif ( ! object.frustumCulled || _frustum.intersectsSprite( object ) ) {\n\n\t\t\t\t\tif ( sortObjects ) {\n\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld )\n\t\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst geometry = objects.update( object );\n\t\t\t\t\tconst material = object.material;\n\n\t\t\t\t\tif ( material.visible ) {\n\n\t\t\t\t\t\tcurrentRenderList.push( object, geometry, material, groupOrder, _vector3.z, null );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( object.isImmediateRenderObject ) {\n\n\t\t\t\tif ( sortObjects ) {\n\n\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld )\n\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\n\n\t\t\t\t}\n\n\t\t\t\tcurrentRenderList.push( object, null, object.material, groupOrder, _vector3.z, null );\n\n\t\t\t} else if ( object.isMesh || object.isLine || object.isPoints ) {\n\n\t\t\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\t\t\t// update skeleton only once in a frame\n\n\t\t\t\t\tif ( object.skeleton.frame !== info.render.frame ) {\n\n\t\t\t\t\t\tobject.skeleton.update();\n\t\t\t\t\t\tobject.skeleton.frame = info.render.frame;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! object.frustumCulled || _frustum.intersectsObject( object ) ) {\n\n\t\t\t\t\tif ( sortObjects ) {\n\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld )\n\t\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst geometry = objects.update( object );\n\t\t\t\t\tconst material = object.material;\n\n\t\t\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\t\t\tconst groups = geometry.groups;\n\n\t\t\t\t\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\n\n\t\t\t\t\t\t\tconst group = groups[ i ];\n\t\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\n\n\t\t\t\t\t\t\tif ( groupMaterial && groupMaterial.visible ) {\n\n\t\t\t\t\t\t\t\tcurrentRenderList.push( object, geometry, groupMaterial, groupOrder, _vector3.z, group );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( material.visible ) {\n\n\t\t\t\t\t\tcurrentRenderList.push( object, geometry, material, groupOrder, _vector3.z, null );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst children = object.children;\n\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\tprojectObject( children[ i ], camera, groupOrder, sortObjects );\n\n\t\t}\n\n\t}\n\n\tfunction renderObjects( renderList, scene, camera ) {\n\n\t\tconst overrideMaterial = scene.isScene === true ? scene.overrideMaterial : null;\n\n\t\tfor ( let i = 0, l = renderList.length; i < l; i ++ ) {\n\n\t\t\tconst renderItem = renderList[ i ];\n\n\t\t\tconst object = renderItem.object;\n\t\t\tconst geometry = renderItem.geometry;\n\t\t\tconst material = overrideMaterial === null ? renderItem.material : overrideMaterial;\n\t\t\tconst group = renderItem.group;\n\n\t\t\tif ( camera.isArrayCamera ) {\n\n\t\t\t\t_currentArrayCamera = camera;\n\n\t\t\t\tconst cameras = camera.cameras;\n\n\t\t\t\tfor ( let j = 0, jl = cameras.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst camera2 = cameras[ j ];\n\n\t\t\t\t\tif ( object.layers.test( camera2.layers ) ) {\n\n\t\t\t\t\t\tstate.viewport( _currentViewport.copy( camera2.viewport ) );\n\n\t\t\t\t\t\tcurrentRenderState.setupLights( camera2 );\n\n\t\t\t\t\t\trenderObject( object, scene, camera2, geometry, material, group );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t_currentArrayCamera = null;\n\n\t\t\t\trenderObject( object, scene, camera, geometry, material, group );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction renderObject( object, scene, camera, geometry, material, group ) {\n\n\t\tobject.onBeforeRender( _this, scene, camera, geometry, material, group );\n\t\tcurrentRenderState = renderStates.get( scene, _currentArrayCamera || camera );\n\n\t\tobject.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\n\t\tobject.normalMatrix.getNormalMatrix( object.modelViewMatrix );\n\n\t\tif ( object.isImmediateRenderObject ) {\n\n\t\t\tconst program = setProgram( camera, scene, material, object );\n\n\t\t\tstate.setMaterial( material );\n\n\t\t\tbindingStates.reset();\n\n\t\t\trenderObjectImmediate( object, program );\n\n\t\t} else {\n\n\t\t\t_this.renderBufferDirect( camera, scene, geometry, material, object, group );\n\n\t\t}\n\n\t\tobject.onAfterRender( _this, scene, camera, geometry, material, group );\n\t\tcurrentRenderState = renderStates.get( scene, _currentArrayCamera || camera );\n\n\t}\n\n\tfunction initMaterial( material, scene, object ) {\n\n\t\tif ( scene.isScene !== true ) scene = _emptyScene; // scene could be a Mesh, Line, Points, ...\n\n\t\tconst materialProperties = properties.get( material );\n\n\t\tconst lights = currentRenderState.state.lights;\n\t\tconst shadowsArray = currentRenderState.state.shadowsArray;\n\n\t\tconst lightsStateVersion = lights.state.version;\n\n\t\tconst parameters = programCache.getParameters( material, lights.state, shadowsArray, scene, _clipping.numPlanes, _clipping.numIntersection, object );\n\t\tconst programCacheKey = programCache.getProgramCacheKey( parameters );\n\n\t\tlet program = materialProperties.program;\n\t\tlet programChange = true;\n\n\t\tif ( program === undefined ) {\n\n\t\t\t// new material\n\t\t\tmaterial.addEventListener( 'dispose', onMaterialDispose );\n\n\t\t} else if ( program.cacheKey !== programCacheKey ) {\n\n\t\t\t// changed glsl or parameters\n\t\t\treleaseMaterialProgramReference( material );\n\n\t\t} else if ( materialProperties.lightsStateVersion !== lightsStateVersion ) {\n\n\t\t\tmaterialProperties.lightsStateVersion = lightsStateVersion;\n\n\t\t\tprogramChange = false;\n\n\t\t} else if ( parameters.shaderID !== undefined ) {\n\n\t\t\t// same glsl and uniform list\n\t\t\treturn;\n\n\t\t} else {\n\n\t\t\t// only rebuild uniform list\n\t\t\tprogramChange = false;\n\n\t\t}\n\n\t\tif ( programChange ) {\n\n\t\t\tprogram = programCache.acquireProgram( parameters, programCacheKey );\n\n\t\t\tmaterialProperties.program = program;\n\t\t\tmaterialProperties.uniforms = parameters.uniforms;\n\t\t\tmaterialProperties.outputEncoding = parameters.outputEncoding;\n\t\t\tmaterial.program = program;\n\n\t\t}\n\n\t\tconst programAttributes = program.getAttributes();\n\n\t\tif ( material.morphTargets ) {\n\n\t\t\tmaterial.numSupportedMorphTargets = 0;\n\n\t\t\tfor ( let i = 0; i < _this.maxMorphTargets; i ++ ) {\n\n\t\t\t\tif ( programAttributes[ 'morphTarget' + i ] >= 0 ) {\n\n\t\t\t\t\tmaterial.numSupportedMorphTargets ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( material.morphNormals ) {\n\n\t\t\tmaterial.numSupportedMorphNormals = 0;\n\n\t\t\tfor ( let i = 0; i < _this.maxMorphNormals; i ++ ) {\n\n\t\t\t\tif ( programAttributes[ 'morphNormal' + i ] >= 0 ) {\n\n\t\t\t\t\tmaterial.numSupportedMorphNormals ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst uniforms = materialProperties.uniforms;\n\n\t\tif ( ! material.isShaderMaterial &&\n\t\t\t! material.isRawShaderMaterial ||\n\t\t\tmaterial.clipping === true ) {\n\n\t\t\tmaterialProperties.numClippingPlanes = _clipping.numPlanes;\n\t\t\tmaterialProperties.numIntersection = _clipping.numIntersection;\n\t\t\tuniforms.clippingPlanes = _clipping.uniform;\n\n\t\t}\n\n\t\tmaterialProperties.environment = material.isMeshStandardMaterial ? scene.environment : null;\n\t\tmaterialProperties.fog = scene.fog;\n\n\t\t// store the light setup it was created for\n\n\t\tmaterialProperties.needsLights = materialNeedsLights( material );\n\t\tmaterialProperties.lightsStateVersion = lightsStateVersion;\n\n\t\tif ( materialProperties.needsLights ) {\n\n\t\t\t// wire up the material to this renderer's lighting state\n\n\t\t\tuniforms.ambientLightColor.value = lights.state.ambient;\n\t\t\tuniforms.lightProbe.value = lights.state.probe;\n\t\t\tuniforms.directionalLights.value = lights.state.directional;\n\t\t\tuniforms.directionalLightShadows.value = lights.state.directionalShadow;\n\t\t\tuniforms.spotLights.value = lights.state.spot;\n\t\t\tuniforms.spotLightShadows.value = lights.state.spotShadow;\n\t\t\tuniforms.rectAreaLights.value = lights.state.rectArea;\n\t\t\tuniforms.pointLights.value = lights.state.point;\n\t\t\tuniforms.pointLightShadows.value = lights.state.pointShadow;\n\t\t\tuniforms.hemisphereLights.value = lights.state.hemi;\n\n\t\t\tuniforms.directionalShadowMap.value = lights.state.directionalShadowMap;\n\t\t\tuniforms.directionalShadowMatrix.value = lights.state.directionalShadowMatrix;\n\t\t\tuniforms.spotShadowMap.value = lights.state.spotShadowMap;\n\t\t\tuniforms.spotShadowMatrix.value = lights.state.spotShadowMatrix;\n\t\t\tuniforms.pointShadowMap.value = lights.state.pointShadowMap;\n\t\t\tuniforms.pointShadowMatrix.value = lights.state.pointShadowMatrix;\n\t\t\t// TODO (abelnation): add area lights shadow info to uniforms\n\n\t\t}\n\n\t\tconst progUniforms = materialProperties.program.getUniforms(),\n\t\t\tuniformsList =\n\t\t\t\tWebGLUniforms.seqWithValue( progUniforms.seq, uniforms );\n\n\t\tmaterialProperties.uniformsList = uniformsList;\n\n\t}\n\n\tfunction setProgram( camera, scene, material, object ) {\n\n\t\tif ( scene.isScene !== true ) scene = _emptyScene; // scene could be a Mesh, Line, Points, ...\n\n\t\ttextures.resetTextureUnits();\n\n\t\tconst fog = scene.fog;\n\t\tconst environment = material.isMeshStandardMaterial ? scene.environment : null;\n\t\tconst encoding = ( _currentRenderTarget === null ) ? _this.outputEncoding : _currentRenderTarget.texture.encoding;\n\n\t\tconst materialProperties = properties.get( material );\n\t\tconst lights = currentRenderState.state.lights;\n\n\t\tif ( _clippingEnabled === true ) {\n\n\t\t\tif ( _localClippingEnabled === true || camera !== _currentCamera ) {\n\n\t\t\t\tconst useCache =\n\t\t\t\t\tcamera === _currentCamera &&\n\t\t\t\t\tmaterial.id === _currentMaterialId;\n\n\t\t\t\t// we might want to call this function with some ClippingGroup\n\t\t\t\t// object instead of the material, once it becomes feasible\n\t\t\t\t// (#8465, #8379)\n\t\t\t\t_clipping.setState(\n\t\t\t\t\tmaterial.clippingPlanes, material.clipIntersection, material.clipShadows,\n\t\t\t\t\tcamera, materialProperties, useCache );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( material.version === materialProperties.__version ) {\n\n\t\t\tif ( materialProperties.program === undefined ) {\n\n\t\t\t\tinitMaterial( material, scene, object );\n\n\t\t\t} else if ( material.fog && materialProperties.fog !== fog ) {\n\n\t\t\t\tinitMaterial( material, scene, object );\n\n\t\t\t} else if ( materialProperties.environment !== environment ) {\n\n\t\t\t\tinitMaterial( material, scene, object );\n\n\t\t\t} else if ( materialProperties.needsLights && ( materialProperties.lightsStateVersion !== lights.state.version ) ) {\n\n\t\t\t\tinitMaterial( material, scene, object );\n\n\t\t\t} else if ( materialProperties.numClippingPlanes !== undefined &&\n\t\t\t\t( materialProperties.numClippingPlanes !== _clipping.numPlanes ||\n\t\t\t\tmaterialProperties.numIntersection !== _clipping.numIntersection ) ) {\n\n\t\t\t\tinitMaterial( material, scene, object );\n\n\t\t\t} else if ( materialProperties.outputEncoding !== encoding ) {\n\n\t\t\t\tinitMaterial( material, scene, object );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tinitMaterial( material, scene, object );\n\t\t\tmaterialProperties.__version = material.version;\n\n\t\t}\n\n\t\tlet refreshProgram = false;\n\t\tlet refreshMaterial = false;\n\t\tlet refreshLights = false;\n\n\t\tconst program = materialProperties.program,\n\t\t\tp_uniforms = program.getUniforms(),\n\t\t\tm_uniforms = materialProperties.uniforms;\n\n\t\tif ( state.useProgram( program.program ) ) {\n\n\t\t\trefreshProgram = true;\n\t\t\trefreshMaterial = true;\n\t\t\trefreshLights = true;\n\n\t\t}\n\n\t\tif ( material.id !== _currentMaterialId ) {\n\n\t\t\t_currentMaterialId = material.id;\n\n\t\t\trefreshMaterial = true;\n\n\t\t}\n\n\t\tif ( refreshProgram || _currentCamera !== camera ) {\n\n\t\t\tp_uniforms.setValue( _gl, 'projectionMatrix', camera.projectionMatrix );\n\n\t\t\tif ( capabilities.logarithmicDepthBuffer ) {\n\n\t\t\t\tp_uniforms.setValue( _gl, 'logDepthBufFC',\n\t\t\t\t\t2.0 / ( Math.log( camera.far + 1.0 ) / Math.LN2 ) );\n\n\t\t\t}\n\n\t\t\tif ( _currentCamera !== camera ) {\n\n\t\t\t\t_currentCamera = camera;\n\n\t\t\t\t// lighting uniforms depend on the camera so enforce an update\n\t\t\t\t// now, in case this material supports lights - or later, when\n\t\t\t\t// the next material that does gets activated:\n\n\t\t\t\trefreshMaterial = true;\t\t// set to true on material change\n\t\t\t\trefreshLights = true;\t\t// remains set until update done\n\n\t\t\t}\n\n\t\t\t// load material specific uniforms\n\t\t\t// (shader material also gets them for the sake of genericity)\n\n\t\t\tif ( material.isShaderMaterial ||\n\t\t\t\tmaterial.isMeshPhongMaterial ||\n\t\t\t\tmaterial.isMeshToonMaterial ||\n\t\t\t\tmaterial.isMeshStandardMaterial ||\n\t\t\t\tmaterial.envMap ) {\n\n\t\t\t\tconst uCamPos = p_uniforms.map.cameraPosition;\n\n\t\t\t\tif ( uCamPos !== undefined ) {\n\n\t\t\t\t\tuCamPos.setValue( _gl,\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( camera.matrixWorld ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( material.isMeshPhongMaterial ||\n\t\t\t\tmaterial.isMeshToonMaterial ||\n\t\t\t\tmaterial.isMeshLambertMaterial ||\n\t\t\t\tmaterial.isMeshBasicMaterial ||\n\t\t\t\tmaterial.isMeshStandardMaterial ||\n\t\t\t\tmaterial.isShaderMaterial ) {\n\n\t\t\t\tp_uniforms.setValue( _gl, 'isOrthographic', camera.isOrthographicCamera === true );\n\n\t\t\t}\n\n\t\t\tif ( material.isMeshPhongMaterial ||\n\t\t\t\tmaterial.isMeshToonMaterial ||\n\t\t\t\tmaterial.isMeshLambertMaterial ||\n\t\t\t\tmaterial.isMeshBasicMaterial ||\n\t\t\t\tmaterial.isMeshStandardMaterial ||\n\t\t\t\tmaterial.isShaderMaterial ||\n\t\t\t\tmaterial.isShadowMaterial ||\n\t\t\t\tmaterial.skinning ) {\n\n\t\t\t\tp_uniforms.setValue( _gl, 'viewMatrix', camera.matrixWorldInverse );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// skinning uniforms must be set even if material didn't change\n\t\t// auto-setting of texture unit for bone texture must go before other textures\n\t\t// otherwise textures used for skinning can take over texture units reserved for other material textures\n\n\t\tif ( material.skinning ) {\n\n\t\t\tp_uniforms.setOptional( _gl, object, 'bindMatrix' );\n\t\t\tp_uniforms.setOptional( _gl, object, 'bindMatrixInverse' );\n\n\t\t\tconst skeleton = object.skeleton;\n\n\t\t\tif ( skeleton ) {\n\n\t\t\t\tconst bones = skeleton.bones;\n\n\t\t\t\tif ( capabilities.floatVertexTextures ) {\n\n\t\t\t\t\tif ( skeleton.boneTexture === undefined ) {\n\n\t\t\t\t\t\t// layout (1 matrix = 4 pixels)\n\t\t\t\t\t\t//      RGBA RGBA RGBA RGBA (=> column1, column2, column3, column4)\n\t\t\t\t\t\t//  with  8x8  pixel texture max   16 bones * 4 pixels =  (8 * 8)\n\t\t\t\t\t\t//       16x16 pixel texture max   64 bones * 4 pixels = (16 * 16)\n\t\t\t\t\t\t//       32x32 pixel texture max  256 bones * 4 pixels = (32 * 32)\n\t\t\t\t\t\t//       64x64 pixel texture max 1024 bones * 4 pixels = (64 * 64)\n\n\n\t\t\t\t\t\tlet size = Math.sqrt( bones.length * 4 ); // 4 pixels needed for 1 matrix\n\t\t\t\t\t\tsize = MathUtils.ceilPowerOfTwo( size );\n\t\t\t\t\t\tsize = Math.max( size, 4 );\n\n\t\t\t\t\t\tconst boneMatrices = new Float32Array( size * size * 4 ); // 4 floats per RGBA pixel\n\t\t\t\t\t\tboneMatrices.set( skeleton.boneMatrices ); // copy current values\n\n\t\t\t\t\t\tconst boneTexture = new DataTexture( boneMatrices, size, size, RGBAFormat, FloatType );\n\n\t\t\t\t\t\tskeleton.boneMatrices = boneMatrices;\n\t\t\t\t\t\tskeleton.boneTexture = boneTexture;\n\t\t\t\t\t\tskeleton.boneTextureSize = size;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tp_uniforms.setValue( _gl, 'boneTexture', skeleton.boneTexture, textures );\n\t\t\t\t\tp_uniforms.setValue( _gl, 'boneTextureSize', skeleton.boneTextureSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tp_uniforms.setOptional( _gl, skeleton, 'boneMatrices' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( refreshMaterial || materialProperties.receiveShadow !== object.receiveShadow ) {\n\n\t\t\tmaterialProperties.receiveShadow = object.receiveShadow;\n\t\t\tp_uniforms.setValue( _gl, 'receiveShadow', object.receiveShadow );\n\n\t\t}\n\n\t\tif ( refreshMaterial ) {\n\n\t\t\tp_uniforms.setValue( _gl, 'toneMappingExposure', _this.toneMappingExposure );\n\n\t\t\tif ( materialProperties.needsLights ) {\n\n\t\t\t\t// the current material requires lighting info\n\n\t\t\t\t// note: all lighting uniforms are always set correctly\n\t\t\t\t// they simply reference the renderer's state for their\n\t\t\t\t// values\n\t\t\t\t//\n\t\t\t\t// use the current material's .needsUpdate flags to set\n\t\t\t\t// the GL state when required\n\n\t\t\t\tmarkUniformsLightsNeedsUpdate( m_uniforms, refreshLights );\n\n\t\t\t}\n\n\t\t\t// refresh uniforms common to several materials\n\n\t\t\tif ( fog && material.fog ) {\n\n\t\t\t\tmaterials.refreshFogUniforms( m_uniforms, fog );\n\n\t\t\t}\n\n\t\t\tmaterials.refreshMaterialUniforms( m_uniforms, material, environment, _pixelRatio, _height );\n\n\t\t\t// RectAreaLight Texture\n\t\t\t// TODO (mrdoob): Find a nicer implementation\n\n\t\t\tif ( m_uniforms.ltc_1 !== undefined ) m_uniforms.ltc_1.value = UniformsLib.LTC_1;\n\t\t\tif ( m_uniforms.ltc_2 !== undefined ) m_uniforms.ltc_2.value = UniformsLib.LTC_2;\n\n\t\t\tWebGLUniforms.upload( _gl, materialProperties.uniformsList, m_uniforms, textures );\n\n\t\t}\n\n\t\tif ( material.isShaderMaterial && material.uniformsNeedUpdate === true ) {\n\n\t\t\tWebGLUniforms.upload( _gl, materialProperties.uniformsList, m_uniforms, textures );\n\t\t\tmaterial.uniformsNeedUpdate = false;\n\n\t\t}\n\n\t\tif ( material.isSpriteMaterial ) {\n\n\t\t\tp_uniforms.setValue( _gl, 'center', object.center );\n\n\t\t}\n\n\t\t// common matrices\n\n\t\tp_uniforms.setValue( _gl, 'modelViewMatrix', object.modelViewMatrix );\n\t\tp_uniforms.setValue( _gl, 'normalMatrix', object.normalMatrix );\n\t\tp_uniforms.setValue( _gl, 'modelMatrix', object.matrixWorld );\n\n\t\treturn program;\n\n\t}\n\n\t// If uniforms are marked as clean, they don't need to be loaded to the GPU.\n\n\tfunction markUniformsLightsNeedsUpdate( uniforms, value ) {\n\n\t\tuniforms.ambientLightColor.needsUpdate = value;\n\t\tuniforms.lightProbe.needsUpdate = value;\n\n\t\tuniforms.directionalLights.needsUpdate = value;\n\t\tuniforms.directionalLightShadows.needsUpdate = value;\n\t\tuniforms.pointLights.needsUpdate = value;\n\t\tuniforms.pointLightShadows.needsUpdate = value;\n\t\tuniforms.spotLights.needsUpdate = value;\n\t\tuniforms.spotLightShadows.needsUpdate = value;\n\t\tuniforms.rectAreaLights.needsUpdate = value;\n\t\tuniforms.hemisphereLights.needsUpdate = value;\n\n\t}\n\n\tfunction materialNeedsLights( material ) {\n\n\t\treturn material.isMeshLambertMaterial || material.isMeshToonMaterial || material.isMeshPhongMaterial ||\n\t\t\tmaterial.isMeshStandardMaterial || material.isShadowMaterial ||\n\t\t\t( material.isShaderMaterial && material.lights === true );\n\n\t}\n\n\t//\n\tthis.setFramebuffer = function ( value ) {\n\n\t\tif ( _framebuffer !== value && _currentRenderTarget === null ) _gl.bindFramebuffer( _gl.FRAMEBUFFER, value );\n\n\t\t_framebuffer = value;\n\n\t};\n\n\tthis.getActiveCubeFace = function () {\n\n\t\treturn _currentActiveCubeFace;\n\n\t};\n\n\tthis.getActiveMipmapLevel = function () {\n\n\t\treturn _currentActiveMipmapLevel;\n\n\t};\n\n\tthis.getRenderTarget = function () {\n\n\t\treturn _currentRenderTarget;\n\n\t};\n\n\tthis.setRenderTarget = function ( renderTarget, activeCubeFace, activeMipmapLevel ) {\n\n\t\t_currentRenderTarget = renderTarget;\n\t\t_currentActiveCubeFace = activeCubeFace;\n\t\t_currentActiveMipmapLevel = activeMipmapLevel;\n\n\t\tif ( renderTarget && properties.get( renderTarget ).__webglFramebuffer === undefined ) {\n\n\t\t\ttextures.setupRenderTarget( renderTarget );\n\n\t\t}\n\n\t\tlet framebuffer = _framebuffer;\n\t\tlet isCube = false;\n\n\t\tif ( renderTarget ) {\n\n\t\t\tconst __webglFramebuffer = properties.get( renderTarget ).__webglFramebuffer;\n\n\t\t\tif ( renderTarget.isWebGLCubeRenderTarget ) {\n\n\t\t\t\tframebuffer = __webglFramebuffer[ activeCubeFace || 0 ];\n\t\t\t\tisCube = true;\n\n\t\t\t} else if ( renderTarget.isWebGLMultisampleRenderTarget ) {\n\n\t\t\t\tframebuffer = properties.get( renderTarget ).__webglMultisampledFramebuffer;\n\n\t\t\t} else {\n\n\t\t\t\tframebuffer = __webglFramebuffer;\n\n\t\t\t}\n\n\t\t\t_currentViewport.copy( renderTarget.viewport );\n\t\t\t_currentScissor.copy( renderTarget.scissor );\n\t\t\t_currentScissorTest = renderTarget.scissorTest;\n\n\t\t} else {\n\n\t\t\t_currentViewport.copy( _viewport ).multiplyScalar( _pixelRatio ).floor();\n\t\t\t_currentScissor.copy( _scissor ).multiplyScalar( _pixelRatio ).floor();\n\t\t\t_currentScissorTest = _scissorTest;\n\n\t\t}\n\n\t\tif ( _currentFramebuffer !== framebuffer ) {\n\n\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\n\t\t\t_currentFramebuffer = framebuffer;\n\n\t\t}\n\n\t\tstate.viewport( _currentViewport );\n\t\tstate.scissor( _currentScissor );\n\t\tstate.setScissorTest( _currentScissorTest );\n\n\t\tif ( isCube ) {\n\n\t\t\tconst textureProperties = properties.get( renderTarget.texture );\n\t\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + ( activeCubeFace || 0 ), textureProperties.__webglTexture, activeMipmapLevel || 0 );\n\n\t\t}\n\n\t};\n\n\tthis.readRenderTargetPixels = function ( renderTarget, x, y, width, height, buffer, activeCubeFaceIndex ) {\n\n\t\tif ( ! ( renderTarget && renderTarget.isWebGLRenderTarget ) ) {\n\n\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tlet framebuffer = properties.get( renderTarget ).__webglFramebuffer;\n\n\t\tif ( renderTarget.isWebGLCubeRenderTarget && activeCubeFaceIndex !== undefined ) {\n\n\t\t\tframebuffer = framebuffer[ activeCubeFaceIndex ];\n\n\t\t}\n\n\t\tif ( framebuffer ) {\n\n\t\t\tlet restore = false;\n\n\t\t\tif ( framebuffer !== _currentFramebuffer ) {\n\n\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\n\n\t\t\t\trestore = true;\n\n\t\t\t}\n\n\t\t\ttry {\n\n\t\t\t\tconst texture = renderTarget.texture;\n\t\t\t\tconst textureFormat = texture.format;\n\t\t\t\tconst textureType = texture.type;\n\n\t\t\t\tif ( textureFormat !== RGBAFormat && utils.convert( textureFormat ) !== _gl.getParameter( _gl.IMPLEMENTATION_COLOR_READ_FORMAT ) ) {\n\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.' );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tif ( textureType !== UnsignedByteType && utils.convert( textureType ) !== _gl.getParameter( _gl.IMPLEMENTATION_COLOR_READ_TYPE ) && // IE11, Edge and Chrome Mac < 52 (#9513)\n\t\t\t\t\t! ( textureType === FloatType && ( capabilities.isWebGL2 || extensions.get( 'OES_texture_float' ) || extensions.get( 'WEBGL_color_buffer_float' ) ) ) && // Chrome Mac >= 52 and Firefox\n\t\t\t\t\t! ( textureType === HalfFloatType && ( capabilities.isWebGL2 ? extensions.get( 'EXT_color_buffer_float' ) : extensions.get( 'EXT_color_buffer_half_float' ) ) ) ) {\n\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.' );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tif ( _gl.checkFramebufferStatus( _gl.FRAMEBUFFER ) === _gl.FRAMEBUFFER_COMPLETE ) {\n\n\t\t\t\t\t// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)\n\n\t\t\t\t\tif ( ( x >= 0 && x <= ( renderTarget.width - width ) ) && ( y >= 0 && y <= ( renderTarget.height - height ) ) ) {\n\n\t\t\t\t\t\t_gl.readPixels( x, y, width, height, utils.convert( textureFormat ), utils.convert( textureType ), buffer );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.' );\n\n\t\t\t\t}\n\n\t\t\t} finally {\n\n\t\t\t\tif ( restore ) {\n\n\t\t\t\t\t_gl.bindFramebuffer( _gl.FRAMEBUFFER, _currentFramebuffer );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.copyFramebufferToTexture = function ( position, texture, level ) {\n\n\t\tif ( level === undefined ) level = 0;\n\n\t\tconst levelScale = Math.pow( 2, - level );\n\t\tconst width = Math.floor( texture.image.width * levelScale );\n\t\tconst height = Math.floor( texture.image.height * levelScale );\n\t\tconst glFormat = utils.convert( texture.format );\n\n\t\ttextures.setTexture2D( texture, 0 );\n\n\t\t_gl.copyTexImage2D( _gl.TEXTURE_2D, level, glFormat, position.x, position.y, width, height, 0 );\n\n\t\tstate.unbindTexture();\n\n\t};\n\n\tthis.copyTextureToTexture = function ( position, srcTexture, dstTexture, level ) {\n\n\t\tif ( level === undefined ) level = 0;\n\n\t\tconst width = srcTexture.image.width;\n\t\tconst height = srcTexture.image.height;\n\t\tconst glFormat = utils.convert( dstTexture.format );\n\t\tconst glType = utils.convert( dstTexture.type );\n\n\t\ttextures.setTexture2D( dstTexture, 0 );\n\n\t\t// As another texture upload may have changed pixelStorei\n\t\t// parameters, make sure they are correct for the dstTexture\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, dstTexture.flipY );\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, dstTexture.premultiplyAlpha );\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, dstTexture.unpackAlignment );\n\n\t\tif ( srcTexture.isDataTexture ) {\n\n\t\t\t_gl.texSubImage2D( _gl.TEXTURE_2D, level, position.x, position.y, width, height, glFormat, glType, srcTexture.image.data );\n\n\t\t} else {\n\n\t\t\tif ( srcTexture.isCompressedTexture ) {\n\n\t\t\t\t_gl.compressedTexSubImage2D( _gl.TEXTURE_2D, level, position.x, position.y, srcTexture.mipmaps[ 0 ].width, srcTexture.mipmaps[ 0 ].height, glFormat, srcTexture.mipmaps[ 0 ].data );\n\n\t\t\t} else {\n\n\t\t\t\t_gl.texSubImage2D( _gl.TEXTURE_2D, level, position.x, position.y, glFormat, glType, srcTexture.image );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Generate mipmaps only when copying level 0\n\t\tif ( level === 0 && dstTexture.generateMipmaps ) _gl.generateMipmap( _gl.TEXTURE_2D );\n\n\t\tstate.unbindTexture();\n\n\t};\n\n\tthis.initTexture = function ( texture ) {\n\n\t\ttextures.setTexture2D( texture, 0 );\n\n\t\tstate.unbindTexture();\n\n\t};\n\n\tif ( typeof __THREE_DEVTOOLS__ !== 'undefined' ) {\n\n\t\t__THREE_DEVTOOLS__.dispatchEvent( new CustomEvent( 'observe', { detail: this } ) ); // eslint-disable-line no-undef\n\n\t}\n\n}\n\nexport { WebGLRenderer };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport { Color } from '../math/Color.js';\n\nfunction Fog( color, near, far ) {\n\n\tthis.name = '';\n\n\tthis.color = new Color( color );\n\n\tthis.near = ( near !== undefined ) ? near : 1;\n\tthis.far = ( far !== undefined ) ? far : 1000;\n\n}\n\nObject.assign( Fog.prototype, {\n\n\tisFog: true,\n\n\tclone: function () {\n\n\t\treturn new Fog( this.color, this.near, this.far );\n\n\t},\n\n\ttoJSON: function ( /* meta */ ) {\n\n\t\treturn {\n\t\t\ttype: 'Fog',\n\t\t\tcolor: this.color.getHex(),\n\t\t\tnear: this.near,\n\t\t\tfar: this.far\n\t\t};\n\n\t}\n\n} );\n\nexport { Fog };\n","import { Material } from './Material.js';\nimport { Color } from '../math/Color.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *\n *  linewidth: <float>,\n *  linecap: \"round\",\n *  linejoin: \"round\"\n * }\n */\n\nfunction LineBasicMaterial( parameters ) {\n\n\tMaterial.call( this );\n\n\tthis.type = 'LineBasicMaterial';\n\n\tthis.color = new Color( 0xffffff );\n\n\tthis.linewidth = 1;\n\tthis.linecap = 'round';\n\tthis.linejoin = 'round';\n\n\tthis.morphTargets = false;\n\n\tthis.setValues( parameters );\n\n}\n\nLineBasicMaterial.prototype = Object.create( Material.prototype );\nLineBasicMaterial.prototype.constructor = LineBasicMaterial;\n\nLineBasicMaterial.prototype.isLineBasicMaterial = true;\n\nLineBasicMaterial.prototype.copy = function ( source ) {\n\n\tMaterial.prototype.copy.call( this, source );\n\n\tthis.color.copy( source.color );\n\n\tthis.linewidth = source.linewidth;\n\tthis.linecap = source.linecap;\n\tthis.linejoin = source.linejoin;\n\n\tthis.morphTargets = source.morphTargets;\n\n\treturn this;\n\n};\n\n\nexport { LineBasicMaterial };\n","import { Sphere } from '../math/Sphere.js';\nimport { Ray } from '../math/Ray.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { Object3D } from '../core/Object3D.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { LineBasicMaterial } from '../materials/LineBasicMaterial.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nconst _start = new Vector3();\nconst _end = new Vector3();\nconst _inverseMatrix = new Matrix4();\nconst _ray = new Ray();\nconst _sphere = new Sphere();\n\nfunction Line( geometry, material, mode ) {\n\n\tif ( mode === 1 ) {\n\n\t\tconsole.error( 'THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead.' );\n\n\t}\n\n\tObject3D.call( this );\n\n\tthis.type = 'Line';\n\n\tthis.geometry = geometry !== undefined ? geometry : new BufferGeometry();\n\tthis.material = material !== undefined ? material : new LineBasicMaterial();\n\n\tthis.updateMorphTargets();\n\n}\n\nLine.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Line,\n\n\tisLine: true,\n\n\tcopy: function ( source ) {\n\n\t\tObject3D.prototype.copy.call( this, source );\n\n\t\tthis.material = source.material;\n\t\tthis.geometry = source.geometry;\n\n\t\treturn this;\n\n\t},\n\n\tcomputeLineDistances: function () {\n\n\t\tconst geometry = this.geometry;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\t// we assume non-indexed geometry\n\n\t\t\tif ( geometry.index === null ) {\n\n\t\t\t\tconst positionAttribute = geometry.attributes.position;\n\t\t\t\tconst lineDistances = [ 0 ];\n\n\t\t\t\tfor ( let i = 1, l = positionAttribute.count; i < l; i ++ ) {\n\n\t\t\t\t\t_start.fromBufferAttribute( positionAttribute, i - 1 );\n\t\t\t\t\t_end.fromBufferAttribute( positionAttribute, i );\n\n\t\t\t\t\tlineDistances[ i ] = lineDistances[ i - 1 ];\n\t\t\t\t\tlineDistances[ i ] += _start.distanceTo( _end );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setAttribute( 'lineDistance', new Float32BufferAttribute( lineDistances, 1 ) );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.' );\n\n\t\t\t}\n\n\t\t} else if ( geometry.isGeometry ) {\n\n\t\t\tconst vertices = geometry.vertices;\n\t\t\tconst lineDistances = geometry.lineDistances;\n\n\t\t\tlineDistances[ 0 ] = 0;\n\n\t\t\tfor ( let i = 1, l = vertices.length; i < l; i ++ ) {\n\n\t\t\t\tlineDistances[ i ] = lineDistances[ i - 1 ];\n\t\t\t\tlineDistances[ i ] += vertices[ i - 1 ].distanceTo( vertices[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t},\n\n\traycast: function ( raycaster, intersects ) {\n\n\t\tconst geometry = this.geometry;\n\t\tconst matrixWorld = this.matrixWorld;\n\t\tconst threshold = raycaster.params.Line.threshold;\n\n\t\t// Checking boundingSphere distance to ray\n\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\n\n\t\t_sphere.copy( geometry.boundingSphere );\n\t\t_sphere.applyMatrix4( matrixWorld );\n\t\t_sphere.radius += threshold;\n\n\t\tif ( raycaster.ray.intersectsSphere( _sphere ) === false ) return;\n\n\t\t//\n\n\t\t_inverseMatrix.getInverse( matrixWorld );\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\n\n\t\tconst localThreshold = threshold / ( ( this.scale.x + this.scale.y + this.scale.z ) / 3 );\n\t\tconst localThresholdSq = localThreshold * localThreshold;\n\n\t\tconst vStart = new Vector3();\n\t\tconst vEnd = new Vector3();\n\t\tconst interSegment = new Vector3();\n\t\tconst interRay = new Vector3();\n\t\tconst step = ( this && this.isLineSegments ) ? 2 : 1;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tconst index = geometry.index;\n\t\t\tconst attributes = geometry.attributes;\n\t\t\tconst positions = attributes.position.array;\n\n\t\t\tif ( index !== null ) {\n\n\t\t\t\tconst indices = index.array;\n\n\t\t\t\tfor ( let i = 0, l = indices.length - 1; i < l; i += step ) {\n\n\t\t\t\t\tconst a = indices[ i ];\n\t\t\t\t\tconst b = indices[ i + 1 ];\n\n\t\t\t\t\tvStart.fromArray( positions, a * 3 );\n\t\t\t\t\tvEnd.fromArray( positions, b * 3 );\n\n\t\t\t\t\tconst distSq = _ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\n\n\t\t\t\t\tif ( distSq > localThresholdSq ) continue;\n\n\t\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\n\n\t\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( interRay );\n\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\n\n\t\t\t\t\tintersects.push( {\n\n\t\t\t\t\t\tdistance: distance,\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\n\t\t\t\t\t\tindex: i,\n\t\t\t\t\t\tface: null,\n\t\t\t\t\t\tfaceIndex: null,\n\t\t\t\t\t\tobject: this\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( let i = 0, l = positions.length / 3 - 1; i < l; i += step ) {\n\n\t\t\t\t\tvStart.fromArray( positions, 3 * i );\n\t\t\t\t\tvEnd.fromArray( positions, 3 * i + 3 );\n\n\t\t\t\t\tconst distSq = _ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\n\n\t\t\t\t\tif ( distSq > localThresholdSq ) continue;\n\n\t\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\n\n\t\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( interRay );\n\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\n\n\t\t\t\t\tintersects.push( {\n\n\t\t\t\t\t\tdistance: distance,\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\n\t\t\t\t\t\tindex: i,\n\t\t\t\t\t\tface: null,\n\t\t\t\t\t\tfaceIndex: null,\n\t\t\t\t\t\tobject: this\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( geometry.isGeometry ) {\n\n\t\t\tconst vertices = geometry.vertices;\n\t\t\tconst nbVertices = vertices.length;\n\n\t\t\tfor ( let i = 0; i < nbVertices - 1; i += step ) {\n\n\t\t\t\tconst distSq = _ray.distanceSqToSegment( vertices[ i ], vertices[ i + 1 ], interRay, interSegment );\n\n\t\t\t\tif ( distSq > localThresholdSq ) continue;\n\n\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\n\n\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( interRay );\n\n\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\n\n\t\t\t\tintersects.push( {\n\n\t\t\t\t\tdistance: distance,\n\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\n\t\t\t\t\t// point: raycaster.ray.at( distance ),\n\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\n\t\t\t\t\tindex: i,\n\t\t\t\t\tface: null,\n\t\t\t\t\tfaceIndex: null,\n\t\t\t\t\tobject: this\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\tupdateMorphTargets: function () {\n\n\t\tconst geometry = this.geometry;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tconst morphAttributes = geometry.morphAttributes;\n\t\t\tconst keys = Object.keys( morphAttributes );\n\n\t\t\tif ( keys.length > 0 ) {\n\n\t\t\t\tconst morphAttribute = morphAttributes[ keys[ 0 ] ];\n\n\t\t\t\tif ( morphAttribute !== undefined ) {\n\n\t\t\t\t\tthis.morphTargetInfluences = [];\n\t\t\t\t\tthis.morphTargetDictionary = {};\n\n\t\t\t\t\tfor ( let m = 0, ml = morphAttribute.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\tconst name = morphAttribute[ m ].name || String( m );\n\n\t\t\t\t\t\tthis.morphTargetInfluences.push( 0 );\n\t\t\t\t\t\tthis.morphTargetDictionary[ name ] = m;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst morphTargets = geometry.morphTargets;\n\n\t\t\tif ( morphTargets !== undefined && morphTargets.length > 0 ) {\n\n\t\t\t\tconsole.error( 'THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.' );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n} );\n\n\nexport { Line };\n","import { Line } from './Line.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nconst _start = new Vector3();\nconst _end = new Vector3();\n\nfunction LineSegments( geometry, material ) {\n\n\tLine.call( this, geometry, material );\n\n\tthis.type = 'LineSegments';\n\n}\n\nLineSegments.prototype = Object.assign( Object.create( Line.prototype ), {\n\n\tconstructor: LineSegments,\n\n\tisLineSegments: true,\n\n\tcomputeLineDistances: function () {\n\n\t\tconst geometry = this.geometry;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\t// we assume non-indexed geometry\n\n\t\t\tif ( geometry.index === null ) {\n\n\t\t\t\tconst positionAttribute = geometry.attributes.position;\n\t\t\t\tconst lineDistances = [];\n\n\t\t\t\tfor ( let i = 0, l = positionAttribute.count; i < l; i += 2 ) {\n\n\t\t\t\t\t_start.fromBufferAttribute( positionAttribute, i );\n\t\t\t\t\t_end.fromBufferAttribute( positionAttribute, i + 1 );\n\n\t\t\t\t\tlineDistances[ i ] = ( i === 0 ) ? 0 : lineDistances[ i - 1 ];\n\t\t\t\t\tlineDistances[ i + 1 ] = lineDistances[ i ] + _start.distanceTo( _end );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setAttribute( 'lineDistance', new Float32BufferAttribute( lineDistances, 1 ) );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.' );\n\n\t\t\t}\n\n\t\t} else if ( geometry.isGeometry ) {\n\n\t\t\tconst vertices = geometry.vertices;\n\t\t\tconst lineDistances = geometry.lineDistances;\n\n\t\t\tfor ( let i = 0, l = vertices.length; i < l; i += 2 ) {\n\n\t\t\t\t_start.copy( vertices[ i ] );\n\t\t\t\t_end.copy( vertices[ i + 1 ] );\n\n\t\t\t\tlineDistances[ i ] = ( i === 0 ) ? 0 : lineDistances[ i - 1 ];\n\t\t\t\tlineDistances[ i + 1 ] = lineDistances[ i ] + _start.distanceTo( _end );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { LineSegments };\n","import { Material } from './Material.js';\nimport { Color } from '../math/Color.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n *\n * parameters = {\n *  color: <hex>,\n *  opacity: <float>,\n *  map: new THREE.Texture( <Image> ),\n *  alphaMap: new THREE.Texture( <Image> ),\n *\n *  size: <float>,\n *  sizeAttenuation: <bool>\n *\n *  morphTargets: <bool>\n * }\n */\n\nfunction PointsMaterial( parameters ) {\n\n\tMaterial.call( this );\n\n\tthis.type = 'PointsMaterial';\n\n\tthis.color = new Color( 0xffffff );\n\n\tthis.map = null;\n\n\tthis.alphaMap = null;\n\n\tthis.size = 1;\n\tthis.sizeAttenuation = true;\n\n\tthis.morphTargets = false;\n\n\tthis.setValues( parameters );\n\n}\n\nPointsMaterial.prototype = Object.create( Material.prototype );\nPointsMaterial.prototype.constructor = PointsMaterial;\n\nPointsMaterial.prototype.isPointsMaterial = true;\n\nPointsMaterial.prototype.copy = function ( source ) {\n\n\tMaterial.prototype.copy.call( this, source );\n\n\tthis.color.copy( source.color );\n\n\tthis.map = source.map;\n\n\tthis.alphaMap = source.alphaMap;\n\n\tthis.size = source.size;\n\tthis.sizeAttenuation = source.sizeAttenuation;\n\n\tthis.morphTargets = source.morphTargets;\n\n\treturn this;\n\n};\n\n\nexport { PointsMaterial };\n","import { Sphere } from '../math/Sphere.js';\nimport { Ray } from '../math/Ray.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { Object3D } from '../core/Object3D.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { PointsMaterial } from '../materials/PointsMaterial.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\n\n/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nconst _inverseMatrix = new Matrix4();\nconst _ray = new Ray();\nconst _sphere = new Sphere();\nconst _position = new Vector3();\n\nfunction Points( geometry, material ) {\n\n\tObject3D.call( this );\n\n\tthis.type = 'Points';\n\n\tthis.geometry = geometry !== undefined ? geometry : new BufferGeometry();\n\tthis.material = material !== undefined ? material : new PointsMaterial();\n\n\tthis.updateMorphTargets();\n\n}\n\nPoints.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Points,\n\n\tisPoints: true,\n\n\tcopy: function ( source ) {\n\n\t\tObject3D.prototype.copy.call( this, source );\n\n\t\tthis.material = source.material;\n\t\tthis.geometry = source.geometry;\n\n\t\treturn this;\n\n\t},\n\n\traycast: function ( raycaster, intersects ) {\n\n\t\tconst geometry = this.geometry;\n\t\tconst matrixWorld = this.matrixWorld;\n\t\tconst threshold = raycaster.params.Points.threshold;\n\n\t\t// Checking boundingSphere distance to ray\n\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\n\n\t\t_sphere.copy( geometry.boundingSphere );\n\t\t_sphere.applyMatrix4( matrixWorld );\n\t\t_sphere.radius += threshold;\n\n\t\tif ( raycaster.ray.intersectsSphere( _sphere ) === false ) return;\n\n\t\t//\n\n\t\t_inverseMatrix.getInverse( matrixWorld );\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\n\n\t\tconst localThreshold = threshold / ( ( this.scale.x + this.scale.y + this.scale.z ) / 3 );\n\t\tconst localThresholdSq = localThreshold * localThreshold;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tconst index = geometry.index;\n\t\t\tconst attributes = geometry.attributes;\n\t\t\tconst positions = attributes.position.array;\n\n\t\t\tif ( index !== null ) {\n\n\t\t\t\tconst indices = index.array;\n\n\t\t\t\tfor ( let i = 0, il = indices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst a = indices[ i ];\n\n\t\t\t\t\t_position.fromArray( positions, a * 3 );\n\n\t\t\t\t\ttestPoint( _position, a, localThresholdSq, matrixWorld, raycaster, intersects, this );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( let i = 0, l = positions.length / 3; i < l; i ++ ) {\n\n\t\t\t\t\t_position.fromArray( positions, i * 3 );\n\n\t\t\t\t\ttestPoint( _position, i, localThresholdSq, matrixWorld, raycaster, intersects, this );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst vertices = geometry.vertices;\n\n\t\t\tfor ( let i = 0, l = vertices.length; i < l; i ++ ) {\n\n\t\t\t\ttestPoint( vertices[ i ], i, localThresholdSq, matrixWorld, raycaster, intersects, this );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\tupdateMorphTargets: function () {\n\n\t\tconst geometry = this.geometry;\n\n\t\tif ( geometry.isBufferGeometry ) {\n\n\t\t\tconst morphAttributes = geometry.morphAttributes;\n\t\t\tconst keys = Object.keys( morphAttributes );\n\n\t\t\tif ( keys.length > 0 ) {\n\n\t\t\t\tconst morphAttribute = morphAttributes[ keys[ 0 ] ];\n\n\t\t\t\tif ( morphAttribute !== undefined ) {\n\n\t\t\t\t\tthis.morphTargetInfluences = [];\n\t\t\t\t\tthis.morphTargetDictionary = {};\n\n\t\t\t\t\tfor ( let m = 0, ml = morphAttribute.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\tconst name = morphAttribute[ m ].name || String( m );\n\n\t\t\t\t\t\tthis.morphTargetInfluences.push( 0 );\n\t\t\t\t\t\tthis.morphTargetDictionary[ name ] = m;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst morphTargets = geometry.morphTargets;\n\n\t\t\tif ( morphTargets !== undefined && morphTargets.length > 0 ) {\n\n\t\t\t\tconsole.error( 'THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.' );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n} );\n\nfunction testPoint( point, index, localThresholdSq, matrixWorld, raycaster, intersects, object ) {\n\n\tconst rayPointDistanceSq = _ray.distanceSqToPoint( point );\n\n\tif ( rayPointDistanceSq < localThresholdSq ) {\n\n\t\tconst intersectPoint = new Vector3();\n\n\t\t_ray.closestPointToPoint( point, intersectPoint );\n\t\tintersectPoint.applyMatrix4( matrixWorld );\n\n\t\tconst distance = raycaster.ray.origin.distanceTo( intersectPoint );\n\n\t\tif ( distance < raycaster.near || distance > raycaster.far ) return;\n\n\t\tintersects.push( {\n\n\t\t\tdistance: distance,\n\t\t\tdistanceToRay: Math.sqrt( rayPointDistanceSq ),\n\t\t\tpoint: intersectPoint,\n\t\t\tindex: index,\n\t\t\tface: null,\n\t\t\tobject: object\n\n\t\t} );\n\n\t}\n\n}\n\nexport { Points };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport { Texture } from './Texture.js';\n\nfunction CanvasTexture( canvas, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy ) {\n\n\tTexture.call( this, canvas, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy );\n\n\tthis.needsUpdate = true;\n\n}\n\nCanvasTexture.prototype = Object.create( Texture.prototype );\nCanvasTexture.prototype.constructor = CanvasTexture;\nCanvasTexture.prototype.isCanvasTexture = true;\n\nexport { CanvasTexture };\n","/**\n * @author clockworkgeek / https://github.com/clockworkgeek\n * @author timothypratley / https://github.com/timothypratley\n * @author WestLangley / http://github.com/WestLangley\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector2 } from '../math/Vector2.js';\n\n// PolyhedronGeometry\n\nfunction PolyhedronGeometry( vertices, indices, radius, detail ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'PolyhedronGeometry';\n\n\tthis.parameters = {\n\t\tvertices: vertices,\n\t\tindices: indices,\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n\tthis.fromBufferGeometry( new PolyhedronBufferGeometry( vertices, indices, radius, detail ) );\n\tthis.mergeVertices();\n\n}\n\nPolyhedronGeometry.prototype = Object.create( Geometry.prototype );\nPolyhedronGeometry.prototype.constructor = PolyhedronGeometry;\n\n// PolyhedronBufferGeometry\n\nfunction PolyhedronBufferGeometry( vertices, indices, radius, detail ) {\n\n\tBufferGeometry.call( this );\n\n\tthis.type = 'PolyhedronBufferGeometry';\n\n\tthis.parameters = {\n\t\tvertices: vertices,\n\t\tindices: indices,\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n\tradius = radius || 1;\n\tdetail = detail || 0;\n\n\t// default buffer data\n\n\tconst vertexBuffer = [];\n\tconst uvBuffer = [];\n\n\t// the subdivision creates the vertex buffer data\n\n\tsubdivide( detail );\n\n\t// all vertices should lie on a conceptual sphere with a given radius\n\n\tapplyRadius( radius );\n\n\t// finally, create the uv data\n\n\tgenerateUVs();\n\n\t// build non-indexed geometry\n\n\tthis.setAttribute( 'position', new Float32BufferAttribute( vertexBuffer, 3 ) );\n\tthis.setAttribute( 'normal', new Float32BufferAttribute( vertexBuffer.slice(), 3 ) );\n\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvBuffer, 2 ) );\n\n\tif ( detail === 0 ) {\n\n\t\tthis.computeVertexNormals(); // flat normals\n\n\t} else {\n\n\t\tthis.normalizeNormals(); // smooth normals\n\n\t}\n\n\t// helper functions\n\n\tfunction subdivide( detail ) {\n\n\t\tconst a = new Vector3();\n\t\tconst b = new Vector3();\n\t\tconst c = new Vector3();\n\n\t\t// iterate over all faces and apply a subdivison with the given detail value\n\n\t\tfor ( let i = 0; i < indices.length; i += 3 ) {\n\n\t\t\t// get the vertices of the face\n\n\t\t\tgetVertexByIndex( indices[ i + 0 ], a );\n\t\t\tgetVertexByIndex( indices[ i + 1 ], b );\n\t\t\tgetVertexByIndex( indices[ i + 2 ], c );\n\n\t\t\t// perform subdivision\n\n\t\t\tsubdivideFace( a, b, c, detail );\n\n\t\t}\n\n\t}\n\n\tfunction subdivideFace( a, b, c, detail ) {\n\n\t\tconst cols = Math.pow( 2, detail );\n\n\t\t// we use this multidimensional array as a data structure for creating the subdivision\n\n\t\tconst v = [];\n\n\t\t// construct all of the vertices for this subdivision\n\n\t\tfor ( let i = 0; i <= cols; i ++ ) {\n\n\t\t\tv[ i ] = [];\n\n\t\t\tconst aj = a.clone().lerp( c, i / cols );\n\t\t\tconst bj = b.clone().lerp( c, i / cols );\n\n\t\t\tconst rows = cols - i;\n\n\t\t\tfor ( let j = 0; j <= rows; j ++ ) {\n\n\t\t\t\tif ( j === 0 && i === cols ) {\n\n\t\t\t\t\tv[ i ][ j ] = aj;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tv[ i ][ j ] = aj.clone().lerp( bj, j / rows );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// construct all of the faces\n\n\t\tfor ( let i = 0; i < cols; i ++ ) {\n\n\t\t\tfor ( let j = 0; j < 2 * ( cols - i ) - 1; j ++ ) {\n\n\t\t\t\tconst k = Math.floor( j / 2 );\n\n\t\t\t\tif ( j % 2 === 0 ) {\n\n\t\t\t\t\tpushVertex( v[ i ][ k + 1 ] );\n\t\t\t\t\tpushVertex( v[ i + 1 ][ k ] );\n\t\t\t\t\tpushVertex( v[ i ][ k ] );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tpushVertex( v[ i ][ k + 1 ] );\n\t\t\t\t\tpushVertex( v[ i + 1 ][ k + 1 ] );\n\t\t\t\t\tpushVertex( v[ i + 1 ][ k ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction applyRadius( radius ) {\n\n\t\tconst vertex = new Vector3();\n\n\t\t// iterate over the entire buffer and apply the radius to each vertex\n\n\t\tfor ( let i = 0; i < vertexBuffer.length; i += 3 ) {\n\n\t\t\tvertex.x = vertexBuffer[ i + 0 ];\n\t\t\tvertex.y = vertexBuffer[ i + 1 ];\n\t\t\tvertex.z = vertexBuffer[ i + 2 ];\n\n\t\t\tvertex.normalize().multiplyScalar( radius );\n\n\t\t\tvertexBuffer[ i + 0 ] = vertex.x;\n\t\t\tvertexBuffer[ i + 1 ] = vertex.y;\n\t\t\tvertexBuffer[ i + 2 ] = vertex.z;\n\n\t\t}\n\n\t}\n\n\tfunction generateUVs() {\n\n\t\tconst vertex = new Vector3();\n\n\t\tfor ( let i = 0; i < vertexBuffer.length; i += 3 ) {\n\n\t\t\tvertex.x = vertexBuffer[ i + 0 ];\n\t\t\tvertex.y = vertexBuffer[ i + 1 ];\n\t\t\tvertex.z = vertexBuffer[ i + 2 ];\n\n\t\t\tconst u = azimuth( vertex ) / 2 / Math.PI + 0.5;\n\t\t\tconst v = inclination( vertex ) / Math.PI + 0.5;\n\t\t\tuvBuffer.push( u, 1 - v );\n\n\t\t}\n\n\t\tcorrectUVs();\n\n\t\tcorrectSeam();\n\n\t}\n\n\tfunction correctSeam() {\n\n\t\t// handle case when face straddles the seam, see #3269\n\n\t\tfor ( let i = 0; i < uvBuffer.length; i += 6 ) {\n\n\t\t\t// uv data of a single face\n\n\t\t\tconst x0 = uvBuffer[ i + 0 ];\n\t\t\tconst x1 = uvBuffer[ i + 2 ];\n\t\t\tconst x2 = uvBuffer[ i + 4 ];\n\n\t\t\tconst max = Math.max( x0, x1, x2 );\n\t\t\tconst min = Math.min( x0, x1, x2 );\n\n\t\t\t// 0.9 is somewhat arbitrary\n\n\t\t\tif ( max > 0.9 && min < 0.1 ) {\n\n\t\t\t\tif ( x0 < 0.2 ) uvBuffer[ i + 0 ] += 1;\n\t\t\t\tif ( x1 < 0.2 ) uvBuffer[ i + 2 ] += 1;\n\t\t\t\tif ( x2 < 0.2 ) uvBuffer[ i + 4 ] += 1;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction pushVertex( vertex ) {\n\n\t\tvertexBuffer.push( vertex.x, vertex.y, vertex.z );\n\n\t}\n\n\tfunction getVertexByIndex( index, vertex ) {\n\n\t\tconst stride = index * 3;\n\n\t\tvertex.x = vertices[ stride + 0 ];\n\t\tvertex.y = vertices[ stride + 1 ];\n\t\tvertex.z = vertices[ stride + 2 ];\n\n\t}\n\n\tfunction correctUVs() {\n\n\t\tconst a = new Vector3();\n\t\tconst b = new Vector3();\n\t\tconst c = new Vector3();\n\n\t\tconst centroid = new Vector3();\n\n\t\tconst uvA = new Vector2();\n\t\tconst uvB = new Vector2();\n\t\tconst uvC = new Vector2();\n\n\t\tfor ( let i = 0, j = 0; i < vertexBuffer.length; i += 9, j += 6 ) {\n\n\t\t\ta.set( vertexBuffer[ i + 0 ], vertexBuffer[ i + 1 ], vertexBuffer[ i + 2 ] );\n\t\t\tb.set( vertexBuffer[ i + 3 ], vertexBuffer[ i + 4 ], vertexBuffer[ i + 5 ] );\n\t\t\tc.set( vertexBuffer[ i + 6 ], vertexBuffer[ i + 7 ], vertexBuffer[ i + 8 ] );\n\n\t\t\tuvA.set( uvBuffer[ j + 0 ], uvBuffer[ j + 1 ] );\n\t\t\tuvB.set( uvBuffer[ j + 2 ], uvBuffer[ j + 3 ] );\n\t\t\tuvC.set( uvBuffer[ j + 4 ], uvBuffer[ j + 5 ] );\n\n\t\t\tcentroid.copy( a ).add( b ).add( c ).divideScalar( 3 );\n\n\t\t\tconst azi = azimuth( centroid );\n\n\t\t\tcorrectUV( uvA, j + 0, a, azi );\n\t\t\tcorrectUV( uvB, j + 2, b, azi );\n\t\t\tcorrectUV( uvC, j + 4, c, azi );\n\n\t\t}\n\n\t}\n\n\tfunction correctUV( uv, stride, vector, azimuth ) {\n\n\t\tif ( ( azimuth < 0 ) && ( uv.x === 1 ) ) {\n\n\t\t\tuvBuffer[ stride ] = uv.x - 1;\n\n\t\t}\n\n\t\tif ( ( vector.x === 0 ) && ( vector.z === 0 ) ) {\n\n\t\t\tuvBuffer[ stride ] = azimuth / 2 / Math.PI + 0.5;\n\n\t\t}\n\n\t}\n\n\t// Angle around the Y axis, counter-clockwise when looking from above.\n\n\tfunction azimuth( vector ) {\n\n\t\treturn Math.atan2( vector.z, - vector.x );\n\n\t}\n\n\n\t// Angle above the XZ plane.\n\n\tfunction inclination( vector ) {\n\n\t\treturn Math.atan2( - vector.y, Math.sqrt( ( vector.x * vector.x ) + ( vector.z * vector.z ) ) );\n\n\t}\n\n}\n\nPolyhedronBufferGeometry.prototype = Object.create( BufferGeometry.prototype );\nPolyhedronBufferGeometry.prototype.constructor = PolyhedronBufferGeometry;\n\n\nexport { PolyhedronGeometry, PolyhedronBufferGeometry };\n","/**\n * @author timothypratley / https://github.com/timothypratley\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { PolyhedronBufferGeometry } from './PolyhedronGeometry.js';\n\n// TetrahedronGeometry\n\nfunction TetrahedronGeometry( radius, detail ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'TetrahedronGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n\tthis.fromBufferGeometry( new TetrahedronBufferGeometry( radius, detail ) );\n\tthis.mergeVertices();\n\n}\n\nTetrahedronGeometry.prototype = Object.create( Geometry.prototype );\nTetrahedronGeometry.prototype.constructor = TetrahedronGeometry;\n\n// TetrahedronBufferGeometry\n\nfunction TetrahedronBufferGeometry( radius, detail ) {\n\n\tconst vertices = [\n\t\t1, 1, 1, \t- 1, - 1, 1, \t- 1, 1, - 1, \t1, - 1, - 1\n\t];\n\n\tconst indices = [\n\t\t2, 1, 0, \t0, 3, 2,\t1, 3, 0,\t2, 3, 1\n\t];\n\n\tPolyhedronBufferGeometry.call( this, vertices, indices, radius, detail );\n\n\tthis.type = 'TetrahedronBufferGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n}\n\nTetrahedronBufferGeometry.prototype = Object.create( PolyhedronBufferGeometry.prototype );\nTetrahedronBufferGeometry.prototype.constructor = TetrahedronBufferGeometry;\n\n\nexport { TetrahedronGeometry, TetrahedronBufferGeometry };\n","/**\n * @author timothypratley / https://github.com/timothypratley\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { PolyhedronBufferGeometry } from './PolyhedronGeometry.js';\n\n// OctahedronGeometry\n\nfunction OctahedronGeometry( radius, detail ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'OctahedronGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n\tthis.fromBufferGeometry( new OctahedronBufferGeometry( radius, detail ) );\n\tthis.mergeVertices();\n\n}\n\nOctahedronGeometry.prototype = Object.create( Geometry.prototype );\nOctahedronGeometry.prototype.constructor = OctahedronGeometry;\n\n// OctahedronBufferGeometry\n\nfunction OctahedronBufferGeometry( radius, detail ) {\n\n\tconst vertices = [\n\t\t1, 0, 0, \t- 1, 0, 0,\t0, 1, 0,\n\t\t0, - 1, 0, \t0, 0, 1,\t0, 0, - 1\n\t];\n\n\tconst indices = [\n\t\t0, 2, 4,\t0, 4, 3,\t0, 3, 5,\n\t\t0, 5, 2,\t1, 2, 5,\t1, 5, 3,\n\t\t1, 3, 4,\t1, 4, 2\n\t];\n\n\tPolyhedronBufferGeometry.call( this, vertices, indices, radius, detail );\n\n\tthis.type = 'OctahedronBufferGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n}\n\nOctahedronBufferGeometry.prototype = Object.create( PolyhedronBufferGeometry.prototype );\nOctahedronBufferGeometry.prototype.constructor = OctahedronBufferGeometry;\n\n\nexport { OctahedronGeometry, OctahedronBufferGeometry };\n","/**\n * @author timothypratley / https://github.com/timothypratley\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { PolyhedronBufferGeometry } from './PolyhedronGeometry.js';\n\n// IcosahedronGeometry\n\nfunction IcosahedronGeometry( radius, detail ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'IcosahedronGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n\tthis.fromBufferGeometry( new IcosahedronBufferGeometry( radius, detail ) );\n\tthis.mergeVertices();\n\n}\n\nIcosahedronGeometry.prototype = Object.create( Geometry.prototype );\nIcosahedronGeometry.prototype.constructor = IcosahedronGeometry;\n\n// IcosahedronBufferGeometry\n\nfunction IcosahedronBufferGeometry( radius, detail ) {\n\n\tconst t = ( 1 + Math.sqrt( 5 ) ) / 2;\n\n\tconst vertices = [\n\t\t- 1, t, 0, \t1, t, 0, \t- 1, - t, 0, \t1, - t, 0,\n\t\t 0, - 1, t, \t0, 1, t,\t0, - 1, - t, \t0, 1, - t,\n\t\t t, 0, - 1, \tt, 0, 1, \t- t, 0, - 1, \t- t, 0, 1\n\t];\n\n\tconst indices = [\n\t\t 0, 11, 5, \t0, 5, 1, \t0, 1, 7, \t0, 7, 10, \t0, 10, 11,\n\t\t 1, 5, 9, \t5, 11, 4,\t11, 10, 2,\t10, 7, 6,\t7, 1, 8,\n\t\t 3, 9, 4, \t3, 4, 2,\t3, 2, 6,\t3, 6, 8,\t3, 8, 9,\n\t\t 4, 9, 5, \t2, 4, 11,\t6, 2, 10,\t8, 6, 7,\t9, 8, 1\n\t];\n\n\tPolyhedronBufferGeometry.call( this, vertices, indices, radius, detail );\n\n\tthis.type = 'IcosahedronBufferGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\tdetail: detail\n\t};\n\n}\n\nIcosahedronBufferGeometry.prototype = Object.create( PolyhedronBufferGeometry.prototype );\nIcosahedronBufferGeometry.prototype.constructor = IcosahedronBufferGeometry;\n\n\nexport { IcosahedronGeometry, IcosahedronBufferGeometry };\n","/**\n * @author oosmoxiecode\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\nimport { Vector3 } from '../math/Vector3.js';\n\n// TorusGeometry\n\nfunction TorusGeometry( radius, tube, radialSegments, tubularSegments, arc ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'TorusGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\ttube: tube,\n\t\tradialSegments: radialSegments,\n\t\ttubularSegments: tubularSegments,\n\t\tarc: arc\n\t};\n\n\tthis.fromBufferGeometry( new TorusBufferGeometry( radius, tube, radialSegments, tubularSegments, arc ) );\n\tthis.mergeVertices();\n\n}\n\nTorusGeometry.prototype = Object.create( Geometry.prototype );\nTorusGeometry.prototype.constructor = TorusGeometry;\n\n// TorusBufferGeometry\n\nfunction TorusBufferGeometry( radius, tube, radialSegments, tubularSegments, arc ) {\n\n\tBufferGeometry.call( this );\n\n\tthis.type = 'TorusBufferGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\ttube: tube,\n\t\tradialSegments: radialSegments,\n\t\ttubularSegments: tubularSegments,\n\t\tarc: arc\n\t};\n\n\tradius = radius || 1;\n\ttube = tube || 0.4;\n\tradialSegments = Math.floor( radialSegments ) || 8;\n\ttubularSegments = Math.floor( tubularSegments ) || 6;\n\tarc = arc || Math.PI * 2;\n\n\t// buffers\n\n\tconst indices = [];\n\tconst vertices = [];\n\tconst normals = [];\n\tconst uvs = [];\n\n\t// helper variables\n\n\tconst center = new Vector3();\n\tconst vertex = new Vector3();\n\tconst normal = new Vector3();\n\n\t// generate vertices, normals and uvs\n\n\tfor ( let j = 0; j <= radialSegments; j ++ ) {\n\n\t\tfor ( let i = 0; i <= tubularSegments; i ++ ) {\n\n\t\t\tconst u = i / tubularSegments * arc;\n\t\t\tconst v = j / radialSegments * Math.PI * 2;\n\n\t\t\t// vertex\n\n\t\t\tvertex.x = ( radius + tube * Math.cos( v ) ) * Math.cos( u );\n\t\t\tvertex.y = ( radius + tube * Math.cos( v ) ) * Math.sin( u );\n\t\t\tvertex.z = tube * Math.sin( v );\n\n\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t\t// normal\n\n\t\t\tcenter.x = radius * Math.cos( u );\n\t\t\tcenter.y = radius * Math.sin( u );\n\t\t\tnormal.subVectors( vertex, center ).normalize();\n\n\t\t\tnormals.push( normal.x, normal.y, normal.z );\n\n\t\t\t// uv\n\n\t\t\tuvs.push( i / tubularSegments );\n\t\t\tuvs.push( j / radialSegments );\n\n\t\t}\n\n\t}\n\n\t// generate indices\n\n\tfor ( let j = 1; j <= radialSegments; j ++ ) {\n\n\t\tfor ( let i = 1; i <= tubularSegments; i ++ ) {\n\n\t\t\t// indices\n\n\t\t\tconst a = ( tubularSegments + 1 ) * j + i - 1;\n\t\t\tconst b = ( tubularSegments + 1 ) * ( j - 1 ) + i - 1;\n\t\t\tconst c = ( tubularSegments + 1 ) * ( j - 1 ) + i;\n\t\t\tconst d = ( tubularSegments + 1 ) * j + i;\n\n\t\t\t// faces\n\n\t\t\tindices.push( a, b, d );\n\t\t\tindices.push( b, c, d );\n\n\t\t}\n\n\t}\n\n\t// build geometry\n\n\tthis.setIndex( indices );\n\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\n}\n\nTorusBufferGeometry.prototype = Object.create( BufferGeometry.prototype );\nTorusBufferGeometry.prototype.constructor = TorusBufferGeometry;\n\n\nexport { TorusGeometry, TorusBufferGeometry };\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @author Mugen87 / https://github.com/Mugen87\n */\n\nimport { Geometry } from '../core/Geometry.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector2 } from '../math/Vector2.js';\n\n// CylinderGeometry\n\nfunction CylinderGeometry( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) {\n\n\tGeometry.call( this );\n\n\tthis.type = 'CylinderGeometry';\n\n\tthis.parameters = {\n\t\tradiusTop: radiusTop,\n\t\tradiusBottom: radiusBottom,\n\t\theight: height,\n\t\tradialSegments: radialSegments,\n\t\theightSegments: heightSegments,\n\t\topenEnded: openEnded,\n\t\tthetaStart: thetaStart,\n\t\tthetaLength: thetaLength\n\t};\n\n\tthis.fromBufferGeometry( new CylinderBufferGeometry( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) );\n\tthis.mergeVertices();\n\n}\n\nCylinderGeometry.prototype = Object.create( Geometry.prototype );\nCylinderGeometry.prototype.constructor = CylinderGeometry;\n\n// CylinderBufferGeometry\n\nfunction CylinderBufferGeometry( radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) {\n\n\tBufferGeometry.call( this );\n\n\tthis.type = 'CylinderBufferGeometry';\n\n\tthis.parameters = {\n\t\tradiusTop: radiusTop,\n\t\tradiusBottom: radiusBottom,\n\t\theight: height,\n\t\tradialSegments: radialSegments,\n\t\theightSegments: heightSegments,\n\t\topenEnded: openEnded,\n\t\tthetaStart: thetaStart,\n\t\tthetaLength: thetaLength\n\t};\n\n\tconst scope = this;\n\n\tradiusTop = radiusTop !== undefined ? radiusTop : 1;\n\tradiusBottom = radiusBottom !== undefined ? radiusBottom : 1;\n\theight = height || 1;\n\n\tradialSegments = Math.floor( radialSegments ) || 8;\n\theightSegments = Math.floor( heightSegments ) || 1;\n\n\topenEnded = openEnded !== undefined ? openEnded : false;\n\tthetaStart = thetaStart !== undefined ? thetaStart : 0.0;\n\tthetaLength = thetaLength !== undefined ? thetaLength : Math.PI * 2;\n\n\t// buffers\n\n\tconst indices = [];\n\tconst vertices = [];\n\tconst normals = [];\n\tconst uvs = [];\n\n\t// helper variables\n\n\tlet index = 0;\n\tconst indexArray = [];\n\tconst halfHeight = height / 2;\n\tlet groupStart = 0;\n\n\t// generate geometry\n\n\tgenerateTorso();\n\n\tif ( openEnded === false ) {\n\n\t\tif ( radiusTop > 0 ) generateCap( true );\n\t\tif ( radiusBottom > 0 ) generateCap( false );\n\n\t}\n\n\t// build geometry\n\n\tthis.setIndex( indices );\n\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\n\tfunction generateTorso() {\n\n\t\tconst normal = new Vector3();\n\t\tconst vertex = new Vector3();\n\n\t\tlet groupCount = 0;\n\n\t\t// this will be used to calculate the normal\n\t\tconst slope = ( radiusBottom - radiusTop ) / height;\n\n\t\t// generate vertices, normals and uvs\n\n\t\tfor ( let y = 0; y <= heightSegments; y ++ ) {\n\n\t\t\tconst indexRow = [];\n\n\t\t\tconst v = y / heightSegments;\n\n\t\t\t// calculate the radius of the current row\n\n\t\t\tconst radius = v * ( radiusBottom - radiusTop ) + radiusTop;\n\n\t\t\tfor ( let x = 0; x <= radialSegments; x ++ ) {\n\n\t\t\t\tconst u = x / radialSegments;\n\n\t\t\t\tconst theta = u * thetaLength + thetaStart;\n\n\t\t\t\tconst sinTheta = Math.sin( theta );\n\t\t\t\tconst cosTheta = Math.cos( theta );\n\n\t\t\t\t// vertex\n\n\t\t\t\tvertex.x = radius * sinTheta;\n\t\t\t\tvertex.y = - v * height + halfHeight;\n\t\t\t\tvertex.z = radius * cosTheta;\n\t\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t\t\t// normal\n\n\t\t\t\tnormal.set( sinTheta, slope, cosTheta ).normalize();\n\t\t\t\tnormals.push( normal.x, normal.y, normal.z );\n\n\t\t\t\t// uv\n\n\t\t\t\tuvs.push( u, 1 - v );\n\n\t\t\t\t// save index of vertex in respective row\n\n\t\t\t\tindexRow.push( index ++ );\n\n\t\t\t}\n\n\t\t\t// now save vertices of the row in our index array\n\n\t\t\tindexArray.push( indexRow );\n\n\t\t}\n\n\t\t// generate indices\n\n\t\tfor ( let x = 0; x < radialSegments; x ++ ) {\n\n\t\t\tfor ( let y = 0; y < heightSegments; y ++ ) {\n\n\t\t\t\t// we use the index array to access the correct indices\n\n\t\t\t\tconst a = indexArray[ y ][ x ];\n\t\t\t\tconst b = indexArray[ y + 1 ][ x ];\n\t\t\t\tconst c = indexArray[ y + 1 ][ x + 1 ];\n\t\t\t\tconst d = indexArray[ y ][ x + 1 ];\n\n\t\t\t\t// faces\n\n\t\t\t\tindices.push( a, b, d );\n\t\t\t\tindices.push( b, c, d );\n\n\t\t\t\t// update group counter\n\n\t\t\t\tgroupCount += 6;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// add a group to the geometry. this will ensure multi material support\n\n\t\tscope.addGroup( groupStart, groupCount, 0 );\n\n\t\t// calculate new start value for groups\n\n\t\tgroupStart += groupCount;\n\n\t}\n\n\tfunction generateCap( top ) {\n\n\t\tlet centerIndexStart, centerIndexEnd;\n\n\t\tconst uv = new Vector2();\n\t\tconst vertex = new Vector3();\n\n\t\tlet groupCount = 0;\n\n\t\tconst radius = ( top === true ) ? radiusTop : radiusBottom;\n\t\tconst sign = ( top === true ) ? 1 : - 1;\n\n\t\t// save the index of the first center vertex\n\t\tcenterIndexStart = index;\n\n\t\t// first we generate the center vertex data of the cap.\n\t\t// because the geometry needs one set of uvs per face,\n\t\t// we must generate a center vertex per face/segment\n\n\t\tfor ( let x = 1; x <= radialSegments; x ++ ) {\n\n\t\t\t// vertex\n\n\t\t\tvertices.push( 0, halfHeight * sign, 0 );\n\n\t\t\t// normal\n\n\t\t\tnormals.push( 0, sign, 0 );\n\n\t\t\t// uv\n\n\t\t\tuvs.push( 0.5, 0.5 );\n\n\t\t\t// increase index\n\n\t\t\tindex ++;\n\n\t\t}\n\n\t\t// save the index of the last center vertex\n\n\t\tcenterIndexEnd = index;\n\n\t\t// now we generate the surrounding vertices, normals and uvs\n\n\t\tfor ( let x = 0; x <= radialSegments; x ++ ) {\n\n\t\t\tconst u = x / radialSegments;\n\t\t\tconst theta = u * thetaLength + thetaStart;\n\n\t\t\tconst cosTheta = Math.cos( theta );\n\t\t\tconst sinTheta = Math.sin( theta );\n\n\t\t\t// vertex\n\n\t\t\tvertex.x = radius * sinTheta;\n\t\t\tvertex.y = halfHeight * sign;\n\t\t\tvertex.z = radius * cosTheta;\n\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t\t// normal\n\n\t\t\tnormals.push( 0, sign, 0 );\n\n\t\t\t// uv\n\n\t\t\tuv.x = ( cosTheta * 0.5 ) + 0.5;\n\t\t\tuv.y = ( sinTheta * 0.5 * sign ) + 0.5;\n\t\t\tuvs.push( uv.x, uv.y );\n\n\t\t\t// increase index\n\n\t\t\tindex ++;\n\n\t\t}\n\n\t\t// generate indices\n\n\t\tfor ( let x = 0; x < radialSegments; x ++ ) {\n\n\t\t\tconst c = centerIndexStart + x;\n\t\t\tconst i = centerIndexEnd + x;\n\n\t\t\tif ( top === true ) {\n\n\t\t\t\t// face top\n\n\t\t\t\tindices.push( i, i + 1, c );\n\n\t\t\t} else {\n\n\t\t\t\t// face bottom\n\n\t\t\t\tindices.push( i + 1, i, c );\n\n\t\t\t}\n\n\t\t\tgroupCount += 3;\n\n\t\t}\n\n\t\t// add a group to the geometry. this will ensure multi material support\n\n\t\tscope.addGroup( groupStart, groupCount, top === true ? 1 : 2 );\n\n\t\t// calculate new start value for groups\n\n\t\tgroupStart += groupCount;\n\n\t}\n\n}\n\nCylinderBufferGeometry.prototype = Object.create( BufferGeometry.prototype );\nCylinderBufferGeometry.prototype.constructor = CylinderBufferGeometry;\n\n\nexport { CylinderGeometry, CylinderBufferGeometry };\n","/**\n * @author abelnation / http://github.com/abelnation\n */\n\nimport { CylinderGeometry } from './CylinderGeometry.js';\nimport { CylinderBufferGeometry } from './CylinderGeometry.js';\n\n// ConeGeometry\n\nfunction ConeGeometry( radius, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) {\n\n\tCylinderGeometry.call( this, 0, radius, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength );\n\n\tthis.type = 'ConeGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\theight: height,\n\t\tradialSegments: radialSegments,\n\t\theightSegments: heightSegments,\n\t\topenEnded: openEnded,\n\t\tthetaStart: thetaStart,\n\t\tthetaLength: thetaLength\n\t};\n\n}\n\nConeGeometry.prototype = Object.create( CylinderGeometry.prototype );\nConeGeometry.prototype.constructor = ConeGeometry;\n\n// ConeBufferGeometry\n\nfunction ConeBufferGeometry( radius, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength ) {\n\n\tCylinderBufferGeometry.call( this, 0, radius, height, radialSegments, heightSegments, openEnded, thetaStart, thetaLength );\n\n\tthis.type = 'ConeBufferGeometry';\n\n\tthis.parameters = {\n\t\tradius: radius,\n\t\theight: height,\n\t\tradialSegments: radialSegments,\n\t\theightSegments: heightSegments,\n\t\topenEnded: openEnded,\n\t\tthetaStart: thetaStart,\n\t\tthetaLength: thetaLength\n\t};\n\n}\n\nConeBufferGeometry.prototype = Object.create( CylinderBufferGeometry.prototype );\nConeBufferGeometry.prototype.constructor = ConeBufferGeometry;\n\n\nexport { ConeGeometry, ConeBufferGeometry };\n","import { Object3D } from '../core/Object3D.js';\nimport { Color } from '../math/Color.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n * @author alteredq / http://alteredqualia.com/\n */\n\nfunction Light( color, intensity ) {\n\n\tObject3D.call( this );\n\n\tthis.type = 'Light';\n\n\tthis.color = new Color( color );\n\tthis.intensity = intensity !== undefined ? intensity : 1;\n\n\tthis.receiveShadow = undefined;\n\n}\n\nLight.prototype = Object.assign( Object.create( Object3D.prototype ), {\n\n\tconstructor: Light,\n\n\tisLight: true,\n\n\tcopy: function ( source ) {\n\n\t\tObject3D.prototype.copy.call( this, source );\n\n\t\tthis.color.copy( source.color );\n\t\tthis.intensity = source.intensity;\n\n\t\treturn this;\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\tconst data = Object3D.prototype.toJSON.call( this, meta );\n\n\t\tdata.object.color = this.color.getHex();\n\t\tdata.object.intensity = this.intensity;\n\n\t\tif ( this.groundColor !== undefined ) data.object.groundColor = this.groundColor.getHex();\n\n\t\tif ( this.distance !== undefined ) data.object.distance = this.distance;\n\t\tif ( this.angle !== undefined ) data.object.angle = this.angle;\n\t\tif ( this.decay !== undefined ) data.object.decay = this.decay;\n\t\tif ( this.penumbra !== undefined ) data.object.penumbra = this.penumbra;\n\n\t\tif ( this.shadow !== undefined ) data.object.shadow = this.shadow.toJSON();\n\n\t\treturn data;\n\n\t}\n\n} );\n\n\nexport { Light };\n","import { Matrix4 } from '../math/Matrix4.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector4 } from '../math/Vector4.js';\nimport { Frustum } from '../math/Frustum.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction LightShadow( camera ) {\n\n\tthis.camera = camera;\n\n\tthis.bias = 0;\n\tthis.normalBias = 0;\n\tthis.radius = 1;\n\n\tthis.mapSize = new Vector2( 512, 512 );\n\n\tthis.map = null;\n\tthis.mapPass = null;\n\tthis.matrix = new Matrix4();\n\n\tthis.autoUpdate = true;\n\tthis.needsUpdate = false;\n\n\tthis._frustum = new Frustum();\n\tthis._frameExtents = new Vector2( 1, 1 );\n\n\tthis._viewportCount = 1;\n\n\tthis._viewports = [\n\n\t\tnew Vector4( 0, 0, 1, 1 )\n\n\t];\n\n}\n\nObject.assign( LightShadow.prototype, {\n\n\t_projScreenMatrix: new Matrix4(),\n\n\t_lightPositionWorld: new Vector3(),\n\n\t_lookTarget: new Vector3(),\n\n\tgetViewportCount: function () {\n\n\t\treturn this._viewportCount;\n\n\t},\n\n\tgetFrustum: function () {\n\n\t\treturn this._frustum;\n\n\t},\n\n\tupdateMatrices: function ( light ) {\n\n\t\tconst shadowCamera = this.camera,\n\t\t\tshadowMatrix = this.matrix,\n\t\t\tprojScreenMatrix = this._projScreenMatrix,\n\t\t\tlookTarget = this._lookTarget,\n\t\t\tlightPositionWorld = this._lightPositionWorld;\n\n\t\tlightPositionWorld.setFromMatrixPosition( light.matrixWorld );\n\t\tshadowCamera.position.copy( lightPositionWorld );\n\n\t\tlookTarget.setFromMatrixPosition( light.target.matrixWorld );\n\t\tshadowCamera.lookAt( lookTarget );\n\t\tshadowCamera.updateMatrixWorld();\n\n\t\tprojScreenMatrix.multiplyMatrices( shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse );\n\t\tthis._frustum.setFromProjectionMatrix( projScreenMatrix );\n\n\t\tshadowMatrix.set(\n\t\t\t0.5, 0.0, 0.0, 0.5,\n\t\t\t0.0, 0.5, 0.0, 0.5,\n\t\t\t0.0, 0.0, 0.5, 0.5,\n\t\t\t0.0, 0.0, 0.0, 1.0\n\t\t);\n\n\t\tshadowMatrix.multiply( shadowCamera.projectionMatrix );\n\t\tshadowMatrix.multiply( shadowCamera.matrixWorldInverse );\n\n\t},\n\n\tgetViewport: function ( viewportIndex ) {\n\n\t\treturn this._viewports[ viewportIndex ];\n\n\t},\n\n\tgetFrameExtents: function () {\n\n\t\treturn this._frameExtents;\n\n\t},\n\n\tcopy: function ( source ) {\n\n\t\tthis.camera = source.camera.clone();\n\n\t\tthis.bias = source.bias;\n\t\tthis.radius = source.radius;\n\n\t\tthis.mapSize.copy( source.mapSize );\n\n\t\treturn this;\n\n\t},\n\n\tclone: function () {\n\n\t\treturn new this.constructor().copy( this );\n\n\t},\n\n\ttoJSON: function () {\n\n\t\tconst object = {};\n\n\t\tif ( this.bias !== 0 ) object.bias = this.bias;\n\t\tif ( this.normalBias !== 0 ) object.normalBias = this.normalBias;\n\t\tif ( this.radius !== 1 ) object.radius = this.radius;\n\t\tif ( this.mapSize.x !== 512 || this.mapSize.y !== 512 ) object.mapSize = this.mapSize.toArray();\n\n\t\tobject.camera = this.camera.toJSON( false ).object;\n\t\tdelete object.camera.matrix;\n\n\t\treturn object;\n\n\t}\n\n} );\n\n\nexport { LightShadow };\n","import { LightShadow } from './LightShadow.js';\nimport { MathUtils } from '../math/MathUtils.js';\nimport { PerspectiveCamera } from '../cameras/PerspectiveCamera.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction SpotLightShadow() {\n\n\tLightShadow.call( this, new PerspectiveCamera( 50, 1, 0.5, 500 ) );\n\n}\n\nSpotLightShadow.prototype = Object.assign( Object.create( LightShadow.prototype ), {\n\n\tconstructor: SpotLightShadow,\n\n\tisSpotLightShadow: true,\n\n\tupdateMatrices: function ( light ) {\n\n\t\tconst camera = this.camera;\n\n\t\tconst fov = MathUtils.RAD2DEG * 2 * light.angle;\n\t\tconst aspect = this.mapSize.width / this.mapSize.height;\n\t\tconst far = light.distance || camera.far;\n\n\t\tif ( fov !== camera.fov || aspect !== camera.aspect || far !== camera.far ) {\n\n\t\t\tcamera.fov = fov;\n\t\t\tcamera.aspect = aspect;\n\t\t\tcamera.far = far;\n\t\t\tcamera.updateProjectionMatrix();\n\n\t\t}\n\n\t\tLightShadow.prototype.updateMatrices.call( this, light );\n\n\t}\n\n} );\n\n\nexport { SpotLightShadow };\n","import { Light } from './Light.js';\nimport { SpotLightShadow } from './SpotLightShadow.js';\nimport { Object3D } from '../core/Object3D.js';\n\n/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nfunction SpotLight( color, intensity, distance, angle, penumbra, decay ) {\n\n\tLight.call( this, color, intensity );\n\n\tthis.type = 'SpotLight';\n\n\tthis.position.copy( Object3D.DefaultUp );\n\tthis.updateMatrix();\n\n\tthis.target = new Object3D();\n\n\tObject.defineProperty( this, 'power', {\n\t\tget: function () {\n\n\t\t\t// intensity = power per solid angle.\n\t\t\t// ref: equation (17) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t\t\treturn this.intensity * Math.PI;\n\n\t\t},\n\t\tset: function ( power ) {\n\n\t\t\t// intensity = power per solid angle.\n\t\t\t// ref: equation (17) from https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t\t\tthis.intensity = power / Math.PI;\n\n\t\t}\n\t} );\n\n\tthis.distance = ( distance !== undefined ) ? distance : 0;\n\tthis.angle = ( angle !== undefined ) ? angle : Math.PI / 3;\n\tthis.penumbra = ( penumbra !== undefined ) ? penumbra : 0;\n\tthis.decay = ( decay !== undefined ) ? decay : 1;\t// for physically correct lights, should be 2.\n\n\tthis.shadow = new SpotLightShadow();\n\n}\n\nSpotLight.prototype = Object.assign( Object.create( Light.prototype ), {\n\n\tconstructor: SpotLight,\n\n\tisSpotLight: true,\n\n\tcopy: function ( source ) {\n\n\t\tLight.prototype.copy.call( this, source );\n\n\t\tthis.distance = source.distance;\n\t\tthis.angle = source.angle;\n\t\tthis.penumbra = source.penumbra;\n\t\tthis.decay = source.decay;\n\n\t\tthis.target = source.target.clone();\n\n\t\tthis.shadow = source.shadow.clone();\n\n\t\treturn this;\n\n\t}\n\n} );\n\n\nexport { SpotLight };\n","import { Camera } from './Camera.js';\nimport { Object3D } from '../core/Object3D.js';\n\n/**\n * @author alteredq / http://alteredqualia.com/\n * @author arose / http://github.com/arose\n */\n\nfunction OrthographicCamera( left, right, top, bottom, near, far ) {\n\n\tCamera.call( this );\n\n\tthis.type = 'OrthographicCamera';\n\n\tthis.zoom = 1;\n\tthis.view = null;\n\n\tthis.left = ( left !== undefined ) ? left : - 1;\n\tthis.right = ( right !== undefined ) ? right : 1;\n\tthis.top = ( top !== undefined ) ? top : 1;\n\tthis.bottom = ( bottom !== undefined ) ? bottom : - 1;\n\n\tthis.near = ( near !== undefined ) ? near : 0.1;\n\tthis.far = ( far !== undefined ) ? far : 2000;\n\n\tthis.updateProjectionMatrix();\n\n}\n\nOrthographicCamera.prototype = Object.assign( Object.create( Camera.prototype ), {\n\n\tconstructor: OrthographicCamera,\n\n\tisOrthographicCamera: true,\n\n\tcopy: function ( source, recursive ) {\n\n\t\tCamera.prototype.copy.call( this, source, recursive );\n\n\t\tthis.left = source.left;\n\t\tthis.right = source.right;\n\t\tthis.top = source.top;\n\t\tthis.bottom = source.bottom;\n\t\tthis.near = source.near;\n\t\tthis.far = source.far;\n\n\t\tthis.zoom = source.zoom;\n\t\tthis.view = source.view === null ? null : Object.assign( {}, source.view );\n\n\t\treturn this;\n\n\t},\n\n\tsetViewOffset: function ( fullWidth, fullHeight, x, y, width, height ) {\n\n\t\tif ( this.view === null ) {\n\n\t\t\tthis.view = {\n\t\t\t\tenabled: true,\n\t\t\t\tfullWidth: 1,\n\t\t\t\tfullHeight: 1,\n\t\t\t\toffsetX: 0,\n\t\t\t\toffsetY: 0,\n\t\t\t\twidth: 1,\n\t\t\t\theight: 1\n\t\t\t};\n\n\t\t}\n\n\t\tthis.view.enabled = true;\n\t\tthis.view.fullWidth = fullWidth;\n\t\tthis.view.fullHeight = fullHeight;\n\t\tthis.view.offsetX = x;\n\t\tthis.view.offsetY = y;\n\t\tthis.view.width = width;\n\t\tthis.view.height = height;\n\n\t\tthis.updateProjectionMatrix();\n\n\t},\n\n\tclearViewOffset: function () {\n\n\t\tif ( this.view !== null ) {\n\n\t\t\tthis.view.enabled = false;\n\n\t\t}\n\n\t\tthis.updateProjectionMatrix();\n\n\t},\n\n\tupdateProjectionMatrix: function () {\n\n\t\tconst dx = ( this.right - this.left ) / ( 2 * this.zoom );\n\t\tconst dy = ( this.top - this.bottom ) / ( 2 * this.zoom );\n\t\tconst cx = ( this.right + this.left ) / 2;\n\t\tconst cy = ( this.top + this.bottom ) / 2;\n\n\t\tlet left = cx - dx;\n\t\tlet right = cx + dx;\n\t\tlet top = cy + dy;\n\t\tlet bottom = cy - dy;\n\n\t\tif ( this.view !== null && this.view.enabled ) {\n\n\t\t\tconst scaleW = ( this.right - this.left ) / this.view.fullWidth / this.zoom;\n\t\t\tconst scaleH = ( this.top - this.bottom ) / this.view.fullHeight / this.zoom;\n\n\t\t\tleft += scaleW * this.view.offsetX;\n\t\t\tright = left + scaleW * this.view.width;\n\t\t\ttop -= scaleH * this.view.offsetY;\n\t\t\tbottom = top - scaleH * this.view.height;\n\n\t\t}\n\n\t\tthis.projectionMatrix.makeOrthographic( left, right, top, bottom, this.near, this.far );\n\n\t\tthis.projectionMatrixInverse.getInverse( this.projectionMatrix );\n\n\t},\n\n\ttoJSON: function ( meta ) {\n\n\t\tconst data = Object3D.prototype.toJSON.call( this, meta );\n\n\t\tdata.object.zoom = this.zoom;\n\t\tdata.object.left = this.left;\n\t\tdata.object.right = this.right;\n\t\tdata.object.top = this.top;\n\t\tdata.object.bottom = this.bottom;\n\t\tdata.object.near = this.near;\n\t\tdata.object.far = this.far;\n\n\t\tif ( this.view !== null ) data.object.view = Object.assign( {}, this.view );\n\n\t\treturn data;\n\n\t}\n\n} );\n\n\nexport { OrthographicCamera };\n","import { Light } from './Light.js';\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction AmbientLight( color, intensity ) {\n\n\tLight.call( this, color, intensity );\n\n\tthis.type = 'AmbientLight';\n\n\tthis.castShadow = undefined;\n\n}\n\nAmbientLight.prototype = Object.assign( Object.create( Light.prototype ), {\n\n\tconstructor: AmbientLight,\n\n\tisAmbientLight: true\n\n} );\n\n\nexport { AmbientLight };\n","import { Matrix4 } from '../math/Matrix4.js';\nimport { MathUtils } from '../math/MathUtils.js';\nimport { PerspectiveCamera } from './PerspectiveCamera.js';\n\nconst _eyeRight = new Matrix4();\nconst _eyeLeft = new Matrix4();\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction StereoCamera() {\n\n\tthis.type = 'StereoCamera';\n\n\tthis.aspect = 1;\n\n\tthis.eyeSep = 0.064;\n\n\tthis.cameraL = new PerspectiveCamera();\n\tthis.cameraL.layers.enable( 1 );\n\tthis.cameraL.matrixAutoUpdate = false;\n\n\tthis.cameraR = new PerspectiveCamera();\n\tthis.cameraR.layers.enable( 2 );\n\tthis.cameraR.matrixAutoUpdate = false;\n\n\tthis._cache = {\n\t\tfocus: null,\n\t\tfov: null,\n\t\taspect: null,\n\t\tnear: null,\n\t\tfar: null,\n\t\tzoom: null,\n\t\teyeSep: null\n\t};\n\n}\n\nObject.assign( StereoCamera.prototype, {\n\n\tupdate: function ( camera ) {\n\n\t\tconst cache = this._cache;\n\n\t\tconst needsUpdate = cache.focus !== camera.focus || cache.fov !== camera.fov ||\n\t\t\tcache.aspect !== camera.aspect * this.aspect || cache.near !== camera.near ||\n\t\t\tcache.far !== camera.far || cache.zoom !== camera.zoom || cache.eyeSep !== this.eyeSep;\n\n\t\tif ( needsUpdate ) {\n\n\t\t\tcache.focus = camera.focus;\n\t\t\tcache.fov = camera.fov;\n\t\t\tcache.aspect = camera.aspect * this.aspect;\n\t\t\tcache.near = camera.near;\n\t\t\tcache.far = camera.far;\n\t\t\tcache.zoom = camera.zoom;\n\t\t\tcache.eyeSep = this.eyeSep;\n\n\t\t\t// Off-axis stereoscopic effect based on\n\t\t\t// http://paulbourke.net/stereographics/stereorender/\n\n\t\t\tconst projectionMatrix = camera.projectionMatrix.clone();\n\t\t\tconst eyeSepHalf = cache.eyeSep / 2;\n\t\t\tconst eyeSepOnProjection = eyeSepHalf * cache.near / cache.focus;\n\t\t\tconst ymax = ( cache.near * Math.tan( MathUtils.DEG2RAD * cache.fov * 0.5 ) ) / cache.zoom;\n\t\t\tlet xmin, xmax;\n\n\t\t\t// translate xOffset\n\n\t\t\t_eyeLeft.elements[ 12 ] = - eyeSepHalf;\n\t\t\t_eyeRight.elements[ 12 ] = eyeSepHalf;\n\n\t\t\t// for left eye\n\n\t\t\txmin = - ymax * cache.aspect + eyeSepOnProjection;\n\t\t\txmax = ymax * cache.aspect + eyeSepOnProjection;\n\n\t\t\tprojectionMatrix.elements[ 0 ] = 2 * cache.near / ( xmax - xmin );\n\t\t\tprojectionMatrix.elements[ 8 ] = ( xmax + xmin ) / ( xmax - xmin );\n\n\t\t\tthis.cameraL.projectionMatrix.copy( projectionMatrix );\n\n\t\t\t// for right eye\n\n\t\t\txmin = - ymax * cache.aspect - eyeSepOnProjection;\n\t\t\txmax = ymax * cache.aspect - eyeSepOnProjection;\n\n\t\t\tprojectionMatrix.elements[ 0 ] = 2 * cache.near / ( xmax - xmin );\n\t\t\tprojectionMatrix.elements[ 8 ] = ( xmax + xmin ) / ( xmax - xmin );\n\n\t\t\tthis.cameraR.projectionMatrix.copy( projectionMatrix );\n\n\t\t}\n\n\t\tthis.cameraL.matrixWorld.copy( camera.matrixWorld ).multiply( _eyeLeft );\n\t\tthis.cameraR.matrixWorld.copy( camera.matrixWorld ).multiply( _eyeRight );\n\n\t}\n\n} );\n\n\nexport { StereoCamera };\n","/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nfunction Uniform( value ) {\n\n\tif ( typeof value === 'string' ) {\n\n\t\tconsole.warn( 'THREE.Uniform: Type parameter is no longer needed.' );\n\t\tvalue = arguments[ 1 ];\n\n\t}\n\n\tthis.value = value;\n\n}\n\nUniform.prototype.clone = function () {\n\n\treturn new Uniform( this.value.clone === undefined ? this.value : this.value.clone() );\n\n};\n\nexport { Uniform };\n","/**\n * @file Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2, Vector3, Matrix4, Quaternion } from 'three'\n\nexport function getQuery (id: string) {\n  if (typeof window === 'undefined') return undefined\n\n  const a = new RegExp(`${id}=([^&#=]*)`)\n  const m = a.exec(window.location.search)\n\n  if (m) {\n    return decodeURIComponent(m[1])\n  } else {\n    return undefined\n  }\n}\n\nexport function boolean (value: any) {\n  if (!value) {\n    return false\n  }\n\n  if (typeof value === 'string') {\n    return /^1|true|t|yes|y$/i.test(value)\n  }\n\n  return true\n}\n\nexport function defaults (value: any, defaultValue: any) {\n  return value !== undefined ? value : defaultValue\n}\n\nexport function createParams<T> (params: {[k in keyof T]?: any}, defaultParams: T) {\n  const o: any = Object.assign({}, params)\n  for (const k in defaultParams) {\n    const value = params[k]\n    if (value === undefined) o[k] = defaultParams[k]\n  }\n  return o as T\n}\n\nexport function updateParams<T> (params: T, newParams: {[k in keyof T]?: any}) {\n  for (const k in newParams) {\n    const value = newParams[k]\n    if (value !== undefined) params[k] = value\n  }\n  return params as T\n}\n\nexport function pick (object: { [index: string]: any }) {\n  const properties = [].slice.call(arguments, 1)\n  return properties.reduce((a: { [index: string]: any }, e: any) => {\n    a[ e ] = object[ e ]\n    return a\n  }, {})\n}\n\nexport function flatten (array: any[], ret: any[]) {\n  ret = defaults(ret, [])\n  for (let i = 0; i < array.length; i++) {\n    if (Array.isArray(array[i])) {\n      flatten(array[i], ret)\n    } else {\n      ret.push(array[i])\n    }\n  }\n  return ret\n}\n\nexport function getProtocol () {\n  const protocol = window.location.protocol\n  return protocol.match(/http(s)?:/gi) === null ? 'http:' : protocol\n}\n\nexport function getBrowser () {\n  if (typeof window === 'undefined') return false\n\n  const ua = window.navigator.userAgent\n\n  if (/Opera|OPR/.test(ua)) {\n    return 'Opera'\n  } else if (/Chrome/i.test(ua)) {\n    return 'Chrome'\n  } else if (/Firefox/i.test(ua)) {\n    return 'Firefox'\n  } else if (/Mobile(\\/.*)? Safari/i.test(ua)) {\n    return 'Mobile Safari'\n  } else if (/MSIE/i.test(ua)) {\n    return 'Internet Explorer'\n  } else if (/Safari/i.test(ua)) {\n    return 'Safari'\n  }\n\n  return false\n}\n\nexport function getAbsolutePath (relativePath: string) {\n  const loc = window.location\n  const pn = loc.pathname\n  const basePath = pn.substring(0, pn.lastIndexOf('/') + 1)\n\n  return loc.origin + basePath + relativePath\n}\n\nexport function deepCopy (src: any) {\n  if (typeof src !== 'object') {\n    return src\n  }\n\n  const dst: { [index: string]: any } = Array.isArray(src) ? [] : {}\n\n  for (let key in src) {\n    dst[ key ] = deepCopy(src[ key ])\n  }\n\n  return dst\n}\n\nexport function deepEqual(a: any, b: any) {\n  // from https://github.com/epoberezkin/fast-deep-equal MIT\n  if (a === b) return true;\n\n  const arrA = Array.isArray(a)\n  const arrB = Array.isArray(b)\n\n  if (arrA && arrB) {\n    if (a.length !== b.length) return false\n    for (let i = 0; i < a.length; i++) {\n      if (!deepEqual(a[i], b[i])) return false\n    }\n    return true\n  }\n\n  if (arrA !== arrB) return false\n\n  if (a && b && typeof a === 'object' && typeof b === 'object') {\n    const keys = Object.keys(a)\n    if (keys.length !== Object.keys(b).length) return false;\n\n    const dateA = a instanceof Date\n    const dateB = b instanceof Date\n    if (dateA && dateB) return a.getTime() === b.getTime()\n    if (dateA !== dateB) return false\n\n    const regexpA = a instanceof RegExp\n    const regexpB = b instanceof RegExp\n    if (regexpA && regexpB) return a.toString() === b.toString()\n    if (regexpA !== regexpB) return false\n\n    for (let i = 0; i < keys.length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false\n    }\n\n    for (let i = 0; i < keys.length; i++) {\n      if(!deepEqual(a[keys[i]], b[keys[i]])) return false\n    }\n\n    return true\n  }\n\n  return false\n}\n\nfunction openUrl (url: string) {\n  const opened = window.open(url, '_blank')\n  if (!opened) {\n    window.location.href = url\n  }\n}\n\nexport function download (data: Blob|string, downloadName = 'download') {\n  // using ideas from https://github.com/eligrey/FileSaver.js/blob/master/FileSaver.js\n\n  if (!data) return\n\n  const isSafari = getBrowser() === 'Safari'\n  const isChromeIos = /CriOS\\/[\\d]+/.test(window.navigator.userAgent)\n\n  const a = document.createElement('a')\n\n  function open (str: string) {\n    openUrl(isChromeIos ? str : str.replace(/^data:[^;]*;/, 'data:attachment/file;'))\n  }\n\n  if (typeof navigator !== 'undefined' && (navigator as any).msSaveOrOpenBlob) {\n    // native saveAs in IE 10+\n    (navigator as any).msSaveOrOpenBlob(data, downloadName)\n  } else if ((isSafari || isChromeIos) && FileReader) {\n    if (data instanceof Blob) {\n      // no downloading of blob urls in Safari\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        open(reader.result as string)\n      }\n      reader.readAsDataURL(data)\n    } else {\n      open(data)\n    }\n  } else {\n    let objectUrlCreated = false\n    if (data instanceof Blob) {\n      data = URL.createObjectURL(data)\n      objectUrlCreated = true\n    }\n\n    if ('download' in a) {\n      // download link available\n      a.style.display = 'hidden'\n      document.body.appendChild(a)\n      a.href = data\n      a.download = downloadName\n      a.target = '_blank'\n      a.click()\n      document.body.removeChild(a)\n    } else {\n      openUrl(data)\n    }\n\n    if (objectUrlCreated) {\n      window.URL.revokeObjectURL(data)\n    }\n  }\n}\n\nexport function submit (url: string, data: FormData, callback: Function, onerror: Function) {\n  const xhr = new XMLHttpRequest()\n  xhr.open('POST', url)\n\n  xhr.addEventListener('load', function () {\n    if (xhr.status === 200 || xhr.status === 304) {\n      callback(xhr.response)\n    } else {\n      if (typeof onerror === 'function') {\n        onerror(xhr.status)\n      }\n    }\n  }, false)\n\n  xhr.send(data)\n}\n\ninterface HTMLInputEvent extends Event {\n  target: HTMLInputElement & EventTarget\n}\n\nexport function open (callback: Function, extensionList = ['*']) {\n  const fileInput = document.createElement('input')\n  fileInput.type = 'file'\n  fileInput.multiple = true\n  fileInput.style.display = 'hidden'\n  document.body.appendChild(fileInput)\n  fileInput.accept = '.' + extensionList.join(',.')\n  fileInput.addEventListener('change', function (e: HTMLInputEvent) {\n    callback(e.target.files)\n  }, false)\n\n  fileInput.click()\n}\n\nexport function throttle (func: Function, wait: number, options: { leading?: boolean, trailing?: boolean }) {\n  // from http://underscorejs.org/docs/underscore.html\n\n  let context: any\n  let args: any\n  let result: any\n  let timeout: any = null\n  let previous = 0\n\n  if (!options) options = {}\n\n  function later () {\n    previous = options.leading === false ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n\n  return function throttle (this: any) {\n    var now = Date.now()\n    if (!previous && options.leading === false) previous = now\n    var remaining = wait - (now - previous)\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n\n    return result\n  }\n}\n\nexport function lexicographicCompare<T> (elm1: T, elm2: T) {\n  if (elm1 < elm2) return -1\n  if (elm1 > elm2) return 1\n  return 0\n}\n\n/**\n * Does a binary search to get the index of an element in the input array\n * @function\n * @example\n * var array = [ 1, 2, 3, 4, 5, 6 ];\n * var element = 4;\n * binarySearchIndexOf( array, element );  // returns 3\n *\n * @param {Array} array - sorted array\n * @param {Anything} element - element to search for in the array\n * @param {Function} [compareFunction] - compare function\n * @return {Number} the index of the element or -1 if not in the array\n */\nexport function binarySearchIndexOf<T> (array: T[], element: T, compareFunction = lexicographicCompare) {\n  let low = 0\n  let high = array.length - 1\n  while (low <= high) {\n    const mid = (low + high) >> 1\n    const cmp = compareFunction(element, array[ mid ])\n    if (cmp > 0) {\n      low = mid + 1\n    } else if (cmp < 0) {\n      high = mid - 1\n    } else {\n      return mid\n    }\n  }\n  return -low - 1\n}\n\nexport function binarySearchForLeftRange (array: number[], leftRange: number) {\n  let high = array.length - 1\n  if (array[ high ] < leftRange) return -1\n  let low = 0\n  while (low <= high) {\n    const mid = (low + high) >> 1\n    if (array[ mid ] >= leftRange) {\n      high = mid - 1\n    } else {\n      low = mid + 1\n    }\n  }\n  return high + 1\n}\n\nexport function binarySearchForRightRange (array: number[], rightRange: number) {\n  if (array[ 0 ] > rightRange) return -1\n  let low = 0\n  let high = array.length - 1\n  while (low <= high) {\n    const mid = (low + high) >> 1\n    if (array[ mid ] > rightRange) {\n      high = mid - 1\n    } else {\n      low = mid + 1\n    }\n  }\n  return low - 1\n}\n\nexport function rangeInSortedArray (array: number[], min: number, max: number) {\n  const indexLeft = binarySearchForLeftRange(array, min)\n  const indexRight = binarySearchForRightRange(array, max)\n  if (indexLeft === -1 || indexRight === -1 || indexLeft > indexRight) {\n    return 0\n  } else {\n    return indexRight - indexLeft + 1\n  }\n}\n\nexport function dataURItoImage (dataURI: string) {\n  const img = document.createElement('img')\n  img.src = dataURI\n  return img\n}\n\nexport function uniqueArray (array: any[]) {\n  return array.sort().filter(function (value, index, sorted) {\n    return (index === 0) || (value !== sorted[ index - 1 ])\n  })\n}\n\n// String/arraybuffer conversion\n\nexport function uint8ToString (u8a: Uint8Array) {\n  const chunkSize = 0x7000\n\n  if (u8a.length > chunkSize) {\n    const c = []\n\n    for (let i = 0; i < u8a.length; i += chunkSize) {\n      c.push(String.fromCharCode.apply(\n        null, u8a.subarray(i, i + chunkSize)\n      ))\n    }\n\n    return c.join('')\n  } else {\n    return String.fromCharCode.apply(null, u8a)\n  }\n}\n\nexport function uint8ToLines (u8a: Uint8Array, chunkSize = 1024 * 1024 * 10, newline = '\\n') {\n  let partialLine = ''\n  let lines: string[] = []\n\n  for (let i = 0; i < u8a.length; i += chunkSize) {\n    const str = uint8ToString(u8a.subarray(i, i + chunkSize))\n    const idx = str.lastIndexOf(newline)\n\n    if (idx === -1) {\n      partialLine += str\n    } else {\n      const str2 = partialLine + str.substr(0, idx)\n      lines = lines.concat(str2.split(newline))\n\n      if (idx === str.length - newline.length) {\n        partialLine = ''\n      } else {\n        partialLine = str.substr(idx + newline.length)\n      }\n    }\n  }\n\n  if (partialLine !== '') {\n    lines.push(partialLine)\n  }\n\n  return lines\n}\n\nexport type TypedArrayString = 'int8'|'int16'|'int32'|'uint8'|'uint16'|'uint32'|'float32'\nexport function getTypedArray (arrayType: TypedArrayString, arraySize: number) {\n  switch (arrayType) {\n    case 'int8':\n      return new Int8Array(arraySize)\n    case 'int16':\n      return new Int16Array(arraySize)\n    case 'int32':\n      return new Int32Array(arraySize)\n    case 'uint8':\n      return new Uint8Array(arraySize)\n    case 'uint16':\n      return new Uint16Array(arraySize)\n    case 'uint32':\n      return new Uint32Array(arraySize)\n    case 'float32':\n      return new Float32Array(arraySize)\n    default:\n      throw new Error('arrayType unknown: ' + arrayType)\n  }\n}\n\nexport function getUintArray (sizeOrArray: any, maxUint: number) {  // TODO\n  const TypedArray = maxUint > 65535 ? Uint32Array : Uint16Array\n  return new TypedArray(sizeOrArray)\n}\n\nexport function ensureArray (value: any) {\n  return Array.isArray(value) ? value : [value]\n}\n\nexport function ensureBuffer (a: any) {  // TODO\n  return (a.buffer && a.buffer instanceof ArrayBuffer) ? a.buffer : a\n}\n\nfunction _ensureClassFromArg (arg: any, constructor: { new (arg: any): any }) {\n  return arg instanceof constructor ? arg : new constructor(arg)\n}\n\nfunction _ensureClassFromArray (array: any, constructor: { new (): any }) {\n  if (array === undefined) {\n    array = new constructor()\n  } else if (Array.isArray(array)) {\n    array = new constructor().fromArray(array)\n  }\n  return array\n}\n\nexport function ensureVector2 (v?: number[]|Vector2) {\n  return _ensureClassFromArray(v, Vector2)\n}\n\nexport function ensureVector3 (v?: number[]|Vector3) {\n  return _ensureClassFromArray(v, Vector3)\n}\n\nexport function ensureMatrix4 (m?: number[]|Matrix4) {\n  return _ensureClassFromArray(m, Matrix4)\n}\n\nexport function ensureQuaternion (q?: number[]|Quaternion) {\n  return _ensureClassFromArray(q, Quaternion)\n}\n\nexport function ensureFloat32Array (a?: number[]|Float32Array) {\n  return _ensureClassFromArg(a, Float32Array)\n}\n\nexport interface RingBuffer<T> {\n  has: (value: T) => boolean\n  get: (value: number) => T\n  push: (value: T) => void\n  count: number\n  data: T[]\n  clear: () => void\n}\n\nexport function createRingBuffer<T> (length: number): RingBuffer<T> {\n  let pointer = 0\n  let count = 0\n  const buffer: T[] = []\n\n  return {\n    has: function (value: any) { return buffer.indexOf(value) !== -1 },\n    get: function (idx: number) { return buffer[idx] },\n    push: function (item: any) {\n      buffer[pointer] = item\n      pointer = (length + pointer + 1) % length\n      ++count\n    },\n    get count () { return count },\n    get data () { return buffer.slice(0, Math.min(count, length)) },\n    clear: function () {\n      count = 0\n      pointer = 0\n      buffer.length = 0\n    }\n  }\n}\n\nexport interface SimpleDict<K, V> {\n  has: (k: K) => boolean\n  add: (k: K, v: V) => void\n  del: (k: K) => void\n  values: V[]\n}\n\nexport function createSimpleDict<K, V> (): SimpleDict<K, V> {\n  const set: { [k: string]: V } = {}\n\n  return {\n    has: function (k: K) { return set[JSON.stringify(k)] !== undefined },\n    add: function (k: K, v: V) { set[JSON.stringify(k)] = v },\n    del: function (k: K) { delete set[JSON.stringify(k)] },\n    get values () { return Object.keys(set).map(k => set[k]) }\n  }\n}\n\nexport interface SimpleSet<T> {\n  has: (value: T) => boolean\n  add: (value: T) => void\n  del: (value: T) => void\n  list: T[]\n}\n\nexport function createSimpleSet<T> (): SimpleSet<T> {\n  const set: { [k: string]: T } = {}\n\n  return {\n    has: function (v: T) { return set[JSON.stringify(v)] !== undefined },\n    add: function (v: T) { set[JSON.stringify(v)] = v },\n    del: function (v: T) { delete set[JSON.stringify(v)] },\n    get list () { return Object.keys(set).map(k => set[k]) },\n  }\n}\n","/**\n * @file Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\n\nfunction toLowerCaseString (value: string) {\n  return defaults(value, '').toString().toLowerCase()\n}\n\nexport default class Registry {\n  name: string\n  private _dict: {[k: string]: any}\n\n  constructor (name: string) {\n    this.name = name\n    this._dict = {}\n  }\n\n  add (key: string, value: any) {\n    this._dict[ toLowerCaseString(key) ] = value\n  }\n\n  get (key: string) {\n    return this._dict[ toLowerCaseString(key) ]\n  }\n\n  get names () {\n    return Object.keys(this._dict)\n  }\n}","/**\n * @file Math Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport function degToRad (deg: number) {\n  return deg * 0.01745  // deg * Math.PI / 180\n}\n\nexport function radToDeg (rad: number) {\n  return rad * 57.29578  // rad * 180 / Math.PI\n}\n\n// http://www.broofa.com/Tools/Math.uuid.htm\nconst chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('')\nconst uuid = new Array(36)\n\nexport function generateUUID () {\n  let rnd = 0\n  let r\n\n  for (let i = 0; i < 36; i++) {\n    if (i === 8 || i === 13 || i === 18 || i === 23) {\n      uuid[ i ] = '-'\n    } else if (i === 14) {\n      uuid[ i ] = '4'\n    } else {\n      if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0\n      r = rnd & 0xf\n      rnd = rnd >> 4\n      uuid[ i ] = chars[ (i === 19) ? (r & 0x3) | 0x8 : r ]\n    }\n  }\n\n  return uuid.join('')\n}\n\nexport function countSetBits (i: number) {\n  i = i - ((i >> 1) & 0x55555555)\n  i = (i & 0x33333333) + ((i >> 2) & 0x33333333)\n  return (((i + (i >> 4)) & 0x0F0F0F0F) * 0x01010101) >> 24\n}\n\nexport function normalize (value: number, min: number, max: number) {\n  return (value - min) / (max - min)\n}\n\nexport function clamp (value: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, value))\n}\n\nexport function pclamp (value: number) {\n  return clamp(value, 0, 100)\n}\n\nexport function saturate (value: number) {\n  return clamp(value, 0, 1)\n}\n\nexport function lerp (start: number, stop: number, alpha: number) {\n  return start + (stop - start) * alpha\n}\n\nexport function spline (p0: number, p1: number, p2: number, p3: number, t: number, tension: number) {\n  const v0 = (p2 - p0) * tension\n  const v1 = (p3 - p1) * tension\n  const t2 = t * t\n  const t3 = t * t2\n  return (2 * p1 - 2 * p2 + v0 + v1) * t3 +\n         (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 +\n         v0 * t + p1\n}\n\nexport function smoothstep (min: number, max: number, x: number) {\n  x = saturate(normalize(x, min, max))\n  return x * x * (3 - 2 * x)\n}\n\nexport function smootherstep (min: number, max: number, x: number) {\n  x = saturate(normalize(x, min, max))\n  return x * x * x * (x * (x * 6 - 15) + 10)\n}\n\nexport function smootheststep (min: number, max: number, x: number) {\n  x = saturate(normalize(x, min, max))\n  return (\n    -20 * Math.pow(x, 7) +\n     70 * Math.pow(x, 6) -\n     84 * Math.pow(x, 5) +\n     35 * Math.pow(x, 4)\n  )\n}\n\nexport function almostIdentity (value: number, start: number, stop: number) {\n  if (value > start) return value\n  const a = 2 * stop - start\n  const b = 2 * start - 3 * stop\n  const t = value / start\n  return (a * t + b) * t * t + stop\n}","\n/**\n * @license\n *\n * chroma.js - JavaScript library for color conversions\n * \n * Copyright (c) 2011-2017, Gregor Aisch\n * All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n * \n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n * \n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n * \n * 3. The name Gregor Aisch may not be used to endorse or promote products\n *    derived from this software without specific prior written permission.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n */\n\n(function() {\n  var Color, DEG2RAD, LAB_CONSTANTS, PI, PITHIRD, RAD2DEG, TWOPI, _average_lrgb, _guess_formats, _guess_formats_sorted, _input, _interpolators, abs, atan2, bezier, blend, blend_f, brewer, burn, chroma, clip_rgb, cmyk2rgb, colors, cos, css2rgb, darken, dodge, each, floor, hcg2rgb, hex2rgb, hsi2rgb, hsl2css, hsl2rgb, hsv2rgb, interpolate, interpolate_hsx, interpolate_lab, interpolate_lrgb, interpolate_num, interpolate_rgb, lab2lch, lab2rgb, lab_xyz, lch2lab, lch2rgb, lighten, limit, log, luminance_x, m, max, multiply, normal, num2rgb, overlay, pow, rgb2cmyk, rgb2css, rgb2hcg, rgb2hex, rgb2hsi, rgb2hsl, rgb2hsv, rgb2lab, rgb2lch, rgb2luminance, rgb2num, rgb2temperature, rgb2xyz, rgb_xyz, rnd, root, round, screen, sin, sqrt, temperature2rgb, type, unpack, w3cx11, xyz_lab, xyz_rgb,\n    slice = [].slice;\n\n  type = (function() {\n\n    /*\n    for browser-safe type checking+\n    ported from jQuery's $.type\n     */\n    var classToType, len, name, o, ref;\n    classToType = {};\n    ref = \"Boolean Number String Function Array Date RegExp Undefined Null\".split(\" \");\n    for (o = 0, len = ref.length; o < len; o++) {\n      name = ref[o];\n      classToType[\"[object \" + name + \"]\"] = name.toLowerCase();\n    }\n    return function(obj) {\n      var strType;\n      strType = Object.prototype.toString.call(obj);\n      return classToType[strType] || \"object\";\n    };\n  })();\n\n  limit = function(x, min, max) {\n    if (min == null) {\n      min = 0;\n    }\n    if (max == null) {\n      max = 1;\n    }\n    if (x < min) {\n      x = min;\n    }\n    if (x > max) {\n      x = max;\n    }\n    return x;\n  };\n\n  unpack = function(args) {\n    if (args.length >= 3) {\n      return Array.prototype.slice.call(args);\n    } else {\n      return args[0];\n    }\n  };\n\n  clip_rgb = function(rgb) {\n    var i, o;\n    rgb._clipped = false;\n    rgb._unclipped = rgb.slice(0);\n    for (i = o = 0; o < 3; i = ++o) {\n      if (i < 3) {\n        if (rgb[i] < 0 || rgb[i] > 255) {\n          rgb._clipped = true;\n        }\n        if (rgb[i] < 0) {\n          rgb[i] = 0;\n        }\n        if (rgb[i] > 255) {\n          rgb[i] = 255;\n        }\n      } else if (i === 3) {\n        if (rgb[i] < 0) {\n          rgb[i] = 0;\n        }\n        if (rgb[i] > 1) {\n          rgb[i] = 1;\n        }\n      }\n    }\n    if (!rgb._clipped) {\n      delete rgb._unclipped;\n    }\n    return rgb;\n  };\n\n  PI = Math.PI, round = Math.round, cos = Math.cos, floor = Math.floor, pow = Math.pow, log = Math.log, sin = Math.sin, sqrt = Math.sqrt, atan2 = Math.atan2, max = Math.max, abs = Math.abs;\n\n  TWOPI = PI * 2;\n\n  PITHIRD = PI / 3;\n\n  DEG2RAD = PI / 180;\n\n  RAD2DEG = 180 / PI;\n\n  chroma = function() {\n    if (arguments[0] instanceof Color) {\n      return arguments[0];\n    }\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, arguments, function(){});\n  };\n\n  chroma[\"default\"] = chroma;\n\n  _interpolators = [];\n\n  if ((typeof module !== \"undefined\" && module !== null) && (module.exports != null)) {\n    module.exports = chroma;\n  }\n\n  if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return chroma;\n    });\n  } else {\n    root = typeof exports !== \"undefined\" && exports !== null ? exports : this;\n    root.chroma = chroma;\n  }\n\n  chroma.version = '1.4.1';\n\n  _input = {};\n\n  _guess_formats = [];\n\n  _guess_formats_sorted = false;\n\n  Color = (function() {\n    function Color() {\n      var arg, args, chk, len, len1, me, mode, o, w;\n      me = this;\n      args = [];\n      for (o = 0, len = arguments.length; o < len; o++) {\n        arg = arguments[o];\n        if (arg != null) {\n          args.push(arg);\n        }\n      }\n      if (args.length > 1) {\n        mode = args[args.length - 1];\n      }\n      if (_input[mode] != null) {\n        me._rgb = clip_rgb(_input[mode](unpack(args.slice(0, -1))));\n      } else {\n        if (!_guess_formats_sorted) {\n          _guess_formats = _guess_formats.sort(function(a, b) {\n            return b.p - a.p;\n          });\n          _guess_formats_sorted = true;\n        }\n        for (w = 0, len1 = _guess_formats.length; w < len1; w++) {\n          chk = _guess_formats[w];\n          mode = chk.test.apply(chk, args);\n          if (mode) {\n            break;\n          }\n        }\n        if (mode) {\n          me._rgb = clip_rgb(_input[mode].apply(_input, args));\n        }\n      }\n      if (me._rgb == null) {\n        console.warn('unknown format: ' + args);\n      }\n      if (me._rgb == null) {\n        me._rgb = [0, 0, 0];\n      }\n      if (me._rgb.length === 3) {\n        me._rgb.push(1);\n      }\n    }\n\n    Color.prototype.toString = function() {\n      return this.hex();\n    };\n\n    return Color;\n\n  })();\n\n  chroma._input = _input;\n\n\n  /**\n  \tColorBrewer colors for chroma.js\n  \n  \tCopyright (c) 2002 Cynthia Brewer, Mark Harrower, and The \n  \tPennsylvania State University.\n  \n  \tLicensed under the Apache License, Version 2.0 (the \"License\"); \n  \tyou may not use this file except in compliance with the License.\n  \tYou may obtain a copy of the License at\t\n  \thttp://www.apache.org/licenses/LICENSE-2.0\n  \n  \tUnless required by applicable law or agreed to in writing, software distributed\n  \tunder the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n  \tCONDITIONS OF ANY KIND, either express or implied. See the License for the\n  \tspecific language governing permissions and limitations under the License.\n  \n      @preserve\n   */\n\n  chroma.brewer = brewer = {\n    OrRd: ['#fff7ec', '#fee8c8', '#fdd49e', '#fdbb84', '#fc8d59', '#ef6548', '#d7301f', '#b30000', '#7f0000'],\n    PuBu: ['#fff7fb', '#ece7f2', '#d0d1e6', '#a6bddb', '#74a9cf', '#3690c0', '#0570b0', '#045a8d', '#023858'],\n    BuPu: ['#f7fcfd', '#e0ecf4', '#bfd3e6', '#9ebcda', '#8c96c6', '#8c6bb1', '#88419d', '#810f7c', '#4d004b'],\n    Oranges: ['#fff5eb', '#fee6ce', '#fdd0a2', '#fdae6b', '#fd8d3c', '#f16913', '#d94801', '#a63603', '#7f2704'],\n    BuGn: ['#f7fcfd', '#e5f5f9', '#ccece6', '#99d8c9', '#66c2a4', '#41ae76', '#238b45', '#006d2c', '#00441b'],\n    YlOrBr: ['#ffffe5', '#fff7bc', '#fee391', '#fec44f', '#fe9929', '#ec7014', '#cc4c02', '#993404', '#662506'],\n    YlGn: ['#ffffe5', '#f7fcb9', '#d9f0a3', '#addd8e', '#78c679', '#41ab5d', '#238443', '#006837', '#004529'],\n    Reds: ['#fff5f0', '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a', '#ef3b2c', '#cb181d', '#a50f15', '#67000d'],\n    RdPu: ['#fff7f3', '#fde0dd', '#fcc5c0', '#fa9fb5', '#f768a1', '#dd3497', '#ae017e', '#7a0177', '#49006a'],\n    Greens: ['#f7fcf5', '#e5f5e0', '#c7e9c0', '#a1d99b', '#74c476', '#41ab5d', '#238b45', '#006d2c', '#00441b'],\n    YlGnBu: ['#ffffd9', '#edf8b1', '#c7e9b4', '#7fcdbb', '#41b6c4', '#1d91c0', '#225ea8', '#253494', '#081d58'],\n    Purples: ['#fcfbfd', '#efedf5', '#dadaeb', '#bcbddc', '#9e9ac8', '#807dba', '#6a51a3', '#54278f', '#3f007d'],\n    GnBu: ['#f7fcf0', '#e0f3db', '#ccebc5', '#a8ddb5', '#7bccc4', '#4eb3d3', '#2b8cbe', '#0868ac', '#084081'],\n    Greys: ['#ffffff', '#f0f0f0', '#d9d9d9', '#bdbdbd', '#969696', '#737373', '#525252', '#252525', '#000000'],\n    YlOrRd: ['#ffffcc', '#ffeda0', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#bd0026', '#800026'],\n    PuRd: ['#f7f4f9', '#e7e1ef', '#d4b9da', '#c994c7', '#df65b0', '#e7298a', '#ce1256', '#980043', '#67001f'],\n    Blues: ['#f7fbff', '#deebf7', '#c6dbef', '#9ecae1', '#6baed6', '#4292c6', '#2171b5', '#08519c', '#08306b'],\n    PuBuGn: ['#fff7fb', '#ece2f0', '#d0d1e6', '#a6bddb', '#67a9cf', '#3690c0', '#02818a', '#016c59', '#014636'],\n    Viridis: ['#440154', '#482777', '#3f4a8a', '#31678e', '#26838f', '#1f9d8a', '#6cce5a', '#b6de2b', '#fee825'],\n    Spectral: ['#9e0142', '#d53e4f', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#e6f598', '#abdda4', '#66c2a5', '#3288bd', '#5e4fa2'],\n    RdYlGn: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee08b', '#ffffbf', '#d9ef8b', '#a6d96a', '#66bd63', '#1a9850', '#006837'],\n    RdBu: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#f7f7f7', '#d1e5f0', '#92c5de', '#4393c3', '#2166ac', '#053061'],\n    PiYG: ['#8e0152', '#c51b7d', '#de77ae', '#f1b6da', '#fde0ef', '#f7f7f7', '#e6f5d0', '#b8e186', '#7fbc41', '#4d9221', '#276419'],\n    PRGn: ['#40004b', '#762a83', '#9970ab', '#c2a5cf', '#e7d4e8', '#f7f7f7', '#d9f0d3', '#a6dba0', '#5aae61', '#1b7837', '#00441b'],\n    RdYlBu: ['#a50026', '#d73027', '#f46d43', '#fdae61', '#fee090', '#ffffbf', '#e0f3f8', '#abd9e9', '#74add1', '#4575b4', '#313695'],\n    BrBG: ['#543005', '#8c510a', '#bf812d', '#dfc27d', '#f6e8c3', '#f5f5f5', '#c7eae5', '#80cdc1', '#35978f', '#01665e', '#003c30'],\n    RdGy: ['#67001f', '#b2182b', '#d6604d', '#f4a582', '#fddbc7', '#ffffff', '#e0e0e0', '#bababa', '#878787', '#4d4d4d', '#1a1a1a'],\n    PuOr: ['#7f3b08', '#b35806', '#e08214', '#fdb863', '#fee0b6', '#f7f7f7', '#d8daeb', '#b2abd2', '#8073ac', '#542788', '#2d004b'],\n    Set2: ['#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', '#ffd92f', '#e5c494', '#b3b3b3'],\n    Accent: ['#7fc97f', '#beaed4', '#fdc086', '#ffff99', '#386cb0', '#f0027f', '#bf5b17', '#666666'],\n    Set1: ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'],\n    Set3: ['#8dd3c7', '#ffffb3', '#bebada', '#fb8072', '#80b1d3', '#fdb462', '#b3de69', '#fccde5', '#d9d9d9', '#bc80bd', '#ccebc5', '#ffed6f'],\n    Dark2: ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e', '#e6ab02', '#a6761d', '#666666'],\n    Paired: ['#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'],\n    Pastel2: ['#b3e2cd', '#fdcdac', '#cbd5e8', '#f4cae4', '#e6f5c9', '#fff2ae', '#f1e2cc', '#cccccc'],\n    Pastel1: ['#fbb4ae', '#b3cde3', '#ccebc5', '#decbe4', '#fed9a6', '#ffffcc', '#e5d8bd', '#fddaec', '#f2f2f2']\n  };\n\n  (function() {\n    var key, results;\n    results = [];\n    for (key in brewer) {\n      results.push(brewer[key.toLowerCase()] = brewer[key]);\n    }\n    return results;\n  })();\n\n\n  /**\n  \tX11 color names\n  \n  \thttp://www.w3.org/TR/css3-color/#svg-color\n   */\n\n  w3cx11 = {\n    aliceblue: '#f0f8ff',\n    antiquewhite: '#faebd7',\n    aqua: '#00ffff',\n    aquamarine: '#7fffd4',\n    azure: '#f0ffff',\n    beige: '#f5f5dc',\n    bisque: '#ffe4c4',\n    black: '#000000',\n    blanchedalmond: '#ffebcd',\n    blue: '#0000ff',\n    blueviolet: '#8a2be2',\n    brown: '#a52a2a',\n    burlywood: '#deb887',\n    cadetblue: '#5f9ea0',\n    chartreuse: '#7fff00',\n    chocolate: '#d2691e',\n    coral: '#ff7f50',\n    cornflower: '#6495ed',\n    cornflowerblue: '#6495ed',\n    cornsilk: '#fff8dc',\n    crimson: '#dc143c',\n    cyan: '#00ffff',\n    darkblue: '#00008b',\n    darkcyan: '#008b8b',\n    darkgoldenrod: '#b8860b',\n    darkgray: '#a9a9a9',\n    darkgreen: '#006400',\n    darkgrey: '#a9a9a9',\n    darkkhaki: '#bdb76b',\n    darkmagenta: '#8b008b',\n    darkolivegreen: '#556b2f',\n    darkorange: '#ff8c00',\n    darkorchid: '#9932cc',\n    darkred: '#8b0000',\n    darksalmon: '#e9967a',\n    darkseagreen: '#8fbc8f',\n    darkslateblue: '#483d8b',\n    darkslategray: '#2f4f4f',\n    darkslategrey: '#2f4f4f',\n    darkturquoise: '#00ced1',\n    darkviolet: '#9400d3',\n    deeppink: '#ff1493',\n    deepskyblue: '#00bfff',\n    dimgray: '#696969',\n    dimgrey: '#696969',\n    dodgerblue: '#1e90ff',\n    firebrick: '#b22222',\n    floralwhite: '#fffaf0',\n    forestgreen: '#228b22',\n    fuchsia: '#ff00ff',\n    gainsboro: '#dcdcdc',\n    ghostwhite: '#f8f8ff',\n    gold: '#ffd700',\n    goldenrod: '#daa520',\n    gray: '#808080',\n    green: '#008000',\n    greenyellow: '#adff2f',\n    grey: '#808080',\n    honeydew: '#f0fff0',\n    hotpink: '#ff69b4',\n    indianred: '#cd5c5c',\n    indigo: '#4b0082',\n    ivory: '#fffff0',\n    khaki: '#f0e68c',\n    laserlemon: '#ffff54',\n    lavender: '#e6e6fa',\n    lavenderblush: '#fff0f5',\n    lawngreen: '#7cfc00',\n    lemonchiffon: '#fffacd',\n    lightblue: '#add8e6',\n    lightcoral: '#f08080',\n    lightcyan: '#e0ffff',\n    lightgoldenrod: '#fafad2',\n    lightgoldenrodyellow: '#fafad2',\n    lightgray: '#d3d3d3',\n    lightgreen: '#90ee90',\n    lightgrey: '#d3d3d3',\n    lightpink: '#ffb6c1',\n    lightsalmon: '#ffa07a',\n    lightseagreen: '#20b2aa',\n    lightskyblue: '#87cefa',\n    lightslategray: '#778899',\n    lightslategrey: '#778899',\n    lightsteelblue: '#b0c4de',\n    lightyellow: '#ffffe0',\n    lime: '#00ff00',\n    limegreen: '#32cd32',\n    linen: '#faf0e6',\n    magenta: '#ff00ff',\n    maroon: '#800000',\n    maroon2: '#7f0000',\n    maroon3: '#b03060',\n    mediumaquamarine: '#66cdaa',\n    mediumblue: '#0000cd',\n    mediumorchid: '#ba55d3',\n    mediumpurple: '#9370db',\n    mediumseagreen: '#3cb371',\n    mediumslateblue: '#7b68ee',\n    mediumspringgreen: '#00fa9a',\n    mediumturquoise: '#48d1cc',\n    mediumvioletred: '#c71585',\n    midnightblue: '#191970',\n    mintcream: '#f5fffa',\n    mistyrose: '#ffe4e1',\n    moccasin: '#ffe4b5',\n    navajowhite: '#ffdead',\n    navy: '#000080',\n    oldlace: '#fdf5e6',\n    olive: '#808000',\n    olivedrab: '#6b8e23',\n    orange: '#ffa500',\n    orangered: '#ff4500',\n    orchid: '#da70d6',\n    palegoldenrod: '#eee8aa',\n    palegreen: '#98fb98',\n    paleturquoise: '#afeeee',\n    palevioletred: '#db7093',\n    papayawhip: '#ffefd5',\n    peachpuff: '#ffdab9',\n    peru: '#cd853f',\n    pink: '#ffc0cb',\n    plum: '#dda0dd',\n    powderblue: '#b0e0e6',\n    purple: '#800080',\n    purple2: '#7f007f',\n    purple3: '#a020f0',\n    rebeccapurple: '#663399',\n    red: '#ff0000',\n    rosybrown: '#bc8f8f',\n    royalblue: '#4169e1',\n    saddlebrown: '#8b4513',\n    salmon: '#fa8072',\n    sandybrown: '#f4a460',\n    seagreen: '#2e8b57',\n    seashell: '#fff5ee',\n    sienna: '#a0522d',\n    silver: '#c0c0c0',\n    skyblue: '#87ceeb',\n    slateblue: '#6a5acd',\n    slategray: '#708090',\n    slategrey: '#708090',\n    snow: '#fffafa',\n    springgreen: '#00ff7f',\n    steelblue: '#4682b4',\n    tan: '#d2b48c',\n    teal: '#008080',\n    thistle: '#d8bfd8',\n    tomato: '#ff6347',\n    turquoise: '#40e0d0',\n    violet: '#ee82ee',\n    wheat: '#f5deb3',\n    white: '#ffffff',\n    whitesmoke: '#f5f5f5',\n    yellow: '#ffff00',\n    yellowgreen: '#9acd32'\n  };\n\n  chroma.colors = colors = w3cx11;\n\n  lab2rgb = function() {\n    var a, args, b, g, l, r, x, y, z;\n    args = unpack(arguments);\n    l = args[0], a = args[1], b = args[2];\n    y = (l + 16) / 116;\n    x = isNaN(a) ? y : y + a / 500;\n    z = isNaN(b) ? y : y - b / 200;\n    y = LAB_CONSTANTS.Yn * lab_xyz(y);\n    x = LAB_CONSTANTS.Xn * lab_xyz(x);\n    z = LAB_CONSTANTS.Zn * lab_xyz(z);\n    r = xyz_rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z);\n    g = xyz_rgb(-0.9692660 * x + 1.8760108 * y + 0.0415560 * z);\n    b = xyz_rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z);\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  xyz_rgb = function(r) {\n    return 255 * (r <= 0.00304 ? 12.92 * r : 1.055 * pow(r, 1 / 2.4) - 0.055);\n  };\n\n  lab_xyz = function(t) {\n    if (t > LAB_CONSTANTS.t1) {\n      return t * t * t;\n    } else {\n      return LAB_CONSTANTS.t2 * (t - LAB_CONSTANTS.t0);\n    }\n  };\n\n  LAB_CONSTANTS = {\n    Kn: 18,\n    Xn: 0.950470,\n    Yn: 1,\n    Zn: 1.088830,\n    t0: 0.137931034,\n    t1: 0.206896552,\n    t2: 0.12841855,\n    t3: 0.008856452\n  };\n\n  rgb2lab = function() {\n    var b, g, r, ref, ref1, x, y, z;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    ref1 = rgb2xyz(r, g, b), x = ref1[0], y = ref1[1], z = ref1[2];\n    return [116 * y - 16, 500 * (x - y), 200 * (y - z)];\n  };\n\n  rgb_xyz = function(r) {\n    if ((r /= 255) <= 0.04045) {\n      return r / 12.92;\n    } else {\n      return pow((r + 0.055) / 1.055, 2.4);\n    }\n  };\n\n  xyz_lab = function(t) {\n    if (t > LAB_CONSTANTS.t3) {\n      return pow(t, 1 / 3);\n    } else {\n      return t / LAB_CONSTANTS.t2 + LAB_CONSTANTS.t0;\n    }\n  };\n\n  rgb2xyz = function() {\n    var b, g, r, ref, x, y, z;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    r = rgb_xyz(r);\n    g = rgb_xyz(g);\n    b = rgb_xyz(b);\n    x = xyz_lab((0.4124564 * r + 0.3575761 * g + 0.1804375 * b) / LAB_CONSTANTS.Xn);\n    y = xyz_lab((0.2126729 * r + 0.7151522 * g + 0.0721750 * b) / LAB_CONSTANTS.Yn);\n    z = xyz_lab((0.0193339 * r + 0.1191920 * g + 0.9503041 * b) / LAB_CONSTANTS.Zn);\n    return [x, y, z];\n  };\n\n  chroma.lab = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['lab']), function(){});\n  };\n\n  _input.lab = lab2rgb;\n\n  Color.prototype.lab = function() {\n    return rgb2lab(this._rgb);\n  };\n\n  bezier = function(colors) {\n    var I, I0, I1, c, lab0, lab1, lab2, lab3, ref, ref1, ref2;\n    colors = (function() {\n      var len, o, results;\n      results = [];\n      for (o = 0, len = colors.length; o < len; o++) {\n        c = colors[o];\n        results.push(chroma(c));\n      }\n      return results;\n    })();\n    if (colors.length === 2) {\n      ref = (function() {\n        var len, o, results;\n        results = [];\n        for (o = 0, len = colors.length; o < len; o++) {\n          c = colors[o];\n          results.push(c.lab());\n        }\n        return results;\n      })(), lab0 = ref[0], lab1 = ref[1];\n      I = function(t) {\n        var i, lab;\n        lab = (function() {\n          var o, results;\n          results = [];\n          for (i = o = 0; o <= 2; i = ++o) {\n            results.push(lab0[i] + t * (lab1[i] - lab0[i]));\n          }\n          return results;\n        })();\n        return chroma.lab.apply(chroma, lab);\n      };\n    } else if (colors.length === 3) {\n      ref1 = (function() {\n        var len, o, results;\n        results = [];\n        for (o = 0, len = colors.length; o < len; o++) {\n          c = colors[o];\n          results.push(c.lab());\n        }\n        return results;\n      })(), lab0 = ref1[0], lab1 = ref1[1], lab2 = ref1[2];\n      I = function(t) {\n        var i, lab;\n        lab = (function() {\n          var o, results;\n          results = [];\n          for (i = o = 0; o <= 2; i = ++o) {\n            results.push((1 - t) * (1 - t) * lab0[i] + 2 * (1 - t) * t * lab1[i] + t * t * lab2[i]);\n          }\n          return results;\n        })();\n        return chroma.lab.apply(chroma, lab);\n      };\n    } else if (colors.length === 4) {\n      ref2 = (function() {\n        var len, o, results;\n        results = [];\n        for (o = 0, len = colors.length; o < len; o++) {\n          c = colors[o];\n          results.push(c.lab());\n        }\n        return results;\n      })(), lab0 = ref2[0], lab1 = ref2[1], lab2 = ref2[2], lab3 = ref2[3];\n      I = function(t) {\n        var i, lab;\n        lab = (function() {\n          var o, results;\n          results = [];\n          for (i = o = 0; o <= 2; i = ++o) {\n            results.push((1 - t) * (1 - t) * (1 - t) * lab0[i] + 3 * (1 - t) * (1 - t) * t * lab1[i] + 3 * (1 - t) * t * t * lab2[i] + t * t * t * lab3[i]);\n          }\n          return results;\n        })();\n        return chroma.lab.apply(chroma, lab);\n      };\n    } else if (colors.length === 5) {\n      I0 = bezier(colors.slice(0, 3));\n      I1 = bezier(colors.slice(2, 5));\n      I = function(t) {\n        if (t < 0.5) {\n          return I0(t * 2);\n        } else {\n          return I1((t - 0.5) * 2);\n        }\n      };\n    }\n    return I;\n  };\n\n  chroma.bezier = function(colors) {\n    var f;\n    f = bezier(colors);\n    f.scale = function() {\n      return chroma.scale(f);\n    };\n    return f;\n  };\n\n  chroma.cubehelix = function(start, rotations, hue, gamma, lightness) {\n    var dh, dl, f;\n    if (start == null) {\n      start = 300;\n    }\n    if (rotations == null) {\n      rotations = -1.5;\n    }\n    if (hue == null) {\n      hue = 1;\n    }\n    if (gamma == null) {\n      gamma = 1;\n    }\n    if (lightness == null) {\n      lightness = [0, 1];\n    }\n    dh = 0;\n    if (type(lightness) === 'array') {\n      dl = lightness[1] - lightness[0];\n    } else {\n      dl = 0;\n      lightness = [lightness, lightness];\n    }\n    f = function(fract) {\n      var a, amp, b, cos_a, g, h, l, r, sin_a;\n      a = TWOPI * ((start + 120) / 360 + rotations * fract);\n      l = pow(lightness[0] + dl * fract, gamma);\n      h = dh !== 0 ? hue[0] + fract * dh : hue;\n      amp = h * l * (1 - l) / 2;\n      cos_a = cos(a);\n      sin_a = sin(a);\n      r = l + amp * (-0.14861 * cos_a + 1.78277 * sin_a);\n      g = l + amp * (-0.29227 * cos_a - 0.90649 * sin_a);\n      b = l + amp * (+1.97294 * cos_a);\n      return chroma(clip_rgb([r * 255, g * 255, b * 255, 1]));\n    };\n    f.start = function(s) {\n      if (s == null) {\n        return start;\n      }\n      start = s;\n      return f;\n    };\n    f.rotations = function(r) {\n      if (r == null) {\n        return rotations;\n      }\n      rotations = r;\n      return f;\n    };\n    f.gamma = function(g) {\n      if (g == null) {\n        return gamma;\n      }\n      gamma = g;\n      return f;\n    };\n    f.hue = function(h) {\n      if (h == null) {\n        return hue;\n      }\n      hue = h;\n      if (type(hue) === 'array') {\n        dh = hue[1] - hue[0];\n        if (dh === 0) {\n          hue = hue[1];\n        }\n      } else {\n        dh = 0;\n      }\n      return f;\n    };\n    f.lightness = function(h) {\n      if (h == null) {\n        return lightness;\n      }\n      if (type(h) === 'array') {\n        lightness = h;\n        dl = h[1] - h[0];\n      } else {\n        lightness = [h, h];\n        dl = 0;\n      }\n      return f;\n    };\n    f.scale = function() {\n      return chroma.scale(f);\n    };\n    f.hue(hue);\n    return f;\n  };\n\n  chroma.random = function() {\n    var code, digits, i, o;\n    digits = '0123456789abcdef';\n    code = '#';\n    for (i = o = 0; o < 6; i = ++o) {\n      code += digits.charAt(floor(Math.random() * 16));\n    }\n    return new Color(code);\n  };\n\n  _interpolators = [];\n\n  interpolate = function(col1, col2, f, m) {\n    var interpol, len, o, res;\n    if (f == null) {\n      f = 0.5;\n    }\n    if (m == null) {\n      m = 'rgb';\n    }\n\n    /*\n    interpolates between colors\n    f = 0 --> me\n    f = 1 --> col\n     */\n    if (type(col1) !== 'object') {\n      col1 = chroma(col1);\n    }\n    if (type(col2) !== 'object') {\n      col2 = chroma(col2);\n    }\n    for (o = 0, len = _interpolators.length; o < len; o++) {\n      interpol = _interpolators[o];\n      if (m === interpol[0]) {\n        res = interpol[1](col1, col2, f, m);\n        break;\n      }\n    }\n    if (res == null) {\n      throw \"color mode \" + m + \" is not supported\";\n    }\n    return res.alpha(col1.alpha() + f * (col2.alpha() - col1.alpha()));\n  };\n\n  chroma.interpolate = interpolate;\n\n  Color.prototype.interpolate = function(col2, f, m) {\n    return interpolate(this, col2, f, m);\n  };\n\n  chroma.mix = interpolate;\n\n  Color.prototype.mix = Color.prototype.interpolate;\n\n  _input.rgb = function() {\n    var k, ref, results, v;\n    ref = unpack(arguments);\n    results = [];\n    for (k in ref) {\n      v = ref[k];\n      results.push(v);\n    }\n    return results;\n  };\n\n  chroma.rgb = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['rgb']), function(){});\n  };\n\n  Color.prototype.rgb = function(round) {\n    if (round == null) {\n      round = true;\n    }\n    if (round) {\n      return this._rgb.map(Math.round).slice(0, 3);\n    } else {\n      return this._rgb.slice(0, 3);\n    }\n  };\n\n  Color.prototype.rgba = function(round) {\n    if (round == null) {\n      round = true;\n    }\n    if (!round) {\n      return this._rgb.slice(0);\n    }\n    return [Math.round(this._rgb[0]), Math.round(this._rgb[1]), Math.round(this._rgb[2]), this._rgb[3]];\n  };\n\n  _guess_formats.push({\n    p: 3,\n    test: function(n) {\n      var a;\n      a = unpack(arguments);\n      if (type(a) === 'array' && a.length === 3) {\n        return 'rgb';\n      }\n      if (a.length === 4 && type(a[3]) === \"number\" && a[3] >= 0 && a[3] <= 1) {\n        return 'rgb';\n      }\n    }\n  });\n\n  _input.lrgb = _input.rgb;\n\n  interpolate_lrgb = function(col1, col2, f, m) {\n    var xyz0, xyz1;\n    xyz0 = col1._rgb;\n    xyz1 = col2._rgb;\n    return new Color(sqrt(pow(xyz0[0], 2) * (1 - f) + pow(xyz1[0], 2) * f), sqrt(pow(xyz0[1], 2) * (1 - f) + pow(xyz1[1], 2) * f), sqrt(pow(xyz0[2], 2) * (1 - f) + pow(xyz1[2], 2) * f), m);\n  };\n\n  _average_lrgb = function(colors) {\n    var col, f, len, o, rgb, xyz;\n    f = 1 / colors.length;\n    xyz = [0, 0, 0, 0];\n    for (o = 0, len = colors.length; o < len; o++) {\n      col = colors[o];\n      rgb = col._rgb;\n      xyz[0] += pow(rgb[0], 2) * f;\n      xyz[1] += pow(rgb[1], 2) * f;\n      xyz[2] += pow(rgb[2], 2) * f;\n      xyz[3] += rgb[3] * f;\n    }\n    xyz[0] = sqrt(xyz[0]);\n    xyz[1] = sqrt(xyz[1]);\n    xyz[2] = sqrt(xyz[2]);\n    if (xyz[3] > 1) {\n      xyz[3] = 1;\n    }\n    return new Color(clip_rgb(xyz));\n  };\n\n  _interpolators.push(['lrgb', interpolate_lrgb]);\n\n  chroma.average = function(colors, mode) {\n    var A, alpha, c, cnt, dx, dy, first, i, l, len, o, xyz, xyz2;\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    l = colors.length;\n    colors = colors.map(function(c) {\n      return chroma(c);\n    });\n    first = colors.splice(0, 1)[0];\n    if (mode === 'lrgb') {\n      return _average_lrgb(colors);\n    }\n    xyz = first.get(mode);\n    cnt = [];\n    dx = 0;\n    dy = 0;\n    for (i in xyz) {\n      xyz[i] = xyz[i] || 0;\n      cnt.push(isNaN(xyz[i]) ? 0 : 1);\n      if (mode.charAt(i) === 'h' && !isNaN(xyz[i])) {\n        A = xyz[i] / 180 * PI;\n        dx += cos(A);\n        dy += sin(A);\n      }\n    }\n    alpha = first.alpha();\n    for (o = 0, len = colors.length; o < len; o++) {\n      c = colors[o];\n      xyz2 = c.get(mode);\n      alpha += c.alpha();\n      for (i in xyz) {\n        if (!isNaN(xyz2[i])) {\n          cnt[i] += 1;\n          if (mode.charAt(i) === 'h') {\n            A = xyz2[i] / 180 * PI;\n            dx += cos(A);\n            dy += sin(A);\n          } else {\n            xyz[i] += xyz2[i];\n          }\n        }\n      }\n    }\n    for (i in xyz) {\n      if (mode.charAt(i) === 'h') {\n        A = atan2(dy / cnt[i], dx / cnt[i]) / PI * 180;\n        while (A < 0) {\n          A += 360;\n        }\n        while (A >= 360) {\n          A -= 360;\n        }\n        xyz[i] = A;\n      } else {\n        xyz[i] = xyz[i] / cnt[i];\n      }\n    }\n    return chroma(xyz, mode).alpha(alpha / l);\n  };\n\n  hex2rgb = function(hex) {\n    var a, b, g, r, rgb, u;\n    if (hex.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)) {\n      if (hex.length === 4 || hex.length === 7) {\n        hex = hex.substr(1);\n      }\n      if (hex.length === 3) {\n        hex = hex.split(\"\");\n        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n      }\n      u = parseInt(hex, 16);\n      r = u >> 16;\n      g = u >> 8 & 0xFF;\n      b = u & 0xFF;\n      return [r, g, b, 1];\n    }\n    if (hex.match(/^#?([A-Fa-f0-9]{8})$/)) {\n      if (hex.length === 9) {\n        hex = hex.substr(1);\n      }\n      u = parseInt(hex, 16);\n      r = u >> 24 & 0xFF;\n      g = u >> 16 & 0xFF;\n      b = u >> 8 & 0xFF;\n      a = round((u & 0xFF) / 0xFF * 100) / 100;\n      return [r, g, b, a];\n    }\n    if ((_input.css != null) && (rgb = _input.css(hex))) {\n      return rgb;\n    }\n    throw \"unknown color: \" + hex;\n  };\n\n  rgb2hex = function(channels, mode) {\n    var a, b, g, hxa, r, str, u;\n    if (mode == null) {\n      mode = 'auto';\n    }\n    r = channels[0], g = channels[1], b = channels[2], a = channels[3];\n    if (mode === 'auto') {\n      mode = a < 1 ? 'rgba' : 'rgb';\n    }\n    r = Math.round(r);\n    g = Math.round(g);\n    b = Math.round(b);\n    u = r << 16 | g << 8 | b;\n    str = \"000000\" + u.toString(16);\n    str = str.substr(str.length - 6);\n    hxa = '0' + round(a * 255).toString(16);\n    hxa = hxa.substr(hxa.length - 2);\n    return \"#\" + (function() {\n      switch (mode.toLowerCase()) {\n        case 'rgba':\n          return str + hxa;\n        case 'argb':\n          return hxa + str;\n        default:\n          return str;\n      }\n    })();\n  };\n\n  _input.hex = function(h) {\n    return hex2rgb(h);\n  };\n\n  chroma.hex = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hex']), function(){});\n  };\n\n  Color.prototype.hex = function(mode) {\n    if (mode == null) {\n      mode = 'auto';\n    }\n    return rgb2hex(this._rgb, mode);\n  };\n\n  _guess_formats.push({\n    p: 4,\n    test: function(n) {\n      if (arguments.length === 1 && type(n) === \"string\") {\n        return 'hex';\n      }\n    }\n  });\n\n  hsl2rgb = function() {\n    var args, b, c, g, h, i, l, o, r, ref, s, t1, t2, t3;\n    args = unpack(arguments);\n    h = args[0], s = args[1], l = args[2];\n    if (s === 0) {\n      r = g = b = l * 255;\n    } else {\n      t3 = [0, 0, 0];\n      c = [0, 0, 0];\n      t2 = l < 0.5 ? l * (1 + s) : l + s - l * s;\n      t1 = 2 * l - t2;\n      h /= 360;\n      t3[0] = h + 1 / 3;\n      t3[1] = h;\n      t3[2] = h - 1 / 3;\n      for (i = o = 0; o <= 2; i = ++o) {\n        if (t3[i] < 0) {\n          t3[i] += 1;\n        }\n        if (t3[i] > 1) {\n          t3[i] -= 1;\n        }\n        if (6 * t3[i] < 1) {\n          c[i] = t1 + (t2 - t1) * 6 * t3[i];\n        } else if (2 * t3[i] < 1) {\n          c[i] = t2;\n        } else if (3 * t3[i] < 2) {\n          c[i] = t1 + (t2 - t1) * ((2 / 3) - t3[i]) * 6;\n        } else {\n          c[i] = t1;\n        }\n      }\n      ref = [round(c[0] * 255), round(c[1] * 255), round(c[2] * 255)], r = ref[0], g = ref[1], b = ref[2];\n    }\n    if (args.length > 3) {\n      return [r, g, b, args[3]];\n    } else {\n      return [r, g, b];\n    }\n  };\n\n  rgb2hsl = function(r, g, b) {\n    var h, l, min, ref, s;\n    if (r !== void 0 && r.length >= 3) {\n      ref = r, r = ref[0], g = ref[1], b = ref[2];\n    }\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    min = Math.min(r, g, b);\n    max = Math.max(r, g, b);\n    l = (max + min) / 2;\n    if (max === min) {\n      s = 0;\n      h = Number.NaN;\n    } else {\n      s = l < 0.5 ? (max - min) / (max + min) : (max - min) / (2 - max - min);\n    }\n    if (r === max) {\n      h = (g - b) / (max - min);\n    } else if (g === max) {\n      h = 2 + (b - r) / (max - min);\n    } else if (b === max) {\n      h = 4 + (r - g) / (max - min);\n    }\n    h *= 60;\n    if (h < 0) {\n      h += 360;\n    }\n    return [h, s, l];\n  };\n\n  chroma.hsl = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hsl']), function(){});\n  };\n\n  _input.hsl = hsl2rgb;\n\n  Color.prototype.hsl = function() {\n    return rgb2hsl(this._rgb);\n  };\n\n  hsv2rgb = function() {\n    var args, b, f, g, h, i, p, q, r, ref, ref1, ref2, ref3, ref4, ref5, s, t, v;\n    args = unpack(arguments);\n    h = args[0], s = args[1], v = args[2];\n    v *= 255;\n    if (s === 0) {\n      r = g = b = v;\n    } else {\n      if (h === 360) {\n        h = 0;\n      }\n      if (h > 360) {\n        h -= 360;\n      }\n      if (h < 0) {\n        h += 360;\n      }\n      h /= 60;\n      i = floor(h);\n      f = h - i;\n      p = v * (1 - s);\n      q = v * (1 - s * f);\n      t = v * (1 - s * (1 - f));\n      switch (i) {\n        case 0:\n          ref = [v, t, p], r = ref[0], g = ref[1], b = ref[2];\n          break;\n        case 1:\n          ref1 = [q, v, p], r = ref1[0], g = ref1[1], b = ref1[2];\n          break;\n        case 2:\n          ref2 = [p, v, t], r = ref2[0], g = ref2[1], b = ref2[2];\n          break;\n        case 3:\n          ref3 = [p, q, v], r = ref3[0], g = ref3[1], b = ref3[2];\n          break;\n        case 4:\n          ref4 = [t, p, v], r = ref4[0], g = ref4[1], b = ref4[2];\n          break;\n        case 5:\n          ref5 = [v, p, q], r = ref5[0], g = ref5[1], b = ref5[2];\n      }\n    }\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  rgb2hsv = function() {\n    var b, delta, g, h, min, r, ref, s, v;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    min = Math.min(r, g, b);\n    max = Math.max(r, g, b);\n    delta = max - min;\n    v = max / 255.0;\n    if (max === 0) {\n      h = Number.NaN;\n      s = 0;\n    } else {\n      s = delta / max;\n      if (r === max) {\n        h = (g - b) / delta;\n      }\n      if (g === max) {\n        h = 2 + (b - r) / delta;\n      }\n      if (b === max) {\n        h = 4 + (r - g) / delta;\n      }\n      h *= 60;\n      if (h < 0) {\n        h += 360;\n      }\n    }\n    return [h, s, v];\n  };\n\n  chroma.hsv = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hsv']), function(){});\n  };\n\n  _input.hsv = hsv2rgb;\n\n  Color.prototype.hsv = function() {\n    return rgb2hsv(this._rgb);\n  };\n\n  num2rgb = function(num) {\n    var b, g, r;\n    if (type(num) === \"number\" && num >= 0 && num <= 0xFFFFFF) {\n      r = num >> 16;\n      g = (num >> 8) & 0xFF;\n      b = num & 0xFF;\n      return [r, g, b, 1];\n    }\n    console.warn(\"unknown num color: \" + num);\n    return [0, 0, 0, 1];\n  };\n\n  rgb2num = function() {\n    var b, g, r, ref;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    return (r << 16) + (g << 8) + b;\n  };\n\n  chroma.num = function(num) {\n    return new Color(num, 'num');\n  };\n\n  Color.prototype.num = function(mode) {\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    return rgb2num(this._rgb, mode);\n  };\n\n  _input.num = num2rgb;\n\n  _guess_formats.push({\n    p: 1,\n    test: function(n) {\n      if (arguments.length === 1 && type(n) === \"number\" && n >= 0 && n <= 0xFFFFFF) {\n        return 'num';\n      }\n    }\n  });\n\n  hcg2rgb = function() {\n    var _c, _g, args, b, c, f, g, h, i, p, q, r, ref, ref1, ref2, ref3, ref4, ref5, t, v;\n    args = unpack(arguments);\n    h = args[0], c = args[1], _g = args[2];\n    c = c / 100;\n    g = g / 100 * 255;\n    _c = c * 255;\n    if (c === 0) {\n      r = g = b = _g;\n    } else {\n      if (h === 360) {\n        h = 0;\n      }\n      if (h > 360) {\n        h -= 360;\n      }\n      if (h < 0) {\n        h += 360;\n      }\n      h /= 60;\n      i = floor(h);\n      f = h - i;\n      p = _g * (1 - c);\n      q = p + _c * (1 - f);\n      t = p + _c * f;\n      v = p + _c;\n      switch (i) {\n        case 0:\n          ref = [v, t, p], r = ref[0], g = ref[1], b = ref[2];\n          break;\n        case 1:\n          ref1 = [q, v, p], r = ref1[0], g = ref1[1], b = ref1[2];\n          break;\n        case 2:\n          ref2 = [p, v, t], r = ref2[0], g = ref2[1], b = ref2[2];\n          break;\n        case 3:\n          ref3 = [p, q, v], r = ref3[0], g = ref3[1], b = ref3[2];\n          break;\n        case 4:\n          ref4 = [t, p, v], r = ref4[0], g = ref4[1], b = ref4[2];\n          break;\n        case 5:\n          ref5 = [v, p, q], r = ref5[0], g = ref5[1], b = ref5[2];\n      }\n    }\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  rgb2hcg = function() {\n    var _g, b, c, delta, g, h, min, r, ref;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    min = Math.min(r, g, b);\n    max = Math.max(r, g, b);\n    delta = max - min;\n    c = delta * 100 / 255;\n    _g = min / (255 - delta) * 100;\n    if (delta === 0) {\n      h = Number.NaN;\n    } else {\n      if (r === max) {\n        h = (g - b) / delta;\n      }\n      if (g === max) {\n        h = 2 + (b - r) / delta;\n      }\n      if (b === max) {\n        h = 4 + (r - g) / delta;\n      }\n      h *= 60;\n      if (h < 0) {\n        h += 360;\n      }\n    }\n    return [h, c, _g];\n  };\n\n  chroma.hcg = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hcg']), function(){});\n  };\n\n  _input.hcg = hcg2rgb;\n\n  Color.prototype.hcg = function() {\n    return rgb2hcg(this._rgb);\n  };\n\n  css2rgb = function(css) {\n    var aa, ab, hsl, i, m, o, rgb, w;\n    css = css.toLowerCase();\n    if ((chroma.colors != null) && chroma.colors[css]) {\n      return hex2rgb(chroma.colors[css]);\n    }\n    if (m = css.match(/rgb\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*\\)/)) {\n      rgb = m.slice(1, 4);\n      for (i = o = 0; o <= 2; i = ++o) {\n        rgb[i] = +rgb[i];\n      }\n      rgb[3] = 1;\n    } else if (m = css.match(/rgba\\(\\s*(\\-?\\d+),\\s*(\\-?\\d+)\\s*,\\s*(\\-?\\d+)\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n      rgb = m.slice(1, 5);\n      for (i = w = 0; w <= 3; i = ++w) {\n        rgb[i] = +rgb[i];\n      }\n    } else if (m = css.match(/rgb\\(\\s*(\\-?\\d+(?:\\.\\d+)?)%,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*\\)/)) {\n      rgb = m.slice(1, 4);\n      for (i = aa = 0; aa <= 2; i = ++aa) {\n        rgb[i] = round(rgb[i] * 2.55);\n      }\n      rgb[3] = 1;\n    } else if (m = css.match(/rgba\\(\\s*(\\-?\\d+(?:\\.\\d+)?)%,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n      rgb = m.slice(1, 5);\n      for (i = ab = 0; ab <= 2; i = ++ab) {\n        rgb[i] = round(rgb[i] * 2.55);\n      }\n      rgb[3] = +rgb[3];\n    } else if (m = css.match(/hsl\\(\\s*(\\-?\\d+(?:\\.\\d+)?),\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*\\)/)) {\n      hsl = m.slice(1, 4);\n      hsl[1] *= 0.01;\n      hsl[2] *= 0.01;\n      rgb = hsl2rgb(hsl);\n      rgb[3] = 1;\n    } else if (m = css.match(/hsla\\(\\s*(\\-?\\d+(?:\\.\\d+)?),\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*(\\-?\\d+(?:\\.\\d+)?)%\\s*,\\s*([01]|[01]?\\.\\d+)\\)/)) {\n      hsl = m.slice(1, 4);\n      hsl[1] *= 0.01;\n      hsl[2] *= 0.01;\n      rgb = hsl2rgb(hsl);\n      rgb[3] = +m[4];\n    }\n    return rgb;\n  };\n\n  rgb2css = function(rgba) {\n    var mode;\n    mode = rgba[3] < 1 ? 'rgba' : 'rgb';\n    if (mode === 'rgb') {\n      return mode + '(' + rgba.slice(0, 3).map(round).join(',') + ')';\n    } else if (mode === 'rgba') {\n      return mode + '(' + rgba.slice(0, 3).map(round).join(',') + ',' + rgba[3] + ')';\n    } else {\n\n    }\n  };\n\n  rnd = function(a) {\n    return round(a * 100) / 100;\n  };\n\n  hsl2css = function(hsl, alpha) {\n    var mode;\n    mode = alpha < 1 ? 'hsla' : 'hsl';\n    hsl[0] = rnd(hsl[0] || 0);\n    hsl[1] = rnd(hsl[1] * 100) + '%';\n    hsl[2] = rnd(hsl[2] * 100) + '%';\n    if (mode === 'hsla') {\n      hsl[3] = alpha;\n    }\n    return mode + '(' + hsl.join(',') + ')';\n  };\n\n  _input.css = function(h) {\n    return css2rgb(h);\n  };\n\n  chroma.css = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['css']), function(){});\n  };\n\n  Color.prototype.css = function(mode) {\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    if (mode.slice(0, 3) === 'rgb') {\n      return rgb2css(this._rgb);\n    } else if (mode.slice(0, 3) === 'hsl') {\n      return hsl2css(this.hsl(), this.alpha());\n    }\n  };\n\n  _input.named = function(name) {\n    return hex2rgb(w3cx11[name]);\n  };\n\n  _guess_formats.push({\n    p: 5,\n    test: function(n) {\n      if (arguments.length === 1 && (w3cx11[n] != null)) {\n        return 'named';\n      }\n    }\n  });\n\n  Color.prototype.name = function(n) {\n    var h, k;\n    if (arguments.length) {\n      if (w3cx11[n]) {\n        this._rgb = hex2rgb(w3cx11[n]);\n      }\n      this._rgb[3] = 1;\n      this;\n    }\n    h = this.hex('rgb');\n    for (k in w3cx11) {\n      if (h === w3cx11[k]) {\n        return k;\n      }\n    }\n    return h;\n  };\n\n  lch2lab = function() {\n\n    /*\n    Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n    These formulas were invented by David Dalrymple to obtain maximum contrast without going\n    out of gamut if the parameters are in the range 0-1.\n    \n    A saturation multiplier was added by Gregor Aisch\n     */\n    var c, h, l, ref;\n    ref = unpack(arguments), l = ref[0], c = ref[1], h = ref[2];\n    h = h * DEG2RAD;\n    return [l, cos(h) * c, sin(h) * c];\n  };\n\n  lch2rgb = function() {\n    var L, a, args, b, c, g, h, l, r, ref, ref1;\n    args = unpack(arguments);\n    l = args[0], c = args[1], h = args[2];\n    ref = lch2lab(l, c, h), L = ref[0], a = ref[1], b = ref[2];\n    ref1 = lab2rgb(L, a, b), r = ref1[0], g = ref1[1], b = ref1[2];\n    return [r, g, b, args.length > 3 ? args[3] : 1];\n  };\n\n  lab2lch = function() {\n    var a, b, c, h, l, ref;\n    ref = unpack(arguments), l = ref[0], a = ref[1], b = ref[2];\n    c = sqrt(a * a + b * b);\n    h = (atan2(b, a) * RAD2DEG + 360) % 360;\n    if (round(c * 10000) === 0) {\n      h = Number.NaN;\n    }\n    return [l, c, h];\n  };\n\n  rgb2lch = function() {\n    var a, b, g, l, r, ref, ref1;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    ref1 = rgb2lab(r, g, b), l = ref1[0], a = ref1[1], b = ref1[2];\n    return lab2lch(l, a, b);\n  };\n\n  chroma.lch = function() {\n    var args;\n    args = unpack(arguments);\n    return new Color(args, 'lch');\n  };\n\n  chroma.hcl = function() {\n    var args;\n    args = unpack(arguments);\n    return new Color(args, 'hcl');\n  };\n\n  _input.lch = lch2rgb;\n\n  _input.hcl = function() {\n    var c, h, l, ref;\n    ref = unpack(arguments), h = ref[0], c = ref[1], l = ref[2];\n    return lch2rgb([l, c, h]);\n  };\n\n  Color.prototype.lch = function() {\n    return rgb2lch(this._rgb);\n  };\n\n  Color.prototype.hcl = function() {\n    return rgb2lch(this._rgb).reverse();\n  };\n\n  rgb2cmyk = function(mode) {\n    var b, c, f, g, k, m, r, ref, y;\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    r = r / 255;\n    g = g / 255;\n    b = b / 255;\n    k = 1 - Math.max(r, Math.max(g, b));\n    f = k < 1 ? 1 / (1 - k) : 0;\n    c = (1 - r - k) * f;\n    m = (1 - g - k) * f;\n    y = (1 - b - k) * f;\n    return [c, m, y, k];\n  };\n\n  cmyk2rgb = function() {\n    var alpha, args, b, c, g, k, m, r, y;\n    args = unpack(arguments);\n    c = args[0], m = args[1], y = args[2], k = args[3];\n    alpha = args.length > 4 ? args[4] : 1;\n    if (k === 1) {\n      return [0, 0, 0, alpha];\n    }\n    r = c >= 1 ? 0 : 255 * (1 - c) * (1 - k);\n    g = m >= 1 ? 0 : 255 * (1 - m) * (1 - k);\n    b = y >= 1 ? 0 : 255 * (1 - y) * (1 - k);\n    return [r, g, b, alpha];\n  };\n\n  _input.cmyk = function() {\n    return cmyk2rgb(unpack(arguments));\n  };\n\n  chroma.cmyk = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['cmyk']), function(){});\n  };\n\n  Color.prototype.cmyk = function() {\n    return rgb2cmyk(this._rgb);\n  };\n\n  _input.gl = function() {\n    var i, k, o, rgb, v;\n    rgb = (function() {\n      var ref, results;\n      ref = unpack(arguments);\n      results = [];\n      for (k in ref) {\n        v = ref[k];\n        results.push(v);\n      }\n      return results;\n    }).apply(this, arguments);\n    for (i = o = 0; o <= 2; i = ++o) {\n      rgb[i] *= 255;\n    }\n    return rgb;\n  };\n\n  chroma.gl = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['gl']), function(){});\n  };\n\n  Color.prototype.gl = function() {\n    var rgb;\n    rgb = this._rgb;\n    return [rgb[0] / 255, rgb[1] / 255, rgb[2] / 255, rgb[3]];\n  };\n\n  rgb2luminance = function(r, g, b) {\n    var ref;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    r = luminance_x(r);\n    g = luminance_x(g);\n    b = luminance_x(b);\n    return 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  };\n\n  luminance_x = function(x) {\n    x /= 255;\n    if (x <= 0.03928) {\n      return x / 12.92;\n    } else {\n      return pow((x + 0.055) / 1.055, 2.4);\n    }\n  };\n\n  interpolate_rgb = function(col1, col2, f, m) {\n    var xyz0, xyz1;\n    xyz0 = col1._rgb;\n    xyz1 = col2._rgb;\n    return new Color(xyz0[0] + f * (xyz1[0] - xyz0[0]), xyz0[1] + f * (xyz1[1] - xyz0[1]), xyz0[2] + f * (xyz1[2] - xyz0[2]), m);\n  };\n\n  _interpolators.push(['rgb', interpolate_rgb]);\n\n  Color.prototype.luminance = function(lum, mode) {\n    var cur_lum, eps, max_iter, rgba, test;\n    if (mode == null) {\n      mode = 'rgb';\n    }\n    if (!arguments.length) {\n      return rgb2luminance(this._rgb);\n    }\n    rgba = this._rgb;\n    if (lum === 0) {\n      rgba = [0, 0, 0, this._rgb[3]];\n    } else if (lum === 1) {\n      rgba = [255, 255, 255, this[3]];\n    } else {\n      cur_lum = rgb2luminance(this._rgb);\n      eps = 1e-7;\n      max_iter = 20;\n      test = function(l, h) {\n        var lm, m;\n        m = l.interpolate(h, 0.5, mode);\n        lm = m.luminance();\n        if (Math.abs(lum - lm) < eps || !max_iter--) {\n          return m;\n        }\n        if (lm > lum) {\n          return test(l, m);\n        }\n        return test(m, h);\n      };\n      if (cur_lum > lum) {\n        rgba = test(chroma('black'), this).rgba();\n      } else {\n        rgba = test(this, chroma('white')).rgba();\n      }\n    }\n    return chroma(rgba).alpha(this.alpha());\n  };\n\n  temperature2rgb = function(kelvin) {\n    var b, g, r, temp;\n    temp = kelvin / 100;\n    if (temp < 66) {\n      r = 255;\n      g = -155.25485562709179 - 0.44596950469579133 * (g = temp - 2) + 104.49216199393888 * log(g);\n      b = temp < 20 ? 0 : -254.76935184120902 + 0.8274096064007395 * (b = temp - 10) + 115.67994401066147 * log(b);\n    } else {\n      r = 351.97690566805693 + 0.114206453784165 * (r = temp - 55) - 40.25366309332127 * log(r);\n      g = 325.4494125711974 + 0.07943456536662342 * (g = temp - 50) - 28.0852963507957 * log(g);\n      b = 255;\n    }\n    return [r, g, b];\n  };\n\n  rgb2temperature = function() {\n    var b, eps, g, maxTemp, minTemp, r, ref, rgb, temp;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    minTemp = 1000;\n    maxTemp = 40000;\n    eps = 0.4;\n    while (maxTemp - minTemp > eps) {\n      temp = (maxTemp + minTemp) * 0.5;\n      rgb = temperature2rgb(temp);\n      if ((rgb[2] / rgb[0]) >= (b / r)) {\n        maxTemp = temp;\n      } else {\n        minTemp = temp;\n      }\n    }\n    return round(temp);\n  };\n\n  chroma.temperature = chroma.kelvin = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['temperature']), function(){});\n  };\n\n  _input.temperature = _input.kelvin = _input.K = temperature2rgb;\n\n  Color.prototype.temperature = function() {\n    return rgb2temperature(this._rgb);\n  };\n\n  Color.prototype.kelvin = Color.prototype.temperature;\n\n  chroma.contrast = function(a, b) {\n    var l1, l2, ref, ref1;\n    if ((ref = type(a)) === 'string' || ref === 'number') {\n      a = new Color(a);\n    }\n    if ((ref1 = type(b)) === 'string' || ref1 === 'number') {\n      b = new Color(b);\n    }\n    l1 = a.luminance();\n    l2 = b.luminance();\n    if (l1 > l2) {\n      return (l1 + 0.05) / (l2 + 0.05);\n    } else {\n      return (l2 + 0.05) / (l1 + 0.05);\n    }\n  };\n\n  chroma.distance = function(a, b, mode) {\n    var d, i, l1, l2, ref, ref1, sum_sq;\n    if (mode == null) {\n      mode = 'lab';\n    }\n    if ((ref = type(a)) === 'string' || ref === 'number') {\n      a = new Color(a);\n    }\n    if ((ref1 = type(b)) === 'string' || ref1 === 'number') {\n      b = new Color(b);\n    }\n    l1 = a.get(mode);\n    l2 = b.get(mode);\n    sum_sq = 0;\n    for (i in l1) {\n      d = (l1[i] || 0) - (l2[i] || 0);\n      sum_sq += d * d;\n    }\n    return Math.sqrt(sum_sq);\n  };\n\n  chroma.deltaE = function(a, b, L, C) {\n    var L1, L2, a1, a2, b1, b2, c1, c2, c4, dH2, delA, delB, delC, delL, f, h1, ref, ref1, ref2, ref3, sc, sh, sl, t, v1, v2, v3;\n    if (L == null) {\n      L = 1;\n    }\n    if (C == null) {\n      C = 1;\n    }\n    if ((ref = type(a)) === 'string' || ref === 'number') {\n      a = new Color(a);\n    }\n    if ((ref1 = type(b)) === 'string' || ref1 === 'number') {\n      b = new Color(b);\n    }\n    ref2 = a.lab(), L1 = ref2[0], a1 = ref2[1], b1 = ref2[2];\n    ref3 = b.lab(), L2 = ref3[0], a2 = ref3[1], b2 = ref3[2];\n    c1 = sqrt(a1 * a1 + b1 * b1);\n    c2 = sqrt(a2 * a2 + b2 * b2);\n    sl = L1 < 16.0 ? 0.511 : (0.040975 * L1) / (1.0 + 0.01765 * L1);\n    sc = (0.0638 * c1) / (1.0 + 0.0131 * c1) + 0.638;\n    h1 = c1 < 0.000001 ? 0.0 : (atan2(b1, a1) * 180.0) / PI;\n    while (h1 < 0) {\n      h1 += 360;\n    }\n    while (h1 >= 360) {\n      h1 -= 360;\n    }\n    t = (h1 >= 164.0) && (h1 <= 345.0) ? 0.56 + abs(0.2 * cos((PI * (h1 + 168.0)) / 180.0)) : 0.36 + abs(0.4 * cos((PI * (h1 + 35.0)) / 180.0));\n    c4 = c1 * c1 * c1 * c1;\n    f = sqrt(c4 / (c4 + 1900.0));\n    sh = sc * (f * t + 1.0 - f);\n    delL = L1 - L2;\n    delC = c1 - c2;\n    delA = a1 - a2;\n    delB = b1 - b2;\n    dH2 = delA * delA + delB * delB - delC * delC;\n    v1 = delL / (L * sl);\n    v2 = delC / (C * sc);\n    v3 = sh;\n    return sqrt(v1 * v1 + v2 * v2 + (dH2 / (v3 * v3)));\n  };\n\n  Color.prototype.get = function(modechan) {\n    var channel, i, me, mode, ref, src;\n    me = this;\n    ref = modechan.split('.'), mode = ref[0], channel = ref[1];\n    src = me[mode]();\n    if (channel) {\n      i = mode.indexOf(channel);\n      if (i > -1) {\n        return src[i];\n      } else {\n        return console.warn('unknown channel ' + channel + ' in mode ' + mode);\n      }\n    } else {\n      return src;\n    }\n  };\n\n  Color.prototype.set = function(modechan, value) {\n    var channel, i, me, mode, ref, src;\n    me = this;\n    ref = modechan.split('.'), mode = ref[0], channel = ref[1];\n    if (channel) {\n      src = me[mode]();\n      i = mode.indexOf(channel);\n      if (i > -1) {\n        if (type(value) === 'string') {\n          switch (value.charAt(0)) {\n            case '+':\n              src[i] += +value;\n              break;\n            case '-':\n              src[i] += +value;\n              break;\n            case '*':\n              src[i] *= +(value.substr(1));\n              break;\n            case '/':\n              src[i] /= +(value.substr(1));\n              break;\n            default:\n              src[i] = +value;\n          }\n        } else {\n          src[i] = value;\n        }\n      } else {\n        console.warn('unknown channel ' + channel + ' in mode ' + mode);\n      }\n    } else {\n      src = value;\n    }\n    return chroma(src, mode).alpha(me.alpha());\n  };\n\n  Color.prototype.clipped = function() {\n    return this._rgb._clipped || false;\n  };\n\n  Color.prototype.alpha = function(a) {\n    if (arguments.length) {\n      return chroma.rgb([this._rgb[0], this._rgb[1], this._rgb[2], a]);\n    }\n    return this._rgb[3];\n  };\n\n  Color.prototype.darken = function(amount) {\n    var lab, me;\n    if (amount == null) {\n      amount = 1;\n    }\n    me = this;\n    lab = me.lab();\n    lab[0] -= LAB_CONSTANTS.Kn * amount;\n    return chroma.lab(lab).alpha(me.alpha());\n  };\n\n  Color.prototype.brighten = function(amount) {\n    if (amount == null) {\n      amount = 1;\n    }\n    return this.darken(-amount);\n  };\n\n  Color.prototype.darker = Color.prototype.darken;\n\n  Color.prototype.brighter = Color.prototype.brighten;\n\n  Color.prototype.saturate = function(amount) {\n    var lch, me;\n    if (amount == null) {\n      amount = 1;\n    }\n    me = this;\n    lch = me.lch();\n    lch[1] += amount * LAB_CONSTANTS.Kn;\n    if (lch[1] < 0) {\n      lch[1] = 0;\n    }\n    return chroma.lch(lch).alpha(me.alpha());\n  };\n\n  Color.prototype.desaturate = function(amount) {\n    if (amount == null) {\n      amount = 1;\n    }\n    return this.saturate(-amount);\n  };\n\n  Color.prototype.premultiply = function() {\n    var a, rgb;\n    rgb = this.rgb();\n    a = this.alpha();\n    return chroma(rgb[0] * a, rgb[1] * a, rgb[2] * a, a);\n  };\n\n  blend = function(bottom, top, mode) {\n    if (!blend[mode]) {\n      throw 'unknown blend mode ' + mode;\n    }\n    return blend[mode](bottom, top);\n  };\n\n  blend_f = function(f) {\n    return function(bottom, top) {\n      var c0, c1;\n      c0 = chroma(top).rgb();\n      c1 = chroma(bottom).rgb();\n      return chroma(f(c0, c1), 'rgb');\n    };\n  };\n\n  each = function(f) {\n    return function(c0, c1) {\n      var i, o, out;\n      out = [];\n      for (i = o = 0; o <= 3; i = ++o) {\n        out[i] = f(c0[i], c1[i]);\n      }\n      return out;\n    };\n  };\n\n  normal = function(a, b) {\n    return a;\n  };\n\n  multiply = function(a, b) {\n    return a * b / 255;\n  };\n\n  darken = function(a, b) {\n    if (a > b) {\n      return b;\n    } else {\n      return a;\n    }\n  };\n\n  lighten = function(a, b) {\n    if (a > b) {\n      return a;\n    } else {\n      return b;\n    }\n  };\n\n  screen = function(a, b) {\n    return 255 * (1 - (1 - a / 255) * (1 - b / 255));\n  };\n\n  overlay = function(a, b) {\n    if (b < 128) {\n      return 2 * a * b / 255;\n    } else {\n      return 255 * (1 - 2 * (1 - a / 255) * (1 - b / 255));\n    }\n  };\n\n  burn = function(a, b) {\n    return 255 * (1 - (1 - b / 255) / (a / 255));\n  };\n\n  dodge = function(a, b) {\n    if (a === 255) {\n      return 255;\n    }\n    a = 255 * (b / 255) / (1 - a / 255);\n    if (a > 255) {\n      return 255;\n    } else {\n      return a;\n    }\n  };\n\n  blend.normal = blend_f(each(normal));\n\n  blend.multiply = blend_f(each(multiply));\n\n  blend.screen = blend_f(each(screen));\n\n  blend.overlay = blend_f(each(overlay));\n\n  blend.darken = blend_f(each(darken));\n\n  blend.lighten = blend_f(each(lighten));\n\n  blend.dodge = blend_f(each(dodge));\n\n  blend.burn = blend_f(each(burn));\n\n  chroma.blend = blend;\n\n  chroma.analyze = function(data) {\n    var len, o, r, val;\n    r = {\n      min: Number.MAX_VALUE,\n      max: Number.MAX_VALUE * -1,\n      sum: 0,\n      values: [],\n      count: 0\n    };\n    for (o = 0, len = data.length; o < len; o++) {\n      val = data[o];\n      if ((val != null) && !isNaN(val)) {\n        r.values.push(val);\n        r.sum += val;\n        if (val < r.min) {\n          r.min = val;\n        }\n        if (val > r.max) {\n          r.max = val;\n        }\n        r.count += 1;\n      }\n    }\n    r.domain = [r.min, r.max];\n    r.limits = function(mode, num) {\n      return chroma.limits(r, mode, num);\n    };\n    return r;\n  };\n\n  chroma.scale = function(colors, positions) {\n    var _classes, _colorCache, _colors, _correctLightness, _domain, _fixed, _gamma, _max, _min, _mode, _nacol, _out, _padding, _pos, _spread, _useCache, classifyValue, f, getClass, getColor, resetCache, setColors, tmap;\n    _mode = 'rgb';\n    _nacol = chroma('#ccc');\n    _spread = 0;\n    _fixed = false;\n    _domain = [0, 1];\n    _pos = [];\n    _padding = [0, 0];\n    _classes = false;\n    _colors = [];\n    _out = false;\n    _min = 0;\n    _max = 1;\n    _correctLightness = false;\n    _colorCache = {};\n    _useCache = true;\n    _gamma = 1;\n    setColors = function(colors) {\n      var c, col, o, ref, ref1, w;\n      if (colors == null) {\n        colors = ['#fff', '#000'];\n      }\n      if ((colors != null) && type(colors) === 'string' && (chroma.brewer != null)) {\n        colors = chroma.brewer[colors] || chroma.brewer[colors.toLowerCase()] || colors;\n      }\n      if (type(colors) === 'array') {\n        if (colors.length === 1) {\n          colors = [colors[0], colors[0]];\n        }\n        colors = colors.slice(0);\n        for (c = o = 0, ref = colors.length - 1; 0 <= ref ? o <= ref : o >= ref; c = 0 <= ref ? ++o : --o) {\n          col = colors[c];\n          if (type(col) === \"string\") {\n            colors[c] = chroma(col);\n          }\n        }\n        _pos.length = 0;\n        for (c = w = 0, ref1 = colors.length - 1; 0 <= ref1 ? w <= ref1 : w >= ref1; c = 0 <= ref1 ? ++w : --w) {\n          _pos.push(c / (colors.length - 1));\n        }\n      }\n      resetCache();\n      return _colors = colors;\n    };\n    getClass = function(value) {\n      var i, n;\n      if (_classes != null) {\n        n = _classes.length - 1;\n        i = 0;\n        while (i < n && value >= _classes[i]) {\n          i++;\n        }\n        return i - 1;\n      }\n      return 0;\n    };\n    tmap = function(t) {\n      return t;\n    };\n    classifyValue = function(value) {\n      var i, maxc, minc, n, val;\n      val = value;\n      if (_classes.length > 2) {\n        n = _classes.length - 1;\n        i = getClass(value);\n        minc = _classes[0] + (_classes[1] - _classes[0]) * (0 + _spread * 0.5);\n        maxc = _classes[n - 1] + (_classes[n] - _classes[n - 1]) * (1 - _spread * 0.5);\n        val = _min + ((_classes[i] + (_classes[i + 1] - _classes[i]) * 0.5 - minc) / (maxc - minc)) * (_max - _min);\n      }\n      return val;\n    };\n    getColor = function(val, bypassMap) {\n      var c, col, i, k, o, p, ref, t;\n      if (bypassMap == null) {\n        bypassMap = false;\n      }\n      if (isNaN(val) || val === null) {\n        return _nacol;\n      }\n      if (!bypassMap) {\n        if (_classes && _classes.length > 2) {\n          c = getClass(val);\n          t = c / (_classes.length - 2);\n        } else if (_max !== _min) {\n          t = (val - _min) / (_max - _min);\n        } else {\n          t = 1;\n        }\n      } else {\n        t = val;\n      }\n      if (!bypassMap) {\n        t = tmap(t);\n      }\n      if (_gamma !== 1) {\n        t = pow(t, _gamma);\n      }\n      t = _padding[0] + (t * (1 - _padding[0] - _padding[1]));\n      t = Math.min(1, Math.max(0, t));\n      k = Math.floor(t * 10000);\n      if (_useCache && _colorCache[k]) {\n        col = _colorCache[k];\n      } else {\n        if (type(_colors) === 'array') {\n          for (i = o = 0, ref = _pos.length - 1; 0 <= ref ? o <= ref : o >= ref; i = 0 <= ref ? ++o : --o) {\n            p = _pos[i];\n            if (t <= p) {\n              col = _colors[i];\n              break;\n            }\n            if (t >= p && i === _pos.length - 1) {\n              col = _colors[i];\n              break;\n            }\n            if (t > p && t < _pos[i + 1]) {\n              t = (t - p) / (_pos[i + 1] - p);\n              col = chroma.interpolate(_colors[i], _colors[i + 1], t, _mode);\n              break;\n            }\n          }\n        } else if (type(_colors) === 'function') {\n          col = _colors(t);\n        }\n        if (_useCache) {\n          _colorCache[k] = col;\n        }\n      }\n      return col;\n    };\n    resetCache = function() {\n      return _colorCache = {};\n    };\n    setColors(colors);\n    f = function(v) {\n      var c;\n      c = chroma(getColor(v));\n      if (_out && c[_out]) {\n        return c[_out]();\n      } else {\n        return c;\n      }\n    };\n    f.classes = function(classes) {\n      var d;\n      if (classes != null) {\n        if (type(classes) === 'array') {\n          _classes = classes;\n          _domain = [classes[0], classes[classes.length - 1]];\n        } else {\n          d = chroma.analyze(_domain);\n          if (classes === 0) {\n            _classes = [d.min, d.max];\n          } else {\n            _classes = chroma.limits(d, 'e', classes);\n          }\n        }\n        return f;\n      }\n      return _classes;\n    };\n    f.domain = function(domain) {\n      var c, d, k, len, o, ref, w;\n      if (!arguments.length) {\n        return _domain;\n      }\n      _min = domain[0];\n      _max = domain[domain.length - 1];\n      _pos = [];\n      k = _colors.length;\n      if (domain.length === k && _min !== _max) {\n        for (o = 0, len = domain.length; o < len; o++) {\n          d = domain[o];\n          _pos.push((d - _min) / (_max - _min));\n        }\n      } else {\n        for (c = w = 0, ref = k - 1; 0 <= ref ? w <= ref : w >= ref; c = 0 <= ref ? ++w : --w) {\n          _pos.push(c / (k - 1));\n        }\n      }\n      _domain = [_min, _max];\n      return f;\n    };\n    f.mode = function(_m) {\n      if (!arguments.length) {\n        return _mode;\n      }\n      _mode = _m;\n      resetCache();\n      return f;\n    };\n    f.range = function(colors, _pos) {\n      setColors(colors, _pos);\n      return f;\n    };\n    f.out = function(_o) {\n      _out = _o;\n      return f;\n    };\n    f.spread = function(val) {\n      if (!arguments.length) {\n        return _spread;\n      }\n      _spread = val;\n      return f;\n    };\n    f.correctLightness = function(v) {\n      if (v == null) {\n        v = true;\n      }\n      _correctLightness = v;\n      resetCache();\n      if (_correctLightness) {\n        tmap = function(t) {\n          var L0, L1, L_actual, L_diff, L_ideal, max_iter, pol, t0, t1;\n          L0 = getColor(0, true).lab()[0];\n          L1 = getColor(1, true).lab()[0];\n          pol = L0 > L1;\n          L_actual = getColor(t, true).lab()[0];\n          L_ideal = L0 + (L1 - L0) * t;\n          L_diff = L_actual - L_ideal;\n          t0 = 0;\n          t1 = 1;\n          max_iter = 20;\n          while (Math.abs(L_diff) > 1e-2 && max_iter-- > 0) {\n            (function() {\n              if (pol) {\n                L_diff *= -1;\n              }\n              if (L_diff < 0) {\n                t0 = t;\n                t += (t1 - t) * 0.5;\n              } else {\n                t1 = t;\n                t += (t0 - t) * 0.5;\n              }\n              L_actual = getColor(t, true).lab()[0];\n              return L_diff = L_actual - L_ideal;\n            })();\n          }\n          return t;\n        };\n      } else {\n        tmap = function(t) {\n          return t;\n        };\n      }\n      return f;\n    };\n    f.padding = function(p) {\n      if (p != null) {\n        if (type(p) === 'number') {\n          p = [p, p];\n        }\n        _padding = p;\n        return f;\n      } else {\n        return _padding;\n      }\n    };\n    f.colors = function(numColors, out) {\n      var dd, dm, i, o, ref, result, results, samples, w;\n      if (arguments.length < 2) {\n        out = 'hex';\n      }\n      result = [];\n      if (arguments.length === 0) {\n        result = _colors.slice(0);\n      } else if (numColors === 1) {\n        result = [f(0.5)];\n      } else if (numColors > 1) {\n        dm = _domain[0];\n        dd = _domain[1] - dm;\n        result = (function() {\n          results = [];\n          for (var o = 0; 0 <= numColors ? o < numColors : o > numColors; 0 <= numColors ? o++ : o--){ results.push(o); }\n          return results;\n        }).apply(this).map(function(i) {\n          return f(dm + i / (numColors - 1) * dd);\n        });\n      } else {\n        colors = [];\n        samples = [];\n        if (_classes && _classes.length > 2) {\n          for (i = w = 1, ref = _classes.length; 1 <= ref ? w < ref : w > ref; i = 1 <= ref ? ++w : --w) {\n            samples.push((_classes[i - 1] + _classes[i]) * 0.5);\n          }\n        } else {\n          samples = _domain;\n        }\n        result = samples.map(function(v) {\n          return f(v);\n        });\n      }\n      if (chroma[out]) {\n        result = result.map(function(c) {\n          return c[out]();\n        });\n      }\n      return result;\n    };\n    f.cache = function(c) {\n      if (c != null) {\n        _useCache = c;\n        return f;\n      } else {\n        return _useCache;\n      }\n    };\n    f.gamma = function(g) {\n      if (g != null) {\n        _gamma = g;\n        return f;\n      } else {\n        return _gamma;\n      }\n    };\n    f.nodata = function(d) {\n      if (d != null) {\n        _nacol = chroma(d);\n        return f;\n      } else {\n        return _nacol;\n      }\n    };\n    return f;\n  };\n\n  if (chroma.scales == null) {\n    chroma.scales = {};\n  }\n\n  chroma.scales.cool = function() {\n    return chroma.scale([chroma.hsl(180, 1, .9), chroma.hsl(250, .7, .4)]);\n  };\n\n  chroma.scales.hot = function() {\n    return chroma.scale(['#000', '#f00', '#ff0', '#fff'], [0, .25, .75, 1]).mode('rgb');\n  };\n\n  chroma.analyze = function(data, key, filter) {\n    var add, k, len, o, r, val, visit;\n    r = {\n      min: Number.MAX_VALUE,\n      max: Number.MAX_VALUE * -1,\n      sum: 0,\n      values: [],\n      count: 0\n    };\n    if (filter == null) {\n      filter = function() {\n        return true;\n      };\n    }\n    add = function(val) {\n      if ((val != null) && !isNaN(val)) {\n        r.values.push(val);\n        r.sum += val;\n        if (val < r.min) {\n          r.min = val;\n        }\n        if (val > r.max) {\n          r.max = val;\n        }\n        r.count += 1;\n      }\n    };\n    visit = function(val, k) {\n      if (filter(val, k)) {\n        if ((key != null) && type(key) === 'function') {\n          return add(key(val));\n        } else if ((key != null) && type(key) === 'string' || type(key) === 'number') {\n          return add(val[key]);\n        } else {\n          return add(val);\n        }\n      }\n    };\n    if (type(data) === 'array') {\n      for (o = 0, len = data.length; o < len; o++) {\n        val = data[o];\n        visit(val);\n      }\n    } else {\n      for (k in data) {\n        val = data[k];\n        visit(val, k);\n      }\n    }\n    r.domain = [r.min, r.max];\n    r.limits = function(mode, num) {\n      return chroma.limits(r, mode, num);\n    };\n    return r;\n  };\n\n  chroma.limits = function(data, mode, num) {\n    var aa, ab, ac, ad, ae, af, ag, ah, ai, aj, ak, al, am, assignments, best, centroids, cluster, clusterSizes, dist, i, j, kClusters, limits, max_log, min, min_log, mindist, n, nb_iters, newCentroids, o, p, pb, pr, ref, ref1, ref10, ref11, ref12, ref13, ref14, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9, repeat, sum, tmpKMeansBreaks, v, value, values, w;\n    if (mode == null) {\n      mode = 'equal';\n    }\n    if (num == null) {\n      num = 7;\n    }\n    if (type(data) === 'array') {\n      data = chroma.analyze(data);\n    }\n    min = data.min;\n    max = data.max;\n    sum = data.sum;\n    values = data.values.sort(function(a, b) {\n      return a - b;\n    });\n    if (num === 1) {\n      return [min, max];\n    }\n    limits = [];\n    if (mode.substr(0, 1) === 'c') {\n      limits.push(min);\n      limits.push(max);\n    }\n    if (mode.substr(0, 1) === 'e') {\n      limits.push(min);\n      for (i = o = 1, ref = num - 1; 1 <= ref ? o <= ref : o >= ref; i = 1 <= ref ? ++o : --o) {\n        limits.push(min + (i / num) * (max - min));\n      }\n      limits.push(max);\n    } else if (mode.substr(0, 1) === 'l') {\n      if (min <= 0) {\n        throw 'Logarithmic scales are only possible for values > 0';\n      }\n      min_log = Math.LOG10E * log(min);\n      max_log = Math.LOG10E * log(max);\n      limits.push(min);\n      for (i = w = 1, ref1 = num - 1; 1 <= ref1 ? w <= ref1 : w >= ref1; i = 1 <= ref1 ? ++w : --w) {\n        limits.push(pow(10, min_log + (i / num) * (max_log - min_log)));\n      }\n      limits.push(max);\n    } else if (mode.substr(0, 1) === 'q') {\n      limits.push(min);\n      for (i = aa = 1, ref2 = num - 1; 1 <= ref2 ? aa <= ref2 : aa >= ref2; i = 1 <= ref2 ? ++aa : --aa) {\n        p = (values.length - 1) * i / num;\n        pb = floor(p);\n        if (pb === p) {\n          limits.push(values[pb]);\n        } else {\n          pr = p - pb;\n          limits.push(values[pb] * (1 - pr) + values[pb + 1] * pr);\n        }\n      }\n      limits.push(max);\n    } else if (mode.substr(0, 1) === 'k') {\n\n      /*\n      implementation based on\n      http://code.google.com/p/figue/source/browse/trunk/figue.js#336\n      simplified for 1-d input values\n       */\n      n = values.length;\n      assignments = new Array(n);\n      clusterSizes = new Array(num);\n      repeat = true;\n      nb_iters = 0;\n      centroids = null;\n      centroids = [];\n      centroids.push(min);\n      for (i = ab = 1, ref3 = num - 1; 1 <= ref3 ? ab <= ref3 : ab >= ref3; i = 1 <= ref3 ? ++ab : --ab) {\n        centroids.push(min + (i / num) * (max - min));\n      }\n      centroids.push(max);\n      while (repeat) {\n        for (j = ac = 0, ref4 = num - 1; 0 <= ref4 ? ac <= ref4 : ac >= ref4; j = 0 <= ref4 ? ++ac : --ac) {\n          clusterSizes[j] = 0;\n        }\n        for (i = ad = 0, ref5 = n - 1; 0 <= ref5 ? ad <= ref5 : ad >= ref5; i = 0 <= ref5 ? ++ad : --ad) {\n          value = values[i];\n          mindist = Number.MAX_VALUE;\n          for (j = ae = 0, ref6 = num - 1; 0 <= ref6 ? ae <= ref6 : ae >= ref6; j = 0 <= ref6 ? ++ae : --ae) {\n            dist = abs(centroids[j] - value);\n            if (dist < mindist) {\n              mindist = dist;\n              best = j;\n            }\n          }\n          clusterSizes[best]++;\n          assignments[i] = best;\n        }\n        newCentroids = new Array(num);\n        for (j = af = 0, ref7 = num - 1; 0 <= ref7 ? af <= ref7 : af >= ref7; j = 0 <= ref7 ? ++af : --af) {\n          newCentroids[j] = null;\n        }\n        for (i = ag = 0, ref8 = n - 1; 0 <= ref8 ? ag <= ref8 : ag >= ref8; i = 0 <= ref8 ? ++ag : --ag) {\n          cluster = assignments[i];\n          if (newCentroids[cluster] === null) {\n            newCentroids[cluster] = values[i];\n          } else {\n            newCentroids[cluster] += values[i];\n          }\n        }\n        for (j = ah = 0, ref9 = num - 1; 0 <= ref9 ? ah <= ref9 : ah >= ref9; j = 0 <= ref9 ? ++ah : --ah) {\n          newCentroids[j] *= 1 / clusterSizes[j];\n        }\n        repeat = false;\n        for (j = ai = 0, ref10 = num - 1; 0 <= ref10 ? ai <= ref10 : ai >= ref10; j = 0 <= ref10 ? ++ai : --ai) {\n          if (newCentroids[j] !== centroids[i]) {\n            repeat = true;\n            break;\n          }\n        }\n        centroids = newCentroids;\n        nb_iters++;\n        if (nb_iters > 200) {\n          repeat = false;\n        }\n      }\n      kClusters = {};\n      for (j = aj = 0, ref11 = num - 1; 0 <= ref11 ? aj <= ref11 : aj >= ref11; j = 0 <= ref11 ? ++aj : --aj) {\n        kClusters[j] = [];\n      }\n      for (i = ak = 0, ref12 = n - 1; 0 <= ref12 ? ak <= ref12 : ak >= ref12; i = 0 <= ref12 ? ++ak : --ak) {\n        cluster = assignments[i];\n        kClusters[cluster].push(values[i]);\n      }\n      tmpKMeansBreaks = [];\n      for (j = al = 0, ref13 = num - 1; 0 <= ref13 ? al <= ref13 : al >= ref13; j = 0 <= ref13 ? ++al : --al) {\n        tmpKMeansBreaks.push(kClusters[j][0]);\n        tmpKMeansBreaks.push(kClusters[j][kClusters[j].length - 1]);\n      }\n      tmpKMeansBreaks = tmpKMeansBreaks.sort(function(a, b) {\n        return a - b;\n      });\n      limits.push(tmpKMeansBreaks[0]);\n      for (i = am = 1, ref14 = tmpKMeansBreaks.length - 1; am <= ref14; i = am += 2) {\n        v = tmpKMeansBreaks[i];\n        if (!isNaN(v) && limits.indexOf(v) === -1) {\n          limits.push(v);\n        }\n      }\n    }\n    return limits;\n  };\n\n  hsi2rgb = function(h, s, i) {\n\n    /*\n    borrowed from here:\n    http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/hsi2rgb.cpp\n     */\n    var args, b, g, r;\n    args = unpack(arguments);\n    h = args[0], s = args[1], i = args[2];\n    if (isNaN(h)) {\n      h = 0;\n    }\n    h /= 360;\n    if (h < 1 / 3) {\n      b = (1 - s) / 3;\n      r = (1 + s * cos(TWOPI * h) / cos(PITHIRD - TWOPI * h)) / 3;\n      g = 1 - (b + r);\n    } else if (h < 2 / 3) {\n      h -= 1 / 3;\n      r = (1 - s) / 3;\n      g = (1 + s * cos(TWOPI * h) / cos(PITHIRD - TWOPI * h)) / 3;\n      b = 1 - (r + g);\n    } else {\n      h -= 2 / 3;\n      g = (1 - s) / 3;\n      b = (1 + s * cos(TWOPI * h) / cos(PITHIRD - TWOPI * h)) / 3;\n      r = 1 - (g + b);\n    }\n    r = limit(i * r * 3);\n    g = limit(i * g * 3);\n    b = limit(i * b * 3);\n    return [r * 255, g * 255, b * 255, args.length > 3 ? args[3] : 1];\n  };\n\n  rgb2hsi = function() {\n\n    /*\n    borrowed from here:\n    http://hummer.stanford.edu/museinfo/doc/examples/humdrum/keyscape2/rgb2hsi.cpp\n     */\n    var b, g, h, i, min, r, ref, s;\n    ref = unpack(arguments), r = ref[0], g = ref[1], b = ref[2];\n    TWOPI = Math.PI * 2;\n    r /= 255;\n    g /= 255;\n    b /= 255;\n    min = Math.min(r, g, b);\n    i = (r + g + b) / 3;\n    s = 1 - min / i;\n    if (s === 0) {\n      h = 0;\n    } else {\n      h = ((r - g) + (r - b)) / 2;\n      h /= Math.sqrt((r - g) * (r - g) + (r - b) * (g - b));\n      h = Math.acos(h);\n      if (b > g) {\n        h = TWOPI - h;\n      }\n      h /= TWOPI;\n    }\n    return [h * 360, s, i];\n  };\n\n  chroma.hsi = function() {\n    return (function(func, args, ctor) {\n      ctor.prototype = func.prototype;\n      var child = new ctor, result = func.apply(child, args);\n      return Object(result) === result ? result : child;\n    })(Color, slice.call(arguments).concat(['hsi']), function(){});\n  };\n\n  _input.hsi = hsi2rgb;\n\n  Color.prototype.hsi = function() {\n    return rgb2hsi(this._rgb);\n  };\n\n  interpolate_hsx = function(col1, col2, f, m) {\n    var dh, hue, hue0, hue1, lbv, lbv0, lbv1, res, sat, sat0, sat1, xyz0, xyz1;\n    if (m === 'hsl') {\n      xyz0 = col1.hsl();\n      xyz1 = col2.hsl();\n    } else if (m === 'hsv') {\n      xyz0 = col1.hsv();\n      xyz1 = col2.hsv();\n    } else if (m === 'hcg') {\n      xyz0 = col1.hcg();\n      xyz1 = col2.hcg();\n    } else if (m === 'hsi') {\n      xyz0 = col1.hsi();\n      xyz1 = col2.hsi();\n    } else if (m === 'lch' || m === 'hcl') {\n      m = 'hcl';\n      xyz0 = col1.hcl();\n      xyz1 = col2.hcl();\n    }\n    if (m.substr(0, 1) === 'h') {\n      hue0 = xyz0[0], sat0 = xyz0[1], lbv0 = xyz0[2];\n      hue1 = xyz1[0], sat1 = xyz1[1], lbv1 = xyz1[2];\n    }\n    if (!isNaN(hue0) && !isNaN(hue1)) {\n      if (hue1 > hue0 && hue1 - hue0 > 180) {\n        dh = hue1 - (hue0 + 360);\n      } else if (hue1 < hue0 && hue0 - hue1 > 180) {\n        dh = hue1 + 360 - hue0;\n      } else {\n        dh = hue1 - hue0;\n      }\n      hue = hue0 + f * dh;\n    } else if (!isNaN(hue0)) {\n      hue = hue0;\n      if ((lbv1 === 1 || lbv1 === 0) && m !== 'hsv') {\n        sat = sat0;\n      }\n    } else if (!isNaN(hue1)) {\n      hue = hue1;\n      if ((lbv0 === 1 || lbv0 === 0) && m !== 'hsv') {\n        sat = sat1;\n      }\n    } else {\n      hue = Number.NaN;\n    }\n    if (sat == null) {\n      sat = sat0 + f * (sat1 - sat0);\n    }\n    lbv = lbv0 + f * (lbv1 - lbv0);\n    return res = chroma[m](hue, sat, lbv);\n  };\n\n  _interpolators = _interpolators.concat((function() {\n    var len, o, ref, results;\n    ref = ['hsv', 'hsl', 'hsi', 'hcl', 'lch', 'hcg'];\n    results = [];\n    for (o = 0, len = ref.length; o < len; o++) {\n      m = ref[o];\n      results.push([m, interpolate_hsx]);\n    }\n    return results;\n  })());\n\n  interpolate_num = function(col1, col2, f, m) {\n    var n1, n2;\n    n1 = col1.num();\n    n2 = col2.num();\n    return chroma.num(n1 + (n2 - n1) * f, 'num');\n  };\n\n  _interpolators.push(['num', interpolate_num]);\n\n  interpolate_lab = function(col1, col2, f, m) {\n    var res, xyz0, xyz1;\n    xyz0 = col1.lab();\n    xyz1 = col2.lab();\n    return res = new Color(xyz0[0] + f * (xyz1[0] - xyz0[0]), xyz0[1] + f * (xyz1[1] - xyz0[1]), xyz0[2] + f * (xyz1[2] - xyz0[2]), m);\n  };\n\n  _interpolators.push(['lab', interpolate_lab]);\n\n}).call(this);\n","/**\n * @file Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Color } from 'three'\nimport * as chroma from 'chroma-js'\n\nimport { createParams } from '../utils'\nimport { NumberArray, Partial } from '../types'\nimport Structure from '../structure/structure'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport AtomProxy from '../proxy/atom-proxy'\nimport BondProxy from '../proxy/bond-proxy'\n\nexport type ColorMode = 'rgb'|'hsv'|'hsl'|'hsi'|'lab'|'hcl'\nexport type ColorSpace = 'sRGB' | 'linear'\n\n/**\n * Internal color space for all colors (global).\n * Colors are always specified as sRGB; if this is set to\n * 'linear' then colors get linearized when used internally\n * as vertex or texture colors.\n * @see setColorSpace/getColorSpace.\n */\nvar colorSpace: ColorSpace = 'sRGB' // default: don't linearize\n\n/** Set the global internal color space for colormakers */\nexport function setColorSpace(space: ColorSpace) {\n  colorSpace = space\n}\n\n/** Get the global internal color space for colormakers */\nexport function getColorSpace() {\n  return colorSpace\n}\n\nexport const ScaleDefaultParameters = {\n  scale: 'uniform' as string|string[],\n  mode: 'hcl' as ColorMode,\n  domain: [ 0, 1 ] as number[],\n  value: 0xFFFFFF,\n  reverse: false,\n}\nexport type ScaleParameters = typeof ScaleDefaultParameters\n\nexport interface ColorData {\n  atomData?: number[],\n  bondData?: number[]\n}\n\nexport interface ColormakerParameters extends ScaleParameters {\n  structure?: Structure\n  volume?: Volume\n  surface?: Surface\n  data?: ColorData\n}\n\nexport type StuctureColormakerParams = { structure: Structure } & Partial<ColormakerParameters>\nexport type VolumeColormakerParams = { volume: Volume } & Partial<ColormakerParameters>\nexport type ColormakerScale = (v: number) => number\n\nconst tmpColor = new Color()\n\n/** Decorator for optionally linearizing a numeric color */\ntype colorFuncType = (value: any, fromTo?: boolean) => number // decorator applies to functions with this shape\nexport function manageColor<T extends {parameters: ColormakerParameters}>\n  (_target: Object,\n   _name: string | symbol,\n   descriptor: TypedPropertyDescriptor<colorFuncType>): PropertyDescriptor {\n    const originalMethod = descriptor.value\n    const linearize: colorFuncType = function (this: T, value: any, fromTo?: boolean) {\n      let result = originalMethod!.bind(this, value, fromTo)()\n      if (colorSpace == 'linear') {\n        tmpColor.set(result)\n        tmpColor.convertSRGBToLinear()\n        return tmpColor.getHex()\n      } else {\n        return result\n      }\n    }\n    descriptor.value = linearize\n    return descriptor\n  }\n\n/**\n * Class for making colors.\n * @interface\n */\nabstract class Colormaker {\n  parameters: ColormakerParameters\n  atomProxy?: AtomProxy\n\n  /**\n   * Create a colormaker instance\n   * @param  {ColormakerParameters} params - colormaker parameter\n   */\n  constructor (params: Partial<ColormakerParameters> = {}) {\n    this.parameters = createParams(params, ScaleDefaultParameters)\n\n    if (typeof this.parameters.value === 'string') {\n      this.parameters.value = tmpColor.set(this.parameters.value).getHex()\n    }\n\n    if (this.parameters.structure) {\n      this.atomProxy = this.parameters.structure.getAtomProxy()\n    }\n  }\n\n  getScale (params: Partial<ScaleParameters> = {}) {\n    const p = createParams(params, this.parameters)\n\n    if (p.scale === 'rainbow') {\n      p.scale = [ 'red', 'orange', 'yellow', 'green', 'blue' ]\n    } else if (p.scale === 'rwb') {\n      p.scale = [ 'red', 'white', 'blue' ]\n    }\n\n    if (p.reverse) {\n      p.domain = p.domain.slice().reverse()\n    }\n    return chroma\n      .scale(p.scale as any)  // TODO\n      .mode(p.mode)\n      .domain(p.domain)\n      .out('num' as any)  // returns RGB color as numeric (not string \"#ffffff\")\n  }\n\n  /**\n   * save a color to an array\n   * @param  {Integer} color - hex color value\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  colorToArray (color: number, array: NumberArray = [], offset = 0) {\n    array[ offset ] = (color >> 16 & 255) / 255\n    array[ offset + 1 ] = (color >> 8 & 255) / 255\n    array[ offset + 2 ] = (color & 255) / 255\n\n    return array\n  }\n\n  atomColor? (atom: AtomProxy): number\n\n  /**\n   * save an atom color to an array\n   * @param  {AtomProxy} atom - atom to get color for\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  atomColorToArray (atom: AtomProxy, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.atomColor ? this.atomColor(atom) : 0x000000, array, offset\n    )\n  }\n\n  /**\n   * return the color for an bond\n   * @param  {BondProxy} bond - bond to get color for\n   * @param  {Boolean} fromTo - whether to use the first or second atom of the bond\n   * @return {Integer} hex bond color\n   */\n  bondColor (bond: BondProxy, fromTo: boolean) {\n    if (this.atomProxy && this.atomColor) {\n      this.atomProxy.index = fromTo ? bond.atomIndex1 : bond.atomIndex2\n      return this.atomColor(this.atomProxy)\n    } else {\n      return 0x000000\n    }\n  }\n\n  /**\n   * safe a bond color to an array\n   * @param  {BondProxy} bond - bond to get color for\n   * @param  {Boolean} fromTo - whether to use the first or second atom of the bond\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  bondColorToArray (bond: BondProxy, fromTo: boolean, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.bondColor(bond, fromTo), array, offset\n    )\n  }\n\n  volumeColor? (index: number): number\n\n  /**\n   * safe a volume cell color to an array\n   * @param  {Integer} index - volume cell index\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  volumeColorToArray (index: number, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.volumeColor ? this.volumeColor(index) : 0x000000, array, offset\n    )\n  }\n\n  positionColor? (position: Vector3): number\n\n  /**\n   * safe a color for coordinates in space to an array\n   * @param  {Vector3} coords - xyz coordinates\n   * @param  {Array|TypedArray} array - destination\n   * @param  {Integer} offset - index into the array\n   * @return {Array} the destination array\n   */\n  positionColorToArray (coords: Vector3, array: NumberArray, offset: number) {\n    return this.colorToArray(\n      this.positionColor ? this.positionColor(coords) : 0x000000, array, offset\n    )\n  }\n}\n\nexport default Colormaker\n","/**\n * @file Selection Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport enum kwd {\n  PROTEIN = 1,\n  NUCLEIC = 2,\n  RNA = 3,\n  DNA = 4,\n  POLYMER = 5,\n  WATER = 6,\n  HELIX = 7,\n  SHEET = 8,\n  TURN = 9,\n  BACKBONE = 10,\n  SIDECHAIN = 11,\n  ALL = 12,\n  HETERO = 13,\n  ION = 14,\n  SACCHARIDE = 15,\n  SUGAR = 15,\n  BONDED = 16,\n  RING = 17,\n  AROMATICRING = 18,\n  METAL = 19,\n  POLARH = 20,\n  NONE = 21\n}\n\nexport const SelectAllKeyword = [ '*', '', 'ALL' ]\nexport const SelectNoneKeyword = [ 'NONE' ]\n\nexport const AtomOnlyKeywords = [\n  kwd.BACKBONE, kwd.SIDECHAIN, kwd.BONDED, kwd.RING, kwd.AROMATICRING, kwd.METAL, kwd.POLARH\n]\n\nexport const ChainKeywords = [\n  kwd.POLYMER, kwd.WATER\n]\n\nexport const SmallResname = [ 'ALA', 'GLY', 'SER' ]\nexport const NucleophilicResname = [ 'CYS', 'SER', 'THR' ]\nexport const HydrophobicResname = [ 'ALA', 'ILE', 'LEU', 'MET', 'PHE', 'PRO', 'TRP', 'VAL' ]\nexport const AromaticResname = [ 'PHE', 'TRP', 'TYR', 'HIS' ]\nexport const AmideResname = [ 'ASN', 'GLN' ]\nexport const AcidicResname = [ 'ASP', 'GLU' ]\nexport const BasicResname = [ 'ARG', 'HIS', 'LYS' ]\nexport const ChargedResname = [ 'ARG', 'ASP', 'GLU', 'HIS', 'LYS' ]\nexport const PolarResname = [ 'ASN', 'ARG', 'ASP', 'CYS', 'GLY', 'GLN', 'GLU', 'HIS', 'LYS', 'SER', 'THR', 'TYR' ]\nexport const NonpolarResname = [ 'ALA', 'ILE', 'LEU', 'MET', 'PHE', 'PRO', 'TRP', 'VAL' ]\nexport const CyclicResname = [ 'HIS', 'PHE', 'PRO', 'TRP', 'TYR' ]\nexport const AliphaticResname = [ 'ALA', 'GLY', 'ILE', 'LEU', 'VAL' ]\n","/*jslint onevar:true, undef:true, newcap:true, regexp:true, bitwise:true, maxerr:50, indent:4, white:false, nomen:false, plusplus:false */\n/*global define:false, require:false, exports:false, module:false, signals:false */\n\n/** @license\n * JS Signals <http://millermedeiros.github.com/js-signals/>\n * Released under the MIT license\n * Author: Miller Medeiros\n * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)\n */\n\n(function(global){\n\n    // SignalBinding -------------------------------------------------\n    //================================================================\n\n    /**\n     * Object that represents a binding between a Signal and a listener function.\n     * <br />- <strong>This is an internal constructor and shouldn't be called by regular users.</strong>\n     * <br />- inspired by Joa Ebert AS3 SignalBinding and Robert Penner's Slot classes.\n     * @author Miller Medeiros\n     * @constructor\n     * @internal\n     * @name SignalBinding\n     * @param {Signal} signal Reference to Signal object that listener is currently bound to.\n     * @param {Function} listener Handler function bound to the signal.\n     * @param {boolean} isOnce If binding should be executed just once.\n     * @param {Object} [listenerContext] Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n     * @param {Number} [priority] The priority level of the event listener. (default = 0).\n     */\n    function SignalBinding(signal, listener, isOnce, listenerContext, priority) {\n\n        /**\n         * Handler function bound to the signal.\n         * @type Function\n         * @private\n         */\n        this._listener = listener;\n\n        /**\n         * If binding should be executed just once.\n         * @type boolean\n         * @private\n         */\n        this._isOnce = isOnce;\n\n        /**\n         * Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n         * @memberOf SignalBinding.prototype\n         * @name context\n         * @type Object|undefined|null\n         */\n        this.context = listenerContext;\n\n        /**\n         * Reference to Signal object that listener is currently bound to.\n         * @type Signal\n         * @private\n         */\n        this._signal = signal;\n\n        /**\n         * Listener priority\n         * @type Number\n         * @private\n         */\n        this._priority = priority || 0;\n    }\n\n    SignalBinding.prototype = {\n\n        /**\n         * If binding is active and should be executed.\n         * @type boolean\n         */\n        active : true,\n\n        /**\n         * Default parameters passed to listener during `Signal.dispatch` and `SignalBinding.execute`. (curried parameters)\n         * @type Array|null\n         */\n        params : null,\n\n        /**\n         * Call listener passing arbitrary parameters.\n         * <p>If binding was added using `Signal.addOnce()` it will be automatically removed from signal dispatch queue, this method is used internally for the signal dispatch.</p>\n         * @param {Array} [paramsArr] Array of parameters that should be passed to the listener\n         * @return {*} Value returned by the listener.\n         */\n        execute : function (paramsArr) {\n            var handlerReturn, params;\n            if (this.active && !!this._listener) {\n                params = this.params? this.params.concat(paramsArr) : paramsArr;\n                handlerReturn = this._listener.apply(this.context, params);\n                if (this._isOnce) {\n                    this.detach();\n                }\n            }\n            return handlerReturn;\n        },\n\n        /**\n         * Detach binding from signal.\n         * - alias to: mySignal.remove(myBinding.getListener());\n         * @return {Function|null} Handler function bound to the signal or `null` if binding was previously detached.\n         */\n        detach : function () {\n            return this.isBound()? this._signal.remove(this._listener, this.context) : null;\n        },\n\n        /**\n         * @return {Boolean} `true` if binding is still bound to the signal and have a listener.\n         */\n        isBound : function () {\n            return (!!this._signal && !!this._listener);\n        },\n\n        /**\n         * @return {boolean} If SignalBinding will only be executed once.\n         */\n        isOnce : function () {\n            return this._isOnce;\n        },\n\n        /**\n         * @return {Function} Handler function bound to the signal.\n         */\n        getListener : function () {\n            return this._listener;\n        },\n\n        /**\n         * @return {Signal} Signal that listener is currently bound to.\n         */\n        getSignal : function () {\n            return this._signal;\n        },\n\n        /**\n         * Delete instance properties\n         * @private\n         */\n        _destroy : function () {\n            delete this._signal;\n            delete this._listener;\n            delete this.context;\n        },\n\n        /**\n         * @return {string} String representation of the object.\n         */\n        toString : function () {\n            return '[SignalBinding isOnce:' + this._isOnce +', isBound:'+ this.isBound() +', active:' + this.active + ']';\n        }\n\n    };\n\n\n/*global SignalBinding:false*/\n\n    // Signal --------------------------------------------------------\n    //================================================================\n\n    function validateListener(listener, fnName) {\n        if (typeof listener !== 'function') {\n            throw new Error( 'listener is a required param of {fn}() and should be a Function.'.replace('{fn}', fnName) );\n        }\n    }\n\n    /**\n     * Custom event broadcaster\n     * <br />- inspired by Robert Penner's AS3 Signals.\n     * @name Signal\n     * @author Miller Medeiros\n     * @constructor\n     */\n    function Signal() {\n        /**\n         * @type Array.<SignalBinding>\n         * @private\n         */\n        this._bindings = [];\n        this._prevParams = null;\n\n        // enforce dispatch to aways work on same context (#47)\n        var self = this;\n        this.dispatch = function(){\n            Signal.prototype.dispatch.apply(self, arguments);\n        };\n    }\n\n    Signal.prototype = {\n\n        /**\n         * Signals Version Number\n         * @type String\n         * @const\n         */\n        VERSION : '1.0.0',\n\n        /**\n         * If Signal should keep record of previously dispatched parameters and\n         * automatically execute listener during `add()`/`addOnce()` if Signal was\n         * already dispatched before.\n         * @type boolean\n         */\n        memorize : false,\n\n        /**\n         * @type boolean\n         * @private\n         */\n        _shouldPropagate : true,\n\n        /**\n         * If Signal is active and should broadcast events.\n         * <p><strong>IMPORTANT:</strong> Setting this property during a dispatch will only affect the next dispatch, if you want to stop the propagation of a signal use `halt()` instead.</p>\n         * @type boolean\n         */\n        active : true,\n\n        /**\n         * @param {Function} listener\n         * @param {boolean} isOnce\n         * @param {Object} [listenerContext]\n         * @param {Number} [priority]\n         * @return {SignalBinding}\n         * @private\n         */\n        _registerListener : function (listener, isOnce, listenerContext, priority) {\n\n            var prevIndex = this._indexOfListener(listener, listenerContext),\n                binding;\n\n            if (prevIndex !== -1) {\n                binding = this._bindings[prevIndex];\n                if (binding.isOnce() !== isOnce) {\n                    throw new Error('You cannot add'+ (isOnce? '' : 'Once') +'() then add'+ (!isOnce? '' : 'Once') +'() the same listener without removing the relationship first.');\n                }\n            } else {\n                binding = new SignalBinding(this, listener, isOnce, listenerContext, priority);\n                this._addBinding(binding);\n            }\n\n            if(this.memorize && this._prevParams){\n                binding.execute(this._prevParams);\n            }\n\n            return binding;\n        },\n\n        /**\n         * @param {SignalBinding} binding\n         * @private\n         */\n        _addBinding : function (binding) {\n            //simplified insertion sort\n            var n = this._bindings.length;\n            do { --n; } while (this._bindings[n] && binding._priority <= this._bindings[n]._priority);\n            this._bindings.splice(n + 1, 0, binding);\n        },\n\n        /**\n         * @param {Function} listener\n         * @return {number}\n         * @private\n         */\n        _indexOfListener : function (listener, context) {\n            var n = this._bindings.length,\n                cur;\n            while (n--) {\n                cur = this._bindings[n];\n                if (cur._listener === listener && cur.context === context) {\n                    return n;\n                }\n            }\n            return -1;\n        },\n\n        /**\n         * Check if listener was attached to Signal.\n         * @param {Function} listener\n         * @param {Object} [context]\n         * @return {boolean} if Signal has the specified listener.\n         */\n        has : function (listener, context) {\n            return this._indexOfListener(listener, context) !== -1;\n        },\n\n        /**\n         * Add a listener to the signal.\n         * @param {Function} listener Signal handler function.\n         * @param {Object} [listenerContext] Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n         * @param {Number} [priority] The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added. (default = 0)\n         * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n         */\n        add : function (listener, listenerContext, priority) {\n            validateListener(listener, 'add');\n            return this._registerListener(listener, false, listenerContext, priority);\n        },\n\n        /**\n         * Add listener to the signal that should be removed after first execution (will be executed only once).\n         * @param {Function} listener Signal handler function.\n         * @param {Object} [listenerContext] Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n         * @param {Number} [priority] The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added. (default = 0)\n         * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n         */\n        addOnce : function (listener, listenerContext, priority) {\n            validateListener(listener, 'addOnce');\n            return this._registerListener(listener, true, listenerContext, priority);\n        },\n\n        /**\n         * Remove a single listener from the dispatch queue.\n         * @param {Function} listener Handler function that should be removed.\n         * @param {Object} [context] Execution context (since you can add the same handler multiple times if executing in a different context).\n         * @return {Function} Listener handler function.\n         */\n        remove : function (listener, context) {\n            validateListener(listener, 'remove');\n\n            var i = this._indexOfListener(listener, context);\n            if (i !== -1) {\n                this._bindings[i]._destroy(); //no reason to a SignalBinding exist if it isn't attached to a signal\n                this._bindings.splice(i, 1);\n            }\n            return listener;\n        },\n\n        /**\n         * Remove all listeners from the Signal.\n         */\n        removeAll : function () {\n            var n = this._bindings.length;\n            while (n--) {\n                this._bindings[n]._destroy();\n            }\n            this._bindings.length = 0;\n        },\n\n        /**\n         * @return {number} Number of listeners attached to the Signal.\n         */\n        getNumListeners : function () {\n            return this._bindings.length;\n        },\n\n        /**\n         * Stop propagation of the event, blocking the dispatch to next listeners on the queue.\n         * <p><strong>IMPORTANT:</strong> should be called only during signal dispatch, calling it before/after dispatch won't affect signal broadcast.</p>\n         * @see Signal.prototype.disable\n         */\n        halt : function () {\n            this._shouldPropagate = false;\n        },\n\n        /**\n         * Dispatch/Broadcast Signal to all listeners added to the queue.\n         * @param {...*} [params] Parameters that should be passed to each handler.\n         */\n        dispatch : function (params) {\n            if (! this.active) {\n                return;\n            }\n\n            var paramsArr = Array.prototype.slice.call(arguments),\n                n = this._bindings.length,\n                bindings;\n\n            if (this.memorize) {\n                this._prevParams = paramsArr;\n            }\n\n            if (! n) {\n                //should come after memorize\n                return;\n            }\n\n            bindings = this._bindings.slice(); //clone array in case add/remove items during dispatch\n            this._shouldPropagate = true; //in case `halt` was called before dispatch or during the previous dispatch.\n\n            //execute all callbacks until end of the list or until a callback returns `false` or stops propagation\n            //reverse loop since listeners with higher priority will be added at the end of the list\n            do { n--; } while (bindings[n] && this._shouldPropagate && bindings[n].execute(paramsArr) !== false);\n        },\n\n        /**\n         * Forget memorized arguments.\n         * @see Signal.memorize\n         */\n        forget : function(){\n            this._prevParams = null;\n        },\n\n        /**\n         * Remove all bindings from signal and destroy any reference to external objects (destroy Signal object).\n         * <p><strong>IMPORTANT:</strong> calling any method on the signal instance after calling dispose will throw errors.</p>\n         */\n        dispose : function () {\n            this.removeAll();\n            delete this._bindings;\n            delete this._prevParams;\n        },\n\n        /**\n         * @return {string} String representation of the object.\n         */\n        toString : function () {\n            return '[Signal active:'+ this.active +' numListeners:'+ this.getNumListeners() +']';\n        }\n\n    };\n\n\n    // Namespace -----------------------------------------------------\n    //================================================================\n\n    /**\n     * Signals namespace\n     * @namespace\n     * @name signals\n     */\n    var signals = Signal;\n\n    /**\n     * Custom event broadcaster\n     * @see Signal\n     */\n    // alias for backwards compatibility (see #gh-44)\n    signals.Signal = Signal;\n\n\n\n    //exports to multiple environments\n    if(typeof define === 'function' && define.amd){ //AMD\n        define(function () { return signals; });\n    } else if (typeof module !== 'undefined' && module.exports){ //node\n        module.exports = signals;\n    } else { //browser\n        //use string because of Google closure compiler ADVANCED_MODE\n        /*jslint sub:true */\n        global['signals'] = signals;\n    }\n\n}(this));\n","/**\n * @file Selection Test\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { binarySearchIndexOf, rangeInSortedArray } from '../utils'\nimport { kwd, AtomOnlyKeywords, ChainKeywords } from './selection-constants'\n\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\nexport type ProxyEntity = AtomProxy|ResidueProxy|ChainProxy|ModelProxy\ntype TestEntityFn = (e: ProxyEntity, s: SelectionRule) => boolean|-1\ntype FilterFn = (s: SelectionRule) => boolean\nexport type SelectionTest = false|((e: ProxyEntity) => boolean|-1)\n\nexport type SelectionOperator = 'AND'|'OR'\nexport interface SelectionRule {\n  keyword?: any\n  atomname?: string\n  element?: string\n  atomindex?: number[]\n  altloc?: string\n  inscode?: string\n  resname?: string|string[]\n  sstruc?: string\n  resno?: number|[number, number]\n  chainname?: string\n  model?: number\n\n  error?: string\n  rules?: SelectionRule[]\n  negate?: boolean\n  operator?: SelectionOperator\n}\n\nfunction atomTestFn (a: AtomProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.atomname === undefined && s.element === undefined &&\n    s.altloc === undefined && s.atomindex === undefined &&\n    s.keyword === undefined && s.inscode === undefined &&\n    s.resname === undefined && s.sstruc === undefined &&\n    s.resno === undefined && s.chainname === undefined &&\n    s.model === undefined\n  ) return -1\n\n  if (s.keyword !== undefined) {\n    if (s.keyword === kwd.BACKBONE && !a.isBackbone()) return false\n    if (s.keyword === kwd.SIDECHAIN && !a.isSidechain()) return false\n    if (s.keyword === kwd.BONDED && !a.isBonded()) return false\n    if (s.keyword === kwd.RING && !a.isRing()) return false\n    if (s.keyword === kwd.AROMATICRING && !a.isAromatic()) return false\n\n    if (s.keyword === kwd.HETERO && !a.isHetero()) return false\n    if (s.keyword === kwd.PROTEIN && !a.isProtein()) return false\n    if (s.keyword === kwd.NUCLEIC && !a.isNucleic()) return false\n    if (s.keyword === kwd.RNA && !a.isRna()) return false\n    if (s.keyword === kwd.DNA && !a.isDna()) return false\n    if (s.keyword === kwd.POLYMER && !a.isPolymer()) return false\n    if (s.keyword === kwd.WATER && !a.isWater()) return false\n    if (s.keyword === kwd.HELIX && !a.isHelix()) return false\n    if (s.keyword === kwd.SHEET && !a.isSheet()) return false\n    if (s.keyword === kwd.TURN && !a.isTurn()) return false\n    if (s.keyword === kwd.ION && !a.isIon()) return false\n    if (s.keyword === kwd.SACCHARIDE && !a.isSaccharide()) return false\n    if (s.keyword === kwd.METAL && !a.isMetal()) return false\n    if (s.keyword === kwd.POLARH && !a.isPolarHydrogen()) return false\n  }\n\n  if (s.atomname !== undefined && s.atomname !== a.atomname) return false\n  if (s.element !== undefined && s.element !== a.element) return false\n  if (s.altloc !== undefined && s.altloc !== a.altloc) return false\n\n  if (s.atomindex !== undefined &&\n      binarySearchIndexOf(s.atomindex, a.index) < 0\n  ) return false\n\n  if (s.resname !== undefined) {\n    if (Array.isArray(s.resname)) {\n      if (!s.resname.includes(a.resname)) return false\n    } else {\n      if (s.resname !== a.resname) return false\n    }\n  }\n  if (s.sstruc !== undefined && s.sstruc !== a.sstruc) return false\n  if (s.resno !== undefined) {\n    if (Array.isArray(s.resno) && s.resno.length === 2) {\n      if (s.resno[0] > a.resno || s.resno[1] < a.resno) return false\n    } else {\n      if (s.resno !== a.resno) return false\n    }\n  }\n  if (s.inscode !== undefined && s.inscode !== a.inscode) return false\n\n  if (s.chainname !== undefined && s.chainname !== a.chainname) return false\n  if (s.model !== undefined && s.model !== a.modelIndex) return false\n\n  return true\n}\n\nfunction residueTestFn (r: ResidueProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.resname === undefined && s.resno === undefined && s.inscode === undefined &&\n      s.sstruc === undefined && s.model === undefined && s.chainname === undefined &&\n      s.atomindex === undefined &&\n      (s.keyword === undefined || AtomOnlyKeywords.includes(s.keyword))\n  ) return -1\n\n  if (s.keyword !== undefined) {\n    if (s.keyword === kwd.HETERO && !r.isHetero()) return false\n    if (s.keyword === kwd.PROTEIN && !r.isProtein()) return false\n    if (s.keyword === kwd.NUCLEIC && !r.isNucleic()) return false\n    if (s.keyword === kwd.RNA && !r.isRna()) return false\n    if (s.keyword === kwd.DNA && !r.isDna()) return false\n    if (s.keyword === kwd.POLYMER && !r.isPolymer()) return false\n    if (s.keyword === kwd.WATER && !r.isWater()) return false\n    if (s.keyword === kwd.HELIX && !r.isHelix()) return false\n    if (s.keyword === kwd.SHEET && !r.isSheet()) return false\n    if (s.keyword === kwd.TURN && !r.isTurn()) return false\n    if (s.keyword === kwd.ION && !r.isIon()) return false\n    if (s.keyword === kwd.SACCHARIDE && !r.isSaccharide()) return false\n  }\n\n  if (s.atomindex !== undefined &&\n      rangeInSortedArray(s.atomindex, r.atomOffset, r.atomEnd) === 0\n  ) return false\n\n  if (s.resname !== undefined) {\n    if (Array.isArray(s.resname)) {\n      if (!s.resname.includes(r.resname)) return false\n    } else {\n      if (s.resname !== r.resname) return false\n    }\n  }\n  if (s.sstruc !== undefined && s.sstruc !== r.sstruc) return false\n  if (s.resno !== undefined) {\n    if (Array.isArray(s.resno) && s.resno.length === 2) {\n      if (s.resno[0] > r.resno || s.resno[1] < r.resno) return false\n    } else {\n      if (s.resno !== r.resno) return false\n    }\n  }\n  if (s.inscode !== undefined && s.inscode !== r.inscode) return false\n\n  if (s.chainname !== undefined && s.chainname !== r.chainname) return false\n  if (s.model !== undefined && s.model !== r.modelIndex) return false\n\n  return true\n}\n\nfunction chainTestFn (c: ChainProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.chainname === undefined && s.model === undefined && s.atomindex === undefined &&\n      (s.keyword === undefined || !ChainKeywords.includes(s.keyword) || !c.entity)\n  ) return -1\n\n  if (s.keyword !== undefined) {\n    if (s.keyword === kwd.POLYMER && !c.entity.isPolymer()) return false\n    if (s.keyword === kwd.WATER && !c.entity.isWater()) return false\n  }\n\n  if (s.atomindex !== undefined &&\n      rangeInSortedArray(s.atomindex, c.atomOffset, c.atomEnd) === 0\n  ) return false\n\n  if (s.chainname !== undefined && s.chainname !== c.chainname) return false\n\n  if (s.model !== undefined && s.model !== c.modelIndex) return false\n\n  return true\n}\n\nfunction modelTestFn (m: ModelProxy, s: SelectionRule) {\n  // returning -1 means the rule is not applicable\n  if (s.model === undefined && s.atomindex === undefined) return -1\n\n  if (s.atomindex !== undefined &&\n      rangeInSortedArray(s.atomindex, m.atomOffset, m.atomEnd) === 0\n  ) return false\n\n  if (s.model !== undefined && s.model !== m.index) return false\n\n  return true\n}\n\nfunction makeTest (selection: SelectionRule|null, fn: TestEntityFn) {\n  if (selection === null) return false\n  if (selection.error) return false\n  if (!selection.rules || selection.rules.length === 0) return false\n\n  const n = selection.rules.length\n\n  const t = !selection.negate\n  const f = !!selection.negate\n\n  const subTests: SelectionTest[] = []\n  for (let i = 0; i < n; ++i) {\n    const s = selection.rules[ i ]\n    if (s.hasOwnProperty('operator')) {\n      subTests[ i ] = makeTest(s, fn) as SelectionTest  // TODO\n    }\n  }\n\n  // ( x and y ) can short circuit on false\n  // ( x or y ) can short circuit on true\n  // not ( x and y )\n\n  return function test (entity: ProxyEntity) {\n    const and = selection.operator === 'AND'\n    let na = false\n\n    for (let i = 0; i < n; ++i) {\n      const s = selection.rules![ i ]  // TODO\n      let ret\n\n      if (s.hasOwnProperty('operator')) {\n        const test = subTests[ i ]\n        if (test !== false) {\n          ret = test(entity)\n        } else {\n          ret = -1\n        }\n\n        if (ret === -1) {\n          na = true\n          continue\n        } else if (ret === true) {\n          if (and) { continue } else { return t }\n        } else {\n          if (and) { return f } else { continue }\n        }\n      } else {\n        if (s.keyword === kwd.ALL) {\n          if (and) { continue } else { return t }\n        } else if (s.keyword === kwd.NONE) {\n          if (and) { continue } else { return f }\n        }\n\n        ret = fn(entity, s)\n\n        // console.log( entity.qualifiedName(), ret, s, selection.negate, \"t\", t, \"f\", f )\n\n        if (ret === -1) {\n          na = true\n          continue\n        } else if (ret === true) {\n          if (and) { continue } else { return t }\n        } else {\n          if (and) { return f } else { continue }\n        }\n      }\n    }\n\n    if (na) {\n      return -1\n    } else {\n      if (and) { return t } else { return f }\n    }\n  } as SelectionTest\n}\n\nfunction filter (selection: SelectionRule, fn: FilterFn) {\n  if (selection.error) return selection\n    if (!selection.rules || selection.rules.length === 0) return selection\n\n  const n = selection.rules.length\n\n  const filtered: SelectionRule = {\n    operator: selection.operator,\n    rules: []\n  }\n  if (selection.hasOwnProperty('negate')) {\n    filtered.negate = selection.negate\n  }\n\n  for (let i = 0; i < n; ++i) {\n    const s = selection.rules[ i ]\n    if (s.hasOwnProperty('operator')) {\n      const fs = filter(s, fn)\n      if (fs !== null) filtered.rules!.push(fs)  // TODO\n    } else if (!fn(s)) {\n      filtered.rules!.push(s)  // TODO\n    }\n  }\n\n  if (filtered.rules!.length > 0) {  // TODO\n    // TODO maybe the filtered rules could be returned\n    // in some case, but the way how tests are applied\n    // e.g. when traversing a structure would also need\n    // to change\n    return selection\n    // return filtered;\n  } else {\n    return null\n  }\n}\n\nfunction makeAtomTest (selection: SelectionRule, atomOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (atomOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined && !AtomOnlyKeywords.includes(s.keyword)) return true\n      if (s.model !== undefined) return true\n      if (s.chainname !== undefined) return true\n      if (s.resname !== undefined) return true\n      if (s.resno !== undefined) return true\n      if (s.sstruc !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, atomTestFn)\n}\n\nfunction makeResidueTest (selection: SelectionRule, residueOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (residueOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined && AtomOnlyKeywords.includes(s.keyword)) return true\n      if (s.model !== undefined) return true\n      if (s.chainname !== undefined) return true\n      if (s.atomname !== undefined) return true\n      if (s.element !== undefined) return true\n      if (s.altloc !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, residueTestFn)\n}\n\nfunction makeChainTest (selection: SelectionRule, chainOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (chainOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined && !ChainKeywords.includes(s.keyword)) return true\n      // if( s.model!==undefined ) return true;\n      if (s.resname !== undefined) return true\n      if (s.resno !== undefined) return true\n      if (s.atomname !== undefined) return true\n      if (s.element !== undefined) return true\n      if (s.altloc !== undefined) return true\n      if (s.sstruc !== undefined) return true\n      if (s.inscode !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, chainTestFn)\n}\n\nfunction makeModelTest (selection: SelectionRule, modelOnly = false) {\n  let filteredSelection: SelectionRule|null = selection\n  if (modelOnly) {\n    filteredSelection = filter(selection, function (s) {\n      if (s.keyword !== undefined) return true\n      if (s.chainname !== undefined) return true\n      if (s.resname !== undefined) return true\n      if (s.resno !== undefined) return true\n      if (s.atomname !== undefined) return true\n      if (s.element !== undefined) return true\n      if (s.altloc !== undefined) return true\n      if (s.sstruc !== undefined) return true\n      if (s.inscode !== undefined) return true\n      return false\n    })\n  }\n  return makeTest(filteredSelection, modelTestFn)\n}\n\nexport {\n  makeAtomTest,\n  makeResidueTest,\n  makeChainTest,\n  makeModelTest\n}\n","/**\n * @file Selection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { parseSele } from './selection-parser'\nimport {\n  SelectionTest, SelectionRule,\n  makeAtomTest, makeResidueTest, makeChainTest, makeModelTest\n} from './selection-test'\nimport { SelectAllKeyword, SelectNoneKeyword } from './selection-constants'\n\nexport type SelectionSignals = {\n  stringChanged: Signal\n}\n\n/**\n * Selection\n */\nclass Selection {\n  signals: SelectionSignals\n  string: string\n  selection: SelectionRule\n\n  test: SelectionTest\n  residueTest: SelectionTest\n  chainTest: SelectionTest\n  modelTest: SelectionTest\n\n  atomOnlyTest: SelectionTest\n  residueOnlyTest: SelectionTest\n  chainOnlyTest: SelectionTest\n  modelOnlyTest: SelectionTest\n\n  /**\n   * Create Selection\n   * @param {String} string - selection string, see {@tutorial selection-language}\n   */\n  constructor (string?: string) {\n    this.signals = {\n      stringChanged: new Signal()\n    }\n\n    this.setString(string)\n  }\n\n  get type () { return 'selection' }\n\n  setString (string?: string, silent?: boolean) {\n    if (string === undefined) string = this.string || ''\n    if (string === this.string) return\n\n    try {\n      this.selection = parseSele(string)\n    } catch (e) {\n      // Log.error( e.stack );\n      this.selection = { 'error': e.message }\n    }\n    const selection = this.selection\n\n    this.string = string\n\n    this.test = makeAtomTest(selection)\n    this.residueTest = makeResidueTest(selection)\n    this.chainTest = makeChainTest(selection)\n    this.modelTest = makeModelTest(selection)\n\n    this.atomOnlyTest = makeAtomTest(selection, true)\n    this.residueOnlyTest = makeResidueTest(selection, true)\n    this.chainOnlyTest = makeChainTest(selection, true)\n    this.modelOnlyTest = makeModelTest(selection, true)\n\n    if (!silent) {\n      this.signals.stringChanged.dispatch(this.string)\n    }\n  }\n\n  isAllSelection () {\n    return SelectAllKeyword.includes(this.string.toUpperCase())\n  }\n\n  isNoneSelection () {\n    return SelectNoneKeyword.includes(this.string.toUpperCase())\n  }\n}\n\nexport default Selection\n","/**\n * @file Selection Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { SelectionRule, SelectionOperator } from './selection-test'\nimport {\n  kwd, SelectAllKeyword,\n  SmallResname, NucleophilicResname, HydrophobicResname, AromaticResname,\n  AmideResname, AcidicResname, BasicResname, ChargedResname,\n  PolarResname, NonpolarResname, CyclicResname, AliphaticResname\n} from './selection-constants'\n\nfunction parseSele (string: string) {\n  let retSelection: SelectionRule = {\n    operator: undefined,\n    rules: []\n  }\n\n  if (!string) {\n    return retSelection\n  }\n\n  let selection = retSelection\n  let newSelection: SelectionRule\n  let oldSelection: SelectionRule\n  const selectionStack: SelectionRule[] = []\n\n  string = string.replace(/\\(/g, ' ( ').replace(/\\)/g, ' ) ').trim()\n  if (string.charAt(0) === '(' && string.substr(-1) === ')') {\n    string = string.slice(1, -1).trim()\n  }\n  const chunks = string.split(/\\s+/)\n\n  // Log.log( string, chunks )\n\n  const createNewContext = (operator?: SelectionOperator) => {\n    newSelection = {\n      operator,\n      rules: []\n    }\n    if (selection === undefined) {\n      selection = newSelection\n      retSelection = newSelection\n    } else {\n      selection.rules!.push(newSelection)\n      selectionStack.push(selection)\n      selection = newSelection\n    }\n  }\n\n  const getPrevContext = function (operator?: SelectionOperator) {\n    oldSelection = selection\n    selection = selectionStack.pop()!\n    if (selection === undefined) {\n      createNewContext(operator)\n      pushRule(oldSelection)\n    }\n  }\n\n  const pushRule = function (rule: SelectionRule) {\n    selection.rules!.push(rule)\n  }\n\n  let not: false|0|1|2 = false\n\n  for (let i = 0; i < chunks.length; ++i) {\n    const c = chunks[ i ]\n    const cu = c.toUpperCase()\n\n    // handle parens\n\n    if (c === '(') {\n      // Log.log( \"(\" );\n      not = false\n      createNewContext()\n      continue\n    } else if (c === ')') {\n      // Log.log( \")\" );\n      getPrevContext()\n      if (selection.negate) {\n        getPrevContext()\n      }\n      continue\n    }\n\n    // leave 'not' context\n\n    if (not > 0) {\n      if (cu === 'NOT') {\n        not = 1\n      } else if (not === 1) {\n        not = 2\n      } else if (not === 2) {\n        not = false\n        getPrevContext()\n      } else {\n        throw new Error(\"something went wrong with 'not'\")\n      }\n    }\n\n    // handle logic operators\n\n    if (cu === 'AND') {\n      // Log.log( \"AND\" );\n      if (selection.operator === 'OR') {\n        const lastRule = selection.rules!.pop()!\n        createNewContext('AND')\n        pushRule(lastRule)\n      } else {\n        selection.operator = 'AND'\n      }\n      continue\n    } else if (cu === 'OR') {\n      // Log.log( \"OR\" );\n      if (selection.operator === 'AND') {\n        getPrevContext('OR')\n      } else {\n        selection.operator = 'OR'\n      }\n      continue\n    } else if (c.toUpperCase() === 'NOT') {\n      // Log.log( \"NOT\", j );\n      not = 1\n      createNewContext()\n      selection.negate = true\n      continue\n    } else {\n      // Log.log( \"chunk\", c, j, selection );\n    }\n\n    // handle keyword attributes\n\n    // ensure `cu` is not a number before testing if it is in the\n    // kwd enum dictionary which includes the enum numbers as well...\n    if (+cu !== +cu) {\n      const keyword = (kwd as any)[ cu ]\n      if (keyword !== undefined) {\n        pushRule({ keyword })\n        continue\n      }\n    }\n\n    if (cu === 'HYDROGEN') {\n      pushRule({\n        operator: 'OR',\n        rules: [\n          { element: 'H' },\n          { element: 'D' }\n        ]\n      })\n      continue\n    }\n\n    if (cu === 'SMALL') {\n      pushRule({ resname: SmallResname })\n      continue\n    }\n\n    if (cu === 'NUCLEOPHILIC') {\n      pushRule({ resname: NucleophilicResname })\n      continue\n    }\n\n    if (cu === 'HYDROPHOBIC') {\n      pushRule({ resname: HydrophobicResname })\n      continue\n    }\n\n    if (cu === 'AROMATIC') {\n      pushRule({ resname: AromaticResname })\n      continue\n    }\n\n    if (cu === 'AMIDE') {\n      pushRule({ resname: AmideResname })\n      continue\n    }\n\n    if (cu === 'ACIDIC') {\n      pushRule({ resname: AcidicResname })\n      continue\n    }\n\n    if (cu === 'BASIC') {\n      pushRule({ resname: BasicResname })\n      continue\n    }\n\n    if (cu === 'CHARGED') {\n      pushRule({ resname: ChargedResname })\n      continue\n    }\n\n    if (cu === 'POLAR') {\n      pushRule({ resname: PolarResname })\n      continue\n    }\n\n    if (cu === 'NONPOLAR') {\n      pushRule({ resname: NonpolarResname })\n      continue\n    }\n\n    if (cu === 'CYCLIC') {\n      pushRule({ resname: CyclicResname })\n      continue\n    }\n\n    if (cu === 'ALIPHATIC') {\n      pushRule({ resname: AliphaticResname })\n      continue\n    }\n\n    if (cu === 'SIDECHAINATTACHED') {\n      pushRule({\n        operator: 'OR',\n        rules: [\n          { keyword: kwd.SIDECHAIN },\n          {\n            operator: 'AND',\n            negate: false,\n            rules: [\n              { keyword: kwd.PROTEIN },\n              {\n                operator: 'OR',\n                negate: false,\n                rules: [\n                  { atomname: 'CA' },\n                  { atomname: 'BB' }\n                ]\n              }\n            ]\n          },\n          {\n            operator: 'AND',\n            negate: false,\n            rules: [\n              { resname: 'PRO' },\n              { atomname: 'N' }\n            ]\n          },\n          {\n            operator: 'AND',\n            negate: false,\n            rules: [\n              { keyword: kwd.NUCLEIC },\n              {\n                operator: 'OR',\n                negate: true,\n                rules: [\n                  { atomname: 'P' },\n                  { atomname: 'OP1' },\n                  { atomname: 'OP2' },\n                  { atomname: \"O3'\" },\n                  { atomname: 'O3*' },\n                  { atomname: \"HO3'\"},\n                  { atomname: \"O5'\" },\n                  { atomname: 'O5*' },\n                  { atomname: \"HO5'\"},\n                  { atomname: \"C5'\" },\n                  { atomname: 'C5*' },\n                  { atomname: \"H5'\" },\n                  { atomname: \"H5''\"}\n                ]\n              }\n            ]\n          }\n        ]\n      })\n      continue\n    }\n\n    if (cu === 'APOLARH') {\n      pushRule({\n        operator: 'AND',\n        negate: false,\n        rules: [\n          { element: 'H' },\n          {\n            negate: true,\n            operator: undefined,\n            rules: [\n              { keyword: kwd.POLARH }\n            ]\n          }\n        ]\n      })\n      continue\n    }\n\n    if (cu === 'LIGAND') {\n      pushRule({\n        operator: 'AND',\n        rules: [\n          {\n            operator: 'OR',\n            rules: [\n              {\n                operator: 'AND',\n                rules: [\n                  { keyword: kwd.HETERO },\n                  {\n                    negate: true,\n                    operator: undefined,\n                    rules: [\n                      { keyword: kwd.POLYMER }\n                    ]\n                  }\n                ]\n              },\n              {\n                negate: true,\n                operator: undefined,\n                rules: [\n                  { keyword: kwd.POLYMER }\n                ]\n              }\n            ]\n          },\n          {\n            negate: true,\n            operator: undefined,\n            rules: [\n              {\n                operator: 'OR',\n                rules: [\n                  { keyword: kwd.WATER },\n                  { keyword: kwd.ION }\n                ]\n              }\n            ]\n          }\n        ]\n      })\n      continue\n    }\n\n    if (SelectAllKeyword.indexOf(cu) !== -1) {\n      pushRule({ keyword: kwd.ALL })\n      continue\n    }\n\n    // handle atom expressions\n\n    if (c.charAt(0) === '@') {\n      const indexList = c.substr(1).split(',').map(x => parseInt(x))\n      indexList.sort(function (a, b) { return a - b })\n      pushRule({ atomindex: indexList })\n      continue\n    }\n\n    if (c.charAt(0) === '#') {\n      console.error('# for element selection deprecated, use _')\n      pushRule({ element: cu.substr(1) })\n      continue\n    }\n    if (c.charAt(0) === '_') {\n      pushRule({ element: cu.substr(1) })\n      continue\n    }\n\n    if (c[0] === '[' && c[c.length - 1] === ']') {\n      const resnameList = cu.substr(1, c.length - 2).split(',')\n      const resname = resnameList.length > 1 ? resnameList : resnameList[ 0 ]\n      pushRule({ resname: resname })\n      continue\n    } else if (\n      (c.length >= 1 && c.length <= 4) &&\n      c[0] !== '^' && c[0] !== ':' && c[0] !== '.' && c[0] !== '%' && c[0] !== '/' &&\n      isNaN(parseInt(c))\n    ) {\n      pushRule({ resname: cu })\n      continue\n    }\n\n    // there must be only one constraint per rule\n    // otherwise a test quickly becomes not applicable\n    // e.g. chainTest for chainname when resno is present too\n\n    const sele: SelectionRule = {\n      operator: 'AND',\n      rules: []\n    }\n\n    const model = c.split('/')\n    if (model.length > 1 && model[1]) {\n      if (isNaN(parseInt(model[1]))) {\n        throw new Error('model must be an integer')\n      }\n      sele.rules!.push({\n        model: parseInt(model[1])\n      })\n    }\n\n    const altloc = model[0].split('%')\n    if (altloc.length > 1) {\n      sele.rules!.push({\n        altloc: altloc[1]\n      })\n    }\n\n    const atomname = altloc[0].split('.')\n    if (atomname.length > 1 && atomname[1]) {\n      if (atomname[1].length > 4) {\n        throw new Error('atomname must be one to four characters')\n      }\n      sele.rules!.push({\n        atomname: atomname[1].substring(0, 4).toUpperCase()\n      })\n    }\n\n    const chain = atomname[0].split(':')\n    if (chain.length > 1 && chain[1]) {\n      sele.rules!.push({\n        chainname: chain[1]\n      })\n    }\n\n    const inscode = chain[0].split('^')\n    if (inscode.length > 1) {\n      sele.rules!.push({\n        inscode: inscode[1]\n      })\n    }\n\n    if (inscode[0]) {\n      let negate, negate2\n      if (inscode[0][0] === '-') {\n        inscode[0] = inscode[0].substr(1)\n        negate = true\n      }\n      if (inscode[0].includes('--')) {\n        inscode[0] = inscode[0].replace('--', '-')\n        negate2 = true\n      }\n      let resi = inscode[0].split('-')\n      if (resi.length === 1) {\n        let resiSingle = parseInt(resi[0])\n        if (isNaN(resiSingle)) {\n          throw new Error('resi must be an integer')\n        }\n        if (negate) resiSingle *= -1\n        sele.rules!.push({\n          resno: resiSingle\n        })\n      } else if (resi.length === 2) {\n        const resiRange = resi.map(x => parseInt(x))\n        if (negate) resiRange[0] *= -1\n        if (negate2) resiRange[1] *= -1\n        sele.rules!.push({\n          resno: [resiRange[0], resiRange[1]]\n        })\n      } else {\n        throw new Error(\"resi range must contain one '-'\")\n      }\n    }\n\n    // round up\n\n    if (sele.rules!.length === 1) {\n      pushRule(sele.rules![ 0 ])\n    } else if (sele.rules!.length > 1) {\n      pushRule(sele)\n    } else {\n      throw new Error('empty selection chunk')\n    }\n  }\n\n  // cleanup\n\n  if (\n    retSelection.operator === undefined &&\n    retSelection.rules!.length === 1 &&\n    retSelection.rules![ 0 ].hasOwnProperty('operator')\n  ) {\n    retSelection = retSelection.rules![ 0 ]\n  }\n\n  return retSelection\n}\n\nexport {\n  parseSele\n}\n","/**\n * @file Selection Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport Selection from '../selection/selection'\nimport Colormaker, { ColormakerParameters } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Structure from '../structure/structure'\n\nexport type SelectionSchemeData = [ string, string, ColormakerParameters|undefined ]\n\n/**\n * Color based on {@link Selection}\n */\nclass SelectionColormaker extends Colormaker {\n  colormakerList: any[] = []  // TODO\n  selectionList: Selection[] = []\n\n  constructor (params: { structure: Structure, dataList: SelectionSchemeData[] } & Partial<ColormakerParameters>) {\n    super(params)\n\n    const dataList = params.dataList || []\n\n    dataList.forEach((data: SelectionSchemeData) => {\n      const [ scheme, sele, params = {} ] = data\n\n      if (ColormakerRegistry.hasScheme(scheme)) {\n        Object.assign(params, {\n          scheme: scheme,\n          structure: this.parameters.structure\n        })\n      } else {\n        Object.assign(params, {\n          scheme: 'uniform',\n          value: new Color(scheme).getHex()\n        })\n      }\n\n      this.colormakerList.push(ColormakerRegistry.getScheme(params as { scheme: string } & ColormakerParameters))\n      this.selectionList.push(new Selection(sele))\n    })\n  }\n\n  // NOT NEEDED @manageColor\n  atomColor (a: AtomProxy) {\n    for (let i = 0, n = this.selectionList.length; i < n; ++i) {\n      const test = this.selectionList[ i ].test\n      if (test && test(a)) {\n        return this.colormakerList[ i ].atomColor(a)\n      }\n    }\n\n    return 0xFFFFFF\n  }\n}\n\nexport default SelectionColormaker\n","/**\n * @file Colormaker Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { generateUUID } from '../math/math-utils'\nimport Colormaker, { ColormakerParameters } from './colormaker'\nimport SelectionColormaker, { SelectionSchemeData } from './selection-colormaker'\nimport Structure from '../structure/structure'\n\nconst ColormakerScales = {\n  '': '',\n\n    // Sequential\n  OrRd: '[S] Orange-Red',\n  PuBu: '[S] Purple-Blue',\n  BuPu: '[S] Blue-Purple',\n  Oranges: '[S] Oranges',\n  BuGn: '[S] Blue-Green',\n  YlOrBr: '[S] Yellow-Orange-Brown',\n  YlGn: '[S] Yellow-Green',\n  Reds: '[S] Reds',\n  RdPu: '[S] Red-Purple',\n  Greens: '[S] Greens',\n  YlGnBu: '[S] Yellow-Green-Blue',\n  Purples: '[S] Purples',\n  GnBu: '[S] Green-Blue',\n  Greys: '[S] Greys',\n  YlOrRd: '[S] Yellow-Orange-Red',\n  PuRd: '[S] Purple-Red',\n  Blues: '[S] Blues',\n  PuBuGn: '[S] Purple-Blue-Green',\n\n    // Diverging\n  Viridis: '[D] Viridis',\n  Spectral: '[D] Spectral',\n  RdYlGn: '[D] Red-Yellow-Green',\n  RdBu: '[D] Red-Blue',\n  PiYG: '[D] Pink-Yellowgreen',\n  PRGn: '[D] Purplered-Green',\n  RdYlBu: '[D] Red-Yellow-Blue',\n  BrBG: '[D] Brown-Bluegreen',\n  RdGy: '[D] Red-Grey',\n  PuOr: '[D] Purple-Orange',\n\n    // Qualitative\n  Set1: '[Q] Set1',\n  Set2: '[Q] Set2',\n  Set3: '[Q] Set3',\n  Dark2: '[Q] Dark2',\n  Paired: '[Q] Paired',\n  Pastel1: '[Q] Pastel1',\n  Pastel2: '[Q] Pastel2',\n  Accent: '[Q] Accent',\n\n    // Other\n  rainbow: '[?] Rainbow',\n  rwb: '[?] Red-White-Blue'\n}\n\nconst ColormakerModes = {\n  '': '',\n\n  rgb: 'Red Green Blue',\n  hsv: 'Hue Saturation Value',\n  hsl: 'Hue Saturation Lightness',\n  hsi: 'Hue Saturation Intensity',\n  lab: 'CIE L*a*b*',\n  hcl: 'Hue Chroma Lightness'\n}\n\n/**\n * Class for registering {@link Colormaker}s. Generally use the\n * global {@link src/globals.js~ColormakerRegistry} instance.\n */\nclass ColormakerRegistry {\n  schemes: { [k: string]: any }\n  userSchemes: { [k: string]: any }\n\n  constructor () {\n    this.schemes = {}\n    this.userSchemes = {}\n  }\n\n  getScheme (params: Partial<{ scheme: string } & ColormakerParameters>) {\n    const p = params || {}\n    const id = (p.scheme || '').toLowerCase()\n\n    let SchemeClass\n\n    if (id in this.schemes) {\n      SchemeClass = this.schemes[ id ]\n    } else if (id in this.userSchemes) {\n      SchemeClass = this.userSchemes[ id ]\n    } else {\n      SchemeClass = Colormaker\n    }\n\n    return new SchemeClass(params)\n  }\n\n  /**\n   * Get an description of available schemes as an\n   * object with id-label as key-value pairs\n   * @return {Object} available schemes\n   */\n  getSchemes () {\n    const types: { [k: string]: any } = {}\n\n    Object.keys(this.schemes).forEach(function (k) {\n      types[ k ] = k\n    })\n\n    Object.keys(this.userSchemes).forEach(function (k) {\n      types[ k ] = k.split('|')[ 1 ]\n    })\n\n    return types\n  }\n\n  /**\n   * Get an description of available scales as an\n   * object with id-label as key-value pairs\n   * @return {Object} available scales\n   */\n  getScales () {\n    return ColormakerScales\n  }\n\n  getModes () {\n    return ColormakerModes\n  }\n\n  /**\n   * Add a scheme with a hardcoded id\n   * @param {String} id - the id\n   * @param {Colormaker} scheme - the colormaker\n   * @return {undefined}\n   */\n  add (id: string, scheme: typeof Colormaker) {\n    id = id.toLowerCase()\n    this.schemes[ id ] = scheme\n  }\n\n  /**\n   * Register a custom scheme\n   *\n   * @example\n   * // Create a class with a `atomColor` method that returns a hex color.\n   * var schemeId = NGL.ColormakerRegistry.addScheme( function( params ){\n   *     this.atomColor = function( atom ){\n   *         if( atom.serial < 1000 ){\n   *             return 0x0000FF;  // blue\n   *         }else if( atom.serial > 2000 ){\n   *             return 0xFF0000;  // red\n   *         }else{\n   *             return 0x00FF00;  // green\n   *         }\n   *     };\n   * } );\n   *\n   * stage.loadFile( \"rcsb://3dqb.pdb\" ).then( function( o ){\n   *     o.addRepresentation( \"cartoon\", { color: schemeId } );  // pass schemeId here\n   *     o.autoView();\n   * } );\n   *\n   * @param {Function|Colormaker} scheme - constructor or {@link Colormaker} instance\n   * @param {String} label - scheme label\n   * @return {String} id to refer to the registered scheme\n   */\n  addScheme (scheme: any, label?: string) {\n    if (!(scheme instanceof Colormaker)) {\n      scheme = this._createScheme(scheme)\n    }\n\n    return this._addUserScheme(scheme, label)\n  }\n\n  /**\n   * Add a user-defined scheme\n   * @param {Colormaker} scheme - the user-defined scheme\n   * @param {String} [label] - scheme label\n   * @return {String} id to refer to the registered scheme\n   */\n  _addUserScheme (scheme: any, label?: string) {\n    label = label || ''\n    const id = `${generateUUID()}|${label}`.toLowerCase()\n    this.userSchemes[ id ] = scheme\n\n    return id\n  }\n\n  /**\n   * Remove the scheme with the given id\n   * @param  {String} id - scheme to remove\n   * @return {undefined}\n   */\n  removeScheme (id: string) {\n    id = id.toLowerCase()\n    delete this.userSchemes[ id ]\n  }\n\n  _createScheme (constructor: any) {\n    const _Colormaker = function (this: any, params: ColormakerParameters) {\n      Colormaker.call(this, params)\n      constructor.call(this, params)\n    }\n\n    _Colormaker.prototype = Colormaker.prototype\n    _Colormaker.prototype.constructor = Colormaker\n\n    return _Colormaker\n  }\n\n  /**\n   * Create and a selection-based coloring scheme. Supply a list with pairs\n   * of colorname and selection for coloring by selections. Use the last\n   * entry as a default (catch all) coloring definition.\n   *\n   * @example\n   * var schemeId = NGL.ColormakerRegistry.addSelectionScheme( [\n   *     [ \"red\", \"64-74 or 134-154 or 222-254 or 310-310 or 322-326\" ],\n   *     [ \"green\", \"311-322\" ],\n   *     [ \"yellow\", \"40-63 or 75-95 or 112-133 or 155-173 or 202-221 or 255-277 or 289-309\" ],\n   *     [ \"blue\", \"1-39 or 96-112 or 174-201 or 278-288\" ],\n   *     [ \"white\", \"*\" ]\n   * ], \"Transmembrane 3dqb\" );\n   *\n   * stage.loadFile( \"rcsb://3dqb.pdb\" ).then( function( o ){\n   *     o.addRepresentation( \"cartoon\", { color: schemeId } );  // pass schemeId here\n   *     o.autoView();\n   * } );\n   *\n   * @param {Array} dataList - cloror-selection pairs\n   * @param {String} label - scheme name\n   * @return {String} id to refer to the registered scheme\n   */\n  addSelectionScheme (dataList: SelectionSchemeData[], label?: string) {\n    class MySelectionColormaker extends SelectionColormaker {\n      constructor (params: { structure: Structure } & ColormakerParameters) {\n        super(Object.assign({ dataList }, params))\n      }\n    }\n\n    return this._addUserScheme(MySelectionColormaker, label)\n  }\n\n  /**\n   * Check if a scheme with the given id exists\n   * @param  {String}  id - the id to check\n   * @return {Boolean} flag indicating if the scheme exists\n   */\n  hasScheme (id: string) {\n    id = id.toLowerCase()\n    return id in this.schemes || id in this.userSchemes\n  }\n}\n\nexport default ColormakerRegistry\n","/**\n * @file Parser Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Registry from '../utils/registry'\n\nclass ParserRegistry extends Registry {\n  constructor () {\n    super('parser')\n  }\n\n  __hasObjName (key: string, objName: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.__objName === objName\n  }\n\n  isTrajectory (key: string) {\n    return this.__hasObjName(key, 'frames')\n  }\n\n  isStructure (key: string) {\n    return this.__hasObjName(key, 'structure')\n  }\n\n  isVolume (key: string) {\n    return this.__hasObjName(key, 'volume')\n  }\n\n  isSurface (key: string) {\n    return this.__hasObjName(key, 'surface')\n  }\n\n  isBinary (key: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.isBinary\n  }\n\n  isXml (key: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.isXml\n  }\n\n  isJson (key: string) {\n    const parser = this.get(key)\n    return parser && parser.prototype.isJson\n  }\n\n  getTrajectoryExtensions () {\n    return this.names.filter(name => this.isTrajectory(name))\n  }\n\n  getStructureExtensions () {\n    return this.names.filter(name => this.isStructure(name))\n  }\n\n  getVolumeExtensions () {\n    return this.names.filter(name => this.isVolume(name))\n  }\n\n  getSurfaceExtensions () {\n    return this.names.filter(name => this.isSurface(name))\n  }\n}\n\nexport default ParserRegistry\n","/**\n * @file Worker Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { uniqueArray } from '../utils'\n\nexport type FunctionWithDeps = { __deps?: Function[] } & Function\nexport interface WorkerEvent {\n  data: {\n    __name: string\n    __postId: string\n  }\n}\n\nfunction getWorkerDeps (vars: FunctionWithDeps[]) {\n  const deps = vars\n  vars.forEach(function (sym) {\n    if (sym.__deps) {\n      Array.prototype.push.apply(deps, getWorkerDeps(sym.__deps))\n    }\n  })\n  return deps\n}\n\nfunction makeWorkerString (vars: any) {\n  const deps = uniqueArray(getWorkerDeps(vars))\n  return deps.map(function (sym) {\n    return sym.toString()\n  }).join('\\n\\n\\n')\n}\n\nfunction onmessage (e: WorkerEvent) {\n  const name = e.data.__name\n  const postId = e.data.__postId\n\n  /* global self */\n  if (name === undefined) {\n    console.error('message __name undefined')\n  } else if ((self as any).func === undefined) {\n    console.error('worker func undefined', name)\n  } else {\n    const callback = function (aMessage: any, transferList: any[]) {\n      aMessage = aMessage || {}\n      if (postId !== undefined) aMessage.__postId = postId\n\n      try {\n        (self as any).postMessage(aMessage, transferList)\n      } catch (error) {\n        console.error('self.postMessage:', error);\n        (self as any).postMessage(aMessage)\n      }\n    };\n    (self as any).func(e, callback)\n  }\n}\n\nexport function makeWorkerBlob (func: Function, deps: Function[]) {\n  let str = \"'use strict';\\n\\n\" + makeWorkerString(deps)\n  str += '\\n\\n\\nself.func = ' + func.toString() + ';'\n  str += '\\n\\n\\nself.onmessage = ' + onmessage.toString() + ';'\n    // console.log(str);\n  return new Blob([ str ], { type: 'application/javascript' })\n}\n","/**\n * @file Worker Registry\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { makeWorkerBlob } from './worker-utils'\n\nclass WorkerRegistry {\n  activeWorkerCount = 0\n\n  private _funcDict: { [k: string]: Function } = {}\n  private _depsDict: { [k: string]: Function[] } = {}\n  private _blobDict: { [k: string]: Blob } = {}\n\n  add (name: string, func: Function, deps: Function[]) {\n    this._funcDict[ name ] = func\n    this._depsDict[ name ] = deps\n  }\n\n  get (name: string) {\n    if (!this._blobDict[ name ]) {\n      this._blobDict[ name ] = makeWorkerBlob(\n        this._funcDict[ name ], this._depsDict[ name ]\n      )\n    }\n    return this._blobDict[ name ]\n  }\n}\n\nexport default WorkerRegistry\n","/**\n * @file Globals\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getBrowser, getQuery, boolean } from './utils'\nimport Registry from './utils/registry'\nimport _ColormakerRegistry from './color/colormaker-registry'\nimport _ParserRegistry from './parser/parser-registry'\nimport _WorkerRegistry from './worker/worker-registry'\nimport { MeasurementRepresentationParameters } from './representation/measurement-representation';\n\n/**\n * The browser name: \"Opera\", \"Chrome\", \"Firefox\", \"Mobile Safari\",\n * \"Internet Explorer\", \"Safari\" or false.\n */\nexport const Browser = getBrowser()\n\n/**\n * Flag indicating support for the 'passive' option for event handler\n */\nexport let SupportsPassiveEventHandler = false\ntry {\n  // Test via a getter in the options object to see if the passive property is accessed\n  const opts = Object.defineProperty({}, 'passive', {\n    get: function () {\n      SupportsPassiveEventHandler = true\n    }\n  })\n  window.addEventListener('test', e => {}, opts)\n} catch (e) {}\n\n/**\n * Flag indicating a mobile browser\n */\nexport const Mobile = typeof window !== 'undefined' ? typeof window.orientation !== 'undefined' : false\n\nexport let SupportsReadPixelsFloat = false\nexport function setSupportsReadPixelsFloat (value: boolean) {\n  SupportsReadPixelsFloat = value\n}\n\n/**\n * Flag indicating support for the `EXT_frag_depth` WebGL extension\n * (Always present in WebGL2)\n */\nexport let ExtensionFragDepth = false\nexport function setExtensionFragDepth (value: boolean) {\n  ExtensionFragDepth = value\n}\n\nexport const Log = {\n  log: Function.prototype.bind.call(console.log, console),\n  info: Function.prototype.bind.call(console.info, console),\n  warn: Function.prototype.bind.call(console.warn, console),\n  error: Function.prototype.bind.call(console.error, console),\n  time: Function.prototype.bind.call(console.time, console),\n  timeEnd: Function.prototype.bind.call(console.timeEnd, console)\n}\n\nexport let MeasurementDefaultParams: Partial<MeasurementRepresentationParameters> = {\n  color: 'green',\n  labelColor: 0x808080,\n  labelAttachment: 'bottom-center',\n  labelSize: 0.7,\n  labelZOffset: 0.5,\n  labelYOffset: 0.1,\n  labelBorder: true,\n  labelBorderColor: 0xd3d3d3,\n  labelBorderWidth: 0.25,\n  lineOpacity: 0.8,\n  linewidth: 5.0,\n  opacity: 0.6,\n\n  labelUnit: 'angstrom',\n  arcVisible: true,\n  planeVisible: false\n}\nexport function setMeasurementDefaultParams (params = {}) {\n  Object.assign(MeasurementDefaultParams, params)\n}\n\nexport let Debug = boolean(getQuery('debug'))\nexport function setDebug (value: boolean) {\n  Debug = value\n}\n\nexport const WebglErrorMessage = '<div style=\"display:flex;align-items:center;justify-content:center;height:100%;\"><p style=\"padding:15px;text-align:center;\">Your browser/graphics card does not seem to support <a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/WebGL\">WebGL</a>.<br/><br/>Find out how to get it <a target=\"_blank\" href=\"http://get.webgl.org/\">here</a>.</p></div>'\n\n/**\n * List of file extensions to be recognized as scripts\n */\nexport const ScriptExtensions = [ 'ngl', 'js' ]\n\nexport const WorkerRegistry = new _WorkerRegistry()\nexport const ColormakerRegistry = new _ColormakerRegistry()\nexport const DatasourceRegistry = new Registry('datasource')\nexport const RepresentationRegistry = new Registry('representatation')\nexport const ParserRegistry = new _ParserRegistry()\nexport const ShaderRegistry = new Registry('shader')\nexport const DecompressorRegistry = new Registry('decompressor')\nexport const ComponentRegistry = new Registry('component')\nexport const BufferRegistry = new Registry('buffer')\nexport const PickerRegistry = new Registry('picker')\n\nexport let ListingDatasource: any\nexport function setListingDatasource (value: boolean) {\n  ListingDatasource = value\n}\n\nexport let TrajectoryDatasource: any\nexport function setTrajectoryDatasource (value: boolean) {\n  TrajectoryDatasource = value\n}\n","/**\n * @file Streamer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { DecompressorRegistry } from '../globals'\nimport { uint8ToString, defaults } from '../utils'\n\nexport interface StreamerParams {\n  compressed?: string|false\n  binary?: boolean\n  json?: boolean\n  xml?: boolean\n}\n\nabstract class Streamer {\n  src: any\n  data: any\n\n  compressed: string|false\n  binary: boolean\n  json: boolean\n  xml: boolean\n\n  chunkSize = 1024 * 1024 * 10\n  newline = '\\n'\n\n  protected __pointer = 0\n  protected __partialLine = ''\n\n  constructor (src: any, params: StreamerParams = {}) {\n    this.compressed = defaults(params.compressed, false)\n    this.binary = defaults(params.binary, false)\n    this.json = defaults(params.json, false)\n    this.xml = defaults(params.xml, false)\n\n    this.src = src\n  }\n\n  isBinary () {\n    return this.binary || this.compressed\n  }\n\n  read () {\n    return this._read().then(data => {\n      const decompressFn = this.compressed ? DecompressorRegistry.get(this.compressed) : undefined\n\n      if (this.compressed && decompressFn) {\n        this.data = decompressFn(data)\n      } else {\n        if ((this.binary || this.compressed) && data instanceof ArrayBuffer) {\n          data = new Uint8Array(data)\n        }\n        this.data = data\n      }\n\n      return this.data\n    })\n  }\n\n  protected abstract _read (): Promise<any>\n\n  protected _chunk (start: number, end: number) {\n    end = Math.min(this.data.length, end)\n\n    if (start === 0 && this.data.length === end) {\n      return this.data\n    } else {\n      if (this.isBinary()) {\n        return this.data.subarray(start, end)\n      } else {\n        return this.data.substring(start, end)\n      }\n    }\n  }\n\n  chunk (start: number) {\n    const end = start + this.chunkSize\n\n    return this._chunk(start, end)\n  }\n\n  peekLines (m: number) {\n    const data = this.data\n    const n = data.length\n\n    // FIXME does not work for multi-char newline\n    const newline = this.isBinary() ? this.newline.charCodeAt(0) : this.newline\n\n    let i\n    let count = 0\n    for (i = 0; i < n; ++i) {\n      if (data[ i ] === newline) ++count\n      if (count === m) break\n    }\n\n    const chunk = this._chunk(0, i + 1)\n    const d = this.chunkToLines(chunk, '', i > n)\n\n    return d.lines\n  }\n\n  chunkCount () {\n    return Math.floor(this.data.length / this.chunkSize) + 1\n  }\n\n  asText () {\n    return this.isBinary() ? uint8ToString(this.data) : this.data\n  }\n\n  chunkToLines (chunk: string|Uint8Array, partialLine: string, isLast: boolean) {\n    const newline = this.newline\n\n    if (!this.isBinary() && chunk.length === this.data.length) {\n      return {\n        lines: (chunk as string).split(newline),\n        partialLine: ''\n      }\n    }\n\n    let lines: string[] = []\n    const str = this.isBinary() ? uint8ToString(chunk as Uint8Array) : chunk\n    const idx = str.lastIndexOf(newline)\n\n    if (idx === -1) {\n      partialLine += str\n    } else {\n      const str2 = partialLine + str.substr(0, idx)\n      lines = lines.concat(str2.split(newline))\n\n      if (idx === str.length - newline.length) {\n        partialLine = ''\n      } else {\n        partialLine = str.substr(idx + newline.length)\n      }\n    }\n\n    if (isLast && partialLine !== '') {\n      lines.push(partialLine)\n    }\n\n    return {\n      lines: lines,\n      partialLine: partialLine\n    }\n  }\n\n  nextChunk () {\n    const start = this.__pointer\n\n    if (start > this.data.length) {\n      return undefined\n    }\n\n    this.__pointer += this.chunkSize\n    return this.chunk(start)\n  }\n\n  nextChunkOfLines () {\n    const chunk = this.nextChunk()\n\n    if (chunk === undefined) {\n      return undefined\n    }\n\n    const isLast = this.__pointer > this.data.length\n    const d = this.chunkToLines(chunk, this.__partialLine, isLast)\n\n    this.__partialLine = d.partialLine\n\n    return d.lines\n  }\n\n  eachChunk (callback: (chunk: string|Uint8Array, chunkNo: number, chunkCount: number) => void) {\n    const chunkSize = this.chunkSize\n    const n = this.data.length\n    const chunkCount = this.chunkCount()\n\n    for (let i = 0; i < n; i += chunkSize) {\n      const chunk = this.chunk(i)\n      const chunkNo = Math.round(i / chunkSize)\n\n      callback(chunk, chunkNo, chunkCount)\n    }\n  }\n\n  eachChunkOfLines (callback: (chunk: string[], chunkNo: number, chunkCount: number) => void) {\n    this.eachChunk((chunk, chunkNo, chunkCount) => {\n      const isLast = chunkNo === chunkCount + 1\n      const d = this.chunkToLines(chunk, this.__partialLine, isLast)\n\n      this.__partialLine = d.partialLine\n\n      callback(d.lines, chunkNo, chunkCount)\n    })\n  }\n\n  dispose () {\n    delete this.src\n  }\n}\n\nexport default Streamer\n","/**\n * @file File Streamer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Streamer from './streamer'\n\ninterface FileReaderEventTarget extends EventTarget {\n    result:string | ArrayBuffer | null\n}\n\ninterface FileReaderEvent extends ProgressEvent {\n    target: FileReaderEventTarget | null;\n}\n\nclass FileStreamer extends Streamer {\n  _read () {\n    return new Promise((resolve, reject) => {\n      const file = this.src\n      const reader = new FileReader()\n\n      reader.onload = (event: FileReaderEvent) => {\n        if(event.target) resolve(event.target.result)\n      }\n\n      // if (typeof this.onprogress === 'function') {\n      //   reader.onprogress = event => this.onprogress(event)\n      // }\n\n      reader.onerror = event => reject(event)\n\n      if (this.binary || this.compressed) {\n        reader.readAsArrayBuffer(file)\n      } else {\n        reader.readAsText(file)\n      }\n    })\n  }\n}\n\nexport default FileStreamer\n","/**\n * @file Network Streamer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Streamer from './streamer'\n\nclass NetworkStreamer extends Streamer {\n  _read () {\n    return new Promise((resolve, reject) => {\n      const url = this.src\n      const xhr = new XMLHttpRequest()\n\n      xhr.open('GET', url, true)\n\n      xhr.addEventListener('load', () => {\n        if (xhr.status === 200 || xhr.status === 304 ||\n            // when requesting from local file system\n            // the status in Google Chrome/Chromium is 0\n            xhr.status === 0\n        ) {\n          try {\n            resolve(xhr.response)\n          } catch (e) {\n            reject(e)\n          }\n        } else {\n          reject(xhr.statusText)\n        }\n      }, false)\n\n      // if (typeof this.onprogress === 'function') {\n      //   xhr.addEventListener('progress', event => this.onprogress(event), false);\n      // }\n\n      xhr.addEventListener('error', event => reject('network error'), false)\n\n      if (this.isBinary()) {\n        xhr.responseType = 'arraybuffer'\n      } else if (this.json) {\n        xhr.responseType = 'json'\n      } else if (this.xml) {\n        xhr.responseType = 'document'\n      } else {\n        xhr.responseType = 'text'\n      }\n      // xhr.crossOrigin = true;\n\n      xhr.send()\n    })\n  }\n}\n\nexport default NetworkStreamer\n","/**\n * @file Loader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport { createParams } from '../utils'\nimport { Partial } from '../types'\nimport FileStreamer from '../streamer/file-streamer'\nimport NetworkStreamer from '../streamer/network-streamer'\nimport { LoaderParameters, LoaderInput } from './loader-utils'\n\n/**\n * Loader parameter object.\n * @typedef {Object} LoaderParameters - loader parameters\n * @property {String} ext - file extension, determines file type\n * @property {Boolean} compressed - flag data as compressed\n * @property {Boolean} binary - flag data as binary\n * @property {String} name - set data name\n */\n\n/**\n * Loader base class\n */\nabstract class Loader {\n  parameters: LoaderParameters\n  streamer: FileStreamer | NetworkStreamer\n\n  /**\n   * Construct a loader object\n   * @param  {String|File|Blob} src - data source, string is interpreted as an URL\n   * @param  {LoaderParameters} params - parameters object\n   */\n  constructor (src: LoaderInput, params: Partial<LoaderParameters> = {}) {\n    this.parameters = createParams(params, {\n      ext: '',\n      compressed: false,\n      binary: ParserRegistry.isBinary(params.ext || ''),\n      name: '',\n\n      dir: '',\n      path: '',\n      protocol: ''\n    } as LoaderParameters)\n\n    const streamerParams = {\n      compressed: this.parameters.compressed as string|false,\n      binary: this.parameters.binary,\n      json: ParserRegistry.isJson(this.parameters.ext),\n      xml: ParserRegistry.isXml(this.parameters.ext)\n    }\n\n    if ((typeof File !== 'undefined' && src instanceof File) ||\n        (typeof Blob !== 'undefined' && src instanceof Blob)\n    ) {\n      this.streamer = new FileStreamer(src, streamerParams)\n    } else {\n      this.streamer = new NetworkStreamer(src, streamerParams)\n    }\n  }\n\n  /**\n   * Load data\n   * @abstract\n   * @return {Promise} resolves to the loaded data {@link Object}\n   */\n  abstract load (): Promise<any>\n}\n\nexport default Loader\n","/**\n * @file Parser Loader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport Loader from './loader'\nimport { LoaderParameters, LoaderInput } from './loader-utils'\n\nexport interface ParserParams {\n  voxelSize?: number\n  firstModelOnly?: boolean\n  asTrajectory?: boolean\n  cAlphaOnly?: boolean\n  name?: string\n  path?: string\n  delimiter?: string\n  comment?: string\n  columnNames?: string\n}\n\n/**\n * Parser loader class\n * @extends Loader\n */\nclass ParserLoader extends Loader {\n  parserParams: ParserParams\n\n  constructor (src: LoaderInput, params: Partial<LoaderParameters> & ParserParams = {}) {\n    super(src, params)\n    this.parserParams = {\n      voxelSize: params.voxelSize,\n      firstModelOnly: params.firstModelOnly,\n      asTrajectory: params.asTrajectory,\n      cAlphaOnly: params.cAlphaOnly,\n      delimiter: params.delimiter,\n      comment: params.comment,\n      columnNames: params.columnNames,\n      name: this.parameters.name,\n      path: this.parameters.path\n    }\n  }\n\n  /**\n   * Load parsed object\n   * @return {Promise} resolves to the loaded & parsed {@link Structure},\n   *                   {@link Volume}, {@link Surface} or data object\n   */\n  load () {\n    var ParserClass = ParserRegistry.get(this.parameters.ext)\n    var parser = new ParserClass(this.streamer, this.parserParams)\n\n    return parser.parse()\n  }\n}\n\nexport default ParserLoader\n","/**\n * @file Script\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { Log } from './globals'\nimport Stage from './stage/stage'\n\nexport interface ScriptSignals {\n  elementAdded: Signal\n  elementRemoved: Signal\n  nameChanged: Signal\n}\n\n/**\n * Script class\n */\nclass Script {\n  readonly signals: ScriptSignals = {\n    elementAdded: new Signal(),\n    elementRemoved: new Signal(),\n    nameChanged: new Signal()\n  }\n\n  readonly dir: string\n  readonly fn: Function\n\n  readonly type = 'Script'\n\n  /**\n   * Create a script instance\n   * @param {String} functionBody - the function source\n   * @param {String} name - name of the script\n   * @param {String} path - path of the script\n   */\n  constructor (functionBody: string, readonly name: string, readonly path: string) {\n    this.dir = path.substring(0, path.lastIndexOf('/') + 1)\n\n    try {\n      /* eslint-disable no-new-func */\n      this.fn = new Function('stage', '__name', '__path', '__dir', functionBody)\n    } catch (e) {\n      Log.error('Script compilation failed', e)\n      this.fn = function () {}\n    }\n  }\n\n  /**\n   * Execute the script\n   * @param  {Stage} stage - the stage context\n   * @return {Promise} - resolve when script finished running\n   */\n  run (stage: Stage): Promise<void> {\n    return new Promise((resolve, reject) => {\n      try {\n        this.fn.apply(null, [ stage, this.name, this.path, this.dir ])\n        resolve()\n      } catch (e) {\n        Log.error('Script.fn', e)\n        reject(e)\n      }\n    })\n  }\n}\n\nexport default Script\n","/**\n * @file Script Loader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Loader from './loader'\nimport Script from '../script'\n\n/**\n * Script loader class\n * @extends Loader\n */\nclass ScriptLoader extends Loader {\n  /**\n   * Load script\n   * @return {Promise} resolves to the loaded {@link Script}\n   */\n  load () {\n    return this.streamer.read().then(() => {\n      return new Script(\n        this.streamer.asText(), this.parameters.name, this.parameters.path\n      )\n    })\n  }\n}\n\nexport default ScriptLoader\n","/**\n * @file Loader Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n  DatasourceRegistry, DecompressorRegistry, ParserRegistry, ScriptExtensions\n} from '../globals'\nimport { Partial } from '../types'\nimport ParserLoader from './parser-loader'\nimport ScriptLoader from './script-loader'\n\nexport interface LoaderParameters {\n ext: string  // file extension, determines file type\n compressed: string|false  // flag data as compressed\n binary: boolean  // flag data as binary\n name: string  // set data name\n\n dir: string\n path: string\n protocol: string\n}\n\nexport type LoaderInput = File|Blob|string\n\nexport function getFileInfo (file: LoaderInput) {\n  const compressedExtList = DecompressorRegistry.names\n\n  let path: string\n  let compressed: string|false\n  let protocol = ''\n\n  if (file instanceof File) {\n    path = file.name\n  } else if (file instanceof Blob) {\n    path = ''\n  } else {\n    path = file\n  }\n  const queryIndex = path.lastIndexOf('?')\n  const query = queryIndex !== -1 ? path.substring(queryIndex) : ''\n  path = path.substring(0, queryIndex === -1 ? path.length : queryIndex)\n\n  const name = path.replace(/^.*[\\\\/]/, '')\n  let base = name.substring(0, name.lastIndexOf('.'))\n\n  const nameSplit = name.split('.')\n  let ext = nameSplit.length > 1 ? (nameSplit.pop() || '').toLowerCase() : ''\n\n  const protocolMatch = path.match(/^(.+):\\/\\/(.+)$/)\n  if (protocolMatch) {\n    protocol = protocolMatch[ 1 ].toLowerCase()\n    path = protocolMatch[ 2 ] || ''\n  }\n\n  const dir = path.substring(0, path.lastIndexOf('/') + 1)\n\n  if (compressedExtList.includes(ext)) {\n    compressed = ext\n    const n = path.length - ext.length - 1\n    ext = (path.substr(0, n).split('.').pop() || '').toLowerCase()\n    const m = base.length - ext.length - 1\n    base = base.substr(0, m)\n  } else {\n    compressed = false\n  }\n\n  return { path, name, ext, base, dir, compressed, protocol, query, 'src': file }\n}\n\nexport function getDataInfo (src: LoaderInput) {\n  let info = getFileInfo(src)\n  const datasource = DatasourceRegistry.get(info.protocol)\n  if (datasource) {\n    info = getFileInfo(datasource.getUrl(info.src))\n    if (!info.ext && datasource.getExt) {\n      info.ext = datasource.getExt(src)\n    }\n  }\n  return info\n}\n\n/**\n * Load a file\n *\n * @example\n * // load from URL\n * NGL.autoLoad( \"http://files.rcsb.org/download/5IOS.cif\" );\n *\n * @example\n * // load binary data in CCP4 format via a Blob\n * var binaryBlob = new Blob( [ ccp4Data ], { type: 'application/octet-binary'} );\n * NGL.autoLoad( binaryBlob, { ext: \"ccp4\" } );\n *\n * @example\n * // load string data in PDB format via a Blob\n * var stringBlob = new Blob( [ pdbData ], { type: 'text/plain'} );\n * NGL.autoLoad( stringBlob, { ext: \"pdb\" } );\n *\n * @example\n * // load a File object\n * NGL.autoLoad( file );\n *\n * @param  {String|File|Blob} file - either a URL or an object containing the file data\n * @param  {LoaderParameters} params - loading parameters\n * @return {Promise} Promise resolves to the loaded data\n */\nexport function autoLoad (file: LoaderInput, params: Partial<LoaderParameters> = {}) {\n  const p = Object.assign(getDataInfo(file), params)\n\n  let loader\n  if (ParserRegistry.names.includes(p.ext)) {\n    loader = new ParserLoader(p.src, p)\n  } else if (ScriptExtensions.includes(p.ext)) {\n    loader = new ScriptLoader(p.src, p)\n  }\n\n  if (loader) {\n    return loader.load()\n  } else {\n    return Promise.reject(new Error(`autoLoad: ext '${p.ext}' unknown`))\n  }\n}\n","/* global window, exports, define */\n\n!function() {\n    'use strict'\n\n    var re = {\n        not_string: /[^s]/,\n        not_bool: /[^t]/,\n        not_type: /[^T]/,\n        not_primitive: /[^v]/,\n        number: /[diefg]/,\n        numeric_arg: /[bcdiefguxX]/,\n        json: /[j]/,\n        not_json: /[^j]/,\n        text: /^[^\\x25]+/,\n        modulo: /^\\x25{2}/,\n        placeholder: /^\\x25(?:([1-9]\\d*)\\$|\\(([^)]+)\\))?(\\+)?(0|'[^$])?(-)?(\\d+)?(?:\\.(\\d+))?([b-gijostTuvxX])/,\n        key: /^([a-z_][a-z_\\d]*)/i,\n        key_access: /^\\.([a-z_][a-z_\\d]*)/i,\n        index_access: /^\\[(\\d+)\\]/,\n        sign: /^[+-]/\n    }\n\n    function sprintf(key) {\n        // `arguments` is not an array, but should be fine for this call\n        return sprintf_format(sprintf_parse(key), arguments)\n    }\n\n    function vsprintf(fmt, argv) {\n        return sprintf.apply(null, [fmt].concat(argv || []))\n    }\n\n    function sprintf_format(parse_tree, argv) {\n        var cursor = 1, tree_length = parse_tree.length, arg, output = '', i, k, ph, pad, pad_character, pad_length, is_positive, sign\n        for (i = 0; i < tree_length; i++) {\n            if (typeof parse_tree[i] === 'string') {\n                output += parse_tree[i]\n            }\n            else if (typeof parse_tree[i] === 'object') {\n                ph = parse_tree[i] // convenience purposes only\n                if (ph.keys) { // keyword argument\n                    arg = argv[cursor]\n                    for (k = 0; k < ph.keys.length; k++) {\n                        if (arg == undefined) {\n                            throw new Error(sprintf('[sprintf] Cannot access property \"%s\" of undefined value \"%s\"', ph.keys[k], ph.keys[k-1]))\n                        }\n                        arg = arg[ph.keys[k]]\n                    }\n                }\n                else if (ph.param_no) { // positional argument (explicit)\n                    arg = argv[ph.param_no]\n                }\n                else { // positional argument (implicit)\n                    arg = argv[cursor++]\n                }\n\n                if (re.not_type.test(ph.type) && re.not_primitive.test(ph.type) && arg instanceof Function) {\n                    arg = arg()\n                }\n\n                if (re.numeric_arg.test(ph.type) && (typeof arg !== 'number' && isNaN(arg))) {\n                    throw new TypeError(sprintf('[sprintf] expecting number but found %T', arg))\n                }\n\n                if (re.number.test(ph.type)) {\n                    is_positive = arg >= 0\n                }\n\n                switch (ph.type) {\n                    case 'b':\n                        arg = parseInt(arg, 10).toString(2)\n                        break\n                    case 'c':\n                        arg = String.fromCharCode(parseInt(arg, 10))\n                        break\n                    case 'd':\n                    case 'i':\n                        arg = parseInt(arg, 10)\n                        break\n                    case 'j':\n                        arg = JSON.stringify(arg, null, ph.width ? parseInt(ph.width) : 0)\n                        break\n                    case 'e':\n                        arg = ph.precision ? parseFloat(arg).toExponential(ph.precision) : parseFloat(arg).toExponential()\n                        break\n                    case 'f':\n                        arg = ph.precision ? parseFloat(arg).toFixed(ph.precision) : parseFloat(arg)\n                        break\n                    case 'g':\n                        arg = ph.precision ? String(Number(arg.toPrecision(ph.precision))) : parseFloat(arg)\n                        break\n                    case 'o':\n                        arg = (parseInt(arg, 10) >>> 0).toString(8)\n                        break\n                    case 's':\n                        arg = String(arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 't':\n                        arg = String(!!arg)\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'T':\n                        arg = Object.prototype.toString.call(arg).slice(8, -1).toLowerCase()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'u':\n                        arg = parseInt(arg, 10) >>> 0\n                        break\n                    case 'v':\n                        arg = arg.valueOf()\n                        arg = (ph.precision ? arg.substring(0, ph.precision) : arg)\n                        break\n                    case 'x':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16)\n                        break\n                    case 'X':\n                        arg = (parseInt(arg, 10) >>> 0).toString(16).toUpperCase()\n                        break\n                }\n                if (re.json.test(ph.type)) {\n                    output += arg\n                }\n                else {\n                    if (re.number.test(ph.type) && (!is_positive || ph.sign)) {\n                        sign = is_positive ? '+' : '-'\n                        arg = arg.toString().replace(re.sign, '')\n                    }\n                    else {\n                        sign = ''\n                    }\n                    pad_character = ph.pad_char ? ph.pad_char === '0' ? '0' : ph.pad_char.charAt(1) : ' '\n                    pad_length = ph.width - (sign + arg).length\n                    pad = ph.width ? (pad_length > 0 ? pad_character.repeat(pad_length) : '') : ''\n                    output += ph.align ? sign + arg + pad : (pad_character === '0' ? sign + pad + arg : pad + sign + arg)\n                }\n            }\n        }\n        return output\n    }\n\n    var sprintf_cache = Object.create(null)\n\n    function sprintf_parse(fmt) {\n        if (sprintf_cache[fmt]) {\n            return sprintf_cache[fmt]\n        }\n\n        var _fmt = fmt, match, parse_tree = [], arg_names = 0\n        while (_fmt) {\n            if ((match = re.text.exec(_fmt)) !== null) {\n                parse_tree.push(match[0])\n            }\n            else if ((match = re.modulo.exec(_fmt)) !== null) {\n                parse_tree.push('%')\n            }\n            else if ((match = re.placeholder.exec(_fmt)) !== null) {\n                if (match[2]) {\n                    arg_names |= 1\n                    var field_list = [], replacement_field = match[2], field_match = []\n                    if ((field_match = re.key.exec(replacement_field)) !== null) {\n                        field_list.push(field_match[1])\n                        while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {\n                            if ((field_match = re.key_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else if ((field_match = re.index_access.exec(replacement_field)) !== null) {\n                                field_list.push(field_match[1])\n                            }\n                            else {\n                                throw new SyntaxError('[sprintf] failed to parse named argument key')\n                            }\n                        }\n                    }\n                    else {\n                        throw new SyntaxError('[sprintf] failed to parse named argument key')\n                    }\n                    match[2] = field_list\n                }\n                else {\n                    arg_names |= 2\n                }\n                if (arg_names === 3) {\n                    throw new Error('[sprintf] mixing positional and named placeholders is not (yet) supported')\n                }\n\n                parse_tree.push(\n                    {\n                        placeholder: match[0],\n                        param_no:    match[1],\n                        keys:        match[2],\n                        sign:        match[3],\n                        pad_char:    match[4],\n                        align:       match[5],\n                        width:       match[6],\n                        precision:   match[7],\n                        type:        match[8]\n                    }\n                )\n            }\n            else {\n                throw new SyntaxError('[sprintf] unexpected placeholder')\n            }\n            _fmt = _fmt.substring(match[0].length)\n        }\n        return sprintf_cache[fmt] = parse_tree\n    }\n\n    /**\n     * export to either browser or node.js\n     */\n    /* eslint-disable quote-props */\n    if (typeof exports !== 'undefined') {\n        exports['sprintf'] = sprintf\n        exports['vsprintf'] = vsprintf\n    }\n    if (typeof window !== 'undefined') {\n        window['sprintf'] = sprintf\n        window['vsprintf'] = vsprintf\n\n        if (typeof define === 'function' && define['amd']) {\n            define(function() {\n                return {\n                    'sprintf': sprintf,\n                    'vsprintf': vsprintf\n                }\n            })\n        }\n    }\n    /* eslint-enable quote-props */\n}(); // eslint-disable-line\n","/**\n * @file Writer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults, download } from '../utils'\n\n/**\n * Base class for writers\n * @interface\n */\nabstract class Writer {\n  readonly mimeType: string\n  readonly defaultName: string\n  readonly defaultExt: string\n\n  /**\n   * @abstract\n   * @return {Anything} the data to be written\n   */\n  abstract getData (): any\n\n  /**\n   * Get a blob with the written data\n   * @return {Blob} the blob\n   */\n  getBlob () {\n    return new Blob([ this.getData() ], { type: this.mimeType })\n  }\n\n  /**\n   * Trigger a download of the\n   * @param  {[type]} name [description]\n   * @param  {[type]} ext  [description]\n   * @return {[type]}      [description]\n   */\n  download (name?: string, ext?: string) {\n    name = defaults(name, this.defaultName)\n    ext = defaults(ext, this.defaultExt)\n\n    download(this.getBlob(), `${name}.${ext}`)\n  }\n}\n\nexport default Writer","/**\n * @file Pdb Writer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { sprintf } from 'sprintf-js'\n\nimport Writer from './writer'\nimport { defaults, ensureArray } from '../utils'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// http://www.wwpdb.org/documentation/file-format\n\n// Sample PDB line, the coords X,Y,Z are fields 5,6,7 on each line.\n// ATOM      1  N   ARG     1      29.292  13.212 -12.751  1.00 33.78      1BPT 108\n\nconst AtomFormat =\n  'ATOM  %5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s'\n\nconst HetatmFormat =\n  'HETATM%5d %-4s %3s %1s%4d    %8.3f%8.3f%8.3f%6.2f%6.2f      %4s%2s%1s%1s'\n\nexport interface PdbWriterParams {\n  renumberSerial: boolean\n  remarks: string[]\n}\n\n/**\n * Create a PDB file from a Structure object\n */\nexport default class PdbWriter extends Writer {\n  readonly mimeType = 'text/plain'\n  readonly defaultName = 'structure'\n  readonly defaultExt = 'pdb'\n\n  renumberSerial: boolean\n  remarks: string[]\n\n  structure: Structure\n  private _records: string[]\n\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Object} params - parameters]\n   */\n  constructor (structure: Structure, params?: PdbWriterParams) {\n    super()\n\n    const p = Object.assign({}, params)\n\n    this.renumberSerial = defaults(p.renumberSerial, true)\n    this.remarks = ensureArray(defaults(p.remarks, []))\n\n    this.structure = structure\n    this._records = []\n  }\n\n  private _writeRecords () {\n    this._records.length = 0\n\n    this._writeTitle()\n    this._writeRemarks()\n    this._writeAtoms()\n  }\n\n  private _writeTitle () {\n    // FIXME multiline if title line longer than 80 chars\n    this._records.push(sprintf('TITLE %-74s', this.structure.name))\n  }\n\n  private _writeRemarks () {\n    this.remarks.forEach(str => {\n      this._records.push(sprintf('REMARK %-73s', str))\n    })\n\n    if (this.structure.trajectory) {\n      this._records.push(sprintf(\n        'REMARK %-73s',\n        \"Trajectory '\" + this.structure.trajectory.name + \"'\"\n      ))\n      this._records.push(sprintf(\n        'REMARK %-73s',\n        `Frame ${(this.structure.trajectory as any).frame}`  // TODO\n      ))\n    }\n  }\n\n  private _writeAtoms () {\n    let ia = 1\n    let im = 1\n    let charge = \" \"\n    let chargeSign = \" \"\n\n    this.structure.eachModel(m => {\n      this._records.push(sprintf('MODEL %-74d', im++))\n\n      m.eachAtom((a: AtomProxy) => {\n        const formatString = a.hetero ? HetatmFormat : AtomFormat\n        const serial = this.renumberSerial ? ia : a.serial\n\n        // Formal PDB spec\n        // Alignment of one-letter atom name such as C starts at column 14,\n        // while two-letter atom name such as FE starts at column 13.\n\n        // This, however, leaves Calcium and C-alpha ambiguous\n        // The convention (from earlier versions of the spec, see 1992, and also: \n        // https://www.cgl.ucsf.edu/chimera/docs/UsersGuide/tutorials/pdbintro.html#misalignment)\n        // is that element is right-justified in 13-14, modifiers are left justified in columns 15-16\n        // A single-character element symmbol should not appear in column 13 unless the atom name has four characters\n        let atomname = a.atomname\n\n        if (atomname.length === 1) {\n          // Simple case\n          atomname = ' ' + atomname\n        } else if (atomname.length < 4) {\n          // 2 or 3-letter name, if element symbol is single char and matches name, add a space\n          if (a.element.length === 1 && atomname[0] === a.element) {\n            atomname = ' ' + atomname\n          }\n        }\n\n        if (a.formalCharge) { // Skip nulls and zeros\n          charge = Math.abs(a.formalCharge).toPrecision(1)\n          chargeSign = (a.formalCharge > 0) ? \"+\" : \"-\"\n        } else {\n          charge = \" \"\n          chargeSign = \" \"\n        }\n\n        this._records.push(sprintf(\n          formatString,\n\n          serial,\n          atomname,\n          a.resname,\n          defaults(a.chainname, ' '),\n          a.resno,\n          a.x, a.y, a.z,\n          defaults(a.occupancy, 1.0),\n          defaults(a.bfactor, 0.0),\n          '',  // segid\n          defaults(a.element, ''),\n          charge,\n          chargeSign\n        ))\n        ia += 1\n      }, this.structure.getSelection())\n\n      this._records.push(sprintf('%-80s', 'ENDMDL'))\n      im += 1\n    })\n\n    this._records.push(sprintf('%-80s', 'END'))\n  }\n\n  getString () {\n    console.warn('PdbWriter.getString() is deprecated, use .getData instead')\n    return this.getData()\n  }\n\n  /**\n   * Get string containing the PDB file data\n   * @return {String} PDB file\n   */\n  getData () {\n    this._writeRecords()\n    return this._records.join('\\n')\n  }\n}\n","/**\n * Writer class for sdf/mol files.\n */\n\nimport { sprintf } from 'sprintf-js'\n\nimport Writer from './writer'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\nimport BondProxy from '../proxy/bond-proxy'\n\n// Hard-coded chiral as false as we don't specify it any atoms\nconst CountFormat = '%3i%3i  0  0  0  0  0  0  0  0999 V2000'\nconst AtomLine = '%10.4f%10.4f%10.4f %-3s 0%3i  0  0  0'\nconst BondFormat = '%3i%3i%3i  0  0  0'\n\nclass SdfWriter extends Writer {\n  readonly mimeType = 'text/plain'\n  readonly defaultName = 'structure'\n  readonly defaultExt = 'sdf'\n\n  structure: Structure\n  private _records: string[]\n\n  /**\n   * @param {Structure} structure - structure to write\n   * @param {Object} params - parameters\n   */\n  constructor (structure: Structure) {\n    super()\n\n    this.structure = structure\n    // Follow the pdb-writer example:\n    this._records = []\n  }\n\n  get idString () {\n    return this.structure.id\n  }\n\n  get titleString () {\n    return '  ' + this.structure.title\n  }\n\n  get countsString () {\n    return sprintf(\n      CountFormat,\n      this.structure.atomCount,\n      this.structure.bondCount\n      )\n  }\n\n  get chargeLines () {\n    const pairs: [number, number][] = []\n    this.structure.eachAtom(ap => {\n      if (ap.formalCharge != null && ap.formalCharge !== 0) {\n        pairs.push([ap.index, ap.formalCharge])\n      }\n    })\n    const lines = []\n    for (let i = 0; i < pairs.length; i += 8) {\n      const nCharges = Math.min(8, pairs.length - i)\n      let s = sprintf('M  CHG%3i', nCharges)\n      for (let j = i; j < i + nCharges; j++) {\n        s += sprintf(' %3i %3i', pairs[j][0] + 1, pairs[j][1])\n      }\n      lines.push(s)\n    }\n    return lines\n  }\n\n  formatAtom (ap: AtomProxy) {\n    let charge = 0\n    if (ap.formalCharge != null && ap.formalCharge !== 0) {\n      charge = 4 - ap.formalCharge\n    }\n    const line = sprintf(\n      AtomLine, ap.x, ap.y, ap.z, ap.element, charge\n    )\n    if (line.length !== 48) { throw new Error('Incompatible atom for sdf format') }\n\n    return line\n  }\n\n  formatBond (bp: BondProxy) {\n    return sprintf(\n      BondFormat,\n      bp.atomIndex1 + 1,\n      bp.atomIndex2 + 1,\n      bp.bondOrder)\n  }\n\n  _writeRecords () {\n    this._records.length = 0\n    this._writeHeader()\n    this._writeCTab()\n    this._writeFooter()\n  }\n\n  _writeHeader () {\n    this._records.push(this.idString, this.titleString, '')\n  }\n\n  _writeCTab () {\n    this._records.push(this.countsString)\n    this.structure.eachAtom(ap => {\n      this._records.push(this.formatAtom(ap))\n    })\n    this.structure.eachBond(bp => {\n      this._records.push(this.formatBond(bp))\n    })\n    this.chargeLines.forEach(line => {\n      this._records.push(line)\n    })\n    this._records.push('M  END')\n  }\n\n  _writeFooter () {\n    this._records.push('$$$$')\n  }\n\n  getData () {\n    this._writeRecords()\n    return this._records.join('\\n')\n  }\n}\n\nexport default SdfWriter\n","/**\n * @file IO Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n *\n * Adapted and converted to TypeScript from https://github.com/image-js/iobuffer\n * MIT License, Copyright (c) 2015 Michaël Zasso\n */\n\nimport { TypedArray } from '../types'\n\nconst defaultByteLength = 1024 * 8\nconst charArray: string[] = []\n\nexport interface IOBufferParameters {\n  offset?: number  // Ignore the first n bytes of the ArrayBuffer\n}\n\n/**\n * Class for writing and reading binary data\n */\nclass IOBuffer {\n  private _lastWrittenByte: number\n  private _mark = 0\n  private _marks: number[] = []\n  private _data: DataView\n\n  offset = 0  // The current offset of the buffer's pointer\n  littleEndian = true\n  buffer: ArrayBuffer  // Reference to the internal ArrayBuffer object\n  length: number  // Byte length of the internal ArrayBuffer\n  byteLength: number  // Byte length of the internal ArrayBuffer\n  byteOffset: number  // Byte offset of the internal ArrayBuffer\n\n  /**\n   * If it's a number, it will initialize the buffer with the number as\n   * the buffer's length. If it's undefined, it will initialize the buffer\n   * with a default length of 8 Kb. If its an ArrayBuffer, a TypedArray,\n   * it will create a view over the underlying ArrayBuffer.\n   */\n  constructor (data: number|ArrayBuffer|TypedArray, params: IOBufferParameters = {}) {\n    let dataIsGiven = false\n    if (data === undefined) {\n      data = defaultByteLength\n    }\n    if (typeof data === 'number') {\n      data = new ArrayBuffer(data)\n    } else {\n      dataIsGiven = true\n    }\n\n    const offset = params.offset ? params.offset >>> 0 : 0\n    let byteLength = data.byteLength - offset\n    let dvOffset = offset\n    if (!(data instanceof ArrayBuffer)) {\n      if (data.byteLength !== data.buffer.byteLength) {\n        dvOffset = data.byteOffset + offset\n      }\n      data = data.buffer\n    }\n    if (dataIsGiven) {\n      this._lastWrittenByte = byteLength\n    } else {\n      this._lastWrittenByte = 0\n    }\n\n    this.buffer = data\n    this.length = byteLength\n    this.byteLength = byteLength\n    this.byteOffset = dvOffset\n\n    this._data = new DataView(this.buffer, dvOffset, byteLength)\n  }\n\n  /**\n   * Checks if the memory allocated to the buffer is sufficient to store more bytes after the offset\n   * @param {number} [byteLength=1] The needed memory in bytes\n   * @return {boolean} Returns true if there is sufficient space and false otherwise\n   */\n  available (byteLength: number) {\n    if (byteLength === undefined) byteLength = 1\n    return (this.offset + byteLength) <= this.length\n  }\n\n  /**\n   * Check if little-endian mode is used for reading and writing multi-byte values\n   * @return {boolean} Returns true if little-endian mode is used, false otherwise\n   */\n  isLittleEndian () {\n    return this.littleEndian\n  }\n\n  /**\n   * Set little-endian mode for reading and writing multi-byte values\n   * @return {IOBuffer}\n   */\n  setLittleEndian () {\n    this.littleEndian = true\n    return this\n  }\n\n  /**\n   * Check if big-endian mode is used for reading and writing multi-byte values\n   * @return {boolean} Returns true if big-endian mode is used, false otherwise\n   */\n  isBigEndian () {\n    return !this.littleEndian\n  }\n\n  /**\n   * Switches to big-endian mode for reading and writing multi-byte values\n   * @return {IOBuffer}\n   */\n  setBigEndian () {\n    this.littleEndian = false\n    return this\n  }\n\n  /**\n   * Move the pointer n bytes forward\n   * @param {number} n\n   * @return {IOBuffer}\n   */\n  skip (n: number) {\n    if (n === undefined) n = 1\n    this.offset += n\n    return this\n  }\n\n  /**\n   * Move the pointer to the given offset\n   * @param {number} offset\n   * @return {IOBuffer}\n   */\n  seek (offset: number) {\n    this.offset = offset\n    return this\n  }\n\n  /**\n   * Store the current pointer offset.\n   * @see {@link IOBuffer#reset}\n   * @return {IOBuffer}\n   */\n  mark () {\n    this._mark = this.offset\n    return this\n  }\n\n  /**\n   * Move the pointer back to the last pointer offset set by mark\n   * @see {@link IOBuffer#mark}\n   * @return {IOBuffer}\n   */\n  reset () {\n    this.offset = this._mark\n    return this\n  }\n\n  /**\n   * Push the current pointer offset to the mark stack\n   * @see {@link IOBuffer#popMark}\n   * @return {IOBuffer}\n   */\n  pushMark () {\n    this._marks.push(this.offset)\n    return this\n  }\n\n  /**\n   * Pop the last pointer offset from the mark stack, and set the current pointer offset to the popped value\n   * @see {@link IOBuffer#pushMark}\n   * @return {IOBuffer}\n   */\n  popMark () {\n    const offset = this._marks.pop()\n    if (offset === undefined) throw new Error('Mark stack empty')\n    this.seek(offset)\n    return this\n  }\n\n  /**\n   * Move the pointer offset back to 0\n   * @return {IOBuffer}\n   */\n  rewind () {\n    this.offset = 0\n    return this\n  }\n\n  /**\n   * Make sure the buffer has sufficient memory to write a given byteLength at the current pointer offset\n   * If the buffer's memory is insufficient, this method will create a new buffer (a copy) with a length\n   * that is twice (byteLength + current offset)\n   * @param {number} [byteLength = 1]\n   * @return {IOBuffer}\n   */\n  ensureAvailable (byteLength: number) {\n    if (byteLength === undefined) byteLength = 1\n    if (!this.available(byteLength)) {\n      const lengthNeeded = this.offset + byteLength\n      const newLength = lengthNeeded * 2\n      const newArray = new Uint8Array(newLength)\n      newArray.set(new Uint8Array(this.buffer))\n      this.buffer = newArray.buffer\n      this.length = this.byteLength = newLength\n      this._data = new DataView(this.buffer)\n    }\n    return this\n  }\n\n  /**\n   * Read a byte and return false if the byte's value is 0, or true otherwise\n   * Moves pointer forward\n   * @return {boolean}\n   */\n  readBoolean () {\n    return this.readUint8() !== 0\n  }\n\n  /**\n   * Read a signed 8-bit integer and move pointer forward\n   * @return {number}\n   */\n  readInt8 () {\n    return this._data.getInt8(this.offset++)\n  }\n\n  /**\n   * Read an unsigned 8-bit integer and move pointer forward\n   * @return {number}\n   */\n  readUint8 () {\n    return this._data.getUint8(this.offset++)\n  }\n\n  /**\n   * Alias for {@link IOBuffer#readUint8}\n   * @return {number}\n   */\n  readByte () {\n    return this.readUint8()\n  }\n\n  /**\n   * Read n bytes and move pointer forward.\n   * @param {number} n\n   * @return {Uint8Array}\n   */\n  readBytes (n: number) {\n    if (n === undefined) n = 1\n    var bytes = new Uint8Array(n)\n    for (var i = 0; i < n; i++) {\n      bytes[i] = this.readByte()\n    }\n    return bytes\n  }\n\n  /**\n   * Read a 16-bit signed integer and move pointer forward\n   * @return {number}\n   */\n  readInt16 () {\n    var value = this._data.getInt16(this.offset, this.littleEndian)\n    this.offset += 2\n    return value\n  }\n\n  /**\n   * Read a 16-bit unsigned integer and move pointer forward\n   * @return {number}\n   */\n  readUint16 () {\n    var value = this._data.getUint16(this.offset, this.littleEndian)\n    this.offset += 2\n    return value\n  }\n\n  /**\n   * Read a 32-bit signed integer and move pointer forward\n   * @return {number}\n   */\n  readInt32 () {\n    var value = this._data.getInt32(this.offset, this.littleEndian)\n    this.offset += 4\n    return value\n  }\n\n  /**\n   * Read a 32-bit unsigned integer and move pointer forward\n   * @return {number}\n   */\n  readUint32 () {\n    var value = this._data.getUint32(this.offset, this.littleEndian)\n    this.offset += 4\n    return value\n  }\n\n  /**\n   * Read a 32-bit floating number and move pointer forward\n   * @return {number}\n   */\n  readFloat32 () {\n    var value = this._data.getFloat32(this.offset, this.littleEndian)\n    this.offset += 4\n    return value\n  }\n\n  /**\n   * Read a 64-bit floating number and move pointer forward\n   * @return {number}\n   */\n  readFloat64 () {\n    var value = this._data.getFloat64(this.offset, this.littleEndian)\n    this.offset += 8\n    return value\n  }\n\n  /**\n   * Read 1-byte ascii character and move pointer forward\n   * @return {string}\n   */\n  readChar () {\n    return String.fromCharCode(this.readInt8())\n  }\n\n  /**\n   * Read n 1-byte ascii characters and move pointer forward\n   * @param {number} n\n   * @return {string}\n   */\n  readChars (n = 1) {\n    charArray.length = n\n    for (var i = 0; i < n; i++) {\n      charArray[i] = this.readChar()\n    }\n    return charArray.join('')\n  }\n\n  /**\n   * Write 0xff if the passed value is truthy, 0x00 otherwise\n   * @param {any} value\n   * @return {IOBuffer}\n   */\n  writeBoolean (value = false) {\n    this.writeUint8(value ? 0xff : 0x00)\n    return this\n  }\n\n  /**\n   * Write value as an 8-bit signed integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeInt8 (value: number) {\n    this.ensureAvailable(1)\n    this._data.setInt8(this.offset++, value)\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write value as a 8-bit unsigned integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeUint8 (value: number) {\n    this.ensureAvailable(1)\n    this._data.setUint8(this.offset++, value)\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * An alias for {@link IOBuffer#writeUint8}\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeByte (value: number) {\n    return this.writeUint8(value)\n  }\n\n  /**\n   * Write bytes\n   * @param {Array|Uint8Array} bytes\n   * @return {IOBuffer}\n   */\n  writeBytes (bytes: number[]|Uint8Array) {\n    this.ensureAvailable(bytes.length)\n    for (var i = 0; i < bytes.length; i++) {\n      this._data.setUint8(this.offset++, bytes[i])\n    }\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write value as an 16-bit signed integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeInt16 (value: number) {\n    this.ensureAvailable(2)\n    this._data.setInt16(this.offset, value, this.littleEndian)\n    this.offset += 2\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write value as a 16-bit unsigned integer\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeUint16 (value: number) {\n    this.ensureAvailable(2)\n    this._data.setUint16(this.offset, value, this.littleEndian)\n    this.offset += 2\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 32-bit signed integer at the current pointer offset\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeInt32 (value: number) {\n    this.ensureAvailable(4)\n    this._data.setInt32(this.offset, value, this.littleEndian)\n    this.offset += 4\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 32-bit unsigned integer at the current pointer offset\n   * @param {number} value - The value to set\n   * @return {IOBuffer}\n   */\n  writeUint32 (value: number) {\n    this.ensureAvailable(4)\n    this._data.setUint32(this.offset, value, this.littleEndian)\n    this.offset += 4\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 32-bit floating number at the current pointer offset\n   * @param {number} value - The value to set\n   * @return {IOBuffer}\n   */\n  writeFloat32 (value: number) {\n    this.ensureAvailable(4)\n    this._data.setFloat32(this.offset, value, this.littleEndian)\n    this.offset += 4\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write a 64-bit floating number at the current pointer offset\n   * @param {number} value\n   * @return {IOBuffer}\n   */\n  writeFloat64 (value: number) {\n    this.ensureAvailable(8)\n    this._data.setFloat64(this.offset, value, this.littleEndian)\n    this.offset += 8\n    this._updateLastWrittenByte()\n    return this\n  }\n\n  /**\n   * Write the charCode of the passed string's first character to the current pointer offset\n   * @param {string} str - The character to set\n   * @return {IOBuffer}\n   */\n  writeChar (str: string) {\n    return this.writeUint8(str.charCodeAt(0))\n  }\n\n  /**\n   * Write the charCodes of the passed string's characters to the current pointer offset\n   * @param {string} str\n   * @return {IOBuffer}\n   */\n  writeChars (str: string) {\n    for (var i = 0; i < str.length; i++) {\n      this.writeUint8(str.charCodeAt(i))\n    }\n    return this\n  }\n\n  /**\n   * Export a Uint8Array view of the internal buffer.\n   * The view starts at the byte offset and its length\n   * is calculated to stop at the last written byte or the original length.\n   * @return {Uint8Array}\n   */\n  toArray () {\n    return new Uint8Array(this.buffer, this.byteOffset, this._lastWrittenByte)\n  }\n\n  /**\n   * Update the last written byte offset\n   * @private\n   */\n  _updateLastWrittenByte () {\n    if (this.offset > this._lastWrittenByte) {\n      this._lastWrittenByte = this.offset\n    }\n  }\n}\n\nexport default IOBuffer\n","/**\n * @file STL Writer\n * @author Paul Pillot <paul.pillot@cimf.ca>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport Writer from './writer'\nimport IOBuffer from '../utils/io-buffer'\nimport Surface from '../surface/surface'\n\n// https://en.wikipedia.org/wiki/STL_(file_format)#ASCII_STL\n\n/**\n * Create an STL File from a surface Object (e.g. for 3D printing)\n *\n * @example\n * molsurf = new MolecularSurface(structure)\n * surf = molsurf.getSurface({type: 'av', probeRadius: 1.4})\n * stl = new StlWriter(surf)\n * stl.download('myFileName')\n */\nexport default class StlWriter extends Writer {\n  readonly mimeType = 'application/vnd.ms-pki.stl'\n  readonly defaultName = 'surface'\n  readonly defaultExt = 'stl'\n\n  surface: any  // TODO\n\n  /**\n   * @param {Surface} surface - the surface to write out\n   */\n  constructor (surface: Surface) {\n    super()\n\n    this.surface = surface\n  }\n\n  /*\n   * Get STL Binary data\n   *\n   * Adapted from: https://github.com/mrdoob/three.js/blob/master/examples/js/exporters/STLBinaryExporter.js\n   * see https://en.wikipedia.org/wiki/STL_(file_format)#Binary_STL for the file format description\n   *\n   * @return {DataView} the data\n   */\n  getData () {\n    const triangles = this.surface.index.length / 3\n    const bufferLength = triangles * 2 + triangles * 3 * 4 * 4 + 80 + 4\n    const output = new IOBuffer(bufferLength)\n\n    output.skip(80)  // skip header\n    output.writeUint32(triangles)\n\n    const vector = new Vector3()\n    const vectorNorm1 = new Vector3()\n    const vectorNorm2 = new Vector3()\n    const vectorNorm3 = new Vector3()\n\n    // traversing vertices\n    for (let i = 0; i < triangles; i++) {\n      const indices = [\n        this.surface.index[i * 3],\n        this.surface.index[i * 3 + 1],\n        this.surface.index[i * 3 + 2]\n      ]\n\n      vectorNorm1.fromArray(this.surface.normal, indices[0] * 3)\n      vectorNorm2.fromArray(this.surface.normal, indices[1] * 3)\n      vectorNorm3.fromArray(this.surface.normal, indices[2] * 3)\n\n      vector.addVectors(vectorNorm1, vectorNorm2).add(vectorNorm3).normalize()\n\n      output.writeFloat32(vector.x)\n      output.writeFloat32(vector.y)\n      output.writeFloat32(vector.z)\n\n      for (let j = 0; j < 3; j++) {\n        vector.fromArray(this.surface.position, indices[j] * 3)\n\n        output.writeFloat32(vector.x)  // vertices\n        output.writeFloat32(vector.y)\n        output.writeFloat32(vector.z)\n      }\n\n      output.writeUint16(0)  // attribute byte count\n    }\n\n    return new DataView(output.buffer)\n  }\n}","/**\n * @file Counter\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log } from '../globals'\n\nimport * as signalsWrapper from 'signals'\n\n/**\n * {@link Signal}, dispatched when the `count` changes\n * @example\n * counter.signals.countChanged.add( function( delta ){ ... } );\n * @event Counter#countChanged\n * @type {Integer}\n */\n\nexport interface CounterSignals {\n  countChanged: signalsWrapper.Signal\n}\n\n/**\n * Counter class for keeping track of counts\n */\nclass Counter {\n  count = 0\n\n  signals: CounterSignals = {\n    countChanged: new signalsWrapper.Signal()\n  }\n\n  /**\n   * Set the `count` to zero\n   * @return {undefined}\n   */\n  clear () {\n    this.change(-this.count)\n  }\n\n  /**\n   * Change the `count`\n   * @fires Counter#countChanged\n   * @param {Integer} delta - count change\n   * @return {undefined}\n   */\n  change (delta: number) {\n    this.count += delta\n    this.signals.countChanged.dispatch(delta, this.count)\n\n    if (this.count < 0) {\n      Log.warn('Counter.count below zero', this.count)\n    }\n  }\n\n  /**\n   * Increments the `count` by one.\n   * @return {undefined}\n   */\n  increment () {\n    this.change(1)\n  }\n\n  /**\n   * Decrements the `count` by one.\n   * @return {undefined}\n   */\n  decrement () {\n    this.change(-1)\n  }\n\n  /**\n   * Listen to another counter object and change this `count` by the\n   * same amount\n   * @param  {Counter} counter - the counter object to listen to\n   * @return {undefined}\n   */\n  listen (counter: Counter) {\n    this.change(counter.count)\n    counter.signals.countChanged.add(this.change, this)\n  }\n\n  /**\n   * Stop listening to the other counter object\n   * @param  {Counter} counter - the counter object to stop listening to\n   * @return {undefined}\n   */\n  unlisten (counter: Counter) {\n    const countChanged = counter.signals.countChanged\n    if (countChanged.has(this.change, this)) {\n      countChanged.remove(this.change, this)\n    }\n  }\n\n  /**\n   * Invole the callback function once, when the `count` becomes zero\n   * @param  {Function} callback - the callback function\n   * @param  {Object}   context - the context for the callback function\n   * @return {undefined}\n   */\n  onZeroOnce (callback: () => void, context?: any) {\n    if (this.count === 0) {\n      callback.call(context)\n    } else {\n      const fn = () => {\n        if (this.count === 0) {\n          this.signals.countChanged.remove(fn, this)\n          callback.call(context)\n        }\n      }\n      this.signals.countChanged.add(fn, this)\n    }\n  }\n\n  dispose () {\n    this.clear()\n    this.signals.countChanged.dispose()\n  }\n}\n\nexport default Counter\n","/**\n * @file Stats\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport * as signalsWrapper from 'signals'\n\nexport default class Stats {\n  signals = {\n    updated: new signalsWrapper.Signal()\n  }\n\n  maxDuration = -Infinity\n  minDuration = Infinity\n  avgDuration = 14\n  lastDuration = Infinity\n\n  prevFpsTime = 0\n  lastFps = Infinity\n  lastFrames = 1\n  frames = 0\n  count = 0\n\n  startTime: number\n  currentTime: number\n\n  constructor () {\n    this.begin()\n  }\n\n  update () {\n    this.startTime = this.end()\n    this.currentTime = this.startTime\n    this.signals.updated.dispatch()\n  }\n\n  begin () {\n    this.startTime = window.performance.now()\n    this.lastFrames = this.frames\n  }\n\n  end () {\n    const time = window.performance.now()\n\n    this.count += 1\n    this.frames += 1\n\n    this.lastDuration = time - this.startTime\n    this.minDuration = Math.min(this.minDuration, this.lastDuration)\n    this.maxDuration = Math.max(this.maxDuration, this.lastDuration)\n    this.avgDuration -= this.avgDuration / 30\n    this.avgDuration += this.lastDuration / 30\n\n    if (time > this.prevFpsTime + 1000) {\n      this.lastFps = this.frames\n      this.prevFpsTime = time\n      this.frames = 0\n    }\n\n    return time\n  }\n}","/**\n * @file Shader Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ShaderChunk } from 'three'\n\nimport './chunk/fog_fragment.glsl'\nimport './chunk/interior_fragment.glsl'\nimport './chunk/matrix_scale.glsl'\nimport './chunk/nearclip_vertex.glsl'\nimport './chunk/nearclip_fragment.glsl'\nimport './chunk/opaque_back_fragment.glsl'\nimport './chunk/radiusclip_vertex.glsl'\nimport './chunk/radiusclip_fragment.glsl'\nimport './chunk/unpack_color.glsl'\n\nimport { ShaderRegistry } from '../globals'\n\nexport type ShaderDefine = (\n  'NEAR_CLIP'|'RADIUS_CLIP'|'PICKING'|'NOLIGHT'|'FLAT_SHADED'|'OPAQUE_BACK'|\n  'DIFFUSE_INTERIOR'|'USE_INTERIOR_COLOR'|\n  'USE_SIZEATTENUATION'|'USE_MAP'|'ALPHATEST'|'SDF'|'FIXED_SIZE'|\n  'CUBIC_INTERPOLATION'|'BSPLINE_FILTER'|'CATMULROM_FILTER'|'MITCHELL_FILTER'\n)\nexport type ShaderDefines = {\n  [k in ShaderDefine]?: number|string\n}\n\nfunction getDefines (defines: ShaderDefines) {\n  if (defines === undefined) return ''\n\n  const lines = []\n\n  for (const name in defines) {\n    const value = defines[ name as keyof ShaderDefines ]\n\n    if (!value) continue\n\n    lines.push(`#define ${name} ${value}`)\n  }\n\n  return lines.join('\\n') + '\\n'\n}\n\nconst reInclude = /^(?!\\/\\/)\\s*#include\\s+(\\S+)/gmi\nconst shaderCache: { [k: string]: string } = {}\n\nexport function getShader (name: string, defines: ShaderDefines = {}) {\n  let hash = name + '|'\n  for (const key in defines) {\n    hash += key + ':' + defines[ key as keyof ShaderDefines ]\n  }\n\n  if (!shaderCache[ hash ]) {\n    const definesText = getDefines(defines)\n\n    let shaderText = ShaderRegistry.get(`shader/${name}`) as string\n    if (!shaderText) {\n      throw new Error(`empty shader, '${name}'`)\n    }\n    shaderText = shaderText.replace(reInclude, function (match, p1) {\n      const path = `shader/chunk/${p1}.glsl`\n      const chunk = ShaderRegistry.get(path) || ShaderChunk[ p1 ]\n      if (!chunk) {\n        throw new Error(`empty chunk, '${p1}'`)\n      }\n      return chunk\n    })\n\n    shaderCache[ hash ] = definesText + shaderText\n  }\n\n  return shaderCache[ hash ]\n}\n","/**\n * @file Viewer Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug } from '../globals'\n\nif (typeof WebGLRenderingContext !== 'undefined') {\n  const wrcp = WebGLRenderingContext.prototype\n\n  // wrap WebGL debug function used by three.js and\n  // ignore calls to them when the debug flag is not set\n\n  const _getShaderParameter = wrcp.getShaderParameter\n  wrcp.getShaderParameter = function getShaderParameter (this: WebGLRenderingContext) {\n    if (Debug) {\n      return _getShaderParameter.apply(this, arguments)\n    } else {\n      return true\n    }\n  }\n\n  const _getShaderInfoLog = wrcp.getShaderInfoLog\n  wrcp.getShaderInfoLog = function getShaderInfoLog (this: WebGLRenderingContext) {\n    if (Debug) {\n      return _getShaderInfoLog.apply(this, arguments)\n    } else {\n      return ''\n    }\n  }\n\n  const _getProgramParameter = wrcp.getProgramParameter\n  wrcp.getProgramParameter = function getProgramParameter (this: WebGLRenderingContext, program, pname) {\n    if (Debug || pname !== wrcp.LINK_STATUS) {\n      return _getProgramParameter.apply(this, arguments)\n    } else {\n      return true\n    }\n  }\n\n  const _getProgramInfoLog = wrcp.getProgramInfoLog\n  wrcp.getProgramInfoLog = function getProgramInfoLog (this: WebGLRenderingContext) {\n    if (Debug) {\n      return _getProgramInfoLog.apply(this, arguments)\n    } else {\n      return ''\n    }\n  }\n}\n\nexport const JitterVectors = [\n  [\n    [ 0, 0 ]\n  ],\n  [\n    [ 4, 4 ], [ -4, -4 ]\n  ],\n  [\n    [ -2, -6 ], [ 6, -2 ], [ -6, 2 ], [ 2, 6 ]\n  ],\n  [\n    [ 1, -3 ], [ -1, 3 ], [ 5, 1 ], [ -3, -5 ],\n    [ -5, 5 ], [ -7, -1 ], [ 3, 7 ], [ 7, -7 ]\n  ],\n  [\n    [ 1, 1 ], [ -1, -3 ], [ -3, 2 ], [ 4, -1 ],\n    [ -5, -2 ], [ 2, 5 ], [ 5, 3 ], [ 3, -5 ],\n    [ -2, 6 ], [ 0, -7 ], [ -4, -6 ], [ -6, 4 ],\n    [ -8, 0 ], [ 7, -4 ], [ 6, 7 ], [ -7, -8 ]\n  ],\n  [\n    [ -4, -7 ], [ -7, -5 ], [ -3, -5 ], [ -5, -4 ],\n    [ -1, -4 ], [ -2, -2 ], [ -6, -1 ], [ -4, 0 ],\n    [ -7, 1 ], [ -1, 2 ], [ -6, 3 ], [ -3, 3 ],\n    [ -7, 6 ], [ -3, 6 ], [ -5, 7 ], [ -1, 7 ],\n    [ 5, -7 ], [ 1, -6 ], [ 6, -5 ], [ 4, -4 ],\n    [ 2, -3 ], [ 7, -2 ], [ 1, -1 ], [ 4, -1 ],\n    [ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],\n    [ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]\n  ]\n]\n\nJitterVectors.forEach(offsetList => {\n  offsetList.forEach(offset => {\n    // 0.0625 = 1 / 16\n    offset[ 0 ] *= 0.0625\n    offset[ 1 ] *= 0.0625\n  })\n})\n","/**\n * @file Tiled Renderer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { Camera, WebGLRenderer } from 'three'\nimport Viewer from './viewer'\n\nexport interface TiledRendererParams {\n  factor?: number\n  antialias?: boolean\n  onProgress?: Function\n  onFinish?: Function\n}\n\nclass TiledRenderer {\n  canvas = document.createElement('canvas')\n\n  private _width: number\n  private _height: number\n  private _n: number\n  private _factor: number\n  private _antialias: boolean\n  private _viewerSampleLevel: number\n\n  private _viewer: Viewer\n  private _onProgress?: Function\n  private _onFinish?: Function\n  private _ctx: CanvasRenderingContext2D\n\n  constructor(renderer: WebGLRenderer, camera: Camera, viewer: Viewer, params: TiledRendererParams) {\n    this._viewer = viewer\n\n    this._factor = defaults(params.factor, 2)\n    this._antialias = defaults(params.antialias, false)\n\n    this._onProgress = params.onProgress\n    this._onFinish = params.onFinish\n\n    if (this._antialias) this._factor *= 2\n    this._n = this._factor * this._factor\n\n    // canvas\n\n    this._width = this._viewer.width\n    this._height = this._viewer.height\n\n    if (this._antialias) {\n      this.canvas.width = this._width * this._factor / 2\n      this.canvas.height = this._height * this._factor / 2\n    } else {\n      this.canvas.width = this._width * this._factor\n      this.canvas.height = this._height * this._factor\n    }\n\n    this._ctx = this.canvas.getContext('2d')!\n\n    this._viewerSampleLevel = viewer.sampleLevel\n    this._viewer.setSampling(-1)\n  }\n\n  private _renderTile (i: number) {\n    const viewer = this._viewer\n    const width = this._width\n    const height = this._height\n    const factor = this._factor\n\n    const x = i % factor\n    const y = Math.floor(i / factor)\n\n    const offsetX = x * width\n    const offsetY = y * height\n\n    viewer.camera.setViewOffset(\n      width * factor,\n      height * factor,\n      offsetX,\n      offsetY,\n      width,\n      height\n    )\n\n    viewer.render()\n\n    if (this._antialias) {\n        const w = Math.round((offsetX + width) / 2) - Math.round (offsetX / 2);\n        const h = Math.round((offsetY + height) / 2) - Math.round (offsetY / 2);\n      this._ctx.drawImage(\n        viewer.renderer.domElement,\n        Math.round(offsetX / 2),\n        Math.round(offsetY / 2),\n        w,\n        h\n      )\n    } else {\n      this._ctx.drawImage(\n        viewer.renderer.domElement,\n        Math.floor(offsetX),\n        Math.floor(offsetY),\n        Math.ceil(width),\n        Math.ceil(height)\n      )\n    }\n\n    if (typeof this._onProgress === 'function') {\n      this._onProgress(i + 1, this._n, false)\n    }\n  }\n\n  private _finalize () {\n    this._viewer.setSampling(this._viewerSampleLevel)\n    this._viewer.camera.view = null!  // TODO\n\n    if (typeof this._onFinish === 'function') {\n      this._onFinish(this._n + 1, this._n, false)\n    }\n  }\n\n  render () {\n    for (let i = 0; i <= this._n; ++i) {\n      if (i === this._n) {\n        this._finalize()\n      } else {\n        this._renderTile(i)\n      }\n    }\n  }\n\n  renderAsync () {\n    let count = 0\n    const n = this._n\n\n    const fn = () => {\n      if (count === n) {\n        this._finalize()\n      } else {\n        this._renderTile(count)\n      }\n      count += 1\n    }\n\n    for (let i = 0; i <= n; ++i) {\n      setTimeout(fn, 0)\n    }\n  }\n}\n\nexport default TiledRenderer\n","/**\n * @file Math Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport const EPS = 0.0000001\nexport const TwoPI = 2 * Math.PI\n\nexport const DEG2RAD = Math.PI / 180\nexport const RAD2DEG = 180 / Math.PI\n","/**\n * @file Array Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { NumberArray } from '../types'\nimport { TwoPI } from './math-constants'\n\nexport function circularMean (array: NumberArray, max: number, stride = 1, offset = 0, indices?: NumberArray) {\n  // http://en.wikipedia.org/wiki/Center_of_mass#Systems_with_periodic_boundary_conditions\n\n  // Bai, Linge; Breen, David (2008). Calculating Center of Mass in an Unbounded 2D Environment. Journal of Graphics, GPU, and Game Tools 13 (4): 53–60.\n\n  // http://stackoverflow.com/questions/18166507/using-fft-to-find-the-center-of-mass-under-periodic-boundary-conditions\n\n  const n = indices ? indices.length : array.length / stride\n\n  let cosMean = 0\n  let sinMean = 0\n\n  if (indices) {\n    for (let i = 0; i < n; ++i) {\n      const c = (array[ indices[ i ] * stride + offset ] + max) % max\n      const angle = (c / max) * TwoPI - Math.PI\n\n      cosMean += Math.cos(angle)\n      sinMean += Math.sin(angle)\n    }\n  } else {\n    for (let i = offset; i < n; i += stride) {\n      const c = (array[ i ] + max) % max\n      const angle = (c / max) * TwoPI - Math.PI\n\n      cosMean += Math.cos(angle)\n      sinMean += Math.sin(angle)\n    }\n  }\n\n  cosMean /= n\n  sinMean /= n\n\n  const meanAngle = Math.atan2(sinMean, cosMean)\n  const mean = (meanAngle + Math.PI) / TwoPI * max\n\n  return mean\n}\n\nexport function calculateCenterArray <T extends NumberArray = Float32Array>(array1: NumberArray, array2: NumberArray, center?: T, offset = 0): T {\n  const n = array1.length\n  const c = center || new Float32Array(n)\n\n  for (let i = 0; i < n; i += 3) {\n    c[ offset + i + 0 ] = (array1[ i + 0 ] + array2[ i + 0 ]) / 2.0\n    c[ offset + i + 1 ] = (array1[ i + 1 ] + array2[ i + 1 ]) / 2.0\n    c[ offset + i + 2 ] = (array1[ i + 2 ] + array2[ i + 2 ]) / 2.0\n  }\n\n  return c as T\n}\n\nexport function calculateDirectionArray (array1: NumberArray, array2: NumberArray) {\n  const n = array1.length\n  const direction = new Float32Array(n)\n\n  for (let i = 0; i < n; i += 3) {\n    direction[ i + 0 ] = array2[ i + 0 ] - array1[ i + 0 ]\n    direction[ i + 1 ] = array2[ i + 1 ] - array1[ i + 1 ]\n    direction[ i + 2 ] = array2[ i + 2 ] - array1[ i + 2 ]\n  }\n\n  return direction\n}\n\nexport function uniformArray <T extends NumberArray = Float32Array>(n: number, a: number, optionalTarget?: T): T {\n  const array = optionalTarget || new Float32Array(n)\n\n  for (let i = 0; i < n; ++i) {\n    array[ i ] = a\n  }\n\n  return array as T\n}\n\nexport function uniformArray3 (n: number, a: number, b: number, c: number, optionalTarget?: NumberArray) {\n  const array = optionalTarget || new Float32Array(n * 3)\n\n  for (let i = 0; i < n; ++i) {\n    const j = i * 3\n\n    array[ j + 0 ] = a\n    array[ j + 1 ] = b\n    array[ j + 2 ] = c\n  }\n\n  return array\n}\n\nexport function centerArray3 (array: NumberArray, center = new Vector3()) {\n  const n = array.length\n\n  for (let i = 0; i < n; i += 3) {\n    center.x += array[ i ]\n    center.y += array[ i + 1 ]\n    center.z += array[ i + 2 ]\n  }\n\n  center.divideScalar(n / 3)\n\n  return center\n}\n\nexport function serialArray (n: number) {\n  const array = new Float32Array(n)\n\n  for (let i = 0; i < n; ++i) {\n    array[ i ] = i\n  }\n\n  return array\n}\n\nexport function serialBlockArray (n: number, b: number, offset = 0, optionalTarget?: NumberArray) {\n  const array = optionalTarget || new Float32Array(n * b)\n\n  for (let i = 0; i < n; ++i) {\n    const k = offset + i * b\n\n    for (let j = 0; j < b; ++j) {\n      array[ k + j ] = i\n    }\n  }\n\n  return array\n}\n\nexport function randomColorArray (n: number) {\n  const array = new Float32Array(n * 3)\n\n  for (let i = 0; i < n; ++i) {\n    const j = i * 3\n\n    array[ j + 0 ] = Math.random()\n    array[ j + 1 ] = Math.random()\n    array[ j + 2 ] = Math.random()\n  }\n\n  return array\n}\n\nexport function replicateArrayEntries (array: NumberArray, m: number) {\n  const n = array.length\n  const repArr = new Float32Array(n * m)\n\n  for (let i = 0; i < n; ++i) {\n    const k = i * m\n    const a = array[ i ]\n\n    for (let j = 0; j < m; ++j) {\n      repArr[ k + j ] = a\n    }\n  }\n\n  return repArr\n}\n\nexport function replicateArray3Entries (array: NumberArray, m: number) {\n  const n = array.length / 3\n  const repArr = new Float32Array(n * m * 3)\n\n  for (let i = 0; i < n; ++i) {\n    const v = i * 3\n    const k = i * m * 3\n\n    const a = array[ v + 0 ]\n    const b = array[ v + 1 ]\n    const c = array[ v + 2 ]\n\n    for (let j = 0; j < m; ++j) {\n      const l = k + j * 3\n\n      repArr[ l + 0 ] = a\n      repArr[ l + 1 ] = b\n      repArr[ l + 2 ] = c\n    }\n  }\n\n  return repArr\n}\n\nexport function calculateMeanArray (array1: NumberArray, array2: NumberArray) {\n  const n = array1.length\n  const mean = new Float32Array(n)\n\n  for (let i = 0; i < n; i++) {\n    mean[ i ] = (array1[ i ] + array2[ i ]) / 2.0\n  }\n\n  return mean\n}\n\nexport function calculateMinArray (array1: NumberArray, array2: NumberArray) {\n  const n = array1.length\n  const min = new Float32Array(n)\n\n  for (let i = 0; i < n; i++) {\n    min[ i ] = Math.min(array1[ i ], array2[ i ])\n  }\n\n  return min\n}\n\nexport function copyArray<T extends any[]|NumberArray> (src: T, dst: T, srcOffset: number, dstOffset: number, length: number) {\n  for (let i = 0; i < length; ++i) {\n    dst[ dstOffset + i ] = src[ srcOffset + i ]\n  }\n}\n\nexport function copyWithin (array: NumberArray|any[], srcOffset: number, dstOffset: number, length: number) {\n  copyArray(array, array, srcOffset, dstOffset, length)\n}\n\nconst swap = new Float32Array(4)\nconst temp = new Float32Array(4)\n/**\n * quicksortIP\n * @function\n * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013\n * @author I4DS http://www.fhnw.ch/i4ds, 2013\n * @license MIT License <http://www.opensource.org/licenses/mit-license.php>\n * @description\n * In-place quicksort for typed arrays (e.g. for Float32Array)\n * provides fast sorting\n * useful e.g. for a custom shader and/or BufferGeometry\n * Complexity: http://bigocheatsheet.com/ see Quicksort\n *\n * @example\n * points: [x, y, z, x, y, z, x, y, z, ...]\n * eleSize: 3 //because of (x, y, z)\n * orderElement: 0 //order according to x\n *\n * @param {TypedArray} arr - array to be sorted\n * @param {Integer} eleSize - element size\n * @param {Integer} orderElement - index of element used for sorting, < eleSize\n * @param {Integer} [begin] - start index for range to be sorted\n * @param {Integer} [end] - end index for range to be sorted\n * @return {TypedArray} the input array\n */\nexport function quicksortIP (arr: NumberArray, eleSize: number, orderElement: number, begin = 0, end?: number) {\n  end = (end || (arr.length / eleSize)) - 1\n\n  const stack = []\n  let sp = -1\n  let left = begin\n  let right = end\n  let tmp = 0.0\n  let x = 0\n  let y = 0\n\n  const swapF = function (a: number, b: number) {\n    a *= eleSize; b *= eleSize\n    for (y = 0; y < eleSize; y++) {\n      tmp = arr[ a + y ]\n      arr[ a + y ] = arr[ b + y ]\n      arr[ b + y ] = tmp\n    }\n  }\n\n  let i, j\n\n  while (true) {\n    if (right - left <= 25) {\n      for (j = left + 1; j <= right; j++) {\n        for (x = 0; x < eleSize; x++) {\n          swap[ x ] = arr[ j * eleSize + x ]\n        }\n\n        i = j - 1\n\n        while (i >= left && arr[ i * eleSize + orderElement ] > swap[ orderElement ]) {\n          for (x = 0; x < eleSize; x++) {\n            arr[ (i + 1) * eleSize + x ] = arr[ i * eleSize + x ]\n          }\n          i--\n        }\n\n        for (x = 0; x < eleSize; x++) {\n          arr[ (i + 1) * eleSize + x ] = swap[ x ]\n        }\n      }\n\n      if (sp === -1) break\n\n      right = stack[ sp-- ] // ?\n      left = stack[ sp-- ]\n    } else {\n      const median = (left + right) >> 1\n\n      i = left + 1\n      j = right\n\n      swapF(median, i)\n\n      if (arr[ left * eleSize + orderElement ] > arr[ right * eleSize + orderElement ]) {\n        swapF(left, right)\n      }\n\n      if (arr[ i * eleSize + orderElement ] > arr[ right * eleSize + orderElement ]) {\n        swapF(i, right)\n      }\n\n      if (arr[ left * eleSize + orderElement ] > arr[ i * eleSize + orderElement ]) {\n        swapF(left, i)\n      }\n\n      for (x = 0; x < eleSize; x++) {\n        temp[ x ] = arr[ i * eleSize + x ]\n      }\n\n      while (true) {\n        do i++; while (arr[ i * eleSize + orderElement ] < temp[ orderElement ])\n        do j--; while (arr[ j * eleSize + orderElement ] > temp[ orderElement ])\n        if (j < i) break\n        swapF(i, j)\n      }\n\n      for (x = 0; x < eleSize; x++) {\n        arr[ (left + 1) * eleSize + x ] = arr[ j * eleSize + x ]\n        arr[ j * eleSize + x ] = temp[ x ]\n      }\n\n      if (right - i + 1 >= j - left) {\n        stack[ ++sp ] = i\n        stack[ ++sp ] = right\n        right = j - 1\n      } else {\n        stack[ ++sp ] = left\n        stack[ ++sp ] = j - 1\n        left = i\n      }\n    }\n  }\n\n  return arr\n}\n\nexport function quicksortCmp<T> (arr: NumberArray|T[], cmp?: (a: number|T, b: number|T) => number, begin = 0, end?: number) {\n  cmp = cmp || function cmp (a, b) {\n    if (a > b) return 1\n    if (a < b) return -1\n    return 0\n  }\n  end = (end || arr.length) - 1\n\n  const stack = []\n  let sp = -1\n  let left = begin\n  let right = end\n  let tmp: number|T\n\n  function swap (a: number, b: number) {\n    const tmp2 = arr[ a ]\n    arr[ a ] = arr[ b ]\n    arr[ b ] = tmp2\n  }\n\n  let i, j\n\n  while (true) {\n    if (right - left <= 25) {\n      for (let k = left + 1; k <= right; ++k) {\n        tmp = arr[ k ]\n        i = k - 1\n\n        while (i >= left && cmp(arr[ i ], tmp) > 0) {\n          arr[ i + 1 ] = arr[ i ]\n          --i\n        }\n\n        arr[ i + 1 ] = tmp\n      }\n\n      if (sp === -1) break\n\n      right = stack[ sp-- ] // ?\n      left = stack[ sp-- ]\n    } else {\n      const median = (left + right) >> 1\n\n      i = left + 1\n      j = right\n\n      swap(median, i)\n\n      if (cmp(arr[ left ], arr[ right ]) > 0) {\n        swap(left, right)\n      }\n\n      if (cmp(arr[ i ], arr[ right ]) > 0) {\n        swap(i, right)\n      }\n\n      if (cmp(arr[ left ], arr[ i ]) > 0) {\n        swap(left, i)\n      }\n\n      tmp = arr[ i ]\n\n      while (true) {\n        do i++; while (cmp(arr[ i ], tmp) < 0)\n        do j--; while (cmp(arr[ j ], tmp) > 0)\n        if (j < i) break\n        swap(i, j)\n      }\n\n      arr[ left + 1 ] = arr[ j ]\n      arr[ j ] = tmp\n\n      if (right - i + 1 >= j - left) {\n        stack[ ++sp ] = i\n        stack[ ++sp ] = right\n        right = j - 1\n      } else {\n        stack[ ++sp ] = left\n        stack[ ++sp ] = j - 1\n        left = i\n      }\n    }\n  }\n\n  return arr\n}\n\nexport function quickselectCmp<T> (arr: NumberArray|T[], n: number, cmp?: (a: number|T, b: number|T) => number, left = 0, right?: number) {\n  cmp = cmp || function cmp (a, b) {\n    if (a > b) return 1\n    if (a < b) return -1\n    return 0\n  }\n  right = (right || arr.length) - 1\n\n  let pivotIndex, pivotValue, storeIndex\n\n  function swap (a: number, b: number) {\n    const tmp = arr[ a ]\n    arr[ a ] = arr[ b ]\n    arr[ b ] = tmp\n  }\n\n  while (true) {\n    if (left === right) {\n      return arr[ left ]\n    }\n    pivotIndex = (left + right) >> 1\n    pivotValue = arr[ pivotIndex ]\n    swap(pivotIndex, right)\n    storeIndex = left\n    for (let i = left; i < right; ++i) {\n      if (cmp(arr[ i ], pivotValue) < 0) {\n        swap(storeIndex, i)\n        ++storeIndex\n      }\n    }\n    swap(right, storeIndex)\n    pivotIndex = storeIndex\n    if (n === pivotIndex) {\n      return arr[ n ]\n    } else if (n < pivotIndex) {\n      right = pivotIndex - 1\n    } else {\n      left = pivotIndex + 1\n    }\n  }\n}\n\nexport function arrayMax (array: NumberArray) {\n  let max = -Infinity\n  for (let i = 0, il = array.length; i < il; ++i) {\n    if (array[ i ] > max) max = array[ i ]\n  }\n  return max\n}\n\nexport function arrayMin (array: NumberArray) {\n  let min = Infinity\n  for (let i = 0, il = array.length; i < il; ++i) {\n    if (array[ i ] < min) min = array[ i ]\n  }\n  return min\n}\n\nexport function arraySum (array: NumberArray, stride = 1, offset = 0) {\n  const n = array.length\n  let sum = 0\n  for (let i = offset; i < n; i += stride) {\n    sum += array[ i ]\n  }\n  return sum\n}\n\nexport function arrayMean (array: NumberArray, stride = 1, offset = 0) {\n  return arraySum(array, stride, offset) / (array.length / stride)\n}\n\nexport function arrayRms (array: NumberArray) {\n  const n = array.length\n  let sumSq = 0\n  for (let i = 0; i < n; ++i) {\n    const di = array[ i ]\n    sumSq += di * di\n  }\n  return Math.sqrt(sumSq / n)\n}\n\nexport function arraySorted (array: NumberArray) {\n  for (let i = 1, il = array.length; i < il; ++i) {\n    if (array[ i - 1 ] > array[ i ]) return false\n  }\n  return true\n}\n\nexport function arraySortedCmp<T> (array: NumberArray|T[], cmp: (a: number|T, b: number|T) => number) {\n  for (let i = 1, il = array.length; i < il; ++i) {\n    if (cmp(array[ i - 1 ], array[ i ]) > 0) return false\n  }\n  return true\n}\n","/**\n * @file Viewer Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n  Vector2, Vector3, Matrix4, Points, Scene, Camera,\n  Object3D, WebGLRenderer\n} from 'three'\n\nimport { createParams } from '../utils'\nimport TiledRenderer from './tiled-renderer'\nimport { quicksortCmp } from '../math/array-utils'\nimport Viewer from './viewer'\n\nfunction _trimCanvas (canvas: HTMLCanvasElement, r: number, g: number, b: number, a: number) {\n  const canvasHeight = canvas.height\n  const canvasWidth = canvas.width\n\n  const ctx = canvas.getContext('2d')!\n  const pixels = ctx.getImageData(0, 0, canvasWidth, canvasHeight).data\n\n  let x, y, doBreak, off\n\n  doBreak = false\n  for (y = 0; y < canvasHeight; y++) {\n    for (x = 0; x < canvasWidth; x++) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const topY = y\n\n  doBreak = false\n  for (x = 0; x < canvasWidth; x++) {\n    for (y = 0; y < canvasHeight; y++) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const topX = x\n\n  doBreak = false\n  for (y = canvasHeight - 1; y >= 0; y--) {\n    for (x = canvasWidth - 1; x >= 0; x--) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const bottomY = y\n\n  doBreak = false\n  for (x = canvasWidth - 1; x >= 0; x--) {\n    for (y = canvasHeight - 1; y >= 0; y--) {\n      off = (y * canvasWidth + x) * 4\n      if (pixels[ off ] !== r || pixels[ off + 1 ] !== g ||\n          pixels[ off + 2 ] !== b || pixels[ off + 3 ] !== a\n      ) {\n        doBreak = true\n        break\n      }\n    }\n    if (doBreak) {\n      break\n    }\n  }\n  const bottomX = x\n\n  const trimedCanvas = document.createElement('canvas')\n  trimedCanvas.width = bottomX - topX\n  trimedCanvas.height = bottomY - topY\n\n  const trimedCtx = trimedCanvas.getContext('2d')!\n  trimedCtx.drawImage(\n    canvas,\n    topX, topY,\n    trimedCanvas.width, trimedCanvas.height,\n    0, 0,\n    trimedCanvas.width, trimedCanvas.height\n  )\n\n  return trimedCanvas\n}\n\n/**\n * Image parameter object.\n * @typedef {Object} ImageParameters - image generation parameters\n * @property {Boolean} trim - trim the image\n * @property {Integer} factor - scaling factor to apply to the viewer canvas\n * @property {Boolean} antialias - antialias the image\n * @property {Boolean} transparent - transparent image background\n */\n\nexport const ImageDefaultParameters = {\n  trim: false,\n  factor: 1,\n  antialias: false,\n  transparent: false,\n  onProgress: undefined as Function|undefined\n}\nexport type ImageParameters = typeof ImageDefaultParameters\n\n/**\n * Make image from what is shown in a viewer canvas\n * @param  {Viewer} viewer - the viewer\n * @param  {ImageParameters} params - parameters object\n * @return {Promise} A Promise object that resolves to an image {@link Blob}.\n */\nexport function makeImage (viewer: Viewer, params: Partial<ImageParameters> = {}) {\n  const {trim, factor, antialias, transparent} = createParams(params, ImageDefaultParameters)\n\n  const renderer = viewer.renderer\n  const camera = viewer.camera\n\n  const originalClearAlpha = renderer.getClearAlpha()\n  const backgroundColor = renderer.getClearColor()\n\n  function setLineWidthAndPixelSize (invert = false) {\n    let _factor = factor\n    if (antialias) _factor *= 2\n    if (invert) _factor = 1 / _factor\n    viewer.scene.traverse(function (o: any) {  // TODO\n      const m = o.material\n      if (m && m.linewidth) {\n        m.linewidth *= _factor\n      }\n      if (m && m.uniforms && m.uniforms.size) {\n        if (m.uniforms.size.__seen === undefined) {\n          m.uniforms.size.value *= _factor\n          m.uniforms.size.__seen = true\n        }\n      }\n      if (m && m.uniforms && m.uniforms.linewidth) {\n        if (m.uniforms.linewidth.__seen === undefined) {\n          m.uniforms.linewidth.value *= _factor\n          m.uniforms.linewidth.__seen = true\n        }\n      }\n    })\n    viewer.scene.traverse(function (o: any) {  // TODO\n      const m = o.material\n      if (m && m.uniforms && m.uniforms.size) {\n        delete m.uniforms.size.__seen\n      }\n      if (m && m.uniforms && m.uniforms.linewidth) {\n        delete m.uniforms.linewidth.__seen\n      }\n    })\n  }\n\n  function trimCanvas (canvas: HTMLCanvasElement) {\n    if (trim) {\n      const bg = backgroundColor\n      const r = transparent ? 0 : bg.r * 255\n      const g = transparent ? 0 : bg.g * 255\n      const b = transparent ? 0 : bg.b * 255\n      const a = transparent ? 0 : 255\n      return _trimCanvas(canvas, r, g, b, a)\n    } else {\n      return canvas\n    }\n  }\n\n  function onProgress (i: number, n: number, finished: boolean) {\n    if (typeof params.onProgress === 'function') {\n      params.onProgress(i, n, finished)\n    }\n  }\n\n  return new Promise<Blob>(function (resolve, reject) {\n    const tiledRenderer = new TiledRenderer(\n      renderer, camera, viewer,\n      { factor, antialias, onProgress, onFinish }\n    )\n\n    renderer.setClearAlpha(transparent ? 0 : 1)\n    setLineWidthAndPixelSize()\n    tiledRenderer.renderAsync()\n\n    function onFinish (i: number, n: number) {\n      const canvas = trimCanvas(tiledRenderer.canvas)\n      canvas.toBlob(\n        function (blob) {\n          renderer.setClearAlpha(originalClearAlpha)\n          setLineWidthAndPixelSize(true)\n          viewer.requestRender()\n          onProgress(n, n, true)\n          if (blob) {\n            resolve(blob)\n          } else {\n            reject('error creating image')\n          }\n        },\n        'image/png'\n      )\n    }\n  })\n}\n\nconst vertex = new Vector3()\nconst matrix = new Matrix4()\nconst modelViewProjectionMatrix = new Matrix4()\n\nexport function sortProjectedPosition (scene: Scene, camera: Camera) {\n  // console.time( \"sort\" );\n\n  scene.traverseVisible(function (o) {\n    if (!(o instanceof Points) || !o.userData.buffer.parameters.sortParticles) {\n      return\n    }\n\n    const attributes = (o.geometry as any).attributes  // TODO\n    const n = attributes.position.count\n\n    if (n === 0) return\n\n    matrix.multiplyMatrices(\n      camera.matrixWorldInverse, o.matrixWorld\n    )\n    modelViewProjectionMatrix.multiplyMatrices(\n      camera.projectionMatrix, matrix\n    )\n\n    let sortData, sortArray, zArray: Float32Array, cmpFn\n\n    if (!o.userData.sortData) {\n      zArray = new Float32Array(n)\n      sortArray = new Uint32Array(n)\n      cmpFn = function (ai: number, bi: number) {\n        const a = zArray[ ai ]\n        const b = zArray[ bi ]\n        if (a > b) return 1\n        if (a < b) return -1\n        return 0\n      }\n\n      sortData = {\n        __zArray: zArray,\n        __sortArray: sortArray,\n        __cmpFn: cmpFn\n      }\n\n      o.userData.sortData = sortData\n    } else {\n      sortData = o.userData.sortData\n      zArray = sortData.__zArray\n      sortArray = sortData.__sortArray\n      cmpFn = sortData.__cmpFn\n    }\n\n    for (let i = 0; i < n; ++i) {\n      vertex.fromArray(attributes.position.array, i * 3)\n      vertex.applyMatrix4(modelViewProjectionMatrix)\n\n      // negate, so that sorting order is reversed\n      zArray[ i ] = -vertex.z\n      sortArray[ i ] = i\n    }\n\n    quicksortCmp(sortArray, cmpFn)\n\n    let index, indexSrc, indexDst, tmpTab\n\n    for (let name in attributes) {\n      const attr = attributes[ name ]\n      const array = attr.array\n      const itemSize = attr.itemSize\n\n      if (!sortData[ name ]) {\n        sortData[ name ] = new Float32Array(itemSize * n)\n      }\n\n      tmpTab = sortData[ name ]\n      sortData[ name ] = array\n\n      for (let i = 0; i < n; ++i) {\n        index = sortArray[ i ]\n\n        for (let j = 0; j < itemSize; ++j) {\n          indexSrc = index * itemSize + j\n          indexDst = i * itemSize + j\n          tmpTab[ indexDst ] = array[ indexSrc ]\n        }\n      }\n\n      attributes[ name ].array = tmpTab\n      attributes[ name ].needsUpdate = true\n    }\n  })\n\n    // console.timeEnd( \"sort\" );\n}\n\nconst resolution = new Vector2()\nconst projectionMatrixInverse = new Matrix4()\nconst projectionMatrixTranspose = new Matrix4()\n\nexport function updateMaterialUniforms (group: Object3D, camera: Camera, renderer: WebGLRenderer, cDist: number, bRadius: number) {\n  let size = new Vector2()\n  renderer.getSize(size)\n  const canvasHeight = size.height\n  const pixelRatio = renderer.getPixelRatio()\n  const ortho = camera.type === 'OrthographicCamera'\n\n  resolution.set(size.width, size.height)\n  projectionMatrixInverse.getInverse(camera.projectionMatrix)\n  projectionMatrixTranspose.copy(camera.projectionMatrix).transpose()\n\n  group.traverse(function (o: any) {\n    const m = o.material\n    if (!m) return\n\n    const u = m.uniforms\n    if (!u) return\n\n    if (m.clipNear) {\n      const nearFactor = (50 - m.clipNear) / 50\n      const nearClip = cDist - (bRadius * nearFactor)\n      u.clipNear.value = nearClip\n    }\n\n    if (u.canvasHeight) {\n      u.canvasHeight.value = canvasHeight\n    }\n\n    if (u.resolution) {\n      u.resolution.value.copy(resolution)\n    }\n\n    if (u.pixelRatio) {\n      u.pixelRatio.value = pixelRatio\n    }\n\n    if (u.projectionMatrixInverse) {\n      u.projectionMatrixInverse.value.copy(projectionMatrixInverse)\n    }\n\n    if (u.projectionMatrixTranspose) {\n      u.projectionMatrixTranspose.value.copy(projectionMatrixTranspose)\n    }\n\n    if (u.ortho) {\n      u.ortho.value = ortho\n    }\n  })\n}\n\nexport function updateCameraUniforms (group: Object3D, camera: Camera) {\n  projectionMatrixInverse.getInverse(camera.projectionMatrix)\n  projectionMatrixTranspose.copy(camera.projectionMatrix).transpose()\n\n  group.traverse(function (o: any) {\n    const m = o.material\n    if (!m) return\n\n    const u = m.uniforms\n    if (!u) return\n\n    if (u.projectionMatrixInverse) {\n      u.projectionMatrixInverse.value.copy(projectionMatrixInverse)\n    }\n\n    if (u.projectionMatrixTranspose) {\n      u.projectionMatrixTranspose.value.copy(projectionMatrixTranspose)\n    }\n  })\n}\n","/**\n * @file Viewer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// adapted from https://webglfundamentals.org/webgl/resources/webgl-utils.js\n// Copyright 2012, Gregg Tavares. Modified BSD License\n\nexport function createProgram(gl: WebGLRenderingContext, shaders: WebGLShader[], attribs?: string[], locations?: number[]) {\n  const program = gl.createProgram()\n  if (!program) {\n    console.log(`error creating WebGL program`)\n    return\n  }\n  shaders.forEach(shader => gl.attachShader(program, shader))\n  if (attribs) {\n    attribs.forEach((attrib, i) => {\n      gl.bindAttribLocation(program, locations ? locations[i] : i, attrib)\n    })\n  }\n  gl.linkProgram(program);\n\n  // Check the link status\n  const linked = gl.getProgramParameter(program, gl.LINK_STATUS)\n  if (!linked) {\n      console.log(`error linking program: ${gl.getProgramInfoLog(program)}`)\n      gl.deleteProgram(program)\n      return null\n  }\n  return program\n}\n\nexport function loadShader(gl: WebGLRenderingContext, shaderSource: string, shaderType: number) {\n  const shader = gl.createShader(shaderType)\n  if (!shader) {\n    console.log(`error creating WebGL shader ${shaderType}`)\n    return                      // can't create shader\n  }\n  gl.shaderSource(shader, shaderSource)\n  gl.compileShader(shader)\n\n  // Check the compile status\n  const compiled = gl.getShaderParameter(shader, gl.COMPILE_STATUS)\n  if (!compiled) {\n    console.log(`error compiling shader ${shader}: ${gl.getShaderInfoLog(shader)}`)\n    gl.deleteShader(shader)\n    return null\n  }\n\n  return shader\n}\n\n//\n\nexport function getErrorDescription(gl: WebGLRenderingContext, error: number) {\n  switch (error) {\n    case gl.NO_ERROR: return 'no error'\n    case gl.INVALID_ENUM: return 'invalid enum'\n    case gl.INVALID_VALUE: return 'invalid value'\n    case gl.INVALID_OPERATION: return 'invalid operation'\n    case gl.INVALID_FRAMEBUFFER_OPERATION: return 'invalid framebuffer operation'\n    case gl.OUT_OF_MEMORY: return 'out of memory'\n    case gl.CONTEXT_LOST_WEBGL: return 'context lost'\n  }\n  return 'unknown error'\n}\n\nexport function getExtension (gl: WebGLRenderingContext, name: string) {\n   const ext = gl.getExtension(name)\n   if (!ext) console.log(`extension '${name}' not available`)\n   return ext\n}\n\nconst TextureTestVertShader = `\nattribute vec4 a_position;\n\nvoid main() {\n  gl_Position = a_position;\n}`\n\nconst TextureTestFragShader = `\nprecision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;\n}`\n\nconst TextureTestTexCoords = new Float32Array([\n  -1.0, -1.0, 1.0, -1.0, -1.0,  1.0, -1.0,  1.0, 1.0, -1.0, 1.0,  1.0\n])\n\nexport function testTextureSupport (type: number) {\n  // adapted from\n  // https://stackoverflow.com/questions/28827511/webgl-ios-render-to-floating-point-texture\n\n  // Get A WebGL context\n  const canvas = document.createElement('canvas')\n  canvas.width = 16\n  canvas.height = 16\n  canvas.style.width = 16 + 'px'\n  canvas.style.height = 16 + 'px'\n  const gl = canvas.getContext(\"webgl\") || canvas.getContext(\"experimental-webgl\");\n  if (!gl) {\n    console.log(`error creating webgl context for ${type}`)\n    return false\n  }\n  if (!(gl instanceof WebGLRenderingContext)) {\n    console.log(`Got unexpected type for WebGL rendering context`)\n    return false\n  }\n\n  getExtension(gl, 'OES_texture_float')\n  getExtension(gl, 'OES_texture_half_float')\n  getExtension(gl, 'WEBGL_color_buffer_float')\n\n  // setup shaders\n  const vertShader = loadShader(gl, TextureTestVertShader, gl.VERTEX_SHADER)\n  const fragShader = loadShader(gl, TextureTestFragShader, gl.FRAGMENT_SHADER)\n  if (!vertShader || !fragShader) return false\n\n  // setup program\n  const program = createProgram(gl, [ vertShader, fragShader ])\n  if (!program) {\n    console.log(`error creating WebGL program`)\n    return false\n  }\n  gl.useProgram(program);\n\n  // look up where the vertex data needs to go.\n  const positionLocation = gl.getAttribLocation(program, \"a_position\");\n  const colorLoc = gl.getUniformLocation(program, \"u_color\");\n  if (!colorLoc) {\n    console.log(`error getting 'u_color' uniform location`)\n    return false\n  }\n\n  // provide texture coordinates for the rectangle.\n  const positionBuffer = gl.createBuffer()\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer)\n  gl.bufferData(gl.ARRAY_BUFFER, TextureTestTexCoords, gl.STATIC_DRAW)\n  gl.enableVertexAttribArray(positionLocation)\n  gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0)\n\n  const whiteTex = gl.createTexture()\n  const whiteData = new Uint8Array([255, 255, 255, 255])\n  gl.bindTexture(gl.TEXTURE_2D, whiteTex)\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, whiteData)\n\n  const tex = gl.createTexture()\n  gl.bindTexture(gl.TEXTURE_2D, tex)\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, type, null)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n\n  const fb = gl.createFramebuffer()\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb)\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, tex, 0)\n  const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER)\n  if (status !== gl.FRAMEBUFFER_COMPLETE) {\n    console.log(`error creating framebuffer for ${type}`)\n    return false\n  }\n\n  // Draw the rectangle.\n  gl.bindTexture(gl.TEXTURE_2D, whiteTex)\n  gl.uniform4fv(colorLoc, [0, 10, 20, 1])\n  gl.drawArrays(gl.TRIANGLES, 0, 6)\n\n  gl.bindTexture(gl.TEXTURE_2D, tex)\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null)\n  gl.clearColor(1, 0, 0, 1)\n  gl.clear(gl.COLOR_BUFFER_BIT)\n  gl.uniform4fv(colorLoc, [0, 1/10, 1/20, 1])\n  gl.drawArrays(gl.TRIANGLES, 0, 6)\n\n  // Check if rendered correctly\n  const pixel = new Uint8Array(4)\n  gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel)\n  if (pixel[0] !== 0 || pixel[1] < 248 || pixel[2] < 248 || pixel[3] < 254) {\n    console.log(`not able to actually render to ${type} texture`)\n    return false\n  }\n\n  // Check reading from float texture\n  if (type === gl.FLOAT) {\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fb)\n    const floatPixel = new Float32Array(4)\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.FLOAT, floatPixel)\n    const error = gl.getError()\n    if (error) {\n      console.log(`error reading pixels as float: '${getErrorDescription(gl, error)}'`)\n      return false\n    }\n  }\n\n  return true\n}\n","/**\n * @file Viewer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\nimport {\n  PerspectiveCamera, OrthographicCamera, StereoCamera,\n  Vector2, Box3, Vector3, Matrix4, Color,\n  WebGLRenderer, WebGLRenderTarget,\n  NearestFilter, LinearFilter, AdditiveBlending,\n  RGBAFormat, FloatType, /*HalfFloatType, */UnsignedByteType,\n  ShaderMaterial,\n  PlaneGeometry, Geometry,\n  Scene, Mesh, Group, Object3D, Uniform,\n  Fog, SpotLight, AmbientLight,\n  BufferGeometry, BufferAttribute,\n  LineSegments,\n  LinearEncoding, sRGBEncoding, TextureEncoding\n} from 'three'\nimport '../shader/BasicLine.vert'\nimport '../shader/BasicLine.frag'\nimport '../shader/Quad.vert'\nimport '../shader/Quad.frag'\n\nimport {\n  Debug, Log, WebglErrorMessage, Browser,\n  setExtensionFragDepth, SupportsReadPixelsFloat, setSupportsReadPixelsFloat\n} from '../globals'\nimport { degToRad } from '../math/math-utils'\nimport Stats from './stats'\nimport { getShader } from '../shader/shader-utils'\nimport { setColorSpace } from '../color/colormaker'\nimport { JitterVectors } from './viewer-constants'\nimport {\n  makeImage, ImageParameters,\n  sortProjectedPosition, updateMaterialUniforms, updateCameraUniforms\n} from './viewer-utils'\nimport { testTextureSupport } from './gl-utils'\n\nimport Buffer from '../buffer/buffer'\n\nconst pixelBufferFloat = new Float32Array(4 * 25)\nconst pixelBufferUint = new Uint8Array(4 * 25)\n\n// When picking, we read a 25 pixel (5x5) array (readRenderTargetPixels)\n// We read the pixels in the order below to find what was picked.\n// This starts at the center and tries successively further points.\n// (Many points will be at equal distance to the center, their order\n// is arbitrary).\nconst pixelOrder = [12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20]\n\n\nconst tmpMatrix = new Matrix4()\n\nfunction onBeforeRender (this: Object3D, renderer: WebGLRenderer, scene: Scene, camera: PerspectiveCamera|OrthographicCamera, geometry: Geometry, material: ShaderMaterial/*, group */) {\n  const u = material.uniforms\n  const updateList = []\n\n  if (!u) return  // See #908 - some materials may not have uniforms, ignore these\n\n  if (u.objectId) {\n    u.objectId.value = SupportsReadPixelsFloat ? this.id : this.id / 255\n    updateList.push('objectId')\n  }\n\n  if (u.modelViewMatrixInverse || u.modelViewMatrixInverseTranspose ||\n      u.modelViewProjectionMatrix || u.modelViewProjectionMatrixInverse\n  ) {\n    this.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse, this.matrixWorld)\n  }\n\n  if (u.modelViewMatrixInverse) {\n    u.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix)\n    updateList.push('modelViewMatrixInverse')\n  }\n\n  if (u.modelViewMatrixInverseTranspose) {\n    if (u.modelViewMatrixInverse) {\n      u.modelViewMatrixInverseTranspose.value.copy(\n        u.modelViewMatrixInverse.value\n      ).transpose()\n    } else {\n      u.modelViewMatrixInverseTranspose.value\n        .getInverse(this.modelViewMatrix)\n        .transpose()\n    }\n    updateList.push('modelViewMatrixInverseTranspose')\n  }\n\n  if (u.modelViewProjectionMatrix) {\n    u.modelViewProjectionMatrix.value.multiplyMatrices(\n      camera.projectionMatrix, this.modelViewMatrix\n    )\n    updateList.push('modelViewProjectionMatrix')\n  }\n\n  if (u.modelViewProjectionMatrixInverse) {\n    if (u.modelViewProjectionMatrix) {\n      tmpMatrix.copy(\n        u.modelViewProjectionMatrix.value\n      )\n      u.modelViewProjectionMatrixInverse.value.getInverse(\n        tmpMatrix\n      )\n    } else {\n      tmpMatrix.multiplyMatrices(\n        camera.projectionMatrix, this.modelViewMatrix\n      )\n      u.modelViewProjectionMatrixInverse.value.getInverse(\n        tmpMatrix\n      )\n    }\n    updateList.push('modelViewProjectionMatrixInverse')\n  }\n\n  if (updateList.length) {\n    const materialProperties = renderer.properties.get(material)\n\n    if (materialProperties.program) {\n      const gl = renderer.getContext()\n      const p = materialProperties.program\n      gl.useProgram(p.program)\n      const pu = p.getUniforms()\n\n      updateList.forEach(function (name) {\n        pu.setValue(gl, name, u[ name ].value)\n      })\n    }\n  }\n}\n\nexport type CameraType = 'perspective'|'orthographic'|'stereo'\nexport type ColorWorkflow = 'linear' | 'sRGB'\n\nexport interface ViewerSignals {\n  ticked: Signal,\n  rendered: Signal\n}\n\nexport interface ViewerParameters {\n  fogColor: Color\n  fogNear: number\n  fogFar: number\n\n  backgroundColor: Color\n\n  cameraType: CameraType\n  cameraFov: number\n  cameraEyeSep: number\n  cameraZ: number\n\n  clipNear: number\n  clipFar: number\n  clipDist: number\n  clipMode: string               // \"scene\" or \"camera\"\n  clipScale: string              // \"relative\" or \"absolute\"\n\n  lightColor: Color\n  lightIntensity: number\n  ambientColor: Color\n  ambientIntensity: number\n\n  sampleLevel: number\n\n  rendererEncoding: TextureEncoding // default is three.LinearEncoding; three.sRGBEncoding gives more correct results\n}\n\nexport interface BufferInstance {\n  matrix: Matrix4\n}\n\n/**\n * Viewer class\n * @class\n * @param {String|Element} [idOrElement] - dom id or element\n */\nexport default class Viewer {\n  signals: ViewerSignals\n\n  container: HTMLElement\n  wrapper: HTMLElement\n\n  private rendering: boolean\n  private renderPending: boolean\n  private lastRenderedPicking: boolean\n  private isStill: boolean\n  private frameRequest: number\n\n  sampleLevel: number\n  private cDist: number\n  private bRadius: number\n\n  private parameters: ViewerParameters\n  stats: Stats\n\n  perspectiveCamera: PerspectiveCamera\n  private orthographicCamera: OrthographicCamera\n  private stereoCamera: StereoCamera\n  camera: PerspectiveCamera|OrthographicCamera\n\n  width: number\n  height: number\n\n  scene: Scene\n  private spotLight: SpotLight\n  private ambientLight: AmbientLight\n  rotationGroup: Group\n  translationGroup: Group\n  private modelGroup: Group\n  private pickingGroup: Group\n  private backgroundGroup: Group\n  private helperGroup: Group\n\n  renderer: WebGLRenderer\n  private supportsHalfFloat: boolean\n\n  private pickingTarget: WebGLRenderTarget\n  private sampleTarget: WebGLRenderTarget\n  private holdTarget: WebGLRenderTarget\n\n  private compositeUniforms: {\n    tForeground: Uniform\n    scale: Uniform\n  }\n  private compositeMaterial: ShaderMaterial\n  private compositeCamera: OrthographicCamera\n  private compositeScene: Scene\n\n  private boundingBoxMesh: LineSegments\n  boundingBox = new Box3()\n  private boundingBoxSize = new Vector3()\n  private boundingBoxLength = 0\n\n  private info = {\n    memory: {\n      programs: 0,\n      geometries: 0,\n      textures: 0\n    },\n    render: {\n      calls: 0,\n      vertices: 0,\n      faces: 0,\n      points: 0\n    }\n  }\n\n  private distVector = new Vector3()\n\n  constructor (idOrElement: string|HTMLElement) {\n    this.signals = {\n      ticked: new Signal(),\n      rendered: new Signal()\n    }\n\n    if (typeof idOrElement === 'string') {\n      const elm = document.getElementById(idOrElement)\n      if (elm === null) {\n        this.container = document.createElement('div')\n      }else {\n        this.container = elm\n      }\n    } else if (idOrElement instanceof HTMLElement) {\n      this.container = idOrElement\n    } else {\n      this.container = document.createElement('div')\n    }\n\n    if (this.container === document.body) {\n      this.width = window.innerWidth || 1\n      this.height = window.innerHeight || 1\n    } else {\n      const box = this.container.getBoundingClientRect()\n      this.width = box.width || 1\n      this.height = box.height || 1\n      this.container.style.overflow = 'hidden'\n    }\n\n    this.wrapper = document.createElement('div')\n    this.wrapper.style.position = 'relative'\n    this.container.appendChild(this.wrapper)\n\n    this._initParams()\n    this._initStats()\n    this._initCamera()\n    this._initScene()\n\n    if (this._initRenderer() === false) {\n      Log.error('Viewer: could not initialize renderer')\n      return\n    }\n\n    this._initHelper()\n\n    // fog & background\n    this.setBackground()\n    this.setFog()\n\n    this.animate = this.animate.bind(this)\n  }\n\n  private _initParams () {\n    this.parameters = {\n      fogColor: new Color(0x000000),\n      fogNear: 50,\n      fogFar: 100,\n\n      backgroundColor: new Color(0x000000),\n\n      cameraType: 'perspective',\n      cameraFov: 40,\n      cameraEyeSep: 0.3,\n      cameraZ: -80, // FIXME initial value should be automatically determined\n\n      clipNear: 0,\n      clipFar: 100,\n      clipDist: 10,\n      clipMode: 'scene',\n      clipScale: 'relative',\n\n      lightColor: new Color(0xdddddd),\n      lightIntensity: 1.0,\n      ambientColor: new Color(0xdddddd),\n      ambientIntensity: 0.2,\n\n      sampleLevel: 0,\n\n      // output encoding: use sRGB for a linear internal workflow, linear for traditional sRGB workflow.\n      rendererEncoding: LinearEncoding,\n    }\n  }\n\n  private _initCamera () {\n    const lookAt = new Vector3(0, 0, 0)\n    const {width, height} = this\n\n    this.perspectiveCamera = new PerspectiveCamera(\n      this.parameters.cameraFov, width / height\n    )\n    this.perspectiveCamera.position.z = this.parameters.cameraZ\n    this.perspectiveCamera.lookAt(lookAt)\n\n    this.orthographicCamera = new OrthographicCamera(\n      width / -2, width / 2, height / 2, height / -2\n    )\n    this.orthographicCamera.position.z = this.parameters.cameraZ\n    this.orthographicCamera.lookAt(lookAt)\n\n    this.stereoCamera = new StereoCamera()\n    this.stereoCamera.aspect = 0.5\n    this.stereoCamera.eyeSep = this.parameters.cameraEyeSep\n\n    const cameraType = this.parameters.cameraType\n    if (cameraType === 'orthographic') {\n      this.camera = this.orthographicCamera\n    } else if(cameraType === 'perspective' || cameraType === 'stereo') {\n      this.camera = this.perspectiveCamera\n    } else {\n      throw new Error(`Unknown cameraType '${cameraType}'`)\n    }\n    this.camera.updateProjectionMatrix()\n  }\n\n  private _initStats () {\n    this.stats = new Stats()\n  }\n\n  private _initScene () {\n    if (!this.scene) {\n      this.scene = new Scene()\n      this.scene.name = 'scene'\n    }\n\n    this.rotationGroup = new Group()\n    this.rotationGroup.name = 'rotationGroup'\n    this.scene.add(this.rotationGroup)\n\n    this.translationGroup = new Group()\n    this.translationGroup.name = 'translationGroup'\n    this.rotationGroup.add(this.translationGroup)\n\n    this.modelGroup = new Group()\n    this.modelGroup.name = 'modelGroup'\n    this.translationGroup.add(this.modelGroup)\n\n    this.pickingGroup = new Group()\n    this.pickingGroup.name = 'pickingGroup'\n    this.translationGroup.add(this.pickingGroup)\n\n    this.backgroundGroup = new Group()\n    this.backgroundGroup.name = 'backgroundGroup'\n    this.translationGroup.add(this.backgroundGroup)\n\n    this.helperGroup = new Group()\n    this.helperGroup.name = 'helperGroup'\n    this.translationGroup.add(this.helperGroup)\n\n    // fog\n\n    this.scene.fog = new Fog(this.parameters.fogColor.getHex())\n\n    // light\n\n    this.spotLight = new SpotLight(\n      this.parameters.lightColor.getHex(), this.parameters.lightIntensity\n    )\n    this.scene.add(this.spotLight)\n\n    this.ambientLight = new AmbientLight(\n      this.parameters.ambientColor.getHex(), this.parameters.ambientIntensity\n    )\n    this.scene.add(this.ambientLight)\n  }\n\n  private _initRenderer () {\n    const dpr = window.devicePixelRatio\n    const {width, height} = this\n\n    try {\n      this.renderer = new WebGLRenderer({\n        preserveDrawingBuffer: true,\n        alpha: true,\n        antialias: true\n      })\n    } catch (e) {\n      this.wrapper.innerHTML = WebglErrorMessage\n      return false\n    }\n    this.renderer.setPixelRatio(dpr)\n    this.renderer.setSize(width, height)\n    this.renderer.autoClear = false\n    this.renderer.sortObjects = true\n    this.renderer.outputEncoding = this.parameters.rendererEncoding\n\n    const gl = this.renderer.getContext()\n    // console.log(gl.getContextAttributes().antialias)\n    // console.log(gl.getParameter(gl.SAMPLES))\n\n    // For WebGL1, extensions must be explicitly enabled.\n    // The following are builtin to WebGL2 (and don't appear as\n    // extensions)\n    // EXT_frag_depth, OES_element_index_uint, OES_texture_float\n    // OES_texture_half_float\n\n    // The WEBGL_color_buffer_float extension is replaced by\n    // EXT_color_buffer_float\n\n    // If not webgl2 context, explicitly check for these\n    if (!this.renderer.capabilities.isWebGL2) {\n      setExtensionFragDepth(this.renderer.extensions.get('EXT_frag_depth'))\n      this.renderer.extensions.get('OES_element_index_uint')\n\n      setSupportsReadPixelsFloat(\n        (this.renderer.extensions.get('OES_texture_float') &&\n          this.renderer.extensions.get('WEBGL_color_buffer_float')) ||\n        (this.renderer.extensions.get('OES_texture_float') &&\n          testTextureSupport(gl.FLOAT))\n      )\n      // picking texture\n\n      this.renderer.extensions.get('OES_texture_float')\n\n      this.supportsHalfFloat = (\n        this.renderer.extensions.get('OES_texture_half_float') &&\n        testTextureSupport(0x8D61)\n      )\n\n    } else {\n      setExtensionFragDepth(true)\n      setSupportsReadPixelsFloat(\n        this.renderer.extensions.get('EXT_color_buffer_float')\n      )\n      this.supportsHalfFloat = true\n    }\n\n    this.wrapper.appendChild(this.renderer.domElement)\n\n    const dprWidth = width * dpr\n    const dprHeight = height * dpr\n\n\n    if (Debug) {\n      console.log(JSON.stringify({\n        'Browser': Browser,\n        'OES_texture_float': !!this.renderer.extensions.get('OES_texture_float'),\n        'OES_texture_half_float': !!this.renderer.extensions.get('OES_texture_half_float'),\n        'WEBGL_color_buffer_float': !!this.renderer.extensions.get('WEBGL_color_buffer_float'),\n        'testTextureSupport Float': testTextureSupport(gl.FLOAT),\n        'testTextureSupport HalfFloat': testTextureSupport(0x8D61),\n        'this.supportsHalfFloat': this.supportsHalfFloat,\n        'SupportsReadPixelsFloat': SupportsReadPixelsFloat\n      }, null, 2))\n    }\n\n    this.pickingTarget = new WebGLRenderTarget(\n      dprWidth, dprHeight,\n      {\n        minFilter: NearestFilter,\n        magFilter: NearestFilter,\n        stencilBuffer: false,\n        format: RGBAFormat,\n        type: SupportsReadPixelsFloat ? FloatType : UnsignedByteType\n      }\n    )\n    this.pickingTarget.texture.generateMipmaps = false\n    this.pickingTarget.texture.encoding = this.parameters.rendererEncoding\n\n    // workaround to reset the gl state after using testTextureSupport\n    // fixes some bug where nothing is rendered to the canvas\n    // when animations are started on page load\n    this.renderer.setRenderTarget(this.pickingTarget)\n    this.renderer.clear()\n    this.renderer.setRenderTarget(null!)\n\n    // ssaa textures\n\n    this.sampleTarget = new WebGLRenderTarget(\n      dprWidth, dprHeight,\n      {\n        minFilter: LinearFilter,\n        magFilter: LinearFilter,\n        format: RGBAFormat\n      }\n    )\n    this.sampleTarget.texture.encoding = this.parameters.rendererEncoding\n\n    this.holdTarget = new WebGLRenderTarget(\n      dprWidth, dprHeight,\n      {\n        minFilter: NearestFilter,\n        magFilter: NearestFilter,\n        format: RGBAFormat,\n        type: UnsignedByteType\n        // using HalfFloatType or FloatType does not work on some Chrome 61 installations\n        // type: this.supportsHalfFloat ? HalfFloatType : (\n        //   SupportsReadPixelsFloat ? FloatType : UnsignedByteType\n        // )\n      }\n    )\n    this.holdTarget.texture.encoding = this.parameters.rendererEncoding\n\n    this.compositeUniforms = {\n      'tForeground': new Uniform(this.sampleTarget.texture),\n      'scale': new Uniform(1.0)\n    }\n\n    this.compositeMaterial = new ShaderMaterial({\n      uniforms: this.compositeUniforms,\n      vertexShader: getShader('Quad.vert'),\n      fragmentShader: getShader('Quad.frag'),\n      premultipliedAlpha: true,\n      transparent: true,\n      blending: AdditiveBlending,\n      depthTest: false,\n      depthWrite: false\n    })\n\n    this.compositeCamera = new OrthographicCamera(-1, 1, 1, -1, 0, 1)\n    this.compositeScene = new Scene()\n    this.compositeScene.name = 'compositeScene'\n    this.compositeScene.add(new Mesh(\n      new PlaneGeometry(2, 2), this.compositeMaterial\n    ))\n  }\n\n  private _initHelper () {\n    const indices = new Uint16Array([\n      0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6,\n      6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7\n    ])\n    const positions = new Float32Array(8 * 3)\n\n    const bbGeometry = new BufferGeometry()\n    bbGeometry.setIndex(new BufferAttribute(indices, 1))\n    bbGeometry.setAttribute('position', new BufferAttribute(positions, 3))\n    const bbMaterial = new ShaderMaterial({\n      uniforms: { 'uColor': { value: new Color('skyblue') } },\n      vertexShader: getShader('BasicLine.vert'),\n      fragmentShader: getShader('BasicLine.frag')\n    })\n\n    this.boundingBoxMesh = new LineSegments(bbGeometry, bbMaterial)\n    this.helperGroup.add(this.boundingBoxMesh)\n  }\n\n  updateHelper () {\n    const position = ((this.boundingBoxMesh.geometry as BufferGeometry).attributes as any).position  // TODO\n    const array = position.array\n    const {min, max} = this.boundingBox\n\n    array[ 0 ] = max.x; array[ 1 ] = max.y; array[ 2 ] = max.z\n    array[ 3 ] = min.x; array[ 4 ] = max.y; array[ 5 ] = max.z\n    array[ 6 ] = min.x; array[ 7 ] = min.y; array[ 8 ] = max.z\n    array[ 9 ] = max.x; array[ 10 ] = min.y; array[ 11 ] = max.z\n    array[ 12 ] = max.x; array[ 13 ] = max.y; array[ 14 ] = min.z\n    array[ 15 ] = min.x; array[ 16 ] = max.y; array[ 17 ] = min.z\n    array[ 18 ] = min.x; array[ 19 ] = min.y; array[ 20 ] = min.z\n    array[ 21 ] = max.x; array[ 22 ] = min.y; array[ 23 ] = min.z\n\n    position.needsUpdate = true\n\n    if (!this.boundingBox.isEmpty()) {\n      this.boundingBoxMesh.geometry.computeBoundingSphere()\n    }\n  }\n\n  /** Distance from origin (lookAt point) */\n  get cameraDistance(): number {\n    return Math.abs(this.camera.position.z)\n  }\n\n  /** Set distance from origin (lookAt point); along the -z axis */\n  set cameraDistance(d: number) {\n    this.camera.position.z = -d\n  }\n\n  add (buffer: Buffer, instanceList?: BufferInstance[]) {\n    // Log.time( \"Viewer.add\" );\n\n    if (instanceList) {\n      instanceList.forEach(instance => this.addBuffer(buffer, instance))\n    } else {\n      this.addBuffer(buffer)\n    }\n\n    buffer.group.name = 'meshGroup'\n    buffer.wireframeGroup.name = 'wireframeGroup'\n    if (buffer.parameters.background) {\n      this.backgroundGroup.add(buffer.group)\n      this.backgroundGroup.add(buffer.wireframeGroup)\n    } else {\n      this.modelGroup.add(buffer.group)\n      this.modelGroup.add(buffer.wireframeGroup)\n    }\n\n    if (buffer.pickable) {\n      this.pickingGroup.add(buffer.pickingGroup)\n    }\n\n    if (Debug) this.updateHelper()\n\n    // Log.timeEnd( \"Viewer.add\" );\n  }\n\n  addBuffer (buffer: Buffer, instance?: BufferInstance) {\n    // Log.time( \"Viewer.addBuffer\" );\n\n    function setUserData (object: Object3D) {\n      if (object instanceof Group) {\n        object.children.forEach(setUserData)\n      } else {\n        object.userData.buffer = buffer\n        object.userData.instance = instance\n        object.onBeforeRender = onBeforeRender\n      }\n    }\n\n    const mesh = buffer.getMesh()\n    if (instance) {\n      mesh.applyMatrix4(instance.matrix)\n    }\n    setUserData(mesh)\n    buffer.group.add(mesh)\n\n    const wireframeMesh = buffer.getWireframeMesh()\n    if (instance) {\n      // wireframeMesh.applyMatrix( instance.matrix );\n      wireframeMesh.matrix.copy(mesh.matrix)\n      wireframeMesh.position.copy(mesh.position)\n      wireframeMesh.quaternion.copy(mesh.quaternion)\n      wireframeMesh.scale.copy(mesh.scale)\n    }\n    setUserData(wireframeMesh)\n    buffer.wireframeGroup.add(wireframeMesh)\n\n    if (buffer.pickable) {\n      const pickingMesh = buffer.getPickingMesh()\n      if (instance) {\n        // pickingMesh.applyMatrix( instance.matrix );\n        pickingMesh.matrix.copy(mesh.matrix)\n        pickingMesh.position.copy(mesh.position)\n        pickingMesh.quaternion.copy(mesh.quaternion)\n        pickingMesh.scale.copy(mesh.scale)\n      }\n      setUserData(pickingMesh)\n      buffer.pickingGroup.add(pickingMesh)\n    }\n\n    if (instance) {\n      this._updateBoundingBox(buffer.geometry, buffer.matrix, instance.matrix)\n    } else {\n      this._updateBoundingBox(buffer.geometry, buffer.matrix)\n    }\n\n    // Log.timeEnd( \"Viewer.addBuffer\" );\n  }\n\n  remove (buffer: Buffer) {\n    this.translationGroup.children.forEach(function (group) {\n      group.remove(buffer.group)\n      group.remove(buffer.wireframeGroup)\n    })\n\n    if (buffer.pickable) {\n      this.pickingGroup.remove(buffer.pickingGroup)\n    }\n\n    this.updateBoundingBox()\n    if (Debug) this.updateHelper()\n\n    // this.requestRender();\n  }\n\n  private _updateBoundingBox (geometry?: BufferGeometry, matrix?: Matrix4, instanceMatrix?: Matrix4) {\n    const boundingBox = this.boundingBox\n\n    function updateGeometry (geometry: BufferGeometry, matrix?: Matrix4, instanceMatrix?: Matrix4) {\n      if (geometry.boundingBox == null) {\n        geometry.computeBoundingBox()\n      }\n\n      const geoBoundingBox = (geometry.boundingBox as Box3).clone()\n\n      if (matrix) {\n        geoBoundingBox.applyMatrix4(matrix)\n      }\n      if (instanceMatrix) {\n        geoBoundingBox.applyMatrix4(instanceMatrix)\n      }\n\n      if (geoBoundingBox.min.equals(geoBoundingBox.max)) {\n        // mainly to give a single impostor geometry some volume\n        // as it is only expanded in the shader on the GPU\n        geoBoundingBox.expandByScalar(5)\n      }\n\n      boundingBox.union(geoBoundingBox)\n    }\n\n    function updateNode (node: Mesh) {\n      if (node.geometry !== undefined) {\n        let matrix, instanceMatrix\n        if (node.userData.buffer) {\n          matrix = node.userData.buffer.matrix\n        }\n        if (node.userData.instance) {\n          instanceMatrix = node.userData.instance.matrix\n        }\n        updateGeometry(node.geometry as BufferGeometry, matrix, instanceMatrix)  // TODO\n      }\n    }\n\n    if (geometry) {\n      updateGeometry(geometry, matrix, instanceMatrix)\n    } else {\n      boundingBox.makeEmpty()\n      this.modelGroup.traverse(updateNode)\n      this.backgroundGroup.traverse(updateNode)\n    }\n\n    boundingBox.getSize(this.boundingBoxSize)\n    this.boundingBoxLength = this.boundingBoxSize.length()\n  }\n\n  updateBoundingBox () {\n    this._updateBoundingBox()\n    if (Debug) this.updateHelper()\n  }\n\n  getPickingPixels () {\n    const {width, height} = this\n\n    const n = width * height * 4\n    const imgBuffer = SupportsReadPixelsFloat ? new Float32Array(n) : new Uint8Array(n)\n\n    this.render(true)\n    this.renderer.readRenderTargetPixels(\n      this.pickingTarget, 0, 0, width, height, imgBuffer\n    )\n\n    return imgBuffer\n  }\n\n  getImage (picking: boolean) {\n    return new Promise(resolve => {\n      if (picking) {\n        const {width, height} = this\n        const n = width * height * 4\n        let imgBuffer = this.getPickingPixels()\n\n        if (SupportsReadPixelsFloat) {\n          const imgBuffer2 = new Uint8Array(n)\n          for (let i = 0; i < n; ++i) {\n            imgBuffer2[ i ] = Math.round(imgBuffer[ i ] * 255)\n          }\n          imgBuffer = imgBuffer2\n        }\n\n        const canvas = document.createElement('canvas')\n        canvas.width = width\n        canvas.height = height\n        const ctx = canvas.getContext('2d')!  // TODO\n        const imgData = ctx.getImageData(0, 0, width, height)\n        imgData.data.set(imgBuffer as any)  // TODO\n        ctx.putImageData(imgData, 0, 0)\n        canvas.toBlob(resolve as any, 'image/png')  // TODO\n      } else {\n        this.renderer.domElement.toBlob(resolve as any, 'image/png')  // TODO\n      }\n    })\n  }\n\n  makeImage (params: Partial<ImageParameters> = {}) {\n    return makeImage(this, params)\n  }\n\n  setLight (color: Color|number|string, intensity: number, ambientColor: Color|number|string, ambientIntensity: number) {\n    const p = this.parameters\n\n    if (color !== undefined) p.lightColor.set(color as string)  // TODO\n    if (intensity !== undefined) p.lightIntensity = intensity\n    if (ambientColor !== undefined) p.ambientColor.set(ambientColor as string)  // TODO\n    if (ambientIntensity !== undefined) p.ambientIntensity = ambientIntensity\n\n    this.requestRender()\n  }\n\n  setFog (color?: Color|number|string, near?: number, far?: number) {\n    const p = this.parameters\n\n    if (color !== undefined) p.fogColor.set(color as string)  // TODO\n    if (near !== undefined) p.fogNear = near\n    if (far !== undefined) p.fogFar = far\n\n    this.requestRender()\n  }\n\n  setBackground (color?: Color|number|string) {\n    const p = this.parameters\n\n    if (color) p.backgroundColor.set(color as string)  // TODO\n\n    this.setFog(p.backgroundColor)\n    this.renderer.setClearColor(p.backgroundColor, 0)\n    this.renderer.domElement.style.backgroundColor = p.backgroundColor.getStyle()\n\n    this.requestRender()\n  }\n\n  setSampling (level: number) {\n    if (level !== undefined) {\n      this.parameters.sampleLevel = level\n      this.sampleLevel = level\n    }\n\n    this.requestRender()\n  }\n\n  /**\n   * Set the output color encoding, i.e. how the renderer translates\n   * colorspaces as it renders to the screen.\n\n   * The default is LinearEncoding, because the internals of NGL are\n   * already sRGB so no translation is needed to show sRGB colors.\n   * Set to sRGBEncoding to create a linear workflow, and also call\n   * `setColorEncoding(LinearEncoding)` to linearize colors on input.\n   * @see setColorEncoding\n   */\n  private setOutputEncoding (encoding: TextureEncoding) {\n    this.parameters.rendererEncoding = encoding\n    this.renderer.outputEncoding = encoding\n    this.pickingTarget.texture.encoding = encoding\n    this.sampleTarget.texture.encoding = encoding\n    this.holdTarget.texture.encoding = encoding\n  }\n\n  /**\n   * Set the internal color workflow, linear or sRGB.\n   * sRGB, the default, is more \"vibrant\" at the cost of accuracy.\n   * Linear gives more accurate results, especially for transparent objects.\n   * In all cases, the output is always sRGB; this just affects how colors are computed internally.\n   * Call this just after creating the viewer, before loading any models.\n   */\n  setColorWorkflow (encoding: ColorWorkflow) {\n    if (encoding != 'linear' && encoding != 'sRGB')\n      throw new Error(`setColorWorkflow: invalid color workflow ${encoding}`)\n    setColorSpace(encoding == 'linear' ? 'linear' : 'sRGB')\n    this.setOutputEncoding(encoding == 'linear' ? sRGBEncoding : LinearEncoding)\n    // Note: this doesn't rebuild models, so existing geometry will have\n    // the old color encoding.\n    this.requestRender()\n  }\n\n  setCamera (type: CameraType, fov?: number, eyeSep?: number) {\n    const p = this.parameters\n\n    if (type) p.cameraType = type\n    if (fov) p.cameraFov = fov\n    if (eyeSep) p.cameraEyeSep = eyeSep\n\n    if (p.cameraType === 'orthographic') {\n      if (this.camera !== this.orthographicCamera) {\n        this.camera = this.orthographicCamera\n        this.camera.position.copy(this.perspectiveCamera.position)\n        this.camera.up.copy(this.perspectiveCamera.up)\n        this.updateZoom()\n      }\n    } else if (p.cameraType === 'perspective' || p.cameraType === 'stereo') {\n      if (this.camera !== this.perspectiveCamera) {\n        this.camera = this.perspectiveCamera\n        this.camera.position.copy(this.orthographicCamera.position)\n        this.camera.up.copy(this.orthographicCamera.up)\n      }\n    } else {\n      throw new Error(`Unknown cameraType '${p.cameraType}'`)\n    }\n\n    this.perspectiveCamera.fov = p.cameraFov\n    this.stereoCamera.eyeSep = p.cameraEyeSep\n    this.camera.updateProjectionMatrix()\n\n    this.requestRender()\n  }\n\n  setClip (near: number, far: number, dist: number, clipMode?: string, clipScale?: string) {\n    const p = this.parameters\n\n    if (near !== undefined) p.clipNear = near\n    if (far !== undefined) p.clipFar = far\n    if (dist !== undefined) p.clipDist = dist\n    if (clipMode !== undefined) p.clipMode = clipMode\n    if (clipScale !== undefined) p.clipScale = clipScale\n\n    this.requestRender()\n  }\n\n  setSize (width: number, height: number) {\n    this.width = width || 1\n    this.height = height || 1\n\n    this.perspectiveCamera.aspect = this.width / this.height\n    this.orthographicCamera.left = -this.width / 2\n    this.orthographicCamera.right = this.width / 2\n    this.orthographicCamera.top = this.height / 2\n    this.orthographicCamera.bottom = -this.height / 2\n    this.camera.updateProjectionMatrix()\n\n    const dpr = window.devicePixelRatio\n\n    this.renderer.setPixelRatio(dpr)\n    this.renderer.setSize(width, height)\n\n    const dprWidth = this.width * dpr\n    const dprHeight = this.height * dpr\n\n    this.pickingTarget.setSize(dprWidth, dprHeight)\n    this.sampleTarget.setSize(dprWidth, dprHeight)\n    this.holdTarget.setSize(dprWidth, dprHeight)\n\n    this.requestRender()\n  }\n\n  handleResize () {\n    if (this.container === document.body) {\n      this.setSize(window.innerWidth, window.innerHeight)\n    } else {\n      const box = this.container.getBoundingClientRect()\n      this.setSize(box.width, box.height)\n    }\n  }\n\n  updateInfo (reset?: boolean) {\n    const { memory, render } = this.info\n\n    if (reset) {\n      memory.programs = 0\n      memory.geometries = 0\n      memory.textures = 0\n\n      render.calls = 0\n      render.vertices = 0\n      render.points = 0\n    } else {\n      const rInfo = this.renderer.info\n      const rMemory = rInfo.memory\n      const rRender = rInfo.render\n\n      memory.geometries = rMemory.geometries\n      memory.textures = rMemory.textures\n\n      render.calls += rRender.calls\n      render.faces += rRender.triangles\n      render.points += rRender.points\n    }\n  }\n\n  animate () {\n    this.signals.ticked.dispatch(this.stats)\n    const delta = window.performance.now() - this.stats.startTime\n\n    if (delta > 500 && !this.isStill && this.sampleLevel < 3 && this.sampleLevel !== -1) {\n      const currentSampleLevel = this.sampleLevel\n      this.sampleLevel = 3\n      this.renderPending = true\n      this.render()\n      this.isStill = true\n      this.sampleLevel = currentSampleLevel\n      if (Debug) Log.log('rendered still frame')\n    }\n\n    this.frameRequest = window.requestAnimationFrame(this.animate)\n  }\n\n  pick (x: number, y: number) {\n    if (this.parameters.cameraType === 'stereo') {\n      // TODO picking broken for stereo camera\n      return {\n        'pid': 0,\n        'instance': undefined,\n        'picker': undefined\n      }\n    }\n\n    x *= window.devicePixelRatio\n    y *= window.devicePixelRatio\n\n    x = Math.max(x - 2, 0)\n    y = Math.max(y - 2, 0)\n\n    let pid = 0, instance, picker\n    const pixelBuffer = SupportsReadPixelsFloat ? pixelBufferFloat : pixelBufferUint\n\n    this.render(true)\n    this.renderer.readRenderTargetPixels(\n      this.pickingTarget, x, y, 5, 5, pixelBuffer\n    )\n\n    for (let i = 0; i < pixelOrder.length; i++) {\n\n      const offset = pixelOrder[i] * 4\n\n      const oid = Math.round(pixelBuffer[ offset + 3 ])\n      const object = this.pickingGroup.getObjectById(oid)\n      if (object) {\n        instance = object.userData.instance\n        picker = object.userData.buffer.picking\n      } else {\n        continue\n      }\n\n      if (SupportsReadPixelsFloat) {\n        pid =\n          ((Math.round(pixelBuffer[offset] * 255) << 16) & 0xFF0000) |\n          ((Math.round(pixelBuffer[offset + 1] * 255) << 8) & 0x00FF00) |\n          ((Math.round(pixelBuffer[offset + 2] * 255)) & 0x0000FF)\n      } else {\n        pid =\n          (pixelBuffer[offset] << 16) |\n          (pixelBuffer[offset + 1] << 8) |\n          (pixelBuffer[offset + 2])\n      }\n    }\n    // if( Debug ){\n    //   const rgba = Array.apply( [], pixelBuffer );\n    //   Log.log( pixelBuffer );\n    //   Log.log(\n    //     \"picked color\",\n    //     rgba.map( c => { return c.toPrecision( 2 ) } )\n    //   );\n    //   Log.log( \"picked pid\", pid );\n    //   Log.log( \"picked oid\", oid );\n    //   Log.log( \"picked object\", object );\n    //   Log.log( \"picked instance\", instance );\n    //   Log.log( \"picked position\", x, y );\n    //   Log.log( \"devicePixelRatio\", window.devicePixelRatio );\n    // }\n\n    return { pid, instance, picker }\n  }\n\n  requestRender () {\n    if (this.renderPending) {\n      // Log.info(\"there is still a 'render' call pending\")\n      return\n    }\n\n    // start gathering stats anew after inactivity\n    if (window.performance.now() - this.stats.startTime > 22) {\n      this.stats.begin()\n      this.isStill = false\n    }\n\n    this.renderPending = true\n\n    window.requestAnimationFrame(() => {\n      this.render()\n      this.stats.update()\n    })\n  }\n\n  updateZoom () {\n    const fov = degToRad(this.perspectiveCamera.fov)\n    const height = 2 * Math.tan(fov / 2) * this.cameraDistance\n    this.orthographicCamera.zoom = this.height / height\n  }\n\n  /**\n   * Convert an absolute clip value to a relative one using bRadius.\n   *\n   * 0.0 -> 50.0\n   * bRadius -> 0.0\n   */\n  absoluteToRelative (d: number) :number {\n    return 50 * (1 - d / this.bRadius)\n  }\n\n  /**\n   * Convert a relative clip value to an absolute one using bRadius\n   *\n   * 0.0 -> bRadius\n   * 50.0 -> 0.0\n   */\n  relativeToAbsolute (d: number) : number {\n    return this.bRadius * (1 - d / 50)\n  }\n\n  /**\n   * Intepret clipMode, clipScale and set the camera and fog clipping.\n   * Also ensures bRadius and cDist are valid\n   */\n  private __updateClipping () {\n    const p = this.parameters\n\n    // bRadius must always be updated for material-based clipping\n    // and for focus calculations\n    this.bRadius = Math.max(10, this.boundingBoxLength * 0.5)\n\n    // FL: Removed below, but leaving commented as I don't understand intention\n    // this.bRadius += this.boundingBox.getCenter(this.distVector).length()\n\n    if (!isFinite(this.bRadius)) {\n      this.bRadius = 50\n    }\n\n    this.camera.getWorldPosition(this.distVector)\n    this.cDist = this.distVector.length()\n    if (!this.cDist) {\n      // recover from a broken (NaN) camera position\n      this.cameraDistance = Math.abs(p.cameraZ)\n      this.cDist = Math.abs(p.cameraZ)\n    }\n\n    // fog\n    const fog = this.scene.fog as Fog\n    fog.color.set(p.fogColor)\n\n    if (p.clipMode === 'camera') {\n      // Always interpret clipScale as absolute for clipMode camera\n\n      this.camera.near = p.clipNear\n      this.camera.far = p.clipFar\n      fog.near = p.fogNear\n      fog.far = p.fogFar\n\n    } else {\n      // scene mode\n\n      if (p.clipScale === 'absolute') {\n        // absolute scene mode; offset clip planes from scene center\n        // (note: positive values move near plane towards camera and rear plane away)\n\n        this.camera.near = this.cDist - p.clipNear\n        this.camera.far = this.cDist + p.clipFar\n        fog.near = this.cDist - p.fogNear\n        fog.far = this.cDist + p.fogFar\n\n      } else {\n        // relative scene mode (default): convert pecentages to Angstroms\n\n        const nearFactor = (50 - p.clipNear) / 50\n        const farFactor = -(50 - p.clipFar) / 50\n        this.camera.near = this.cDist - (this.bRadius * nearFactor)\n        this.camera.far = this.cDist + (this.bRadius * farFactor)\n\n        const fogNearFactor = (50 - p.fogNear) / 50\n        const fogFarFactor = -(50 - p.fogFar) / 50\n        fog.near = this.cDist - (this.bRadius * fogNearFactor)\n        fog.far = this.cDist + (this.bRadius * fogFarFactor)\n      }\n    }\n\n    if (p.clipMode !== 'camera') {\n\n      if (this.camera.type === 'PerspectiveCamera') {\n\n        this.camera.near = Math.max(0.1, p.clipDist, this.camera.near)\n        this.camera.far = Math.max(1, this.camera.far)\n        fog.near = Math.max(0.1, fog.near)\n        fog.far = Math.max(1, fog.far)\n      } else if (this.camera.type === 'OrthographicCamera') {\n\n        if (p.clipDist > 0) {\n          this.camera.near = Math.max(p.clipDist, this.camera.near)\n        }\n      }\n    }\n  }\n\n  private __updateCamera () {\n    const camera = this.camera\n    camera.updateMatrix()\n    camera.updateMatrixWorld(true)\n    camera.updateProjectionMatrix()\n\n    updateMaterialUniforms(this.scene, camera, this.renderer, this.cDist, this.bRadius)\n    sortProjectedPosition(this.scene, camera)\n  }\n\n  private __setVisibility (model: boolean, picking: boolean, background: boolean, helper: boolean) {\n    this.modelGroup.visible = model\n    this.pickingGroup.visible = picking\n    this.backgroundGroup.visible = background\n    this.helperGroup.visible = helper\n  }\n\n  private __updateLights () {\n    this.spotLight.color.set(this.parameters.lightColor)\n    this.spotLight.intensity = this.parameters.lightIntensity\n\n    this.distVector.copy(this.camera.position).setLength(this.boundingBoxLength * 100)\n    this.spotLight.position.copy(this.camera.position).add(this.distVector)\n\n    this.ambientLight.color.set(this.parameters.ambientColor)\n    this.ambientLight.intensity = this.parameters.ambientIntensity\n  }\n\n  private __renderPickingGroup (camera: PerspectiveCamera|OrthographicCamera) {\n    this.renderer.setRenderTarget(this.pickingTarget || null)\n    this.renderer.clear()\n    this.__setVisibility(false, true, false, false)\n    this.renderer.render(this.scene, camera)\n    //  back to standard render target\n    this.renderer.setRenderTarget(null)\n    this.updateInfo()\n\n    // if (Debug) {\n    //   this.__setVisibility(false, true, false, true);\n\n    //   this.renderer.clear();\n    //   this.renderer.render(this.scene, camera);\n    // }\n  }\n\n  private __renderModelGroup (camera: PerspectiveCamera|OrthographicCamera, renderTarget?: WebGLRenderTarget) {\n    this.renderer.setRenderTarget(renderTarget || null)\n    this.renderer.clear()\n    this.__setVisibility(false, false, true, false)\n    this.renderer.render(this.scene, camera)\n    this.renderer.clear(false, true, true)\n    this.updateInfo()\n\n    this.__setVisibility(true, false, false, Debug)\n    this.renderer.render(this.scene, camera)\n    this.renderer.setRenderTarget(null) // set back to default canvas\n    this.updateInfo()\n  }\n\n  private __renderSuperSample (camera: PerspectiveCamera|OrthographicCamera, renderTarget?: WebGLRenderTarget) {\n    // based on the Supersample Anti-Aliasing Render Pass\n    // contributed to three.js by bhouston / http://clara.io/\n    //\n    // This manual approach to SSAA re-renders the scene ones for\n    // each sample with camera jitter and accumulates the results.\n    // References: https://en.wikipedia.org/wiki/Supersampling\n    const offsetList = JitterVectors[ Math.max(0, Math.min(this.sampleLevel, 5)) ]\n\n    const baseSampleWeight = 1.0 / offsetList.length\n    const roundingRange = 1 / 32\n\n    this.compositeUniforms.tForeground.value = this.sampleTarget.texture\n\n    let width = this.sampleTarget.width\n    const height = this.sampleTarget.height\n    if (this.parameters.cameraType === 'stereo') {\n      width /= 2\n    }\n\n    // render the scene multiple times, each slightly jitter offset\n    // from the last and accumulate the results.\n    for (let i = 0; i < offsetList.length; ++i) {\n      const offset = offsetList[ i ]\n      camera.setViewOffset(\n        width, height, offset[ 0 ], offset[ 1 ], width, height\n      )\n      camera.updateProjectionMatrix()\n      updateCameraUniforms(this.scene, camera)\n\n      let sampleWeight = baseSampleWeight\n      // the theory is that equal weights for each sample lead to an\n      // accumulation of rounding errors.\n      // The following equation varies the sampleWeight per sample\n      // so that it is uniformly distributed across a range of values\n      // whose rounding errors cancel each other out.\n      const uniformCenteredDistribution = -0.5 + (i + 0.5) / offsetList.length\n      sampleWeight += roundingRange * uniformCenteredDistribution\n      this.compositeUniforms.scale.value = sampleWeight\n\n      this.__renderModelGroup(camera, this.sampleTarget)\n      this.renderer.setRenderTarget(this.holdTarget)\n      if (i === 0)  {\n        this.renderer.clear()\n      }\n\n      this.renderer.render(this.compositeScene, this.compositeCamera)\n    }\n\n    this.compositeUniforms.scale.value = 1.0\n    this.compositeUniforms.tForeground.value = this.holdTarget.texture\n\n    camera.clearViewOffset()\n    this.renderer.setRenderTarget(renderTarget || null)\n    this.renderer.clear()\n    this.renderer.render(this.compositeScene, this.compositeCamera)\n  }\n\n  private __renderStereo (picking = false, _renderTarget?: WebGLRenderTarget) {\n    const stereoCamera = this.stereoCamera\n    stereoCamera.update(this.perspectiveCamera);\n\n    const renderer = this.renderer\n    let size = new Vector2()\n    renderer.getSize(size)\n\n    renderer.setScissorTest(true)\n\n    renderer.setScissor(0, 0, size.width / 2, size.height)\n    renderer.setViewport(0, 0, size.width / 2, size.height)\n    updateCameraUniforms(this.scene, stereoCamera.cameraL)\n    this.__render(picking, stereoCamera.cameraL)\n\n    renderer.setScissor(size.width / 2, 0, size.width / 2, size.height)\n    renderer.setViewport(size.width / 2, 0, size.width / 2, size.height)\n    updateCameraUniforms(this.scene, stereoCamera.cameraR)\n    this.__render(picking, stereoCamera.cameraR)\n\n    renderer.setScissorTest(false)\n    renderer.setViewport(0, 0, size.width, size.height)\n  }\n\n  private __render(picking = false, camera: PerspectiveCamera|OrthographicCamera, renderTarget?: WebGLRenderTarget) {\n    if (picking) {\n      if (!this.lastRenderedPicking) this.__renderPickingGroup(camera)\n    } else if (this.sampleLevel > 0 && this.parameters.cameraType !== 'stereo') {\n      // TODO super sample broken for stereo camera\n      this.__renderSuperSample(camera, renderTarget)\n    } else {\n      this.__renderModelGroup(camera, renderTarget)\n    }\n  }\n\n  render (picking = false, renderTarget?: WebGLRenderTarget) {\n    if (this.rendering) {\n      Log.warn(\"'tried to call 'render' from within 'render'\")\n      return\n    }\n\n    // Log.time('Viewer.render')\n\n    this.rendering = true\n\n    try {\n      this.__updateClipping()\n      this.__updateCamera()\n      this.__updateLights()\n      this.updateInfo(true)\n\n      // render\n      if (this.parameters.cameraType === 'stereo') {\n        this.__renderStereo(picking, renderTarget)\n      } else {\n        this.__render(picking, this.camera, renderTarget)\n      }\n      this.lastRenderedPicking = picking\n    } finally {\n      this.rendering = false\n      this.renderPending = false\n    }\n    this.signals.rendered.dispatch()\n\n    // Log.timeEnd('Viewer.render')\n    // Log.log(this.info.memory, this.info.render)\n  }\n\n  clear () {\n    Log.log('scene cleared')\n    this.scene.remove(this.rotationGroup)\n    this._initScene()\n    this.renderer.clear()\n  }\n\n  dispose () {\n    this.renderer.dispose()\n    window.cancelAnimationFrame(this.frameRequest)\n  }\n}\n","/**\n * @file Mouse Observer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2 } from 'three'\nimport { Signal } from 'signals'\n\nimport { LeftMouseButton, RightMouseButton } from '../constants'\nimport { defaults } from '../utils'\nimport Viewer from '../viewer/viewer'\nimport MouseControls from '../controls/mouse-controls'\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\n/**\n * @example\n * mouseObserver.signals.scrolled.add( function( delta ){ ... } );\n *\n * @typedef {Object} MouseSignals\n * @property {Signal<Integer, Integer>} moved - on move: deltaX, deltaY\n * @property {Signal<Number>} scrolled - on scroll: delta\n * @property {Signal<Integer, Integer>} dragged - on drag: deltaX, deltaY\n * @property {Signal} dropped - on drop\n * @property {Signal} clicked - on click\n * @property {Signal} hovered - on hover\n */\n\nfunction getTouchDistance (event: TouchEvent) {\n  const dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX\n  const dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY\n  return Math.sqrt(dx * dx + dy * dy)\n}\n\nfunction getMouseButtons (event: MouseEvent) {\n    if (typeof event === 'object') {\n    if ('buttons' in event) {\n      return event.buttons\n    } else if ('which' in event as any) {\n      const b = (event as any).which\n      if (b === 2) {\n        return 4\n      } else if (b === 3) {\n        return 2\n      } else if (b > 0) {\n        return 1 << (b - 1)\n      }\n    } else if ('button' in event as any) {\n      const b = (event as any).button\n      if (b === 1) {\n        return 4\n      } else if (b === 2) {\n        return 2\n      } else if (b >= 0) {\n        return 1 << b\n      }\n    }\n  }\n  return 0\n}\n\nexport interface MouseSignals {\n  moved: Signal  // on move: deltaX, deltaY\n  scrolled: Signal  // on scroll: delta\n  dragged: Signal  // on drag: deltaX, deltaY\n  dropped: Signal  // on drop\n  clicked: Signal  // on click\n  hovered: Signal  // on hover\n  doubleClicked: Signal\n}\n\nexport interface MouseParams {\n  hoverTimeout?: number\n  handleScroll?:boolean\n  doubleClickSpeed?: number\n}\n\n/**\n * Mouse observer\n *\n * @example\n * // listen to mouse moving (and touch-moving) events\n * mouseObserver.moved.moved.add( function( deltaX, deltaY ){ ... } );\n *\n * @example\n * // listen to scrolling (and pinching) events\n * mouseObserver.signals.scrolled.add( function( delta ){ ... } );\n *\n * @example\n * // listen to dragging (and touch-dragging) events\n * mouseObserver.signals.dragged.add( function( deltaX, deltaY ){ ... } );\n *\n * @example\n * // listen to clicking (and tapping) events\n * mouseObserver.signals.clicked.add( function(){ ... } );\n *\n * @example\n * // listen to double clicking (and double tapping) events\n * mouseObserver.signals.doubleClicked.add( function(){ ... } );\n *\n * @example\n * // listen to hovering events\n * mouseObserver.signals.hovered.add( function(){ ... } );\n */\nclass MouseObserver {\n  signals: MouseSignals = {\n    moved: new Signal(),\n    scrolled: new Signal(),\n    dragged: new Signal(),\n    dropped: new Signal(),\n    clicked: new Signal(),\n    hovered: new Signal(),\n    doubleClicked: new Signal()\n  }\n\n  hoverTimeout: number\n  handleScroll:boolean\n  doubleClickSpeed: number\n\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: MouseControls\n\n  position = new Vector2()  // Position on page\n  prevPosition = new Vector2()  // Previous position on page\n  down = new Vector2()  // Position on page when clicked\n  canvasPosition = new Vector2()  // Position on dom element\n  prevClickCP = new Vector2()\n\n  moving = false  // Flag indicating if the mouse is moving\n  hovering = true  // Flag indicating if the mouse is hovering\n  scrolled = false  // Flag indicating if there was a scolling event since the last mouse move\n  lastMoved = Infinity  // Timestamp of last mouse move\n  which? = 0  // 0: No button; 1: Left button; 2: Middle button; 3: Right button\n  buttons? = 0  // 0: No button; 1: Left button; 2: Right button; 4: Middle button\n  pressed? = false  // Flag indicating if the mouse is pressed down\n  altKey = false  // Flag indicating if the alt key is pressed\n  ctrlKey = false  // Flag indicating if the ctrl key is pressed\n  metaKey = false  // Flag indicating if the meta key is pressed\n  shiftKey = false  // Flag indicating if the shift key is pressed\n\n  doubleClickPending: boolean\n  lastClicked: number\n  overElement: boolean\n  lastTouchDistance: number\n  private frameRequest: number\n\n  /**\n   * @param  {Element} domElement - the dom element to observe mouse events in\n   * @param  {Object} params - parameters object\n   * @param  {Integer} params.hoverTimeout - timeout in ms until the {@link MouseSignals.hovered}\n   *                                         signal is fired, set to -1 to ignore hovering\n   * @param  {Boolean} params.handleScroll - whether or not to handle scroll events\n   * @param  {Integer} params.doubleClickSpeed - max time in ms to trigger double click\n   */\n  constructor (readonly domElement: HTMLCanvasElement, params: MouseParams = {}) {\n    this.domElement.style.touchAction = 'none'\n\n    this.hoverTimeout = defaults(params.hoverTimeout, 50)\n    this.handleScroll = defaults(params.handleScroll, true)\n    this.doubleClickSpeed = defaults(params.doubleClickSpeed, 500)\n\n    this._listen = this._listen.bind(this)\n    this._onMousewheel = this._onMousewheel.bind(this)\n    this._onMousemove = this._onMousemove.bind(this)\n    this._onMousedown = this._onMousedown.bind(this)\n    this._onMouseup = this._onMouseup.bind(this)\n    this._onContextmenu = this._onContextmenu.bind(this)\n    this._onTouchstart = this._onTouchstart.bind(this)\n    this._onTouchend = this._onTouchend.bind(this)\n    this._onTouchmove = this._onTouchmove.bind(this)\n\n    this._listen()\n\n    const opt = { passive: false } // treat as 'passive' so preventDefault can be called\n    document.addEventListener('mousewheel', this._onMousewheel, opt)\n    document.addEventListener('wheel', this._onMousewheel, opt)\n    document.addEventListener('MozMousePixelScroll', this._onMousewheel, opt)\n    document.addEventListener('mousemove', this._onMousemove, opt)\n    document.addEventListener('mousedown', this._onMousedown, opt)\n    document.addEventListener('mouseup', this._onMouseup, opt)\n    document.addEventListener('contextmenu', this._onContextmenu, opt)\n    document.addEventListener('touchstart', this._onTouchstart, opt)\n    document.addEventListener('touchend', this._onTouchend, opt)\n    document.addEventListener('touchmove', this._onTouchmove, opt)\n  }\n\n  get key () {\n    let key = 0\n    if (this.altKey) key += 1\n    if (this.ctrlKey) key += 2\n    if (this.metaKey) key += 4\n    if (this.shiftKey) key += 8\n    return key\n  }\n\n  setParameters (params: MouseParams = {}) {\n    this.hoverTimeout = defaults(params.hoverTimeout, this.hoverTimeout)\n  }\n\n  /**\n   * listen to mouse actions\n   * @emits {MouseSignals.clicked} when clicked\n   * @emits {MouseSignals.hovered} when hovered\n   * @return {undefined}\n   */\n  _listen () {\n    const now = window.performance.now()\n    const cp = this.canvasPosition\n    if (this.doubleClickPending && now - this.lastClicked > this.doubleClickSpeed) {\n      this.doubleClickPending = false\n    }\n    if (now - this.lastMoved > this.hoverTimeout) {\n      this.moving = false\n    }\n    if (this.scrolled || (!this.moving && !this.hovering)) {\n      this.scrolled = false\n      if (this.hoverTimeout !== -1 && this.overElement) {\n        this.hovering = true\n        this.signals.hovered.dispatch(cp.x, cp.y)\n      }\n    }\n    this.frameRequest = window.requestAnimationFrame(this._listen)\n  }\n\n  /**\n   * handle mouse scroll\n   * @emits {MouseSignals.scrolled} when scrolled\n   * @param  {Event} event - mouse event\n   * @return {undefined}\n   */\n  _onMousewheel(event: Optional<WheelEvent, 'detail'> & { wheelDelta?: number, wheelDeltaY?: number }) {\n    if (event.target !== this.domElement || !this.handleScroll) {\n      return\n    }\n    event.preventDefault()\n    this._setKeys(event as any)\n\n    let delta = 0\n    // This has to be written in a particular way to handle old browsers that\n    // all send events with different properties set in different ways.\n    if ('deltaY' in event && 'deltaMode' in event &&\n      event.deltaY !== undefined && event.deltaMode !== undefined) {\n      // all modern browsers, using WheelEvent; deltaY + down (toward user)\n      if (event.deltaMode === WheelEvent.DOM_DELTA_PIXEL)\n        // everything except Firefox: normally 100 per wheel click\n        delta = -event.deltaY * (2.5 / 100.0)\n      else if (event.deltaMode === WheelEvent.DOM_DELTA_LINE)\n        // Firefox in line mode, normally 3 per wheel click\n        delta = -event.deltaY * (2.5 / 3.0)\n      else                      // page mode: 1 per wheel click\n        delta = -event.deltaY * 2.5\n    } else if ('deltaY' in event && !('detail' in event))  {\n      // Old Firefox or IE 11: deltaY but no deltaMode; treat as pixels\n      delta = -event.deltaY * (2.5 / 100.0)\n    } else if (event.wheelDelta !== undefined) {\n      delta = -event.wheelDelta * (2.5 / 100)\n    } else if (event.wheelDeltaY !== undefined) {\n      delta = -event.wheelDeltaY * (2.5 / 100)\n    } else if (event.detail !== undefined){\n      // Old Firefox, MouseWheelEvent\n      delta = -event.detail / 3\n    }\n    this.signals.scrolled.dispatch(delta)\n\n    setTimeout(() => {\n      this.scrolled = true\n    }, this.hoverTimeout)\n  }\n\n  /**\n   * handle mouse move\n   * @emits {MouseSignals.moved} when moved\n   * @emits {MouseSignals.dragged} when dragged\n   * @param  {Event} event - mouse event\n   * @return {undefined}\n   */\n  _onMousemove (event: MouseEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n      this.overElement = true\n    } else {\n      this.overElement = false\n    }\n    this._setKeys(event)\n    this.moving = true\n    this.hovering = false\n    this.lastMoved = window.performance.now()\n    this.prevPosition.copy(this.position)\n    this.position.set(event.clientX, event.clientY)\n    this._setCanvasPosition(event)\n    const dx = this.prevPosition.x - this.position.x\n    const dy = this.prevPosition.y - this.position.y\n    this.signals.moved.dispatch(dx, dy)\n    if (this.pressed) {\n      this.signals.dragged.dispatch(dx, dy)\n    }\n  }\n\n  _onMousedown (event: MouseEvent) {\n    if (event.target !== this.domElement) {\n      return\n    }\n    event.preventDefault()\n    this._setKeys(event)\n    this.moving = false\n    this.hovering = false\n    this.down.set(event.clientX, event.clientY)\n    this.position.set(event.clientX, event.clientY)\n    this.which = event.which\n    this.buttons = getMouseButtons(event)\n    this.pressed = true\n    this._setCanvasPosition(event)\n  }\n\n  /**\n   * handle mouse up\n   * @emits {MouseSignals.doubleClicked} when double clicked\n   * @emits {MouseSignals.dropped} when dropped\n   * @param  {Event} event - mouse event\n   * @return {undefined}\n   */\n  _onMouseup (event: MouseEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n    }\n    this._setKeys(event)\n    const cp = this.canvasPosition\n    if (this._distance() < 4) {\n      this.lastClicked = window.performance.now()\n      if (this.doubleClickPending && this.prevClickCP.distanceTo(cp) < 4) {\n        this.signals.doubleClicked.dispatch(cp.x, cp.y)\n        this.doubleClickPending = false\n      }\n      this.signals.clicked.dispatch(cp.x, cp.y)\n      this.doubleClickPending = true\n      this.prevClickCP.copy(cp)\n    }\n    this.which = undefined\n    this.buttons = undefined\n    this.pressed = undefined\n    // if (this._distance() > 3 || event.which === RightMouseButton) {\n    //   this.signals.dropped.dispatch();\n    // }\n  }\n\n  _onContextmenu (event: MouseEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n    }\n  }\n\n  _onTouchstart (event: TouchEvent) {\n    if (event.target !== this.domElement) {\n      return\n    }\n    event.preventDefault()\n    this.pressed = true\n    switch (event.touches.length) {\n      case 1: {\n        this.moving = false\n        this.hovering = false\n        this.down.set(\n          event.touches[ 0 ].pageX,\n          event.touches[ 0 ].pageY\n        )\n        this.position.set(\n          event.touches[ 0 ].pageX,\n          event.touches[ 0 ].pageY\n        )\n        this._setCanvasPosition(event.touches[ 0 ])\n        break\n      }\n\n      case 2: {\n        this.down.set(\n          (event.touches[ 0 ].pageX + event.touches[ 1 ].pageX) / 2,\n          (event.touches[ 0 ].pageY + event.touches[ 1 ].pageY) / 2\n        )\n        this.position.set(\n          (event.touches[ 0 ].pageX + event.touches[ 1 ].pageX) / 2,\n          (event.touches[ 0 ].pageY + event.touches[ 1 ].pageY) / 2\n        )\n        this.lastTouchDistance = getTouchDistance(event)\n      }\n    }\n  }\n\n  _onTouchend (event: TouchEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n    }\n    this.which = undefined\n    this.buttons = undefined\n    this.pressed = undefined\n  }\n\n  _onTouchmove (event: TouchEvent) {\n    if (event.target === this.domElement) {\n      event.preventDefault()\n      this.overElement = true\n    } else {\n      this.overElement = false\n    }\n    switch (event.touches.length) {\n      case 1: {\n        this._setKeys(event)\n        this.which = LeftMouseButton\n        this.buttons = 1\n        this.moving = true\n        this.hovering = false\n        this.lastMoved = window.performance.now()\n        this.prevPosition.copy(this.position)\n        this.position.set(\n          event.touches[ 0 ].pageX,\n          event.touches[ 0 ].pageY\n        )\n        this._setCanvasPosition(event.touches[ 0 ])\n        const dx = this.prevPosition.x - this.position.x\n        const dy = this.prevPosition.y - this.position.y\n        this.signals.moved.dispatch(dx, dy)\n        if (this.pressed) {\n          this.signals.dragged.dispatch(dx, dy)\n        }\n        break\n      }\n\n      case 2: {\n        const touchDistance = getTouchDistance(event)\n        const delta = touchDistance - this.lastTouchDistance\n        this.lastTouchDistance = touchDistance\n        this.prevPosition.copy(this.position)\n        this.position.set(\n          (event.touches[ 0 ].pageX + event.touches[ 1 ].pageX) / 2,\n          (event.touches[ 0 ].pageY + event.touches[ 1 ].pageY) / 2\n        )\n        if (Math.abs(delta) > 2 && this.handleScroll &&\n            this.position.distanceTo(this.prevPosition) < 2\n        ) {\n          this.which = 0\n          this.buttons = 0\n          this.signals.scrolled.dispatch(delta / 2)\n        } else {\n          this.which = RightMouseButton\n          this.buttons = 2\n          const dx = this.prevPosition.x - this.position.x\n          const dy = this.prevPosition.y - this.position.y\n          this.signals.moved.dispatch(dx, dy)\n          if (this.pressed) {\n            this.signals.dragged.dispatch(dx, dy)\n          }\n        }\n      }\n    }\n  }\n\n  _distance () {\n    return this.position.distanceTo(this.down)\n  }\n\n  _setCanvasPosition (event: any) {  // TODO\n    const box = this.domElement.getBoundingClientRect()\n    let offsetX, offsetY;\n    if ('clientX' in event && 'clientY' in event) {\n      offsetX = event.clientX - box.left\n      offsetY = event.clientY - box.top\n    } else {\n      offsetX = event.offsetX\n      offsetY = event.offsetY\n    }\n    this.canvasPosition.set(offsetX, box.height - offsetY)\n  }\n\n  _setKeys (event: MouseEvent|TouchEvent) {\n    this.altKey = event.altKey\n    this.ctrlKey = event.ctrlKey\n    this.metaKey = event.metaKey\n    this.shiftKey = event.shiftKey\n  }\n\n  dispose () {\n    document.removeEventListener('mousewheel', this._onMousewheel)\n    document.removeEventListener('wheel', this._onMousewheel)\n    document.removeEventListener('MozMousePixelScroll', this._onMousewheel)\n    document.removeEventListener('mousemove', this._onMousemove)\n    document.removeEventListener('mousedown', this._onMousedown)\n    document.removeEventListener('mouseup', this._onMouseup)\n    document.removeEventListener('contextmenu', this._onContextmenu)\n    document.removeEventListener('touchstart', this._onTouchstart)\n    document.removeEventListener('touchend', this._onTouchend)\n    document.removeEventListener('touchmove', this._onTouchmove)\n    window.cancelAnimationFrame(this.frameRequest)\n  }\n}\n\nexport default MouseObserver\n","/**\n * @file Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport const LeftMouseButton = 1\nexport const MiddleMouseButton = 2\nexport const RightMouseButton = 3\n","/**\n * @file Trackball Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Quaternion } from 'three'\n\nimport { defaults } from '../utils'\nimport Stage from '../stage/stage'\nimport MouseObserver from '../stage/mouse-observer'\nimport Viewer from '../viewer/viewer'\nimport ViewerControls from './viewer-controls'\nimport AtomProxy from '../proxy/atom-proxy';\nimport Component from '../component/component';\n\nconst tmpRotateXMatrix = new Matrix4()\nconst tmpRotateYMatrix = new Matrix4()\nconst tmpRotateZMatrix = new Matrix4()\nconst tmpRotateMatrix = new Matrix4()\nconst tmpRotateCameraMatrix = new Matrix4()\nconst tmpRotateVector = new Vector3()\nconst tmpRotateQuaternion = new Quaternion()\nconst tmpRotateQuaternion2 = new Quaternion()\nconst tmpPanMatrix = new Matrix4()\nconst tmpPanVector = new Vector3()\nconst tmpAtomVector = new Vector3()\n\nexport interface TrackballControlsParams {\n  rotateSpeed?: number\n  zoomSpeed?: number\n  panSpeed?: number\n}\n\n/**\n * Trackball controls\n */\nclass TrackballControls {\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: ViewerControls\n\n  rotateSpeed: number\n  zoomSpeed: number\n  panSpeed: number\n\n  constructor (readonly stage: Stage, params: TrackballControlsParams = {}) {\n    this.rotateSpeed = defaults(params.rotateSpeed, 2.0)\n    this.zoomSpeed = defaults(params.zoomSpeed, 1.2)\n    this.panSpeed = defaults(params.panSpeed, 1.0)\n\n    this.viewer = stage.viewer\n    this.mouse = stage.mouseObserver\n    this.controls = stage.viewerControls\n  }\n\n  get component (): Component|undefined {\n    return this.stage.transformComponent\n  }\n\n  get atom (): AtomProxy|undefined {\n    return this.stage.transformAtom\n  }\n\n  private _setPanVector (x: number, y: number, z = 0) {\n    const scaleFactor = this.controls.getCanvasScaleFactor(z)\n    tmpPanVector.set(x, y, 0)\n    tmpPanVector.multiplyScalar(this.panSpeed * scaleFactor)\n  }\n\n  private _getRotateXY (x: number, y: number) {\n    return [\n      this.rotateSpeed * -x * 0.01,\n      this.rotateSpeed * y * 0.01\n    ]\n  }\n\n  private _getCameraRotation(m: Matrix4) {\n    m.extractRotation(this.viewer.camera.matrixWorld)\n    m.multiply(tmpRotateYMatrix.makeRotationY(Math.PI))\n\n    return m\n  }\n\n  private _transformPanVector () {\n    if (!this.component) return\n\n    // Adjust for component and scene rotation\n    tmpPanMatrix.extractRotation(this.component.transform)\n    tmpPanMatrix.premultiply(this.viewer.rotationGroup.matrix)\n    tmpPanMatrix.getInverse(tmpPanMatrix)\n\n    // Adjust for camera rotation\n    tmpPanMatrix.multiply(this._getCameraRotation(tmpRotateMatrix))\n\n    tmpPanVector.applyMatrix4(tmpPanMatrix)\n  }\n\n  zoom (delta: number) {\n    this.controls.zoom(this.zoomSpeed * delta * 0.02)\n  }\n\n  pan (x: number, y: number) {\n    this._setPanVector(x, y)\n\n    // Adjust for scene rotation\n    tmpPanMatrix.getInverse(this.viewer.rotationGroup.matrix)\n\n    // Adjust for camera rotation\n    tmpPanMatrix.multiply(this._getCameraRotation(tmpRotateMatrix))\n\n    tmpPanVector.applyMatrix4(tmpPanMatrix)\n    this.controls.translate(tmpPanVector)\n  }\n\n  panComponent (x: number, y: number) {\n    if (!this.component) return\n\n    this._setPanVector(x, y)\n    this._transformPanVector()\n\n    this.component.position.add(tmpPanVector)\n    this.component.updateMatrix()\n  }\n\n  panAtom (x: number, y: number) {\n    if (!this.atom || !this.component) return\n\n    this.atom.positionToVector3(tmpAtomVector)\n    tmpAtomVector.add(this.viewer.translationGroup.position)\n    tmpAtomVector.applyMatrix4(this.viewer.rotationGroup.matrix)\n\n    this._setPanVector(x, y, tmpAtomVector.z)\n    this._transformPanVector()\n\n    this.atom.positionAdd(tmpPanVector)\n    this.component.updateRepresentations({ 'position': true })\n  }\n\n  rotate (x: number, y: number) {\n    const [ dx, dy ] = this._getRotateXY(x, y)\n\n    // rotate around screen X then screen Y\n    this._getCameraRotation(tmpRotateMatrix)\n    tmpRotateVector.set(1, 0, 0) // X axis\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix) // screen X\n    tmpRotateQuaternion.setFromAxisAngle(tmpRotateVector, dy)\n\n    tmpRotateVector.set(0, 1, 0) // Y axis\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix) // screen Y\n    tmpRotateQuaternion2.setFromAxisAngle(tmpRotateVector, dx)\n\n    tmpRotateQuaternion.multiply(tmpRotateQuaternion2)\n    tmpRotateMatrix.makeRotationFromQuaternion(tmpRotateQuaternion)\n    this.controls.applyMatrix(tmpRotateMatrix)\n  }\n\n  zRotate (x: number, y: number) {\n    const dz = this.rotateSpeed * ((-x + y) / -2) * 0.01\n\n    tmpRotateZMatrix.makeRotationZ(dz)\n    this.controls.applyMatrix(tmpRotateZMatrix)\n  }\n\n  rotateComponent (x: number, y: number) {\n    if (!this.component) return\n\n    const [ dx, dy ] = this._getRotateXY(x, y)\n\n    this._getCameraRotation(tmpRotateCameraMatrix)\n\n    tmpRotateMatrix.extractRotation(this.component.transform)\n    tmpRotateMatrix.premultiply(this.viewer.rotationGroup.matrix)\n    tmpRotateMatrix.getInverse(tmpRotateMatrix)\n    tmpRotateMatrix.premultiply(tmpRotateCameraMatrix)\n\n    tmpRotateVector.set(1, 0, 0)\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix)\n    tmpRotateXMatrix.makeRotationAxis(tmpRotateVector, dy)\n\n    tmpRotateVector.set(0, 1, 0)\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix)\n    tmpRotateYMatrix.makeRotationAxis(tmpRotateVector, dx)\n\n    tmpRotateXMatrix.multiply(tmpRotateYMatrix)\n    tmpRotateQuaternion.setFromRotationMatrix(tmpRotateXMatrix)\n    this.component.quaternion.premultiply(tmpRotateQuaternion)\n    this.component.quaternion.normalize()\n    this.component.updateMatrix()\n  }\n}\n\nexport default TrackballControls\n","/**\n * @file Picking Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Vector2 } from 'three'\n\nimport Stage from '../stage/stage'\nimport StructureComponent from '../component/structure-component'\nimport MouseObserver from '../stage/mouse-observer'\nimport { Picker } from '../utils/picker'\nimport ViewerControls from './viewer-controls'\nimport Shape from '../geometry/shape'\nimport Structure from '../structure/structure'\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport Unitcell from '../symmetry/unitcell'\nimport Component from '../component/component';\n\nconst tmpVec = new Vector3()\n\nexport interface ShapePrimitive {\n  name: string\n  shape: Shape\n}\n\nfunction closer (x: Vector3, a: Vector3, b: Vector3) {\n  return x.distanceTo(a) < x.distanceTo(b)\n}\n\n/**\n * Picking data object.\n * @typedef {Object} PickingData - picking data\n * @property {Number} [pid] - picking id\n * @property {Object} [instance] - instance data\n * @property {Integer} instance.id - instance id\n * @property {String|Integer} instance.name - instance name\n * @property {Matrix4} instance.matrix - transformation matrix of the instance\n * @property {Picker} [picker] - picker object\n */\n\nexport interface InstanceData {\n  id: number\n  name: number|string\n  matrix: Matrix4\n}\n\nexport interface PickingData {\n  pid: number\n  instance: InstanceData\n  picker: Picker\n}\n\n/**\n * Picking proxy class.\n */\nclass PickingProxy {\n  pid: number\n  picker: Picker\n  instance: InstanceData\n  controls: ViewerControls\n  mouse: MouseObserver\n\n  /**\n   * Create picking proxy object\n   * @param  {PickingData} pickingData - picking data\n   * @param  {Stage} stage - stage object\n   */\n  constructor (pickingData: PickingData, readonly stage: Stage) {\n    this.pid = pickingData.pid\n    this.picker = pickingData.picker\n\n    /**\n     * @type {Object}\n     */\n    this.instance = pickingData.instance\n\n    /**\n     * @type {Stage}\n     */\n    this.stage = stage\n    /**\n     * @type {ViewerControls}\n     */\n    this.controls = stage.viewerControls\n    /**\n     * @type {MouseObserver}\n     */\n    this.mouse = stage.mouseObserver\n  }\n\n  /**\n   * Kind of the picked data\n   * @type {String}\n   */\n  get type () { return this.picker.type }\n\n  /**\n   * If the `alt` key was pressed\n   * @type {Boolean}\n   */\n  get altKey () { return this.mouse.altKey }\n  /**\n   * If the `ctrl` key was pressed\n   * @type {Boolean}\n   */\n  get ctrlKey () { return this.mouse.ctrlKey }\n  /**\n   * If the `meta` key was pressed\n   * @type {Boolean}\n   */\n  get metaKey () { return this.mouse.metaKey }\n  /**\n   * If the `shift` key was pressed\n   * @type {Boolean}\n   */\n  get shiftKey () { return this.mouse.shiftKey }\n\n  /**\n   * Position of the mouse on the canvas\n   * @type {Vector2}\n   */\n  get canvasPosition (): Vector2 { return this.mouse.canvasPosition }\n\n  /**\n   * The component the picked data is part of\n   * @type {Component}\n   */\n  get component (): Component {\n    return this.stage.getComponentsByObject(this.picker.data as any).list[ 0 ]  // TODO\n  }\n\n  /**\n   * The picked object data\n   * @type {Object}\n   */\n  get object () {\n    return this.picker.getObject(this.pid)\n  }\n\n  /**\n   * The 3d position in the scene of the picked object\n   * @type {Vector3}\n   */\n  get position () {\n    return this.picker.getPosition(this.pid, this.instance, this.component)\n  }\n\n  /**\n   * The atom of a picked bond that is closest to the mouse\n   * @type {AtomProxy}\n   */\n  get closestBondAtom (): AtomProxy|undefined {\n    if (this.type !== 'bond' || !this.bond) return undefined\n\n    const bond = this.bond\n    const controls = this.controls\n    const cp = this.canvasPosition\n\n    const v1 = bond.atom1.positionToVector3()\n    const v2 = bond.atom2.positionToVector3()\n\n    v1.applyMatrix4(this.component.matrix)\n    v2.applyMatrix4(this.component.matrix)\n\n    const acp1 = controls.getPositionOnCanvas(v1)\n    const acp2 = controls.getPositionOnCanvas(v2)\n\n    return closer(cp as any, acp1, acp2) ? bond.atom1 : bond.atom2\n  }\n\n  /**\n   * Close-by atom\n   * @type {AtomProxy}\n   */\n  get closeAtom (): AtomProxy|undefined {\n    const cp = this.canvasPosition\n    const ca = this.closestBondAtom\n    if (!ca) return undefined\n\n    const v = ca.positionToVector3().applyMatrix4(this.component.matrix)\n\n    const acp = this.controls.getPositionOnCanvas(v)\n\n    ca.positionToVector3(tmpVec)\n    if (this.instance) tmpVec.applyMatrix4(this.instance.matrix)\n    tmpVec.applyMatrix4(this.component.matrix)\n    const viewer = this.controls.viewer\n    tmpVec.add(viewer.translationGroup.position)\n    tmpVec.applyMatrix4(viewer.rotationGroup.matrix)\n\n    const scaleFactor = this.controls.getCanvasScaleFactor(tmpVec.z)\n    const sc = this.component as StructureComponent\n    const radius = sc.getMaxRepresentationRadius(ca.index)\n    //console.log(scaleFactor, cp.distanceTo(acp), radius/scaleFactor, radius)\n\n    if (cp.distanceTo(acp) <= radius/scaleFactor) {\n      return ca\n    } else {\n      return undefined\n    }\n  }\n\n  /**\n   * @type {Object}\n   */\n  get arrow () { return this._objectIfType('arrow') as ShapePrimitive }\n  /**\n   * @type {AtomProxy}\n   */\n  get atom () { return this._objectIfType('atom') as AtomProxy }\n  /**\n   * @type {Object}\n   */\n  get axes () { return this._objectIfType('axes') }\n  /**\n   * @type {BondProxy}\n   */\n  get bond () { return this._objectIfType('bond') as BondProxy }\n  /**\n   * @type {Object}\n   */\n  get box () { return this._objectIfType('box') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get cone () { return this._objectIfType('cone') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get clash () { return this._objectIfType('clash') as { clash: { sele1: string, sele2: string } } }\n  /**\n   * @type {BondProxy}\n   */\n  get contact () { return this._objectIfType('contact') as { type: string, atom1: AtomProxy, atom2: AtomProxy } }\n  /**\n   * @type {Object}\n   */\n  get cylinder () { return this._objectIfType('cylinder') as ShapePrimitive }\n  /**\n   * @type {BondProxy}\n   */\n  get distance () { return this._objectIfType('distance') as BondProxy }\n  /**\n   * @type {Object}\n   */\n  get ellipsoid () { return this._objectIfType('ellipsoid') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get octahedron () { return this._objectIfType('octahedron') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get point () { return this._objectIfType('point') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get mesh () { return this._objectIfType('mesh') as { name: string, shape: Shape, serial: number } }\n  /**\n   * @type {Object}\n   */\n  get slice () { return this._objectIfType('slice') as { volume: Volume, value: number } }\n  /**\n   * @type {Object}\n   */\n  get sphere () { return this._objectIfType('sphere') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get tetrahedron () { return this._objectIfType('tetrahedron') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get torus () { return this._objectIfType('torus') as ShapePrimitive }\n  /**\n   * @type {Object}\n   */\n  get surface () { return this._objectIfType('surface') as { surface: Surface, index: number } }\n  /**\n   * @type {Object}\n   */\n  get unitcell () { return this._objectIfType('unitcell') as { unitcell: Unitcell, structure: Structure } }\n  /**\n   * @type {Object}\n   */\n  get unknown () { return this._objectIfType('unknown') }\n  /**\n   * @type {Object}\n   */\n  get volume () { return this._objectIfType('volume') as { volume: Volume, value: number } }\n  /**\n   * @type {Object}\n   */\n  get wideline () { return this._objectIfType('wideline') as ShapePrimitive }\n\n  _objectIfType (type: string) {\n    return this.type === type ? this.object : undefined\n  }\n\n  getLabel () {\n    const atom = this.atom || this.closeAtom\n    let msg = 'nothing'\n    if (this.arrow) {\n      msg = this.arrow.name\n    } else if (atom) {\n      msg = `atom: ${atom.qualifiedName()} (${atom.structure.name})`\n    } else if (this.axes) {\n      msg = 'axes'\n    } else if (this.bond) {\n      msg = `bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`\n    } else if (this.box) {\n      msg = this.box.name\n    } else if (this.cone) {\n      msg = this.cone.name\n    } else if (this.clash) {\n      msg = `clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`\n    } else if (this.contact) {\n      msg = `${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`\n    } else if (this.cylinder) {\n      msg = this.cylinder.name\n    } else if (this.distance) {\n      msg = `distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`\n    } else if (this.ellipsoid) {\n      msg = this.ellipsoid.name\n    } else if (this.octahedron) {\n      msg = this.octahedron.name\n    } else if (this.point) {\n      msg = this.point.name\n    } else if (this.mesh) {\n      msg = `mesh: ${this.mesh.name || this.mesh.serial} (${this.mesh.shape.name})`\n    } else if (this.slice) {\n      msg = `slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`\n    } else if (this.sphere) {\n      msg = this.sphere.name\n    } else if (this.surface) {\n      msg = `surface: ${this.surface.surface.name}`\n    } else if (this.tetrahedron) {\n      msg = this.tetrahedron.name\n    } else if (this.torus) {\n      msg = this.torus.name\n    } else if (this.unitcell) {\n      msg = `unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`\n    } else if (this.unknown) {\n      msg = 'unknown'\n    } else if (this.volume) {\n      msg = `volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`\n    } else if (this.wideline) {\n      msg = this.wideline.name\n    }\n    return msg\n  }\n}\n\nexport default PickingProxy\n","/**\n * @file Picking Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport PickingProxy from './picking-proxy'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\n/**\n * Picking controls\n */\nclass PickingControls {\n  viewer: Viewer\n\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n  }\n\n  /**\n   * get picking data\n   * @param {Number} x - canvas x coordinate\n   * @param {Number} y - canvas y coordinate\n   * @return {PickingProxy|undefined} picking proxy\n   */\n  pick (x: number, y: number) {\n    const pickingData = this.viewer.pick(x, y)\n\n    if (pickingData.picker &&\n        pickingData.picker.type !== 'ignore' &&\n        pickingData.pid !== undefined\n    ) {\n      const pickerArray = pickingData.picker.array\n      if (pickerArray && pickingData.pid >= pickerArray.length) {\n        console.error('pid >= picker.array.length')\n      } else {\n        return new PickingProxy(pickingData, this.stage)\n      }\n    }\n  }\n}\n\nexport default PickingControls\n","/**\n * @file Viewer Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2, Vector3, Matrix4, Quaternion, OrthographicCamera } from 'three'\nimport * as signalsWrapper from 'signals'\n\nimport {\n  ensureVector2, ensureVector3, ensureMatrix4, ensureQuaternion\n} from '../utils'\nimport { degToRad } from '../math/math-utils'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\n/**\n * Orientation matrix, a 4x4 transformation matrix with rotation part\n * used for scene rotation, scale part for scene camera distance and\n * position part for scene translation\n * @typedef {Matrix4} OrientationMatrix - orientation matrix\n */\n\nconst tmpQ = new Quaternion()\nconst tmpP = new Vector3()\nconst tmpS = new Vector3()\n\nconst tmpCanvasVector = new Vector3()\nconst tmpScaleVector = new Vector3()\nconst tmpRotateMatrix = new Matrix4()\nconst tmpRotateVector = new Vector3()\nconst tmpAlignMatrix = new Matrix4()\n\n/**\n * Viewer controls\n */\nclass ViewerControls {\n  signals = {\n    changed: new signalsWrapper.Signal()\n  }\n\n  viewer: Viewer\n\n  /**\n   * @param  {Stage} stage - the stage object\n   */\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n  }\n\n  /**\n   * scene center position\n   * @type {Vector3}\n   */\n  get position () {\n    return this.viewer.translationGroup.position\n  }\n\n  /**\n   * scene rotation\n   * @type {Quaternion}\n   */\n  get rotation () {\n    return this.viewer.rotationGroup.quaternion\n  }\n\n  /**\n   * Trigger render and emit changed event\n   * @emits {ViewerControls.signals.changed}\n   * @return {undefined}\n   */\n  changed () {\n    this.viewer.requestRender()\n    this.signals.changed.dispatch()\n  }\n\n  getPositionOnCanvas (position: Vector3, optionalTarget?: Vector2) {\n    const canvasPosition = ensureVector2(optionalTarget)\n    const viewer = this.viewer\n\n    tmpCanvasVector.copy(position)\n      .add(viewer.translationGroup.position)\n      .applyMatrix4(viewer.rotationGroup.matrix)\n      .project(viewer.camera)\n\n    return canvasPosition.set(\n      (tmpCanvasVector.x + 1) * viewer.width / 2,\n      (tmpCanvasVector.y + 1) * viewer.height / 2\n    )\n  }\n\n  getCanvasScaleFactor (z = 0) {\n    const camera = this.viewer.camera\n    if (camera instanceof OrthographicCamera) {\n      return 1 / camera.zoom\n    } else {\n      z = Math.abs(z)\n      z += this.getCameraDistance()\n      const fov = degToRad(camera.fov)\n      const unitHeight = 2.0 * z * Math.tan(fov / 2)\n      return unitHeight / this.viewer.height\n    }\n  }\n\n  /**\n   * get scene orientation\n   * @param {Matrix4} optionalTarget - pre-allocated target matrix\n   * @return {OrientationMatrix} scene orientation\n   */\n  getOrientation (optionalTarget?: Matrix4) {\n    const m = ensureMatrix4(optionalTarget)\n\n    m.copy(this.viewer.rotationGroup.matrix)\n    const z = this.getCameraDistance()\n    m.scale(tmpScaleVector.set(z, z, z))\n    m.setPosition(this.viewer.translationGroup.position)\n\n    return m\n  }\n\n  /**\n   * set scene orientation\n   * @param {OrientationMatrix|Array} orientation - scene orientation\n   * @return {undefined}\n   */\n  orient (orientation?: Matrix4) {\n    ensureMatrix4(orientation).decompose(tmpP, tmpQ, tmpS)\n\n    const v = this.viewer\n    v.rotationGroup.setRotationFromQuaternion(tmpQ)\n    v.translationGroup.position.copy(tmpP)\n    v.cameraDistance = tmpS.z\n    v.updateZoom()\n    this.changed()\n  }\n\n  /**\n   * translate scene\n   * @param  {Vector3|Array} vector - translation vector\n   * @return {undefined}\n   */\n  translate (vector: Vector3|number[]) {\n    this.viewer.translationGroup.position\n      .add(ensureVector3(vector))\n    this.changed()\n  }\n\n  /**\n   * center scene\n   * @param  {Vector3|Array} position - center position\n   * @return {undefined}\n   */\n  center (position: Vector3|number[]) {\n    this.viewer.translationGroup.position\n      .copy(ensureVector3(position)).negate()\n    this.changed()\n  }\n\n  /**\n   * \"zoom\" scene by moving camera closer to origin\n   * @param  {Number} delta - zoom change\n   * @return {undefined}\n   */\n  zoom (delta: number) {\n    this.distance(this.getCameraDistance() * (1 - delta))\n  }\n\n  /**\n   * get camera distance\n   */\n  getCameraDistance(): number {\n    return this.viewer.cameraDistance\n  }\n\n  /**\n   * camera distance\n   * @param  {Number} z - distance\n   * @return {undefined}\n   */\n  distance (distance: number) {\n    // Math.abs because distance used to be \"z\", normally negative.\n    // Math.max to prevent us from getting _too_ close.\n    this.viewer.cameraDistance = Math.max(Math.abs(distance), 0.2)\n    this.viewer.updateZoom()\n    this.changed()\n  }\n\n  /**\n   * spin scene on axis\n   * @param  {Vector3|Array} axis - rotation axis\n   * @param  {Number} angle - amount to spin\n   * @return {undefined}\n   */\n  spin (axis: Vector3|number[], angle: number) {\n    tmpRotateMatrix.getInverse(this.viewer.rotationGroup.matrix)\n    tmpRotateVector\n      .copy(ensureVector3(axis)).applyMatrix4(tmpRotateMatrix)\n\n    this.viewer.rotationGroup.rotateOnAxis(tmpRotateVector, angle)\n    this.changed()\n  }\n\n  /**\n   * rotate scene\n   * @param  {Quaternion|Array} quaternion - rotation quaternion\n   * @return {undefined}\n   */\n  rotate (quaternion: Quaternion|number[]) {\n    this.viewer.rotationGroup\n      .setRotationFromQuaternion(ensureQuaternion(quaternion))\n    this.changed()\n  }\n\n  /**\n   * align scene to basis matrix\n   * @param  {Matrix4|Array} basis - basis matrix\n   * @return {undefined}\n   */\n  align (basis: Matrix4|number[]) {\n    tmpAlignMatrix.getInverse(ensureMatrix4(basis))\n\n    this.viewer.rotationGroup.setRotationFromMatrix(tmpAlignMatrix)\n    this.changed()\n  }\n\n  /**\n   * apply rotation matrix to scene\n   * @param  {Matrix4|Array} matrix - rotation matrix\n   * @return {undefined}\n   */\n  applyMatrix (matrix: Matrix4|number[]) {\n    this.viewer.rotationGroup.applyMatrix4(ensureMatrix4(matrix))\n    this.changed()\n  }\n}\n\nexport default ViewerControls\n","/**\n * @file Animation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Quaternion } from 'three'\n\nimport { defaults, ensureVector3, ensureQuaternion } from '../utils'\nimport { lerp, smoothstep } from '../math/math-utils'\nimport ViewerControls from '../controls/viewer-controls'\nimport Stats from '../viewer/stats'\n\n/**\n * Animation. Base animation class.\n * @interface\n */\nabstract class Animation {\n  duration: number\n  controls: ViewerControls\n\n  alpha: number\n  startTime: number\n\n  pausedTime = -1\n  elapsedDuration = 0\n  pausedDuration = 0\n  ignoreGlobalToggle = false\n\n  private _paused = false\n  private _resolveList: Function[] = []\n  private _hold: boolean\n\n  constructor (duration: number|undefined, controls: ViewerControls, ...args: any[]) {\n    this.duration = defaults(duration, 1000)\n    this.controls = controls\n\n    this.startTime = window.performance.now()\n\n    this._init(...args)\n  }\n\n  /**\n   * True when animation has finished\n   */\n  get done () {\n    return this.alpha === 1\n  }\n\n  /**\n   * True when animation is paused\n   */\n  get paused () {\n    return this._paused\n  }\n\n  /**\n   * init animation\n   */\n  abstract _init (...args: any[]): void\n\n  /**\n   * called on every tick\n   */\n  abstract _tick (stats?: Stats): void\n\n  tick (stats: Stats) {\n    if (this._paused) return\n\n    this.elapsedDuration = stats.currentTime - this.startTime - this.pausedDuration\n\n    if (this.duration === 0) {\n      this.alpha = 1\n    } else {\n      this.alpha = smoothstep(0, 1, this.elapsedDuration / this.duration)\n    }\n\n    this._tick(stats)\n\n    if (this.done) {\n      this._resolveList.forEach(resolve => resolve())\n    }\n\n    return this.done\n  }\n\n  /**\n   * Pause animation\n   * @param {boolean} [hold] - put animation on a hold which\n   *                           must be release before it can be resumed\n   */\n  pause (hold?: boolean) {\n    if (hold) this._hold = true\n\n    if (this.pausedTime === -1) {\n      this.pausedTime = window.performance.now()\n    }\n    this._paused = true\n  }\n\n  /**\n   * Resume animation\n   * @param {Boolean} [releaseHold] - release a hold on the animation\n   */\n  resume (releaseHold?: boolean) {\n    if (!releaseHold && this._hold) return\n\n    this.pausedDuration += window.performance.now() - this.pausedTime\n    this._paused = false\n    this._hold = false\n    this.pausedTime = -1\n  }\n\n  /**\n   * Toggle animation\n   */\n  toggle () {\n    if (this._paused) {\n      this.resume()\n    } else {\n      this.pause()\n    }\n  }\n\n  /**\n   * Promise-like interface\n   */\n  then (callback: Function) {\n    let p: Promise<any>\n\n    if (this.done) {\n      p = Promise.resolve()\n    } else {\n      p = new Promise(resolve => this._resolveList.push(resolve))\n    }\n\n    return p.then(callback as any)\n  }\n}\n\nexport default Animation\n\n/**\n * Spin animation. Spin around an axis.\n */\nexport class SpinAnimation extends Animation {\n  axis: Vector3\n  angle: number\n\n  constructor (duration: number|undefined, controls: ViewerControls, ...args: any[]) {\n    super(defaults(duration, Infinity), controls, ...args)\n  }\n\n  _init (axis: number[]|Vector3, angle: number) {\n    if (Array.isArray(axis)) {\n      this.axis = new Vector3().fromArray(axis)\n    } else {\n      this.axis = defaults(axis, new Vector3(0, 1, 0))\n    }\n    this.angle = defaults(angle, 0.01)\n  }\n\n  _tick (stats: Stats) {\n    if (!this.axis || !this.angle) return\n\n    this.controls.spin(\n      this.axis, this.angle * stats.lastDuration / 16\n    )\n  }\n}\n\n/**\n * Rock animation. Rock around an axis.\n */\nexport class RockAnimation extends Animation {\n  axis: Vector3\n  angleStep: number\n  angleEnd: number\n  angleSum = 0\n  direction = 1\n\n  constructor (duration: number|undefined, controls: ViewerControls, ...args: any[]) {\n    super(defaults(duration, Infinity), controls, ...args)\n  }\n\n  _init (axis: number[]|Vector3, angleStep: number, angleEnd: number) {\n    if (Array.isArray(axis)) {\n      this.axis = new Vector3().fromArray(axis)\n    } else {\n      this.axis = defaults(axis, new Vector3(0, 1, 0))\n    }\n    this.angleStep = defaults(angleStep, 0.01)\n    this.angleEnd = defaults(angleEnd, 0.2)\n  }\n\n  _tick (stats: Stats) {\n    if (!this.axis || !this.angleStep || !this.angleEnd) return\n\n    const alpha = smoothstep(\n      0, 1, Math.abs(this.angleSum) / this.angleEnd\n    )\n    const angle = this.angleStep * this.direction * (1.1 - alpha)\n\n    this.controls.spin(\n      this.axis, angle * stats.lastDuration / 16\n    )\n\n    this.angleSum += this.angleStep\n\n    if (this.angleSum >= this.angleEnd) {\n      this.direction *= -1\n      this.angleSum = -this.angleEnd\n    }\n  }\n}\n\n/**\n * Move animation. Move from one position to another.\n */\nexport class MoveAnimation extends Animation {\n  moveFrom: Vector3\n  moveTo: Vector3\n\n  _init (moveFrom: number[]|Vector3, moveTo: number[]|Vector3) {\n    this.moveFrom = ensureVector3(defaults(moveFrom, new Vector3()))\n    this.moveTo = ensureVector3(defaults(moveTo, new Vector3()))\n  }\n\n  _tick (/* stats */) {\n    this.controls.position.lerpVectors(\n      this.moveFrom, this.moveTo, this.alpha\n    ).negate()\n    this.controls.changed()\n  }\n}\n\n/**\n * Zoom animation. Gradually change the zoom level.\n */\nexport class ZoomAnimation extends Animation {\n  zoomFrom: number\n  zoomTo: number\n\n  _init (zoomFrom: number, zoomTo: number) {\n    this.zoomFrom = zoomFrom\n    this.zoomTo = zoomTo\n  }\n\n  _tick () {\n    this.controls.distance(lerp(this.zoomFrom, this.zoomTo, this.alpha))\n  }\n}\n\n/**\n * Rotate animation. Rotate from one orientation to another.\n */\nexport class RotateAnimation extends Animation {\n  rotateFrom: Quaternion\n  rotateTo: Quaternion\n\n  private _currentRotation = new Quaternion()\n\n  _init (rotateFrom: number[]|Quaternion, rotateTo: number[]|Quaternion) {\n    this.rotateFrom = ensureQuaternion(rotateFrom)\n    this.rotateTo = ensureQuaternion(rotateTo)\n\n    this._currentRotation = new Quaternion()\n  }\n\n  _tick () {\n    this._currentRotation\n      .copy(this.rotateFrom)\n      .slerp(this.rotateTo, this.alpha)\n\n    this.controls.rotate(this._currentRotation)\n  }\n}\n\n/**\n * Value animation. Call callback with interpolated value.\n */\nexport class ValueAnimation extends Animation {\n  valueFrom: number\n  valueTo: number\n  callback: Function\n\n  _init (valueFrom: number, valueTo: number, callback: Function) {\n    this.valueFrom = valueFrom\n    this.valueTo = valueTo\n\n    this.callback = callback\n  }\n\n  _tick (/* stats */) {\n    this.callback(lerp(this.valueFrom, this.valueTo, this.alpha))\n  }\n}\n\n/**\n * Timeout animation. Call callback after duration.\n */\nexport class TimeoutAnimation extends Animation {\n  callback: Function\n\n  _init (callback: Function) {\n    this.callback = callback\n  }\n\n  _tick () {\n    if (this.alpha === 1) this.callback()\n  }\n}\n\n/**\n * Animation list.\n */\nexport class AnimationList {\n  _list: Animation[]\n  _resolveList: Function[] = []\n\n  constructor (list: Animation[] = []) {\n    this._list = list\n  }\n\n  /**\n   * True when all animations have finished\n   */\n  get done () {\n    return this._list.every(animation => {\n      return animation.done\n    })\n  }\n\n  /**\n   * Promise-like interface\n   */\n  then (callback: Function) {\n    let p: Promise<any>\n\n    if (this.done) {\n      p = Promise.resolve()\n    } else {\n      p = new Promise(resolve => {\n        this._resolveList.push(resolve)\n        this._list.forEach(animation => {\n          animation.then(() => {\n            this._resolveList.forEach(callback => {\n              callback()\n            })\n            this._resolveList.length = 0\n          })\n        })\n      })\n    }\n\n    return p.then(callback as any)\n  }\n}\n","/**\n * @file Animation Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Quaternion, Matrix4 } from 'three'\n\nimport { ensureMatrix4 } from '../utils'\nimport Animation, {\n    SpinAnimation, RockAnimation, MoveAnimation, ZoomAnimation,\n    RotateAnimation, ValueAnimation, TimeoutAnimation, AnimationList\n} from '../animation/animation'\nimport Stage from '../stage/stage'\nimport Component from '../component/component'\nimport Viewer from '../viewer/viewer'\nimport Stats from '../viewer/stats'\nimport ViewerControls from './viewer-controls'\n\n/**\n * Animation controls\n */\nclass AnimationControls {\n  viewer: Viewer\n  controls: ViewerControls\n\n  animationList: Animation[] = []\n  finishedList: Animation[] = []\n\n  /**\n   * Create animation controls\n   * @param  {Stage} stage - the stage object\n   */\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n    this.controls = stage.viewerControls\n  }\n\n  /**\n   * True when all animations are paused\n   * @type {Boolean}\n   */\n  get paused () {\n    return this.animationList.every((animation: Animation) => animation.paused)\n  }\n\n  /**\n   * Add an animation\n   */\n  add (animation: Animation) {\n    if (animation.duration === 0) {\n      animation.tick(this.viewer.stats)\n    } else {\n      this.animationList.push(animation)\n    }\n\n    return animation\n  }\n\n  /**\n   * Remove an animation\n   */\n  remove (animation: Animation) {\n    const list = this.animationList\n    const index = list.indexOf(animation)\n\n    if (index > -1) {\n      list.splice(index, 1)\n    }\n  }\n\n  /**\n   * Run all animations\n   */\n  run (stats: Stats) {\n    const finishedList = this.finishedList\n    const animationList = this.animationList\n\n    const n = animationList.length\n    for (let i = 0; i < n; ++i) {\n      const animation = animationList[ i ]\n      // tick returns true when finished\n      if (animation.tick(stats)) {\n        finishedList.push(animation)\n      }\n    }\n\n    const m = finishedList.length\n    if (m) {\n      for (let j = 0; j < m; ++j) {\n        this.remove(finishedList[ j ])\n      }\n      finishedList.length = 0\n    }\n  }\n\n  /**\n   * Add a spin animation\n   * @param  {Vector3} axis - axis to spin around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  spin (axis: Vector3|number[], angle?: number, duration?: number) {\n    return this.add(\n      new SpinAnimation(duration, this.controls, axis, angle)\n    )\n  }\n\n  /**\n   * Add a rock animation\n   * @param  {Vector3} axis - axis to rock around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} end - maximum extend of motion, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  rock (axis: Vector3|number[], angle?: number, end?: number, duration?: number) {\n    return this.add(\n      new RockAnimation(duration, this.controls, axis, angle, end)\n    )\n  }\n\n  /**\n   * Add a rotate animation\n   * @param  {Quaternion} rotateTo - target rotation\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {RotateAnimation} the animation\n   */\n  rotate (rotateTo: Quaternion|number[], duration?: number) {\n    const rotateFrom = this.viewer.rotationGroup.quaternion.clone()\n\n    return this.add(\n      new RotateAnimation(duration, this.controls, rotateFrom, rotateTo)\n    )\n  }\n\n  /**\n   * Add a move animation\n   * @param  {Vector3} moveTo - target position\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {MoveAnimation} the animation\n   */\n  move (moveTo: Vector3|number[], duration?: number) {\n    const moveFrom = this.controls.position.clone().negate()\n\n    return this.add(\n      new MoveAnimation(duration, this.controls, moveFrom, moveTo)\n    )\n  }\n\n  /**\n   * Add a zoom animation\n   * @param  {Number} zoomTo - target distance\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {ZoomAnimation} the animation\n   */\n  zoom (zoomTo: number, duration?: number) {\n    const zoomFrom = this.viewer.camera.position.z\n\n    return this.add(\n      new ZoomAnimation(duration, this.controls, zoomFrom, zoomTo)\n    )\n  }\n\n  /**\n   * Add a zoom and a move animation\n   * @param  {Vector3} moveTo - target position\n   * @param  {Number} zoomTo - target distance\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {Array} the animations\n   */\n  zoomMove (moveTo: Vector3, zoomTo: number, duration?: number) {\n    return new AnimationList([\n      this.move(moveTo, duration),\n      this.zoom(zoomTo, duration)\n    ])\n  }\n\n  /**\n   * Add an orient animation\n   * @param  {OrientationMatrix|Array} orientTo - target orientation\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {Array} the animations\n   */\n  orient (orientTo: Matrix4|number[], duration?: number) {\n    const p = new Vector3()\n    const q = new Quaternion()\n    const s = new Vector3()\n\n    ensureMatrix4(orientTo).decompose(p, q, s)\n\n    return new AnimationList([\n      this.move(p.negate(), duration),\n      this.rotate(q, duration),\n      this.zoom(-s.x, duration)\n    ])\n  }\n\n  /**\n   * Add a value animation\n   * @param  {Number} valueFrom - start value\n   * @param  {Number} valueTo - target value\n   * @param  {Function} callback - called on every tick\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {ValueAnimation} the animation\n   */\n  value (valueFrom: number, valueTo: number, callback: Function, duration?: number) {\n    return this.add(\n      new ValueAnimation(duration, this.controls, valueFrom, valueTo, callback)\n    )\n  }\n\n  /**\n   * Add a timeout animation\n   * @param  {Function} callback - called after duration\n   * @param  {Number} duration - timeout in milliseconds\n   * @return {TimeoutAnimation} the animation\n   */\n  timeout (callback: Function, duration?: number) {\n    return this.add(\n      new TimeoutAnimation(duration, this.controls, callback)\n    )\n  }\n\n  /**\n   * Add a component spin animation\n   * @param  {Component} component - object to move\n   * @param  {Vector3} axis - axis to spin around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  spinComponent (component: Component, axis?: Vector3|number[], angle?: number, duration?: number) {\n    return this.add(\n      // TODO\n      new SpinAnimation(duration, component.controls as any, axis, angle)\n    )\n  }\n\n  /**\n   * Add a component rock animation\n   * @param  {Component} component - object to move\n   * @param  {Vector3} axis - axis to rock around\n   * @param  {Number} angle - amount to spin per frame, radians\n   * @param  {Number} end - maximum extend of motion, radians\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {SpinAnimation} the animation\n   */\n  rockComponent (component: Component, axis: Vector3|number[], angle?: number, end?: number, duration?: number) {\n    return this.add(\n       // TODO\n      new RockAnimation(duration, component.controls as any, axis, angle, end)\n    )\n  }\n\n  /**\n   * Add a component move animation\n   * @param  {Component} component - object to move\n   * @param  {Vector3} moveTo - target position\n   * @param  {Number} duration - animation time in milliseconds\n   * @return {MoveAnimation} the animation\n   */\n  moveComponent (component: Component, moveTo: Vector3|number[], duration?: number) {\n    const moveFrom = component.controls.position.clone().negate()\n\n    return this.add(\n      // TODO\n      new MoveAnimation(duration, component.controls as any, moveFrom, moveTo)\n    )\n  }\n\n  /**\n   * Pause all animations\n   * @return {undefined}\n   */\n  pause () {\n    this.animationList.forEach(animation => animation.pause())\n  }\n\n  /**\n   * Resume all animations\n   * @return {undefined}\n   */\n  resume () {\n    this.animationList.forEach(animation => animation.resume())\n  }\n\n  /**\n   * Toggle all animations\n   * @return {undefined}\n   */\n  toggle () {\n    if (this.paused) {\n      this.resume()\n    } else {\n      this.pause()\n    }\n  }\n\n  /**\n   * Clear all animations\n   * @return {undefined}\n   */\n  clear () {\n    this.animationList.length = 0\n  }\n\n  dispose () {\n    this.clear()\n  }\n}\n\nexport default AnimationControls\n","/**\n * @file Queue\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nclass Queue<T> {\n  queue: T[] = []\n  pending = false\n\n  constructor(readonly fn: Function, argList?: T[]) {\n    this.next = this.next.bind(this)\n\n    if (argList) {\n      for (let i = 0, il = argList.length; i < il; ++i) {\n        this.queue.push(argList[ i ])\n      }\n      this.next()\n    }\n  }\n\n  private run (arg: any) {\n    this.fn(arg, this.next)\n  }\n\n  private next () {\n    const arg = this.queue.shift()\n    if (arg !== undefined) {\n      this.pending = true\n      setTimeout(() => this.run(arg))\n    } else {\n      this.pending = false\n    }\n  }\n\n  push (arg: T) {\n    this.queue.push(arg)\n    if (!this.pending) this.next()\n  }\n\n  kill () {\n    this.queue.length = 0\n  }\n\n  length () {\n    return this.queue.length\n  }\n}\n\nexport default Queue\n","/**\n * @file Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color, Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log, ColormakerRegistry, ExtensionFragDepth } from '../globals'\nimport { defaults } from '../utils'\nimport Queue from '../utils/queue'\nimport Counter from '../utils/counter'\nimport Viewer from '../viewer/viewer'\nimport { BufferParameters, BufferSide, default as Buffer } from '../buffer/buffer';\nimport { ColorData, ColormakerParameters, ColorMode } from '../color/colormaker';\n\nexport interface RepresentationParameters {\n  name: string\n  lazy: boolean,\n  clipNear: number,\n  clipRadius: number,\n  clipCenter: Vector3,\n  flatShaded: boolean,\n  opacity: number,\n  depthWrite: boolean,\n  side: BufferSide,\n  wireframe: boolean,\n  colorData: ColorData,\n  colorScheme: string,\n  colorScale: string | number[],\n  colorReverse: boolean,\n  colorValue: number,\n  colorDomain: number[],\n  colorMode: ColorMode,\n  colorSpace: 'sRGB' | 'linear',\n  roughness: number,\n  metalness: number,\n  diffuse: Color,\n  diffuseInterior: boolean,\n  useInteriorColor: boolean,\n  interiorColor: Color,\n  interiorDarkening: number,\n  disablePicking: boolean,\n  matrix: Matrix4\n  quality: string,\n  visible: boolean,\n  color: number | string | Color,\n  sphereDetail: number,\n  radialSegments: number,\n  openEnded: boolean\n  disableImpostor: boolean\n  [key: string]: any//boolean | number | undefined | Color | string | Vector3 | Matrix4 | number[]\n}\n/**\n * Representation parameter object.\n * @typedef {Object} RepresentationParameters - representation parameters\n * @property {Boolean} [lazy] - only build & update the representation when visible\n *                            otherwise defer changes until set visible again\n * @property {Integer} [clipNear] - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {Integer} [clipRadius] - radius of clipping sphere\n * @property {Vector3} [clipCenter] - position of for spherical clipping\n * @property {Boolean} [flatShaded] - render flat shaded\n * @property {Float} [opacity] - translucency: 1 is fully opaque, 0 is fully transparent\n * @property {Boolean} [depthWrite] - depth write\n * @property {String} [side] - which triangle sides to render, \"front\" front-side,\n *                            \"back\" back-side, \"double\" front- and back-side\n * @property {Boolean} [wireframe] - render as wireframe\n * @property {ColorData} [colorData] - atom or bond indexed data for coloring\n * @property {String} [colorScheme] - color scheme\n * @property {String} [colorScale] - color scale, either a string for a\n *                                 predefined scale or an array of\n *                                 colors to be used as the scale\n * @property {Boolean} [colorReverse] - reverse color scale\n * @property {Color} [colorValue] - color value\n * @property {Integer[]} [colorDomain] - scale value range\n * @property {Integer} colorDomain.0 - min value\n * @property {Integer} colorDomain.1 - max value\n * @property {String} [colorMode] - color mode, one of rgb, hsv, hsl, hsi, lab, hcl\n * @property {Float} [roughness] - how rough the material is, between 0 and 1\n * @property {Float} [metalness] - how metallic the material is, between 0 and 1\n * @property {Color} [diffuse] - diffuse color for lighting\n * @property {Boolean} [diffuseInterior] - diffuse interior, i.e. ignore normal\n * @property {Boolean} [useInteriorColor] - use interior color\n * @property {Color} [interiorColor] - interior color\n * @property {Float} [interiorDarkening] - interior darkening: 0 no darking, 1 fully darkened\n * @property {Boolean} [disablePicking] - disable picking\n */\n\n/**\n * Representation object\n * @interface\n * @param {Object} object - the object to be represented\n * @param {Viewer} viewer - a viewer object\n * @param {RepresentationParameters} [params] - representation parameters\n */\nclass Representation {\n  parameters: any\n  type: string\n  viewer: Viewer\n  tasks: Counter\n  private queue: Queue<any>\n  bufferList: Buffer[]\n\n  lazy: boolean\n  lazyProps: { build: boolean, bufferParams: BufferParameters | {}, what: {}}\n  protected name: string\n  protected clipNear: number\n  protected clipRadius: number\n  protected clipCenter: Vector3\n  protected flatShaded: boolean\n  protected opacity: number\n  protected depthWrite: boolean\n  protected side: BufferSide\n  protected wireframe: boolean\n  protected colorData: ColorData\n  protected colorScheme: string\n  protected colorScale: string | string[]\n  protected colorReverse: boolean\n  protected colorValue: number\n  protected colorDomain: number[]\n  protected colorMode: ColorMode\n  protected roughness: number\n  protected metalness: number\n  protected diffuse: number\n  protected diffuseInterior?: boolean\n  protected useInteriorColor?: boolean\n  protected interiorColor: number\n  protected interiorDarkening: number\n  protected disablePicking: boolean\n  protected sphereDetail: number\n  protected radialSegments: number\n  protected openEnded: boolean\n  protected disableImpostor: boolean\n  protected disposed: boolean\n\n  protected matrix: Matrix4\n\n  private quality: string\n  visible: boolean\n\n  protected manualAttach: ()=> any\n\n  protected toBePrepared: boolean\n\n  [key: string]: any\n\n  constructor (object: any, viewer: Viewer, params: Partial<RepresentationParameters>) {\n    // eslint-disable-next-line no-unused-vars\n    // const p = params || {}\n\n    this.type = ''\n\n    this.parameters = {\n\n      lazy: {\n        type: 'boolean'\n      },\n\n      clipNear: {\n        type: 'range', step: 1, max: 100, min: 0, buffer: true\n      },\n      clipRadius: {\n        type: 'number', precision: 1, max: 1000, min: 0, buffer: true\n      },\n      clipCenter: {\n        type: 'vector3', precision: 1, buffer: true\n      },\n      flatShaded: {\n        type: 'boolean', buffer: true\n      },\n      opacity: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      depthWrite: {\n        type: 'boolean', buffer: true\n      },\n      side: {\n        type: 'select',\n        buffer: true,\n        options: { front: 'front', back: 'back', double: 'double' }\n      },\n      wireframe: {\n        type: 'boolean', buffer: true\n      },\n\n      colorData: {\n        type: 'hidden',\n        update: 'color',\n      },\n\n      colorScheme: {\n        type: 'select',\n        update: 'color',\n        options: {}\n      },\n      colorScale: {\n        type: 'select',\n        update: 'color',\n        options: ColormakerRegistry.getScales()\n      },\n      colorReverse: {\n        type: 'boolean', update: 'color'\n      },\n      colorValue: {\n        type: 'color', update: 'color'\n      },\n      colorDomain: {\n        type: 'hidden', update: 'color'\n      },\n      colorMode: {\n        type: 'select',\n        update: 'color',\n        options: ColormakerRegistry.getModes()\n      },\n\n      roughness: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      metalness: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      diffuse: {\n        type: 'color', buffer: true\n      },\n\n      diffuseInterior: {\n        type: 'boolean', buffer: true\n      },\n      useInteriorColor: {\n        type: 'boolean', buffer: true\n      },\n      interiorColor: {\n        type: 'color', buffer: true\n      },\n      interiorDarkening: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n\n      matrix: {\n        type: 'hidden', buffer: true\n      },\n\n      disablePicking: {\n        type: 'boolean', rebuild: true\n      }\n\n    }\n\n    /**\n     * @type {Viewer}\n     */\n    this.viewer = viewer\n\n    /**\n     * Counter that keeps track of tasks related to the creation of\n     * the representation, including surface calculations.\n     * @type {Counter}\n     */\n    this.tasks = new Counter()\n\n    /**\n     * @type {Queue}\n     * @private\n     */\n    this.queue = new Queue(this.make.bind(this))\n\n    /**\n     * @type {Array}\n     * @private\n     */\n    this.bufferList = []\n\n    if (this.parameters.colorScheme) {\n      this.parameters.colorScheme.options = ColormakerRegistry.getSchemes()\n    }\n\n    this.toBePrepared = false\n  }\n\n  init (params: Partial<RepresentationParameters>) {\n    const p = params || {}\n\n    this.clipNear = defaults(p.clipNear, 0)\n    this.clipRadius = defaults(p.clipRadius, 0)\n    this.clipCenter = defaults(p.clipCenter, new Vector3())\n    this.flatShaded = defaults(p.flatShaded, false)\n    this.side = defaults(p.side, 'double')\n    this.opacity = defaults(p.opacity, 1.0)\n    this.depthWrite = defaults(p.depthWrite, true)\n    this.wireframe = defaults(p.wireframe, false)\n\n    this.setColor(p.color, p)\n\n    this.colorData = defaults(p.colorData, undefined)\n    this.colorScheme = defaults(p.colorScheme, 'uniform')\n    this.colorScale = defaults(p.colorScale, '')\n    this.colorReverse = defaults(p.colorReverse, false)\n    this.colorValue = defaults(p.colorValue, 0x909090)\n    this.colorDomain = defaults(p.colorDomain, undefined)\n    this.colorMode = defaults(p.colorMode, 'hcl')\n\n    this.visible = defaults(p.visible, true)\n    this.quality = defaults(p.quality, undefined)\n\n    this.roughness = defaults(p.roughness, 0.4)\n    this.metalness = defaults(p.metalness, 0.0)\n    this.diffuse = defaults(p.diffuse, 0xffffff)\n\n    this.diffuseInterior = defaults(p.diffuseInterior, false)\n    this.useInteriorColor = defaults(p.useInteriorColor, false)\n    this.interiorColor = defaults(p.interiorColor, 0x222222)\n    this.interiorDarkening = defaults(p.interiorDarkening, 0)\n\n    this.lazy = defaults(p.lazy, false)\n    this.lazyProps = {\n      build: false,\n      bufferParams: {},\n      what: {}\n    }\n\n    this.matrix = defaults(p.matrix, new Matrix4())\n\n    this.disablePicking = defaults(p.disablePicking, false)\n\n    // handle common parameters when applicable\n\n    const tp = this.parameters\n\n    if (tp.sphereDetail === true) {\n      tp.sphereDetail = {\n        type: 'integer', max: 3, min: 0, rebuild: 'impostor'\n      }\n    }\n    if (tp.radialSegments === true) {\n      tp.radialSegments = {\n        type: 'integer', max: 25, min: 5, rebuild: 'impostor'\n      }\n    }\n    if (tp.openEnded === true) {\n      tp.openEnded = {\n        type: 'boolean', rebuild: 'impostor', buffer: true\n      }\n    }\n    if (tp.disableImpostor === true) {\n      tp.disableImpostor = {\n        type: 'boolean', rebuild: true\n      }\n    }\n\n    if (p.quality === 'low') {\n      if (tp.sphereDetail) this.sphereDetail = 0\n      if (tp.radialSegments) this.radialSegments = 5\n    } else if (p.quality === 'medium') {\n      if (tp.sphereDetail) this.sphereDetail = 1\n      if (tp.radialSegments) this.radialSegments = 10\n    } else if (p.quality === 'high') {\n      if (tp.sphereDetail) this.sphereDetail = 2\n      if (tp.radialSegments) this.radialSegments = 20\n    } else {\n      if (tp.sphereDetail) {\n        this.sphereDetail = defaults(p.sphereDetail, 1)\n      }\n      if (tp.radialSegments) {\n        this.radialSegments = defaults(p.radialSegments, 10)\n      }\n    }\n\n    if (tp.openEnded) {\n      this.openEnded = defaults(p.openEnded, true)\n    }\n\n    if (tp.disableImpostor) {\n      this.disableImpostor = defaults(p.disableImpostor, false)\n    }\n\n  }\n\n  getColorParams (p?: {[k: string]: any}): { scheme: string, [k: string]: any } & ColormakerParameters {\n    return Object.assign({\n\n      data: this.colorData,\n      scheme: this.colorScheme,\n      scale: this.colorScale,\n      reverse: this.colorReverse,\n      value: this.colorValue,\n      domain: this.colorDomain,\n      mode: this.colorMode,\n      colorSpace: this.colorSpace,\n\n    }, p)\n  }\n\n  getBufferParams (p: {[k: string]: any} = {}) {\n    return Object.assign({\n\n      clipNear: this.clipNear,\n      clipRadius: this.clipRadius,\n      clipCenter: this.clipCenter,\n      flatShaded: this.flatShaded,\n      opacity: this.opacity,\n      depthWrite: this.depthWrite,\n      side: this.side,\n      wireframe: this.wireframe,\n\n      roughness: this.roughness,\n      metalness: this.metalness,\n      diffuse: this.diffuse,\n\n      diffuseInterior: this.diffuseInterior,\n      useInteriorColor: this.useInteriorColor,\n      interiorColor: this.interiorColor,\n      interiorDarkening: this.interiorDarkening,\n\n      matrix: this.matrix,\n\n      disablePicking: this.disablePicking\n\n    }, p)\n  }\n\n  setColor (value: number | string | Color | undefined , p?: Partial<RepresentationParameters>) {\n    const types = Object.keys(ColormakerRegistry.getSchemes())\n\n    if (typeof value === 'string' && types.includes(value.toLowerCase())) {\n      if (p) {\n        p.colorScheme = value\n      } else {\n        this.setParameters({ colorScheme: value })\n      }\n    } else if (value !== undefined) {\n      let val = new Color(value as string).getHex() //TODO\n      if (p) {\n        p.colorScheme = 'uniform'\n        p.colorValue = val\n      } else {\n        this.setParameters({\n          colorScheme: 'uniform', colorValue: val\n        })\n      }\n    }\n\n    return this\n  }\n\n  // TODO\n  prepare (cb: ()=> void) {\n\n  }\n\n  create () {\n    // this.bufferList.length = 0;\n  }\n\n  update (what?: any) {\n    this.build()\n  }\n\n  build (updateWhat?: {[k: string]: boolean}) {\n    if (this.lazy && (!this.visible || !this.opacity)) {\n      this.lazyProps.build = true\n      return\n    }\n\n    if (!this.toBePrepared) {\n      this.tasks.increment()\n      this.make()\n      return\n    }\n\n    // don't let tasks accumulate\n    if (this.queue.length() > 0) {\n      this.tasks.change(1 - this.queue.length())\n      this.queue.kill()\n    } else {\n      this.tasks.increment()\n    }\n\n    this.queue.push(updateWhat || false)\n  }\n\n  make (updateWhat?: boolean, callback?: () => void) {\n    if (Debug) Log.time('Representation.make ' + this.type)\n\n    const _make = () => {\n      if (updateWhat) {\n        this.update(updateWhat)\n        this.viewer.requestRender()\n        this.tasks.decrement()\n        if (callback) callback()\n      } else {\n        this.clear()\n        this.create()\n        if (!this.manualAttach && !this.disposed) {\n          if (Debug) Log.time('Representation.attach ' + this.type)\n          this.attach(() => {\n            if (Debug) Log.timeEnd('Representation.attach ' + this.type)\n            this.tasks.decrement()\n            if (callback) callback()\n          })\n        }\n      }\n\n      if (Debug) Log.timeEnd('Representation.make ' + this.type)\n    }\n\n    if (this.toBePrepared) {\n      this.prepare(_make)\n    } else {\n      _make()\n    }\n  }\n\n  attach (callback: () => void) {\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  /**\n   * Set the visibility of the representation\n   * @param {Boolean} value - visibility flag\n   * @param {Boolean} [noRenderRequest] - whether or not to request a re-render from the viewer\n   * @return {Representation} this object\n   */\n  setVisibility (value: boolean, noRenderRequest?: boolean): Representation {\n    this.visible = value\n\n    if (this.visible && this.opacity) {\n      const lazyProps = this.lazyProps\n      const bufferParams = lazyProps.bufferParams\n      const what = lazyProps.what\n\n      if (lazyProps.build) {\n        lazyProps.build = false\n        this.build()\n        return this\n      } else if (Object.keys(bufferParams).length || Object.keys(what).length) {\n        lazyProps.bufferParams = {}\n        lazyProps.what = {}\n        this.updateParameters(bufferParams, what)\n      }\n    }\n\n    this.bufferList.forEach(function (buffer) {\n      buffer.setVisibility(value)\n    })\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n\n  /**\n   * Set the visibility of the representation\n   * @param {RepresentationParameters} params - parameters object\n   * @param {Object} [what] - buffer data attributes to be updated,\n   *                        note that this needs to be implemented in the\n   *                        derived classes. Generally it allows more\n   *                        fine-grained control over updating than\n   *                        forcing a rebuild.\n   * @param {Boolean} what.position - update position data\n   * @param {Boolean} what.color - update color data\n   * @param {Boolean} [rebuild] - whether or not to rebuild the representation\n   * @return {Representation} this object\n   */\n  setParameters (params: Partial<RepresentationParameters>, what:{[propName: string]: any} = {}, rebuild = false) {\n    const p = params || {}\n    const tp = this.parameters\n    const bufferParams: BufferParameters = <any>{}\n\n    if (!this.opacity && p.opacity !== undefined) {\n      if (this.lazyProps.build) {\n        this.lazyProps.build = false\n        rebuild = true\n      } else {\n        Object.assign(bufferParams, this.lazyProps.bufferParams)\n        Object.assign(what, this.lazyProps.what)\n        this.lazyProps.bufferParams = {}\n        this.lazyProps.what = {}\n      }\n    }\n\n    this.setColor(p.color, p)\n\n    for (let name in p) {\n      if (p[ name ] === undefined) continue\n      if (tp[ name ] === undefined) continue\n\n      if (tp[ name ].int) p[ name ] = parseInt(p[ name ] as string)\n      if (tp[ name ].float) p[ name ] = parseFloat(p[ name ] as string)\n\n      // no value change\n      if (p[ name ] === this[ name ] && (\n        !p[ name ].equals || p[ name ].equals(this[ name ])\n      )) continue\n\n      if (this[ name ] && this[ name ].copy && p[ name ].copy) {\n        this[ name ].copy(p[ name ])\n      } else if (this[ name ] && this[ name ].set) {\n        this[ name ].set(p[ name ])\n      } else {\n        this[ name ] = p[ name ]\n      }\n\n      // buffer param\n      if (tp[ name ].buffer) {\n        if (tp[ name ].buffer === true) {\n          (bufferParams[ name as keyof BufferParameters ] as any) = p[ name ]\n        } else {\n          let key: (keyof BufferParameters) = tp[ name ].buffer;\n          (bufferParams[ key ] as any) = p[ name ]\n        }\n      }\n\n      // mark for update\n      if (tp[ name ].update) {\n        what[ tp[ name ].update ] = true\n      }\n\n      // mark for rebuild\n      if (tp[ name ].rebuild &&\n          !(tp[ name ].rebuild === 'impostor' &&\n            ExtensionFragDepth && !this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    //\n\n    if (rebuild) {\n      this.build()\n    } else {\n      this.updateParameters(bufferParams, what)\n    }\n\n    return this\n  }\n\n  updateParameters (bufferParams: BufferParameters | {} = {}, what?: any) {\n    if (this.lazy && (!this.visible || !this.opacity) && bufferParams.hasOwnProperty('opacity') === false) {\n      Object.assign(this.lazyProps.bufferParams, bufferParams)\n      Object.assign(this.lazyProps.what, what)\n      return\n    }\n\n    this.bufferList.forEach(function (buffer) {\n      buffer.setParameters(bufferParams)\n    })\n\n    if (Object.keys(what).length) {\n      this.update(what) // update buffer attribute\n    }\n\n    this.viewer.requestRender()\n  }\n\n  getParameters () {\n    const params: Partial<RepresentationParameters> = {\n      lazy: this.lazy,\n      visible: this.visible,\n      quality: this.quality\n    }\n\n    Object.keys(this.parameters).forEach(name => {\n      if (this.parameters[ name ] !== null) {\n        params[ name ] = this[ name ]\n      }\n    })\n\n    return params\n  }\n\n  clear () {\n    this.bufferList.forEach(buffer => {\n      this.viewer.remove(buffer)\n      buffer.dispose()\n    })\n    this.bufferList.length = 0\n\n    this.viewer.requestRender()\n  }\n\n  dispose () {\n    this.disposed = true\n    this.queue.kill()\n    this.tasks.dispose()\n    this.clear()\n  }\n}\n\nexport default Representation\n","/**\n * @file Worker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, Debug, WorkerRegistry } from '../globals'\n\nexport default class _Worker {\n\n  pending = 0\n  postCount = 0\n  onmessageDict: { [k: number]: Function|undefined } = {}\n  onerrorDict: { [k: number]: Function|undefined } = {}\n\n  name: string\n  blobUrl: string\n  worker: Worker\n\n  constructor (name: string) {\n\n    this.name = name\n    this.blobUrl = window.URL.createObjectURL(WorkerRegistry.get(name))\n    this.worker = new Worker(this.blobUrl)\n\n    WorkerRegistry.activeWorkerCount += 1\n\n    this.worker.onmessage = (event: any) => {\n      this.pending -= 1\n      const postId = event.data.__postId\n\n      if (Debug) Log.timeEnd('Worker.postMessage ' + name + ' #' + postId)\n\n      const onmessage = this.onmessageDict[ postId ]\n      if (onmessage) {\n        onmessage.call(this.worker, event)\n      } else {\n        // Log.debug('No onmessage', postId, name)\n      }\n\n      delete this.onmessageDict[ postId ]\n      delete this.onerrorDict[ postId ]\n    }\n\n    this.worker.onerror = (event: any) => {\n      this.pending -= 1\n      if (event.data) {\n        const postId = event.data.__postId\n\n        const onerror = this.onerrorDict[ postId ]\n        if (onerror) {\n          onerror.call(this.worker, event)\n        } else {\n          Log.error('Worker.onerror', postId, name, event)\n        }\n\n        delete this.onmessageDict[ postId ]\n        delete this.onerrorDict[ postId ]\n      } else {\n        Log.error('Worker.onerror', name, event)\n      }\n    }\n  }\n\n  post (aMessage: any = {}, transferList?: any, onmessage?: Function, onerror?: Function) {\n    this.onmessageDict[ this.postCount ] = onmessage\n    this.onerrorDict[ this.postCount ] = onerror\n\n    aMessage.__name = this.name\n    aMessage.__postId = this.postCount\n    aMessage.__debug = Debug\n\n    if (Debug) Log.time(`Worker.postMessage ${this.name} #${this.postCount}`)\n\n    try {\n      this.worker.postMessage(aMessage, transferList)\n    } catch (error) {\n      Log.error('worker.post:', error)\n      this.worker.postMessage(aMessage)\n    }\n\n    this.pending += 1\n    this.postCount += 1\n\n    return this\n  }\n\n  terminate () {\n    if (this.worker) {\n      this.worker.terminate()\n      window.URL.revokeObjectURL(this.blobUrl)\n      WorkerRegistry.activeWorkerCount -= 1\n    } else {\n      Log.log('no worker to terminate')\n    }\n  }\n}\n","/**\n * @file Worker Pool\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Worker from './worker'\n\nclass WorkerPool {\n  maxCount: number\n  pool: Worker[] = []\n  count = 0\n  name: string\n\n  constructor (name: string, maxCount = 2) {\n    this.maxCount = Math.min(8, maxCount)\n    this.name = name\n  }\n\n  post (aMessage: any = {}, transferList?: any, onmessage?: Function, onerror?: Function) {\n    const worker = this.getNextWorker()\n    if (worker) {\n      worker.post(aMessage, transferList, onmessage, onerror)\n    } else {\n      console.error('unable to get worker from pool')\n    }\n\n    return this\n  }\n\n  terminate () {\n    this.pool.forEach(function (worker) {\n      worker.terminate()\n    })\n  }\n\n  getNextWorker () {\n    let nextWorker\n    let minPending = Infinity\n\n    for (let i = 0; i < this.maxCount; ++i) {\n      if (i >= this.count) {\n        nextWorker = new Worker(this.name)\n        this.pool.push(nextWorker)\n        this.count += 1\n        break\n      }\n\n      const worker = this.pool[ i ]\n\n      if (worker.pending === 0) {\n        nextWorker = worker\n        break\n      } else if (worker.pending < minPending) {\n        minPending = worker.pending\n        nextWorker = worker\n      }\n    }\n\n    return nextWorker\n  }\n}\n\nWorkerPool.prototype.constructor = WorkerPool\n\nexport default WorkerPool\n","/**\n * @file Vector Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { NumberArray } from '../types'\nimport { EPS } from './math-constants'\n\n/**\n * Calculate the two intersection points\n * Converted to JavaScript from\n * {@link http://paulbourke.net/geometry/pointlineplane/lineline.c}\n */\nexport function lineLineIntersect (p1: Vector3, p2: Vector3, p3: Vector3, p4: Vector3) {\n  const p13 = new Vector3()\n  const p43 = new Vector3()\n  const p21 = new Vector3()\n  let d1343, d4321, d1321, d4343, d2121\n  let denom, numer\n\n  p13.x = p1.x - p3.x\n  p13.y = p1.y - p3.y\n  p13.z = p1.z - p3.z\n  p43.x = p4.x - p3.x\n  p43.y = p4.y - p3.y\n  p43.z = p4.z - p3.z\n  if (Math.abs(p43.x) < EPS && Math.abs(p43.y) < EPS && Math.abs(p43.z) < EPS) { return null }\n\n  p21.x = p2.x - p1.x\n  p21.y = p2.y - p1.y\n  p21.z = p2.z - p1.z\n  if (Math.abs(p21.x) < EPS && Math.abs(p21.y) < EPS && Math.abs(p21.z) < EPS) { return null }\n\n  d1343 = p13.x * p43.x + p13.y * p43.y + p13.z * p43.z\n  d4321 = p43.x * p21.x + p43.y * p21.y + p43.z * p21.z\n  d1321 = p13.x * p21.x + p13.y * p21.y + p13.z * p21.z\n  d4343 = p43.x * p43.x + p43.y * p43.y + p43.z * p43.z\n  d2121 = p21.x * p21.x + p21.y * p21.y + p21.z * p21.z\n\n  denom = d2121 * d4343 - d4321 * d4321\n  if (Math.abs(denom) < EPS) { return null }\n  numer = d1343 * d4321 - d1321 * d4343\n\n  const mua = numer / denom\n  const mub = (d1343 + d4321 * mua) / d4343\n\n  const pa = new Vector3(\n    p1.x + mua * p21.x,\n    p1.y + mua * p21.y,\n    p1.z + mua * p21.z\n  )\n  const pb = new Vector3(\n    p3.x + mub * p43.x,\n    p3.y + mub * p43.y,\n    p3.z + mub * p43.z\n  )\n\n  return [ pa, pb ]\n}\n\nexport function calculateMeanVector3 (array: NumberArray) {\n  const n = array.length\n  const m = n / 3\n\n  let x = 0\n  let y = 0\n  let z = 0\n\n  for (let i = 0; i < n; i += 3) {\n    x += array[ i + 0 ]\n    y += array[ i + 1 ]\n    z += array[ i + 2 ]\n  }\n\n  return new Vector3(x / m, y / m, z / m)\n}\n\nexport function isPointOnSegment (p: Vector3, l1: Vector3, l2: Vector3) {\n  const len = l1.distanceTo(l2)\n\n  return p.distanceTo(l1) <= len && p.distanceTo(l2) <= len\n}\n\nexport function projectPointOnVector (point: Vector3, vector: Vector3, origin?: Vector3) {\n  if (origin) {\n    point.sub(origin).projectOnVector(vector).add(origin)\n  } else {\n    point.projectOnVector(vector)\n  }\n\n  return point\n}\n\nexport function computeBoundingBox (array: NumberArray) {\n  let minX = +Infinity\n  let minY = +Infinity\n  let minZ = +Infinity\n  let maxX = -Infinity\n  let maxY = -Infinity\n  let maxZ = -Infinity\n  for (let i = 0, l = array.length; i < l; i += 3) {\n    const x = array[ i ]\n    const y = array[ i + 1 ]\n    const z = array[ i + 2 ]\n    if (x < minX) minX = x\n    if (y < minY) minY = y\n    if (z < minZ) minZ = z\n    if (x > maxX) maxX = x\n    if (y > maxY) maxY = y\n    if (z > maxZ) maxZ = z\n  }\n  return [\n    v3new([ minX, minY, minZ ]),\n    v3new([ maxX, maxY, maxZ ])\n  ]\n}\n(computeBoundingBox as any).__deps = [ v3new ]\n\nexport function applyMatrix4toVector3array (m: Float32Array, a: Float32Array) {\n  for (let i = 0, il = a.length; i < il; i += 3) {\n    const x = a[ i ]\n    const y = a[ i + 1 ]\n    const z = a[ i + 2 ]\n    a[ i ] = m[ 0 ] * x + m[ 4 ] * y + m[ 8 ] * z + m[ 12 ]\n    a[ i + 1 ] = m[ 1 ] * x + m[ 5 ] * y + m[ 9 ] * z + m[ 13 ]\n    a[ i + 2 ] = m[ 2 ] * x + m[ 6 ] * y + m[ 10 ] * z + m[ 14 ]\n  }\n}\n\nexport function applyMatrix3toVector3array (m: Float32Array, a: Float32Array) {\n  for (let i = 0, il = a.length; i < il; i += 3) {\n    const x = a[ i ]\n    const y = a[ i + 1 ]\n    const z = a[ i + 2 ]\n    a[ i ] = m[ 0 ] * x + m[ 3 ] * y + m[ 6 ] * z\n    a[ i + 1 ] = m[ 1 ] * x + m[ 4 ] * y + m[ 7 ] * z\n    a[ i + 2 ] = m[ 2 ] * x + m[ 5 ] * y + m[ 8 ] * z\n  }\n}\n\nexport function normalizeVector3array (a: Float32Array) {\n  for (let i = 0, il = a.length; i < il; i += 3) {\n    const x = a[ i ]\n    const y = a[ i + 1 ]\n    const z = a[ i + 2 ]\n    const len2 = x * x + y * y + z * z\n    if (len2 > 0) {             // avoid divide by zero\n      const s = 1 / Math.sqrt(len2)\n      a[ i ] = x * s\n      a[ i + 1 ] = y * s\n      a[ i + 2 ] = z * s\n    }\n    // else leave as all zeros\n  }\n}\n\nexport function v3new (array?: NumberArray) {\n  return new Float32Array(array as any || 3)  // TODO\n}\n\nexport function v3cross (out: Float32Array, a: Float32Array, b: Float32Array) {\n  const ax = a[0]\n  const ay = a[1]\n  const az = a[2]\n  const bx = b[0]\n  const by = b[1]\n  const bz = b[2]\n  out[0] = ay * bz - az * by\n  out[1] = az * bx - ax * bz\n  out[2] = ax * by - ay * bx\n}\n\nexport function v3dot (a: Float32Array, b: Float32Array) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]\n}\n\nexport function v3sub (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] - b[0]\n  out[1] = a[1] - b[1]\n  out[2] = a[2] - b[2]\n}\n\nexport function v3add (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] + b[0]\n  out[1] = a[1] + b[1]\n  out[2] = a[2] + b[2]\n}\n\nexport function v3fromArray (out: Float32Array, array: Float32Array, offset = 0) {\n  out[0] = array[offset]\n  out[1] = array[offset + 1]\n  out[2] = array[offset + 2]\n}\n\nexport function v3toArray (input: Float32Array, array: Float32Array, offset = 0) {\n  array[offset] = input[0]\n  array[offset + 1] = input[1]\n  array[offset + 2] = input[2]\n}\n\nexport function v3forEach (array: Float32Array, fn: (i: Float32Array, j: Float32Array, k: Float32Array) => void, b: Float32Array) {\n  const a = v3new()\n  for (let i = 0, n = array.length; i < n; i += 3) {\n    v3fromArray(a, array, i)\n    fn(a, a, b)\n    v3toArray(a, array, i)\n  }\n}\n(v3forEach as any).__deps = [ v3new, v3fromArray, v3toArray ]\n\nexport function v3length2 (a: Float32Array) {\n  return a[0] * a[0] + a[1] * a[1] + a[2] * a[2]\n}\n\nexport function v3length (a: Float32Array) {\n  return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2])\n}\n\nexport function v3divide (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] / b[0]\n  out[1] = a[1] / b[1]\n  out[2] = a[2] / b[2]\n}\n\nexport function v3multiply (out: Float32Array, a: Float32Array, b: Float32Array) {\n  out[0] = a[0] * b[0]\n  out[1] = a[1] * b[1]\n  out[2] = a[2] * b[2]\n}\n\nexport function v3divideScalar (out: Float32Array, a: Float32Array, s: number) {\n  v3multiplyScalar(out, a, 1 / s)\n}\n(v3divideScalar as any).__deps = [ v3multiplyScalar ]\n\nexport function v3multiplyScalar (out: Float32Array, a: Float32Array, s: number) {\n  out[0] = a[0] * s\n  out[1] = a[1] * s\n  out[2] = a[2] * s\n}\n\nexport function v3normalize (out: Float32Array, a: Float32Array) {\n  const length2 = v3length2(a)\n  if (length2 == 0) {\n    out[0] = a[0]\n    out[1] = a[1]\n    out[2] = a[2]\n  } else {\n    v3multiplyScalar(out, a, 1 / Math.sqrt(length2))\n  }\n}\n(v3normalize as any).__deps = [ v3multiplyScalar, v3length2 ]\n\nexport function v3subScalar (out: Float32Array, a: Float32Array, s: number) {\n  out[0] = a[0] - s\n  out[1] = a[1] - s\n  out[2] = a[2] - s\n}\n\nexport function v3addScalar (out: Float32Array, a: Float32Array, s: number) {\n  out[0] = a[0] + s\n  out[1] = a[1] + s\n  out[2] = a[2] + s\n}\n\nexport function v3floor (out: Float32Array, a: Float32Array) {\n  out[0] = Math.floor(a[0])\n  out[1] = Math.floor(a[1])\n  out[2] = Math.floor(a[2])\n}\n\nexport function v3ceil (out: Float32Array, a: Float32Array) {\n  out[0] = Math.ceil(a[0])\n  out[1] = Math.ceil(a[1])\n  out[2] = Math.ceil(a[2])\n}\n\nexport function v3round (out: Float32Array, a: Float32Array) {\n  out[0] = Math.round(a[0])\n  out[1] = Math.round(a[1])\n  out[2] = Math.round(a[2])\n}\n\nexport function v3negate (out: Float32Array, a: Float32Array) {\n  out[0] = -a[0]\n  out[1] = -a[1]\n  out[2] = -a[2]\n}\n\nexport function v3angle (a: Float32Array, b: Float32Array) {\n  const ax = a[0]\n  const ay = a[1]\n  const az = a[2]\n  const bx = b[0]\n  const by = b[1]\n  const bz = b[2]\n  const cx = ay * bz - az * by\n  const cy = az * bx - ax * bz\n  const cz = ax * by - ay * bx\n  const s = Math.sqrt(cx * cx + cy * cy + cz * cz)\n  const c = ax * bx + ay * by + az * bz\n  return Math.atan2(s, c)\n}\n","/**\n * @file Dash\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport { WideLineBufferData } from '../buffer/wideline-buffer'\nimport {\n  calculateDirectionArray, calculateCenterArray,\n  replicateArrayEntries, replicateArray3Entries\n} from '../math/array-utils'\n\nexport function getFixedCountDashData<T extends CylinderBufferData|WideLineBufferData> (data: T, segmentCount: number = 9) {\n\n  const s = Math.floor(segmentCount / 2)\n  const n = data.position1.length / 3\n  const sn = s * n\n  const sn3 = sn * 3\n  const step = 1 / segmentCount\n\n  const direction = calculateDirectionArray(data.position1, data.position2)\n  const position1 = new Float32Array(sn3)\n  const position2 = new Float32Array(sn3)\n\n  const v = new Vector3()\n\n  for (let i = 0; i < n; ++i) {\n    const i3 = i * 3\n    v.set(direction[ i3 ], direction[ i3 + 1 ], direction[ i3 + 2 ])\n\n    const x = data.position1[ i3 ]\n    const y = data.position1[ i3 + 1 ]\n    const z = data.position1[ i3 + 2 ]\n\n    for (let j = 0; j < s; ++j) {\n      const j3 = s * i3 + j * 3\n\n      const f1 = step * (j * 2 + 1)\n      const f2 = step * (j * 2 + 2)\n\n      position1[ j3 ] = x + v.x * f1\n      position1[ j3 + 1 ] = y + v.y * f1\n      position1[ j3 + 2 ] = z + v.z * f1\n\n      position2[ j3 ] = x + v.x * f2\n      position2[ j3 + 1 ] = y + v.y * f2\n      position2[ j3 + 2 ] = z + v.z * f2\n    }\n  }\n\n  const position = calculateCenterArray(position1, position2) as Float32Array\n  const color = replicateArray3Entries(data.color!, s)  // TODO\n  const color2 = color\n\n  const d: any = { position, position1, position2, color, color2 }\n\n  if ((data as any).radius) {  // TODO\n    d.radius = replicateArrayEntries((data as any).radius, s)  // TODO\n  }\n\n  if (data.picking && data.picking.array) {\n    data.picking.array = replicateArrayEntries(data.picking.array, s)\n    d.picking = data.picking\n  }\n  if (data.primitiveId) {\n    d.primitiveId = replicateArrayEntries(data.primitiveId, s)\n  }\n\n  return d as T\n}\n\nexport function getFixedLengthDashData<T extends CylinderBufferData|WideLineBufferData> (data: T, segmentLength: number = 0.1) {\n\n  const direction = calculateDirectionArray(data.position1, data.position2)\n  const pos1: number[] = []\n  const pos2: number[] = []\n  const col: number[] = []\n  const rad: number[]|undefined = (data as any).radius ? [] : undefined\n  const pick: number[]|undefined = (data as any).picking ? [] : undefined\n  const id: number[]|undefined = (data as any).primitiveId ? [] : undefined\n\n  const v = new Vector3()\n  const n = data.position1.length / 3\n\n  let k = 0\n\n  for (let i = 0; i < n; ++i) {\n    const i3 = i * 3\n    v.set(direction[ i3 ], direction[ i3 + 1 ], direction[ i3 + 2 ])\n\n    const vl = v.length()\n    const segmentCount = vl / segmentLength\n    const s = Math.floor(segmentCount / 2)\n    const step = 1 / segmentCount\n\n    const x = data.position1[ i3 ]\n    const y = data.position1[ i3 + 1 ]\n    const z = data.position1[ i3 + 2 ]\n\n    for (let j = 0; j < s; ++j) {\n      const j3 = k * 3 + j * 3\n\n      const f1 = step * (j * 2 + 1)\n      const f2 = step * (j * 2 + 2)\n\n      pos1[ j3 ] = x + v.x * f1\n      pos1[ j3 + 1 ] = y + v.y * f1\n      pos1[ j3 + 2 ] = z + v.z * f1\n\n      pos2[ j3 ] = x + v.x * f2\n      pos2[ j3 + 1 ] = y + v.y * f2\n      pos2[ j3 + 2 ] = z + v.z * f2\n\n      if (data.color) {\n        col[ j3 ] = data.color[ i3 ]\n        col[ j3 + 1 ] = data.color[ i3 + 1 ]\n        col[ j3 + 2 ] = data.color[ i3 + 2 ]\n      }\n\n      if (rad) rad[ k + j ] = (data as any).radius[ i ]\n      if (pick) {\n        if ((data as any).picking.array) {\n          pick[ k + j ] = (data as any).picking.array[ i ]\n        } else {\n          pick[ k + j ] = i\n        }\n      }\n      if (id) id[ k + j ] = (data as any).primitiveId[ i ]\n    }\n\n    k += s\n  }\n\n  const position1 = new Float32Array(pos1)\n  const position2 = new Float32Array(pos2)\n  const position = calculateCenterArray(position1, position2) as Float32Array\n  const color = new Float32Array(col)\n  const color2 = color\n\n  const d: any = { position, position1, position2, color, color2 }\n\n  if (rad) d.radius = new Float32Array(rad)\n  if (pick && data.picking) {\n    data.picking.array = new Float32Array(pick)\n    d.picking = data.picking\n  }\n  if (id) d.primitiveId = new Float32Array(id)\n\n  return d as T\n}\n\nexport function getFixedLengthWrappedDashData<T extends CylinderBufferData|WideLineBufferData> (data: T, segmentLength: number = 0.1) {\n\n  const direction = calculateDirectionArray(data.position1, data.position2)\n  const pos1: number[] = []\n  const pos2: number[] = []\n  const col: number[] = []\n  const rad: number[]|undefined = (data as any).radius ? [] : undefined\n  const pick: number[]|undefined = (data as any).picking ? [] : undefined\n  const id: number[]|undefined = (data as any).primitiveId ? [] : undefined\n\n  const v = new Vector3()\n  const n = data.position1.length / 3\n\n  let remaining = segmentLength\n  let drawing = true\n\n  let k = 0\n  let k3 = 0\n  let kprev = 0\n\n  for (let i = 0; i < n; ++i) {\n    const i3 = i * 3\n    const x = data.position1[ i3 ]\n    const y = data.position1[ i3 + 1 ]\n    const z = data.position1[ i3 + 2 ]\n\n    v.set(direction[ i3 ], direction[ i3 + 1 ], direction[ i3 + 2 ])\n    const vl = v.length()\n\n    if (drawing) {\n      pos1[ k3 ] = x\n      pos1[ k3 + 1 ] = y\n      pos1[ k3 + 2 ] = z\n    }\n\n    let dist = remaining\n    const inv = 1 / vl\n    while (dist < vl) {\n      const a = drawing ? pos2 : pos1\n      a[ k3 ] = x + v.x * dist * inv\n      a[ k3 + 1 ] = y +         v.y * dist * inv\n      a[ k3 + 2 ] = z + v.z * dist * inv\n      if (drawing) {\n        k++\n        k3 = k * 3\n      }\n      drawing = !drawing\n      remaining = segmentLength\n      dist += segmentLength\n    }\n\n    if (drawing) {\n      pos2[ k3 ] = data.position2[ i3 ]\n      pos2[ k3 + 1 ] = data.position2[ i3 + 1 ]\n      pos2[ k3 + 2 ] = data.position2[ i3 + 2 ]\n      k++\n      k3 = k * 3\n    }\n\n    remaining = dist - vl\n\n    for (let j = kprev; j < k ; j++){\n      if (data.color) {\n        const j3 = j * 3\n        col[ j3 ] = data.color[ i3 ]\n        col[ j3 + 1 ] = data.color[ i3 + 1 ]\n        col[ j3 + 2 ] = data.color[ i3 + 2 ]\n      }\n\n      if (rad) rad[ j ] = (data as any).radius[ i ]\n      if (pick) {\n        if ((data as any).picking.array) {\n          pick[ j ] = (data as any).picking.array[ i ]\n        } else {\n          pick[ j ] = i\n        }\n      }\n      if (id) id[ j ] = (data as any).primitiveId[ i ]\n    }\n\n    kprev = k\n\n  }\n\n  if (!drawing && n > 0) {\n    const k3 = k * 3\n    pos2[ k3 ] = data.position2[ 3 * n - 3 ]\n    pos2[ k3 + 1 ] = data.position2[ 3 * n - 2 ]\n    pos2[ k3 + 1 ] = data.position2[ 3 * n - 1 ]\n  }\n\n  const position1 = new Float32Array(pos1)\n  const position2 = new Float32Array(pos2)\n  const position = calculateCenterArray(position1, position2) as Float32Array\n  const color = new Float32Array(col)\n  const color2 = color\n\n  const d: any = { position, position1, position2, color, color2 }\n\n  if (rad) d.radius = new Float32Array(rad)\n  if (pick && data.picking) {\n    data.picking.array = new Float32Array(pick)\n    d.picking = data.picking\n  }\n  if (id) d.primitiveId = new Float32Array(id)\n\n  return d as T\n}\n","/**\n * @file Primitive\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Color, Box3 } from 'three'\n\nimport { BufferRegistry, PickerRegistry } from '../globals'\nimport Shape from './shape'\nimport { getFixedLengthDashData } from './dash'\n\nfunction addElement (elm: any, array: any[]) {\n  if (elm.toArray !== undefined) {\n    elm = elm.toArray()\n  } else if (elm.x !== undefined) {\n    elm = [ elm.x, elm.y, elm.z ]\n  } else if (elm.r !== undefined) {\n    elm = [ elm.r, elm.g, elm.b ]\n  }\n  array.push.apply(array, elm)\n}\n\nconst tmpVec = new Vector3()\n\nexport type PrimitiveFields = { [k: string]: string }\n\n/**\n * Base class for geometry primitives\n * @interface\n */\nexport abstract class Primitive {\n  static type = ''\n  static fields: PrimitiveFields = {}\n\n  static get Picker () { return PickerRegistry.get(this.type) }\n  static get Buffer () { return BufferRegistry.get(this.type) }\n\n  static getShapeKey (name: string) {\n    return this.type + name[0].toUpperCase() + name.substr(1)\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {}\n\n  static valueToShape (shape: Shape, name: string, value: any) {\n    const data = shape._primitiveData[this.getShapeKey(name)]\n    const type = this.fields[name]\n\n    switch (type) {\n      case 'v3':\n      case 'c':\n        addElement(value, data)\n        break\n      default:\n        data.push(value)\n    }\n  }\n\n  static objectToShape (shape: Shape, data: any) {\n    Object.keys(this.fields).forEach(name => {\n      this.valueToShape(shape, name, data[name])\n    })\n    this.valueToShape(shape, 'name', data.name)\n    this.expandBoundingBox(shape.boundingBox, data)\n  }\n\n  static valueFromShape (shape: Shape, pid: number, name: string) {\n    const data = shape._primitiveData[this.getShapeKey(name)]\n    const type = this.fields[name]\n\n    switch (type) {\n      case 'v3':\n        return new Vector3().fromArray(data, 3 * pid)\n      case 'c':\n        return new Color().fromArray(data, 3 * pid)\n      default:\n        return data[pid]\n    }\n  }\n\n  static objectFromShape (shape: Shape, pid: number) {\n    let name = this.valueFromShape(shape, pid, 'name')\n    if (name === undefined) {\n      name = `${this.type}: ${pid} (${shape.name})`\n    }\n    const o: any = { shape, name }\n\n    Object.keys(this.fields).forEach(name => {\n      o[name] = this.valueFromShape(shape, pid, name)\n    })\n\n    return o\n  }\n\n  static arrayFromShape (shape: Shape, name: string) {\n    const data = shape._primitiveData[this.getShapeKey(name)]\n    const type = this.fields[name]\n\n    switch (type) {\n      case 's':\n        return data\n      default:\n        return new Float32Array(data)\n    }\n  }\n\n  static dataFromShape (shape: Shape) {\n    const data: any = {}\n\n    if (this.Picker) {\n      data.picking = new this.Picker(shape)\n    }\n\n    Object.keys(this.fields).forEach(name => {\n      data[name] = this.arrayFromShape(shape, name)\n    })\n\n    return data\n  }\n\n  static bufferFromShape (shape: Shape, params: any) {\n    return new this.Buffer(this.dataFromShape(shape), params)\n  }\n}\n\n/**\n * Sphere geometry primitive\n */\nexport class SpherePrimitive extends Primitive {\n  static type = 'sphere'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    radius: 'f'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Box geometry primitive\n */\nexport class BoxPrimitive extends Primitive {\n  static type = 'box'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    size: 'f',\n    heightAxis: 'v3',\n    depthAxis: 'v3'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Octahedron geometry primitive\n */\nexport class OctahedronPrimitive extends BoxPrimitive {\n  static type = 'octahedron'\n}\n\n/**\n * Tetrahedron geometry primitive\n */\nexport class TetrahedronPrimitive extends BoxPrimitive {\n  static type = 'tetrahedron'\n}\n\n/**\n * Cylinder geometry primitive\n */\nexport class CylinderPrimitive extends Primitive {\n  static type = 'cylinder'\n\n  static fields = {\n    position1: 'v3',\n    position2: 'v3',\n    color: 'c',\n    radius: 'f'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    const p1 = this.valueFromShape(shape, pid, 'position1')\n    const p2 = this.valueFromShape(shape, pid, 'position2')\n    return p1.add(p2).multiplyScalar(0.5)\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position1))\n    box.expandByPoint(tmpVec.fromArray(data.position2))\n  }\n\n  static bufferFromShape (shape: Shape, params: any = {}) {\n    let data = this.dataFromShape(shape)\n    if (this.type === 'cylinder' && params.dashedCylinder) {\n      data = getFixedLengthDashData(data)\n    }\n    return new this.Buffer(data, params)\n  }\n}\n\n/**\n * Arrow geometry primitive\n */\nexport class ArrowPrimitive extends CylinderPrimitive {\n  static type = 'arrow'\n}\n\n/**\n * Cone geometry primitive\n */\nexport class ConePrimitive extends CylinderPrimitive {\n  static type = 'cone'\n}\n\n/**\n * Ellipsoid geometry primitive\n */\nexport class EllipsoidPrimitive extends SpherePrimitive {\n  static type = 'ellipsoid'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    radius: 'f',\n    majorAxis: 'v3',\n    minorAxis: 'v3'\n  }\n}\n\n/**\n * Torus geometry primitive\n */\nexport class TorusPrimitive extends EllipsoidPrimitive {\n  static type = 'torus'\n}\n\n/**\n * Text geometry primitive\n */\nexport class TextPrimitive extends Primitive {\n  static type = 'text'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n    size: 'f',\n    text: 's'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Point primitive\n */\nexport class PointPrimitive extends Primitive {\n  static type = 'point'\n\n  static fields = {\n    position: 'v3',\n    color: 'c',\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    return this.valueFromShape(shape, pid, 'position')\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position))\n  }\n}\n\n/**\n * Wideline geometry primitive\n */\nexport class WidelinePrimitive extends Primitive {\n  static type = 'wideline'\n\n  static fields = {\n    position1: 'v3',\n    position2: 'v3',\n    color: 'c'\n  }\n\n  static positionFromShape (shape: Shape, pid: number) {\n    const p1 = this.valueFromShape(shape, pid, 'position1')\n    const p2 = this.valueFromShape(shape, pid, 'position2')\n    return p1.add(p2).multiplyScalar(0.5)\n  }\n\n  static expandBoundingBox (box: Box3, data: any) {\n    box.expandByPoint(tmpVec.fromArray(data.position1))\n    box.expandByPoint(tmpVec.fromArray(data.position2))\n  }\n}\n","/**\n * @file Spatial Hash\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Box3 } from 'three'\n\nexport type Positions = {\n  x: ArrayLike<number>,\n  y: ArrayLike<number>,\n  z: ArrayLike<number>,\n  count?:number\n}\n\nfunction createBoundingBox(positions: Positions) {\n    const { x, y, z } = positions\n    const boundingBox = new Box3()\n    const count = x.length\n    const { min, max } = boundingBox\n\n    for (let i = 0; i < count; i++) {\n        min.x = Math.min(x[i], min.x)\n        min.y = Math.min(y[i], min.y)\n        min.z = Math.min(z[i], min.z)\n        max.x = Math.max(x[i], max.x)\n        max.y = Math.max(y[i], max.y)\n        max.z = Math.max(z[i], max.z)\n    }\n\n    return boundingBox\n}\n\nexport default class SpatialHash {\n  exp = 3\n\n  minX: number\n  minY: number\n  minZ: number\n\n  boundX: number\n  boundY: number\n  boundZ: number\n\n  grid: Uint32Array\n  bucketCount: Uint16Array\n  bucketOffset: Uint32Array\n  bucketArray: Int32Array\n\n  xArray: ArrayLike<number>\n  yArray: ArrayLike<number>\n  zArray: ArrayLike<number>\n\n  constructor(positions: Positions, boundingBox?: Box3) {\n    const bb = boundingBox || createBoundingBox(positions)\n    this.minX = bb.min.x\n    this.minY = bb.min.y\n    this.minZ = bb.min.z\n    this.boundX = ((bb.max.x - this.minX) >> this.exp) + 1\n    this.boundY = ((bb.max.y - this.minY) >> this.exp) + 1\n    this.boundZ = ((bb.max.z - this.minZ) >> this.exp) + 1\n\n    const n = this.boundX * this.boundY * this.boundZ\n    const an = (positions.count !== undefined) ? positions.count : positions.x.length\n\n    const xArray = positions.x\n    const yArray = positions.y\n    const zArray = positions.z\n\n    let count = 0\n    const grid = new Uint32Array(n)\n    const bucketIndex = new Int32Array(an)\n    for (let i = 0; i < an; ++i) {\n      const x = (xArray[ i ] - this.minX) >> this.exp\n      const y = (yArray[ i ] - this.minY) >> this.exp\n      const z = (zArray[ i ] - this.minZ) >> this.exp\n      const idx = (((x * this.boundY) + y) * this.boundZ) + z\n      if ((grid[ idx ] += 1) === 1) {\n        count += 1\n      }\n      bucketIndex[ i ] = idx\n    }\n\n    const bucketCount = new Uint16Array(count)\n    for (let i = 0, j = 0; i < n; ++i) {\n      const c = grid[ i ]\n      if (c > 0) {\n        grid[ i ] = j + 1\n        bucketCount[ j ] = c\n        j += 1\n      }\n    }\n\n    const bucketOffset = new Uint32Array(count)\n    for (let i = 1; i < count; ++i) {\n      bucketOffset[ i ] += bucketOffset[ i - 1 ] + bucketCount[ i - 1 ]\n    }\n\n    const bucketFill = new Uint16Array(count)\n    const bucketArray = new Int32Array(an)\n    for (let i = 0; i < an; ++i) {\n      const bucketIdx = grid[ bucketIndex[ i ] ]\n      if (bucketIdx > 0) {\n        const k = bucketIdx - 1\n        bucketArray[ bucketOffset[ k ] + bucketFill[ k ] ] = i\n        bucketFill[ k ] += 1\n      }\n    }\n\n    this.grid = grid\n    this.bucketCount = bucketCount\n    this.bucketOffset = bucketOffset\n    this.bucketArray = bucketArray\n\n    this.xArray = xArray\n    this.yArray = yArray\n    this.zArray = zArray\n  }\n\n  within (x: number, y: number, z: number, r: number) {\n    const result: number[] = []\n\n    this.eachWithin(x, y, z, r, atomIndex => result.push(atomIndex))\n\n    return result\n  }\n\n  eachWithin (x: number, y: number, z: number, r: number, callback: (atomIndex: number, dSq: number) => void) {\n    const rSq = r * r\n\n    const loX = Math.max(0, (x - r - this.minX) >> this.exp)\n    const loY = Math.max(0, (y - r - this.minY) >> this.exp)\n    const loZ = Math.max(0, (z - r - this.minZ) >> this.exp)\n\n    const hiX = Math.min(this.boundX, ((x + r - this.minX) >> this.exp) + 1)\n    const hiY = Math.min(this.boundY, ((y + r - this.minY) >> this.exp) + 1)\n    const hiZ = Math.min(this.boundZ, ((z + r - this.minZ) >> this.exp) + 1)\n\n    for (let ix = loX; ix < hiX; ++ix) {\n      for (let iy = loY; iy < hiY; ++iy) {\n        for (let iz = loZ; iz < hiZ; ++iz) {\n          const idx = (((ix * this.boundY) + iy) * this.boundZ) + iz\n          const bucketIdx = this.grid[ idx ]\n\n          if (bucketIdx > 0) {\n            const k = bucketIdx - 1\n            const offset = this.bucketOffset[ k ]\n            const count = this.bucketCount[ k ]\n            const end = offset + count\n\n            for (let i = offset; i < end; ++i) {\n              const atomIndex = this.bucketArray[ i ]\n              const dx = this.xArray[ atomIndex ] - x\n              const dy = this.yArray[ atomIndex ] - y\n              const dz = this.zArray[ atomIndex ] - z\n\n              const dSq = dx * dx + dy * dy + dz * dz\n              if (dSq <= rSq) callback(atomIndex, dSq)\n            }\n          }\n        }\n      }\n    }\n  }\n}","/**\n * @file Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log } from '../globals'\nimport { getTypedArray, TypedArrayString } from '../utils'\n\nexport type StoreField = [string, number, TypedArrayString]\n\n/**\n * Store base class\n * @interface\n */\nexport default class Store {\n  [k: string]: any\n\n  length: number\n  count: number\n\n  _fields: StoreField[]\n  get _defaultFields(): StoreField[] { return [] }\n\n  /**\n   * @param {Integer} [size] - initial size\n   */\n  constructor (size = 0) {\n    this._fields = this._defaultFields\n    this._init(0)\n  }\n\n  /**\n   * Initialize the store\n   * @param  {Integer} size - size to initialize\n   * @return {undefined}\n   */\n  _init (size: number) {\n    this.length = size\n    this.count = 0\n\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const [name, size, type]: StoreField = this._fields[ i ]\n      this._initField(name, size, type)\n    }\n  }\n\n  /**\n   * Initialize a field\n   * @param  {String} name - field name\n   * @param  {Integer} size - element size\n   * @param  {String} type - data type, one of int8, int16, int32,\n   *                         uint8, uint16, uint32, float32\n   * @return {undefined}\n   */\n  _initField (name: string, size: number, type: TypedArrayString) {\n    this[ name ] = getTypedArray(type, this.length * size)\n  }\n\n  /**\n   * Add a field\n   * @param  {String} name - field name\n   * @param  {Integer} size - element size\n   * @param  {String} type - data type, one of int8, int16, int32,\n   *                         uint8, uint16, uint32, float32\n   * @return {undefined}\n   */\n  addField (name: string, size: number, type: TypedArrayString) {\n    this._fields.push([name, size, type])\n    this._initField(name, size, type)\n  }\n\n  /**\n   * Resize the store to the new size\n   * @param  {Integer} size - new size\n   * @return {undefined}\n   */\n  resize (size?: number) {\n    // Log.time( \"Store.resize\" );\n\n    this.length = Math.round(size || 0)\n    this.count = Math.min(this.count, this.length)\n\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      const itemSize = this._fields[ i ][ 1 ]\n      const arraySize = this.length * itemSize\n      const tmpArray = new this[ name ].constructor(arraySize)\n\n      if (this[ name ].length > arraySize) {\n        tmpArray.set(this[ name ].subarray(0, arraySize))\n      } else {\n        tmpArray.set(this[ name ])\n      }\n      this[ name ] = tmpArray\n    }\n\n    // Log.timeEnd( \"Store.resize\" );\n  }\n\n  /**\n   * Resize the store to 1.5 times its current size if full\n   * @return {undefined}\n   */\n  growIfFull () {\n    if (this.count >= this.length) {\n      const size = Math.round(this.length * 1.5)\n      this.resize(Math.max(256, size))\n    }\n  }\n\n  /**\n   * Copy data from one store to another\n   * @param  {Store} other - store to copy from\n   * @param  {Integer} thisOffset - offset to start copying to\n   * @param  {Integer} otherOffset - offset to start copying from\n   * @param  {Integer} length - number of entries to copy\n   * @return {undefined}\n   */\n  copyFrom (other: Store, thisOffset: number, otherOffset: number, length: number) {\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      const itemSize = this._fields[ i ][ 1 ]\n      const thisField = this[ name ]\n      const otherField = other[ name ]\n\n      for (let j = 0; j < length; ++j) {\n        const thisIndex = itemSize * (thisOffset + j)\n        const otherIndex = itemSize * (otherOffset + j)\n        for (let k = 0; k < itemSize; ++k) {\n          thisField[ thisIndex + k ] = otherField[ otherIndex + k ]\n        }\n      }\n    }\n  }\n\n  /**\n   * Copy data within this store\n   * @param  {Integer} thisOffset - offset to start copying to\n   * @param  {Integer} otherOffset - offset to start copying from\n   * @param  {Integer} length - number of entries to copy\n   * @return {undefined}\n   */\n  copyWithin (offsetTarget: number, offsetSource: number, length: number) {\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      const itemSize = this._fields[ i ][ 1 ]\n      const thisField = this[ name ]\n\n      for (let j = 0; j < length; ++j) {\n        const targetIndex = itemSize * (offsetTarget + j)\n        const sourceIndex = itemSize * (offsetSource + j)\n        for (let k = 0; k < itemSize; ++k) {\n          thisField[ targetIndex + k ] = thisField[ sourceIndex + k ]\n        }\n      }\n    }\n  }\n\n  /**\n   * Sort entries in the store given the compare function\n   * @param  {[type]} compareFunction - function to sort by\n   * @return {undefined}\n   */\n  sort (compareFunction: (a: any, b: any) => number) {\n    Log.time('Store.sort')\n\n    const thisStore = this\n    const tmpStore = new (this.constructor as any)(1)\n\n    function swap (index1: number, index2: number) {\n      if (index1 === index2) return\n      tmpStore.copyFrom(thisStore, 0, index1, 1)\n      thisStore.copyWithin(index1, index2, 1)\n      thisStore.copyFrom(tmpStore, index2, 0, 1)\n    }\n\n    function quicksort (left: number, right: number) {\n      if (left < right) {\n        let pivot = Math.floor((left + right) / 2)\n        let leftNew = left\n        let rightNew = right\n        do {\n          while (compareFunction(leftNew, pivot) < 0) {\n            leftNew += 1\n          }\n          while (compareFunction(rightNew, pivot) > 0) {\n            rightNew -= 1\n          }\n          if (leftNew <= rightNew) {\n            if (leftNew === pivot) {\n              pivot = rightNew\n            } else if (rightNew === pivot) {\n              pivot = leftNew\n            }\n            swap(leftNew, rightNew)\n            leftNew += 1\n            rightNew -= 1\n          }\n        } while (leftNew <= rightNew)\n        quicksort(left, rightNew)\n        quicksort(leftNew, right)\n      }\n    }\n\n    quicksort(0, this.count - 1)\n\n    Log.timeEnd('Store.sort')\n  }\n\n  /**\n   * Empty the store\n   * @return {undefined}\n   */\n  clear () {\n    this.count = 0\n  }\n\n  /**\n   * Dispose of the store entries and fields\n   * @return {undefined}\n   */\n  dispose () {\n\n    for (let i = 0, il = this._fields.length; i < il; ++i) {\n      const name = this._fields[ i ][ 0 ]\n      delete this[ name ]\n    }\n  }\n}\n","/**\n * @file Contact Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Bond store\n */\nexport default class ContactStore extends Store {\n  index1: Uint32Array\n  index2: Uint32Array\n  type: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'index1', 1, 'int32' ],\n      [ 'index2', 1, 'int32' ],\n      [ 'type', 1, 'int8' ]\n    ] as StoreField[]\n  }\n\n  addContact (index1: number, index2: number, type?: number) {\n    this.growIfFull()\n\n    const i = this.count\n\n    if (index1 < index2) {\n      this.index1[ i ] = index1\n      this.index2[ i ] = index2\n    } else {\n      this.index2[ i ] = index1\n      this.index1[ i ] = index2\n    }\n    if (type) this.type[ i ] = type\n\n    this.count += 1\n  }\n}","/**\n * @file Bit array\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Paul Pillot <paulpillot@gmail.com>\n * @private\n */\n\n/**\n * Compute the Hamming weight of a 32-bit unsigned integer\n * @param  {Integer} v - a 32-bit unsigned integer\n * @return {Integer} the Hamming weight\n */\nfunction hammingWeight (v: number) {\n  // works with signed or unsigned shifts\n  v -= ((v >>> 1) & 0x55555555)\n  v = (v & 0x33333333) + ((v >>> 2) & 0x33333333)\n  return ((v + (v >>> 4) & 0xF0F0F0F) * 0x1010101) >>> 24\n}\n\n/**\n * Bit array\n *\n * Based heavily on https://github.com/lemire/FastBitSet.js\n * which is licensed under the Apache License, Version 2.0.\n */\nexport default class BitArray {\n  private _words: Uint32Array\n  public length: number\n\n  /**\n   * @param  {Integer} length - array length\n   * @param  {Boolean} [setAll] - initialize with true\n   */\n  constructor (length: number, setAll?: boolean) {\n    this.length = length\n    this._words = new Uint32Array((length + 32) >>> 5)\n    if (setAll === true) {\n      this.setAll()\n    }\n  }\n\n  /**\n   * Get value at index\n   * @param  {Integer} index - the index\n   * @return {Boolean} value\n   */\n  get (index: number) {\n    return (this._words[ index >>> 5 ] & (1 << index)) !== 0\n  }\n\n  /**\n   * Set value at index to true\n   * @param  {Integer} index - the index\n   * @return {undefined}\n   */\n  set (index: number) {\n    this._words[ index >>> 5 ] |= 1 << index\n  }\n\n  /**\n   * Set value at index to false\n   * @param  {Integer} index - the index\n   * @return {undefined}\n   */\n  clear (index: number) {\n    this._words[ index >>> 5 ] &= ~(1 << index)\n  }\n\n  /**\n   * Flip value at index\n   * @param  {Integer} index - the index\n   * @return {undefined}\n   */\n  flip (index: number) {\n    this._words[ index >>> 5 ] ^= 1 << index\n  }\n\n  _assignRange (start: number, end: number, value: boolean) {\n    if (end < start) return\n    const words = this._words\n    const wordValue = value === true ? 0xFFFFFFFF : 0\n    const wordStart = start >>> 5\n    const wordEnd = end >>> 5\n        // set complete words when applicable\n    for (let k = wordStart + 1; k < wordEnd; ++k) {\n      words[ k ] = wordValue\n    }\n        // set parts of the range not spanning complete words\n    const startWord = wordStart << 5\n    const endWord = wordEnd << 5\n    if (value === true) {\n      if (end - start < 32) {\n        for (let i = start, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] |= 1 << i\n        }\n      } else {\n        for (let i = start, n = startWord + 32; i < n; ++i) {\n          words[ i >>> 5 ] |= 1 << i\n        }\n        for (let i = endWord, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] |= 1 << i\n        }\n      }\n    } else {\n      if (end - start < 32) {\n        for (let i = start, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] &= ~(1 << i)\n        }\n      } else {\n        for (let i = start, n = startWord + 32; i < n; ++i) {\n          words[ i >>> 5 ] &= ~(1 << i)\n        }\n        for (let i = endWord, n = end + 1; i < n; ++i) {\n          words[ i >>> 5 ] &= ~(1 << i)\n        }\n      }\n    }\n    return this\n  }\n\n  /**\n   * Set bits of the given range\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  setRange (start: number, end: number) {\n    return this._assignRange(start, end, true)\n  }\n\n  /**\n   * Clear bits of the given range\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  clearRange (start: number, end: number) {\n    return this._assignRange(start, end, false)\n  }\n\n  /**\n   * Set bits at all given indices\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} this object\n   */\n  setBits (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      words[ index >>> 5 ] |= 1 << index\n    }\n    return this\n  }\n\n  /**\n   * Clear bits at all given indices\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} this object\n   */\n  clearBits (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      words[ index >>> 5 ] &= ~(1 << index)\n    }\n    return this\n  }\n\n  /**\n   * Set all bits of the array\n   * @return {BitArray} this object\n   */\n  setAll () {\n    return this._assignRange(0, this.length - 1, true)\n  }\n\n  /**\n   * Clear all bits of the array\n   * @return {BitArray} this object\n   */\n  clearAll () {\n    return this._assignRange(0, this.length - 1, false)\n  }\n\n  /**\n   * Flip all the values in the array\n   * @return {BitArray} this object\n   */\n  flipAll () {\n    const count = this._words.length\n    const words = this._words\n    const bs = 32 - this.length % 32\n    for (let k = 0; k < count - 1; ++k) {\n      words[k] = ~words[ k ]\n    }\n    words[ count - 1 ] = (~(words[ count - 1 ] << bs)) >>> bs\n    return this\n  }\n\n  _isRangeValue (start: number, end: number, value: boolean) {\n    if (end < start) return\n    const words = this._words\n    const wordValue = value === true ? 0xFFFFFFFF : 0\n    const wordStart = start >>> 5\n    const wordEnd = end >>> 5\n        // set complete words when applicable\n    for (let k = wordStart + 1; k < wordEnd; ++k) {\n      if (words[ k ] !== wordValue) return false\n    }\n        // set parts of the range not spanning complete words\n    if (end - start < 32) {\n      for (let i = start, n = end + 1; i < n; ++i) {\n        if (!!(words[ i >>> 5 ] & (1 << i)) !== value) return false\n      }\n    } else {\n      const startWord = wordStart << 5\n      const endWord = wordEnd << 5\n      for (let i = start, n = startWord + 32; i < n; ++i) {\n        if (!!(words[ i >>> 5 ] & (1 << i)) !== value) return false\n      }\n      for (let i = endWord, n = end + 1; i < n; ++i) {\n        if (!!(words[ i >>> 5 ] & (1 << i)) !== value) return false\n      }\n    }\n    return true\n  }\n\n  /**\n   * Test if bits in given range are set\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  isRangeSet (start: number, end: number) {\n    return this._isRangeValue(start, end, true)\n  }\n\n  /**\n   * Test if bits in given range are clear\n   * @param {Integer} start - start index\n   * @param {Integer} end - end index\n   * @return {BitArray} this object\n   */\n  isRangeClear (start: number, end: number) {\n    return this._isRangeValue(start, end, false)\n  }\n\n  /**\n   * Test if all bits in the array are set\n   * @return {Boolean} test result\n   */\n  isAllSet () {\n    return this._isRangeValue(0, this.length - 1, true)\n  }\n\n  /**\n   * Test if all bits in the array are clear\n   * @return {Boolean} test result\n   */\n  isAllClear () {\n    return this._isRangeValue(0, this.length - 1, false)\n  }\n\n  /**\n   * Test if bits at all given indices are set\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} test result\n   */\n  isSet (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      if ((words[ index >>> 5 ] & (1 << index)) === 0) return false\n    }\n    return true\n  }\n\n  /**\n   * Test if bits at all given indices are clear\n   * @param {...Integer} arguments - indices\n   * @return {Boolean} test result\n   */\n  isClear (...indices: number[]) {\n    const words = this._words\n    const n = indices.length\n    for (let i = 0; i < n; ++i) {\n      const index = indices[ i ]\n      if ((words[ index >>> 5 ] & (1 << index)) !== 0) return false\n    }\n    return true\n  }\n\n  /**\n   * Test if two BitArrays are identical in all their values\n   * @param {BitArray} otherBitarray - the other BitArray\n   * @return {Boolean} test result\n   */\n  isEqualTo (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      if (words1[ k ] !== words2[ k ]) {\n        return false\n      }\n    }\n    return true\n  }\n\n  /**\n   * How many set bits?\n   * @return {Integer} number of set bits\n   */\n  getSize () {\n    const count = this._words.length\n    const words = this._words\n    let size = 0\n    for (let i = 0; i < count; ++i) {\n      size += hammingWeight(words[ i ])\n    }\n    return size\n  }\n\n  /**\n   * Calculate difference betwen this and another bit array.\n   * Store result in this object.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} this object\n   */\n  difference (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      words1[ k ] = words1[ k ] & ~words2[ k ]\n    }\n    for (let k = words1.length; k < count; ++k) {\n      words1[ k ] = 0\n    }\n    return this\n  }\n\n  /**\n   * Calculate union betwen this and another bit array.\n   * Store result in this object.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} this object\n   */\n  union (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      words1[ k ] |= words2[ k ]\n    }\n    for (let k = words1.length; k < count; ++k) {\n      words1[ k ] = 0\n    }\n    return this\n  }\n\n  /**\n   * Calculate intersection betwen this and another bit array.\n   * Store result in this object.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} this object\n   */\n  intersection (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      words1[ k ] &= words2[ k ]\n    }\n    for (let k = words1.length; k < count; ++k) {\n      words1[ k ] = 0\n    }\n    return this\n  }\n\n  /**\n   * Test if there is any intersection betwen this and another bit array.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {Boolean} test result\n   */\n  intersects (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    for (let k = 0; k < count; ++k) {\n      if ((words1[ k ] & words2[ k ]) !== 0) {\n        return true\n      }\n    }\n    return false\n  }\n\n  /**\n   * Calculate the number of bits in common betwen this and another bit array.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {Integer} size\n   */\n  getIntersectionSize (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    let size = 0\n    for (let k = 0; k < count; ++k) {\n      size += hammingWeight(words1[ k ] & words2[ k ])\n    }\n    return size\n  }\n\n  /**\n   * Calculate intersection betwen this and another bit array.\n   * Store result in a new bit array.\n   * @param  {BitArray} otherBitarray - the other bit array\n   * @return {BitArray} the new bit array\n   */\n  makeIntersection (otherBitarray: BitArray) {\n    const words1 = this._words\n    const words2 = otherBitarray._words\n    const count = Math.min(words1.length, words2.length)\n    const wordsA = new Uint32Array(count)\n    const intersection = Object.create(BitArray.prototype)\n    intersection._words = wordsA\n    intersection.length = Math.min(this.length, otherBitarray.length)\n    for (let k = 0; k < count; ++k) {\n      wordsA[ k ] = words1[ k ] & words2[ k ]\n    }\n    return intersection\n  }\n\n  /**\n   * Iterate over all set bits in the array\n   * @param  {function( index: Integer, i: Integer )} callback - the callback\n   * @return {undefined}\n   */\n  forEach (callback: (index: number, i: number) => any) {\n    const count = this._words.length\n    const words = this._words\n    let i = 0\n    for (let k = 0; k < count; ++k) {\n      let w = words[ k ]\n      while (w !== 0) {\n        const t = w & -w\n        const index = (k << 5) + hammingWeight(t - 1)\n        callback(index, i)\n        w ^= t\n        ++i\n      }\n    }\n  }\n\n  /**\n   * Get an array with the set bits\n   * @return {Array} bit indices\n   */\n  toArray () {\n    const words = this._words\n    const answer = new Array(this.getSize())\n    const count = this._words.length\n    let pos = 0\n    for (let k = 0; k < count; ++k) {\n      let w = words[ k ]\n      while (w !== 0) {\n        const t = w & -w\n        answer[ pos++ ] = (k << 5) + hammingWeight(t - 1)\n        w ^= t\n      }\n    }\n    return answer\n  }\n\n  toString () {\n    return '{' + this.toArray().join(',') + '}'\n  }\n\n  toSeleString () {\n    const sele = this.toArray().join(',')\n    return sele ? '@' + sele : 'NONE'\n  }\n\n  /**\n   * Clone this object\n   * @return {BitArray} the cloned object\n   */\n  clone () {\n    const clone = Object.create(BitArray.prototype)\n    clone.length = this.length\n    clone._words = new Uint32Array(this._words)\n    return clone\n  }\n}","/**\n * @file Adjacency List\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport interface Edges {\n  nodeArray1: ArrayLike<number>\n  nodeArray2: ArrayLike<number>\n  edgeCount: number\n  nodeCount: number\n}\n\nexport interface AdjacencyList {\n  /* number of edges for each node */\n  countArray: Uint8Array\n  /* offset into indexArray for each node */\n  offsetArray: Int32Array\n  /* edge indices, grouped by nodes */\n  indexArray: Int32Array\n}\n\nexport function createAdjacencyList (edges: Edges): AdjacencyList {\n  const { edgeCount, nodeCount, nodeArray1, nodeArray2 } = edges\n\n  const countArray = new Uint8Array(nodeCount)\n  const offsetArray = new Int32Array(nodeCount)\n\n  // count edges per node\n  for (let i = 0; i < edgeCount; ++i) {\n    countArray[ nodeArray1[ i ] ] += 1\n    countArray[ nodeArray2[ i ] ] += 1\n  }\n\n  // get offsets to node edges\n  for (let i = 1; i < nodeCount; ++i) {\n    offsetArray[ i ] += offsetArray[ i - 1 ] + countArray[ i - 1 ]\n  }\n\n  // prepare index array\n  const bondCount2 = edgeCount * 2\n  const indexArray = new Int32Array(bondCount2)\n  for (let j = 0; j < bondCount2; ++j) {\n    indexArray[ j ] = -1\n  }\n\n  // build index array\n  for (let i = 0; i < edgeCount; ++i) {\n    const idx1 = nodeArray1[ i ]\n    const idx2 = nodeArray2[ i ]\n    let j1 = offsetArray[ idx1 ]\n    while (indexArray[ j1 ] !== -1 && j1 < bondCount2) {\n      j1 += 1\n    }\n    indexArray[ j1 ] = i\n    let j2 = offsetArray[ idx2 ]\n    while (indexArray[ j2 ] !== -1 && j2 < bondCount2) {\n      j2 += 1\n    }\n    indexArray[ j2 ] = i\n  }\n\n  return { countArray, offsetArray, indexArray }\n}\n","/**\n * @file Features\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport AtomProxy from '../../proxy/atom-proxy'\n\nexport interface Features {\n  types: FeatureType[]\n  groups: FeatureGroup[]\n  centers: { x: number[], y: number[], z: number[] }\n  atomSets: number[][]\n}\n\nexport const enum FeatureType {\n  Unknown = 0,\n  PositiveCharge = 1,\n  NegativeCharge = 2,\n  AromaticRing = 3,\n  HydrogenDonor = 4,\n  HydrogenAcceptor = 5,\n  HalogenDonor = 6,\n  HalogenAcceptor = 7,\n  Hydrophobic = 8,\n  WeakHydrogenDonor = 9,\n  IonicTypePartner = 10,\n  DativeBondPartner = 11,\n  TransitionMetal = 12,\n  IonicTypeMetal = 13\n}\n\nexport const enum FeatureGroup {\n  Unknown = 0,\n  QuaternaryAmine = 1,\n  TertiaryAmine = 2,\n  Sulfonium = 3,\n  SulfonicAcid = 4,\n  Sulfate = 5,\n  Phosphate = 6,\n  Halocarbon = 7,\n  Guanidine = 8,\n  Acetamidine = 9,\n  Carboxylate = 10\n}\n\nexport function createFeatures (): Features {\n  return {\n    types: [],\n    groups: [],\n    centers: { x: [], y: [], z: [] },\n    atomSets: []\n  }\n}\n\nexport interface FeatureState {\n  type: FeatureType\n  group: FeatureGroup\n  x: number\n  y: number\n  z: number\n  atomSet: number[]\n}\n\nexport function createFeatureState(type = FeatureType.Unknown, group = FeatureGroup.Unknown): FeatureState {\n  return { type, group, x: 0, y: 0, z: 0, atomSet: [] }\n}\n\nexport function addAtom (state: FeatureState, atom: AtomProxy) {\n  state.x += atom.x\n  state.y += atom.y\n  state.z += atom.z\n  state.atomSet.push(atom.index)\n}\n\nexport function addFeature (features: Features, state: FeatureState) {\n  const n = state.atomSet.length\n  if (n > 0) {\n    const { types, groups, centers, atomSets } = features\n    types.push(state.type)\n    groups.push(state.group)\n    centers.x.push(state.x / n)\n    centers.y.push(state.y / n)\n    centers.z.push(state.z / n)\n    atomSets.push(state.atomSet)\n  }\n}\n","/**\n * @file Structure Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// entity types\nexport const UnknownEntity = 0\nexport const PolymerEntity = 1\nexport const NonPolymerEntity = 2\nexport const MacrolideEntity = 3\nexport const WaterEntity = 4\n\n// molecule types\nexport const UnknownType = 0\nexport const WaterType = 1\nexport const IonType = 2\nexport const ProteinType = 3\nexport const RnaType = 4\nexport const DnaType = 5\nexport const SaccharideType = 6\n\n// backbone types\nexport const UnknownBackboneType = 0\nexport const ProteinBackboneType = 1\nexport const RnaBackboneType = 2\nexport const DnaBackboneType = 3\nexport const CgProteinBackboneType = 4\nexport const CgRnaBackboneType = 5\nexport const CgDnaBackboneType = 6\n\n// chemical component types\nexport const ChemCompProtein = [\n  'D-BETA-PEPTIDE, C-GAMMA LINKING', 'D-GAMMA-PEPTIDE, C-DELTA LINKING',\n  'D-PEPTIDE COOH CARBOXY TERMINUS', 'D-PEPTIDE NH3 AMINO TERMINUS', 'D-PEPTIDE LINKING',\n  'L-BETA-PEPTIDE, C-GAMMA LINKING', 'L-GAMMA-PEPTIDE, C-DELTA LINKING',\n  'L-PEPTIDE COOH CARBOXY TERMINUS', 'L-PEPTIDE NH3 AMINO TERMINUS', 'L-PEPTIDE LINKING',\n  'PEPTIDE LINKING', 'PEPTIDE-LIKE'\n]\nexport const ChemCompRna = [\n  'RNA OH 3 PRIME TERMINUS', 'RNA OH 5 PRIME TERMINUS', 'RNA LINKING'\n]\nexport const ChemCompDna = [\n  'DNA OH 3 PRIME TERMINUS', 'DNA OH 5 PRIME TERMINUS', 'DNA LINKING',\n  'L-DNA LINKING', 'L-RNA LINKING'\n]\nexport const ChemCompSaccharide = [\n  'D-SACCHARIDE', 'D-SACCHARIDE 1,4 AND 1,4 LINKING', 'D-SACCHARIDE 1,4 AND 1,6 LINKING',\n  'L-SACCHARIDE', 'L-SACCHARIDE 1,4 AND 1,4 LINKING', 'L-SACCHARIDE 1,4 AND 1,6 LINKING',\n  'SACCHARIDE'\n]\nexport const ChemCompOther = [\n  'OTHER'\n]\nexport const ChemCompNonPolymer = [\n  'NON-POLYMER'\n]\nexport const ChemCompHetero = ChemCompNonPolymer.concat(ChemCompOther, ChemCompSaccharide)\n\n// secondary structure\nexport const SecStrucHelix = [ 'h', 'g', 'i' ]\nexport const SecStrucSheet = [ 'e', 'b' ]\nexport const SecStrucTurn = [ 's', 't', 'l', '' ]\n\nexport const AtomicNumbers: { [e: string]: number | undefined } = {\n  'H': 1, 'D': 1, 'T': 1, 'HE': 2, 'LI': 3, 'BE': 4, 'B': 5, 'C': 6, 'N': 7, 'O': 8, 'F': 9, 'NE': 10, 'NA': 11, 'MG': 12, 'AL': 13, 'SI': 14, 'P': 15, 'S': 16, 'CL': 17, 'AR': 18, 'K': 19, 'CA': 20, 'SC': 21, 'TI': 22, 'V': 23, 'CR': 24, 'MN': 25, 'FE': 26, 'CO': 27, 'NI': 28, 'CU': 29, 'ZN': 30, 'GA': 31, 'GE': 32, 'AS': 33, 'SE': 34, 'BR': 35, 'KR': 36, 'RB': 37, 'SR': 38, 'Y': 39, 'ZR': 40, 'NB': 41, 'MO': 42, 'TC': 43, 'RU': 44, 'RH': 45, 'PD': 46, 'AG': 47, 'CD': 48, 'IN': 49, 'SN': 50, 'SB': 51, 'TE': 52, 'I': 53, 'XE': 54, 'CS': 55, 'BA': 56, 'LA': 57, 'CE': 58, 'PR': 59, 'ND': 60, 'PM': 61, 'SM': 62, 'EU': 63, 'GD': 64, 'TB': 65, 'DY': 66, 'HO': 67, 'ER': 68, 'TM': 69, 'YB': 70, 'LU': 71, 'HF': 72, 'TA': 73, 'W': 74, 'RE': 75, 'OS': 76, 'IR': 77, 'PT': 78, 'AU': 79, 'HG': 80, 'TL': 81, 'PB': 82, 'BI': 83, 'PO': 84, 'AT': 85, 'RN': 86, 'FR': 87, 'RA': 88, 'AC': 89, 'TH': 90, 'PA': 91, 'U': 92, 'NP': 93, 'PU': 94, 'AM': 95, 'CM': 96, 'BK': 97, 'CF': 98, 'ES': 99, 'FM': 100, 'MD': 101, 'NO': 102, 'LR': 103, 'RF': 104, 'DB': 105, 'SG': 106, 'BH': 107, 'HS': 108, 'MT': 109, 'DS': 110, 'RG': 111, 'CN': 112, 'NH': 113, 'FL': 114, 'MC': 115, 'LV': 116, 'TS': 117, 'OG': 118\n}\nexport const DefaultAtomicNumber = 0\n\n/**\n * Enum mapping element to atomic number\n */\nexport const enum Elements {\n  H = 1, D = 1, T = 1, HE = 2, LI = 3, BE = 4, B = 5, C = 6, N = 7, O = 8, F = 9, NE = 10, NA = 11, MG = 12, AL = 13, SI = 14, P = 15, S = 16, CL = 17, AR = 18, K = 19, CA = 20, SC = 21, TI = 22, V = 23, CR = 24, MN = 25, FE = 26, CO = 27, NI = 28, CU = 29, ZN = 30, GA = 31, GE = 32, AS = 33, SE = 34, BR = 35, KR = 36, RB = 37, SR = 38, Y = 39, ZR = 40, NB = 41, MO = 42, TC = 43, RU = 44, RH = 45, PD = 46, AG = 47, CD = 48, IN = 49, SN = 50, SB = 51, TE = 52, I = 53, XE = 54, CS = 55, BA = 56, LA = 57, CE = 58, PR = 59, ND = 60, PM = 61, SM = 62, EU = 63, GD = 64, TB = 65, DY = 66, HO = 67, ER = 68, TM = 69, YB = 70, LU = 71, HF = 72, TA = 73, W = 74, RE = 75, OS = 76, IR = 77, PT = 78, AU = 79, HG = 80, TL = 81, PB = 82, BI = 83, PO = 84, AT = 85, RN = 86, FR = 87, RA = 88, AC = 89, TH = 90, PA = 91, U = 92, NP = 93, PU = 94, AM = 95, CM = 96, BK = 97, CF = 98, ES = 99, FM = 100, MD = 101, NO = 102, LR = 103, RF = 104, DB = 105, SG = 106, BH = 107, HS = 108, MT = 109, DS = 110, RG = 111, CN = 112, NH = 113, FL = 114, MC = 115, LV = 116, TS = 117, OG = 118\n}\n\n// https://doi.org/10.1515/pac-2015-0305 (table 2, 3, and 4)\nexport const AtomWeights: { [e: number]: number | undefined } = {\n  1: 1.008, 2: 4.0026, 3: 6.94, 4: 9.0122, 5: 10.81, 6: 10.81, 7: 14.007, 8: 15.999, 9: 18.998, 10: 20.180, 11: 22.990, 12: 24.305, 13: 26.982, 14: 28.085, 15: 30.974, 16: 32.06, 17: 35.45, 18: 39.948, 19: 39.098, 20: 40.078, 21: 44.956, 22: 47.867, 23: 50.942, 24: 51.996, 25: 54.938, 26: 55.845, 27: 58.933, 28: 58.693, 29: 63.546, 30: 65.38, 31: 69.723, 32: 72.630, 33: 74.922, 34: 78.971, 35: 79.904, 36: 83.798, 37: 85.468, 38: 87.62, 39: 88.906, 40: 91.224, 41: 92.906, 42: 95.95, 43: 96.906, 44: 101.07, 45: 102.91, 46: 106.42, 47: 107.87, 48: 112.41, 49: 114.82, 50: 118.71, 51: 121.76, 52: 127.60, 53: 127.60, 54: 131.29, 55: 132.91, 56: 137.33, 57: 138.91, 58: 140.12, 59: 140.91, 60: 144.24, 61: 144.912, 62: 150.36, 63: 151.96, 64: 157.25, 65: 158.93, 66: 162.50, 67: 164.93, 68: 167.26, 69: 168.93, 70: 173.05, 71: 174.97, 72: 178.49, 73: 180.95, 74: 183.84, 75: 186.21, 76: 190.23, 77: 192.22, 78: 195.08, 79: 196.97, 80: 200.59, 81: 204.38, 82: 207.2, 83: 208.98, 84: 1.97, 85: 2.02, 86: 2.2, 87: 3.48, 88: 2.83, 89: 2.0, 90: 232.04, 91: 231.04, 92: 238.03, 93: 237.048, 94: 244.064, 95: 243.061, 96: 247.070, 97: 247.070, 98: 251.079, 99: 252.083, 100: 257.095, 101: 258.098, 102: 259.101, 103: 262.110, 104: 267.122, 105: 270.131, 106: 271.134, 107: 270.133, 108: 270.134, 109: 278.156, 110: 281.165, 111: 281.166, 112: 285.177, 113: 286.182, 114: 289.190, 115: 289.194, 116: 293.204, 117: 293.208, 118: 294.214\n}\nexport const DefaultAtomWeight = 10.81  // C\n\n// http://dx.doi.org/10.1021/jp8111556 (or 2.0)\nexport const VdwRadii: { [e: number]: number | undefined } = {\n  1: 1.1, 2: 1.4, 3: 1.81, 4: 1.53, 5: 1.92, 6: 1.7, 7: 1.55, 8: 1.52, 9: 1.47, 10: 1.54, 11: 2.27, 12: 1.73, 13: 1.84, 14: 2.1, 15: 1.8, 16: 1.8, 17: 1.75, 18: 1.88, 19: 2.75, 20: 2.31, 21: 2.3, 22: 2.15, 23: 2.05, 24: 2.05, 25: 2.05, 26: 2.05, 27: 2.0, 28: 2.0, 29: 2.0, 30: 2.1, 31: 1.87, 32: 2.11, 33: 1.85, 34: 1.9, 35: 1.83, 36: 2.02, 37: 3.03, 38: 2.49, 39: 2.4, 40: 2.3, 41: 2.15, 42: 2.1, 43: 2.05, 44: 2.05, 45: 2.0, 46: 2.05, 47: 2.1, 48: 2.2, 49: 2.2, 50: 1.93, 51: 2.17, 52: 2.06, 53: 1.98, 54: 2.16, 55: 3.43, 56: 2.68, 57: 2.5, 58: 2.48, 59: 2.47, 60: 2.45, 61: 2.43, 62: 2.42, 63: 2.4, 64: 2.38, 65: 2.37, 66: 2.35, 67: 2.33, 68: 2.32, 69: 2.3, 70: 2.28, 71: 2.27, 72: 2.25, 73: 2.2, 74: 2.1, 75: 2.05, 76: 2.0, 77: 2.0, 78: 2.05, 79: 2.1, 80: 2.05, 81: 1.96, 82: 2.02, 83: 2.07, 84: 1.97, 85: 2.02, 86: 2.2, 87: 3.48, 88: 2.83, 89: 2.0, 90: 2.4, 91: 2.0, 92: 2.3, 93: 2.0, 94: 2.0, 95: 2.0, 96: 2.0, 97: 2.0, 98: 2.0, 99: 2.0, 100: 2.0, 101: 2.0, 102: 2.0, 103: 2.0, 104: 2.0, 105: 2.0, 106: 2.0, 107: 2.0, 108: 2.0, 109: 2.0, 110: 2.0, 111: 2.0, 112: 2.0, 113: 2.0, 114: 2.0, 115: 2.0, 116: 2.0, 117: 2.0, 118: 2.0\n}\nexport const DefaultVdwRadius = 2.0  // C\n\n// Peter Rose (peter.rose@rcsb.org), private communication, average accross PDB\nexport const ResidueRadii: { [k: string]: number } = {\n  '2QY': 6.58,\n  'CY0': 11.98,\n  '2QZ': 2.52,\n  'CY1': 6.59,\n  'HHK': 5.11,\n  'CXM': 4.69,\n  'HHI': 4.58,\n  'CY4': 4.57,\n  'S12': 18.57,\n  'CY3': 2.79,\n  'C5C': 5.35,\n  'PFX': 11.84,\n  '2R3': 6.94,\n  '2R1': 3.78,\n  'ILX': 4.99,\n  '32S': 5.68,\n  'BTK': 8.59,\n  '32T': 5.72,\n  'FAK': 9.8,\n  'B27': 2.78,\n  'ILM': 3.84,\n  'C4R': 5.63,\n  '32L': 6.75,\n  'SYS': 3.01,\n  '1MH': 5.04,\n  'ILE': 3.65,\n  'YNM': 6.39,\n  '2RX': 4.91,\n  'B3A': 2.48,\n  'GEE': 4.76,\n  '7MN': 7.34,\n  'B3E': 5.4,\n  'ARG': 6.33,\n  '200': 6.89,\n  'HIP': 5.47,\n  'HIA': 4.64,\n  'B3K': 5.89,\n  'HIC': 5.76,\n  'B3L': 4.96,\n  'B3M': 5.07,\n  'ARM': 6.86,\n  'ARO': 7.35,\n  'AR4': 8.42,\n  'PG1': 10.67,\n  'YOF': 6.44,\n  'IML': 3.74,\n  'SXE': 6.65,\n  'HIQ': 7.98,\n  'PFF': 6.31,\n  'HIS': 4.52,\n  '0TD': 3.62,\n  'C3Y': 5.24,\n  '1OP': 11.55,\n  '02Y': 4.77,\n  '02V': 4.83,\n  'ASB': 5.59,\n  '30V': 8.53,\n  'S2P': 4.81,\n  'ASP': 3.55,\n  'ASN': 3.54,\n  '2OR': 6.91,\n  'QMM': 6.13,\n  '2P0': 8.52,\n  'ASL': 5.36,\n  'HFA': 5.14,\n  '5PG': 5.69,\n  'B3X': 4.38,\n  'AS9': 4.1,\n  'ARV': 7.59,\n  'B3U': 6.06,\n  'S2C': 7.54,\n  'B3T': 3.34,\n  '175': 5.64,\n  'GFT': 8.18,\n  'HG7': 6.8,\n  'B3Q': 4.48,\n  'ASA': 3.64,\n  '02K': 2.94,\n  'B3Y': 7.45,\n  'PHD': 5.35,\n  'C6C': 6.42,\n  'BUC': 5.8,\n  'HGL': 8.07,\n  'PHE': 5.06,\n  '03Y': 2.6,\n  'PHA': 5.11,\n  'OCY': 5.0,\n  '4PH': 6.79,\n  '5OH': 4.7,\n  '31Q': 10.46,\n  'BTR': 7.98,\n  '3PX': 4.7,\n  '1PA': 8.07,\n  'ASX': 3.54,\n  'IOR': 7.23,\n  '03E': 3.38,\n  'PHL': 5.17,\n  'KWS': 5.09,\n  'PHI': 7.12,\n  'NAL': 7.22,\n  'S1H': 19.21,\n  '2ML': 3.86,\n  '2MR': 7.35,\n  'GHG': 4.83,\n  'TYY': 6.54,\n  '2MT': 3.67,\n  '56A': 13.01,\n  'SVA': 5.46,\n  'TYX': 8.31,\n  'TYS': 8.59,\n  'TYR': 6.38,\n  'TYQ': 6.43,\n  'HLU': 3.99,\n  'MYK': 19.47,\n  'TYO': 7.71,\n  'HLX': 4.98,\n  'TYN': 9.87,\n  'TYJ': 6.25,\n  'TYI': 6.49,\n  'LYH': 5.13,\n  'LYF': 12.19,\n  'SUN': 6.73,\n  'LYR': 18.28,\n  'TYB': 6.46,\n  '11W': 14.39,\n  'LYS': 5.54,\n  'LYN': 4.8,\n  '11Q': 4.85,\n  'LYO': 4.71,\n  'LYZ': 1.76,\n  'TXY': 6.44,\n  'MYN': 4.71,\n  'TY5': 10.6,\n  'HMR': 5.09,\n  '01W': 8.55,\n  'LYX': 13.36,\n  'TY8': 7.22,\n  'TY2': 6.49,\n  'KYN': 6.18,\n  'KYQ': 9.75,\n  'CZZ': 5.14,\n  'IIL': 3.81,\n  'HNC': 10.41,\n  'OIC': 4.62,\n  'LVN': 2.89,\n  'QIL': 3.84,\n  'JJL': 8.3,\n  'VAH': 3.88,\n  'JJJ': 7.5,\n  'JJK': 7.43,\n  'VAD': 2.56,\n  'CYW': 4.65,\n  '0QL': 5.72,\n  '143': 8.22,\n  'SVX': 7.04,\n  'CYJ': 11.64,\n  'SVY': 7.1,\n  'SVZ': 6.6,\n  'CYG': 8.03,\n  'CYF': 13.54,\n  'SVV': 5.09,\n  'GL3': 2.72,\n  '8SP': 14.26,\n  'CYS': 2.78,\n  '004': 4.33,\n  'CYR': 10.33,\n  'PLJ': 3.71,\n  'EXY': 7.37,\n  'HL2': 3.75,\n  'A5N': 5.21,\n  'CYQ': 5.67,\n  'CZ2': 5.16,\n  'LWY': 4.12,\n  'PM3': 8.78,\n  'OHS': 6.98,\n  'OHI': 5.35,\n  '3TY': 8.42,\n  'CYD': 8.55,\n  'DYS': 7.87,\n  'DAH': 6.47,\n  '4IK': 11.81,\n  '3EG': 3.66,\n  'AYA': 3.65,\n  '4IN': 6.31,\n  'DAB': 3.48,\n  '4HT': 6.03,\n  'RGL': 7.03,\n  'DAM': 2.49,\n  'NFA': 5.04,\n  'WFP': 6.07,\n  '2JC': 2.97,\n  'HAR': 7.55,\n  '2JG': 5.67,\n  'MH6': 1.72,\n  '2JF': 9.13,\n  '3FG': 4.96,\n  'MGN': 4.84,\n  'AZH': 5.36,\n  'AZK': 6.03,\n  'ZBZ': 7.79,\n  'TBG': 2.58,\n  'VAL': 2.51,\n  'MGG': 7.34,\n  'AZS': 5.61,\n  'FHL': 9.75,\n  '2JH': 4.56,\n  'IEL': 7.07,\n  'FHO': 6.75,\n  'DA2': 7.79,\n  'FH7': 6.99,\n  'ME0': 4.52,\n  '3GL': 4.84,\n  'MDO': 5.03,\n  'AZY': 7.37,\n  'A8E': 3.76,\n  'ZCL': 6.71,\n  'MDH': 2.58,\n  'LA2': 14.07,\n  '4FW': 6.1,\n  'YCM': 5.32,\n  'MDF': 4.95,\n  'YCP': 3.01,\n  'TEF': 8.63,\n  'FGP': 4.34,\n  'UF0': 19.72,\n  'XCN': 4.57,\n  'FGL': 2.56,\n  'MF3': 6.37,\n  'MEQ': 5.13,\n  'LAA': 3.23,\n  'IGL': 5.52,\n  'MET': 4.49,\n  'NIY': 6.81,\n  'QCS': 5.18,\n  'TCQ': 8.56,\n  'MEN': 4.33,\n  '4HL': 8.79,\n  'MEA': 4.95,\n  'EFC': 5.28,\n  'LAL': 2.41,\n  '2HF': 5.52,\n  'KBE': 5.64,\n  'OCS': 3.94,\n  'CAF': 5.46,\n  'NC1': 11.4,\n  'NBQ': 9.82,\n  'CAB': 4.19,\n  'MBQ': 9.55,\n  '193': 7.38,\n  '192': 2.44,\n  '0WZ': 7.61,\n  'CAS': 5.35,\n  'NB8': 11.98,\n  'OBS': 11.71,\n  '1AC': 2.42,\n  'PCA': 3.48,\n  'MCL': 9.73,\n  'LBY': 7.75,\n  'GAU': 4.67,\n  'PBF': 9.75,\n  'MCG': 6.46,\n  'DDE': 6.86,\n  '19W': 3.94,\n  'MD5': 9.33,\n  'MD6': 6.44,\n  'MD3': 8.41,\n  'MCS': 7.56,\n  'OBF': 3.64,\n  'UAL': 4.68,\n  'PAT': 6.05,\n  'IAM': 8.88,\n  'PAQ': 8.77,\n  'FDL': 9.49,\n  'NCB': 3.45,\n  'LCK': 9.81,\n  'DDZ': 2.52,\n  '2FM': 5.54,\n  'IAR': 6.77,\n  'OAS': 4.8,\n  'HBN': 8.8,\n  'TA4': 5.55,\n  '1C3': 7.43,\n  'ECX': 5.51,\n  'PF5': 6.28,\n  'RE3': 5.29,\n  'FCL': 6.25,\n  'ECC': 4.79,\n  'LDH': 7.06,\n  'NCY': 2.91,\n  'CCS': 4.58,\n  'PEC': 6.54,\n  '2CO': 4.45,\n  'LE1': 2.72,\n  'HCM': 5.53,\n  '07O': 8.05,\n  'HCL': 4.96,\n  'NEP': 6.94,\n  'PE1': 8.01,\n  'LEF': 4.37,\n  'FC0': 5.18,\n  'LED': 4.34,\n  'HCS': 4.09,\n  'DBU': 2.49,\n  'RE0': 5.53,\n  'LEN': 3.82,\n  '1E3': 8.71,\n  'BB9': 2.56,\n  'BB8': 5.14,\n  'PCS': 5.05,\n  'BB7': 4.56,\n  'BB6': 2.62,\n  'LEU': 3.83,\n  'DBZ': 7.08,\n  'LET': 11.29,\n  'DBY': 6.46,\n  'ICY': 7.76,\n  'MAA': 2.4,\n  'CGA': 7.91,\n  '5CS': 8.34,\n  'UGY': 3.7,\n  'LGY': 11.71,\n  'N10': 8.96,\n  'AAR': 6.39,\n  'FT6': 7.5,\n  'MOD': 12.62,\n  '5CW': 7.21,\n  'PVH': 4.58,\n  'BBC': 6.42,\n  'YYA': 7.3,\n  'O12': 14.08,\n  'NOT': 7.15,\n  'KGC': 9.88,\n  'MP4': 5.86,\n  '0CS': 4.07,\n  'MP8': 3.75,\n  'VLL': 2.54,\n  'VLM': 2.51,\n  'BCS': 8.03,\n  'MNL': 4.9,\n  'AA4': 4.47,\n  'SAC': 3.49,\n  'BCX': 2.99,\n  '3CF': 6.47,\n  'SAH': 11.7,\n  'NNH': 6.86,\n  'CGU': 4.71,\n  'SIB': 12.41,\n  'TLY': 8.78,\n  'SIC': 4.81,\n  'VMS': 8.82,\n  'TMD': 6.76,\n  'MMO': 6.53,\n  'PXU': 2.46,\n  '4AW': 6.22,\n  'OTH': 3.6,\n  'DLS': 6.84,\n  'MME': 4.99,\n  'DM0': 6.99,\n  '0FL': 2.76,\n  'SBL': 8.96,\n  'CDV': 3.72,\n  'OTY': 6.51,\n  'PYA': 7.75,\n  '2AS': 3.57,\n  'DMH': 4.92,\n  'ELY': 7.42,\n  'GVL': 9.6,\n  'FVA': 2.9,\n  'SAR': 2.48,\n  '4BF': 6.92,\n  'EME': 4.69,\n  'CDE': 2.51,\n  '3AR': 7.86,\n  '3AH': 9.11,\n  'AC5': 2.44,\n  'FTR': 6.08,\n  'MLL': 3.76,\n  'NPH': 11.66,\n  'NPI': 6.9,\n  'DMT': 6.67,\n  'PYX': 11.3,\n  'MLE': 3.87,\n  'PYL': 9.67,\n  'ZZU': 6.94,\n  'H5M': 3.61,\n  'SCH': 4.46,\n  'DMK': 3.52,\n  'FTY': 9.07,\n  '2AG': 3.7,\n  'ABA': 2.55,\n  'ZZJ': 2.44,\n  'MLZ': 6.8,\n  'MLY': 6.88,\n  'KCX': 7.28,\n  'ZZD': 8.16,\n  '3A5': 5.37,\n  'LHC': 7.75,\n  '9AT': 2.47,\n  'OZT': 3.4,\n  'THO': 2.62,\n  'THR': 2.5,\n  'DFI': 3.93,\n  'MKD': 6.42,\n  '4CY': 4.6,\n  'SDP': 6.07,\n  'DFO': 3.94,\n  '0A0': 3.45,\n  '4DB': 9.73,\n  'ML3': 6.26,\n  'BG1': 8.02,\n  'SD4': 4.57,\n  'THC': 3.8,\n  'SCS': 5.48,\n  'TH5': 4.65,\n  'BFD': 5.33,\n  'AEI': 6.34,\n  'TH6': 2.85,\n  'SCY': 4.53,\n  'TIS': 4.81,\n  'SEE': 4.53,\n  'BHD': 3.48,\n  'SEB': 8.18,\n  'SEC': 2.96,\n  'SEP': 4.8,\n  'CLH': 7.13,\n  'TIH': 5.02,\n  'CLG': 13.62,\n  'SEN': 6.43,\n  'XXA': 7.34,\n  'SEL': 2.46,\n  'SE7': 4.19,\n  '4CF': 7.72,\n  'G8M': 3.57,\n  'BH2': 3.51,\n  'UN2': 3.22,\n  'VR0': 10.51,\n  'MK8': 4.76,\n  'DHA': 2.32,\n  'LMQ': 4.69,\n  'SFE': 5.01,\n  'AHB': 3.47,\n  'OXX': 7.05,\n  'BIF': 9.63,\n  'IZO': 4.47,\n  'NMM': 8.25,\n  '0BN': 7.0,\n  'HZP': 3.12,\n  'NMC': 4.23,\n  'DHL': 2.69,\n  '9DS': 9.29,\n  'SER': 2.41,\n  'CHG': 4.2,\n  'MIR': 6.54,\n  'AGQ': 7.79,\n  'SET': 2.46,\n  'MIS': 6.32,\n  '4FB': 3.08,\n  '0AR': 8.46,\n  'LME': 3.99,\n  'FZN': 24.42,\n  'AGT': 9.04,\n  'IYR': 6.46,\n  '9DN': 9.31,\n  'CHP': 5.75,\n  'UNK': 1.64,\n  'XX1': 9.92,\n  'AGM': 6.57,\n  '0AH': 5.78,\n  'LLP': 10.22,\n  '0AF': 6.72,\n  '4DP': 9.28,\n  'HYP': 2.25,\n  'DIR': 5.8,\n  'LLY': 8.71,\n  '0AK': 6.11,\n  'NLE': 4.67,\n  'OYL': 6.42,\n  'WVL': 4.69,\n  '0A8': 8.1,\n  'NLY': 6.37,\n  'MHO': 4.89,\n  'VOL': 2.55,\n  '0A1': 7.1,\n  'MHL': 3.92,\n  'NLP': 4.81,\n  'NLQ': 4.65,\n  'MHW': 2.74,\n  'BIL': 4.7,\n  'NLO': 4.8,\n  'MHU': 7.51,\n  'XW1': 9.36,\n  'LLO': 10.13,\n  'SGB': 6.88,\n  'MHV': 3.6,\n  'MHS': 4.51,\n  '0A9': 5.17,\n  '0LF': 9.96,\n  'HT7': 6.82,\n  'X2W': 6.6,\n  'YPZ': 9.38,\n  'I58': 6.73,\n  'FLA': 2.4,\n  'M0H': 4.83,\n  'HSL': 2.46,\n  'FLE': 6.17,\n  'KOR': 10.1,\n  '1VR': 3.89,\n  'HSO': 4.56,\n  'TTS': 9.41,\n  'RVX': 7.01,\n  'TTQ': 7.71,\n  'H14': 5.27,\n  'HTI': 7.8,\n  'ONH': 6.14,\n  'LP6': 8.58,\n  'ONL': 4.83,\n  'AHH': 5.06,\n  'HS8': 7.4,\n  'HS9': 4.71,\n  'BL2': 5.82,\n  'AHP': 5.26,\n  '6HN': 7.34,\n  'HRP': 5.46,\n  'POM': 3.6,\n  'WPA': 5.11,\n  '2ZC': 4.29,\n  'CPC': 2.65,\n  'AIB': 2.4,\n  'XSN': 3.47,\n  'M2S': 5.28,\n  'GND': 6.67,\n  'GNC': 4.6,\n  'MVA': 2.56,\n  'OLZ': 5.32,\n  'M2L': 6.15,\n  'TRF': 6.69,\n  'NZH': 7.66,\n  'SRZ': 5.27,\n  'OLD': 10.47,\n  'CME': 5.86,\n  'CMH': 5.3,\n  'ALA': 2.38,\n  'TRQ': 7.36,\n  'PPN': 7.24,\n  'TRP': 6.07,\n  'TRO': 5.82,\n  'TRN': 5.95,\n  'NYS': 8.1,\n  'ALC': 5.26,\n  'U3X': 11.7,\n  'HVA': 2.58,\n  'TS9': 3.92,\n  'TRX': 7.27,\n  'TRW': 11.8,\n  'LPL': 7.51,\n  'GMA': 4.4,\n  'OMT': 5.07,\n  'CMT': 3.54,\n  'GME': 4.66,\n  'NYB': 6.07,\n  'PR3': 5.12,\n  'LPD': 2.48,\n  'GLU': 4.49,\n  '1X6': 6.84,\n  'LPG': 2.39,\n  'GLX': 4.52,\n  'PR4': 4.52,\n  'CML': 6.16,\n  'FME': 4.52,\n  'HTR': 6.48,\n  'PR7': 4.66,\n  'Z3E': 7.2,\n  'GLZ': 2.39,\n  'BMT': 6.37,\n  'WRP': 8.16,\n  'GLY': 2.37,\n  'OMY': 6.11,\n  'MTY': 5.46,\n  'OMX': 6.15,\n  'GLN': 4.46,\n  '2XA': 8.25,\n  '28X': 7.84,\n  '7JA': 9.46,\n  'FLT': 9.65,\n  'GLJ': 3.7,\n  'OMH': 5.26,\n  'TSY': 4.26,\n  'PRV': 4.28,\n  'CS4': 11.21,\n  'DOA': 12.33,\n  '23P': 5.42,\n  'CS3': 8.24,\n  '6CL': 6.47,\n  'PRR': 5.58,\n  'KST': 11.58,\n  'CS1': 7.23,\n  'PRS': 2.63,\n  'ZYJ': 11.4,\n  'IT1': 9.75,\n  'UU5': 4.98,\n  'ESB': 6.69,\n  'UU4': 2.49,\n  'ESC': 5.65,\n  'LSO': 10.58,\n  'ZYK': 11.45,\n  '9NV': 8.99,\n  '23F': 5.27,\n  'ORN': 4.25,\n  'HOX': 6.61,\n  'CSD': 3.95,\n  'FP9': 3.03,\n  'DO2': 4.44,\n  'SLL': 11.53,\n  'P3Q': 9.54,\n  'ORQ': 6.04,\n  'MSL': 5.21,\n  'DNP': 2.45,\n  'CSB': 3.51,\n  'WLU': 4.24,\n  'CSA': 5.7,\n  'MT2': 5.51,\n  'CSO': 3.53,\n  'TPO': 4.73,\n  'MSP': 13.11,\n  '23S': 6.09,\n  'MSO': 4.96,\n  'PRO': 2.41,\n  'TPL': 5.41,\n  'DNS': 8.79,\n  'CSK': 3.91,\n  'Z70': 7.4,\n  'CSJ': 7.51,\n  'DNW': 7.97,\n  'PRK': 9.15,\n  'GSU': 11.81,\n  'LTA': 6.57,\n  'HPE': 6.63,\n  'TPQ': 6.48,\n  'PRJ': 5.26,\n  'PSW': 4.65,\n  'L3O': 3.89,\n  'CSU': 4.89,\n  'ALY': 7.38,\n  'M3L': 7.12,\n  'CSW': 3.68,\n  'XPR': 7.68,\n  'D4P': 5.66,\n  'FOE': 8.17,\n  'SLZ': 5.69,\n  'CSP': 5.26,\n  'TQI': 7.68,\n  'ALT': 2.72,\n  'CSR': 5.42,\n  'CSS': 3.61,\n  'M3R': 7.18,\n  'ALO': 2.57,\n  'R4K': 4.67,\n  'SMF': 9.0,\n  'MSA': 2.73,\n  'SMC': 3.39,\n  'CSX': 3.47,\n  'SME': 4.8,\n  'ETA': 2.4,\n  'CSZ': 3.6,\n  '22G': 8.8,\n  'MSE': 4.62,\n  'ALN': 6.16,\n  'PSH': 7.26,\n  'CTE': 7.27,\n  'DON': 6.72,\n  'CTH': 3.45,\n  'U2X': 11.54,\n  '6CW': 7.56,\n  'TQZ': 6.97,\n  '3YM': 6.52,\n  'OSE': 4.49,\n  '2VA': 9.82,\n  'TQQ': 7.76,\n  'NRG': 8.35,\n  'BPE': 7.24,\n  'F2F': 6.25,\n  '1TQ': 8.58,\n  'I2M': 3.13,\n  'NVA': 3.76,\n  'R1A': 8.2,\n  'QPA': 6.95,\n  'C1X': 11.63,\n  'FRD': 5.05,\n  'HR7': 6.98,\n  'SNC': 3.93,\n  'QPH': 5.15,\n  '26B': 8.39,\n  'DPQ': 6.54,\n  'DPP': 2.51,\n  '2TY': 8.65,\n  'TNR': 6.88,\n  'PTH': 8.35,\n  'DPL': 3.58,\n  'APK': 8.79,\n  '1TY': 8.84,\n  'HRG': 7.36,\n  'PTM': 8.74,\n  '1U8': 3.62,\n  'PTR': 8.64,\n  'LVG': 3.01,\n  '6FL': 4.85,\n  'SOC': 4.05,\n  'KPI': 9.79,\n  'IPG': 2.91,\n  'P2Y': 2.51,\n  'N2C': 3.55,\n  'T0I': 7.34,\n  'MPH': 5.29,\n  'R2T': 4.71,\n  'TOX': 6.78,\n  'P2Q': 9.8,\n  'GPL': 10.77,\n  'MPJ': 5.07,\n  'F2Y': 6.2,\n  'T11': 8.58,\n  '9NR': 9.33,\n  'FPR': 8.85,\n  '9NF': 8.93,\n  'KPY': 10.17,\n  '9NE': 9.77,\n  'TOQ': 7.5,\n  'MPQ': 4.2,\n  'FPK': 3.08,\n  'HQA': 7.25,\n  'SOY': 10.94\n}\nexport const DefaultResidueRadius = 5.0\n\n// http://dx.doi.org/10.1039/b801115j (or 1.6)\nexport const CovalentRadii: { [e: number]: number | undefined } = {\n  1: 0.31, 2: 0.28, 3: 1.28, 4: 0.96, 5: 0.84, 6: 0.76, 7: 0.71, 8: 0.66, 9: 0.57, 10: 0.58, 11: 1.66, 12: 1.41, 13: 1.21, 14: 1.11, 15: 1.07, 16: 1.05, 17: 1.02, 18: 1.06, 19: 2.03, 20: 1.76, 21: 1.7, 22: 1.6, 23: 1.53, 24: 1.39, 25: 1.39, 26: 1.32, 27: 1.26, 28: 1.24, 29: 1.32, 30: 1.22, 31: 1.22, 32: 1.2, 33: 1.19, 34: 1.2, 35: 1.2, 36: 1.16, 37: 2.2, 38: 1.95, 39: 1.9, 40: 1.75, 41: 1.64, 42: 1.54, 43: 1.47, 44: 1.46, 45: 1.42, 46: 1.39, 47: 1.45, 48: 1.44, 49: 1.42, 50: 1.39, 51: 1.39, 52: 1.38, 53: 1.39, 54: 1.4, 55: 2.44, 56: 2.15, 57: 2.07, 58: 2.04, 59: 2.03, 60: 2.01, 61: 1.99, 62: 1.98, 63: 1.98, 64: 1.96, 65: 1.94, 66: 1.92, 67: 1.92, 68: 1.89, 69: 1.9, 70: 1.87, 71: 1.87, 72: 1.75, 73: 1.7, 74: 1.62, 75: 1.51, 76: 1.44, 77: 1.41, 78: 1.36, 79: 1.36, 80: 1.32, 81: 1.45, 82: 1.46, 83: 1.48, 84: 1.4, 85: 1.5, 86: 1.5, 87: 2.6, 88: 2.21, 89: 2.15, 90: 2.06, 91: 2.0, 92: 1.96, 93: 1.9, 94: 1.87, 95: 1.8, 96: 1.69, 97: 1.6, 98: 1.6, 99: 1.6, 100: 1.6, 101: 1.6, 102: 1.6, 103: 1.6, 104: 1.6, 105: 1.6, 106: 1.6, 107: 1.6, 108: 1.6, 109: 1.6, 110: 1.6, 111: 1.6, 112: 1.6, 113: 1.6, 114: 1.6, 115: 1.6, 116: 1.6, 117: 1.6, 118: 1.6\n}\nexport const DefaultCovalentRadius = 1.6\n\nexport const Valences: { [e: number]: number[] | undefined } = {\n  1: [ 1 ],\n  2: [ 0 ],\n  3: [ 1 ],\n  4: [ 2 ],\n  5: [ 3 ],\n  6: [ 4 ],\n  7: [ 3 ],\n  8: [ 2 ],\n  9: [ 1 ],\n  10: [ 0 ],\n  11: [ 1 ],\n  12: [ 2 ],\n  13: [ 6 ],\n  14: [ 6 ],\n  15: [ 3, 5, 7 ],\n  16: [ 2, 4, 6 ],\n  17: [ 1 ],\n  18: [ 0 ],\n  19: [ 1 ],\n  20: [ 2 ],\n\n  31: [ 3 ],\n  32: [ 4 ],\n  33: [ 3, 5 ],\n  34: [ 2, 4, 6 ],\n  35: [ 1 ],\n  36: [ 0 ],\n  37: [ 1 ],\n  38: [ 2 ],\n\n  49: [ 3 ],\n  50: [ 4 ],\n  51: [ 3, 5 ],\n  52: [ 2 ],\n  53: [ 1, 2, 5 ],\n  54: [ 0, 2 ],\n  55: [ 1 ],\n  56: [ 2 ],\n\n  81: [ 3 ],\n  82: [ 4 ],\n  83: [ 3 ],\n  84: [ 2 ],\n  85: [ 1 ],\n  86: [ 0 ],\n  87: [ 1 ],\n  88: [ 2 ]\n}\nexport const DefaultValence = -1\n\nexport const OuterShellElectronCounts: { [e: number]: number | undefined } = {\n1: 1, 2: 2, 3: 1, 4: 2, 5: 3, 6: 4, 7: 5, 8: 6, 9: 7, 10: 8, 11: 1, 12: 2, 13: 3, 14: 4, 15: 5, 16: 6, 17: 7, 18: 8, 19: 1, 20: 2, 21: 3, 22: 4, 23: 5, 24: 6, 25: 7, 26: 8, 27: 9, 28: 10, 29: 11, 30: 2, 31: 3, 32: 4, 33: 5, 34: 6, 35: 7, 36: 8, 37: 1, 38: 2, 39: 3, 40: 4, 41: 5, 42: 6, 43: 7, 44: 8, 45: 9, 46: 10, 47: 11, 48: 2, 49: 3, 50: 4, 51: 5, 52: 6, 53: 7, 54: 8, 55: 1, 56: 2, 57: 3, 58: 4, 59: 3, 60: 4, 61: 5, 62: 6, 63: 7, 64: 8, 65: 9, 66: 10, 67: 11, 68: 12, 69: 13, 70: 14, 71: 15, 72: 4, 73: 5, 74: 6, 75: 7, 76: 8, 77: 9, 78: 10, 79: 11, 80: 2, 81: 3, 82: 4, 83: 5, 84: 6, 85: 7, 86: 8, 87: 1, 88: 2, 89: 3, 90: 4, 91: 3, 92: 4, 93: 5, 94: 6, 95: 7, 96: 8, 97: 9, 98: 10, 99: 11, 100: 12, 101: 13, 102: 14, 103: 15, 104: 2, 105: 2, 106: 2, 107: 2, 108: 2, 109: 2, 110: 2, 111: 2, 112: 2, 113: 3, 114: 4, 115: 5, 116: 6, 117: 7, 118: 8\n}\nexport const DefaultOuterShellElectronCount = 2\n\n// http://blanco.biomol.uci.edu/Whole_residue_HFscales.txt\n// https://www.nature.com/articles/nsb1096-842\nexport const ResidueHydrophobicity: { [k: string]: [number, number, number] } = {\n  // AA  DGwif   DGwoct  Oct-IF\n  'ALA': [ 0.17, 0.50, 0.33 ],\n  'ARG': [ 0.81, 1.81, 1.00 ],\n  'ASN': [ 0.42, 0.85, 0.43 ],\n  'ASP': [ 1.23, 3.64, 2.41 ],\n  'ASH': [ -0.07, 0.43, 0.50 ],\n  'CYS': [ -0.24, -0.02, 0.22 ],\n  'GLN': [ 0.58, 0.77, 0.19 ],\n  'GLU': [ 2.02, 3.63, 1.61 ],\n  'GLH': [ -0.01, 0.11, 0.12 ],\n  'GLY': [ 0.01, 1.15, 1.14 ],\n  // \"His+\": [  0.96,  2.33,  1.37 ],\n  'HIS': [ 0.17, 0.11, -0.06 ],\n  'ILE': [ -0.31, -1.12, -0.81 ],\n  'LEU': [ -0.56, -1.25, -0.69 ],\n  'LYS': [ 0.99, 2.80, 1.81 ],\n  'MET': [ -0.23, -0.67, -0.44 ],\n  'PHE': [ -1.13, -1.71, -0.58 ],\n  'PRO': [ 0.45, 0.14, -0.31 ],\n  'SER': [ 0.13, 0.46, 0.33 ],\n  'THR': [ 0.14, 0.25, 0.11 ],\n  'TRP': [ -1.85, -2.09, -0.24 ],\n  'TYR': [ -0.94, -0.71, 0.23 ],\n  'VAL': [ 0.07, -0.46, -0.53 ]\n}\nexport const DefaultResidueHydrophobicity = [ 0.00, 0.00, 0.00 ]\n\nexport const AA1: { [k: string]: string } = {\n  'HIS': 'H',\n  'ARG': 'R',\n  'LYS': 'K',\n  'ILE': 'I',\n  'PHE': 'F',\n  'LEU': 'L',\n  'TRP': 'W',\n  'ALA': 'A',\n  'MET': 'M',\n  'PRO': 'P',\n  'CYS': 'C',\n  'ASN': 'N',\n  'VAL': 'V',\n  'GLY': 'G',\n  'SER': 'S',\n  'GLN': 'Q',\n  'TYR': 'Y',\n  'ASP': 'D',\n  'GLU': 'E',\n  'THR': 'T',\n\n  'SEC': 'U',  // as per IUPAC definition\n  'PYL': 'O',  // as per IUPAC definition\n}\n\nexport const AA3 = Object.keys(AA1)\n\nexport const RnaBases = [ 'A', 'C', 'T', 'G', 'U', 'I' ]\n\nexport const DnaBases = [ 'DA', 'DC', 'DT', 'DG', 'DU', 'DI' ]\n\nexport const PurinBases = [ 'A', 'G', 'I', 'DA', 'DG', 'DI' ]\n\nexport const Bases = RnaBases.concat(DnaBases)\n\nexport const WaterNames = [\n  'SOL', 'WAT', 'HOH', 'H2O', 'W', 'DOD', 'D3O', 'TIP3', 'TIP4', 'SPC'\n]\n\n// all chemical components with the word \"ion\" in their name, Sep 2016\n//\n// SET SESSION group_concat_max_len = 1000000;\n// SELECT GROUP_CONCAT(id_ ORDER BY id_ ASC SEPARATOR '\", \"') from\n// (\n//     SELECT count(obj_id) as c, id_\n//     FROM pdb.chem_comp WHERE name LIKE \"% ION%\"\n//     GROUP BY id_\n// ) AS t1;\nexport const IonNames = [\n  '118', '119', '1AL', '1CU', '2FK', '2HP', '2OF', '3CO',\n  '3MT', '3NI', '3OF', '3P8', '4MO', '4PU', '543', '6MO', 'ACT', 'AG', 'AL',\n  'ALF', 'AM', 'ATH', 'AU', 'AU3', 'AUC', 'AZI', 'BA', 'BCT', 'BEF', 'BF4', 'BO4',\n  'BR', 'BS3', 'BSY', 'CA', 'CAC', 'CD', 'CD1', 'CD3', 'CD5', 'CE', 'CHT', 'CL',\n  'CO', 'CO3', 'CO5', 'CON', 'CR', 'CS', 'CSB', 'CU', 'CU1', 'CU3', 'CUA', 'CUZ',\n  'CYN', 'DME', 'DMI', 'DSC', 'DTI', 'DY', 'E4N', 'EDR', 'EMC', 'ER3', 'EU',\n  'EU3', 'F', 'FE', 'FE2', 'FPO', 'GA', 'GD3', 'GEP', 'HAI', 'HG', 'HGC', 'IN',\n  'IOD', 'IR', 'IR3', 'IRI', 'IUM', 'K', 'KO4', 'LA', 'LCO', 'LCP', 'LI', 'LU',\n  'MAC', 'MG', 'MH2', 'MH3', 'MLI', 'MLT', 'MMC', 'MN', 'MN3', 'MN5', 'MN6',\n  'MO1', 'MO2', 'MO3', 'MO4', 'MO5', 'MO6', 'MOO', 'MOS', 'MOW', 'MW1', 'MW2',\n  'MW3', 'NA', 'NA2', 'NA5', 'NA6', 'NAO', 'NAW', 'NCO', 'NET', 'NH4', 'NI',\n  'NI1', 'NI2', 'NI3', 'NO2', 'NO3', 'NRU', 'O4M', 'OAA', 'OC1', 'OC2', 'OC3',\n  'OC4', 'OC5', 'OC6', 'OC7', 'OC8', 'OCL', 'OCM', 'OCN', 'OCO', 'OF1', 'OF2',\n  'OF3', 'OH', 'OS', 'OS4', 'OXL', 'PB', 'PBM', 'PD', 'PDV', 'PER', 'PI', 'PO3',\n  'PO4', 'PR', 'PT', 'PT4', 'PTN', 'RB', 'RH3', 'RHD', 'RU', 'SB', 'SCN', 'SE4',\n  'SEK', 'SM', 'SMO', 'SO3', 'SO4', 'SR', 'T1A', 'TB', 'TBA', 'TCN', 'TEA', 'TH',\n  'THE', 'TL', 'TMA', 'TRA', 'UNX', 'V', 'VN3', 'VO4', 'W', 'WO5', 'Y1', 'YB',\n  'YB2', 'YH', 'YT3', 'ZCM', 'ZN', 'ZN2', 'ZN3', 'ZNO', 'ZO3',\n    // additional ion names\n  'OHX'\n]\n\n// all chemical components with the word \"%saccharide%\" in their type, Sep 2016\n//\n// SET SESSION group_concat_max_len = 1000000;\n// select GROUP_CONCAT(id_ ORDER BY id_ ASC SEPARATOR '\", \"') from\n// (\n//     SELECT count(obj_id), id_\n//     FROM pdb.chem_comp WHERE type like \"%SACCHARIDE%\"\n//     GROUP BY id_\n// ) AS t1;\nexport const SaccharideNames = [\n  '045', '0AT', '0BD', '0MK', '0NZ', '0TS', '0V4', '0XY', '0YT', '10M',\n  '147', '149', '14T', '15L', '16G', '18T', '18Y', '1AR', '1BW', '1GL', '1GN',\n  '1JB', '1LL', '1NA', '1S3', '26M', '26Q', '26R', '26V', '26W', '26Y', '27C',\n  '289', '291', '293', '2DG', '2F8', '2FG', '2FL', '2FP', '2GL', '2M4', '2M5',\n  '32O', '34V', '3CM', '3DO', '3DY', '3FM', '3LR', '3MF', '3MG', '3SA', '3ZW',\n  '46D', '46M', '46Z', '48Z', '4CQ', '4GC', '4NN', '50A', '5DI', '5GF', '5MM',\n  '5RP', '5SA', '5SP', '64K', '6PG', '6SA', '7JZ', '7SA', 'A1Q', 'A2G', 'AAB',\n  'AAL', 'AAO', 'ABC', 'ABD', 'ABE', 'ABF', 'ABL', 'ACG', 'ACI', 'ACR', 'ACX',\n  'ADA', 'ADG', 'ADR', 'AF1', 'AFD', 'AFL', 'AFO', 'AFP', 'AFR', 'AGC', 'AGH',\n  'AGL', 'AHR', 'AIG', 'ALL', 'ALX', 'AMU', 'AOG', 'AOS', 'ARA', 'ARB', 'ARE',\n  'ARI', 'ASG', 'ASO', 'AXP', 'AXR', 'B0D', 'B16', 'B2G', 'B4G', 'B6D', 'B8D',\n  'B9D', 'BBK', 'BCD', 'BDG', 'BDP', 'BDR', 'BEM', 'BFP', 'BGC', 'BGL', 'BGP',\n  'BGS', 'BHG', 'BMA', 'BMX', 'BNG', 'BNX', 'BOG', 'BRI', 'BXF', 'BXP', 'BXX',\n  'BXY', 'C3X', 'C4X', 'C5X', 'CAP', 'CBI', 'CBK', 'CBS', 'CDR', 'CEG', 'CGF',\n  'CHO', 'CR1', 'CR6', 'CRA', 'CT3', 'CTO', 'CTR', 'CTT', 'D6G', 'DAF', 'DAG',\n  'DDA', 'DDB', 'DDL', 'DEL', 'DFR', 'DFX', 'DG0', 'DGC', 'DGD', 'DGM', 'DGS',\n  'DIG', 'DLF', 'DLG', 'DMU', 'DNO', 'DOM', 'DP5', 'DQQ', 'DQR', 'DR2', 'DR3',\n  'DR4', 'DRI', 'DSR', 'DT6', 'DVC', 'E4P', 'E5G', 'EAG', 'EBG', 'EBQ', 'EGA',\n  'EJT', 'EPG', 'ERE', 'ERI', 'F1P', 'F1X', 'F6P', 'FBP', 'FCA', 'FCB', 'FCT',\n  'FDP', 'FDQ', 'FFC', 'FIX', 'FMO', 'FRU', 'FSI', 'FU4', 'FUB', 'FUC', 'FUD',\n  'FUL', 'FXP', 'G16', 'G1P', 'G2F', 'G3I', 'G4D', 'G4S', 'G6D', 'G6P', 'G6S',\n  'GAC', 'GAD', 'GAL', 'GC1', 'GC4', 'GCD', 'GCN', 'GCO', 'GCS', 'GCT', 'GCU',\n  'GCV', 'GCW', 'GCX', 'GE1', 'GFG', 'GFP', 'GIV', 'GL0', 'GL2', 'GL5', 'GL6',\n  'GL7', 'GL9', 'GLA', 'GLB', 'GLC', 'GLD', 'GLF', 'GLG', 'GLO', 'GLP', 'GLS',\n  'GLT', 'GLW', 'GMH', 'GN1', 'GNX', 'GP1', 'GP4', 'GPH', 'GPM', 'GQ1', 'GQ2',\n  'GQ4', 'GS1', 'GS4', 'GSA', 'GSD', 'GTE', 'GTH', 'GTK', 'GTR', 'GTZ', 'GU0',\n  'GU1', 'GU2', 'GU3', 'GU4', 'GU5', 'GU6', 'GU8', 'GU9', 'GUF', 'GUP', 'GUZ',\n  'GYP', 'GYV', 'H2P', 'HDL', 'HMS', 'HS2', 'HSD', 'HSG', 'HSH', 'HSJ', 'HSQ',\n  'HSR', 'HSU', 'HSX', 'HSY', 'HSZ', 'IAB', 'IDG', 'IDR', 'IDS', 'IDT', 'IDU',\n  'IDX', 'IDY', 'IMK', 'IN1', 'IPT', 'ISL', 'KBG', 'KD2', 'KDA', 'KDM', 'KDO',\n  'KFN', 'KO1', 'KO2', 'KTU', 'L6S', 'LAG', 'LAI', 'LAK', 'LAO', 'LAT', 'LB2',\n  'LBT', 'LCN', 'LDY', 'LGC', 'LGU', 'LM2', 'LMT', 'LMU', 'LOG', 'LOX', 'LPK',\n  'LSM', 'LTM', 'LVZ', 'LXB', 'LXZ', 'M1F', 'M3M', 'M6P', 'M8C', 'MA1', 'MA2',\n  'MA3', 'MAB', 'MAG', 'MAL', 'MAN', 'MAT', 'MAV', 'MAW', 'MBG', 'MCU', 'MDA',\n  'MDM', 'MDP', 'MFA', 'MFB', 'MFU', 'MG5', 'MGA', 'MGL', 'MLB', 'MMA', 'MMN',\n  'MN0', 'MRP', 'MTT', 'MUG', 'MVP', 'MXY', 'N1L', 'N9S', 'NAA', 'NAG', 'NBG',\n  'NDG', 'NED', 'NG1', 'NG6', 'NGA', 'NGB', 'NGC', 'NGE', 'NGF', 'NGL', 'NGS',\n  'NGY', 'NHF', 'NM6', 'NM9', 'NTF', 'NTO', 'NTP', 'NXD', 'NYT', 'OPG', 'OPM',\n  'ORP', 'OX2', 'P3M', 'P53', 'P6P', 'PA5', 'PNA', 'PNG', 'PNW', 'PRP', 'PSJ',\n  'PSV', 'PTQ', 'QDK', 'QPS', 'QV4', 'R1P', 'R1X', 'R2B', 'R5P', 'RAA', 'RAE',\n  'RAF', 'RAM', 'RAO', 'RAT', 'RB5', 'RBL', 'RCD', 'RDP', 'REL', 'RER', 'RF5',\n  'RG1', 'RGG', 'RHA', 'RIB', 'RIP', 'RNS', 'RNT', 'ROB', 'ROR', 'RPA', 'RST',\n  'RUB', 'RUU', 'RZM', 'S6P', 'S7P', 'SA0', 'SCR', 'SDD', 'SF6', 'SF9', 'SG4',\n  'SG5', 'SG6', 'SG7', 'SGA', 'SGC', 'SGD', 'SGN', 'SGS', 'SHB', 'SHG', 'SI3',\n  'SIO', 'SOE', 'SOL', 'SSG', 'SUC', 'SUP', 'SUS', 'T6P', 'T6T', 'TAG', 'TCB',\n  'TDG', 'TGK', 'TGY', 'TH1', 'TIA', 'TM5', 'TM6', 'TM9', 'TMR', 'TMX', 'TOA',\n  'TOC', 'TRE', 'TYV', 'UCD', 'UDC', 'VG1', 'X0X', 'X1X', 'X2F', 'X4S', 'X5S',\n  'X6X', 'XBP', 'XDN', 'XDP', 'XIF', 'XIM', 'XLF', 'XLS', 'XMM', 'XUL', 'XXR',\n  'XYP', 'XYS', 'YO5', 'Z3Q', 'Z6J', 'Z9M', 'ZDC', 'ZDM'\n]\n\nexport const ProteinBackboneAtoms = [\n  'CA', 'C', 'N', 'O',\n  'O1', 'O2', 'OC1', 'OC2', 'OX1', 'OXT', 'OT1', 'OT2',\n  'H', 'H1', 'H2', 'H3', 'HA', 'HN',\n  'BB'\n]\n\nexport const NucleicBackboneAtoms = [\n  'P', 'OP1', 'OP2', 'HOP2', 'HOP3',\n  \"O2'\", \"O3'\", \"O4'\", \"O5'\", \"C1'\", \"C2'\", \"C3'\", \"C4'\", \"C5'\",\n  \"H1'\", \"H2'\", \"H2''\", \"HO2'\", \"H3'\", \"H4'\", \"H5'\", \"H5''\", \"HO3'\", \"HO5'\",\n  'O2*', 'O3*', 'O4*', 'O5*', 'C1*', 'C2*', 'C3*', 'C4*', 'C5*'\n]\n\nexport const ResidueTypeAtoms: { [k: number]: { [k: string]: string|string[] } } = {}\n\nResidueTypeAtoms[ ProteinBackboneType ] = {\n  trace: 'CA',\n  direction1: 'C',\n  direction2: [ 'O', 'OC1', 'O1', 'OX1', 'OXT', 'OT1', 'OT2' ],\n  backboneStart: 'N',\n  backboneEnd: 'C'\n}\n\nResidueTypeAtoms[ RnaBackboneType ] = {\n  trace: [ \"C4'\", 'C4*' ],\n  direction1: [ \"C1'\", 'C1*' ],\n  direction2: [ \"C3'\", 'C3*' ],\n  backboneStart: 'P',\n  backboneEnd: [ \"O3'\", 'O3*' ]\n}\n\nResidueTypeAtoms[ DnaBackboneType ] = {\n  trace: [ \"C3'\", 'C3*' ],\n  direction1: [ \"C2'\", 'C2*' ],\n  direction2: [ \"O4'\", 'O4*' ],\n  backboneStart: 'P',\n  backboneEnd: [ \"O3'\", 'O3*' ]\n}\n\nResidueTypeAtoms[ CgProteinBackboneType ] = {\n  trace: [ 'CA', 'BB' ],\n  backboneStart: [ 'CA', 'BB' ],\n  backboneEnd: [ 'CA', 'BB' ]\n}\n\nResidueTypeAtoms[ CgRnaBackboneType ] = {\n  trace: [ \"C4'\", 'C4*', 'P' ],\n  backboneStart: [ \"C4'\", 'C4*', 'P' ],\n  backboneEnd: [ \"C4'\", 'C4*', 'P' ]\n}\n\nResidueTypeAtoms[ CgDnaBackboneType ] = {\n  trace: [ \"C3'\", 'C3*', \"C2'\", 'P' ],  // C2' is used in martini ff\n  backboneStart: [ \"C3'\", 'C3*', \"C2'\", 'P' ],\n  backboneEnd: [ \"C3'\", 'C3*', \"C2'\", 'P' ]\n}\n\nResidueTypeAtoms[ UnknownBackboneType ] = {}\n","/**\n * @file Geometry\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { Vector3 } from 'three'\n\nimport { Elements } from '../structure/structure-constants'\nimport { degToRad } from '../math/math-utils'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// Changed numbering so they're mostly inline with coordination number\n// from VSEPR\nexport const enum AtomGeometry {\n  Spherical = 0,\n  Terminal = 1,\n  Linear = 2,\n  Trigonal = 3,\n  Tetrahedral = 4,\n  TrigonalBiPyramidal = 5,\n  Octahedral = 6,\n  SquarePlanar = 7, // Okay, it breaks down somewhere!\n  Unknown = 8\n}\n\nexport function assignGeometry (totalCoordination: number): AtomGeometry {\n  switch(totalCoordination){\n    case 0:\n      return AtomGeometry.Spherical\n    case 1:\n      return AtomGeometry.Terminal\n    case 2:\n      return AtomGeometry.Linear\n    case 3:\n      return AtomGeometry.Trigonal\n    case 4:\n      return AtomGeometry.Tetrahedral\n    default:\n      return AtomGeometry.Unknown\n  }\n}\n\nexport const Angles = new Map<AtomGeometry, number>([\n  [ AtomGeometry.Linear, degToRad(180) ],\n  [ AtomGeometry.Trigonal, degToRad(120) ],\n  [ AtomGeometry.Tetrahedral, degToRad(109.4721) ],\n  [ AtomGeometry.Octahedral, degToRad(90) ]\n])\n\n/**\n * Calculate the angles x-1-2 for all x where x is a heavy atom bonded to ap1.\n * @param  {AtomProxy} ap1 First atom (angle centre)\n * @param  {AtomProxy} ap2 Second atom\n * @return {number[]}        Angles in radians\n */\nexport function calcAngles (ap1: AtomProxy, ap2: AtomProxy): number[] {\n  let angles: number[] = []\n  const d1 = new Vector3()\n  const d2 = new Vector3()\n  d1.subVectors(ap2 as any, ap1 as any)\n  ap1.eachBondedAtom( x => {\n    if (x.number !== Elements.H) {\n      d2.subVectors(x as any, ap1 as any)\n      angles.push(d1.angleTo(d2))\n    }\n   })\n  return angles\n}\n\n/**\n * Find two neighbours of ap1 to define a plane (if possible) and\n * measure angle out of plane to ap2\n * @param  {AtomProxy} ap1 First atom (angle centre)\n * @param  {AtomProxy} ap2 Second atom (out-of-plane)\n * @return {number}        Angle from plane to second atom\n */\nexport function calcPlaneAngle (ap1: AtomProxy, ap2: AtomProxy): number | undefined {\n  const x1 = ap1.clone()\n\n  const v12 = new Vector3()\n  v12.subVectors(ap2 as any, ap1 as any)\n\n  const neighbours = [new Vector3(), new Vector3()]\n  let ni = 0\n  ap1.eachBondedAtom( x => {\n    if (ni > 1) { return }\n    if (x.number !== Elements.H) {\n      x1.index = x.index\n      neighbours[ni++].subVectors(x as any, ap1 as any)\n    }\n  })\n  if (ni === 1) {\n    x1.eachBondedAtom( x => {\n      if (ni > 1) { return }\n      if (x.number !== Elements.H && x.index !== ap1.index){\n        neighbours[ni++].subVectors(x as any, ap1 as any)\n      }\n    })\n  }\n  if (ni !== 2) {\n    return\n  }\n\n  const cp = neighbours[0].cross(neighbours[1])\n  return Math.abs((Math.PI / 2) - cp.angleTo(v12))\n}\n","/**\n * @file Valence Model\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * Reworked ValenceModel\n *\n * TODO:\n *   Ensure proper treatment of disorder/models. e.g. V257 N in 5vim\n *   Formal charge of 255 for SO4 anion (e.g. 5ghl)\n *   Have removed a lot of explicit features (as I think they're more\n *   generally captured by better VM).\n *     Could we instead have a \"delocalised negative/positive\" charge\n *     feature and flag these up?\n *\n */\nimport { Data } from '../structure/data'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { AtomGeometry, assignGeometry } from './geometry'\nimport { Elements } from '../structure/structure-constants'\n\n/**\n * Are we involved in some kind of pi system. Either explicitly forming\n * double bond or N, O next to a double bond, except:\n *\n *   N,O with degree 4 cannot be conjugated.\n *   N,O adjacent to P=O or S=O do not qualify (keeps sulfonamide N sp3 geom)\n */\nfunction isConjugated (a: AtomProxy) {\n  const _bp = a.structure.getBondProxy()\n  const atomicNumber = a.number\n  const hetero = atomicNumber === Elements.O || atomicNumber === Elements.N\n\n  if (hetero && a.bondCount === 4) {\n    return false\n  }\n\n  let flag = false\n\n  a.eachBond(b => {\n    if (b.bondOrder > 1) {\n      flag = true\n      return\n    }\n    if (hetero) {\n      const a2 = b.getOtherAtom(a)\n\n      a2.eachBond(b2 => {\n        if (b2.bondOrder > 1) {\n          const atomicNumber2 = a2.number\n          if (\n            (atomicNumber2 === Elements.P || atomicNumber2 === Elements.S) &&\n            b2.getOtherAtom(a2).number === Elements.O\n          ) {\n            return\n          }\n          flag = true\n        }\n      }, _bp) // Avoid reuse of structure._bp\n    }\n  })\n\n  return flag\n}\n\n/* function hasExplicitCharge(r: ResidueProxy) {\n  let flag = false\n  r.eachAtom(a => {\n    if (a.formalCharge != null && a.formalCharge !== 0) flag = true\n  })\n  return flag\n}\n\nfunction hasExplicitHydrogen(r: ResidueProxy) {\n  let flag = false\n  r.eachAtom(a => {\n    if (a.number === Elements.H) flag = true\n  })\n  return flag\n} */\n\nexport function explicitValence (a: AtomProxy) {\n  let v = 0\n  a.eachBond(b => v += b.bondOrder)\n  return v\n}\n\n/**\n * Attempts to produce a consistent charge and implicit\n * H-count for an atom.\n *\n * If both params.assignCharge and params.assignH, this\n * approximately followsthe rules described in\n * https://docs.eyesopen.com/toolkits/python/oechemtk/valence.html#openeye-hydrogen-count-model\n *\n * If only charge or hydrogens are to be assigned it takes\n * a much simpler view and deduces one from the other\n *\n * @param {AtomProxy}           a      Atom to analyze\n * @param {assignChargeHParams} params What to assign\n */\nexport function calculateHydrogensCharge (a: AtomProxy, params: ValenceModelParams) {\n  const hydrogenCount = a.bondToElementCount(Elements.H)\n  let charge = a.formalCharge || 0\n\n  const assignCharge = (params.assignCharge === 'always' ||\n    (params.assignCharge === 'auto' && charge === 0))\n  const assignH = (params.assignH === 'always' ||\n    (params.assignH === 'auto' && hydrogenCount === 0))\n\n  const degree = a.bondCount\n  const valence = explicitValence(a)\n\n  const conjugated = isConjugated(a)\n  const multiBond = (valence - degree > 0)\n\n\n  let implicitHCount = 0\n  let geom = AtomGeometry.Unknown\n\n  switch (a.number) {\n    case Elements.H:\n      if (assignCharge){\n        if (degree === 0){\n          charge = 1\n          geom = AtomGeometry.Spherical\n        } else if (degree === 1) {\n          charge = 0\n          geom = AtomGeometry.Terminal\n        }\n      }\n      break\n\n    case Elements.C:\n      // TODO: Isocyanide?\n      if (assignCharge) {\n        charge = 0 // Assume carbon always neutral\n      }\n      if (assignH) {\n        // Carbocation/carbanion are 3-valent\n        implicitHCount = Math.max(0, 4 - valence - Math.abs(charge))\n      }\n      // Carbocation is planar, carbanion is tetrahedral\n      geom = assignGeometry(degree + implicitHCount + Math.max(0, -charge))\n      break\n\n    case Elements.N:\n      if (assignCharge) {\n        if (!assignH) { // Trust input H explicitly:\n          charge = valence - 3\n        } else if (conjugated && valence < 4) {\n          // Neutral unless amidine/guanidine double-bonded N:\n          if (degree - hydrogenCount === 1 && valence - hydrogenCount === 2) {\n            charge = 1\n          } else {\n            charge = 0\n          }\n        } else {\n          // Sulfonamide nitrogen and classed as sp3 in conjugation model but\n          // they won't be charged\n          // Don't assign charge to nitrogens bound to metals\n          let flag = false\n          a.eachBondedAtom(ba => {\n            if (ba.number === Elements.S || ba.isMetal()) flag = true\n          })\n          if (flag) charge = 0\n          else charge = 1\n          // TODO: Planarity sanity check?\n        }\n\n      }\n\n      if (assignH) {\n        // NH4+ -> 4, 1' amide -> 2, nitro N/N+ depiction -> 0\n        implicitHCount = Math.max(0, 3 - valence + charge)\n      }\n\n      if (conjugated && !multiBond) {\n        // Amide, anilinic N etc. cannot consider lone-pair for geometry purposes\n        // Anilinic N geometry is depenent on ring electronics, for our purposes we\n        // assume it's trigonal!\n        geom = assignGeometry(degree + implicitHCount - charge)\n      } else {\n        // Everything else, pyridine, amine, nitrile, lp plays normal role:\n        geom = assignGeometry(degree + implicitHCount + 1 - charge)\n      }\n      break\n\n    case Elements.O:\n      if (assignCharge) {\n        if (!assignH) {\n          charge = valence - 2 //\n        }\n        if (valence === 1) {\n          a.eachBondedAtom(ba => {\n            ba.eachBond(b => {\n              const oa = b.getOtherAtom(ba)\n              if (oa.index !== a.index && oa.number === Elements.O && b.bondOrder === 2){\n                charge = -1\n              }\n            })\n          })\n        }\n      }\n      if (assignH) {\n        // ethanol -> 1, carboxylate -> -1\n        implicitHCount = Math.max(0, 2 - valence + charge)\n      }\n      if (conjugated && !multiBond){\n        // carboxylate OH, phenol OH, one lone-pair taken up with conjugation\n        geom = assignGeometry(degree + implicitHCount - charge + 1)\n      } else {\n        // Carbonyl (trigonal)\n        geom = assignGeometry(degree + implicitHCount - charge + 2)\n      }\n      break\n\n    // Only handles thiols/thiolates/thioether/sulfonium. Sulfoxides and higher\n    // oxidiation states are assumed neutral S (charge carried on O if required)\n    case Elements.S:\n      if (assignCharge) {\n        if (!assignH) {\n          if (valence <= 3 && !a.bondToElementCount(Elements.O)) {\n            charge = valence - 2 // e.g. explicitly deprotonated thiol\n          } else {\n            charge = 0\n          }\n        }\n      }\n      if (assignH){\n        if (valence < 2){\n          implicitHCount = Math.max(0, 2 - valence + charge)\n        }\n      }\n      if (valence <= 3){\n        // Thiol, thiolate, tioether -> tetrahedral\n        geom = assignGeometry(degree + implicitHCount - charge + 2)\n      }\n\n      break\n\n    case Elements.F:\n    case Elements.CL:\n    case Elements.BR:\n    case Elements.I:\n    case Elements.AT:\n      // Never implicitly protonate halides\n      if (assignCharge) {\n        charge = valence - 1\n      }\n      break\n\n    case Elements.LI:\n    case Elements.NA:\n    case Elements.K:\n    case Elements.RB:\n    case Elements.CS:\n    case Elements.FR:\n      if (assignCharge) {\n        charge = 1 - valence\n      }\n      break\n\n    case Elements.BE:\n    case Elements.MG:\n    case Elements.CA:\n    case Elements.SR:\n    case Elements.BA:\n    case Elements.RA:\n      if (assignCharge) {\n        charge = 2 - valence\n      }\n      break\n\n    default:\n      console.warn('Requested charge, protonation for an unhandled element', a.element)\n  }\n\n  return [ charge, implicitHCount, implicitHCount + hydrogenCount, geom ]\n}\n\n\nexport interface ValenceModel {\n  charge: Int8Array,\n  implicitH: Int8Array,\n  totalH: Int8Array,\n  idealGeometry: Int8Array\n}\n\nexport interface ValenceModelParams {\n  assignCharge: string,\n  assignH: string\n}\n\nexport function ValenceModel (data: Data, params: ValenceModelParams) {\n  const structure = data.structure\n  const n = structure.atomCount\n\n  const charge = new Int8Array(n)\n  const implicitH = new Int8Array(n)\n  const totalH = new Int8Array(n)\n  const idealGeometry = new Int8Array(n)\n\n  structure.eachAtom(a => {\n    const i = a.index\n    const [ chg, implH, totH, geom ] = calculateHydrogensCharge(a, params)\n    charge[ i ] = chg\n    implicitH[ i ] = implH\n    totalH[ i ] = totH\n    idealGeometry[ i ] = geom\n  })\n\n  return { charge, implicitH, totalH, idealGeometry }\n}","\nimport Structure from './structure'\nimport SpatialHash from '../geometry/spatial-hash'\nimport { ValenceModel } from '../chemistry/valence-model'\n\nexport interface Data {\n  structure: Structure\n  '@spatialLookup': SpatialHash | undefined\n  '@valenceModel': ValenceModel | undefined\n}\n\nexport function createData(structure: Structure): Data {\n  return {\n    structure,\n    '@spatialLookup': undefined,\n    '@valenceModel': undefined\n  }\n}\n\nexport function spatialLookup(data: Data): SpatialHash {\n  if (data['@spatialLookup']) return data['@spatialLookup']!\n  const lookup = new SpatialHash(data.structure.atomStore, data.structure.boundingBox)\n  data['@spatialLookup'] = lookup\n  return lookup\n}\n\nexport function valenceModel(data: Data): ValenceModel {\n  if (data['@valenceModel']) return data['@valenceModel']!\n  const valenceModel = ValenceModel(data, {assignCharge: 'auto', assignH: 'auto'})\n  data['@valenceModel'] = valenceModel\n  return valenceModel\n}\n","/**\n * @file Functional Groups\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport AtomProxy from '../proxy/atom-proxy'\nimport { Elements } from '../structure/structure-constants'\n\n/**\n * Nitrogen in a quaternary amine\n */\nexport function isQuaternaryAmine (a: AtomProxy) {\n  return (\n    a.number === 7 &&\n    a.bondCount === 4 &&\n    a.bondToElementCount(Elements.H) === 0\n  )\n}\n\n/**\n * Nitrogen in a tertiary amine\n */\nexport function isTertiaryAmine (a: AtomProxy, idealValence: number) {\n  return (\n    a.number === 7 &&\n    a.bondCount >= 3 &&\n    idealValence === 3\n  )\n}\n\n/**\n * Nitrogen in an imide\n */\nexport function isImide (a: AtomProxy) {\n  let flag = false\n  if (a.number === Elements.N && (a.bondCount - a.bondToElementCount(Elements.H)) === 2) {\n    let carbonylCount = 0\n    a.eachBondedAtom(ba => {\n      if (isCarbonyl(ba)) ++carbonylCount\n    })\n    flag = carbonylCount === 2\n  }\n  return flag\n}\n\n/**\n * Nitrogen in an amide\n */\nexport function isAmide (a: AtomProxy) {\n  let flag = false\n  if (a.number === Elements.N && (a.bondCount - a.bondToElementCount(Elements.H)) === 2) {\n    let carbonylCount = 0\n    a.eachBondedAtom(ba => {\n      if (isCarbonyl(ba)) ++carbonylCount\n    })\n    flag = carbonylCount === 1\n  }\n  return flag\n}\n\n/**\n * Sulfur in a sulfonium group\n */\nexport function isSulfonium (a: AtomProxy) {\n  return (\n    a.number === 16 &&\n    a.bondCount === 3 &&\n    a.bondToElementCount(Elements.H) === 0\n  )\n}\n\n/**\n * Sulfur in a sulfonic acid or sulfonate group\n */\nexport function isSulfonicAcid (a: AtomProxy) {\n  return (\n    a.number === 16 &&\n    a.bondToElementCount(Elements.O) === 3\n  )\n}\n\n/**\n * Sulfur in a sulfate group\n */\nexport function isSulfate (a: AtomProxy) {\n  return (\n    a.number === 16 &&\n    a.bondToElementCount(Elements.O) === 4\n  )\n}\n\n/**\n * Phosphor in a phosphate group\n */\nexport function isPhosphate (a: AtomProxy) {\n  return (\n    a.number === 15 &&\n    a.bondToElementCount(Elements.O) === a.bondCount\n  )\n}\n\n/**\n * Halogen with one bond to a carbon\n */\nexport function isHalocarbon (a: AtomProxy) {\n  return (\n    a.isHalogen() &&\n    a.bondCount === 1 &&\n    a.bondToElementCount(Elements.C) === 1\n  )\n}\n\n/**\n * Carbon in a carbonyl/acyl group\n */\nexport function isCarbonyl (a: AtomProxy) {\n  let flag = false\n  if (a.number === Elements.C) {\n    a.eachBond(b => {\n      if (b.bondOrder === 2 && b.getOtherAtom(a).number === Elements.O) {\n        flag = true\n      }\n    })\n  }\n  return flag\n}\n\n/**\n * Carbon in a carboxylate group\n */\nexport function isCarboxylate (a: AtomProxy) {\n  let terminalOxygenCount = 0\n  if (\n    a.number === 6 &&\n    a.bondToElementCount(Elements.O) === 2 &&\n    a.bondToElementCount(Elements.C) === 1\n  ) {\n    a.eachBondedAtom(ba => {\n      if (ba.number === 8 && ba.bondCount - ba.bondToElementCount(Elements.H) === 1) {\n        ++terminalOxygenCount\n      }\n    })\n  }\n  return terminalOxygenCount === 2\n}\n\n/**\n * Carbon in a guanidine group\n */\nexport function isGuanidine (a: AtomProxy) {\n  let terminalNitrogenCount = 0\n  if (\n    a.number === 6 &&\n    a.bondCount === 3 &&\n    a.bondToElementCount(Elements.N) === 3\n  ) {\n    a.eachBondedAtom(ba => {\n      if (ba.bondCount - ba.bondToElementCount(Elements.H) === 1) {\n        ++terminalNitrogenCount\n      }\n    })\n  }\n  return terminalNitrogenCount === 2\n}\n\n/**\n * Carbon in a acetamidine group\n */\nexport function isAcetamidine (a: AtomProxy) {\n  let terminalNitrogenCount = 0\n  if (\n    a.number === 6 &&\n    a.bondCount === 3 &&\n    a.bondToElementCount(Elements.N) === 2 &&\n    a.bondToElementCount(Elements.C) === 1\n  ) {\n    a.eachBondedAtom(ba => {\n      if (ba.bondCount - ba.bondToElementCount(Elements.H) === 1) {\n        ++terminalNitrogenCount\n      }\n    })\n  }\n  return terminalNitrogenCount === 2\n}\n\nconst PolarElements = [\n  Elements.N, Elements.O, Elements.S,\n  Elements.F, Elements.CL, Elements.BR, Elements.I\n]\n\nexport function isPolar (a: AtomProxy) {\n  return PolarElements.includes(a.number)\n}\n\nexport function hasPolarNeighbour (a: AtomProxy) {\n  let flag = false\n  a.eachBondedAtom(ba => {\n    if (isPolar(ba)) flag = true\n  })\n  return flag\n}\n\nexport function hasAromaticNeighbour (a: AtomProxy) {\n  let flag = false\n  a.eachBondedAtom(function (bap) {\n    if (bap.aromatic) flag = true\n  })\n  return flag\n}\n","/**\n * @file Charged\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n */\n\nimport { Vector3 } from 'three'\n\nimport { defaults } from '../../utils'\nimport { radToDeg } from '../../math/math-utils'\nimport Structure from '../../structure/structure'\nimport { AA3, Bases, Elements } from '../../structure/structure-constants'\nimport { valenceModel } from '../../structure/data'\nimport {\n  isGuanidine, isAcetamidine, isSulfonicAcid, isPhosphate, isSulfate, isCarboxylate\n} from '../functional-groups'\nimport {\n  Features, FeatureType, FeatureGroup,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\nconst PositvelyCharged = [ 'ARG', 'HIS', 'LYS' ]\nconst NegativelyCharged = [ 'GLU', 'ASP' ]\n\nexport function addPositiveCharges (structure: Structure, features: Features) {\n  const { charge } = valenceModel(structure.data)\n  const atomInGroupDict: { [atomIndex: number]: true } = {}\n\n  structure.eachResidue(r => {\n    if (PositvelyCharged.includes(r.resname)) {\n      const state = createFeatureState(FeatureType.PositiveCharge)\n      r.eachAtom(a => {\n        if (a.number === Elements.N && a.isSidechain()) {\n          addAtom(state, a)\n        }\n      })\n      addFeature(features, state)\n    } else if(!AA3.includes(r.resname) && !r.isNucleic()) {\n      r.eachAtom(a => {\n        let addGroup = false\n        const state = createFeatureState(FeatureType.PositiveCharge)\n        if (isGuanidine(a)) {\n          state.group = FeatureGroup.Guanidine\n          addGroup = true\n        } else if (isAcetamidine(a)) {\n          state.group = FeatureGroup.Acetamidine\n          addGroup = true\n        }\n        if (addGroup) {\n          a.eachBondedAtom(a => {\n            if (a.number === Elements.N) {\n              atomInGroupDict[a.index] = true\n              addAtom(state, a)\n            }\n          })\n          addFeature(features, state)\n        }\n      })\n      r.eachAtom(a => {\n        const state = createFeatureState(FeatureType.PositiveCharge)\n        if (charge[a.index] > 0) {\n          if (!atomInGroupDict[a.index]) {\n            addAtom(state, a)\n            addFeature(features, state)\n          }\n        }\n      })\n    }\n  })\n}\n\nexport function addNegativeCharges (structure: Structure, features: Features) {\n  const { charge } = valenceModel(structure.data)\n  const atomInGroupDict: { [atomIndex: number]: true } = {}\n\n  structure.eachResidue(r => {\n    if (NegativelyCharged.includes(r.resname)) {\n      const state = createFeatureState(FeatureType.NegativeCharge)\n      r.eachAtom(a => {\n        if (a.number === Elements.O && a.isSidechain()) {\n          addAtom(state, a)\n        }\n      })\n      addFeature(features, state)\n    } else if (Bases.includes(r.resname)) {\n      const state = createFeatureState(FeatureType.NegativeCharge)\n      r.eachAtom(a => {\n        if (isPhosphate(a)) {\n          state.group = FeatureGroup.Phosphate\n          a.eachBondedAtom(a => {\n            if (a.number === Elements.O) addAtom(state, a)\n          })\n          addFeature(features, state)\n        }\n      })\n    } else if(!AA3.includes(r.resname) && !Bases.includes(r.resname)) {\n      r.eachAtom(a => {\n        let addGroup = false\n        const state = createFeatureState(FeatureType.NegativeCharge)\n        if (isSulfonicAcid(a)) {\n          state.group = FeatureGroup.SulfonicAcid\n          addGroup = true\n        } else if (isPhosphate(a)) {\n          state.group = FeatureGroup.Phosphate\n          addGroup = true\n        } else if (isSulfate(a)) {\n          state.group = FeatureGroup.Sulfate\n          addGroup = true\n        } else if (isCarboxylate(a)) {\n          state.group = FeatureGroup.Carboxylate\n          addGroup = true\n        }\n        if (addGroup) {\n          a.eachBondedAtom(a => {\n            if (a.number === Elements.O) {\n              atomInGroupDict[a.index] = true\n              addAtom(state, a)\n            }\n          })\n          addFeature(features, state)\n        }\n      })\n      r.eachAtom(a => {\n        const state = createFeatureState(FeatureType.NegativeCharge)\n        if (charge[a.index] < 0) {\n          if (!atomInGroupDict[a.index]) {\n            addAtom(state, a)\n            addFeature(features, state)\n          }\n        }\n      })\n    }\n  })\n}\n\nexport function addAromaticRings (structure: Structure, features: Features) {\n  const a = structure.getAtomProxy()\n  structure.eachResidue(r => {\n    const rings = r.getAromaticRings()\n    if (rings) {\n      const offset = r.atomOffset\n      rings.forEach(ring => {\n        const state = createFeatureState(FeatureType.AromaticRing)\n        ring.forEach(i => {\n          a.index = i + offset\n          addAtom(state, a)\n        })\n        addFeature(features, state)\n      })\n    }\n  })\n}\n\nfunction isIonicInteraction (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.NegativeCharge && tj === FeatureType.PositiveCharge) ||\n    (ti === FeatureType.PositiveCharge && tj === FeatureType.NegativeCharge)\n  )\n}\n\nfunction isPiStacking (ti: FeatureType, tj: FeatureType) {\n  return ti === FeatureType.AromaticRing && tj === FeatureType.AromaticRing\n}\n\nfunction isCationPi (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.AromaticRing && tj === FeatureType.PositiveCharge) ||\n    (ti === FeatureType.PositiveCharge && tj === FeatureType.AromaticRing)\n  )\n}\n\nexport interface ChargedContactsParams {\n  maxIonicDist?: number\n  maxPiStackingDist?: number\n  maxPiStackingOffset?: number\n  maxPiStackingAngle?: number\n  maxCationPiDist?: number\n  maxCationPiOffset?: number\n  masterModelIndex?: number\n}\n\nexport function addChargedContacts (structure: Structure, contacts: Contacts, params: ChargedContactsParams = {}) {\n  const maxIonicDist = defaults(params.maxIonicDist, ContactDefaultParams.maxIonicDist)\n  const maxPiStackingDist = defaults(params.maxPiStackingDist, ContactDefaultParams.maxPiStackingDist)\n  const maxPiStackingOffset = defaults(params.maxPiStackingOffset, ContactDefaultParams.maxPiStackingOffset)\n  const maxPiStackingAngle = defaults(params.maxPiStackingAngle, ContactDefaultParams.maxPiStackingAngle)\n  const maxCationPiDist = defaults(params.maxCationPiDist, ContactDefaultParams.maxCationPiDist)\n  const maxCationPiOffset = defaults(params.maxCationPiOffset, ContactDefaultParams.maxCationPiOffset)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const maxDistance = Math.max(maxIonicDist + 2, maxPiStackingDist, maxCationPiDist)\n  // const maxSaltBridgeDistSq = maxSaltBridgeDist * maxSaltBridgeDist\n  const maxPiStackingDistSq = maxPiStackingDist * maxPiStackingDist\n  const maxCationPiDistSq = maxCationPiDist * maxCationPiDist\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ax = structure.atomStore.x\n  const ay = structure.atomStore.y\n  const az = structure.atomStore.z\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  const areAtomSetsWithinDist = function (atomSet1: number[], atomSet2: number[], maxDist: number) {\n    const sn = atomSet1.length\n    const sm = atomSet2.length\n    for (let si = 0; si < sn; ++si) {\n      ap1.index = atomSet1[ si ]\n      for (let sj = 0; sj < sm; ++sj) {\n        ap2.index = atomSet2[ sj ]\n        if (ap1.distanceTo(ap2) <= maxDist) {\n          return true\n        }\n      }\n    }\n    return false\n  }\n\n  const v1 = new Vector3()\n  const v2 = new Vector3()\n  const v3 = new Vector3()\n  const d1 = new Vector3()\n  const d2 = new Vector3()\n  const n1 = new Vector3()\n  const n2 = new Vector3()\n\n  const getNormal = function (atoms: number[], normal: Vector3) {\n    v1.set(ax[ atoms[ 0 ] ], ay[ atoms[ 0 ] ], az[ atoms[ 0 ] ])\n    v2.set(ax[ atoms[ 1 ] ], ay[ atoms[ 1 ] ], az[ atoms[ 1 ] ])\n    v3.set(ax[ atoms[ 2 ] ], ay[ atoms[ 2 ] ], az[ atoms[ 2 ] ])\n    d1.subVectors(v1, v2)\n    d2.subVectors(v1, v3)\n    normal.crossVectors(d1, d2)\n  }\n\n  const getOffset = function (i: number, j: number, normal: Vector3) {\n    v1.set(x[ i ], y[ i ], z[ i ])\n    v2.set(x[ j ], y[ j ], z[ j ])\n    return v1.sub(v2).projectOnPlane(normal).add(v2).distanceTo(v2)\n  }\n\n  const add = function (i: number, j: number, ct: ContactType) {\n    featureSet.setBits(i, j)\n    contactStore.addContact(i, j, ct)\n  }\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxDistance, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n\n      const ti = types[ i ]\n      const tj = types[ j ]\n\n      if (isIonicInteraction(ti, tj)) {\n        if (areAtomSetsWithinDist(atomSets[ i ], atomSets[ j ], maxIonicDist)) {\n          add(i, j, ContactType.IonicInteraction)\n        }\n      } else if (isPiStacking(ti, tj)) {\n        if (dSq <= maxPiStackingDistSq) {\n          getNormal(atomSets[ i ], n1)\n          getNormal(atomSets[ j ], n2)\n\n          const angle = radToDeg(n1.angleTo(n2))\n          const offset = Math.min(getOffset(i, j, n2), getOffset(j, i, n1))\n          if (offset <= maxPiStackingOffset) {\n            if (angle <= maxPiStackingAngle || angle >= 180 - maxPiStackingAngle) {\n              add(i, j, ContactType.PiStacking)  // parallel\n            } else if (angle <= maxPiStackingAngle + 90 && angle >= 90 - maxPiStackingAngle) {\n              add(i, j, ContactType.PiStacking)  // t-shaped\n            }\n          }\n        }\n      } else if (isCationPi(ti, tj)) {\n        if (dSq <= maxCationPiDistSq) {\n          const [ l, k ] = ti === FeatureType.AromaticRing ? [ i, j ] : [ j, i ]\n\n          getNormal(atomSets[ l ], n1)\n          const offset = getOffset(k, l, n1)\n          if (offset <= maxCationPiOffset) {\n            add(l, k, ContactType.CationPi)\n          }\n        }\n      }\n    })\n  }\n}\n","/**\n * @file Hydrogen Bonds\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n */\nimport { defaults } from '../../utils'\nimport { degToRad } from '../../math/math-utils'\nimport Structure from '../../structure/structure'\nimport AtomProxy from '../../proxy/atom-proxy'\nimport { valenceModel } from '../../structure/data'\nimport { Elements } from '../../structure/structure-constants'\nimport { Angles, AtomGeometry, calcAngles, calcPlaneAngle } from '../geometry'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\n\n// Geometric characteristics of hydrogen bonds involving sulfur atoms in proteins\n// https://doi.org/10.1002/prot.22327\n\n// Satisfying Hydrogen Bonding Potential in Proteins (HBPLUS)\n// https://doi.org/10.1006/jmbi.1994.1334\n// http://www.csb.yale.edu/userguides/datamanip/hbplus/hbplus_descrip.html\n\n/**\n * Potential hydrogen donor\n */\nexport function addHydrogenDonors (structure: Structure, features: Features) {\n  const { totalH } = valenceModel(structure.data)\n\n  structure.eachAtom(a => {\n    const state = createFeatureState(FeatureType.HydrogenDonor)\n\n    const an = a.number\n    if (isHistidineNitrogen(a)) {\n      // include both nitrogen atoms in histidine due to\n      // their often ambiguous protonation assignment\n      addAtom(state, a)\n      addFeature(features, state)\n    } else if (\n      totalH[ a.index ] > 0 &&\n      (an === Elements.N || an === Elements.O || an === Elements.S)\n    ) {\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\n/**\n * Weak hydrogen donor.\n */\nexport function addWeakHydrogenDonors (structure: Structure, features: Features) {\n  const { totalH } = valenceModel(structure.data)\n\n  structure.eachAtom(a => {\n    if (\n      a.number === Elements.C &&\n      totalH[ a.index ] > 0 &&\n      (\n        a.bondToElementCount(Elements.N) > 0 ||\n        a.bondToElementCount(Elements.O) > 0 ||\n        inAromaticRingWithElectronNegativeElement(a)\n      )\n    ) {\n      const state = createFeatureState(FeatureType.WeakHydrogenDonor)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nfunction inAromaticRingWithElectronNegativeElement (a: AtomProxy) {\n  if (!a.isAromatic()) return false\n\n  const ringData = a.residueType.getRings()\n  if (!ringData) return false\n\n  let hasElement = false\n  const rings = ringData.rings\n  rings.forEach(ring => {\n    if (hasElement) return  // already found one\n    if (ring.some(idx => (a.index - a.residueAtomOffset) === idx)) {  // in ring\n      hasElement = ring.some(idx => {\n        const atomTypeId = a.residueType.atomTypeIdList[ idx ]\n        const number = a.atomMap.get(atomTypeId).number\n        return number === Elements.N || number === Elements.O\n      })\n    }\n  })\n\n  return hasElement\n}\n\n/**\n * Potential hydrogen acceptor\n */\nexport function addHydrogenAcceptors (structure: Structure, features: Features) {\n  const { charge, implicitH, idealGeometry } = valenceModel(structure.data)\n\n  structure.eachAtom(a => {\n    const state = createFeatureState(FeatureType.HydrogenAcceptor)\n\n    const an = a.number\n    if (an === Elements.O) {\n      // Basically assume all oxygen atoms are acceptors!\n      addAtom(state, a)\n      addFeature(features, state)\n    }else if (an === Elements.N) {\n      if (isHistidineNitrogen(a)) {\n        // include both nitrogen atoms in histidine due to\n        // their often ambiguous protonation assignment\n        addAtom(state, a)\n        addFeature(features, state)\n      } else if (charge[ a.index ] < 1){\n        // Neutral nitrogen might be an acceptor\n        // It must have at least one lone pair not conjugated\n        const totalBonds = a.bondCount + implicitH[ a.index ]\n        const ig = idealGeometry[ a.index ]\n        if (\n          (ig === AtomGeometry.Tetrahedral && totalBonds < 4) ||\n          (ig === AtomGeometry.Trigonal && totalBonds < 3) ||\n          (ig === AtomGeometry.Linear && totalBonds < 2)\n        ) {\n          addAtom(state, a)\n          addFeature(features, state)\n        }\n      }\n    }else if (an === 16) {  // S\n      if (a.resname === 'CYS' || a.resname === 'MET' || a.formalCharge === -1) {\n        addAtom(state, a)\n        addFeature(features, state)\n      }\n    }\n  })\n}\n\n/**\n * Atom that is only bound to carbon or hydrogen\n */\n// function isHydrocarbon (atom: AtomProxy) {\n//   let flag = true\n//   atom.eachBondedAtom(ap => {\n//     const e = ap.element\n//     if (e !== 'C' && e !== 'H') flag = false\n//   })\n//   return flag\n// }\n\nfunction isHistidineNitrogen (ap: AtomProxy) {\n  return ap.resname === 'HIS' && ap.number == Elements.N && ap.isRing()\n}\n\nfunction isBackboneHydrogenBond (ap1: AtomProxy, ap2: AtomProxy) {\n  return ap1.isBackbone() && ap2.isBackbone()\n}\n\nfunction isWaterHydrogenBond (ap1: AtomProxy, ap2: AtomProxy) {\n  return ap1.isWater() && ap2.isWater()\n}\n\nfunction isHydrogenBond (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.HydrogenAcceptor && tj === FeatureType.HydrogenDonor) ||\n    (ti === FeatureType.HydrogenDonor && tj === FeatureType.HydrogenAcceptor)\n  )\n}\n\nfunction isWeakHydrogenBond (ti: FeatureType, tj: FeatureType){\n  return (\n    (ti === FeatureType.WeakHydrogenDonor && tj === FeatureType.HydrogenAcceptor) ||\n    (ti === FeatureType.HydrogenAcceptor && tj === FeatureType.WeakHydrogenDonor)\n  )\n}\n\nfunction getHydrogenBondType (ap1: AtomProxy, ap2: AtomProxy) {\n  if (isWaterHydrogenBond(ap1, ap2)) {\n    return ContactType.WaterHydrogenBond\n  } else if (isBackboneHydrogenBond(ap1, ap2)) {\n    return ContactType.BackboneHydrogenBond\n  } else {\n    return ContactType.HydrogenBond\n  }\n}\n\nexport interface HydrogenBondParams {\n  maxHbondDist?: number\n  maxHbondSulfurDist?: number\n  maxHbondAccAngle?: number\n  maxHbondDonAngle?: number\n  maxHbondAccPlaneAngle?: number\n  maxHbondDonPlaneAngle?: number\n  backboneHbond?: boolean\n  waterHbond?: boolean\n  masterModelIndex?: number\n}\n\n/**\n * All pairs of hydrogen donor and acceptor atoms\n */\nexport function addHydrogenBonds (structure: Structure, contacts: Contacts, params: HydrogenBondParams = {}) {\n  const maxHbondDist = defaults(params.maxHbondDist, ContactDefaultParams.maxHbondDist)\n  const maxHbondSulfurDist = defaults(params.maxHbondSulfurDist, ContactDefaultParams.maxHbondSulfurDist)\n  const maxHbondAccAngle = degToRad(defaults(params.maxHbondAccAngle, ContactDefaultParams.maxHbondAccAngle))\n  const maxHbondDonAngle = degToRad(defaults(params.maxHbondDonAngle, ContactDefaultParams.maxHbondDonAngle))\n  const maxHbondAccPlaneAngle = degToRad(defaults(params.maxHbondAccPlaneAngle, ContactDefaultParams.maxHbondAccPlaneAngle))\n  const maxHbondDonPlaneAngle = degToRad(defaults(params.maxHbondDonPlaneAngle, ContactDefaultParams.maxHbondDonPlaneAngle))\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const maxDist = Math.max(maxHbondDist, maxHbondSulfurDist)\n  const maxHbondDistSq = maxHbondDist * maxHbondDist\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const { idealGeometry } = valenceModel(structure.data)\n\n  const donor = structure.getAtomProxy()\n  const acceptor = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxDist, (j, dSq) => {\n      if (j <= i) return\n\n      const ti = types[ i ]\n      const tj = types[ j ]\n\n      const isWeak = isWeakHydrogenBond(ti, tj)\n      if (!isWeak && !isHydrogenBond(ti, tj)) return\n\n      const [ l, k ] = tj === FeatureType.HydrogenAcceptor ? [ i, j ] : [ j, i ]\n\n      donor.index = atomSets[ l ][ 0 ]\n      acceptor.index = atomSets[ k ][ 0 ]\n\n      if (acceptor.index === donor.index) return // DA to self\n\n      if (invalidAtomContact(donor, acceptor, masterIdx)) return\n      if (donor.number !== Elements.S && acceptor.number !== Elements.S && dSq > maxHbondDistSq) return\n      if (donor.connectedTo(acceptor)) return\n\n      const donorAngles = calcAngles(donor, acceptor)\n      const idealDonorAngle = Angles.get(idealGeometry[donor.index]) || degToRad(120)\n      if (donorAngles.some(donorAngle => {\n        return Math.abs(idealDonorAngle - donorAngle) > maxHbondDonAngle\n      })) return\n\n      if (idealGeometry[donor.index] === AtomGeometry.Trigonal){\n        const outOfPlane = calcPlaneAngle(donor, acceptor)\n        if (outOfPlane !== undefined && outOfPlane > maxHbondDonPlaneAngle) return\n      }\n\n      const acceptorAngles = calcAngles(acceptor, donor)\n      const idealAcceptorAngle = Angles.get(idealGeometry[acceptor.index]) || degToRad(120)\n      if (acceptorAngles.some(acceptorAngle => {\n        // Do not limit large acceptor angles\n        return idealAcceptorAngle - acceptorAngle > maxHbondAccAngle\n      })) return\n\n      if (idealGeometry[acceptor.index] === AtomGeometry.Trigonal){\n        const outOfPlane = calcPlaneAngle(acceptor, donor)\n        if (outOfPlane !== undefined && outOfPlane > maxHbondAccPlaneAngle) return\n      }\n\n      featureSet.setBits(l, k)\n      const bondType = isWeak ? ContactType.WeakHydrogenBond : getHydrogenBondType(donor, acceptor)\n      contactStore.addContact(l, k, bondType)\n    })\n  }\n}\n","/**\n * @file Metal Binding\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\n// import { valenceModel } from '../../structure/data'\nimport { Elements, AA3, Bases } from '../../structure/structure-constants'\n// import { hasAromaticNeighbour } from '../functional-groups'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\nconst IonicTypeMetals = [\n  Elements.LI, Elements.NA, Elements.K, Elements.RB, Elements.CS,\n  Elements.MG, Elements.CA, Elements.SR, Elements.BA, Elements.AL,\n  Elements.GA, Elements.IN, Elements.TL, Elements.SC, Elements.SN,\n  Elements.PB, Elements.BI, Elements.SB, Elements.HG\n]\n\n/**\n * Metal binding partners (dative bond or ionic-type interaction)\n */\nexport function addMetalBinding (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    let dative = false\n    let ionic = false\n\n    const isStandardAminoacid = AA3.includes(a.resname)\n    const isStandardBase = Bases.includes(a.resname)\n\n    if (!isStandardAminoacid && !isStandardBase) {\n      if (a.isHalogen() || a.number === Elements.O || a.number === Elements.S) {\n        dative = true\n        ionic = true\n      } else if (a.number === Elements.N) {\n        dative = true\n      }\n    } else if (isStandardAminoacid){\n      // main chain oxygen atom or oxygen, nitrogen and sulfur from specific amino acids\n      if (a.number === Elements.O) {\n        if(['ASP', 'GLU', 'SER', 'THR', 'TYR', 'ASN', 'GLN'].includes(a.resname) && a.isSidechain()) {\n          dative = true\n          ionic = true\n        } else if (a.isBackbone()) {\n          dative = true\n          ionic = true\n        }\n      } else if (a.number === Elements.S && 'CYS' === a.resname) {\n        dative = true\n        ionic = true\n      } else if (a.number === Elements.N) {\n        if(a.resname === 'HIS' && a.isSidechain()) {\n          dative = true\n        }\n      }\n    } else if (isStandardBase){\n      // http://pubs.acs.org/doi/pdf/10.1021/acs.accounts.6b00253\n      // http://onlinelibrary.wiley.com/doi/10.1002/anie.200900399/full\n      if (a.number === Elements.O && a.isBackbone()) {\n        dative = true\n        ionic = true\n      } else if(['N3', 'N4', 'N7'].includes(a.atomname)) {\n        dative = true\n      } else if(['O2', 'O4', 'O6'].includes(a.atomname)) {\n        dative = true\n        ionic = true\n      }\n    }\n    if (dative) {\n      const state = createFeatureState(FeatureType.DativeBondPartner)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n    if (ionic) {\n      const state = createFeatureState(FeatureType.IonicTypePartner)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\n/**\n * Metal Pi complexation partner\n */\n// export function addMetalPiPartners (structure: Structure, features: Features) {\n//   const { charge } = valenceModel(structure.data)\n\n//   structure.eachAtom(a => {\n//     const state = createFeatureState(FeatureType.MetalPiPartner)\n\n//     const resname = a.resname\n//     const element = a.element\n//     const atomname = a.atomname\n//     if (!a.isPolymer()) {\n//       // water oxygen, as well as oxygen from carboxylate, phosphoryl, phenolate, alcohol;\n//       // nitrogen from imidazole; sulfur from thiolate\n//       if (element === 'O') {\n//         // Water oxygen\n//         if (a.bondCount === 0 || a.isWater()) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Oxygen in alcohol (R-[O]-H)\n//         if (a.bondCount === 2 && charge[ a.index ] || a.hasBondToElement('H')) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Phenolate oxygen\n//         if (hasAromaticNeighbour(a) && !a.aromatic) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Carboxylic acid oxygen\n//         if (a.bondToElementCount('C') === 1) {\n//           let flag = false\n//           a.eachBondedAtom(ba => {\n//             if (ba.element === 'C' && ba.bondToElementCount('O') === 2 && ba.bondToElementCount('C') === 1) {\n//               flag = true\n//             }\n//           })\n//           if (flag) {\n//             addAtom(state, a)\n//             addFeature(features, state)\n//             return\n//           }\n//         }\n//         // Phosphoryl oxygen\n//         if (a.bondToElementCount('P') === 1) {\n//           let flag = false\n//           a.eachBondedAtom(ba => {\n//             if (ba.element === 'P' && ba.bondToElementCount('O') >= 3) {\n//               flag = true\n//             }\n//           })\n//           if (flag) {\n//             addAtom(state, a)\n//             addFeature(features, state)\n//             return\n//           }\n//         }\n//       } else if (element === 'N') {\n//         // Imidazole/pyrrole or similar\n//         if (a.bondToElementCount('C') === 2) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//       } else if (element === 'S') {\n//         // Thiolate\n//         if (hasAromaticNeighbour(a) && !a.aromatic) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//         // Sulfur in Iron sulfur cluster\n//         const ironCount = a.bondToElementCount('FE')\n//         if (ironCount > 0 && ironCount === a.bondCount) {\n//           addAtom(state, a)\n//           addFeature(features, state)\n//           return\n//         }\n//       }\n//     }\n//   })\n// }\n\nexport function addMetals (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    if (a.isTransitionMetal() || a.number === Elements.ZN || a.number === Elements.CD) {\n      const state = createFeatureState(FeatureType.TransitionMetal)\n      addAtom(state, a)\n      addFeature(features, state)\n    } else if (IonicTypeMetals.includes(a.number)) {\n      const state = createFeatureState(FeatureType.IonicTypeMetal)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nfunction isMetalComplex (ti: FeatureType, tj: FeatureType) {\n  if (ti === FeatureType.TransitionMetal) {\n    return (\n      tj === FeatureType.DativeBondPartner ||\n      tj === FeatureType.TransitionMetal\n    )\n  } else if (ti === FeatureType.IonicTypeMetal) {\n    return (\n      tj === FeatureType.IonicTypePartner\n    )\n  }\n}\n\nexport interface MetalComplexationParams {\n  maxMetalDist?: number\n  masterModelIndex?: number\n}\n\n/**\n * Metal complexes of metals and appropriate groups in protein and ligand, including water\n */\nexport function addMetalComplexation (structure: Structure, contacts: Contacts, params: MetalComplexationParams = {}) {\n  const maxMetalDist = defaults(params.maxMetalDist, ContactDefaultParams.maxMetalDist)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxMetalDist, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n\n      const m1 = ap1.isMetal()\n      const m2 = ap2.isMetal()\n      if (!m1 && !m2) return\n\n      const [ ti, tj ] = m1 ? [ types[ i ],types[ j ] ] : [ types[ j ],types[ i ] ]\n\n      if (isMetalComplex(ti, tj)) {\n        featureSet.setBits(i, j)\n        contactStore.addContact(i, j, ContactType.MetalCoordination)\n      }\n    })\n  }\n}\n","/**\n * @file Halogen Bonds\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n */\n\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\nimport { Elements } from '../../structure/structure-constants'\nimport { degToRad } from '../../math/math-utils'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\nimport { calcAngles } from '../geometry'\n\nconst halBondElements = [17, 35, 53, 85]\n\n/**\n * Halogen bond donors (X-C, with X one of Cl, Br, I or At) not F!\n */\nexport function addHalogenDonors (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    if (halBondElements.includes(a.number) && a.bondToElementCount(Elements.C) === 1) {\n      const state = createFeatureState(FeatureType.HalogenDonor)\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nconst X = [ Elements.N, Elements.O, Elements.S ]\nconst Y = [ Elements.C, Elements.N, Elements.P, Elements.S ]\n\n/**\n * Halogen bond acceptors (Y-{O|N|S}, with Y=C,P,N,S)\n */\nexport function addHalogenAcceptors (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    if (X.includes(a.number)) {\n      let flag = false\n      a.eachBondedAtom(ba => {\n        if (Y.includes(ba.number)) {\n          flag = true\n        }\n      })\n      if (flag) {\n        const state = createFeatureState(FeatureType.HalogenAcceptor)\n        addAtom(state, a)\n        addFeature(features, state)\n      }\n    }\n  })\n}\n\nfunction isHalogenBond (ti: FeatureType, tj: FeatureType) {\n  return (\n    (ti === FeatureType.HalogenAcceptor && tj === FeatureType.HalogenDonor) ||\n    (ti === FeatureType.HalogenDonor && tj === FeatureType.HalogenAcceptor)\n  )\n}\n\nexport interface HalogenBondsParams {\n  maxHalogenBondDist?: number\n  maxHalogenBondAngle?: number\n  masterModelIndex?: number\n}\n\n// http://www.pnas.org/content/101/48/16789.full\nconst OptimalHalogenAngle = degToRad(180)  // adjusted from 165 to account for spherical statistics\nconst OptimalAcceptorAngle = degToRad(120)\n\n/**\n * All pairs of halogen donor and acceptor atoms\n */\nexport function addHalogenBonds (structure: Structure, contacts: Contacts, params: HalogenBondsParams = {}) {\n  const maxHalogenBondDist = defaults(params.maxHalogenBondDist, ContactDefaultParams.maxHalogenBondDist)\n  const maxHalogenBondAngle = degToRad(defaults(params.maxHalogenBondAngle, ContactDefaultParams.maxHalogenBondAngle))\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxHalogenBondDist, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n      if (!isHalogenBond(types[ i ], types[ j ])) return\n\n      const [ halogen, acceptor ] = types[ i ] === FeatureType.HalogenDonor ? [ ap1, ap2 ] : [ ap2, ap1 ]\n\n      const halogenAngles = calcAngles(halogen, acceptor)\n      // Singly bonded halogen only (not bromide ion for example)\n      if (halogenAngles.length !== 1) return\n      if (OptimalHalogenAngle - halogenAngles[0] > maxHalogenBondAngle) return\n\n      const acceptorAngles = calcAngles(acceptor, halogen)\n      // Angle must be defined. Excludes water as acceptor. Debatable\n      if (acceptorAngles.length === 0) return\n      if (acceptorAngles.some(acceptorAngle => {\n        return (OptimalAcceptorAngle - acceptorAngle > maxHalogenBondAngle)\n      })) return\n\n\n      featureSet.setBits(i, j)\n      contactStore.addContact(i, j, ContactType.HalogenBond)\n\n    })\n  }\n}\n","/**\n * @file Refine Contacts\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { Debug, Log } from '../../globals'\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\nimport AtomProxy from '../../proxy/atom-proxy'\nimport { Elements } from '../../structure/structure-constants'\nimport { FrozenContacts, ContactType, ContactDefaultParams, isMasterContact } from './contact'\nimport { FeatureType } from './features'\n\nexport interface LineOfSightParams {\n  lineOfSightDistFactor?: number\n  masterModelIndex?: number\n}\n\n// also allows intra-residue contacts\nexport function invalidAtomContact (ap1: AtomProxy, ap2: AtomProxy, masterIdx: number) {\n  return !isMasterContact(ap1, ap2, masterIdx) && (\n    ap1.modelIndex !== ap2.modelIndex ||\n    (ap1.altloc && ap2.altloc && ap1.altloc !== ap2.altloc)\n  )\n}\n\nexport function refineLineOfSight (structure: Structure, contacts: FrozenContacts, params: LineOfSightParams = {}) {\n  if (Debug) Log.time('refineLineOfSight')\n\n  const lineOfSightDistFactor = defaults(params.lineOfSightDistFactor, ContactDefaultParams.lineOfSightDistFactor)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const spatialHash = structure.spatialHash!\n  const { contactSet, contactStore, features } = contacts\n  const { index1, index2 } = contactStore\n  const { centers, atomSets } = features\n  const { x, y, z } = centers\n\n  const ac1 = structure.getAtomProxy()\n  const ac2 = structure.getAtomProxy()\n  const aw = structure.getAtomProxy()\n\n  const c1 = new Vector3()\n  const c2 = new Vector3()\n\n  const lineOfSightDist = 3 * lineOfSightDistFactor\n  const lineOfSightDistFactorSq = lineOfSightDistFactor * lineOfSightDistFactor\n\n  contactSet.forEach(i => {\n    c1.set(x[index1[i]], y[index1[i]], z[index1[i]])\n    c2.set(x[index2[i]], y[index2[i]], z[index2[i]])\n\n    const cx = ( c1.x + c2.x ) / 2\n    const cy = ( c1.y + c2.y ) / 2\n    const cz = ( c1.z + c2.z ) / 2\n\n    const as1 = atomSets[ index1[ i ] ]\n    const as2 = atomSets[ index2[ i ] ]\n\n    ac1.index = as1[ 0 ]\n    ac2.index = as2[ 0 ]\n\n    spatialHash.eachWithin(cx, cy, cz, lineOfSightDist, (j, dSq) => {\n      aw.index = j\n      if (\n        aw.number !== Elements.H &&\n        (aw.vdw * aw.vdw * lineOfSightDistFactorSq) > dSq &&\n        !invalidAtomContact(ac1, aw, masterIdx) &&\n        !invalidAtomContact(ac2, aw, masterIdx) &&\n        !as1.includes(j) &&\n        !as2.includes(j) &&\n        // to ignore atoms in the center of functional groups\n        c1.distanceToSquared(aw as any) > 1 &&\n        c2.distanceToSquared(aw as any) > 1\n      ) {\n        contactSet.clear(i)\n        if (Debug) Log.log('removing', ac1.qualifiedName(), ac2.qualifiedName(), 'because', aw.qualifiedName())\n      }\n    })\n  })\n\n  if (Debug) Log.timeEnd('refineLineOfSight')\n}\n\n/**\n * For atoms interacting with several atoms in the same residue\n * only the one with the closest distance is kept.\n */\nexport function refineHydrophobicContacts (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  const residueContactDict: { [k: string]: number[] } = {}\n\n  /* keep only closest contact between residues */\n  const handleResidueContact = function (dist: number, i: number, key: string) {\n    const [ minDist, minIndex ] = residueContactDict[ key ] || [ Infinity, -1 ]\n    if (dist < minDist) {\n      if (minIndex !== -1) contactSet.clear(minIndex)\n      residueContactDict[ key ] = [ dist, i ]\n    } else {\n      contactSet.clear(i)\n    }\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.Hydrophobic) return\n\n    ap1.index = atomSets[ index1[ i ] ][ 0 ]\n    ap2.index = atomSets[ index2[ i ] ][ 0 ]\n\n    const dist = ap1.distanceTo(ap2)\n    handleResidueContact(dist, i, `${ap1.index}|${ap2.residueIndex}`)\n    handleResidueContact(dist, i, `${ap2.index}|${ap1.residueIndex}`)\n  })\n}\n\nfunction isHydrogenBondType (type: number) {\n  return (\n    type === ContactType.HydrogenBond ||\n    type === ContactType.WaterHydrogenBond ||\n    type === ContactType.BackboneHydrogenBond\n  )\n}\n\n/**\n * Remove weak hydrogen bonds when the acceptor is involved in\n * a normal/strong hydrogen bond\n */\nexport function refineWeakHydrogenBonds (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features, adjacencyList } = contacts\n  const { type, index1, index2 } = contactStore\n  const { types } = features\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.WeakHydrogenBond) return\n\n    let accFeat: number\n    if (types[ index1[ i ] ] === FeatureType.WeakHydrogenDonor) {\n      accFeat = index2[ i ]\n    } else {\n      accFeat = index1[ i ]\n    }\n\n    const n = adjacencyList.countArray[ accFeat ]\n    const offset = adjacencyList.offsetArray[ accFeat ]\n    for (let j = 0; j < n; ++j) {\n      const ci = adjacencyList.indexArray[ offset + j ]\n      if (isHydrogenBondType(type[ ci ])) {\n        contactSet.clear(i)\n        return\n      }\n    }\n  })\n}\n\n/**\n * Remove hydrogen bonds between groups that also form\n * a salt bridge between each other\n */\nexport function refineSaltBridges (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const ionicInteractionDict: { [atomIndex: number]: number[] } = {}\n\n  const add = function(idx: number, i: number) {\n    if (!ionicInteractionDict[ idx ]) ionicInteractionDict[ idx ] = []\n    ionicInteractionDict[ idx ].push(i)\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.IonicInteraction) return\n    atomSets[ index1[ i ] ].forEach(idx => add(idx, i))\n    atomSets[ index2[ i ] ].forEach(idx => add(idx, i))\n  })\n\n  contactSet.forEach(i => {\n    if (!isHydrogenBondType(type[ i ])) return\n\n    const iil1 = ionicInteractionDict[ atomSets[ index1[ i ] ][ 0 ] ]\n    const iil2 = ionicInteractionDict[ atomSets[ index2[ i ] ][ 0 ] ]\n    if (!iil1 || !iil2) return\n\n    const n = iil1.length\n    for (let j = 0; j < n; ++j) {\n      if (iil2.includes(iil1[j])) {\n        contactSet.clear(i)\n        return\n      }\n    }\n  })\n}\n\n/**\n * Remove hydrophobic and cation-pi interactions between groups that also form\n * a pi-stacking interaction between each other\n */\nexport function refinePiStacking (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const piStackingDict: { [atomIndex: number]: number[] } = {}\n\n  const add = function(idx: number, i: number) {\n    if (!piStackingDict[ idx ]) piStackingDict[ idx ] = []\n    piStackingDict[ idx ].push(i)\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.PiStacking) return\n    atomSets[ index1[ i ] ].forEach(idx => add(idx, i))\n    atomSets[ index2[ i ] ].forEach(idx => add(idx, i))\n  })\n\n  contactSet.forEach(i => {\n    if (\n      type[ i ] !== ContactType.Hydrophobic &&\n      type[ i ] !== ContactType.CationPi\n    ) return\n\n    const pil1 = piStackingDict[ atomSets[ index1[ i ] ][ 0 ] ]\n    const pil2 = piStackingDict[ atomSets[ index2[ i ] ][ 0 ] ]\n    if (!pil1 || !pil2) return\n\n    const n = pil1.length\n    for (let j = 0; j < n; ++j) {\n      if (pil2.includes(pil1[j])) {\n        contactSet.clear(i)\n        return\n      }\n    }\n  })\n}\n\n/**\n * Remove ionic interactions between groups that also form\n * a metal coordination between each other\n */\nexport function refineMetalCoordination (structure: Structure, contacts: FrozenContacts) {\n  const { contactSet, contactStore, features } = contacts\n  const { type, index1, index2 } = contactStore\n  const { atomSets } = features\n\n  const ionicInteractionDict: { [atomIndex: number]: number[] } = {}\n\n  const add = function(idx: number, i: number) {\n    if (!ionicInteractionDict[ idx ]) ionicInteractionDict[ idx ] = []\n    ionicInteractionDict[ idx ].push(i)\n  }\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.IonicInteraction) return\n    atomSets[ index1[ i ] ].forEach(idx => add(idx, i))\n    atomSets[ index2[ i ] ].forEach(idx => add(idx, i))\n  })\n\n  contactSet.forEach(i => {\n    if (type[ i ] !== ContactType.MetalCoordination) return\n\n    const iil1 = ionicInteractionDict[ atomSets[ index1[ i ] ][ 0 ] ]\n    const iil2 = ionicInteractionDict[ atomSets[ index2[ i ] ][ 0 ] ]\n    if (!iil1 || !iil2) return\n\n    const n = iil1.length\n    for (let j = 0; j < n; ++j) {\n      if (iil2.includes(iil1[j])) {\n        contactSet.clear(iil1[j])\n        return\n      }\n    }\n  })\n}\n\n// TODO: refactor refineSaltBridges, refinePiStacking and refineMetalCoordination to be DRY\n","/**\n * @file Contact\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { Color } from 'three'\n\nimport { Debug, Log } from '../../globals'\nimport { createParams } from '../../utils'\nimport { TextBufferData } from '../../buffer/text-buffer'\nimport Structure from '../../structure/structure'\nimport AtomProxy from '../../proxy/atom-proxy'\nimport SpatialHash from '../../geometry/spatial-hash'\nimport { calculateCenterArray, calculateDirectionArray, uniformArray } from '../../math/array-utils'\nimport ContactStore from '../../store/contact-store'\nimport BitArray from '../../utils/bitarray'\nimport Selection from '../../selection/selection'\nimport { ContactPicker } from '../../utils/picker'\nimport { createAdjacencyList, AdjacencyList } from '../../utils/adjacency-list'\nimport { createFeatures, Features } from './features'\nimport { addAromaticRings, addNegativeCharges, addPositiveCharges, addChargedContacts } from './charged'\nimport { addHydrogenAcceptors, addHydrogenDonors, addHydrogenBonds, addWeakHydrogenDonors } from './hydrogen-bonds'\nimport { addMetalBinding, addMetals, addMetalComplexation } from './metal-binding'\nimport { addHydrophobic, addHydrophobicContacts } from './hydrophobic'\nimport { addHalogenAcceptors, addHalogenDonors, addHalogenBonds } from './halogen-bonds'\nimport {\n  refineLineOfSight,\n  refineHydrophobicContacts, refineSaltBridges, refinePiStacking, refineMetalCoordination\n} from './refine-contacts'\n\nexport interface Contacts {\n  features: Features\n  spatialHash: SpatialHash\n  contactStore: ContactStore\n  featureSet: BitArray\n}\n\nexport interface FrozenContacts extends Contacts {\n  contactSet: BitArray\n  adjacencyList: AdjacencyList\n}\n\nexport const enum ContactType {\n  Unknown = 0,\n  IonicInteraction = 1,\n  CationPi = 2,\n  PiStacking = 3,\n  HydrogenBond = 4,\n  HalogenBond = 5,\n  Hydrophobic = 6,\n  MetalCoordination = 7,\n  WeakHydrogenBond = 8,\n  WaterHydrogenBond = 9,\n  BackboneHydrogenBond = 10\n}\n\nexport const ContactDefaultParams = {\n  maxHydrophobicDist: 4.0,\n  maxHbondDist: 3.5,\n  maxHbondSulfurDist: 4.1,\n  maxHbondAccAngle: 45,\n  maxHbondDonAngle: 45,\n  maxHbondAccPlaneAngle: 90,\n  maxHbondDonPlaneAngle: 30,\n  maxPiStackingDist: 5.5,\n  maxPiStackingOffset: 2.0,\n  maxPiStackingAngle: 30,\n  maxCationPiDist: 6.0,\n  maxCationPiOffset: 2.0,\n  maxIonicDist: 5.0,\n  maxHalogenBondDist: 4.0,\n  maxHalogenBondAngle: 30,\n  maxMetalDist: 3.0,\n  refineSaltBridges: true,\n  masterModelIndex: -1,\n  lineOfSightDistFactor: 1.0\n}\n\nexport function isMasterContact (ap1: AtomProxy, ap2: AtomProxy, masterIdx: number) {\n  return (\n    (ap1.modelIndex === masterIdx && ap2.modelIndex !== masterIdx) ||\n    (ap2.modelIndex === masterIdx && ap1.modelIndex !== masterIdx)\n  )\n}\n\nexport function invalidAtomContact (ap1: AtomProxy, ap2: AtomProxy, masterIdx: number) {\n  return !isMasterContact(ap1, ap2, masterIdx) && (\n    ap1.modelIndex !== ap2.modelIndex ||\n    ap1.residueIndex === ap2.residueIndex ||\n    (ap1.altloc && ap2.altloc && ap1.altloc !== ap2.altloc)\n  )\n}\n\nexport function createContacts (features: Features): Contacts {\n  const { types, centers } = features\n\n  const spatialHash = new SpatialHash(centers)\n  const contactStore = new ContactStore()\n  const featureSet = new BitArray(types.length, false)\n\n  return { features, spatialHash, contactStore, featureSet }\n}\n\nexport function createFrozenContacts (contacts: Contacts): FrozenContacts {\n  const { index1, index2, count } = contacts.contactStore\n\n  const adjacencyList = createAdjacencyList({\n    nodeArray1: index1,\n    nodeArray2: index2,\n    edgeCount: count,\n    nodeCount: contacts.featureSet.length\n  })\n  const contactSet = new BitArray(contacts.contactStore.count, true)\n\n  return Object.assign({ adjacencyList, contactSet }, contacts)\n}\n\nfunction calculateFeatures (structure: Structure) {\n  const features = createFeatures()\n\n  if (Debug) Log.time('calculateFeatures')\n\n  addPositiveCharges(structure, features)\n  addNegativeCharges(structure, features)\n  addAromaticRings(structure, features)\n\n  addHydrogenAcceptors(structure, features)\n  addHydrogenDonors(structure, features)\n  addWeakHydrogenDonors(structure, features)\n\n  addMetalBinding(structure, features)\n  addMetals(structure, features)\n\n  addHydrophobic(structure, features)\n\n  addHalogenAcceptors(structure, features)\n  addHalogenDonors(structure, features)\n\n  if (Debug) Log.timeEnd('calculateFeatures')\n\n  return features\n}\n\nexport function calculateContacts (structure: Structure, params = ContactDefaultParams) {\n  const features = calculateFeatures(structure)\n  const contacts = createContacts(features)\n\n  if (Debug) Log.time('calculateContacts')\n\n  addChargedContacts(structure, contacts, params)\n  addHydrogenBonds(structure, contacts, params)\n  addMetalComplexation(structure, contacts, params)\n  addHydrophobicContacts(structure, contacts, params)\n  addHalogenBonds(structure, contacts, params)\n\n  const frozenContacts = createFrozenContacts(contacts)\n\n  refineLineOfSight(structure, frozenContacts, params)\n  refineHydrophobicContacts(structure, frozenContacts)\n  if (params.refineSaltBridges) refineSaltBridges(structure, frozenContacts)\n  refinePiStacking(structure, frozenContacts)\n  refineMetalCoordination(structure, frozenContacts)\n\n  if (Debug) Log.timeEnd('calculateContacts')\n\n  return frozenContacts\n}\n\nexport function contactTypeName (type: ContactType) {\n  switch (type) {\n    case ContactType.HydrogenBond:\n    case ContactType.WaterHydrogenBond:\n    case ContactType.BackboneHydrogenBond:\n      return 'hydrogen bond'\n    case ContactType.Hydrophobic:\n      return 'hydrophobic contact'\n    case ContactType.HalogenBond:\n      return 'halogen bond'\n    case ContactType.IonicInteraction:\n      return 'ionic interaction'\n    case ContactType.MetalCoordination:\n      return 'metal coordination'\n    case ContactType.CationPi:\n      return 'cation-pi interaction'\n    case ContactType.PiStacking:\n      return 'pi-pi stacking'\n    case ContactType.WeakHydrogenBond:\n      return 'weak hydrogen bond'\n    default:\n      return 'unknown contact'\n  }\n}\n\nexport const ContactDataDefaultParams = {\n  hydrogenBond: true,\n  hydrophobic: true,\n  halogenBond: true,\n  ionicInteraction: true,\n  metalCoordination: true,\n  cationPi: true,\n  piStacking: true,\n  weakHydrogenBond: true,\n  waterHydrogenBond: true,\n  backboneHydrogenBond: true,\n  radius: 1,\n  filterSele: ''\n}\nexport type ContactDataParams = typeof ContactDataDefaultParams\n  | { filterSele: string|[string, string] }\n\nexport const ContactLabelDefaultParams = {\n  unit: '',\n  size: 2.0\n}\n\nexport type ContactLabelParams = typeof ContactLabelDefaultParams\n\nconst tmpColor = new Color()\nfunction contactColor (type: ContactType) {\n  switch (type) {\n    case ContactType.HydrogenBond:\n    case ContactType.WaterHydrogenBond:\n    case ContactType.BackboneHydrogenBond:\n      return tmpColor.setHex(0x2B83BA).toArray()\n    case ContactType.Hydrophobic:\n      return tmpColor.setHex(0x808080).toArray()\n    case ContactType.HalogenBond:\n      return tmpColor.setHex(0x40FFBF).toArray()\n    case ContactType.IonicInteraction:\n      return tmpColor.setHex(0xF0C814).toArray()\n    case ContactType.MetalCoordination:\n      return tmpColor.setHex(0x8C4099).toArray()\n    case ContactType.CationPi:\n      return tmpColor.setHex(0xFF8000).toArray()\n    case ContactType.PiStacking:\n      return tmpColor.setHex(0x8CB366).toArray()\n    case ContactType.WeakHydrogenBond:\n      return tmpColor.setHex(0xC5DDEC).toArray()\n    default:\n      return tmpColor.setHex(0xCCCCCC).toArray()\n  }\n}\n\nexport interface ContactData {\n  position1: Float32Array,\n  position2: Float32Array,\n  color: Float32Array,\n  color2: Float32Array,\n  radius: Float32Array,\n  picking: ContactPicker\n}\n\nexport function getContactData (contacts: FrozenContacts, structure: Structure, params: ContactDataParams): ContactData {\n  const p = createParams(params, ContactDataDefaultParams)\n  const types: ContactType[] = []\n  if (p.hydrogenBond) types.push(ContactType.HydrogenBond)\n  if (p.hydrophobic) types.push(ContactType.Hydrophobic)\n  if (p.halogenBond) types.push(ContactType.HalogenBond)\n  if (p.ionicInteraction) types.push(ContactType.IonicInteraction)\n  if (p.metalCoordination) types.push(ContactType.MetalCoordination)\n  if (p.cationPi) types.push(ContactType.CationPi)\n  if (p.piStacking) types.push(ContactType.PiStacking)\n  if (p.weakHydrogenBond) types.push(ContactType.WeakHydrogenBond)\n  if (p.waterHydrogenBond) types.push(ContactType.WaterHydrogenBond)\n  if (p.backboneHydrogenBond) types.push(ContactType.BackboneHydrogenBond)\n\n  const { features, contactSet, contactStore } = contacts\n  const { centers, atomSets } = features\n  const { x, y, z } = centers\n  const { index1, index2, type } = contactStore\n\n  const position1: number[] = []\n  const position2: number[] = []\n  const color: number[] = []\n  const radius: number[] = []\n  const picking: number[] = []\n\n  let filterSet: BitArray | BitArray[] | undefined\n  if (p.filterSele) {\n    if (Array.isArray(p.filterSele)) {\n      filterSet = p.filterSele.map(sele => {\n        return structure.getAtomSet(new Selection(sele))\n      })\n    } else {\n      filterSet = structure.getAtomSet(new Selection(p.filterSele))\n    }\n  }\n\n  contactSet.forEach(i => {\n    const ti = type[ i ]\n    if (!types.includes(ti)) return\n\n    if (filterSet) {\n      const idx1 = atomSets[index1[i]][0]\n      const idx2 = atomSets[index2[i]][0]\n\n      if (Array.isArray(filterSet)) {\n        if (!(filterSet[0].isSet(idx1) && filterSet[1].isSet(idx2) || (filterSet[1].isSet(idx1) && filterSet[0].isSet(idx2)))) return\n      } else {\n        if (!filterSet.isSet(idx1) && !filterSet.isSet(idx2)) return\n      }\n    }\n\n    const k = index1[i]\n    const l = index2[i]\n    position1.push(x[k], y[k], z[k])\n    position2.push(x[l], y[l], z[l])\n    color.push(...contactColor(ti))\n    radius.push(p.radius)\n    picking.push(i)\n  })\n\n  return {\n    position1: new Float32Array(position1),\n    position2: new Float32Array(position2),\n    color: new Float32Array(color),\n    color2: new Float32Array(color),\n    radius: new Float32Array(radius),\n    picking: new ContactPicker(picking, contacts, structure)\n  }\n}\n\nexport function getLabelData (contactData: ContactData, params: ContactLabelParams): TextBufferData {\n\n  const position = calculateCenterArray(contactData.position1, contactData.position2)\n  const text: string[] = []\n\n  const direction = calculateDirectionArray(contactData.position1, contactData.position2)\n\n  const n = direction.length / 3\n  for (let i=0; i<n; i++) {\n    const j = 3 * i\n    const d = Math.sqrt(direction[j]**2 + direction[j+1]**2 + direction[j+2]**2)\n    switch (params.unit) {\n        case 'angstrom':\n          text[ i ] = d.toFixed(2) + ' ' + String.fromCharCode(0x212B)\n          break\n        case 'nm':\n          text[ i ] = (d / 10).toFixed(2) + ' nm'\n          break\n        default:\n          text[ i ] = d.toFixed(2)\n          break\n      }\n  }\n  return {\n    position,\n    size: uniformArray(position.length / 3, params.size),\n    color: contactData.color,\n    text\n  }\n}\n","/**\n * @file Hydrophobic\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { defaults } from '../../utils'\nimport Structure from '../../structure/structure'\nimport { Elements } from '../../structure/structure-constants'\nimport {\n  Features, FeatureType,\n  addAtom, addFeature, createFeatureState,\n} from './features'\nimport { Contacts, ContactType, ContactDefaultParams, invalidAtomContact } from './contact'\n\n/**\n * Hydrophobic carbon (only bonded to carbon or hydrogen); fluorine\n */\nexport function addHydrophobic (structure: Structure, features: Features) {\n  structure.eachAtom(a => {\n    const state = createFeatureState(FeatureType.Hydrophobic)\n    let flag = false\n    if (a.number === Elements.C) {\n      flag = true\n      a.eachBondedAtom(ap => {\n        const an = ap.number\n        if (an !== Elements.C && an !== Elements.H) flag = false\n      })\n    } else if (a.number === Elements.F) {\n      flag = true\n    }\n    if (flag) {\n      addAtom(state, a)\n      addFeature(features, state)\n    }\n  })\n}\n\nfunction isHydrophobicContact (ti: FeatureType, tj: FeatureType) {\n  return ti === FeatureType.Hydrophobic && tj === FeatureType.Hydrophobic\n}\n\nexport interface HydrophobicContactsParams {\n  maxHydrophobicDist?: number\n  masterModelIndex?: number\n}\n\n/**\n * All hydrophobic contacts\n */\nexport function addHydrophobicContacts (structure: Structure, contacts: Contacts, params: HydrophobicContactsParams = {}) {\n  const maxHydrophobicDist = defaults(params.maxHydrophobicDist, ContactDefaultParams.maxHydrophobicDist)\n  const masterIdx = defaults(params.masterModelIndex, ContactDefaultParams.masterModelIndex)\n\n  const { features, spatialHash, contactStore, featureSet } = contacts\n  const { types, centers, atomSets } = features\n  const { x, y, z } = centers\n  const n = types.length\n\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  for (let i = 0; i < n; ++i) {\n    spatialHash.eachWithin(x[i], y[i], z[i], maxHydrophobicDist, (j, dSq) => {\n      if (j <= i) return\n\n      ap1.index = atomSets[ i ][ 0 ]\n      ap2.index = atomSets[ j ][ 0 ]\n\n      if (invalidAtomContact(ap1, ap2, masterIdx)) return\n      if (ap1.number === Elements.F && ap2.number === Elements.F) return\n      if (ap1.connectedTo(ap2)) return\n\n      if (isHydrophobicContact(types[ i ], types[ j ])) {\n        featureSet.setBits(i, j)\n        contactStore.addContact(i, j, ContactType.Hydrophobic)\n      }\n    })\n  }\n}\n","/**\n * @file Picker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { PickerRegistry } from '../globals'\nimport { calculateMeanVector3 } from '../math/vector-utils'\nimport Selection from '../selection/selection'\nimport {\n  ArrowPrimitive, BoxPrimitive, ConePrimitive, CylinderPrimitive,\n  EllipsoidPrimitive, OctahedronPrimitive, SpherePrimitive,\n  TetrahedronPrimitive, TorusPrimitive, PointPrimitive, WidelinePrimitive\n} from '../geometry/primitive'\nimport { contactTypeName, Contacts } from '../chemistry/interactions/contact'\nimport { TypedArray } from '../types';\nimport Component from '../component/component';\nimport { Shape, Structure, Volume } from '../ngl';\nimport BondStore from '../store/bond-store';\nimport Validation from '../structure/validation';\nimport PrincipalAxes from '../math/principal-axes';\nimport Surface from '../surface/surface';\nimport Unitcell from '../symmetry/unitcell';\nimport BondProxy from '../proxy/bond-proxy';\nimport AtomProxy from '../proxy/atom-proxy';\n\n/**\n * Picker class\n * @interface\n */\nclass Picker {\n  array: number[]|TypedArray|undefined\n  /**\n   * @param  {Array|TypedArray} [array] - mapping\n   */\n  constructor (array?: number[]|TypedArray) {\n    this.array = array\n  }\n\n  get type () { return '' }\n  get data () { return {} }\n\n  /**\n   * Get the index for the given picking id\n   * @param  {Integer} pid - the picking id\n   * @return {Integer} the index\n   */\n  getIndex (pid: number) {\n    return this.array ? this.array[ pid ] : pid\n  }\n\n  /**\n   * Get object data\n   * @abstract\n   * @param  {Integer} pid - the picking id\n   * @return {Object} the object data\n   */\n  getObject (pid: number) {\n    return {}\n  }\n\n  _applyTransformations (vector: Vector3, instance: any, component: Component) {\n    if (instance) {\n      vector.applyMatrix4(instance.matrix)\n    }\n    if (component) {\n      vector.applyMatrix4(component.matrix)\n    }\n    return vector\n  }\n\n  /**\n   * Get object position\n   * @abstract\n   * @param  {Integer} pid - the picking id\n   * @return {Vector3} the object position\n   */\n  _getPosition (pid: number) {\n    return new Vector3()\n  }\n\n  /**\n   * Get position for the given picking id\n   * @param  {Integer} pid - the picking id\n   * @param  {Object} instance - the instance that should be applied\n   * @param  {Component} component - the component of the picked object\n   * @return {Vector3} the position\n   */\n  getPosition (pid: number, instance: any, component: Component) {\n    return this._applyTransformations(\n      this._getPosition(pid), instance, component\n    )\n  }\n}\n\n/**\n * Shape picker class\n * @interface\n */\nclass ShapePicker extends Picker {\n  shape: Shape\n  /**\n   * @param  {Shape} shape - shape object\n   */\n  constructor (shape: Shape) {\n    super()\n    this.shape = shape\n  }\n\n  get primitive (): any { return }\n\n  get data () { return this.shape }\n  get type () { return this.primitive.type }\n\n  getObject (pid: number) {\n    return this.primitive.objectFromShape(this.shape, this.getIndex(pid))\n  }\n\n  _getPosition (pid: number) {\n    return this.primitive.positionFromShape(this.shape, this.getIndex(pid))\n  }\n}\n\n//\n\nclass CylinderPicker extends ShapePicker {\n  get primitive () { return CylinderPrimitive }\n}\n\nclass ArrowPicker extends ShapePicker {\n  get primitive () { return ArrowPrimitive }\n}\n\nclass AtomPicker extends Picker {\n  structure: Structure\n  constructor (array: Float32Array, structure: Structure) {\n    super(array)\n    this.structure = structure\n  }\n\n  get type () { return 'atom' }\n  get data () { return this.structure }\n\n  getObject (pid: number): AtomProxy {\n    return this.structure.getAtomProxy(this.getIndex(pid))\n  }\n\n  _getPosition (pid: number) {\n    return new Vector3().copy(this.getObject(pid) as any)\n  }\n}\n\nclass AxesPicker extends Picker {\n  axes: PrincipalAxes\n  constructor (axes: PrincipalAxes) {\n    super()\n    this.axes = axes\n  }\n\n  get type () { return 'axes' }\n  get data () { return this.axes }\n\n  getObject (/* pid */) {\n    return {\n      axes: this.axes\n    }\n  }\n\n  _getPosition (/* pid */) {\n    return this.axes.center.clone()\n  }\n}\n\nclass BondPicker extends Picker {\n  structure: Structure\n  bondStore: BondStore\n  constructor (array: number[]|TypedArray|undefined, structure: Structure, bondStore?: BondStore) {\n    super(array)\n    this.structure = structure\n    this.bondStore = bondStore || structure.bondStore\n  }\n\n  get type () { return 'bond' }\n  get data () { return this.structure }\n\n  getObject (pid: number): BondProxy {\n    const bp = this.structure.getBondProxy(this.getIndex(pid))\n    bp.bondStore = this.bondStore\n    return bp\n  }\n\n  _getPosition (pid: number) {\n    const b = this.getObject(pid)\n    return new Vector3()\n      .copy(b.atom1 as any)\n      .add(b.atom2 as any)\n      .multiplyScalar(0.5)\n  }\n}\n\nclass ContactPicker extends Picker {\n  contacts: Contacts\n  structure: Structure\n  constructor (array: number[]|TypedArray|undefined, contacts: Contacts, structure: Structure) {\n    super(array)\n    this.contacts = contacts\n    this.structure = structure\n  }\n\n  get type () { return 'contact' }\n  get data () { return this.contacts }\n\n  getObject (pid: number) {\n    const idx = this.getIndex(pid)\n    const { features, contactStore } = this.contacts\n    const { centers, atomSets } = features\n    const { x, y, z } = centers\n    const { index1, index2, type } = contactStore\n    const k = index1[idx]\n    const l = index2[idx]\n    return {\n      center1: new Vector3(x[k], y[k], z[k]),\n      center2: new Vector3(x[l], y[l], z[l]),\n      atom1: this.structure.getAtomProxy(atomSets[k][0]),\n      atom2: this.structure.getAtomProxy(atomSets[l][0]),\n      type: contactTypeName(type[idx])\n    }\n  }\n\n  _getPosition (pid: number) {\n    const { center1, center2 } = this.getObject(pid)\n    return new Vector3().addVectors(center1, center2).multiplyScalar(0.5)\n  }\n}\n\nclass ConePicker extends ShapePicker {\n  get primitive () { return ConePrimitive }\n}\n\nclass ClashPicker extends Picker {\n  validation: Validation\n  structure: Structure\n  constructor (array: number[]|TypedArray|undefined, validation: Validation, structure: Structure) {\n    super(array)\n    this.validation = validation\n    this.structure = structure\n  }\n\n  get type () { return 'clash' }\n  get data () { return this.validation }\n\n  getObject (pid: number) {\n    const val = this.validation\n    const idx = this.getIndex(pid)\n    return {\n      validation: val,\n      index: idx,\n      clash: val.clashArray[ idx ]\n    }\n  }\n\n  _getAtomProxyFromSele (sele: string) {\n    const selection = new Selection(sele)\n    const idx = this.structure.getAtomIndices(selection)![ 0 ]\n    return this.structure.getAtomProxy(idx)\n  }\n\n  _getPosition (pid: number) {\n    const clash = this.getObject(pid).clash\n    const ap1 = this._getAtomProxyFromSele(clash.sele1)\n    const ap2 = this._getAtomProxyFromSele(clash.sele2)\n    return new Vector3().copy(ap1 as any).add(ap2 as any).multiplyScalar(0.5)\n  }\n}\n\nclass DistancePicker extends BondPicker {\n  get type () { return 'distance' }\n}\n\nclass EllipsoidPicker extends ShapePicker {\n  get primitive () { return EllipsoidPrimitive }\n}\n\nclass OctahedronPicker extends ShapePicker {\n  get primitive () { return OctahedronPrimitive }\n}\n\nclass BoxPicker extends ShapePicker {\n  get primitive () { return BoxPrimitive }\n}\n\nclass IgnorePicker extends Picker {\n  get type () { return 'ignore' }\n}\n\nexport interface MeshData {\n  name: string|undefined\n  serial: number\n  index: Uint32Array|Uint16Array|number[]\n  normal?: Float32Array|number[]\n  position: Float32Array|number[]\n  color: Float32Array|number[]\n}\nclass MeshPicker extends ShapePicker {\n  mesh: MeshData\n  __position: Vector3\n\n  constructor (shape: Shape, mesh: MeshData) {\n    super(shape)\n    this.mesh = mesh\n  }\n\n  get type () { return 'mesh' }\n\n  getObject (/* pid */) {\n    const m = this.mesh\n    return {\n      shape: this.shape,\n      name: m.name,\n      serial: m.serial\n    }\n  }\n\n  _getPosition (/* pid */) {\n    if (!this.__position) {\n      this.__position = calculateMeanVector3(this.mesh.position as any)\n    }\n    return this.__position\n  }\n}\n\nclass SpherePicker extends ShapePicker {\n  get primitive () { return SpherePrimitive }\n}\n\nclass SurfacePicker extends Picker {\n  surface: Surface\n  constructor (array: number[]|TypedArray|undefined, surface: Surface) {\n    super(array)\n    this.surface = surface\n  }\n\n  get type () { return 'surface' }\n  get data () { return this.surface }\n\n  getObject (pid: number) {\n    return {\n      surface: this.surface,\n      index: this.getIndex(pid)\n    }\n  }\n\n  _getPosition (/* pid */) {\n    return this.surface.center.clone()\n  }\n}\n\nclass TetrahedronPicker extends ShapePicker {\n  get primitive () { return TetrahedronPrimitive }\n}\n\nclass TorusPicker extends ShapePicker {\n  get primitive () { return TorusPrimitive }\n}\n\nclass UnitcellPicker extends Picker {\n  unitcell: Unitcell\n  structure: Structure\n\n  constructor (unitcell: Unitcell, structure: Structure) {\n    super()\n    this.unitcell = unitcell\n    this.structure = structure\n  }\n\n  get type () { return 'unitcell' }\n  get data () { return this.unitcell }\n\n  getObject (/* pid */) {\n    return {\n      unitcell: this.unitcell,\n      structure: this.structure\n    }\n  }\n\n  _getPosition (/* pid */) {\n    return this.unitcell.getCenter(this.structure)\n  }\n}\n\nclass UnknownPicker extends Picker {\n  get type () { return 'unknown' }\n}\n\nclass VolumePicker extends Picker {\n  volume: Volume\n  constructor (array: TypedArray, volume: Volume) {\n    super(array)\n    this.volume = volume\n  }\n\n  get type () { return 'volume' }\n  get data () { return this.volume }\n\n  getObject (pid: number) {\n    const vol = this.volume\n    const idx = this.getIndex(pid)\n    return {\n      volume: vol,\n      index: idx,\n      value: vol.data[ idx ]\n    }\n  }\n\n  _getPosition (pid: number) {\n    const dp = this.volume.position\n    const idx = this.getIndex(pid)\n    return new Vector3(\n      dp[ idx * 3 ],\n      dp[ idx * 3 + 1 ],\n      dp[ idx * 3 + 2 ]\n    )\n  }\n}\n\nclass SlicePicker extends VolumePicker {\n  get type () { return 'slice' }\n}\n\nclass PointPicker extends ShapePicker {\n  get primitive () { return PointPrimitive }\n}\n\nclass WidelinePicker extends ShapePicker {\n  get primitive () { return WidelinePrimitive }\n}\n\nPickerRegistry.add('arrow', ArrowPicker)\nPickerRegistry.add('box', BoxPicker)\nPickerRegistry.add('cone', ConePicker)\nPickerRegistry.add('cylinder', CylinderPicker)\nPickerRegistry.add('ellipsoid', EllipsoidPicker)\nPickerRegistry.add('octahedron', OctahedronPicker)\nPickerRegistry.add('sphere', SpherePicker)\nPickerRegistry.add('tetrahedron', TetrahedronPicker)\nPickerRegistry.add('torus', TorusPicker)\nPickerRegistry.add('point', PointPicker)\nPickerRegistry.add('wideline', WidelinePicker)\n\nexport {\n  Picker,\n  ShapePicker,\n  ArrowPicker,\n  AtomPicker,\n  AxesPicker,\n  BondPicker,\n  BoxPicker,\n  ConePicker,\n  ContactPicker,\n  CylinderPicker,\n  ClashPicker,\n  DistancePicker,\n  EllipsoidPicker,\n  IgnorePicker,\n  OctahedronPicker,\n  MeshPicker,\n  SlicePicker,\n  SpherePicker,\n  SurfacePicker,\n  TetrahedronPicker,\n  TorusPicker,\n  UnitcellPicker,\n  UnknownPicker,\n  VolumePicker,\n  PointPicker,\n  WidelinePicker\n}\n","/**\n * @file Marching Cubes\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getUintArray } from '../utils'\n\nfunction getEdgeTable () {\n  return new Uint32Array([\n    0x0, 0x109, 0x203, 0x30a, 0x406, 0x50f, 0x605, 0x70c,\n    0x80c, 0x905, 0xa0f, 0xb06, 0xc0a, 0xd03, 0xe09, 0xf00,\n    0x190, 0x99, 0x393, 0x29a, 0x596, 0x49f, 0x795, 0x69c,\n    0x99c, 0x895, 0xb9f, 0xa96, 0xd9a, 0xc93, 0xf99, 0xe90,\n    0x230, 0x339, 0x33, 0x13a, 0x636, 0x73f, 0x435, 0x53c,\n    0xa3c, 0xb35, 0x83f, 0x936, 0xe3a, 0xf33, 0xc39, 0xd30,\n    0x3a0, 0x2a9, 0x1a3, 0xaa, 0x7a6, 0x6af, 0x5a5, 0x4ac,\n    0xbac, 0xaa5, 0x9af, 0x8a6, 0xfaa, 0xea3, 0xda9, 0xca0,\n    0x460, 0x569, 0x663, 0x76a, 0x66, 0x16f, 0x265, 0x36c,\n    0xc6c, 0xd65, 0xe6f, 0xf66, 0x86a, 0x963, 0xa69, 0xb60,\n    0x5f0, 0x4f9, 0x7f3, 0x6fa, 0x1f6, 0xff, 0x3f5, 0x2fc,\n    0xdfc, 0xcf5, 0xfff, 0xef6, 0x9fa, 0x8f3, 0xbf9, 0xaf0,\n    0x650, 0x759, 0x453, 0x55a, 0x256, 0x35f, 0x55, 0x15c,\n    0xe5c, 0xf55, 0xc5f, 0xd56, 0xa5a, 0xb53, 0x859, 0x950,\n    0x7c0, 0x6c9, 0x5c3, 0x4ca, 0x3c6, 0x2cf, 0x1c5, 0xcc,\n    0xfcc, 0xec5, 0xdcf, 0xcc6, 0xbca, 0xac3, 0x9c9, 0x8c0,\n    0x8c0, 0x9c9, 0xac3, 0xbca, 0xcc6, 0xdcf, 0xec5, 0xfcc,\n    0xcc, 0x1c5, 0x2cf, 0x3c6, 0x4ca, 0x5c3, 0x6c9, 0x7c0,\n    0x950, 0x859, 0xb53, 0xa5a, 0xd56, 0xc5f, 0xf55, 0xe5c,\n    0x15c, 0x55, 0x35f, 0x256, 0x55a, 0x453, 0x759, 0x650,\n    0xaf0, 0xbf9, 0x8f3, 0x9fa, 0xef6, 0xfff, 0xcf5, 0xdfc,\n    0x2fc, 0x3f5, 0xff, 0x1f6, 0x6fa, 0x7f3, 0x4f9, 0x5f0,\n    0xb60, 0xa69, 0x963, 0x86a, 0xf66, 0xe6f, 0xd65, 0xc6c,\n    0x36c, 0x265, 0x16f, 0x66, 0x76a, 0x663, 0x569, 0x460,\n    0xca0, 0xda9, 0xea3, 0xfaa, 0x8a6, 0x9af, 0xaa5, 0xbac,\n    0x4ac, 0x5a5, 0x6af, 0x7a6, 0xaa, 0x1a3, 0x2a9, 0x3a0,\n    0xd30, 0xc39, 0xf33, 0xe3a, 0x936, 0x83f, 0xb35, 0xa3c,\n    0x53c, 0x435, 0x73f, 0x636, 0x13a, 0x33, 0x339, 0x230,\n    0xe90, 0xf99, 0xc93, 0xd9a, 0xa96, 0xb9f, 0x895, 0x99c,\n    0x69c, 0x795, 0x49f, 0x596, 0x29a, 0x393, 0x99, 0x190,\n    0xf00, 0xe09, 0xd03, 0xc0a, 0xb06, 0xa0f, 0x905, 0x80c,\n    0x70c, 0x605, 0x50f, 0x406, 0x30a, 0x203, 0x109, 0x0\n  ])\n}\n\nfunction getTriTable (): Int32Array {\n  return new Int32Array([\n    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 8, 3, 9, 8, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 2, 10, 0, 2, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 8, 3, 2, 10, 8, 10, 9, 8, -1, -1, -1, -1, -1, -1, -1,\n    3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 11, 2, 8, 11, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 9, 0, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 11, 2, 1, 9, 11, 9, 8, 11, -1, -1, -1, -1, -1, -1, -1,\n    3, 10, 1, 11, 10, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 10, 1, 0, 8, 10, 8, 11, 10, -1, -1, -1, -1, -1, -1, -1,\n    3, 9, 0, 3, 11, 9, 11, 10, 9, -1, -1, -1, -1, -1, -1, -1,\n    9, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 3, 0, 7, 3, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 1, 9, 4, 7, 1, 7, 3, 1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 4, 7, 3, 0, 4, 1, 2, 10, -1, -1, -1, -1, -1, -1, -1,\n    9, 2, 10, 9, 0, 2, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1,\n    2, 10, 9, 2, 9, 7, 2, 7, 3, 7, 9, 4, -1, -1, -1, -1,\n    8, 4, 7, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 4, 7, 11, 2, 4, 2, 0, 4, -1, -1, -1, -1, -1, -1, -1,\n    9, 0, 1, 8, 4, 7, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1,\n    4, 7, 11, 9, 4, 11, 9, 11, 2, 9, 2, 1, -1, -1, -1, -1,\n    3, 10, 1, 3, 11, 10, 7, 8, 4, -1, -1, -1, -1, -1, -1, -1,\n    1, 11, 10, 1, 4, 11, 1, 0, 4, 7, 11, 4, -1, -1, -1, -1,\n    4, 7, 8, 9, 0, 11, 9, 11, 10, 11, 0, 3, -1, -1, -1, -1,\n    4, 7, 11, 4, 11, 9, 9, 11, 10, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 4, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 5, 4, 1, 5, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 5, 4, 8, 3, 5, 3, 1, 5, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 8, 1, 2, 10, 4, 9, 5, -1, -1, -1, -1, -1, -1, -1,\n    5, 2, 10, 5, 4, 2, 4, 0, 2, -1, -1, -1, -1, -1, -1, -1,\n    2, 10, 5, 3, 2, 5, 3, 5, 4, 3, 4, 8, -1, -1, -1, -1,\n    9, 5, 4, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 11, 2, 0, 8, 11, 4, 9, 5, -1, -1, -1, -1, -1, -1, -1,\n    0, 5, 4, 0, 1, 5, 2, 3, 11, -1, -1, -1, -1, -1, -1, -1,\n    2, 1, 5, 2, 5, 8, 2, 8, 11, 4, 8, 5, -1, -1, -1, -1,\n    10, 3, 11, 10, 1, 3, 9, 5, 4, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 5, 0, 8, 1, 8, 10, 1, 8, 11, 10, -1, -1, -1, -1,\n    5, 4, 0, 5, 0, 11, 5, 11, 10, 11, 0, 3, -1, -1, -1, -1,\n    5, 4, 8, 5, 8, 10, 10, 8, 11, -1, -1, -1, -1, -1, -1, -1,\n    9, 7, 8, 5, 7, 9, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 3, 0, 9, 5, 3, 5, 7, 3, -1, -1, -1, -1, -1, -1, -1,\n    0, 7, 8, 0, 1, 7, 1, 5, 7, -1, -1, -1, -1, -1, -1, -1,\n    1, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 7, 8, 9, 5, 7, 10, 1, 2, -1, -1, -1, -1, -1, -1, -1,\n    10, 1, 2, 9, 5, 0, 5, 3, 0, 5, 7, 3, -1, -1, -1, -1,\n    8, 0, 2, 8, 2, 5, 8, 5, 7, 10, 5, 2, -1, -1, -1, -1,\n    2, 10, 5, 2, 5, 3, 3, 5, 7, -1, -1, -1, -1, -1, -1, -1,\n    7, 9, 5, 7, 8, 9, 3, 11, 2, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 7, 9, 7, 2, 9, 2, 0, 2, 7, 11, -1, -1, -1, -1,\n    2, 3, 11, 0, 1, 8, 1, 7, 8, 1, 5, 7, -1, -1, -1, -1,\n    11, 2, 1, 11, 1, 7, 7, 1, 5, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 8, 8, 5, 7, 10, 1, 3, 10, 3, 11, -1, -1, -1, -1,\n    5, 7, 0, 5, 0, 9, 7, 11, 0, 1, 0, 10, 11, 10, 0, -1,\n    11, 10, 0, 11, 0, 3, 10, 5, 0, 8, 0, 7, 5, 7, 0, -1,\n    11, 10, 5, 7, 11, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 0, 1, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 8, 3, 1, 9, 8, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1,\n    1, 6, 5, 2, 6, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 6, 5, 1, 2, 6, 3, 0, 8, -1, -1, -1, -1, -1, -1, -1,\n    9, 6, 5, 9, 0, 6, 0, 2, 6, -1, -1, -1, -1, -1, -1, -1,\n    5, 9, 8, 5, 8, 2, 5, 2, 6, 3, 2, 8, -1, -1, -1, -1,\n    2, 3, 11, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 0, 8, 11, 2, 0, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1, -1, -1, -1,\n    5, 10, 6, 1, 9, 2, 9, 11, 2, 9, 8, 11, -1, -1, -1, -1,\n    6, 3, 11, 6, 5, 3, 5, 1, 3, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 11, 0, 11, 5, 0, 5, 1, 5, 11, 6, -1, -1, -1, -1,\n    3, 11, 6, 0, 3, 6, 0, 6, 5, 0, 5, 9, -1, -1, -1, -1,\n    6, 5, 9, 6, 9, 11, 11, 9, 8, -1, -1, -1, -1, -1, -1, -1,\n    5, 10, 6, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 3, 0, 4, 7, 3, 6, 5, 10, -1, -1, -1, -1, -1, -1, -1,\n    1, 9, 0, 5, 10, 6, 8, 4, 7, -1, -1, -1, -1, -1, -1, -1,\n    10, 6, 5, 1, 9, 7, 1, 7, 3, 7, 9, 4, -1, -1, -1, -1,\n    6, 1, 2, 6, 5, 1, 4, 7, 8, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 5, 5, 2, 6, 3, 0, 4, 3, 4, 7, -1, -1, -1, -1,\n    8, 4, 7, 9, 0, 5, 0, 6, 5, 0, 2, 6, -1, -1, -1, -1,\n    7, 3, 9, 7, 9, 4, 3, 2, 9, 5, 9, 6, 2, 6, 9, -1,\n    3, 11, 2, 7, 8, 4, 10, 6, 5, -1, -1, -1, -1, -1, -1, -1,\n    5, 10, 6, 4, 7, 2, 4, 2, 0, 2, 7, 11, -1, -1, -1, -1,\n    0, 1, 9, 4, 7, 8, 2, 3, 11, 5, 10, 6, -1, -1, -1, -1,\n    9, 2, 1, 9, 11, 2, 9, 4, 11, 7, 11, 4, 5, 10, 6, -1,\n    8, 4, 7, 3, 11, 5, 3, 5, 1, 5, 11, 6, -1, -1, -1, -1,\n    5, 1, 11, 5, 11, 6, 1, 0, 11, 7, 11, 4, 0, 4, 11, -1,\n    0, 5, 9, 0, 6, 5, 0, 3, 6, 11, 6, 3, 8, 4, 7, -1,\n    6, 5, 9, 6, 9, 11, 4, 7, 9, 7, 11, 9, -1, -1, -1, -1,\n    10, 4, 9, 6, 4, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 10, 6, 4, 9, 10, 0, 8, 3, -1, -1, -1, -1, -1, -1, -1,\n    10, 0, 1, 10, 6, 0, 6, 4, 0, -1, -1, -1, -1, -1, -1, -1,\n    8, 3, 1, 8, 1, 6, 8, 6, 4, 6, 1, 10, -1, -1, -1, -1,\n    1, 4, 9, 1, 2, 4, 2, 6, 4, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 8, 1, 2, 9, 2, 4, 9, 2, 6, 4, -1, -1, -1, -1,\n    0, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 3, 2, 8, 2, 4, 4, 2, 6, -1, -1, -1, -1, -1, -1, -1,\n    10, 4, 9, 10, 6, 4, 11, 2, 3, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 2, 2, 8, 11, 4, 9, 10, 4, 10, 6, -1, -1, -1, -1,\n    3, 11, 2, 0, 1, 6, 0, 6, 4, 6, 1, 10, -1, -1, -1, -1,\n    6, 4, 1, 6, 1, 10, 4, 8, 1, 2, 1, 11, 8, 11, 1, -1,\n    9, 6, 4, 9, 3, 6, 9, 1, 3, 11, 6, 3, -1, -1, -1, -1,\n    8, 11, 1, 8, 1, 0, 11, 6, 1, 9, 1, 4, 6, 4, 1, -1,\n    3, 11, 6, 3, 6, 0, 0, 6, 4, -1, -1, -1, -1, -1, -1, -1,\n    6, 4, 8, 11, 6, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 10, 6, 7, 8, 10, 8, 9, 10, -1, -1, -1, -1, -1, -1, -1,\n    0, 7, 3, 0, 10, 7, 0, 9, 10, 6, 7, 10, -1, -1, -1, -1,\n    10, 6, 7, 1, 10, 7, 1, 7, 8, 1, 8, 0, -1, -1, -1, -1,\n    10, 6, 7, 10, 7, 1, 1, 7, 3, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 6, 1, 6, 8, 1, 8, 9, 8, 6, 7, -1, -1, -1, -1,\n    2, 6, 9, 2, 9, 1, 6, 7, 9, 0, 9, 3, 7, 3, 9, -1,\n    7, 8, 0, 7, 0, 6, 6, 0, 2, -1, -1, -1, -1, -1, -1, -1,\n    7, 3, 2, 6, 7, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 3, 11, 10, 6, 8, 10, 8, 9, 8, 6, 7, -1, -1, -1, -1,\n    2, 0, 7, 2, 7, 11, 0, 9, 7, 6, 7, 10, 9, 10, 7, -1,\n    1, 8, 0, 1, 7, 8, 1, 10, 7, 6, 7, 10, 2, 3, 11, -1,\n    11, 2, 1, 11, 1, 7, 10, 6, 1, 6, 7, 1, -1, -1, -1, -1,\n    8, 9, 6, 8, 6, 7, 9, 1, 6, 11, 6, 3, 1, 3, 6, -1,\n    0, 9, 1, 11, 6, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 8, 0, 7, 0, 6, 3, 11, 0, 11, 6, 0, -1, -1, -1, -1,\n    7, 11, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 8, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 9, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 1, 9, 8, 3, 1, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1,\n    10, 1, 2, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 3, 0, 8, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1,\n    2, 9, 0, 2, 10, 9, 6, 11, 7, -1, -1, -1, -1, -1, -1, -1,\n    6, 11, 7, 2, 10, 3, 10, 8, 3, 10, 9, 8, -1, -1, -1, -1,\n    7, 2, 3, 6, 2, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    7, 0, 8, 7, 6, 0, 6, 2, 0, -1, -1, -1, -1, -1, -1, -1,\n    2, 7, 6, 2, 3, 7, 0, 1, 9, -1, -1, -1, -1, -1, -1, -1,\n    1, 6, 2, 1, 8, 6, 1, 9, 8, 8, 7, 6, -1, -1, -1, -1,\n    10, 7, 6, 10, 1, 7, 1, 3, 7, -1, -1, -1, -1, -1, -1, -1,\n    10, 7, 6, 1, 7, 10, 1, 8, 7, 1, 0, 8, -1, -1, -1, -1,\n    0, 3, 7, 0, 7, 10, 0, 10, 9, 6, 10, 7, -1, -1, -1, -1,\n    7, 6, 10, 7, 10, 8, 8, 10, 9, -1, -1, -1, -1, -1, -1, -1,\n    6, 8, 4, 11, 8, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 6, 11, 3, 0, 6, 0, 4, 6, -1, -1, -1, -1, -1, -1, -1,\n    8, 6, 11, 8, 4, 6, 9, 0, 1, -1, -1, -1, -1, -1, -1, -1,\n    9, 4, 6, 9, 6, 3, 9, 3, 1, 11, 3, 6, -1, -1, -1, -1,\n    6, 8, 4, 6, 11, 8, 2, 10, 1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 3, 0, 11, 0, 6, 11, 0, 4, 6, -1, -1, -1, -1,\n    4, 11, 8, 4, 6, 11, 0, 2, 9, 2, 10, 9, -1, -1, -1, -1,\n    10, 9, 3, 10, 3, 2, 9, 4, 3, 11, 3, 6, 4, 6, 3, -1,\n    8, 2, 3, 8, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1,\n    0, 4, 2, 4, 6, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 9, 0, 2, 3, 4, 2, 4, 6, 4, 3, 8, -1, -1, -1, -1,\n    1, 9, 4, 1, 4, 2, 2, 4, 6, -1, -1, -1, -1, -1, -1, -1,\n    8, 1, 3, 8, 6, 1, 8, 4, 6, 6, 10, 1, -1, -1, -1, -1,\n    10, 1, 0, 10, 0, 6, 6, 0, 4, -1, -1, -1, -1, -1, -1, -1,\n    4, 6, 3, 4, 3, 8, 6, 10, 3, 0, 3, 9, 10, 9, 3, -1,\n    10, 9, 4, 6, 10, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 5, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 4, 9, 5, 11, 7, 6, -1, -1, -1, -1, -1, -1, -1,\n    5, 0, 1, 5, 4, 0, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1,\n    11, 7, 6, 8, 3, 4, 3, 5, 4, 3, 1, 5, -1, -1, -1, -1,\n    9, 5, 4, 10, 1, 2, 7, 6, 11, -1, -1, -1, -1, -1, -1, -1,\n    6, 11, 7, 1, 2, 10, 0, 8, 3, 4, 9, 5, -1, -1, -1, -1,\n    7, 6, 11, 5, 4, 10, 4, 2, 10, 4, 0, 2, -1, -1, -1, -1,\n    3, 4, 8, 3, 5, 4, 3, 2, 5, 10, 5, 2, 11, 7, 6, -1,\n    7, 2, 3, 7, 6, 2, 5, 4, 9, -1, -1, -1, -1, -1, -1, -1,\n    9, 5, 4, 0, 8, 6, 0, 6, 2, 6, 8, 7, -1, -1, -1, -1,\n    3, 6, 2, 3, 7, 6, 1, 5, 0, 5, 4, 0, -1, -1, -1, -1,\n    6, 2, 8, 6, 8, 7, 2, 1, 8, 4, 8, 5, 1, 5, 8, -1,\n    9, 5, 4, 10, 1, 6, 1, 7, 6, 1, 3, 7, -1, -1, -1, -1,\n    1, 6, 10, 1, 7, 6, 1, 0, 7, 8, 7, 0, 9, 5, 4, -1,\n    4, 0, 10, 4, 10, 5, 0, 3, 10, 6, 10, 7, 3, 7, 10, -1,\n    7, 6, 10, 7, 10, 8, 5, 4, 10, 4, 8, 10, -1, -1, -1, -1,\n    6, 9, 5, 6, 11, 9, 11, 8, 9, -1, -1, -1, -1, -1, -1, -1,\n    3, 6, 11, 0, 6, 3, 0, 5, 6, 0, 9, 5, -1, -1, -1, -1,\n    0, 11, 8, 0, 5, 11, 0, 1, 5, 5, 6, 11, -1, -1, -1, -1,\n    6, 11, 3, 6, 3, 5, 5, 3, 1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 10, 9, 5, 11, 9, 11, 8, 11, 5, 6, -1, -1, -1, -1,\n    0, 11, 3, 0, 6, 11, 0, 9, 6, 5, 6, 9, 1, 2, 10, -1,\n    11, 8, 5, 11, 5, 6, 8, 0, 5, 10, 5, 2, 0, 2, 5, -1,\n    6, 11, 3, 6, 3, 5, 2, 10, 3, 10, 5, 3, -1, -1, -1, -1,\n    5, 8, 9, 5, 2, 8, 5, 6, 2, 3, 8, 2, -1, -1, -1, -1,\n    9, 5, 6, 9, 6, 0, 0, 6, 2, -1, -1, -1, -1, -1, -1, -1,\n    1, 5, 8, 1, 8, 0, 5, 6, 8, 3, 8, 2, 6, 2, 8, -1,\n    1, 5, 6, 2, 1, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 3, 6, 1, 6, 10, 3, 8, 6, 5, 6, 9, 8, 9, 6, -1,\n    10, 1, 0, 10, 0, 6, 9, 5, 0, 5, 6, 0, -1, -1, -1, -1,\n    0, 3, 8, 5, 6, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    10, 5, 6, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 5, 10, 7, 5, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    11, 5, 10, 11, 7, 5, 8, 3, 0, -1, -1, -1, -1, -1, -1, -1,\n    5, 11, 7, 5, 10, 11, 1, 9, 0, -1, -1, -1, -1, -1, -1, -1,\n    10, 7, 5, 10, 11, 7, 9, 8, 1, 8, 3, 1, -1, -1, -1, -1,\n    11, 1, 2, 11, 7, 1, 7, 5, 1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 1, 2, 7, 1, 7, 5, 7, 2, 11, -1, -1, -1, -1,\n    9, 7, 5, 9, 2, 7, 9, 0, 2, 2, 11, 7, -1, -1, -1, -1,\n    7, 5, 2, 7, 2, 11, 5, 9, 2, 3, 2, 8, 9, 8, 2, -1,\n    2, 5, 10, 2, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1,\n    8, 2, 0, 8, 5, 2, 8, 7, 5, 10, 2, 5, -1, -1, -1, -1,\n    9, 0, 1, 5, 10, 3, 5, 3, 7, 3, 10, 2, -1, -1, -1, -1,\n    9, 8, 2, 9, 2, 1, 8, 7, 2, 10, 2, 5, 7, 5, 2, -1,\n    1, 3, 5, 3, 7, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 7, 0, 7, 1, 1, 7, 5, -1, -1, -1, -1, -1, -1, -1,\n    9, 0, 3, 9, 3, 5, 5, 3, 7, -1, -1, -1, -1, -1, -1, -1,\n    9, 8, 7, 5, 9, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    5, 8, 4, 5, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1,\n    5, 0, 4, 5, 11, 0, 5, 10, 11, 11, 3, 0, -1, -1, -1, -1,\n    0, 1, 9, 8, 4, 10, 8, 10, 11, 10, 4, 5, -1, -1, -1, -1,\n    10, 11, 4, 10, 4, 5, 11, 3, 4, 9, 4, 1, 3, 1, 4, -1,\n    2, 5, 1, 2, 8, 5, 2, 11, 8, 4, 5, 8, -1, -1, -1, -1,\n    0, 4, 11, 0, 11, 3, 4, 5, 11, 2, 11, 1, 5, 1, 11, -1,\n    0, 2, 5, 0, 5, 9, 2, 11, 5, 4, 5, 8, 11, 8, 5, -1,\n    9, 4, 5, 2, 11, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 5, 10, 3, 5, 2, 3, 4, 5, 3, 8, 4, -1, -1, -1, -1,\n    5, 10, 2, 5, 2, 4, 4, 2, 0, -1, -1, -1, -1, -1, -1, -1,\n    3, 10, 2, 3, 5, 10, 3, 8, 5, 4, 5, 8, 0, 1, 9, -1,\n    5, 10, 2, 5, 2, 4, 1, 9, 2, 9, 4, 2, -1, -1, -1, -1,\n    8, 4, 5, 8, 5, 3, 3, 5, 1, -1, -1, -1, -1, -1, -1, -1,\n    0, 4, 5, 1, 0, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    8, 4, 5, 8, 5, 3, 9, 0, 5, 0, 3, 5, -1, -1, -1, -1,\n    9, 4, 5, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 11, 7, 4, 9, 11, 9, 10, 11, -1, -1, -1, -1, -1, -1, -1,\n    0, 8, 3, 4, 9, 7, 9, 11, 7, 9, 10, 11, -1, -1, -1, -1,\n    1, 10, 11, 1, 11, 4, 1, 4, 0, 7, 4, 11, -1, -1, -1, -1,\n    3, 1, 4, 3, 4, 8, 1, 10, 4, 7, 4, 11, 10, 11, 4, -1,\n    4, 11, 7, 9, 11, 4, 9, 2, 11, 9, 1, 2, -1, -1, -1, -1,\n    9, 7, 4, 9, 11, 7, 9, 1, 11, 2, 11, 1, 0, 8, 3, -1,\n    11, 7, 4, 11, 4, 2, 2, 4, 0, -1, -1, -1, -1, -1, -1, -1,\n    11, 7, 4, 11, 4, 2, 8, 3, 4, 3, 2, 4, -1, -1, -1, -1,\n    2, 9, 10, 2, 7, 9, 2, 3, 7, 7, 4, 9, -1, -1, -1, -1,\n    9, 10, 7, 9, 7, 4, 10, 2, 7, 8, 7, 0, 2, 0, 7, -1,\n    3, 7, 10, 3, 10, 2, 7, 4, 10, 1, 10, 0, 4, 0, 10, -1,\n    1, 10, 2, 8, 7, 4, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 1, 4, 1, 7, 7, 1, 3, -1, -1, -1, -1, -1, -1, -1,\n    4, 9, 1, 4, 1, 7, 0, 8, 1, 8, 7, 1, -1, -1, -1, -1,\n    4, 0, 3, 7, 4, 3, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    4, 8, 7, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    9, 10, 8, 10, 11, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 9, 3, 9, 11, 11, 9, 10, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 10, 0, 10, 8, 8, 10, 11, -1, -1, -1, -1, -1, -1, -1,\n    3, 1, 10, 11, 3, 10, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 2, 11, 1, 11, 9, 9, 11, 8, -1, -1, -1, -1, -1, -1, -1,\n    3, 0, 9, 3, 9, 11, 1, 2, 9, 2, 11, 9, -1, -1, -1, -1,\n    0, 2, 11, 8, 0, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    3, 2, 11, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 3, 8, 2, 8, 10, 10, 8, 9, -1, -1, -1, -1, -1, -1, -1,\n    9, 10, 2, 0, 9, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    2, 3, 8, 2, 8, 10, 0, 1, 8, 1, 10, 8, -1, -1, -1, -1,\n    1, 10, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    1, 3, 8, 9, 1, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 9, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    0, 3, 8, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n    -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1\n  ])\n}\n\n// Triangles are constructed between points on cube edges.\n// allowedContours[edge1][edge1] indicates which lines from a given\n// triangle should be shown in line mode.\n\n// Values are bitmasks:\n// In loop over cubes we keep another bitmask indicating whether our current\n// cell is the first x-value (1),\n// first y-value (2) or first z-value (4) of the current loop.\n// We draw all lines on leading faces but only draw trailing face lines the first\n// time through the loop\n// A value of 8 below means the edge is always drawn (leading face)\n\n// E.g. the first row, lines between edge0 and other edges in the bottom\n// x-y plane are only drawn for the first value of z, edges in the\n// x-z plane are only drawn for the first value of y. No other lines\n// are drawn as they're redundant\n// The line between edge 1 and 5 is always drawn as it's on the leading edge\n\nfunction getAllowedContours () {\n  return [\n\n    [ 0, 4, 4, 4, 2, 0, 0, 0, 2, 2, 0, 0 ], // 1 2 3 4 8 9\n    [ 4, 0, 4, 4, 0, 8, 0, 0, 0, 8, 8, 0 ], // 0 2 3 5 9 10\n    [ 4, 4, 0, 4, 0, 0, 8, 0, 0, 0, 8, 8 ], // 0 1 3 6 10 11\n    [ 4, 4, 4, 0, 0, 0, 0, 1, 1, 0, 0, 1 ], // 0 1 2 7 8 11\n    [ 2, 0, 0, 0, 0, 8, 8, 8, 2, 2, 0, 0 ], // 0 5 6 7 8 9\n    [ 0, 8, 0, 0, 8, 0, 8, 8, 0, 8, 8, 0 ], // And rotate it\n    [ 0, 0, 8, 0, 8, 8, 0, 8, 0, 0, 8, 8 ],\n    [ 0, 0, 0, 1, 8, 8, 8, 0, 1, 0, 0, 1 ],\n    [ 2, 0, 0, 1, 2, 0, 0, 1, 0, 2, 0, 1 ], // 0 3 4 7 9 11\n    [ 2, 8, 0, 0, 2, 8, 0, 0, 2, 0, 8, 0 ], // And rotate some more\n    [ 0, 8, 8, 0, 0, 8, 8, 0, 0, 8, 0, 8 ],\n    [ 0, 0, 8, 1, 0, 0, 8, 1, 1, 0, 8, 0 ]\n\n  ]\n}\ninterface MarchingCubes {\n  new (field: number[], nx: number, ny: number, nz: number, atomindex: number[]): void\n  triangulate: (_isolevel: number, _noNormals: boolean, _box: number[][]|undefined, _contour: boolean, _wrap: boolean) => {\n    position: Float32Array\n    normal: undefined|Float32Array\n    index: Uint32Array|Uint16Array\n    atomindex: Int32Array|undefined\n    contour: boolean\n  }\n}\nfunction MarchingCubes (this: MarchingCubes, field: number[], nx: number, ny: number, nz: number, atomindex: number[]) {\n  // Based on alteredq / http://alteredqualia.com/\n  // port of greggman's ThreeD version of marching cubes to Three.js\n  // http://webglsamples.googlecode.com/hg/blob/blob.html\n  //\n  // Adapted for NGL by Alexander Rose\n\n  var isolevel = 0\n  var noNormals = false\n  var contour = false\n  var wrap = false\n  var isNegativeIso = false\n  var normalFactor = -1\n\n\n  var n = nx * ny * nz\n\n  // deltas\n  var yd = nx\n  var zd = nx * ny\n\n  var normalCache: Float32Array, vertexIndex: Int32Array\n  var count: number, icount: number\n\n  var ilist = new Int32Array(12)\n\n  var positionArray: number[] = []\n  var normalArray: number[] = []\n  var indexArray: number[] = []\n  var atomindexArray: number[] = []\n\n  var edgeTable = getEdgeTable()\n  var triTable = getTriTable()\n  var allowedContours = getAllowedContours()\n\n  var mx: number, my: number, mz: number\n\n  //\n\n  this.triangulate = function (_isolevel: number, _noNormals: boolean, _box: number[][]|undefined, _contour: boolean, _wrap: boolean) {\n    isolevel = _isolevel\n    isNegativeIso = isolevel < 0.0\n    contour = _contour\n    wrap = _wrap\n    // Normals currently disabled in contour mode for performance (unused)\n    noNormals = _noNormals || contour\n\n    if (!noNormals) {\n      normalFactor = isolevel > 0 ? -1.0 : 1.0\n      if (!normalCache) {\n        normalCache = new Float32Array(n * 3)\n      }  \n    }\n\n    var vIndexLength = n * 3\n\n    if (!vertexIndex || vertexIndex.length !== vIndexLength) {\n      vertexIndex = new Int32Array(vIndexLength)\n    }\n\n    count = 0\n    icount = 0\n\n    if (_box !== undefined) {\n      var min = _box[ 0 ].map(Math.round)\n      var max = _box[ 1 ].map(Math.round)\n\n      mx = nx * Math.ceil(Math.abs(min[ 0 ]) / nx)\n      my = ny * Math.ceil(Math.abs(min[ 1 ]) / ny)\n      mz = nz * Math.ceil(Math.abs(min[ 2 ]) / nz)\n\n      triangulate(\n        min[ 0 ], min[ 1 ], min[ 2 ],\n        max[ 0 ], max[ 1 ], max[ 2 ]\n      )\n    } else {\n      mx = my = mz = 0\n\n      triangulate()\n    }\n\n    positionArray.length = count * 3\n    if (!noNormals) normalArray.length = count * 3\n    indexArray.length = icount\n    if (atomindex) atomindexArray.length = count\n\n    return {\n      position: new Float32Array(positionArray),\n      normal: noNormals ? undefined : new Float32Array(normalArray),\n      index: getUintArray(indexArray, positionArray.length / 3),\n      atomindex: atomindex ? new Int32Array(atomindexArray) : undefined,\n      contour: contour\n    }\n  }\n\n  // polygonization\n\n  function lerp (a: number, b: number, t: number) { return a + (b - a) * t }\n\n  function index (x: number, y: number, z: number) {\n    x = (x + mx) % nx\n    y = (y + my) % ny\n    z = (z + mz) % nz\n    return ((zd * z) + yd * y) + x\n  }\n\n  function VIntX (q: number, offset: number, x: number, y: number, z: number, valp1: number, valp2: number) {\n    var _q = 3 * q\n\n    if (vertexIndex[ _q ] < 0) {\n      var mu = (isolevel - valp1) / (valp2 - valp1)\n      var nc = normalCache\n\n      var c = count * 3\n\n      positionArray[ c + 0 ] = x + mu\n      positionArray[ c + 1 ] = y\n      positionArray[ c + 2 ] = z\n\n      if (!noNormals) {\n        var q3 = q * 3\n\n        normalArray[ c ] = normalFactor * lerp(nc[ q3 ], nc[ q3 + 3 ], mu)\n        normalArray[ c + 1 ] = normalFactor * lerp(nc[ q3 + 1 ], nc[ q3 + 4 ], mu)\n        normalArray[ c + 2 ] = normalFactor * lerp(nc[ q3 + 2 ], nc[ q3 + 5 ], mu)\n      }\n\n      if (atomindex) atomindexArray[ count ] = atomindex[ q + Math.round(mu) ]\n\n      vertexIndex[ _q ] = count\n      ilist[ offset ] = count\n\n      count += 1\n    } else {\n      ilist[ offset ] = vertexIndex[ _q ]\n    }\n  }\n\n  function VIntY (q: number, offset: number, x: number, y: number, z: number, valp1: number, valp2: number) {\n    var _q = 3 * q + 1\n\n    if (vertexIndex[ _q ] < 0) {\n      var mu = (isolevel - valp1) / (valp2 - valp1)\n      var nc = normalCache\n\n      var c = count * 3\n\n      positionArray[ c ] = x\n      positionArray[ c + 1 ] = y + mu\n      positionArray[ c + 2 ] = z\n\n      if (!noNormals) {\n        var q3 = q * 3\n        var q6 = q3 + yd * 3\n\n        normalArray[ c ] = normalFactor * lerp(nc[ q3 ], nc[ q6 ], mu)\n        normalArray[ c + 1 ] = normalFactor * lerp(nc[ q3 + 1 ], nc[ q6 + 1 ], mu)\n        normalArray[ c + 2 ] = normalFactor * lerp(nc[ q3 + 2 ], nc[ q6 + 2 ], mu)\n      }\n\n      if (atomindex) atomindexArray[ count ] = atomindex[ q + Math.round(mu) * yd ]\n\n      vertexIndex[ _q ] = count\n      ilist[ offset ] = count\n\n      count += 1\n    } else {\n      ilist[ offset ] = vertexIndex[ _q ]\n    }\n  }\n\n  function VIntZ (q: number, offset: number, x: number, y: number, z: number, valp1: number, valp2: number) {\n    var _q = 3 * q + 2\n\n    if (vertexIndex[ _q ] < 0) {\n      var mu = (isolevel - valp1) / (valp2 - valp1)\n      var nc = normalCache\n\n      var c = count * 3\n\n      positionArray[ c ] = x\n      positionArray[ c + 1 ] = y\n      positionArray[ c + 2 ] = z + mu\n\n      if (!noNormals) {\n        var q3 = q * 3\n        var q6 = q3 + zd * 3\n\n        normalArray[ c ] = normalFactor * lerp(nc[ q3 ], nc[ q6 ], mu)\n        normalArray[ c + 1 ] = normalFactor * lerp(nc[ q3 + 1 ], nc[ q6 + 1 ], mu)\n        normalArray[ c + 2 ] = normalFactor * lerp(nc[ q3 + 2 ], nc[ q6 + 2 ], mu)\n      }\n\n      if (atomindex) atomindexArray[ count ] = atomindex[ q + Math.round(mu) * zd ]\n\n      vertexIndex[ _q ] = count\n      ilist[ offset ] = count\n\n      count += 1\n    } else {\n      ilist[ offset ] = vertexIndex[ _q ]\n    }\n  }\n\n  function compNorm (q: number) {\n    var q3 = q * 3\n\n    if (normalCache[ q3 ] === 0.0) {\n      normalCache[ q3 ] = field[ (q - 1 + n) % n ] - field[ (q + 1) % n ]\n      normalCache[ q3 + 1 ] = field[ (q - yd + n) % n ] - field[ (q + yd) % n ]\n      normalCache[ q3 + 2 ] = field[ (q - zd + n) % n ] - field[ (q + zd) % n ]\n    }\n  }\n\n  function polygonize (fx: number, fy: number, fz: number, q: number, edgeFilter: number) {\n    // cache indices\n    var q1\n    var qy\n    var qz\n    var q1y\n    var q1z\n    var qyz\n    var q1yz\n    if (wrap) {\n      q = index(fx, fy, fz)\n      q1 = index(fx + 1, fy, fz)\n      qy = index(fx, fy + 1, fz)\n      qz = index(fx, fy, fz + 1)\n      q1y = index(fx + 1, fy + 1, fz)\n      q1z = index(fx + 1, fy, fz + 1)\n      qyz = index(fx, fy + 1, fz + 1)\n      q1yz = index(fx + 1, fy + 1, fz + 1)\n    } else {\n      q1 = q + 1\n      qy = q + yd\n      qz = q + zd\n      q1y = qy + 1\n      q1z = qz + 1\n      qyz = qy + zd\n      q1yz = qyz + 1\n    }\n\n    var cubeindex = 0\n    var field0 = field[ q ]\n    var field1 = field[ q1 ]\n    var field2 = field[ qy ]\n    var field3 = field[ q1y ]\n    var field4 = field[ qz ]\n    var field5 = field[ q1z ]\n    var field6 = field[ qyz ]\n    var field7 = field[ q1yz ]\n\n    if (field0 < isolevel) cubeindex |= 1\n    if (field1 < isolevel) cubeindex |= 2\n    if (field2 < isolevel) cubeindex |= 8\n    if (field3 < isolevel) cubeindex |= 4\n    if (field4 < isolevel) cubeindex |= 16\n    if (field5 < isolevel) cubeindex |= 32\n    if (field6 < isolevel) cubeindex |= 128\n    if (field7 < isolevel) cubeindex |= 64\n\n    // if cube is entirely in/out of the surface - bail, nothing to draw\n\n    var bits = edgeTable[ cubeindex ]\n    if (bits === 0) return 0\n\n    var fx2 = fx + 1\n    var fy2 = fy + 1\n    var fz2 = fz + 1\n\n    // top of the cube\n\n    if (bits & 1) {\n      if (!noNormals) {\n        compNorm(q)\n        compNorm(q1)\n      }\n      VIntX(q, 0, fx, fy, fz, field0, field1)\n    }\n\n    if (bits & 2) {\n      if (!noNormals) {\n        compNorm(q1)\n        compNorm(q1y)\n      }\n      VIntY(q1, 1, fx2, fy, fz, field1, field3)\n    }\n\n    if (bits & 4) {\n      if (!noNormals) {\n        compNorm(qy)\n        compNorm(q1y)\n      }\n      VIntX(qy, 2, fx, fy2, fz, field2, field3)\n    }\n\n    if (bits & 8) {\n      if (!noNormals) {\n        compNorm(q)\n        compNorm(qy)\n      }\n      VIntY(q, 3, fx, fy, fz, field0, field2)\n    }\n\n    // bottom of the cube\n\n    if (bits & 16) {\n      if (!noNormals) {\n        compNorm(qz)\n        compNorm(q1z)\n      }\n      VIntX(qz, 4, fx, fy, fz2, field4, field5)\n    }\n\n    if (bits & 32) {\n      if (!noNormals) {\n        compNorm(q1z)\n        compNorm(q1yz)\n      }\n      VIntY(q1z, 5, fx2, fy, fz2, field5, field7)\n    }\n\n    if (bits & 64) {\n      if (!noNormals) {\n        compNorm(qyz)\n        compNorm(q1yz)\n      }\n      VIntX(qyz, 6, fx, fy2, fz2, field6, field7)\n    }\n\n    if (bits & 128) {\n      if (!noNormals) {\n        compNorm(qz)\n        compNorm(qyz)\n      }\n      VIntY(qz, 7, fx, fy, fz2, field4, field6)\n    }\n\n    // vertical lines of the cube\n\n    if (bits & 256) {\n      if (!noNormals) {\n        compNorm(q)\n        compNorm(qz)\n      }\n      VIntZ(q, 8, fx, fy, fz, field0, field4)\n    }\n\n    if (bits & 512) {\n      if (!noNormals) {\n        compNorm(q1)\n        compNorm(q1z)\n      }\n      VIntZ(q1, 9, fx2, fy, fz, field1, field5)\n    }\n\n    if (bits & 1024) {\n      if (!noNormals) {\n        compNorm(q1y)\n        compNorm(q1yz)\n      }\n      VIntZ(q1y, 10, fx2, fy2, fz, field3, field7)\n    }\n\n    if (bits & 2048) {\n      if (!noNormals) {\n        compNorm(qy)\n        compNorm(qyz)\n      }\n      VIntZ(qy, 11, fx, fy2, fz, field2, field6)\n    }\n\n    var triIndex = cubeindex << 4 // re-purpose cubeindex into an offset into triTable\n\n    var e1\n    var e2\n    var e3\n    var i = 0\n\n    // here is where triangles are created\n\n    while (triTable[ triIndex + i ] !== -1) {\n      e1 = triTable[ triIndex + i ]\n      e2 = triTable[ triIndex + i + 1 ]\n      e3 = triTable[ triIndex + i + 2 ]\n\n      if (contour) {\n        if (allowedContours[ e1 ][ e2 ] & edgeFilter) {\n          indexArray[ icount++ ] = ilist[ e1 ]\n          indexArray[ icount++ ] = ilist[ e2 ]\n        }\n        if (allowedContours[ e2 ][ e3 ] & edgeFilter) {\n          indexArray[ icount++ ] = ilist[ e2 ]\n          indexArray[ icount++ ] = ilist[ e3 ]\n        }\n        if (allowedContours[ e1 ][ e3 ] & edgeFilter) {\n          indexArray[ icount++ ] = ilist[ e1 ]\n          indexArray[ icount++ ] = ilist[ e3 ]\n        }\n      } else {\n        indexArray[ icount++ ] = ilist[ isNegativeIso ? e1 : e2 ]\n        indexArray[ icount++ ] = ilist[ isNegativeIso ? e2 : e1 ]\n        indexArray[ icount++ ] = ilist[ e3 ]\n      }\n\n      i += 3\n    }\n  }\n\n  function triangulate (xBeg?: number, yBeg?: number, zBeg?: number, xEnd?: number, yEnd?: number, zEnd?: number) {\n    let q\n    let q3\n    let x\n    let y\n    let z\n    let yOffset\n    let zOffset\n\n    xBeg = xBeg !== undefined ? xBeg : 0\n    yBeg = yBeg !== undefined ? yBeg : 0\n    zBeg = zBeg !== undefined ? zBeg : 0\n\n    xEnd = xEnd !== undefined ? xEnd : nx - 1\n    yEnd = yEnd !== undefined ? yEnd : ny - 1\n    zEnd = zEnd !== undefined ? zEnd : nz - 1\n\n    if (!wrap) {\n      if (noNormals) {\n        xBeg = Math.max(0, xBeg)\n        yBeg = Math.max(0, yBeg)\n        zBeg = Math.max(0, zBeg)\n\n        xEnd = Math.min(nx - 1, xEnd)\n        yEnd = Math.min(ny - 1, yEnd)\n        zEnd = Math.min(nz - 1, zEnd)\n      } else {\n        xBeg = Math.max(1, xBeg)\n        yBeg = Math.max(1, yBeg)\n        zBeg = Math.max(1, zBeg)\n\n        xEnd = Math.min(nx - 2, xEnd)\n        yEnd = Math.min(ny - 2, yEnd)\n        zEnd = Math.min(nz - 2, zEnd)\n      }\n    }\n\n    let xBeg2, yBeg2, zBeg2, xEnd2, yEnd2, zEnd2\n\n    if (!wrap) {\n      // init part of the vertexIndex\n      // (takes a significant amount of time to do for all)\n\n      xBeg2 = Math.max(0, xBeg - 2)\n      yBeg2 = Math.max(0, yBeg - 2)\n      zBeg2 = Math.max(0, zBeg - 2)\n\n      xEnd2 = Math.min(nx, xEnd + 2)\n      yEnd2 = Math.min(ny, yEnd + 2)\n      zEnd2 = Math.min(nz, zEnd + 2)\n\n      for (z = zBeg2; z < zEnd2; ++z) {\n        zOffset = zd * z\n        for (y = yBeg2; y < yEnd2; ++y) {\n          yOffset = zOffset + yd * y\n          for (x = xBeg2; x < xEnd2; ++x) {\n            q = 3 * (yOffset + x)\n            vertexIndex[ q ] = -1\n            vertexIndex[ q + 1 ] = -1\n            vertexIndex[ q + 2 ] = -1\n          }\n        }\n      }\n    } else {\n      xBeg2 = xBeg - 2\n      yBeg2 = yBeg - 2\n      zBeg2 = zBeg - 2\n\n      xEnd2 = xEnd + 2\n      yEnd2 = yEnd + 2\n      zEnd2 = zEnd + 2\n\n      for (z = zBeg2; z < zEnd2; ++z) {\n        for (y = yBeg2; y < yEnd2; ++y) {\n          for (x = xBeg2; x < xEnd2; ++x) {\n            q3 = index(x, y, z) * 3\n            vertexIndex[ q3 ] = -1\n            vertexIndex[ q3 + 1 ] = -1\n            vertexIndex[ q3 + 2 ] = -1\n          }\n        }\n      }\n    }\n\n    if (!wrap) {\n      // clip space where the isovalue is too low\n\n      var __break\n      var __xBeg = xBeg; var __yBeg = yBeg; var __zBeg = zBeg\n      var __xEnd = xEnd; var __yEnd = yEnd; var __zEnd = zEnd\n\n      __break = false\n      for (z = zBeg; z < zEnd; ++z) {\n        for (y = yBeg; y < yEnd; ++y) {\n          for (x = xBeg; x < xEnd; ++x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __zBeg = z\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (y = yBeg; y < yEnd; ++y) {\n        for (z = __zBeg; z < zEnd; ++z) {\n          for (x = xBeg; x < xEnd; ++x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __yBeg = y\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (x = xBeg; x < xEnd; ++x) {\n        for (y = __yBeg; y < yEnd; ++y) {\n          for (z = __zBeg; z < zEnd; ++z) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __xBeg = x\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (z = zEnd; z >= zBeg; --z) {\n        for (y = yEnd; y >= yBeg; --y) {\n          for (x = xEnd; x >= xBeg; --x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __zEnd = z\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (y = yEnd; y >= yBeg; --y) {\n        for (z = __zEnd; z >= zBeg; --z) {\n          for (x = xEnd; x >= xBeg; --x) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __yEnd = y\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      __break = false\n      for (x = xEnd; x >= xBeg; --x) {\n        for (y = __yEnd; y >= yBeg; --y) {\n          for (z = __zEnd; z >= zBeg; --z) {\n            q = ((nx * ny) * z) + (nx * y) + x\n            if (field[ q ] >= isolevel) {\n              __xEnd = x\n              __break = true\n              break\n            }\n          }\n          if (__break) break\n        }\n        if (__break) break\n      }\n\n      //\n\n      if (noNormals) {\n        xBeg = Math.max(0, __xBeg - 1)\n        yBeg = Math.max(0, __yBeg - 1)\n        zBeg = Math.max(0, __zBeg - 1)\n\n        xEnd = Math.min(nx - 1, __xEnd + 1)\n        yEnd = Math.min(ny - 1, __yEnd + 1)\n        zEnd = Math.min(nz - 1, __zEnd + 1)\n      } else {\n        xBeg = Math.max(1, __xBeg - 1)\n        yBeg = Math.max(1, __yBeg - 1)\n        zBeg = Math.max(1, __zBeg - 1)\n\n        xEnd = Math.min(nx - 2, __xEnd + 1)\n        yEnd = Math.min(ny - 2, __yEnd + 1)\n        zEnd = Math.min(nz - 2, __zEnd + 1)\n      }\n    }\n\n    // polygonize part of the grid\n    var edgeFilter = 15\n    for (z = zBeg; z < zEnd; ++z, edgeFilter &= ~4) {\n      zOffset = zd * z\n      edgeFilter |= 2\n      for (y = yBeg; y < yEnd; ++y, edgeFilter &= ~2) {\n        yOffset = zOffset + yd * y\n        edgeFilter |= 1\n        for (x = xBeg; x < xEnd; ++x, edgeFilter &= ~1) {\n          q = yOffset + x\n          polygonize(x, y, z, q, edgeFilter)\n        }\n      }\n    }\n  }\n}\nObject.assign(MarchingCubes, {__deps: [ getEdgeTable, getTriTable, getAllowedContours, getUintArray ]})\n\nexport default MarchingCubes\n","/**\n * @file Matrix Utils\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n *\n * svd methods from Eugene Zatepyakin / http://inspirit.github.io/jsfeat/\n */\n\nimport { NumberArray } from '../types'\nimport { v3new, v3cross } from './vector-utils'\n\nexport class Matrix {\n  size: number\n  data: Float32Array\n\n  constructor (readonly cols: number, readonly rows: number) {\n    this.size = this.cols * this.rows\n    this.data = new Float32Array(this.size)\n  }\n\n  copyTo (matrix: Matrix) {\n    matrix.data.set(this.data)\n  }\n}\n\nexport function transpose (At: Matrix, A: Matrix) {\n  let i = 0\n  let j = 0\n  const nrows = A.rows\n  const ncols = A.cols\n  let Ai = 0\n  let Ati = 0\n  let pAt = 0\n  const ad = A.data\n  const atd = At.data\n\n  for (; i < nrows; Ati += 1, Ai += ncols, i++) {\n    pAt = Ati\n    for (j = 0; j < ncols; pAt += nrows, j++) atd[pAt] = ad[Ai + j]\n  }\n}\n\n// C = A * B\nexport function multiply (C: Matrix, A: Matrix, B: Matrix) {\n  let i = 0\n  let j = 0\n  let k = 0\n  let Ap = 0\n  let pA = 0\n  let pB = 0\n  let _pB = 0\n  let Cp = 0\n  const ncols = A.cols\n  const nrows = A.rows\n  const mcols = B.cols\n  const ad = A.data\n  const bd = B.data\n  const cd = C.data\n  let sum = 0.0\n\n  for (; i < nrows; Ap += ncols, i++) {\n    for (_pB = 0, j = 0; j < mcols; Cp++, _pB++, j++) {\n      pB = _pB\n      pA = Ap\n      sum = 0.0\n      for (k = 0; k < ncols; pA++, pB += mcols, k++) {\n        sum += ad[pA] * bd[pB]\n      }\n      cd[Cp] = sum\n    }\n  }\n}\n\n// C = A * B'\nexport function multiplyABt (C: Matrix, A: Matrix, B: Matrix) {\n  let i = 0\n  let j = 0\n  let k = 0\n  let Ap = 0\n  let pA = 0\n  let pB = 0\n  let Cp = 0\n  const ncols = A.cols\n  const nrows = A.rows\n  const mrows = B.rows\n  const ad = A.data\n  const bd = B.data\n  const cd = C.data\n  let sum = 0.0\n\n  for (; i < nrows; Ap += ncols, i++) {\n    for (pB = 0, j = 0; j < mrows; Cp++, j++) {\n      pA = Ap\n      sum = 0.0\n      for (k = 0; k < ncols; pA++, pB++, k++) {\n        sum += ad[pA] * bd[pB]\n      }\n      cd[Cp] = sum\n    }\n  }\n}\n\n// C = A' * B\nexport function multiplyAtB (C: Matrix, A: Matrix, B: Matrix) {\n  let i = 0\n  let j = 0\n  let k = 0\n  let Ap = 0\n  let pA = 0\n  let pB = 0\n  let _pB = 0\n  let Cp = 0\n  const ncols = A.cols\n  const nrows = A.rows\n  const mcols = B.cols\n  const ad = A.data\n  const bd = B.data\n  const cd = C.data\n  let sum = 0.0\n\n  for (; i < ncols; Ap++, i++) {\n    for (_pB = 0, j = 0; j < mcols; Cp++, _pB++, j++) {\n      pB = _pB\n      pA = Ap\n      sum = 0.0\n      for (k = 0; k < nrows; pA += ncols, pB += mcols, k++) {\n        sum += ad[pA] * bd[pB]\n      }\n      cd[Cp] = sum\n    }\n  }\n}\n\nexport function invert3x3 (from: Matrix, to: Matrix) {\n  const A = from.data\n  const invA = to.data\n  const t1 = A[4]\n  const t2 = A[8]\n  const t4 = A[5]\n  const t5 = A[7]\n  const t8 = A[0]\n\n  const t9 = t8 * t1\n  const t11 = t8 * t4\n  const t13 = A[3]\n  const t14 = A[1]\n  const t15 = t13 * t14\n  const t17 = A[2]\n  const t18 = t13 * t17\n  const t20 = A[6]\n  const t21 = t20 * t14\n  const t23 = t20 * t17\n  const t26 = 1.0 / (t9 * t2 - t11 * t5 - t15 * t2 + t18 * t5 + t21 * t4 - t23 * t1)\n  invA[0] = (t1 * t2 - t4 * t5) * t26\n  invA[1] = -(t14 * t2 - t17 * t5) * t26\n  invA[2] = -(-t14 * t4 + t17 * t1) * t26\n  invA[3] = -(t13 * t2 - t4 * t20) * t26\n  invA[4] = (t8 * t2 - t23) * t26\n  invA[5] = -(t11 - t18) * t26\n  invA[6] = -(-t13 * t5 + t1 * t20) * t26\n  invA[7] = -(t8 * t5 - t21) * t26\n  invA[8] = (t9 - t15) * t26\n}\n\nexport function mat3x3determinant (M: Matrix) {\n  const md = M.data\n  return md[0] * md[4] * md[8] -\n    md[0] * md[5] * md[7] -\n    md[3] * md[1] * md[8] +\n    md[3] * md[2] * md[7] +\n    md[6] * md[1] * md[5] -\n    md[6] * md[2] * md[4]\n}\n\n// C = A * B\nexport function multiply3x3 (C: Matrix, A: Matrix, B: Matrix) {\n  const Cd = C.data\n  const Ad = A.data\n  const Bd = B.data\n  const m10 = Ad[0]\n  const m11 = Ad[1]\n  const m12 = Ad[2]\n  const m13 = Ad[3]\n  const m14 = Ad[4]\n  const m15 = Ad[5]\n  const m16 = Ad[6]\n  const m17 = Ad[7]\n  const m18 = Ad[8]\n\n  const m20 = Bd[0]\n  const m21 = Bd[1]\n  const m22 = Bd[2]\n  const m23 = Bd[3]\n  const m24 = Bd[4]\n  const m25 = Bd[5]\n  const m26 = Bd[6]\n  const m27 = Bd[7]\n  const m28 = Bd[8]\n\n  Cd[0] = m10 * m20 + m11 * m23 + m12 * m26\n  Cd[1] = m10 * m21 + m11 * m24 + m12 * m27\n  Cd[2] = m10 * m22 + m11 * m25 + m12 * m28\n  Cd[3] = m13 * m20 + m14 * m23 + m15 * m26\n  Cd[4] = m13 * m21 + m14 * m24 + m15 * m27\n  Cd[5] = m13 * m22 + m14 * m25 + m15 * m28\n  Cd[6] = m16 * m20 + m17 * m23 + m18 * m26\n  Cd[7] = m16 * m21 + m17 * m24 + m18 * m27\n  Cd[8] = m16 * m22 + m17 * m25 + m18 * m28\n}\n\nexport function meanRows (A: Matrix) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n  const mean = new Array(ncols)\n\n  for (let j = 0; j < ncols; ++j) {\n    mean[ j ] = 0.0\n  }\n\n  for (let i = 0, p = 0; i < nrows; ++i) {\n    for (let j = 0; j < ncols; ++j, ++p) {\n      mean[ j ] += Ad[ p ]\n    }\n  }\n\n  for (let j = 0; j < ncols; ++j) {\n    mean[ j ] /= nrows\n  }\n\n  return mean\n}\n\nexport function meanCols (A: Matrix) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n  const mean = new Array(nrows)\n\n  for (let j = 0; j < nrows; ++j) {\n    mean[ j ] = 0.0\n  }\n\n  for (let i = 0, p = 0; i < ncols; ++i) {\n    for (let j = 0; j < nrows; ++j, ++p) {\n      mean[ j ] += Ad[ p ]\n    }\n  }\n\n  for (let j = 0; j < nrows; ++j) {\n    mean[ j ] /= ncols\n  }\n\n  return mean\n}\n\nexport function subRows (A: Matrix, row: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < nrows; ++i) {\n    for (let j = 0; j < ncols; ++j, ++p) {\n      Ad[ p ] -= row[ j ]\n    }\n  }\n}\n\nexport function subCols (A: Matrix, col: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < ncols; ++i) {\n    for (let j = 0; j < nrows; ++j, ++p) {\n      Ad[ p ] -= col[ j ]\n    }\n  }\n}\n\nexport function addRows (A: Matrix, row: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < nrows; ++i) {\n    for (let j = 0; j < ncols; ++j, ++p) {\n      Ad[ p ] += row[ j ]\n    }\n  }\n}\n\nexport function addCols (A: Matrix, col: number[]) {\n  const nrows = A.rows\n  const ncols = A.cols\n  const Ad = A.data\n\n  for (let i = 0, p = 0; i < ncols; ++i) {\n    for (let j = 0; j < nrows; ++j, ++p) {\n      Ad[ p ] += col[ j ]\n    }\n  }\n}\n\nexport function swap (A: NumberArray, i0: number, i1: number, t: number) {\n  t = A[i0]\n  A[i0] = A[i1]\n  A[i1] = t\n}\n\nexport function hypot (a: number, b: number) {\n  a = Math.abs(a)\n  b = Math.abs(b)\n  if (a > b) {\n    b /= a\n    return a * Math.sqrt(1.0 + b * b)\n  }\n  if (b > 0) {\n    a /= b\n    return b * Math.sqrt(1.0 + a * a)\n  }\n  return 0.0\n}\n\nconst EPSILON = 0.0000001192092896\nconst FLT_MIN = 1E-37\n\nexport function JacobiSVDImpl (At: NumberArray, astep: number, _W: NumberArray, Vt: NumberArray, vstep: number, m: number, n: number, n1: number) {\n  const eps = EPSILON * 2.0\n  const minval = FLT_MIN\n  let i = 0\n  let j = 0\n  let k = 0\n  let iter = 0\n  const maxIter = Math.max(m, 30)\n  let Ai = 0\n  let Aj = 0\n  let Vi = 0\n  let Vj = 0\n  let changed = 0\n  let c = 0.0\n  let s = 0.0\n  let t = 0.0\n  let t0 = 0.0\n  let t1 = 0.0\n  let sd = 0.0\n  let beta = 0.0\n  let gamma = 0.0\n  let delta = 0.0\n  let a = 0.0\n  let p = 0.0\n  let b = 0.0\n  let seed = 0x1234\n  let val = 0.0\n  let val0 = 0.0\n  let asum = 0.0\n\n  const W = new Float64Array(n << 3)\n\n  for (; i < n; i++) {\n    for (k = 0, sd = 0; k < m; k++) {\n      t = At[i * astep + k]\n      sd += t * t\n    }\n    W[i] = sd\n\n    if (Vt) {\n      for (k = 0; k < n; k++) {\n        Vt[i * vstep + k] = 0\n      }\n      Vt[i * vstep + i] = 1\n    }\n  }\n\n  for (; iter < maxIter; iter++) {\n    changed = 0\n\n    for (i = 0; i < n - 1; i++) {\n      for (j = i + 1; j < n; j++) {\n        Ai = (i * astep) | 0\n        Aj = (j * astep) | 0\n        a = W[i]\n        p = 0\n        b = W[j]\n\n        k = 2\n        p += At[Ai] * At[Aj]\n        p += At[Ai + 1] * At[Aj + 1]\n\n        for (; k < m; k++) { p += At[Ai + k] * At[Aj + k] }\n\n        if (Math.abs(p) <= eps * Math.sqrt(a * b)) continue\n\n        p *= 2.0\n        beta = a - b\n        gamma = hypot(p, beta)\n        if (beta < 0) {\n          delta = (gamma - beta) * 0.5\n          s = Math.sqrt(delta / gamma)\n          c = (p / (gamma * s * 2.0))\n        } else {\n          c = Math.sqrt((gamma + beta) / (gamma * 2.0))\n          s = (p / (gamma * c * 2.0))\n        }\n\n        a = 0.0\n        b = 0.0\n\n        k = 2 // unroll\n        t0 = c * At[Ai] + s * At[Aj]\n        t1 = -s * At[Ai] + c * At[Aj]\n        At[Ai] = t0; At[Aj] = t1\n        a += t0 * t0; b += t1 * t1\n\n        t0 = c * At[Ai + 1] + s * At[Aj + 1]\n        t1 = -s * At[Ai + 1] + c * At[Aj + 1]\n        At[Ai + 1] = t0; At[Aj + 1] = t1\n        a += t0 * t0; b += t1 * t1\n\n        for (; k < m; k++) {\n          t0 = c * At[Ai + k] + s * At[Aj + k]\n          t1 = -s * At[Ai + k] + c * At[Aj + k]\n          At[Ai + k] = t0; At[Aj + k] = t1\n\n          a += t0 * t0; b += t1 * t1\n        }\n\n        W[i] = a\n        W[j] = b\n\n        changed = 1\n\n        if (Vt) {\n          Vi = (i * vstep) | 0\n          Vj = (j * vstep) | 0\n\n          k = 2\n          t0 = c * Vt[Vi] + s * Vt[Vj]\n          t1 = -s * Vt[Vi] + c * Vt[Vj]\n          Vt[Vi] = t0; Vt[Vj] = t1\n\n          t0 = c * Vt[Vi + 1] + s * Vt[Vj + 1]\n          t1 = -s * Vt[Vi + 1] + c * Vt[Vj + 1]\n          Vt[Vi + 1] = t0; Vt[Vj + 1] = t1\n\n          for (; k < n; k++) {\n            t0 = c * Vt[Vi + k] + s * Vt[Vj + k]\n            t1 = -s * Vt[Vi + k] + c * Vt[Vj + k]\n            Vt[Vi + k] = t0; Vt[Vj + k] = t1\n          }\n        }\n      }\n    }\n    if (changed === 0) break\n  }\n\n  for (i = 0; i < n; i++) {\n    for (k = 0, sd = 0; k < m; k++) {\n      t = At[i * astep + k]\n      sd += t * t\n    }\n    W[i] = Math.sqrt(sd)\n  }\n\n  for (i = 0; i < n - 1; i++) {\n    j = i\n    for (k = i + 1; k < n; k++) {\n      if (W[j] < W[k]) { j = k }\n    }\n    if (i !== j) {\n      swap(W, i, j, sd)\n      if (Vt) {\n        for (k = 0; k < m; k++) {\n          swap(At, i * astep + k, j * astep + k, t)\n        }\n\n        for (k = 0; k < n; k++) {\n          swap(Vt, i * vstep + k, j * vstep + k, t)\n        }\n      }\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    _W[i] = W[i]\n  }\n\n  if (!Vt) {\n    return\n  }\n\n  for (i = 0; i < n1; i++) {\n    sd = i < n ? W[i] : 0\n\n    while (sd <= minval) {\n      // if we got a zero singular value, then in order to get the corresponding left singular vector\n      // we generate a random vector, project it to the previously computed left singular vectors,\n      // subtract the projection and normalize the difference.\n      val0 = (1.0 / m)\n      for (k = 0; k < m; k++) {\n        seed = (seed * 214013 + 2531011)\n        val = (((seed >> 16) & 0x7fff) & 256) !== 0 ? val0 : -val0\n        At[i * astep + k] = val\n      }\n      for (iter = 0; iter < 2; iter++) {\n        for (j = 0; j < i; j++) {\n          sd = 0\n          for (k = 0; k < m; k++) {\n            sd += At[i * astep + k] * At[j * astep + k]\n          }\n          asum = 0.0\n          for (k = 0; k < m; k++) {\n            t = (At[i * astep + k] - sd * At[j * astep + k])\n            At[i * astep + k] = t\n            asum += Math.abs(t)\n          }\n          asum = asum ? 1.0 / asum : 0\n          for (k = 0; k < m; k++) {\n            At[i * astep + k] *= asum\n          }\n        }\n      }\n      sd = 0\n      for (k = 0; k < m; k++) {\n        t = At[i * astep + k]\n        sd += t * t\n      }\n      sd = Math.sqrt(sd)\n    }\n\n    s = (1.0 / sd)\n    for (k = 0; k < m; k++) {\n      At[i * astep + k] *= s\n    }\n  }\n}\n\nexport function svd (A: Matrix, W: Matrix, U: Matrix, V: Matrix) {\n  let at = 0\n  let i = 0\n  const _m = A.rows\n  const _n = A.cols\n  let m = _m\n  let n = _n\n\n  if (m < n) {\n    at = 1\n    i = m\n    m = n\n    n = i\n  }\n\n  const amt = new Matrix(m, m)\n  const wmt = new Matrix(1, n)\n  const vmt = new Matrix(n, n)\n\n  if (at === 0) {\n    transpose(amt, A)\n  } else {\n    for (i = 0; i < _n * _m; i++) {\n      amt.data[i] = A.data[i]\n    }\n    for (; i < n * m; i++) {\n      amt.data[i] = 0\n    }\n  }\n\n  JacobiSVDImpl(amt.data, m, wmt.data, vmt.data, n, m, n, m)\n\n  if (W) {\n    for (i = 0; i < n; i++) {\n      W.data[i] = wmt.data[i]\n    }\n    for (; i < _n; i++) {\n      W.data[i] = 0\n    }\n  }\n\n  if (at === 0) {\n    if (U) transpose(U, amt)\n    if (V) transpose(V, vmt)\n  } else {\n    if (U) transpose(U, vmt)\n    if (V) transpose(V, amt)\n  }\n}\n\n//\n\nexport function m4new () {\n  return new Float32Array([\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n  ])\n}\n\nexport function m4set (out: Float32Array, n11: number, n12: number, n13: number, n14: number, n21: number, n22: number, n23: number, n24: number, n31: number, n32: number, n33: number, n34: number, n41: number, n42: number, n43: number, n44: number) {\n  out[ 0 ] = n11; out[ 4 ] = n12; out[ 8 ] = n13; out[ 12 ] = n14\n  out[ 1 ] = n21; out[ 5 ] = n22; out[ 9 ] = n23; out[ 13 ] = n24\n  out[ 2 ] = n31; out[ 6 ] = n32; out[ 10 ] = n33; out[ 14 ] = n34\n  out[ 3 ] = n41; out[ 7 ] = n42; out[ 11 ] = n43; out[ 15 ] = n44\n}\n\nexport function m4identity (out: Float32Array) {\n  m4set(out,\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n  )\n}\n(m4identity as any).__deps = [ m4set ]\n\nexport function m4multiply (out: Float32Array, a: Float32Array, b: Float32Array) {\n  const a11 = a[ 0 ]\n  const a12 = a[ 4 ]\n  const a13 = a[ 8 ]\n  const a14 = a[ 12 ]\n  const a21 = a[ 1 ]\n  const a22 = a[ 5 ]\n  const a23 = a[ 9 ]\n  const a24 = a[ 13 ]\n  const a31 = a[ 2 ]\n  const a32 = a[ 6 ]\n  const a33 = a[ 10 ]\n  const a34 = a[ 14 ]\n  const a41 = a[ 3 ]\n  const a42 = a[ 7 ]\n  const a43 = a[ 11 ]\n  const a44 = a[ 15 ]\n\n  const b11 = b[ 0 ]\n  const b12 = b[ 4 ]\n  const b13 = b[ 8 ]\n  const b14 = b[ 12 ]\n  const b21 = b[ 1 ]\n  const b22 = b[ 5 ]\n  const b23 = b[ 9 ]\n  const b24 = b[ 13 ]\n  const b31 = b[ 2 ]\n  const b32 = b[ 6 ]\n  const b33 = b[ 10 ]\n  const b34 = b[ 14 ]\n  const b41 = b[ 3 ]\n  const b42 = b[ 7 ]\n  const b43 = b[ 11 ]\n  const b44 = b[ 15 ]\n\n  out[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41\n  out[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42\n  out[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43\n  out[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44\n\n  out[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41\n  out[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42\n  out[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43\n  out[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44\n\n  out[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41\n  out[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42\n  out[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43\n  out[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44\n\n  out[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41\n  out[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42\n  out[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43\n  out[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44\n}\n\nexport function m4makeScale (out: Float32Array, x: number, y: number, z: number) {\n  m4set(out,\n    x, 0, 0, 0,\n    0, y, 0, 0,\n    0, 0, z, 0,\n    0, 0, 0, 1\n  )\n}\n(m4makeScale as any).__deps = [ m4set ]\n\nexport function m4makeTranslation (out: Float32Array, x: number, y: number, z: number) {\n  m4set(out,\n    1, 0, 0, x,\n    0, 1, 0, y,\n    0, 0, 1, z,\n    0, 0, 0, 1\n  )\n}\n(m4makeTranslation as any).__deps = [ m4set ]\n\nexport function m4makeRotationY (out: Float32Array, theta: number) {\n  const c = Math.cos(theta)\n  const s = Math.sin(theta)\n  m4set(out,\n    c, 0, s, 0,\n    0, 1, 0, 0,\n    -s, 0, c, 0,\n    0, 0, 0, 1\n  )\n}\n(m4makeRotationY as any).__deps = [ m4set ]\n\n//\n\nexport function m3new () {\n  return new Float32Array([\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1\n  ])\n}\n\nexport function m3makeNormal (out: Float32Array, m4: Float32Array) {\n  const r0 = v3new([ m4[0], m4[1], m4[2] ])\n  const r1 = v3new([ m4[4], m4[5], m4[6] ])\n  const r2 = v3new([ m4[8], m4[9], m4[10] ])\n  const cp = v3new()\n  //        [ r0 ]       [ r1 x r2 ]\n  // M3x3 = [ r1 ]   N = [ r2 x r0 ]\n  //        [ r2 ]       [ r0 x r1 ]\n  v3cross(cp, r1, r2)\n  out[ 0 ] = cp[ 0 ]\n  out[ 1 ] = cp[ 1 ]\n  out[ 2 ] = cp[ 2 ]\n  v3cross(cp, r2, r0)\n  out[ 3 ] = cp[ 0 ]\n  out[ 4 ] = cp[ 1 ]\n  out[ 5 ] = cp[ 2 ]\n  v3cross(cp, r0, r1)\n  out[ 6 ] = cp[ 0 ]\n  out[ 7 ] = cp[ 1 ]\n  out[ 8 ] = cp[ 2 ]\n}\n(m3makeNormal as any).__deps = [ v3new, v3cross ]\n","/**\n * @file Surface Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { degToRad } from '../math/math-utils'\nimport {\n  m4new, m4multiply, m4makeTranslation, m4makeScale, m4makeRotationY\n} from '../math/matrix-utils'\nimport {\n  v3addScalar, v3subScalar, v3divideScalar, v3multiplyScalar,\n  v3floor, v3ceil, v3sub, v3negate,\n  v3cross, v3fromArray, normalizeVector3array\n} from '../math/vector-utils'\nimport { NumberArray } from '../types'\n\nfunction laplacianSmooth (verts: Float32Array, faces: Float32Array, numiter: number, inflate: boolean) {\n  // based on D. Xu, Y. Zhang (2009) Generating Triangulated Macromolecular\n  // Surfaces by Euclidean Distance Transform. PLoS ONE 4(12): e8140.\n  //\n  // Permission to use, copy, modify, and distribute this program for\n  // any purpose, with or without fee, is hereby granted, provided that\n  // the notices on the head, the reference information, and this\n  // copyright notice appear in all copies or substantial portions of\n  // the Software. It is provided \"as is\" without express or implied\n  // warranty.\n  //\n  // ported to JavaScript and adapted to NGL by Alexander Rose\n\n  numiter = numiter || 1\n  inflate = inflate || true\n\n  const nv = verts.length / 3\n  const nf = faces.length / 3\n  let norms: Float32Array | undefined = undefined\n\n  if (inflate) {\n    norms = new Float32Array(nv * 3)\n  }\n\n  const tps = new Float32Array(nv * 3)\n\n  let i\n  const ndeg = 20\n  const vertdeg = new Array(ndeg)\n\n  for (i = 0; i < ndeg; ++i) {\n    vertdeg[ i ] = new Uint32Array(nv)\n  }\n\n  for (i = 0; i < nv; ++i) {\n    vertdeg[ 0 ][ i ] = 0\n  }\n\n  let j, jl\n  let flagvert: boolean\n\n  // for each face\n\n  for (i = 0; i < nf; ++i) {\n    var ao = i * 3\n    var bo = i * 3 + 1\n    var co = i * 3 + 2\n\n    // vertex a\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ao] ]; j < jl; ++j) {\n      if (faces[ bo ] === vertdeg[ j + 1 ][ faces[ ao ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ ao ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ ao ] ] ][ faces[ ao ] ] = faces[ bo ]\n    }\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ ao ] ]; j < jl; ++j) {\n      if (faces[ co ] === vertdeg[ j + 1 ][ faces[ ao ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ ao ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ ao ] ] ][ faces[ ao ] ] = faces[ co ]\n    }\n\n    // vertex b\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ bo ] ]; j < jl; ++j) {\n      if (faces[ ao ] === vertdeg[ j + 1 ][ faces[ bo ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ bo ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ bo ] ] ][ faces[ bo ] ] = faces[ ao ]\n    }\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ bo ] ]; j < jl; ++j) {\n      if (faces[ co ] === vertdeg[ j + 1 ][ faces[ bo ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ bo ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ bo ] ] ][ faces[ bo ] ] = faces[ co ]\n    }\n\n    // vertex c\n\n    flagvert = true\n    for (j = 0; j < vertdeg[ 0 ][ faces[ co ] ]; ++j) {\n      if (faces[ ao ] === vertdeg[ j + 1 ][ faces[ co ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ co ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ co ] ] ][ faces[ co ] ] = faces[ ao ]\n    }\n\n    flagvert = true\n    for (j = 0, jl = vertdeg[ 0 ][ faces[ co ] ]; j < jl; ++j) {\n      if (faces[ bo ] === vertdeg[ j + 1 ][ faces[ co ] ]) {\n        flagvert = false\n        break\n      }\n    }\n    if (flagvert) {\n      vertdeg[ 0 ][ faces[ co ] ]++\n      vertdeg[ vertdeg[ 0 ][ faces[ co ] ] ][ faces[ co ] ] = faces[ bo ]\n    }\n  }\n\n  var wt = 1.0\n  var wt2 = 0.5\n  var i3, vi3, vdi, wtvi, wt2vi\n  var ssign = -1\n  var scaleFactor = 1\n  var outwt = 0.75 / (scaleFactor + 3.5) // area-preserving\n\n  // smoothing iterations\n\n  for (var k = 0; k < numiter; ++k) {\n    // for each vertex\n\n    for (i = 0; i < nv; ++i) {\n      i3 = i * 3\n      vdi = vertdeg[ 0 ][ i ]\n\n      if (vdi < 3) {\n        tps[ i3 ] = verts[ i3 ]\n        tps[ i3 + 1 ] = verts[ i3 + 1 ]\n        tps[ i3 + 2 ] = verts[ i3 + 2 ]\n      } else if (vdi === 3 || vdi === 4) {\n        tps[ i3 ] = 0\n        tps[ i3 + 1 ] = 0\n        tps[ i3 + 2 ] = 0\n\n        for (j = 0; j < vdi; ++j) {\n          vi3 = vertdeg[ j + 1 ][ i ] * 3\n          tps[ i3 ] += verts[ vi3 ]\n          tps[ i3 + 1 ] += verts[ vi3 + 1 ]\n          tps[ i3 + 2 ] += verts[ vi3 + 2 ]\n        }\n\n        tps[ i3 ] += wt2 * verts[ i3 ]\n        tps[ i3 + 1 ] += wt2 * verts[ i3 + 1 ]\n        tps[ i3 + 2 ] += wt2 * verts[ i3 + 2 ]\n\n        wt2vi = wt2 + vdi\n        tps[ i3 ] /= wt2vi\n        tps[ i3 + 1 ] /= wt2vi\n        tps[ i3 + 2 ] /= wt2vi\n      } else {\n        tps[ i3 ] = 0\n        tps[ i3 + 1 ] = 0\n        tps[ i3 + 2 ] = 0\n\n        for (j = 0; j < vdi; ++j) {\n          vi3 = vertdeg[ j + 1 ][ i ] * 3\n          tps[ i3 ] += verts[ vi3 ]\n          tps[ i3 + 1 ] += verts[ vi3 + 1 ]\n          tps[ i3 + 2 ] += verts[ vi3 + 2 ]\n        }\n\n        tps[ i3 ] += wt * verts[ i3 ]\n        tps[ i3 + 1 ] += wt * verts[ i3 + 1 ]\n        tps[ i3 + 2 ] += wt * verts[ i3 + 2 ]\n\n        wtvi = wt + vdi\n        tps[ i3 ] /= wtvi\n        tps[ i3 + 1 ] /= wtvi\n        tps[ i3 + 2 ] /= wtvi\n      }\n    }\n\n    verts.set(tps) // copy smoothed positions\n\n    if (inflate) {\n      computeVertexNormals(verts, faces, norms)\n      var nv3 = nv * 3\n\n      for (i3 = 0; i3 < nv3; i3 += 3) {\n        // if(verts[i].inout) ssign=1;\n        // else ssign=-1;\n\n        verts[ i3 ] += ssign * outwt * norms![ i3 ]\n        verts[ i3 + 1 ] += ssign * outwt * norms![ i3 + 1 ]\n        verts[ i3 + 2 ] += ssign * outwt * norms![ i3 + 2 ]\n      }\n    }\n  }\n}\nObject.assign(laplacianSmooth, {__deps: [ computeVertexNormals ]})\n\nfunction computeVertexNormals (position: Float32Array, index?: NumberArray, normal?: Float32Array) {\n  var i, il\n\n  if (normal === undefined) {\n    normal = new Float32Array(position.length)\n  } else {\n    // reset existing normals to zero\n    for (i = 0, il = normal.length; i < il; i++) {\n      normal[ i ] = 0\n    }\n  }\n\n  var a = new Float32Array(3)\n  var b = new Float32Array(3)\n  var c = new Float32Array(3)\n  var cb = new Float32Array(3)\n  var ab = new Float32Array(3)\n\n  if (index) {\n    // indexed elements\n    for (i = 0, il = index.length; i < il; i += 3) {\n      var ai = index[ i ] * 3\n      var bi = index[ i + 1 ] * 3\n      var ci = index[ i + 2 ] * 3\n\n      v3fromArray(a, position, ai)\n      v3fromArray(b, position, bi)\n      v3fromArray(c, position, ci)\n\n      v3sub(cb, c, b)\n      v3sub(ab, a, b)\n      v3cross(cb, cb, ab)\n\n      normal[ ai ] += cb[ 0 ]\n      normal[ ai + 1 ] += cb[ 1 ]\n      normal[ ai + 2 ] += cb[ 2 ]\n\n      normal[ bi ] += cb[ 0 ]\n      normal[ bi + 1 ] += cb[ 1 ]\n      normal[ bi + 2 ] += cb[ 2 ]\n\n      normal[ ci ] += cb[ 0 ]\n      normal[ ci + 1 ] += cb[ 1 ]\n      normal[ ci + 2 ] += cb[ 2 ]\n    }\n  } else {\n    // non-indexed elements (unconnected triangle soup)\n    for (i = 0, il = position.length; i < il; i += 9) {\n      v3fromArray(a, position, i)\n      v3fromArray(b, position, i + 3)\n      v3fromArray(c, position, i + 6)\n\n      v3sub(cb, c, b)\n      v3sub(ab, a, b)\n      v3cross(cb, cb, ab)\n\n      normal[ i ] = cb[ 0 ]\n      normal[ i + 1 ] = cb[ 1 ]\n      normal[ i + 2 ] = cb[ 2 ]\n\n      normal[ i + 3 ] = cb[ 0 ]\n      normal[ i + 4 ] = cb[ 1 ]\n      normal[ i + 5 ] = cb[ 2 ]\n\n      normal[ i + 6 ] = cb[ 0 ]\n      normal[ i + 7 ] = cb[ 1 ]\n      normal[ i + 8 ] = cb[ 2 ]\n    }\n  }\n\n  normalizeVector3array(normal)\n\n  return normal\n}\nObject.assign(computeVertexNormals, {__deps: [\n  v3sub, v3cross, v3fromArray, normalizeVector3array\n]})\n\nfunction getRadiusDict (radiusList: number[]) {\n  var radiusDict: {[k: number]: boolean} = {}\n  for (var i = 0, il = radiusList.length; i < il; ++i) {\n    radiusDict[ radiusList[ i ] ] = true\n  }\n  return radiusDict\n}\n\nfunction getSurfaceGrid (min: Float32Array, max: Float32Array, maxRadius: number, scaleFactor: number, extraMargin: number) {\n  // need margin to avoid boundary/round off effects\n  var margin = (1 / scaleFactor) * 3\n  margin += maxRadius\n\n  v3subScalar(min, min, extraMargin + margin)\n  v3addScalar(max, max, extraMargin + margin)\n\n  v3multiplyScalar(min, min, scaleFactor)\n  v3floor(min, min)\n  v3divideScalar(min, min, scaleFactor)\n\n  v3multiplyScalar(max, max, scaleFactor)\n  v3ceil(max, max)\n  v3divideScalar(max, max, scaleFactor)\n\n  var dim = new Float32Array(3)\n  v3sub(dim, max, min)\n  v3multiplyScalar(dim, dim, scaleFactor)\n  v3ceil(dim, dim)\n  v3addScalar(dim, dim, 1)\n\n  var maxSize = Math.pow(10, 6) * 256\n  var tmpSize = dim[ 0 ] * dim[ 1 ] * dim[ 2 ] * 3\n\n  if (maxSize <= tmpSize) {\n    scaleFactor *= Math.pow(maxSize / tmpSize, 1 / 3)\n\n    v3multiplyScalar(min, min, scaleFactor)\n    v3floor(min, min)\n    v3divideScalar(min, min, scaleFactor)\n\n    v3multiplyScalar(max, max, scaleFactor)\n    v3ceil(max, max)\n    v3divideScalar(max, max, scaleFactor)\n\n    v3sub(dim, max, min)\n    v3multiplyScalar(dim, dim, scaleFactor)\n    v3ceil(dim, dim)\n    v3addScalar(dim, dim, 1)\n  }\n\n  var tran = new Float32Array(min)\n  v3negate(tran, tran)\n\n  // coordinate transformation matrix\n  var matrix = m4new()\n  var mroty = m4new()\n  m4makeRotationY(mroty, degToRad(90))\n  m4multiply(matrix, matrix, mroty)\n\n  var mscale = m4new()\n  m4makeScale(\n    mscale,\n    -1 / scaleFactor,\n    1 / scaleFactor,\n    1 / scaleFactor\n  )\n  m4multiply(matrix, matrix, mscale)\n\n  var mtrans = m4new()\n  m4makeTranslation(\n    mtrans,\n    -scaleFactor * tran[2],\n    -scaleFactor * tran[1],\n    -scaleFactor * tran[0]\n  )\n  m4multiply(matrix, matrix, mtrans)\n\n  return {\n    dim: dim,\n    tran: tran,\n    matrix: matrix,\n    scaleFactor: scaleFactor\n  }\n}\nObject.assign(getSurfaceGrid, {'__deps': [\n  degToRad,\n  v3subScalar, v3addScalar, v3divideScalar, v3multiplyScalar,\n  v3floor, v3ceil, v3sub, v3negate,\n  m4new, m4multiply, m4makeTranslation, m4makeScale, m4makeRotationY\n]})\n\nexport {\n  laplacianSmooth,\n  computeVertexNormals,\n  getRadiusDict,\n  getSurfaceGrid\n}\n","/**\n * @file Surface\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3, Geometry, BufferGeometry, Group, Color } from 'three'\n\nimport { Debug, Log, ColormakerRegistry } from '../globals'\nimport { getUintArray } from '../utils'\nimport { AtomPicker, SurfacePicker } from '../utils/picker'\nimport { uniformArray, uniformArray3, serialArray } from '../math/array-utils'\nimport Selection from '../selection/selection'\nimport { ColormakerParameters } from '../color/colormaker';\nimport { Structure, Volume } from '../ngl';\n\nexport interface SurfaceData {\n  position: Float32Array\n  index: Uint32Array|Uint16Array|undefined\n  normal: Float32Array\n  color: Float32Array\n  atomindex: Int32Array\n  contour: boolean\n}\n/**\n * Surface\n */\nclass Surface {\n  name: string\n  path: string\n  position: Float32Array\n  index: Uint32Array|Uint16Array|undefined\n  normal: Float32Array|undefined\n  color: Float32Array|undefined\n  atomindex: Int32Array|undefined\n  contour: boolean\n  center: Vector3\n  boundingBox: Box3\n  size: number\n  info: {\n    type?: string\n    probeRadius?: number\n    scaleFactor?: number\n    smooth?: number\n    cutoff?: number\n    isolevel?: number\n    volume?: Volume\n  }\n\n  /**\n   * @param {String} name - surface name\n   * @param {String} path - source path\n   * @param {Object} data - surface data\n   * @param {Float32Array} data.position - surface positions\n   * @param {Int32Array} data.index - surface indices\n   * @param {Float32Array} data.normal - surface normals\n   * @param {Float32Array} data.color - surface colors\n   * @param {Int32Array} data.atomindex - atom indices\n   * @param {boolean} data.contour - contour mode flag\n   */\n  constructor (name: string, path: string, data?: SurfaceData) {\n    this.name = name || ''\n    this.path = path || ''\n    this.info = {}\n\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    if (data instanceof Geometry ||\n      data instanceof BufferGeometry ||\n      data instanceof Group\n    ) {\n      // to be removed\n      this.fromGeometry(data)\n    } else if (data) {\n      this.set(\n        data.position,\n        data.index,\n        data.normal,\n        data.color,\n        data.atomindex,\n        data.contour\n      )\n\n      this.boundingBox.setFromArray(data.position)\n      this.boundingBox.getCenter(this.center)\n    }\n  }\n\n  get type () { return 'Surface' }\n\n  /**\n   * set surface data\n   * @param {Float32Array} position - surface positions\n   * @param {Int32Array} index - surface indices\n   * @param {Float32Array} normal - surface normals\n   * @param {Float32Array} color - surface colors\n   * @param {Int32Array} atomindex - atom indices\n   * @param {boolean} contour - contour mode flag\n   * @return {undefined}\n   */\n  set (position: Float32Array,\n      index: Uint32Array|Uint16Array|undefined,\n      normal: Float32Array|undefined,\n      color: Float32Array|undefined,\n      atomindex: Int32Array|undefined,\n      contour: boolean = false) {\n    /**\n     * @type {Float32Array}\n     */\n    this.position = position\n    /**\n     * @type {Uint32Array|Uint16Array|undefined}\n     */\n    this.index = index\n    /**\n     * @type {Float32Array|undefined}\n     */\n    this.normal = normal\n    /**\n     * @type {Float32Array|undefined}\n     */\n    this.color = color\n    /**\n     * @type {Int32Array|undefined}\n     */\n    this.atomindex = atomindex\n\n    this.size = position.length / 3\n    this.contour = contour\n  }\n\n  fromGeometry (geometry: Geometry|BufferGeometry|Group) {\n    if (Debug) Log.time('GeometrySurface.fromGeometry')\n\n    let geo\n\n    if (geometry instanceof Geometry) {\n      geometry.computeVertexNormals(true)\n      geo = new BufferGeometry().fromGeometry(geometry)\n    } else if (geometry instanceof BufferGeometry) {\n      geo = geometry\n    } else {\n      geo = (geometry as any)[ 0 ]\n    }\n\n    if (!geo.boundingBox) geo.computeBoundingBox()\n\n    this.boundingBox.copy(geo.boundingBox)\n    this.boundingBox.getCenter(this.center)\n\n    let position, color, index, normal\n\n    if (geo instanceof BufferGeometry) {\n      const attr = geo.attributes\n      const an = (attr as any).normal ? (attr as any).normal.array : false\n\n      // assume there are no normals if the first is zero\n      if (!an || (an[ 0 ] === 0 && an[ 1 ] === 0 && an[ 2 ] === 0)) {\n        geo.computeVertexNormals()\n      }\n\n      position = (<any>attr).position.array\n      index = (<any>attr).index ? (<any>attr).index.array : null\n      normal = (<any>attr).normal.array\n    }\n\n    this.set(position, index, normal, color, undefined)\n\n    if (Debug) Log.timeEnd('GeometrySurface.setGeometry')\n  }\n\n  getPosition () {\n    return this.position\n  }\n\n  getColor (params: ColormakerParameters&{ scheme: string}) {\n    const p = params || {}\n    p.surface = this\n\n    const n = this.size\n    const array = new Float32Array(n * 3)\n    const colormaker = ColormakerRegistry.getScheme(p)\n\n    if (colormaker.volumeColor || p.scheme === 'random') {\n      for (let i = 0; i < n; ++i) {\n        colormaker.volumeColorToArray(i, array, i * 3)\n      }\n    } else if (colormaker.positionColor) {\n      const v = new Vector3()\n      const pos = this.position\n\n      for (let i = 0; i < n; ++i) {\n        var i3 = i * 3\n        v.set(pos[ i3 ], pos[ i3 + 1 ], pos[ i3 + 2 ])\n        colormaker.positionColorToArray(v, array, i3)\n      }\n    } else if (colormaker.atomColor && this.atomindex) {\n      const atomProxy = p.structure!.getAtomProxy()\n      const atomindex = this.atomindex\n\n      for (let i = 0; i < n; ++i) {\n        atomProxy.index = atomindex[ i ]\n        colormaker.atomColorToArray(atomProxy, array, i * 3)\n      }\n    } else {\n      const tc = new Color(p.value)\n      uniformArray3(n, tc.r, tc.g, tc.b, array)\n    }\n\n    return array\n  }\n\n  getPicking (structure?: Structure) {\n    if (this.atomindex && structure) {\n      return new AtomPicker(this.atomindex as any, structure)\n    } else {\n      return new SurfacePicker(serialArray(this.size), this)\n    }\n  }\n\n  getNormal () {\n    return this.normal\n  }\n\n  getSize (size: number, scale: number) {\n    return uniformArray(this.size, size * scale)\n  }\n\n  getIndex () {\n    return this.index\n  }\n\n  getFilteredIndex (sele: string, structure: Structure) {\n    if (sele && this.atomindex) {\n      const selection = new Selection(sele)\n      const atomSet = structure.getAtomSet(selection)\n      const filteredIndex = []\n\n      const atomindex = this.atomindex\n      const index = this.index\n      const n = index!.length\n      const elementSize = this.contour ? 2 : 3\n\n      let j = 0\n\n      for (let i = 0; i < n; i += elementSize) {\n        let include = true\n\n        for (let a = 0; a < elementSize; a++) {\n          const idx = index![ i + a ]\n          const ai = atomindex[ idx ]\n          if (!atomSet.get(ai)) {\n            include = false\n            break\n          }\n        }\n\n        if (!include) { continue }\n\n        for (let a = 0; a < elementSize; a++, j++) {\n          filteredIndex[ j ] = index![ i + a ]\n        }\n      }\n\n      return getUintArray(filteredIndex, this.position.length / 3)\n    } else {\n      return this.index\n    }\n  }\n\n  getAtomindex () {\n    return this.atomindex\n  }\n\n  dispose () {\n\n    //\n\n  }\n}\n\nexport default Surface\n","/**\n * @file Volume\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3, Matrix3, Matrix4 } from 'three'\n\nimport { WorkerRegistry, ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport WorkerPool from '../worker/worker-pool'\nimport { VolumePicker } from '../utils/picker'\nimport {\n  uniformArray, serialArray,\n  arrayMin, arrayMax, arraySum, arrayMean, arrayRms\n} from '../math/array-utils'\nimport MarchingCubes from './marching-cubes'\nimport { laplacianSmooth, computeVertexNormals } from './surface-utils'\nimport {\n  applyMatrix4toVector3array, applyMatrix3toVector3array\n} from '../math/vector-utils'\nimport { m3new, m3makeNormal } from '../math/matrix-utils'\nimport Surface from './surface'\nimport { NumberArray } from '../types';\nimport { ColormakerParameters } from '../color/colormaker';\n\nexport interface VolumeSurface {\n  new (data: NumberArray, nx: number, ny: number, nz: number, atomindex: NumberArray): void\n  getSurface: (isolevel: number, smooth: boolean|number, box: number[][]|undefined, matrix: Float32Array, contour: boolean, wrap?: boolean) => {\n    position: Float32Array\n    normal: undefined|Float32Array\n    index: Uint32Array|Uint16Array\n    atomindex: Int32Array|undefined\n    contour: boolean\n  }\n}\nexport function VolumeSurface (this: VolumeSurface,data: NumberArray, nx: number, ny: number, nz: number, atomindex: NumberArray) {\n  var mc = new (MarchingCubes as any)(data, nx, ny, nz, atomindex) as MarchingCubes\n\n  function getSurface (isolevel: number, smooth: boolean|number, box: number[][]|undefined, matrix: Float32Array, contour: boolean, wrap: boolean = false) {\n    const sd = mc.triangulate(isolevel, smooth as boolean, box, contour, wrap)\n    if (smooth && !contour) {\n      laplacianSmooth(sd.position, sd.index as any, smooth as number, true)\n      sd.normal = computeVertexNormals(sd.position, sd.index as any)\n    }\n    if (matrix) {\n      applyMatrix4toVector3array(matrix, sd.position)\n      if (sd.normal) {\n        const normalMatrix = m3new()\n        m3makeNormal(normalMatrix, matrix)\n        applyMatrix3toVector3array(normalMatrix, sd.normal)\n      }\n    }\n    return sd\n  }\n\n  this.getSurface = getSurface\n}\nObject.assign(VolumeSurface, {__deps: [\n  laplacianSmooth, computeVertexNormals, MarchingCubes,\n  applyMatrix4toVector3array, applyMatrix3toVector3array,\n  m3new, m3makeNormal\n]})\n\nWorkerRegistry.add('surf', function func (e: any, callback: (data: any, transferList: any) => void) {\n  const a = e.data.args\n  const p = e.data.params\n  if (a) {\n    /* global self */\n    (self as any).volsurf = new (VolumeSurface as any)(a[0], a[1], a[2], a[3], a[4]) as VolumeSurface\n  }\n  if (p) {\n    const sd = ((self as any).volsurf as VolumeSurface).getSurface(\n      p.isolevel, p.smooth, p.box, p.matrix, p.contour, p.wrap\n    )\n    const transferList = [ sd.position.buffer, sd.index.buffer ]\n    if (sd.normal) transferList.push(sd.normal.buffer)\n    if (sd.atomindex) transferList.push(sd.atomindex.buffer)\n    const data = {\n      sd: sd,\n      p: p\n    }\n    callback(data, transferList)\n  }\n}, [ VolumeSurface ])\n\nexport type VolumeSize = 'value'|'abs-value'|'value-min'|'deviation'\n/**\n * Volume\n */\nclass Volume {\n  name: string\n  path: string\n\n  matrix: Matrix4\n  normalMatrix: Matrix3\n  inverseMatrix: Matrix4\n  center: Vector3\n  boundingBox: Box3\n\n  nx: number\n  ny: number\n  nz: number\n  data: Float32Array\n\n  worker: Worker\n  workerPool: WorkerPool\n  _position: Float32Array\n  _min: number|undefined\n  _max: number|undefined\n  _mean: number|undefined\n  _rms: number|undefined\n  _sum: number|undefined\n  __box: Box3|undefined\n\n  atomindex: Int32Array|undefined\n  volsurf: VolumeSurface|undefined\n  header: any\n  /**\n   * Make Volume instance\n   * @param {String} name - volume name\n   * @param {String} path - source path\n   * @param {Float32array} data - volume 3d grid\n   * @param {Integer} nx - x dimension of the 3d volume\n   * @param {Integer} ny - y dimension of the 3d volume\n   * @param {Integer} nz - z dimension of the 3d volume\n   * @param {Int32Array} atomindex - atom indices corresponding to the cells in the 3d grid\n   */\n  constructor (name: string, path: string, data?: Float32Array, nx?: number, ny?: number, nz?: number, atomindex?: Int32Array) {\n    this.name = name\n    this.path = path\n\n    this.matrix = new Matrix4()\n    this.normalMatrix = new Matrix3()\n    this.inverseMatrix = new Matrix4()\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    this.setData(data, nx, ny, nz, atomindex)\n  }\n\n  get type () { return 'Volume' }\n\n  /**\n   * set volume data\n   * @param {Float32array} data - volume 3d grid\n   * @param {Integer} nx - x dimension of the 3d volume\n   * @param {Integer} ny - y dimension of the 3d volume\n   * @param {Integer} nz - z dimension of the 3d volume\n   * @param {Int32Array} atomindex - atom indices corresponding to the cells in the 3d grid\n   * @return {undefined}\n   */\n  setData (data?: Float32Array, nx?: number, ny?: number, nz?: number, atomindex?: Int32Array) {\n    this.nx = nx || 1\n    this.ny = ny || 1\n    this.nz = nz || 1\n\n    this.data = data || new Float32Array(1)\n    this.setAtomindex(atomindex)\n\n    this._position = new Float32Array()\n\n    delete this._min\n    delete this._max\n    delete this._mean\n    delete this._rms\n\n    if (this.worker) this.worker.terminate()\n  }\n\n  /**\n   * Set statistics, which can be different from the data in this volume,\n   * if this volume is a slice of a bigger volume\n   * @param {Number|undefined} min - minimum value of the whole data set\n   * @param {Number|undefined} max - maximum value of the whole data set\n   * @param {Number|undefined} mean - average value of the whole data set\n   * @param {Number|undefined} rms - sigma value of the whole data set\n   */\n  setStats (min: number|undefined, max: number|undefined, mean: number|undefined, rms: number|undefined) {\n    this._min = min\n    this._max = max\n    this._mean = mean\n    this._rms = rms\n  }\n\n  /**\n   * set transformation matrix\n   * @param {Matrix4} matrix - 4x4 transformation matrix\n   * @return {undefined}\n   */\n  setMatrix (matrix: Matrix4) {\n    this.matrix.copy(matrix)\n\n    const bb = this.boundingBox\n    const v = this.center // temporary re-purposing\n\n    const x = this.nx - 1\n    const y = this.ny - 1\n    const z = this.nz - 1\n\n    bb.makeEmpty()\n\n    bb.expandByPoint(v.set(x, y, z))\n    bb.expandByPoint(v.set(x, y, 0))\n    bb.expandByPoint(v.set(x, 0, z))\n    bb.expandByPoint(v.set(x, 0, 0))\n    bb.expandByPoint(v.set(0, y, z))\n    bb.expandByPoint(v.set(0, 0, z))\n    bb.expandByPoint(v.set(0, y, 0))\n    bb.expandByPoint(v.set(0, 0, 0))\n\n    bb.applyMatrix4(this.matrix)\n    bb.getCenter(this.center)\n\n    // make normal matrix\n\n    const me = this.matrix.elements\n    const r0 = new Vector3(me[0], me[1], me[2])\n    const r1 = new Vector3(me[4], me[5], me[6])\n    const r2 = new Vector3(me[8], me[9], me[10])\n    const cp = new Vector3()\n    //        [ r0 ]       [ r1 x r2 ]\n    // M3x3 = [ r1 ]   N = [ r2 x r0 ]\n    //        [ r2 ]       [ r0 x r1 ]\n    const ne = this.normalMatrix.elements\n    cp.crossVectors(r1, r2)\n    ne[ 0 ] = cp.x\n    ne[ 1 ] = cp.y\n    ne[ 2 ] = cp.z\n    cp.crossVectors(r2, r0)\n    ne[ 3 ] = cp.x\n    ne[ 4 ] = cp.y\n    ne[ 5 ] = cp.z\n    cp.crossVectors(r0, r1)\n    ne[ 6 ] = cp.x\n    ne[ 7 ] = cp.y\n    ne[ 8 ] = cp.z\n\n    this.inverseMatrix.getInverse(this.matrix)\n  }\n\n  /**\n   * set atom indices\n   * @param {Int32Array} atomindex - atom indices corresponding to the cells in the 3d grid\n   * @return {undefined}\n     */\n  setAtomindex (atomindex?: Int32Array) {\n    this.atomindex = atomindex\n  }\n\n  getBox (center: Vector3, size: number, target: Box3) {\n    if (!target) target = new Box3()\n\n    target.set(center, center)\n    target.expandByScalar(size)\n    target.applyMatrix4(this.inverseMatrix)\n\n    target.min.round()\n    target.max.round()\n\n    return target\n  }\n\n  _getBox (center: Vector3|undefined, size: number) {\n    if (!center || !size) return\n\n    if (!this.__box) this.__box = new Box3()\n    const box = this.getBox(center, size, this.__box)\n    return [ box.min.toArray(), box.max.toArray() ]\n  }\n\n  _makeSurface (sd: any, isolevel: number, smooth: number) {\n    const name = this.name + '@' + isolevel.toPrecision(2)\n    const surface = new Surface(name, '', sd)\n    surface.info.isolevel = isolevel\n    surface.info.smooth = smooth\n    surface.info.volume = this\n\n    return surface\n  }\n\n  getSurface (isolevel: number, smooth: number, center: Vector3, size: number, contour: boolean, wrap: boolean = false) {\n    isolevel = isNaN(isolevel) ? this.getValueForSigma(2) : isolevel\n    smooth = defaults(smooth, 0)\n\n    //\n\n    if (this.volsurf === undefined) {\n      this.volsurf = new (VolumeSurface as any)(\n        this.data, this.nx, this.ny, this.nz, this.atomindex\n      ) as VolumeSurface\n    }\n\n    const box = this._getBox(center, size)\n    const sd = this.volsurf.getSurface(\n      isolevel, smooth, box!, this.matrix.elements as unknown as Float32Array, contour, wrap\n    )\n\n    return this._makeSurface(sd, isolevel, smooth)\n  }\n\n  getSurfaceWorker (isolevel: number, smooth: number, center: Vector3, size: number, contour: boolean, wrap: boolean, callback: (s: Surface) => void) {\n    isolevel = isNaN(isolevel) ? this.getValueForSigma(2) : isolevel\n    smooth = smooth || 0\n\n    //\n\n    if (window.hasOwnProperty('Worker')) {\n      if (this.workerPool === undefined) {\n        this.workerPool = new WorkerPool('surf', 2)\n      }\n\n      const msg = {}\n      const worker = this.workerPool.getNextWorker()\n\n      if (worker!.postCount === 0) {\n        Object.assign(msg, {\n          args: [\n            this.data, this.nx, this.ny, this.nz, this.atomindex\n          ]\n        })\n      }\n\n      Object.assign(msg, {\n        params: {\n          isolevel: isolevel,\n          smooth: smooth,\n          box: this._getBox(center, size),\n          matrix: this.matrix.elements,\n          contour: contour,\n          wrap: wrap\n        }\n      })\n\n      worker!.post(msg, undefined,\n        (e: any) => {\n          const sd = e.data.sd\n          const p = e.data.p\n          callback(this._makeSurface(sd, p.isolevel, p.smooth))\n        },\n        (e : string) => {\n          console.warn(\n            'Volume.getSurfaceWorker error - trying without worker', e\n          )\n          const surface = this.getSurface(isolevel, smooth, center, size, contour, wrap)\n          callback(surface)\n        }\n      )\n    } else {\n      const surface = this.getSurface(isolevel, smooth, center, size, contour, wrap)\n      callback(surface)\n    }\n  }\n\n  getValueForSigma (sigma: number) {\n    return this.mean + defaults(sigma, 2) * this.rms\n  }\n\n  getSigmaForValue (value: number) {\n    return (defaults(value, 0) - this.mean) / this.rms\n  }\n\n  get position () {\n    if (!this._position) {\n      const nz = this.nz\n      const ny = this.ny\n      const nx = this.nx\n      const position = new Float32Array(nx * ny * nz * 3)\n\n      let p = 0\n      for (let z = 0; z < nz; ++z) {\n        for (let y = 0; y < ny; ++y) {\n          for (let x = 0; x < nx; ++x) {\n            position[ p + 0 ] = x\n            position[ p + 1 ] = y\n            position[ p + 2 ] = z\n            p += 3\n          }\n        }\n      }\n\n      applyMatrix4toVector3array(this.matrix.elements as unknown as Float32Array, position)\n      this._position = position\n    }\n\n    return this._position\n  }\n\n  getDataAtomindex () {\n    return this.atomindex\n  }\n\n  getDataPosition () {\n    return this.position\n  }\n\n  getDataColor (params: ColormakerParameters & {scheme: string}) {\n    const p = params || {}\n    p.volume = this\n    p.scale = p.scale || 'Spectral'\n    p.domain = p.domain || [ this.min, this.max ]\n\n    const colormaker = ColormakerRegistry.getScheme(p)\n\n    const n = this.position.length / 3\n    const array = new Float32Array(n * 3)\n\n    // var atoms = p.structure.atoms;\n    // var atomindex = this.atomindex;\n\n    for (let i = 0; i < n; ++i) {\n      colormaker.volumeColorToArray(i, array, i * 3)\n      // a = atoms[ atomindex[ i ] ];\n      // if( a ) colormaker.atomColorToArray( a, array, i * 3 );\n    }\n\n    return array\n  }\n\n  getDataPicking () {\n    const picking = serialArray(this.position.length / 3)\n    return new VolumePicker(picking, this)\n  }\n\n  getDataSize (size: VolumeSize|number, scale: number) {\n    const data = this.data\n    const n = this.position.length / 3\n    let array\n\n    switch (size) {\n      case 'value':\n        array = new Float32Array(data)\n        break\n\n      case 'abs-value':\n        array = new Float32Array(data)\n        for (let i = 0; i < n; ++i) {\n          array[ i ] = Math.abs(array[ i ])\n        }\n        break\n\n      case 'value-min': {\n        array = new Float32Array(data)\n        const min = this.min\n        for (let i = 0; i < n; ++i) {\n          array[ i ] -= min\n        }\n        break\n      }\n\n      case 'deviation':\n        array = new Float32Array(data)\n        break\n\n      default:\n        array = uniformArray(n, size)\n        break\n    }\n\n    if (scale !== 1.0) {\n      for (let i = 0; i < n; ++i) {\n        array[ i ] *= scale\n      }\n    }\n\n    return array\n  }\n\n  get min () {\n    if (this._min === undefined) {\n      this._min = arrayMin(this.data)\n    }\n    return this._min\n  }\n\n  get max () {\n    if (this._max === undefined) {\n      this._max = arrayMax(this.data)\n    }\n    return this._max\n  }\n\n  get sum () {\n    if (this._sum === undefined) {\n      this._sum = arraySum(this.data)\n    }\n    return this._sum\n  }\n\n  get mean () {\n    if (this._mean === undefined) {\n      this._mean = arrayMean(this.data)\n    }\n    return this._mean\n  }\n\n  get rms () {\n    if (this._rms === undefined) {\n      this._rms = arrayRms(this.data)\n    }\n    return this._rms\n  }\n\n  clone () {\n    const vol = new Volume(\n      this.name,\n      this.path,\n\n      this.data,\n\n      this.nx,\n      this.ny,\n      this.nz,\n\n      this.atomindex\n    )\n\n    vol.matrix.copy(this.matrix)\n    vol.header = Object.assign({}, this.header)\n\n    return vol\n  }\n\n  dispose () {\n    if (this.workerPool) this.workerPool.terminate()\n  }\n}\n\nexport default Volume\n","/**\n * @file Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n  Color, Vector3, Matrix4,\n  FrontSide, BackSide, DoubleSide,\n  // VertexColors,\n  NoBlending,\n  BufferGeometry, BufferAttribute,\n  UniformsUtils, UniformsLib, Uniform,\n  Group, LineSegments, Points, Mesh, Object3D,\n  ShaderMaterial\n} from 'three'\n\nimport { Log } from '../globals'\nimport { createParams, getTypedArray, getUintArray } from '../utils'\nimport { NumberArray } from '../types'\nimport { getShader, ShaderDefines } from '../shader/shader-utils'\nimport { serialArray } from '../math/array-utils'\nimport { Picker } from '../utils/picker'\n\nexport type BufferSide = 'front'|'back'|'double'\n\nfunction getThreeSide (side: BufferSide) {\n  if (side === 'front') {\n    return FrontSide\n  } else if (side === 'back') {\n    return BackSide\n  } else if (side === 'double') {\n    return DoubleSide\n  } else {\n    return DoubleSide\n  }\n}\n\nconst itemSize = {\n  'f': 1, 'v2': 2, 'v3': 3, 'c': 3\n}\n\nfunction setObjectMatrix (object: Object3D, matrix: Matrix4) {\n  object.matrix.copy(matrix)\n  object.matrix.decompose(object.position, object.quaternion, object.scale)\n  object.matrixWorldNeedsUpdate = true\n}\n\nexport type BufferTypes = 'picking'|'background'\nexport type BufferMaterials = 'material'|'wireframeMaterial'|'pickingMaterial'\n\nexport interface _BufferAttribute {\n  type: 'f'|'v2'|'v3'|'c'\n  value?: NumberArray\n}\n\nexport type Uniforms = { [k: string]: Uniform|{ value: any } }\n\nexport const BufferDefaultParameters = {\n  opaqueBack: false,\n  side: 'double' as BufferSide,  // which triangle sides to render\n  opacity: 1.0,  // translucency: 1 is fully opaque, 0 is fully transparent\n  depthWrite: true,\n  clipNear: 0, // position of camera near/front clipping plane in percent of scene bounding box\n  clipRadius: 0,\n  clipCenter: new Vector3(),\n  flatShaded: false,  // render flat shaded\n  wireframe: false,  // render as wireframe\n  roughness: 0.4,  // how rough the material is, between 0 and 1\n  metalness: 0.0,  // how metallic the material is, between 0 and 1\n  diffuse: 0xffffff,  // diffuse color for lighting\n  diffuseInterior: false,\n  useInteriorColor: false,  // render back-side with interior color\n  interiorColor: 0xdddddd,  // interior color\n  interiorDarkening: 0,  // interior darkening factor\n  forceTransparent: false,  // force the material to allow transparency\n  matrix: new Matrix4(),  // additional transformation matrix\n  disablePicking: false,  // disable picking\n  sortParticles: false,\n  background: false\n}\nexport type BufferParameters = typeof BufferDefaultParameters\n\nexport const BufferParameterTypes = {\n  opaqueBack: { updateShader: true },\n  side: { updateShader: true, property: true },\n  opacity: { uniform: true },\n  depthWrite: { property: true },\n  clipNear: { updateShader: true, property: true },\n  clipRadius: { updateShader: true, uniform: true },\n  clipCenter: { uniform: true },\n  flatShaded: { updateShader: true },\n  background: { updateShader: true },\n  wireframe: { updateVisibility: true },\n  roughness: { uniform: true },\n  metalness: { uniform: true },\n  diffuse: { uniform: true },\n  diffuseInterior: { updateShader: true },\n  useInteriorColor: { updateShader: true },\n  interiorColor: { uniform: true },\n  interiorDarkening: { uniform: true },\n  matrix: {}\n}\n\nexport interface BufferData {\n  position?: Float32Array\n  position1?: Float32Array  // TODO\n  color?: Float32Array\n  index?: Uint32Array|Uint16Array\n  normal?: Float32Array\n\n  picking?: Picker\n  primitiveId?: Float32Array\n}\n\n/**\n * Buffer class. Base class for buffers.\n * @interface\n */\nclass Buffer {\n  parameterTypes = BufferParameterTypes\n  get defaultParameters() { return BufferDefaultParameters }\n  parameters: BufferParameters\n  uniforms: Uniforms\n  pickingUniforms: Uniforms\n\n  private _positionDataSize: number\n\n  geometry = new BufferGeometry()\n  indexVersion = 0\n  wireframeIndexVersion = -1\n  group = new Group()\n  wireframeGroup = new Group()\n  pickingGroup = new Group()\n\n  vertexShader = ''\n  fragmentShader = ''\n  isImpostor = false\n  isText = false\n  isSurface = false\n  isPoint = false\n  isLine = false\n  dynamic = true\n  visible = true\n\n  picking?: Picker\n\n  material: ShaderMaterial\n  wireframeMaterial: ShaderMaterial\n  pickingMaterial: ShaderMaterial\n\n  wireframeIndex?: Uint32Array|Uint16Array\n  wireframeIndexCount = 0\n  wireframeGeometry?: BufferGeometry\n\n  /**\n   * @param {Object} data - attribute object\n   * @param {Float32Array} data.position - positions\n   * @param {Float32Array} data.color - colors\n   * @param {Uint32Array|Uint16Array} data.index - triangle indices\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} params - parameters object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n\n    this.uniforms = UniformsUtils.merge([\n      UniformsLib.common,\n      {\n        fogColor: { value: new Color(0x000000) },\n        fogNear: { value: 0.0 },\n        fogFar: { value: 0.0 },\n        opacity: { value: this.parameters.opacity },\n        clipNear: { value: 0.0 },\n        clipRadius: { value: this.parameters.clipRadius },\n        clipCenter: { value: this.parameters.clipCenter }\n      },\n      {\n        emissive: { value: new Color(0x000000) },\n        roughness: { value: this.parameters.roughness },\n        metalness: { value: this.parameters.metalness },\n        interiorColor: { value: new Color(this.parameters.interiorColor) },\n        interiorDarkening: { value: this.parameters.interiorDarkening },\n      },\n      UniformsLib.lights\n    ])\n\n    this.uniforms.diffuse.value.set(this.parameters.diffuse)\n\n    this.pickingUniforms = {\n      clipNear: { value: 0.0 },\n      objectId: { value: 0 },\n      opacity: { value: this.parameters.opacity }\n    }\n\n    //\n\n    const position = data.position || data.position1\n    this._positionDataSize = position ? position.length / 3 : 0\n\n    if (!data.primitiveId) {\n      data.primitiveId = serialArray(this._positionDataSize)\n    }\n\n    this.addAttributes({\n      position: { type: 'v3', value: data.position },\n      color: { type: 'c', value: data.color },\n      primitiveId: { type: 'f', value: data.primitiveId }\n    })\n\n    if (params.matrix) {\n      this.matrix = params.matrix\n    }\n\n    if (data.index) {\n      this.initIndex(data.index)\n    }\n    this.picking = data.picking\n\n    this.makeWireframeGeometry()\n  }\n\n  set matrix (m) {\n    this.setMatrix(m)\n  }\n  get matrix () {\n    return this.group.matrix.clone()\n  }\n\n  get transparent () {\n    return this.parameters.opacity < 1 || this.parameters.forceTransparent\n  }\n\n  get size () {\n    return this._positionDataSize\n  }\n\n  get attributeSize () {\n    return this.size\n  }\n\n  get pickable () {\n    return !!this.picking && !this.parameters.disablePicking\n  }\n\n  setMatrix (m: Matrix4) {\n    setObjectMatrix(this.group, m)\n    setObjectMatrix(this.wireframeGroup, m)\n    setObjectMatrix(this.pickingGroup, m)\n  }\n\n  initIndex (index: Uint32Array|Uint16Array) {\n    this.geometry.setIndex(\n      new BufferAttribute(index, 1)\n    )\n    const nindex = this.geometry.getIndex();\n    if (!nindex) { Log.error('Index is null'); return; }\n    nindex.setUsage(this.dynamic ? WebGLRenderingContext.DYNAMIC_DRAW : 0)\n  }\n\n  makeMaterial () {\n    const side = getThreeSide(this.parameters.side)\n\n    const m = new ShaderMaterial({\n      uniforms: this.uniforms,\n      vertexShader: '',\n      fragmentShader: '',\n      depthTest: true,\n      transparent: this.transparent,\n      depthWrite: this.parameters.depthWrite,\n      lights: true,\n      fog: true,\n      side: side\n    })\n    m.vertexColors = true\n    m.extensions.derivatives = true\n    m.extensions.fragDepth = this.isImpostor\n\n    const wm = new ShaderMaterial({\n      uniforms: this.uniforms,\n      vertexShader: '',\n      fragmentShader: '',\n      depthTest: true,\n      transparent: this.transparent,\n      depthWrite: this.parameters.depthWrite,\n      lights: false,\n      fog: true,\n      side: side\n    })\n    wm.vertexColors = true\n\n    const pm = new ShaderMaterial({\n      uniforms: this.pickingUniforms,\n      vertexShader: '',\n      fragmentShader: '',\n      depthTest: true,\n      transparent: false,\n      depthWrite: this.parameters.depthWrite,\n      lights: false,\n      fog: false,\n      side: side,\n      blending: NoBlending\n    })\n    pm.vertexColors = true\n    pm.extensions.fragDepth = this.isImpostor\n\n    ;(m as any).clipNear = this.parameters.clipNear\n    ;(wm as any).clipNear = this.parameters.clipNear\n    ;(pm as any).clipNear = this.parameters.clipNear\n\n    this.material = m\n    this.wireframeMaterial = wm\n    this.pickingMaterial = pm\n\n    // also sets vertexShader/fragmentShader\n    this.updateShader()\n  }\n\n  makeWireframeGeometry () {\n    this.makeWireframeIndex()\n\n    const geometry = this.geometry\n    const wireframeIndex = this.wireframeIndex\n    const wireframeGeometry = new BufferGeometry()\n\n    wireframeGeometry.attributes = geometry.attributes\n    if (wireframeIndex) {\n      wireframeGeometry.setIndex(\n        new BufferAttribute(wireframeIndex, 1).setUsage(this.dynamic ? WebGLRenderingContext.DYNAMIC_DRAW : 0)\n      )\n      wireframeGeometry.setDrawRange(0, this.wireframeIndexCount)\n    }\n\n    this.wireframeGeometry = wireframeGeometry\n  }\n\n  makeWireframeIndex () {\n    const edges: number[][] = []\n\n    function checkEdge (a: number, b: number) {\n      if (a > b) {\n        const tmp = a\n        a = b\n        b = tmp\n      }\n\n      const list = edges[ a ]\n\n      if (list === undefined) {\n        edges[ a ] = [ b ]\n        return true\n      } else if (!list.includes(b)) {\n        list.push(b)\n        return true\n      }\n\n      return false\n    }\n\n    const geometry = this.geometry\n    const index = geometry.index\n\n    if (!this.parameters.wireframe) {\n      this.wireframeIndex = new Uint16Array(0)\n      this.wireframeIndexCount = 0\n    } else if (index) {\n      const array = index.array\n      let n = array.length\n      if (geometry.drawRange.count !== Infinity) {\n        n = geometry.drawRange.count\n      }\n      let wireframeIndex\n      if (this.wireframeIndex && this.wireframeIndex.length > n * 2) {\n        wireframeIndex = this.wireframeIndex\n      } else {\n        const count = (geometry.attributes as any).position.count  // TODO\n        wireframeIndex = getUintArray(n * 2, count)\n      }\n\n      let j = 0\n      edges.length = 0\n\n      for (let i = 0; i < n; i += 3) {\n        const a = array[ i + 0 ]\n        const b = array[ i + 1 ]\n        const c = array[ i + 2 ]\n\n        if (checkEdge(a, b)) {\n          wireframeIndex[ j + 0 ] = a\n          wireframeIndex[ j + 1 ] = b\n          j += 2\n        }\n        if (checkEdge(b, c)) {\n          wireframeIndex[ j + 0 ] = b\n          wireframeIndex[ j + 1 ] = c\n          j += 2\n        }\n        if (checkEdge(c, a)) {\n          wireframeIndex[ j + 0 ] = c\n          wireframeIndex[ j + 1 ] = a\n          j += 2\n        }\n      }\n\n      this.wireframeIndex = wireframeIndex\n      this.wireframeIndexCount = j\n      this.wireframeIndexVersion = this.indexVersion\n    } else {\n      const n = (geometry.attributes as any).position.count  // TODO\n\n      let wireframeIndex\n      if (this.wireframeIndex && this.wireframeIndex.length > n * 2) {\n        wireframeIndex = this.wireframeIndex\n      } else {\n        wireframeIndex = getUintArray(n * 2, n)\n      }\n\n      for (let i = 0, j = 0; i < n; i += 3) {\n        wireframeIndex[ j + 0 ] = i\n        wireframeIndex[ j + 1 ] = i + 1\n        wireframeIndex[ j + 2 ] = i + 1\n        wireframeIndex[ j + 3 ] = i + 2\n        wireframeIndex[ j + 4 ] = i + 2\n        wireframeIndex[ j + 5 ] = i\n\n        j += 6\n      }\n\n      this.wireframeIndex = wireframeIndex\n      this.wireframeIndexCount = n * 2\n      this.wireframeIndexVersion = this.indexVersion\n    }\n  }\n\n  updateWireframeIndex () {\n    if (!this.wireframeGeometry || !this.wireframeIndex) return\n\n    this.wireframeGeometry.setDrawRange(0, Infinity)\n    if (this.wireframeIndexVersion < this.indexVersion) this.makeWireframeIndex()\n\n    if (this.wireframeGeometry.index &&\n        this.wireframeIndex.length > this.wireframeGeometry.index.array.length) {\n      this.wireframeGeometry.setIndex(\n        new BufferAttribute(this.wireframeIndex, 1).setUsage(this.dynamic ? WebGLRenderingContext.DYNAMIC_DRAW : 0)\n      )\n    } else {\n      const index = this.wireframeGeometry.getIndex()\n      if (!index) { Log.error('Index is null'); return; }\n      index.set(this.wireframeIndex)\n      index.needsUpdate = this.wireframeIndexCount > 0\n      index.updateRange.count = this.wireframeIndexCount\n    }\n\n    this.wireframeGeometry.setDrawRange(0, this.wireframeIndexCount)\n  }\n\n  getRenderOrder () {\n    let renderOrder = 0\n\n    if (this.isText) {\n      renderOrder = 1\n    } else if (this.transparent) {\n      if (this.isSurface) {\n        renderOrder = 3\n      } else {\n        renderOrder = 2\n      }\n    }\n\n    return renderOrder\n  }\n\n  _getMesh (materialName: BufferMaterials) {\n    if (!this.material) this.makeMaterial()\n\n    const g = this.geometry\n    const m = this[ materialName ]\n\n    let mesh\n\n    if (this.isLine) {\n      mesh = new LineSegments(g, m)\n    } else if (this.isPoint) {\n      mesh = new Points(g, m)\n    } else {\n      mesh = new Mesh(g, m)\n    }\n\n    mesh.frustumCulled = false\n    mesh.renderOrder = this.getRenderOrder()\n\n    return mesh\n  }\n\n  getMesh () {\n    return this._getMesh('material')\n  }\n\n  getWireframeMesh () {\n    let mesh\n\n    if (!this.material) this.makeMaterial()\n    if (!this.wireframeGeometry) this.makeWireframeGeometry()\n\n    mesh = new LineSegments(\n      this.wireframeGeometry, this.wireframeMaterial\n    )\n\n    mesh.frustumCulled = false\n    mesh.renderOrder = this.getRenderOrder()\n\n    return mesh\n  }\n\n  getPickingMesh () {\n    return this._getMesh('pickingMaterial')\n  }\n\n  getShader (name: string, type?: BufferTypes) {\n    return getShader(name, this.getDefines(type))\n  }\n\n  getVertexShader (type?: BufferTypes) {\n    return this.getShader(this.vertexShader, type)\n  }\n\n  getFragmentShader (type?: BufferTypes) {\n    return this.getShader(this.fragmentShader, type)\n  }\n\n  getDefines (type?: BufferTypes) {\n    const defines: ShaderDefines = {}\n\n    if (this.parameters.clipNear) {\n      defines.NEAR_CLIP = 1\n    }\n\n    if (this.parameters.clipRadius) {\n      defines.RADIUS_CLIP = 1\n    }\n\n    if (type === 'picking') {\n      defines.PICKING = 1\n    } else {\n      if (type === 'background' || this.parameters.background) {\n        defines.NOLIGHT = 1\n      }\n      if (this.parameters.flatShaded) {\n        defines.FLAT_SHADED = 1\n      }\n      if (this.parameters.opaqueBack) {\n        defines.OPAQUE_BACK = 1\n      }\n      if (this.parameters.diffuseInterior) {\n        defines.DIFFUSE_INTERIOR = 1\n      }\n      if (this.parameters.useInteriorColor) {\n        defines.USE_INTERIOR_COLOR = 1\n      }\n    }\n\n    return defines\n  }\n\n  getParameters () {\n    return this.parameters\n  }\n\n  addUniforms (uniforms: Uniforms) {\n    this.uniforms = UniformsUtils.merge(\n      [ this.uniforms, uniforms ]\n    )\n\n    this.pickingUniforms = UniformsUtils.merge(\n      [ this.pickingUniforms, uniforms ]\n    )\n  }\n\n  addAttributes (attributes: { [k: string]: _BufferAttribute }) {\n    for (let name in attributes) {\n      let buf\n      const a = attributes[ name ]\n      const arraySize = this.attributeSize * itemSize[ a.type ]\n\n      if (a.value) {\n        if (arraySize !== a.value.length) {\n          Log.error('attribute value has wrong length', name)\n        }\n        buf = a.value\n      } else {\n        buf = getTypedArray('float32', arraySize)\n      }\n\n      this.geometry.setAttribute(\n        name,\n        new BufferAttribute(buf, itemSize[ a.type ]).setUsage(this.dynamic ? WebGLRenderingContext.DYNAMIC_DRAW : 0)\n      )\n    }\n  }\n\n  updateRenderOrder () {\n    const renderOrder = this.getRenderOrder()\n    function setRenderOrder (mesh: Object3D) {\n      mesh.renderOrder = renderOrder\n    }\n\n    this.group.children.forEach(setRenderOrder)\n    if (this.pickingGroup) {\n      this.pickingGroup.children.forEach(setRenderOrder)\n    }\n  }\n\n  updateShader () {\n    const m = this.material\n    const wm = this.wireframeMaterial\n    const pm = this.pickingMaterial\n\n    m.vertexShader = this.getVertexShader()\n    m.fragmentShader = this.getFragmentShader()\n    m.needsUpdate = true\n\n    wm.vertexShader = this.getShader('Line.vert')\n    wm.fragmentShader = this.getShader('Line.frag')\n    wm.needsUpdate = true\n\n    pm.vertexShader = this.getVertexShader('picking')\n    pm.fragmentShader = this.getFragmentShader('picking')\n    pm.needsUpdate = true\n  }\n\n  /**\n   * Set buffer parameters\n   * @param {BufferParameters} params - buffer parameters object\n   * @return {undefined}\n   */\n  setParameters (params: Partial<BufferParameters>) {\n    const p = params as any\n    const pt = this.parameterTypes as any\n    const pv = this.parameters as any\n\n    const propertyData: { [k: string]: any } = {}\n    const uniformData: { [k: string]: any } = {}\n    let doShaderUpdate = false\n    let doVisibilityUpdate = false\n\n    for (const name in p) {\n      const value = p[ name ]\n\n      if (value === undefined) continue\n      pv[ name ] = value\n\n      if (pt[ name ] === undefined) continue\n\n      if (pt[ name ].property) {\n        if (pt[ name ].property !== true) {\n          propertyData[ pt[ name ].property as any ] = value\n        } else {\n          propertyData[ name ] = value\n        }\n      }\n\n      if (pt[ name ].uniform) {\n        if (pt[ name ].uniform !== true) {\n          uniformData[ pt[ name ].uniform as any ] = value\n        } else {\n          uniformData[ name ] = value\n        }\n      }\n\n      if (pt[ name ].updateShader) {\n        doShaderUpdate = true\n      }\n\n      if (pt[ name ].updateVisibility) {\n        doVisibilityUpdate = true\n      }\n\n      if (this.dynamic && name === 'wireframe' && value === true) {\n        this.updateWireframeIndex()\n      }\n\n      if (name === 'forceTransparent') {\n        propertyData.transparent = this.transparent\n      }\n\n      if (name === 'matrix') {\n        this.matrix = value\n      }\n    }\n\n    this.setProperties(propertyData)\n    this.setUniforms(uniformData)\n    if (doShaderUpdate) this.updateShader()\n    if (doVisibilityUpdate) this.setVisibility(this.visible)\n  }\n\n  /**\n   * Sets buffer attributes\n   * @param {Object} data - An object where the keys are the attribute names\n   *      and the values are the attribute data.\n   * @example\n   * var buffer = new Buffer();\n   * buffer.setAttributes({ attrName: attrData });\n   */\n  setAttributes (data: any) {  // TODO\n    const geometry = this.geometry\n    const attributes = geometry.attributes as any  // TODO\n\n    for (const name in data) {\n      if (name === 'picking') continue\n\n      const array = data[ name ]\n      const length = array.length\n\n      if (name === 'index') {\n        const index = geometry.getIndex()\n        if (!index) { Log.error('Index is null'); continue; }\n        geometry.setDrawRange(0, Infinity)\n\n        if (length > index.array.length) {\n          geometry.setIndex(\n            new BufferAttribute(array, 1)\n              .setUsage(this.dynamic ? WebGLRenderingContext.DYNAMIC_DRAW : 0)\n          )\n        } else {\n          index.set(array)\n          index.count = length\n          index.needsUpdate = length > 0\n          index.updateRange.count = length\n          geometry.setDrawRange(0, length)\n        }\n\n        this.indexVersion++\n        if (this.parameters.wireframe) this.updateWireframeIndex()\n      } else {\n        const attribute = attributes[ name ]\n\n        if (length > attribute.array.length) {\n          geometry.setAttribute(\n            name,\n            new BufferAttribute(array, attribute.itemSize)\n              .setUsage(this.dynamic ? WebGLRenderingContext.DYNAMIC_DRAW : 0)\n          )\n        } else {\n          attributes[ name ].set(array)\n          attributes[ name ].needsUpdate = length > 0\n          attributes[ name ].updateRange.count = length\n        }\n      }\n    }\n  }\n\n  setUniforms (data: any) {  // TODO\n    if (!data) return\n\n    const u = this.material.uniforms\n    const wu = this.wireframeMaterial.uniforms\n    const pu = this.pickingMaterial.uniforms\n\n    for (let name in data) {\n      if (name === 'opacity') {\n        this.setProperties({ transparent: this.transparent })\n      }\n\n      if (u[ name ] !== undefined) {\n        if (u[ name ].value.isVector3) {\n          u[ name ].value.copy(data[ name ])\n        } else if (u[ name ].value.set) {\n          u[ name ].value.set(data[ name ])\n        } else {\n          u[ name ].value = data[ name ]\n        }\n      }\n\n      if (wu[ name ] !== undefined) {\n        if (wu[ name ].value.isVector3) {\n          wu[ name ].value.copy(data[ name ])\n        } else if (wu[ name ].value.set) {\n          wu[ name ].value.set(data[ name ])\n        } else {\n          wu[ name ].value = data[ name ]\n        }\n      }\n\n      if (pu[ name ] !== undefined) {\n        if (pu[ name ].value.isVector3) {\n          pu[ name ].value.copy(data[ name ])\n        } else if (pu[ name ].value.set) {\n          pu[ name ].value.set(data[ name ])\n        } else {\n          pu[ name ].value = data[ name ]\n        }\n      }\n    }\n  }\n\n  setProperties (data: any) {  // TODO\n    if (!data) return\n\n    const m = this.material\n    const wm = this.wireframeMaterial\n    const pm = this.pickingMaterial\n\n    for (const _name in data) {\n      const name = _name as 'side'|'transparent'  // TODO\n\n      let value = data[ name ]\n\n      if (name === 'transparent') {\n        this.updateRenderOrder()\n      } else if (name === 'side') {\n        value = getThreeSide(value)\n      }\n\n      (m[ name ] as any) = value;\n      (wm[ name ] as any) = value;\n      (pm[ name ] as any) = value\n    }\n\n    m.needsUpdate = true\n    wm.needsUpdate = true\n    pm.needsUpdate = true\n  }\n\n  /**\n   * Set buffer visibility\n   * @param {Boolean} value - visibility value\n   * @return {undefined}\n   */\n  setVisibility (value: boolean) {\n    this.visible = value\n\n    if (this.parameters.wireframe) {\n      this.group.visible = false\n      this.wireframeGroup.visible = value\n      if (this.pickable) {\n        this.pickingGroup.visible = false\n      }\n    } else {\n      this.group.visible = value\n      this.wireframeGroup.visible = false\n      if (this.pickable) {\n        this.pickingGroup.visible = value\n      }\n    }\n  }\n\n  /**\n   * Free buffer resources\n   * @return {undefined}\n   */\n  dispose () {\n    if (this.material) this.material.dispose()\n    if (this.wireframeMaterial) this.wireframeMaterial.dispose()\n    if (this.pickingMaterial) this.pickingMaterial.dispose()\n\n    this.geometry.dispose()\n    if (this.wireframeGeometry) this.wireframeGeometry.dispose()\n  }\n\n  /**\n   * Customize JSON serialization to avoid circular references\n   */\n  toJSON () {\n    var result: any = {};\n    for (var x in this) {\n      if (x !== \"group\" && x !== \"wireframeGroup\" && x != \"pickingGroup\"\n         && x !== \"picking\") {\n        result[x] = this[x];\n      }\n    }\n    return result;\n  }\n}\n\nexport default Buffer\n","/**\n * @file Mesh Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport '../shader/Mesh.vert'\nimport '../shader/Mesh.frag'\n\nimport Buffer, { BufferParameters, BufferData } from './buffer'\n\n/**\n * Mesh buffer. Draws a triangle mesh.\n *\n * @example\n * var meshBuffer = new MeshBuffer({\n *   position: new Float32Array(\n *     [ 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1 ]\n *   ),\n *   color: new Float32Array(\n *     [ 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0 ]\n *   )\n * });\n */\nclass MeshBuffer extends Buffer {\n  vertexShader = 'Mesh.vert'\n  fragmentShader = 'Mesh.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} [data.index] - triangle indices\n   * @param  {Float32Array} [data.normal] - radii\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params)\n\n    this.addAttributes({\n      'normal': { type: 'v3', value: data.normal }\n    })\n\n    if (data.normal === undefined) {\n      this.geometry.computeVertexNormals()\n    }\n  }\n}\n\nexport default MeshBuffer\n","/**\n * @file Surface Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport MeshBuffer from './mesh-buffer'\n\n/**\n * Surface buffer. Like a {@link MeshBuffer}, but with `.isSurface` set to `true`.\n */\nclass SurfaceBuffer extends MeshBuffer {\n  isSurface = true\n}\n\nexport default SurfaceBuffer\n","/**\n * @file Double Sided Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Group, BufferGeometry, Object3D, Mesh, LineSegments, Vector3, Matrix4 } from 'three'\n\nimport Buffer, { BufferSide } from './buffer'\nimport { Picker } from '../utils/picker'\n\nfunction setVisibilityTrue (m: Object3D) { m.visible = true }\nfunction setVisibilityFalse (m: Object3D) { m.visible = false }\n\n/**\n * A double-sided mesh buffer. Takes a buffer and renders the front and\n * the back as seperate objects to avoid some artifacts when rendering\n * transparent meshes. Also allows to render the back of a mesh opaque\n * while the front is transparent.\n * @implements {Buffer}\n *\n * @example\n * var sphereGeometryBuffer = new SphereGeometryBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n * var doubleSidedBuffer = new DoubleSidedBuffer(sphereGeometryBuffer);\n */\nclass DoubleSidedBuffer {\n  size: number\n  side: BufferSide\n  visible: boolean\n  wireframe: boolean\n  geometry: BufferGeometry\n\n  picking?: Picker\n\n  group = new Group()\n  wireframeGroup = new Group()\n  pickingGroup = new Group()\n\n  frontMeshes: (Mesh|LineSegments)[] = []\n  backMeshes: (Mesh|LineSegments)[] = []\n\n  buffer: Buffer\n  frontBuffer: Buffer\n  backBuffer: Buffer\n\n  /**\n   * Create a double sided buffer\n   * @param  {Buffer} buffer - the buffer to be rendered double-sided\n   */\n  constructor (buffer: Buffer) {\n    this.size = buffer.size\n    this.side = buffer.parameters.side\n    this.visible = buffer.visible\n    this.geometry = buffer.geometry\n    this.picking = buffer.picking\n\n    this.group = new Group()\n    this.wireframeGroup = new Group()\n    this.pickingGroup = new Group()\n\n    // requires Group objects to be present\n    this.matrix = buffer.matrix\n\n    const frontBuffer = buffer\n    const backBuffer = new (buffer as any).constructor({  // TODO\n      position: new Float32Array(0)\n    }) as Buffer\n\n    frontBuffer.makeMaterial()\n    backBuffer.makeMaterial()\n\n    backBuffer.picking = buffer.picking\n    backBuffer.geometry = buffer.geometry\n    backBuffer.wireframeGeometry = buffer.wireframeGeometry\n    backBuffer.setParameters(buffer.getParameters())\n    backBuffer.updateShader()\n\n    frontBuffer.setParameters({\n      side: 'front'\n    })\n    backBuffer.setParameters({\n      side: 'back',\n      opacity: backBuffer.parameters.opacity\n    })\n\n    this.buffer = buffer\n    this.frontBuffer = frontBuffer\n    this.backBuffer = backBuffer\n  }\n\n  set matrix (m) {\n    Buffer.prototype.setMatrix.call(this, m)\n  }\n  get matrix () {\n    return this.group.matrix.clone()\n  }\n\n  get pickable () {\n    return !!this.picking && !this.parameters.disablePicking\n  }\n\n  get parameters () {\n    return this.buffer.parameters\n  }\n\n  getParameters () {\n    const p = Object.assign({}, this.buffer.parameters)\n    p.side = this.side\n    return p\n  }\n\n  getMesh (picking: boolean) {\n    let front, back\n\n    if (picking) {\n      back = this.backBuffer.getPickingMesh()\n      front = this.frontBuffer.getPickingMesh()\n    } else {\n      back = this.backBuffer.getMesh()\n      front = this.frontBuffer.getMesh()\n    }\n\n    this.frontMeshes.push(<LineSegments|Mesh>front)\n    this.backMeshes.push(<LineSegments|Mesh>back)\n\n    this.setParameters({ side: this.side })\n\n    return new Group().add(back, front)\n  }\n\n  getWireframeMesh () {\n    return this.buffer.getWireframeMesh()\n  }\n\n  getPickingMesh () {\n    return this.getMesh(true)\n  }\n\n  setAttributes (data: any) {  // TODO\n    this.buffer.setAttributes(data)\n  }\n\n  setParameters (data: any) {  // TODO\n    data = Object.assign({}, data)\n\n    if (data.side === 'front') {\n      this.frontMeshes.forEach(setVisibilityTrue)\n      this.backMeshes.forEach(setVisibilityFalse)\n    } else if (data.side === 'back') {\n      this.frontMeshes.forEach(setVisibilityFalse)\n      this.backMeshes.forEach(setVisibilityTrue)\n    } else if (data.side === 'double') {\n      this.frontMeshes.forEach(setVisibilityTrue)\n      this.backMeshes.forEach(setVisibilityTrue)\n    }\n\n    if (data.side !== undefined) {\n      this.side = data.side\n    }\n    delete data.side\n\n    if (data.matrix !== undefined) {\n      this.matrix = data.matrix\n    }\n    delete data.matrix\n\n    this.frontBuffer.setParameters(data)\n\n    if (data.wireframe !== undefined) {\n      this.wireframe = data.wireframe\n      this.setVisibility(this.visible)\n    }\n    delete data.wireframe\n\n    this.backBuffer.setParameters(data)\n  }\n\n  setVisibility (value: boolean) {\n    this.visible = value\n\n    if (this.parameters.wireframe) {\n      this.group.visible = false\n      this.wireframeGroup.visible = value\n      if (this.pickable) {\n        this.pickingGroup.visible = false\n      }\n    } else {\n      this.group.visible = value\n      this.wireframeGroup.visible = false\n      if (this.pickable) {\n        this.pickingGroup.visible = value\n      }\n    }\n  }\n\n  dispose () {\n    this.frontBuffer.dispose()\n    this.backBuffer.dispose()\n  }\n\n  /**\n   * Customize JSON serialization to avoid circular references.\n   * Only export simple params which could be useful.\n   */\n  toJSON () {\n    var result: any = {};\n    for (var x in this) {\n      if (['side', 'size', 'visible', 'matrix', 'parameters'].includes(x)) {\n        result[x] = this[x];\n      }\n    }\n    return result;\n  }\n}\n\nexport default DoubleSidedBuffer\n","/**\n * @file Contour Buffer\n * @author Fred ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport '../shader/Line.vert'\nimport '../shader/Line.frag'\n\nimport Buffer from './buffer'\n\n/**\n * Contour buffer. A buffer that draws lines (instead of triangle meshes).\n */\nclass ContourBuffer extends Buffer {\n  isLine = true\n  vertexShader = 'Line.vert'\n  fragmentShader = 'Line.frag'\n}\n\nexport default ContourBuffer\n","/**\n * @file Surface Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, Box3 } from 'three'\n\nimport { defaults } from '../utils'\nimport Representation, { RepresentationParameters } from './representation'\nimport Volume from '../surface/volume'\nimport SurfaceBuffer from '../buffer/surface-buffer'\nimport DoubleSidedBuffer from '../buffer/doublesided-buffer'\nimport ContourBuffer from '../buffer/contour-buffer'\nimport Surface from '../surface/surface';\nimport Viewer from '../viewer/viewer';\nimport {SurfaceData} from '../surface/surface'\n// @ts-ignore: unused import ColormakerParameters required for declaration only\nimport { ColormakerParameters } from '../color/colormaker';\nexport type SurfaceDataFields = {position: boolean, color: boolean, index: boolean, normal: boolean, radius: boolean}\n\n/**\n * Surface representation parameter object. Extends {@link RepresentationParameters}\n *\n * @typedef {Object} SurfaceRepresentationParameters - surface representation parameters\n *\n * @property {String} isolevelType - Meaning of the isolevel value. Either *value* for the literal value or *sigma* as a factor of the sigma of the data. For volume data only.\n * @property {Float} isolevel - The value at which to create the isosurface. For volume data only.\n * @property {Boolean} negateIsolevel - For volume data only.\n * @property {Boolean} isolevelScroll - For volume data only\n * @property {Integer} smooth - How many iterations of laplacian smoothing after surface triangulation. For volume data only.\n * @property {Boolean} background - Render the surface in the background, unlit.\n * @property {Boolean} opaqueBack - Render the back-faces (where normals point away from the camera) of the surface opaque, ignoring the transparency parameter.\n * @property {Integer} boxSize - Size of the box to triangulate volume data in. Set to zero to triangulate the whole volume. For volume data only.\n * @property {Boolean} useWorker - Weather or not to triangulate the volume asynchronously in a Web Worker. For volume data only.\n * @property {Boolean} wrap - Wrap volume data around the edges; use in conjuction with boxSize but not larger than the volume dimension. For volume data only.\n */\nexport interface SurfaceRepresentationParameters extends RepresentationParameters {\n  isolevelType: 'value'|'sigma'\n  isolevel: number\n  smooth: number\n  background: boolean\n  opaqueBack: boolean\n  boxSize: number\n  useWorker: boolean\n  wrap: boolean\n}\n/**\n * Surface representation\n */\n/**\n   * Create Surface representation object\n   * @param {Surface|Volume} surface - the surface or volume to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {SurfaceRepresentationParameters} params - surface representation parameters\n   */\nclass SurfaceRepresentation extends Representation {\n  protected surface: Surface|Volume|undefined\n  protected volume: Volume|undefined\n  protected boxCenter: Vector3\n  protected __boxCenter: Vector3\n  protected box: Box3\n  protected __box: Box3\n  protected _position: Vector3\n  protected isolevelType: 'value'|'sigma'\n  protected isolevel: number\n  protected negateIsolevel: boolean\n  protected isolevelScroll: boolean\n  protected smooth: number\n  protected background: boolean\n  protected opaqueBack: boolean\n  protected boxSize: number\n  protected inverseMatrix: Matrix4\n  protected colorVolume: Volume\n  protected contour: boolean\n  protected useWorker: boolean\n  protected wrap: boolean\n\n  protected __isolevel: number\n  protected __smooth: number\n  protected __contour: boolean\n  protected __wrap: boolean\n  protected __boxSize: number\n\n  setBox: () => void\n\n  constructor (surface: Surface, viewer: Viewer, params: Partial<SurfaceRepresentationParameters>) {\n    super(surface, viewer, params)\n\n    this.type = 'surface'\n\n    this.parameters = Object.assign({\n\n      isolevelType: {\n        type: 'select',\n        options: {\n          'value': 'value', 'sigma': 'sigma'\n        }\n      },\n      isolevel: {\n        type: 'number', precision: 2, max: 1000, min: -1000\n      },\n      negateIsolevel: {\n        type: 'boolean'\n      },\n      isolevelScroll: {\n        type: 'boolean'\n      },\n      smooth: {\n        type: 'integer', precision: 1, max: 10, min: 0\n      },\n      background: {\n        type: 'boolean', rebuild: true // FIXME\n      },\n      opaqueBack: {\n        type: 'boolean', buffer: true\n      },\n      boxSize: {\n        type: 'integer', precision: 1, max: 100, min: 0\n      },\n      colorVolume: {\n        type: 'hidden'\n      },\n      contour: {\n        type: 'boolean', rebuild: true\n      },\n      useWorker: {\n        type: 'boolean', rebuild: true\n      },\n      wrap: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters)\n\n    if (surface instanceof Volume) {\n      this.surface = undefined\n      this.volume = surface\n    } else {\n      this.surface = surface\n      this.volume = undefined\n    }\n\n    this.boxCenter = new Vector3()\n    this.__boxCenter = new Vector3()\n    this.box = new Box3()\n    this.__box = new Box3()\n\n    this._position = new Vector3()\n    this.inverseMatrix = new Matrix4()\n\n    this.setBox = function setBox () {\n      this._position.copy(viewer.translationGroup.position).negate()\n      this._position.applyMatrix4(this.inverseMatrix)\n      if (!this._position.equals(this.boxCenter)) {\n        this.setParameters({ 'boxCenter': this._position })\n      }\n    }\n\n    this.toBePrepared = true\n\n    this.viewer.signals.ticked.add(this.setBox, this)\n\n    this.init(params)\n  }\n\n  init (params: Partial<SurfaceRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'uniform')\n    p.colorValue = defaults(p.colorValue, 0xDDDDDD)\n\n    this.isolevelType = defaults(p.isolevelType, 'sigma')\n    this.isolevel = defaults(p.isolevel, 2.0)\n    this.negateIsolevel = defaults(p.negateIsolevel, false)\n    this.isolevelScroll = defaults(p.isolevelScroll, false)\n    this.smooth = defaults(p.smooth, 0)\n    this.background = defaults(p.background, false)\n    this.opaqueBack = defaults(p.opaqueBack, true)\n    this.boxSize = defaults(p.boxSize, 0)\n    this.colorVolume = defaults(p.colorVolume, undefined)\n    this.contour = defaults(p.contour, false)\n    this.useWorker = defaults(p.useWorker, true)\n    this.wrap = defaults(p.wrap, false)\n\n    super.init(p)\n\n    this.inverseMatrix.getInverse(this.matrix)\n\n    this.build()\n  }\n\n  attach (callback: () => void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n    })\n\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  prepare (callback: () => void) {\n    if (this.volume) {\n      let isolevel\n\n      if (this.isolevelType === 'sigma') {\n        isolevel = this.volume.getValueForSigma(this.isolevel)\n      } else {\n        isolevel = this.isolevel\n      }\n      if (this.negateIsolevel) isolevel *= -1\n\n      if (!this.surface ||\n        this.__isolevel !== isolevel ||\n        this.__smooth !== this.smooth ||\n        this.__contour !== this.contour ||\n        this.__wrap !== this.wrap ||\n        this.__boxSize !== this.boxSize ||\n        (this.boxSize > 0 &&\n            !this.__boxCenter.equals(this.boxCenter))\n      ) {\n        this.__isolevel = isolevel\n        this.__smooth = this.smooth\n        this.__contour = this.contour\n        this.__wrap = this.wrap\n        this.__boxSize = this.boxSize\n        this.__boxCenter.copy(this.boxCenter)\n        this.__box.copy(this.box)\n\n        const onSurfaceFinish = (surface: Surface) => {\n          this.surface = surface\n          callback()\n        }\n\n        if (this.useWorker) {\n          this.volume.getSurfaceWorker(\n            isolevel, this.smooth, this.boxCenter, this.boxSize,\n            this.contour, this.wrap, onSurfaceFinish\n          )\n        } else {\n          onSurfaceFinish(\n            this.volume.getSurface(\n              isolevel, this.smooth, this.boxCenter, this.boxSize,\n              this.contour, this.wrap\n            )\n          )\n        }\n      } else {\n        callback()\n      }\n    } else {\n      callback()\n    }\n  }\n\n  create () {\n    const sd = {\n      position: (this.surface as Surface).getPosition(),\n      color: (this.surface as Surface).getColor(this.getColorParams()),\n      index: (this.surface as Surface).getIndex()\n    }\n\n    let buffer\n\n    if (this.contour) {\n      buffer = new ContourBuffer(\n        sd,\n        this.getBufferParams({ wireframe: false })\n      )\n    } else {\n      Object.assign(sd, {\n        normal: (this.surface as Surface).getNormal(),\n        picking: (this.surface as Surface).getPicking()\n      })\n\n      const surfaceBuffer = new SurfaceBuffer(\n        sd,\n        this.getBufferParams({\n          background: this.background,\n          opaqueBack: this.opaqueBack,\n          dullInterior: false\n        })\n      )\n\n      buffer = new DoubleSidedBuffer(surfaceBuffer)\n    }\n\n    this.bufferList.push(buffer as ContourBuffer)\n  }\n\n  update (what: SurfaceDataFields) {\n    if (this.bufferList.length === 0) return\n\n    what = what || {}\n\n    const surfaceData: Partial<SurfaceData> = {}\n\n    if (what.position) {\n      surfaceData.position = (this.surface as Surface).getPosition()\n    }\n\n    if (what.color) {\n      surfaceData.color = (this.surface as Surface).getColor(\n        this.getColorParams()\n      )\n    }\n\n    if (what.index) {\n      surfaceData.index = (this.surface as Surface).getIndex()\n    }\n\n    if (what.normal) {\n      surfaceData.normal = (this.surface as Surface).getNormal()\n    }\n\n    this.bufferList.forEach(function (buffer) {\n      buffer.setAttributes(surfaceData)\n    })\n  }\n\n  /**\n   * Set representation parameters\n   * @alias SurfaceRepresentation#setParameters\n   * @param {SurfaceRepresentationParameters} params - surface parameter object\n   * @param {Object} [what] - buffer data attributes to be updated,\n   *                        note that this needs to be implemented in the\n   *                        derived classes. Generally it allows more\n   *                        fine-grained control over updating than\n   *                        forcing a rebuild.\n   * @param {Boolean} what.position - update position data\n   * @param {Boolean} what.color - update color data\n   * @param {Boolean} [rebuild] - whether or not to rebuild the representation\n   * @return {SurfaceRepresentation} this object\n   */\n  setParameters (params: Partial<SurfaceRepresentationParameters>, what?: SurfaceDataFields, rebuild?: boolean) {\n    if (params && params.isolevelType !== undefined &&\n      this.volume\n    ) {\n      if (this.isolevelType === 'value' &&\n        params.isolevelType === 'sigma'\n      ) {\n        this.isolevel = this.volume.getSigmaForValue(this.isolevel)\n      } else if (this.isolevelType === 'sigma' &&\n        params.isolevelType === 'value'\n      ) {\n        this.isolevel = this.volume.getValueForSigma(this.isolevel)\n      }\n\n      this.isolevelType = params.isolevelType\n    }\n\n    if (params && params.boxCenter) {\n      this.boxCenter.copy(params.boxCenter)\n      delete params.boxCenter\n    }\n\n    // Forbid wireframe && contour as in molsurface\n    if (params && params.wireframe && (\n      params.contour || (params.contour === undefined && this.contour)\n    )) {\n      params.wireframe = false\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    if (params.matrix) {\n      this.inverseMatrix.getInverse(params.matrix)\n    }\n\n    if (this.volume) {\n      this.volume.getBox(this.boxCenter, this.boxSize, this.box)\n    }\n\n    if (params && params.colorVolume !== undefined) {\n      if (what) what.color = true\n    }\n\n    if (this.surface && (\n      params.isolevel !== undefined ||\n      params.negateIsolevel !== undefined ||\n      params.smooth !== undefined ||\n      params.wrap !== undefined ||\n      params.boxSize !== undefined ||\n      (this.boxSize > 0 &&\n        !this.__box.equals(this.box))\n    )) {\n      this.build({\n        'position': true,\n        'color': true,\n        'index': true,\n        'normal': !this.contour\n      })\n    }\n\n    return this\n  }\n\n  getColorParams () {\n    const p = super.getColorParams()\n\n    p.volume = this.colorVolume\n\n    return p\n  }\n\n  dispose () {\n    this.viewer.signals.ticked.remove(this.setBox, this)\n\n    super.dispose()\n  }\n}\n\nexport default SurfaceRepresentation\n","/**\n * @file Mouse Actions\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport PickingProxy from './picking-proxy'\nimport { almostIdentity } from '../math/math-utils'\nimport Stage from '../stage/stage'\nimport StructureComponent from '../component/structure-component'\nimport SurfaceRepresentation from '../representation/surface-representation'\n\nexport type ScrollCallback = (stage: Stage, delta: number) => void\nexport type DragCallback = (stage: Stage, dx: number, dy: number) => void\nexport type PickCallback = (stage: Stage, pickingProxy: PickingProxy) => void\nexport type MouseActionCallback = ScrollCallback | DragCallback | PickCallback\n\n/**\n * Mouse actions provided as static methods\n */\nclass MouseActions {\n  /**\n   * Zoom scene based on scroll-delta\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to zoom\n   * @return {undefined}\n   */\n  static zoomScroll (stage: Stage, delta: number) {\n    stage.trackballControls.zoom(delta)\n  }\n\n  /**\n   * Move near clipping plane based on scroll-delta\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to move clipping plane\n   * @return {undefined}\n   */\n  static clipNearScroll (stage: Stage, delta: number) {\n    const sp = stage.getParameters()\n    stage.setParameters({ clipNear: sp.clipNear + delta / 10 })\n  }\n\n  /**\n   * Move clipping planes based on scroll-delta.\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - direction to move planes\n   * @return {undefined}\n   */\n  static focusScroll (stage: Stage, delta: number) {\n    const focus = stage.getFocus()\n    const sign = Math.sign(delta)\n    const step = sign * almostIdentity((100 - focus) / 10, 5, 0.2)\n    stage.setFocus(focus + step)\n  }\n\n  /**\n   * Zoom scene based on scroll-delta and\n   * move focus planes based on camera position (zoom)\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to move focus planes and zoom\n   * @return {undefined}\n   */\n  static zoomFocusScroll (stage: Stage, delta: number) {\n    stage.trackballControls.zoom(delta)\n    const z = stage.viewer.camera.position.z\n    stage.setFocus(100 - Math.abs(z / 8))\n  }\n\n  /**\n   * Change isolevel of volume surfaces based on scroll-delta\n   * @param {Stage} stage - the stage\n   * @param {Number} delta - amount to change isolevel\n   * @return {undefined}\n   */\n  static isolevelScroll (stage: Stage, delta: number) {\n    const d = Math.sign(delta) / 10\n    stage.eachRepresentation((reprElem, comp) => {\n      if (reprElem.repr instanceof SurfaceRepresentation) {\n        const p = reprElem.getParameters() as any  // TODO\n        if (p.isolevelScroll) {\n          reprElem.setParameters({ isolevel: p.isolevel + d })\n        }\n      }\n    })\n  }\n\n  /**\n   * Pan scene based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to pan in x direction\n   * @param {Number} dy - amount to pan in y direction\n   * @return {undefined}\n   */\n  static panDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.pan(dx, dy)\n  }\n\n  /**\n   * Rotate scene based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to rotate in x direction\n   * @param {Number} dy - amount to rotate in y direction\n   * @return {undefined}\n   */\n  static rotateDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.rotate(dx, dy)\n  }\n\n  /**\n   * Rotate scene around z axis based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to rotate in x direction\n   * @param {Number} dy - amount to rotate in y direction\n   * @return {undefined}\n   */\n  static zRotateDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.zRotate(dx, dy)\n  }\n\n  /**\n   * Zoom scene based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to zoom\n   * @param {Number} dy - amount to zoom\n   * @return {undefined}\n   */\n  static zoomDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.zoom((dx + dy) / -2)\n  }\n\n  /**\n   * Zoom scene based on mouse coordinate changes and\n   * move focus planes based on camera position (zoom)\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to zoom and focus\n   * @param {Number} dy - amount to zoom and focus\n   * @return {undefined}\n   */\n  static zoomFocusDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.zoom((dx + dy) / -2)\n    const z = stage.viewer.camera.position.z\n    stage.setFocus(100 - Math.abs(z / 8))\n  }\n\n  /**\n   * Pan picked component based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to pan in x direction\n   * @param {Number} dy - amount to pan in y direction\n   * @return {undefined}\n   */\n  static panComponentDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.panComponent(dx, dy)\n  }\n\n  /**\n   * Pan picked atom based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to pan in x direction\n   * @param {Number} dy - amount to pan in y direction\n   * @return {undefined}\n   */\n  static panAtomDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.panAtom(dx, dy)\n  }\n\n  /**\n   * Rotate picked component based on mouse coordinate changes\n   * @param {Stage} stage - the stage\n   * @param {Number} dx - amount to rotate in x direction\n   * @param {Number} dy - amount to rotate in y direction\n   * @return {undefined}\n   */\n  static rotateComponentDrag (stage: Stage, dx: number, dy: number) {\n    stage.trackballControls.rotateComponent(dx, dy)\n  }\n\n  /**\n   * Move picked element to the center of the screen\n   * @param {Stage} stage - the stage\n   * @param {PickingProxy} pickingProxy - the picking data object\n   * @return {undefined}\n   */\n  static movePick (stage: Stage, pickingProxy: PickingProxy) {\n    if (pickingProxy) {\n      stage.animationControls.move(pickingProxy.position.clone())\n    }\n  }\n\n  /**\n   * Show tooltip with information of picked element\n   * @param {Stage} stage - the stage\n   * @param {PickingProxy} pickingProxy - the picking data object\n   * @return {undefined}\n   */\n  static tooltipPick (stage: Stage, pickingProxy: PickingProxy) {\n    const tt = stage.tooltip\n    const sp = stage.getParameters() as any\n    if (sp.tooltip && pickingProxy) {\n      const mp = pickingProxy.mouse.position\n      tt.innerText = pickingProxy.getLabel()\n      tt.style.bottom = (window.innerHeight - mp.y + 3) + 'px'\n      tt.style.left = (mp.x + 3) + 'px'\n      tt.style.display = 'block'\n    } else {\n      tt.style.display = 'none'\n    }\n  }\n\n  static measurePick (stage: Stage, pickingProxy: PickingProxy) {\n    if (pickingProxy && (pickingProxy.atom || pickingProxy.bond)) {\n      const atom = pickingProxy.atom || pickingProxy.closestBondAtom\n      const sc = pickingProxy.component as StructureComponent\n      sc.measurePick(atom)\n    } else {\n      stage.measureClear()\n    }\n  }\n}\n\ntype MouseActionPreset = [ string, MouseActionCallback ][]\nexport const MouseActionPresets = {\n  default: [\n    [ 'scroll', MouseActions.zoomScroll ],\n    [ 'scroll-shift', MouseActions.focusScroll ],\n    [ 'scroll-ctrl', MouseActions.isolevelScroll ],\n    [ 'scroll-shift-ctrl', MouseActions.zoomFocusScroll ],\n\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-right', MouseActions.panDrag ],\n    [ 'drag-ctrl-left', MouseActions.panDrag ],\n    [ 'drag-ctrl-right', MouseActions.zRotateDrag ],\n    [ 'drag-shift-left', MouseActions.zoomDrag ],\n    [ 'drag-middle', MouseActions.zoomFocusDrag ],\n\n    [ 'drag-ctrl-shift-right', MouseActions.panComponentDrag ],\n    [ 'drag-ctrl-shift-left', MouseActions.rotateComponentDrag ],\n\n    [ 'clickPick-right', MouseActions.measurePick ],\n    [ 'clickPick-ctrl-left', MouseActions.measurePick ],\n    [ 'clickPick-middle', MouseActions.movePick ],\n    [ 'clickPick-left', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset,\n  pymol: [\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-middle', MouseActions.panDrag ],\n    [ 'drag-right', MouseActions.zoomDrag ],\n    [ 'drag-shift-right', MouseActions.focusScroll ],\n\n    [ 'clickPick-ctrl+shift-middle', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset,\n  coot: [\n    [ 'scroll', MouseActions.isolevelScroll ],\n\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-middle', MouseActions.panDrag ],\n    [ 'drag-ctrl-left', MouseActions.panDrag ],\n    [ 'drag-right', MouseActions.zoomFocusDrag ],\n    [ 'drag-ctrl-right', MouseActions.focusScroll ],\n\n    [ 'clickPick-middle', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset,\n  astexviewer: [\n    [ 'drag-left', MouseActions.rotateDrag ],\n    [ 'drag-ctrl-left', MouseActions.panDrag ],\n    [ 'drag-shift-left', MouseActions.zoomDrag ],\n    [ 'scroll', MouseActions.focusScroll ],\n    [ 'clickPick-middle', MouseActions.movePick ],\n    [ 'hoverPick', MouseActions.tooltipPick ]\n  ] as MouseActionPreset\n}\n\nexport default MouseActions\n","/**\n * @file Mouse Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { MouseActionPresets, MouseActionCallback } from './mouse-actions'\nimport Stage from '../stage/stage'\nimport MouseObserver from '../stage/mouse-observer'\n\nexport type MouseControlPreset = keyof typeof MouseActionPresets\nexport interface MouseControlsParams {\n  preset?: MouseControlPreset\n  disabled?: boolean\n}\n\nexport type MouseActionType = ''|'scroll'|'drag'|'click'|'doubleClick'|'hover'|'clickPick'|'hoverPick'\nexport interface MouseAction {\n  type: MouseActionType\n  key: number\n  button: number\n  callback: MouseActionCallback\n}\n\n/**\n * Strings to describe mouse events (including optional keyboard modifiers).\n * Must contain an event type: \"scroll\", \"drag\", \"click\", \"doubleClick\",\n * \"hover\", \"clickPick\" or \"hoverPick\". Optionally contain one or more\n * (seperated by plus signs) keyboard modifiers: \"alt\", \"ctrl\", \"meta\" or\n * \"shift\". Can contain the mouse button performing the event: \"left\",\n * \"middle\" or \"right\". The type, key and button parts must be seperated by\n * dashes.\n *\n * @example\n * // triggered on scroll event (no key or button)\n * \"scroll\"\n *\n * @example\n * // triggered on scroll event while shift key is pressed\n * \"scroll-shift\"\n *\n * @example\n * // triggered on drag event with left mouse button\n * \"drag-left\"\n *\n * @example\n * // triggered on drag event with right mouse button\n * // while ctrl and shift keys are pressed\n * \"drag-right-ctrl+shift\"\n *\n * @typedef {String} TriggerString\n */\n\n/**\n * Get event type, key and button\n * @param  {TriggerString} str - input trigger string\n * @return {Array} event type, key and button\n */\nfunction triggerFromString (str: string) {\n  const tokens = str.split(/[-+]/)\n\n  let type = ''\n  if (tokens.includes('scroll')) type = 'scroll'\n  if (tokens.includes('drag')) type = 'drag'\n  if (tokens.includes('click')) type = 'click'\n  if (tokens.includes('doubleClick')) type = 'doubleClick'\n  if (tokens.includes('hover')) type = 'hover'\n  if (tokens.includes('clickPick')) type = 'clickPick'\n  if (tokens.includes('hoverPick')) type = 'hoverPick'\n\n  let key = 0\n  if (tokens.includes('alt')) key += 1\n  if (tokens.includes('ctrl')) key += 2\n  if (tokens.includes('meta')) key += 4\n  if (tokens.includes('shift')) key += 8\n\n  let button = 0\n  if (tokens.includes('left')) button += 1\n  if (tokens.includes('right')) button += 2\n  if (tokens.includes('middle')) button += 4\n\n  return [ type, key, button ] as [ MouseActionType, number, number ]\n}\n\n/**\n * Mouse controls\n */\nclass MouseControls {\n  actionList: MouseAction[] = []\n  mouse: MouseObserver\n\n  disabled: boolean  // Flag to disable all actions\n\n  /**\n   * @param {Stage} stage - the stage object\n   * @param {Object} [params] - the parameters\n   * @param {String} params.preset - one of \"default\", \"pymol\", \"coot\"\n   * @param {String} params.disabled - flag to disable all actions\n   */\n  constructor (readonly stage: Stage, params: MouseControlsParams = {}) {\n    this.mouse = stage.mouseObserver\n    this.disabled = params.disabled || false\n    this.preset(params.preset || 'default')\n  }\n\n  run (type: MouseActionType, ...args: any[]) {\n    if (this.disabled) return\n\n    const key = this.mouse.key || 0\n    const button = this.mouse.buttons || 0\n\n    this.actionList.forEach(a => {\n      if (a.type === type && a.key === key && a.button === button) {\n        (a.callback as any)(this.stage, ...args)  // TODO\n      }\n    })\n  }\n\n  /**\n   * Add a new mouse action triggered by an event, key and button combination.\n   * The {@link MouseActions} class provides a number of static methods for\n   * use as callback functions.\n   *\n   * @example\n   * // change ambient light intensity on mouse scroll\n   * // while the ctrl and shift keys are pressed\n   * stage.mouseControls.add( \"scroll-ctrl+shift\", function( stage, delta ){\n   *     var ai = stage.getParameters().ambientIntensity;\n   *     stage.setParameters( { ambientIntensity: Math.max( 0, ai + delta / 50 ) } );\n   * } );\n   *\n   * @example\n   * // Call the MouseActions.zoomDrag method on mouse drag events\n   * // with left and right mouse buttons simultaneous\n   * stage.mouseControls.add( \"drag-left+right\", MouseActions.zoomDrag );\n   *\n   * @param {TriggerString} triggerStr - the trigger for the action\n   * @param {function(stage: Stage, ...args: Any)} callback - the callback function for the action\n   * @return {undefined}\n   */\n  add (triggerStr: string, callback: MouseActionCallback) {\n    const [ type, key, button ] = triggerFromString(triggerStr)\n\n    this.actionList.push({ type, key, button, callback })\n  }\n\n  /**\n   * Remove a mouse action. The trigger string can contain an asterix (*)\n   * as a wildcard for any key or mouse button. When the callback function\n   * is given, only actions that call that function are removed.\n   *\n   * @example\n   * // remove actions triggered solely by a scroll event\n   * stage.mouseControls.remove( \"scroll\" );\n   *\n   * @example\n   * // remove actions triggered by a scroll event, including\n   * // those requiring a key pressed or mouse button used\n   * stage.mouseControls.remove( \"scroll-*\" );\n   *\n   * @example\n   * // remove actions triggered by a scroll event\n   * // while the shift key is pressed\n   * stage.mouseControls.remove( \"scroll-shift\" );\n   *\n   * @param {TriggerString} triggerStr - the trigger for the action\n   * @param {Function} [callback] - the callback function for the action\n   * @return {undefined}\n   */\n  remove (triggerStr: string, callback?: MouseActionCallback) {\n    const wildcard = triggerStr.includes('*')\n    const [ type, key, button ] = triggerFromString(triggerStr)\n\n    const actionList = this.actionList.filter(function (a) {\n      return !(\n        (a.type === type || (wildcard && type === '')) &&\n        (a.key === key || (wildcard && key === 0)) &&\n        (a.button === button || (wildcard && button === 0)) &&\n        (a.callback === callback || callback === undefined)\n      )\n    })\n\n    this.actionList = actionList\n  }\n\n  /**\n   * Set mouse action preset\n   * @param  {String} name - one of \"default\", \"pymol\", \"coot\"\n   * @return {undefined}\n   */\n  preset (name: MouseControlPreset) {\n    this.clear()\n\n    const list = MouseActionPresets[ name ] || []\n\n    list.forEach(action => this.add(action[0], action[1]))\n  }\n\n  /**\n   * Remove all mouse actions\n   * @return {undefined}\n   */\n  clear () {\n    this.actionList.length = 0\n  }\n}\n\nexport default MouseControls\n","/**\n * @file Key Actions\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from '../stage/stage'\n\nexport type KeyActionCallback = (stage: Stage) => void\n\n/**\n * Key actions provided as static methods\n */\nclass KeyActions {\n  /**\n   * Stage auto view\n   */\n  static autoView (stage: Stage) {\n    stage.autoView(1000)\n  }\n\n  /**\n   * Toggle stage animations\n   */\n  static toggleAnimations (stage: Stage) {\n    stage.animationControls.toggle()\n  }\n\n  /**\n   * Toggle stage rocking\n   */\n  static toggleRock (stage: Stage) {\n    stage.toggleRock()\n  }\n\n  /**\n   * Toggle stage spinning\n   */\n  static toggleSpin (stage: Stage) {\n    stage.toggleSpin()\n  }\n\n  /**\n   * Toggle anti-aliasing\n   */\n  static toggleAntialiasing (stage: Stage) {\n    const p = stage.getParameters()\n    stage.setParameters({ sampleLevel: p.sampleLevel === -1 ? 0 : -1 })\n  }\n}\n\ntype KeyActionPreset = [ string, KeyActionCallback ][]\nexport const KeyActionPresets = {\n  default: [\n    [ 'i', KeyActions.toggleSpin ],\n    [ 'k', KeyActions.toggleRock ],\n    [ 'p', KeyActions.toggleAnimations ],\n    [ 'a', KeyActions.toggleAntialiasing ],\n    [ 'r', KeyActions.autoView ]\n  ] as KeyActionPreset\n}\n\nexport default KeyActions\n","/**\n * @file Key Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { KeyActionPresets, KeyActionCallback } from './key-actions'\nimport Stage from '../stage/stage'\n\nexport type KeyControlPreset = keyof typeof KeyActionPresets\nexport interface KeyControlsParams {\n  preset?: KeyControlPreset\n  disabled?: boolean\n}\n\nexport interface KeyAction {\n  key: string,\n  callback: KeyActionCallback\n}\n\n/**\n * Mouse controls\n */\nclass KeyControls {\n  actionList: KeyAction[] = []\n\n  disabled: boolean  // Flag to disable all actions\n\n  /**\n   * @param {Stage} stage - the stage object\n   * @param {Object} [params] - the parameters\n   * @param {String} params.preset - one of \"default\"\n   * @param {String} params.disabled - flag to disable all actions\n   */\n  constructor (readonly stage: Stage, params: KeyControlsParams = {}) {\n    this.disabled = params.disabled || false\n    this.preset(params.preset || 'default')\n  }\n\n  run (key: string) {\n    if (this.disabled) return\n\n    this.actionList.forEach(a => {\n      if (a.key === key) {\n        a.callback(this.stage)\n      }\n    })\n  }\n\n  /**\n   * Add a key action triggered by pressing the given character.\n   * The {@link KeyActions} class provides a number of static methods for\n   * use as callback functions.\n   *\n   * @example\n   * // call KeyActions.toggleRock when \"k\" is pressed\n   * stage.keyControls.remove( \"k\", KeyActions.toggleRock );\n   *\n   * @param {Char} char - the key/character\n   * @param {Function} callback - the callback function for the action\n   * @return {undefined}\n   */\n  add (char: string, callback: KeyActionCallback) {\n    this.actionList.push({ key: char, callback })\n  }\n\n  /**\n   * Remove a key action. When the callback function\n   * is given, only actions that call that function are removed.\n   *\n   * @example\n   * // remove all actions triggered by pressing \"k\"\n   * stage.keyControls.remove( \"k\" );\n   *\n   * @example\n   * // remove action `toggleRock` triggered by pressing \"k\"\n   * stage.keyControls.remove( \"k\", toggleRock );\n   *\n   * @param {Char} char - the key/character\n   * @param {Function} [callback] - the callback function for the action\n   * @return {undefined}\n   */\n  remove (char: string, callback: KeyActionCallback) {\n\n    const actionList = this.actionList.filter(function (a) {\n      return !(\n        (a.key === char) &&\n        (a.callback === callback || callback === undefined)\n      )\n    })\n\n    this.actionList = actionList\n  }\n\n  /**\n   * Set key action preset\n   * @param  {String} name - one of \"default\"\n   * @return {undefined}\n   */\n  preset (name: KeyControlPreset) {\n    this.clear()\n\n    const list = KeyActionPresets[ name ] || []\n\n    list.forEach(action => this.add(action[0], action[1]))\n  }\n\n  /**\n   * Remove all key actions\n   * @return {undefined}\n   */\n  clear () {\n    this.actionList.length = 0\n  }\n}\n\nexport default KeyControls\n","/**\n * @file Picking Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from './stage'\nimport MouseObserver from './mouse-observer'\nimport Viewer from '../viewer/viewer'\nimport MouseControls from '../controls/mouse-controls'\n\nclass PickingBehavior {\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: MouseControls\n\n  constructor (readonly stage: Stage) {\n    this.stage = stage\n    this.mouse = stage.mouseObserver\n    this.controls = stage.mouseControls\n\n    this.mouse.signals.clicked.add(this._onClick, this)\n    this.mouse.signals.hovered.add(this._onHover, this)\n  }\n\n  _onClick (x: number, y: number) {\n    const pickingProxy = this.stage.pickingControls.pick(x, y)\n    this.stage.signals.clicked.dispatch(pickingProxy)\n    this.controls.run('clickPick', pickingProxy)\n  }\n\n  _onHover (x: number, y: number) {\n    const pickingProxy = this.stage.pickingControls.pick(x, y)\n    if (pickingProxy && this.mouse.down.equals(this.mouse.position)) {\n      this.stage.transformComponent = pickingProxy.component\n      this.stage.transformAtom = pickingProxy.atom\n    }\n    this.stage.signals.hovered.dispatch(pickingProxy)\n    this.controls.run('hoverPick', pickingProxy)\n  }\n\n  dispose () {\n    this.mouse.signals.clicked.remove(this._onClick, this)\n    this.mouse.signals.hovered.remove(this._onHover, this)\n  }\n}\n\nexport default PickingBehavior\n","/**\n * @file Mouse Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from './stage'\nimport MouseObserver from './mouse-observer'\nimport Viewer from '../viewer/viewer'\nimport MouseControls from '../controls/mouse-controls'\n\nclass MouseBehavior {\n  viewer: Viewer\n  mouse: MouseObserver\n  controls: MouseControls\n  domElement: HTMLCanvasElement\n\n  constructor (readonly stage: Stage) {\n    this.stage = stage\n    this.mouse = stage.mouseObserver\n    this.controls = stage.mouseControls\n\n    this.mouse.signals.moved.add(this._onMove, this)\n    this.mouse.signals.scrolled.add(this._onScroll, this)\n    this.mouse.signals.dragged.add(this._onDrag, this)\n    this.mouse.signals.clicked.add(this._onClick, this)\n    this.mouse.signals.hovered.add(this._onHover, this)\n    this.mouse.signals.doubleClicked.add(this._onDblclick, this)\n  }\n\n  _onMove (/* x, y */) {\n    this.stage.tooltip.style.display = 'none'\n  }\n\n  _onScroll (delta: number) {\n    this.controls.run('scroll', delta)\n  }\n\n  _onDrag (dx: number, dy: number) {\n    this.controls.run('drag', dx, dy)\n  }\n\n  _onClick (x: number, y: number) {\n    this.controls.run('click', x, y)\n  }\n\n  _onDblclick (x: number, y: number) {\n    this.controls.run('doubleClick', x, y)\n  }\n\n  _onHover (x: number, y: number) {\n    this.controls.run('hover', x, y)\n  }\n\n  dispose () {\n    this.mouse.signals.moved.remove(this._onMove, this)\n    this.mouse.signals.scrolled.remove(this._onScroll, this)\n    this.mouse.signals.dragged.remove(this._onDrag, this)\n    this.mouse.signals.clicked.remove(this._onClick, this)\n    this.mouse.signals.hovered.remove(this._onHover, this)\n  }\n}\n\nexport default MouseBehavior\n","/**\n * @file Animation Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Stage from './stage'\nimport Viewer from '../viewer/viewer'\nimport Stats from '../viewer/stats'\nimport AnimationControls from '../controls/animation-controls'\n\nclass AnimationBehavior {\n  viewer: Viewer\n  animationControls: AnimationControls\n\n  constructor (readonly stage: Stage) {\n    this.viewer = stage.viewer\n    this.animationControls = stage.animationControls\n\n    this.viewer.signals.ticked.add(this._onTick, this)\n  }\n\n  _onTick (stats: Stats) {\n    this.animationControls.run(stats)\n  }\n\n  dispose () {\n    this.viewer.signals.ticked.remove(this._onTick, this)\n  }\n}\n\nexport default AnimationBehavior\n","/**\n * @file Key Behavior\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { SupportsPassiveEventHandler } from '../globals'\nimport Stage from './stage'\nimport Viewer from '../viewer/viewer'\nimport KeyControls from '../controls/key-controls'\n\nconst passive = SupportsPassiveEventHandler ? { passive: true } : false\n\nclass KeyBehavior {\n  viewer: Viewer\n  controls: KeyControls\n  domElement: HTMLCanvasElement\n\n  /**\n   * @param {Stage} stage - the stage object\n   */\n  constructor (readonly stage: Stage) {\n    this.stage = stage\n    this.controls = stage.keyControls\n    this.domElement = stage.viewer.renderer.domElement\n\n    // ensure the domElement is focusable\n    this.domElement.setAttribute('tabIndex', '-1')\n    this.domElement.style.outline = 'none'\n\n    this._focusDomElement = this._focusDomElement.bind(this)\n    this._onKeydown = this._onKeydown.bind(this)\n    this._onKeyup = this._onKeyup.bind(this)\n    this._onKeypress = this._onKeypress.bind(this)\n\n    this.domElement.addEventListener('mousedown', this._focusDomElement)\n    this.domElement.addEventListener('touchstart', this._focusDomElement, passive as any)  // TODO\n    this.domElement.addEventListener('keydown', this._onKeydown)\n    this.domElement.addEventListener('keyup', this._onKeyup)\n    this.domElement.addEventListener('keypress', this._onKeypress)\n  }\n\n  /**\n   * handle key down\n   * @param  {Event} event - key event\n   * @return {undefined}\n   */\n  _onKeydown (/* event */) {\n    // console.log( \"down\", event.keyCode, String.fromCharCode( event.keyCode ) );\n  }\n\n  /**\n   * handle key up\n   * @param  {Event} event - key event\n   * @return {undefined}\n   */\n  _onKeyup (/* event */) {\n    // console.log( \"up\", event.keyCode, String.fromCharCode( event.keyCode ) );\n  }\n\n  /**\n   * handle key press\n   * @param  {Event} event - key event\n   * @return {undefined}\n   */\n  _onKeypress (event: KeyboardEvent) {\n    // console.log( \"press\", event.keyCode, String.fromCharCode( event.keyCode ) );\n    let pressedKey: string;\n    if (\"key\" in KeyboardEvent.prototype) {\n      pressedKey = event.key;\n    // some mobile browsers don't support this attribute\n    } else {\n      pressedKey = String.fromCharCode(event.which || event.keyCode);\n    }\n    this.controls.run(pressedKey);\n  }\n\n  _focusDomElement () {\n    this.domElement.focus()\n  }\n\n  dispose () {\n    this.domElement.removeEventListener('mousedown', this._focusDomElement)\n    this.domElement.removeEventListener('touchstart', this._focusDomElement, passive as any)  // TODO\n    this.domElement.removeEventListener('keydown', this._onKeypress)\n    this.domElement.removeEventListener('keyup', this._onKeypress)\n    this.domElement.removeEventListener('keypress', this._onKeypress)\n  }\n}\n\nexport default KeyBehavior\n","/**\n * @file Annotation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector2, Vector3 } from 'three'\n\nimport { defaults } from '../utils'\nimport { smoothstep } from '../math/math-utils'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\nimport Component from './component'\n\nexport interface AnnotationParams {\n  offsetX?: number\n  offsetY?: number\n  visible?: boolean\n}\n\n/**\n * Annotation HTML element floating on top of a position rendered in 3d\n */\nexport default class Annotation {\n  offsetX: number\n  offsetY: number\n  visible: boolean\n\n  stage: Stage\n  viewer: Viewer\n  element: HTMLElement\n\n  private _viewerPosition: Vector3\n  private _canvasPosition: Vector2\n  private _cameraPosition: Vector3\n  private _clientRect: ClientRect\n\n  /**\n   * @param {Component} component - the associated component\n   * @param {Vector3} position - position in 3d\n   * @param {String|Element} content - HTML content\n   * @param {Object} [params] - parameters\n   * @param {Integer} params.offsetX - 2d offset in x direction\n   * @param {Integer} params.offsetY - 2d offset in y direction\n   * @param {Boolean} params.visible - visibility flag\n   */\n  constructor (readonly component: Component, readonly position: Vector3, content: string|HTMLElement, params: AnnotationParams = {}) {\n    this.offsetX = defaults(params.offsetX, 0)\n    this.offsetY = defaults(params.offsetY, 0)\n    this.visible = defaults(params.visible, true)\n\n    this.stage = component.stage\n    this.viewer = component.stage.viewer\n\n    this._viewerPosition = new Vector3()\n    this._updateViewerPosition()\n    this._canvasPosition = new Vector2()\n    this._cameraPosition = new Vector3()\n\n    this.element = document.createElement('div')\n    Object.assign(this.element.style, {\n      display: 'block',\n      position: 'absolute',\n      pointerEvents: 'none',\n      whiteSpace: 'nowrap',\n      left: '-10000px'\n    })\n\n    this.viewer.wrapper.appendChild(this.element)\n    this.setContent(content)\n    this.updateVisibility()\n    this.viewer.signals.rendered.add(this._update, this)\n    this.component.signals.matrixChanged.add(this._updateViewerPosition, this)\n  }\n\n  /**\n   * Set HTML content of the annotation\n   * @param {String|Element} value - HTML content\n   * @return {undefined}\n   */\n  setContent (value: string|HTMLElement) {\n    const displayValue = this.element.style.display\n    if (displayValue === 'none') {\n      this.element.style.left = '-10000px'\n      this.element.style.display = 'block'\n    }\n\n    if (value instanceof HTMLElement) {\n      this.element.appendChild(value)\n    } else {\n      const content = document.createElement('div')\n      content.innerText = value\n      Object.assign(content.style, {\n        backgroundColor: 'rgba( 0, 0, 0, 0.6 )',\n        color: 'lightgrey',\n        padding: '8px',\n        fontFamily: 'sans-serif',\n      })\n      this.element.appendChild(content)\n    }\n\n    this._clientRect = this.element.getBoundingClientRect()\n\n    if (displayValue === 'none') {\n      this.element.style.display = displayValue\n    }\n  }\n\n  /**\n   * Set visibility of the annotation\n   * @param {Boolean} value - visibility flag\n   * @return {undefined}\n   */\n  setVisibility (value: boolean) {\n    this.visible = value\n    this.updateVisibility()\n  }\n\n  getVisibility () {\n    return this.visible && this.component.parameters.visible\n  }\n\n  updateVisibility () {\n    this.element.style.display = this.getVisibility() ? 'block' : 'none'\n  }\n\n  _updateViewerPosition () {\n    this._viewerPosition\n      .copy(this.position)\n      .applyMatrix4(this.component.matrix)\n  }\n\n  _update () {\n    if (!this.getVisibility()) return\n\n    const s = this.element.style\n    const cp = this._canvasPosition\n    const vp = this._viewerPosition\n    const cr = this._clientRect\n\n    this._cameraPosition.copy(vp)\n      .add(this.viewer.translationGroup.position)\n      .applyMatrix4(this.viewer.rotationGroup.matrix)\n      .sub(this.viewer.camera.position)\n\n    if (this._cameraPosition.z < 0) {\n      s.display = 'none'\n      return\n    } else {\n      s.display = 'block'\n    }\n\n    const depth = this._cameraPosition.length()\n    const fog = this.viewer.scene.fog as any  // TODO\n\n    s.opacity = (1 - smoothstep(fog.near, fog.far, depth)).toString()\n    s.zIndex = (Math.round((fog.far - depth) * 100)).toString()\n\n    this.stage.viewerControls.getPositionOnCanvas(vp, cp)\n\n    s.bottom = (this.offsetX + cp.y + cr.height / 2) + 'px'\n    s.left = (this.offsetY + cp.x - cr.width / 2) + 'px'\n  }\n\n  /**\n   * Safely remove the annotation\n   * @return {undefined}\n   */\n  dispose () {\n    this.viewer.wrapper.removeChild(this.element)\n    this.viewer.signals.ticked.remove(this._update, this)\n    this.component.signals.matrixChanged.remove(this._updateViewerPosition, this)\n  }\n}","/**\n * @file Component Controls\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Quaternion } from 'three'\nimport * as signalsWrapper from 'signals'\n\nimport { ensureVector3 } from '../utils'\nimport Component from '../component/component'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\nconst tmpRotateMatrix = new Matrix4()\nconst tmpRotateVector = new Vector3()\nconst tmpRotateQuaternion = new Quaternion()\n\n/**\n * Component controls\n */\nclass ComponentControls {\n  signals = {\n    changed: new signalsWrapper.Signal()\n  }\n\n  stage: Stage\n  viewer: Viewer\n\n  /**\n   * @param  {Component} component - the component object\n   */\n  constructor (readonly component: Component) {\n    this.stage = component.stage\n    this.viewer = component.stage.viewer\n  }\n\n  /**\n   * component center position\n   * @type {Vector3}\n   */\n  get position () {\n    return this.component.position\n  }\n\n  /**\n   * component rotation\n   * @type {Quaternion}\n   */\n  get rotation () {\n    return this.component.quaternion\n  }\n\n  /**\n   * Trigger render and emit changed event\n   * @emits {ComponentControls.signals.changed}\n   * @return {undefined}\n   */\n  changed () {\n    this.component.updateMatrix()\n    this.viewer.requestRender()\n    this.signals.changed.dispatch()\n  }\n\n  /**\n   * spin component on axis\n   * @param  {Vector3|Array} axis - rotation axis\n   * @param  {Number} angle - amount to spin\n   * @return {undefined}\n   */\n  spin (axis: Vector3, angle: number) {\n    tmpRotateMatrix.getInverse(this.viewer.rotationGroup.matrix)\n    tmpRotateVector\n      .copy(ensureVector3(axis)).applyMatrix4(tmpRotateMatrix)\n\n    tmpRotateMatrix.extractRotation(this.component.transform)\n    tmpRotateMatrix.premultiply(this.viewer.rotationGroup.matrix)\n    tmpRotateMatrix.getInverse(tmpRotateMatrix)\n\n    tmpRotateVector.copy(ensureVector3(axis))\n    tmpRotateVector.applyMatrix4(tmpRotateMatrix)\n    tmpRotateMatrix.makeRotationAxis(tmpRotateVector, angle)\n    tmpRotateQuaternion.setFromRotationMatrix(tmpRotateMatrix)\n\n    this.component.quaternion.premultiply(tmpRotateQuaternion)\n    this.changed()\n  }\n}\n\nexport default ComponentControls\n","/**\n * @file Radius Factory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { NucleicBackboneAtoms } from '../structure/structure-constants'\nimport AtomProxy from '../proxy/atom-proxy'\n\nexport const RadiusFactoryTypes = {\n  '': '',\n  'vdw': 'by vdW radius',\n  'covalent': 'by covalent radius',\n  'sstruc': 'by secondary structure',\n  'bfactor': 'by bfactor',\n  'size': 'size',\n  'data': 'data',\n  'explicit' : 'explicit'\n}\nexport type RadiusType = keyof typeof RadiusFactoryTypes\n\nexport interface RadiusParams {\n  type?: RadiusType\n  scale?: number\n  size?: number\n  data?: { [k: number]: number }\n}\n\nclass RadiusFactory {\n  max = 10\n\n  static types = RadiusFactoryTypes\n\n  readonly type: RadiusType\n  readonly scale: number\n  readonly size: number\n  readonly data: { [k: number]: number }\n\n  constructor (params: RadiusParams = {}) {\n    this.type = defaults(params.type, 'size')\n    this.scale = defaults(params.scale, 1)\n    this.size = defaults(params.size, 1)\n    this.data = defaults(params.data, {})\n  }\n\n  atomRadius (a: AtomProxy) {\n    let r\n\n    switch (this.type) {\n      case 'vdw':\n        r = a.vdw\n        break\n\n      case 'covalent':\n        r = a.covalent\n        break\n\n      case 'bfactor':\n        r = a.bfactor || 1.0\n        break\n\n      case 'sstruc':\n        const sstruc = a.sstruc\n        if (sstruc === 'h') {\n          r = 0.25\n        } else if (sstruc === 'g') {\n          r = 0.25\n        } else if (sstruc === 'i') {\n          r = 0.25\n        } else if (sstruc === 'e') {\n          r = 0.25\n        } else if (sstruc === 'b') {\n          r = 0.25\n        } else if (NucleicBackboneAtoms.includes(a.atomname)) {\n          r = 0.4\n        } else {\n          r = 0.1\n        }\n        break\n\n      case 'data':\n        r = defaults(this.data[ a.index ], 1.0)\n        break\n\n      case 'explicit':\n        // defaults is inappropriate as AtomProxy.radius returns\n        // null for missing radii\n        r = a.radius\n        if (r === null) r = this.size\n        break\n\n      default:\n        r = this.size\n        break\n    }\n\n    return Math.min(r * this.scale, this.max)\n  }\n\n}\n\nexport default RadiusFactory\n","/**\n * @file Principal Axes\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4, Quaternion } from 'three'\n\nimport {\n    Matrix, meanRows, subRows, transpose, multiplyABt, svd\n} from './matrix-utils'\nimport { projectPointOnVector } from './vector-utils'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\n\nconst negateVector = new Vector3(-1, -1, -1)\nconst tmpMatrix = new Matrix4()\n\n/**\n * Principal axes\n */\nclass PrincipalAxes {\n  begA: Vector3\n  endA: Vector3\n  begB: Vector3\n  endB: Vector3\n  begC: Vector3\n  endC: Vector3\n\n  center: Vector3\n\n  vecA: Vector3\n  vecB: Vector3\n  vecC: Vector3\n\n  normVecA: Vector3\n  normVecB: Vector3\n  normVecC: Vector3\n\n  /**\n   * @param  {Matrix} points - 3 by N matrix\n   */\n  constructor (points: Matrix) {\n    // console.time( \"PrincipalAxes\" );\n\n    const n = points.rows\n    const n3 = n / 3\n    const pointsT = new Matrix(n, 3)\n    const A = new Matrix(3, 3)\n    const W = new Matrix(1, 3)\n    const U = new Matrix(3, 3)\n    const V = new Matrix(3, 3)\n\n        // calculate\n    const mean = meanRows(points)\n    subRows(points, mean)\n    transpose(pointsT, points)\n    multiplyABt(A, pointsT, pointsT)\n    svd(A, W, U, V)\n\n    // console.log( points, pointsT, mean )\n    // console.log( n, A, W, U, V );\n\n    // center\n    const vm = new Vector3(mean[0], mean[1], mean[2])\n\n    // normalized\n    const van = new Vector3(U.data[0], U.data[3], U.data[6])\n    const vbn = new Vector3(U.data[1], U.data[4], U.data[7])\n    const vcn = new Vector3(U.data[2], U.data[5], U.data[8])\n\n    // scaled\n    const va = van.clone().multiplyScalar(Math.sqrt(W.data[0] / n3))\n    const vb = vbn.clone().multiplyScalar(Math.sqrt(W.data[1] / n3))\n    const vc = vcn.clone().multiplyScalar(Math.sqrt(W.data[2] / n3))\n\n    // points\n    this.begA = vm.clone().sub(va)\n    this.endA = vm.clone().add(va)\n    this.begB = vm.clone().sub(vb)\n    this.endB = vm.clone().add(vb)\n    this.begC = vm.clone().sub(vc)\n    this.endC = vm.clone().add(vc)\n\n    //\n\n    this.center = vm\n\n    this.vecA = va\n    this.vecB = vb\n    this.vecC = vc\n\n    this.normVecA = van\n    this.normVecB = vbn\n    this.normVecC = vcn\n\n    // console.timeEnd( \"PrincipalAxes\" );\n  }\n\n  /**\n   * Get the basis matrix descriping the axes\n   * @param  {Matrix4} [optionalTarget] - target object\n   * @return {Matrix4} the basis\n   */\n  getBasisMatrix (optionalTarget = new Matrix4()) {\n    const basis = optionalTarget\n\n    basis.makeBasis(this.normVecB, this.normVecA, this.normVecC)\n    if (basis.determinant() < 0) {\n      basis.scale(negateVector)\n    }\n\n    return basis\n  }\n\n  /**\n   * Get a quaternion descriping the axes rotation\n   * @param  {Quaternion} [optionalTarget] - target object\n   * @return {Quaternion} the rotation\n   */\n  getRotationQuaternion (optionalTarget = new Quaternion()) {\n    const q = optionalTarget\n    q.setFromRotationMatrix(this.getBasisMatrix(tmpMatrix))\n\n    return q.inverse()\n  }\n\n  /**\n   * Get the scale/length for each dimension for a box around the axes\n   * to enclose the atoms of a structure\n   * @param  {Structure|StructureView} structure - the structure\n   * @return {{d1a: Number, d2a: Number, d3a: Number, d1b: Number, d2b: Number, d3b: Number}} scale\n   */\n  getProjectedScaleForAtoms (structure: Structure) {\n    let d1a = -Infinity\n    let d1b = -Infinity\n    let d2a = -Infinity\n    let d2b = -Infinity\n    let d3a = -Infinity\n    let d3b = -Infinity\n\n    const p = new Vector3()\n    const t = new Vector3()\n\n    const center = this.center\n    const ax1 = this.normVecA\n    const ax2 = this.normVecB\n    const ax3 = this.normVecC\n\n    structure.eachAtom(function (ap: AtomProxy) {\n      projectPointOnVector(p.copy(ap as any), ax1, center)  // TODO\n      const dp1 = t.subVectors(p, center).normalize().dot(ax1)\n      const dt1 = p.distanceTo(center)\n      if (dp1 > 0) {\n        if (dt1 > d1a) d1a = dt1\n      } else {\n        if (dt1 > d1b) d1b = dt1\n      }\n\n      projectPointOnVector(p.copy(ap as any), ax2, center)\n      const dp2 = t.subVectors(p, center).normalize().dot(ax2)\n      const dt2 = p.distanceTo(center)\n      if (dp2 > 0) {\n        if (dt2 > d2a) d2a = dt2\n      } else {\n        if (dt2 > d2b) d2b = dt2\n      }\n\n      projectPointOnVector(p.copy(ap as any), ax3, center)\n      const dp3 = t.subVectors(p, center).normalize().dot(ax3)\n      const dt3 = p.distanceTo(center)\n      if (dp3 > 0) {\n        if (dt3 > d3a) d3a = dt3\n      } else {\n        if (dt3 > d3b) d3b = dt3\n      }\n    })\n\n    return {\n      d1a: d1a,\n      d2a: d2a,\n      d3a: d3a,\n      d1b: -d1b,\n      d2b: -d2b,\n      d3b: -d3b\n    }\n  }\n}\n\nexport default PrincipalAxes\n","/**\n * @file Filtered Volume\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Volume from './volume'\nimport { Box3, Matrix4, Matrix3, Vector3 } from 'three';\n\nclass FilteredVolume {\n  volume: Volume\n  data: Float32Array\n  position: Float32Array\n  atomindex: Int32Array\n  _filterHash: string\n  _dataBuffer: ArrayBuffer\n  _positionBuffer: ArrayBuffer\n  _atomindexBuffer: ArrayBuffer\n  getValueForSigma: typeof Volume.prototype.getValueForSigma\n  getSigmaForValue: typeof Volume.prototype.getSigmaForValue\n  getDataAtomindex: typeof Volume.prototype.getDataAtomindex\n  getDataPosition: typeof Volume.prototype.getDataPosition\n  getDataColor: typeof Volume.prototype.getDataColor\n  getDataPicking: typeof Volume.prototype.getDataPicking\n  getDataSize: typeof Volume.prototype.getDataSize\n\n\n  constructor (volume: Volume, minValue?: number, maxValue?: number, outside?: boolean) {\n    this.volume = volume\n    this.setFilter(minValue, maxValue, outside)\n  }\n\n  get header () { return this.volume.header }\n  get matrix (): Matrix4 { return this.volume.matrix }\n  get normalMatrix (): Matrix3 { return this.volume.normalMatrix }\n  get inverseMatrix (): Matrix4 { return this.volume.inverseMatrix }\n  get center (): Vector3 { return this.volume.center }\n  get boundingBox (): Box3 { return this.volume.boundingBox }\n  get min () { return this.volume.min }\n  get max () { return this.volume.max }\n  get mean () { return this.volume.mean }\n  get rms () { return this.volume.rms }\n\n  _getFilterHash (minValue: number, maxValue: number, outside: boolean) {\n    return JSON.stringify([ minValue, maxValue, outside ])\n  }\n\n  setFilter (minValue: number|undefined, maxValue: number|undefined, outside: boolean|undefined) {\n    if (isNaN(<number>minValue) && this.header) {\n      minValue = this.header.DMEAN + 2.0 * this.header.ARMS\n    }\n\n    minValue = (minValue !== undefined && !isNaN(minValue)) ? minValue : -Infinity\n    maxValue = defaults(maxValue, Infinity) as number\n    outside = defaults(outside, false) as boolean\n\n    const data = this.volume.data\n    const position = this.volume.position\n    const atomindex = this.volume.atomindex\n\n    const filterHash = this._getFilterHash(minValue, maxValue, outside)\n\n    if (filterHash === this._filterHash) {\n      // already filtered\n      return\n    } else if (minValue === -Infinity && maxValue === Infinity) {\n      this.data = data\n      this.position = position\n      this.atomindex = atomindex!\n    } else {\n      const n = data.length\n\n      if (!this._dataBuffer) {\n        // ArrayBuffer for re-use as Float32Array backend\n\n        this._dataBuffer = new ArrayBuffer(n * 4)\n        this._positionBuffer = new ArrayBuffer(n * 3 * 4)\n        if (atomindex) this._atomindexBuffer = new ArrayBuffer(n * 4)\n      }\n\n      const filteredData = new Float32Array(this._dataBuffer)\n      const filteredPosition = new Float32Array(this._positionBuffer)\n      let filteredAtomindex\n      if (atomindex) filteredAtomindex = new Uint32Array(this._atomindexBuffer)\n\n      let j = 0\n\n      for (let i = 0; i < n; ++i) {\n        const i3 = i * 3\n        const v = data[ i ]\n\n        if ((!outside && v >= minValue && v <= maxValue) ||\n            (outside && (v < minValue || v > maxValue))\n        ) {\n          const j3 = j * 3\n\n          filteredData[ j ] = v\n\n          filteredPosition[ j3 + 0 ] = position[ i3 + 0 ]\n          filteredPosition[ j3 + 1 ] = position[ i3 + 1 ]\n          filteredPosition[ j3 + 2 ] = position[ i3 + 2 ]\n\n          if (atomindex && filteredAtomindex) filteredAtomindex[ j ] = atomindex[ i ]\n\n          j += 1\n        }\n      }\n\n      // set views\n\n      this.data = new Float32Array(this._dataBuffer, 0, j)\n      this.position = new Float32Array(this._positionBuffer, 0, j * 3)\n      if (atomindex) this.atomindex = new Int32Array(this._atomindexBuffer, 0, j)\n    }\n\n    this._filterHash = filterHash\n  }\n}\n\nFilteredVolume.prototype.getValueForSigma = Volume.prototype.getValueForSigma\nFilteredVolume.prototype.getSigmaForValue = Volume.prototype.getSigmaForValue\n\nFilteredVolume.prototype.getDataAtomindex = Volume.prototype.getDataAtomindex\nFilteredVolume.prototype.getDataPosition = Volume.prototype.getDataPosition\nFilteredVolume.prototype.getDataColor = Volume.prototype.getDataColor\nFilteredVolume.prototype.getDataPicking = Volume.prototype.getDataPicking\nFilteredVolume.prototype.getDataSize = Volume.prototype.getDataSize\n\nexport default FilteredVolume\n","/**\n * @file Bond Hash\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport BondStore from './bond-store'\nimport { createAdjacencyList } from '../utils/adjacency-list'\n\nclass BondHash {\n  countArray: Uint8Array\n  offsetArray: Int32Array\n  indexArray: Int32Array\n\n  constructor (bondStore: BondStore, atomCount: number) {\n    const al = createAdjacencyList({\n      nodeArray1: bondStore.atomIndex1,\n      nodeArray2: bondStore.atomIndex2,\n      edgeCount: bondStore.count,\n      nodeCount: atomCount\n    })\n\n    this.countArray = al.countArray\n    this.offsetArray = al.offsetArray\n    this.indexArray = al.indexArray\n  }\n}\n\nexport default BondHash\n","/**\n * @file Bond Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Bond store\n */\nexport default class BondStore extends Store {\n  atomIndex1: Uint32Array\n  atomIndex2: Uint32Array\n  bondOrder: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'atomIndex1', 1, 'int32' ],\n      [ 'atomIndex2', 1, 'int32' ],\n      [ 'bondOrder', 1, 'int8' ]\n    ] as StoreField[]\n  }\n\n  addBond (atom1: AtomProxy, atom2: AtomProxy, bondOrder?: number) {\n    this.growIfFull()\n\n    const i = this.count\n    const ai1 = atom1.index\n    const ai2 = atom2.index\n\n    if (ai1 < ai2) {\n      this.atomIndex1[ i ] = ai1\n      this.atomIndex2[ i ] = ai2\n    } else {\n      this.atomIndex2[ i ] = ai1\n      this.atomIndex1[ i ] = ai2\n    }\n    if (bondOrder) this.bondOrder[ i ] = bondOrder\n\n    this.count += 1\n  }\n\n  addBondIfConnected (atom1: AtomProxy, atom2: AtomProxy, bondOrder?: number) {\n    if (atom1.connectedTo(atom2)) {\n      this.addBond(atom1, atom2, bondOrder)\n      return true\n    }\n\n    return false\n  }\n}","/**\n * @file Atom Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Atom store\n */\nexport default class AtomStore extends Store {\n  residueIndex: Uint32Array\n  atomTypeId: Uint16Array\n\n  x: Float32Array\n  y: Float32Array\n  z: Float32Array\n  serial: Int32Array\n  bfactor: Float32Array\n  altloc: Uint8Array\n  occupancy: Float32Array\n\n  partialCharge?: Float32Array\n  formalCharge?: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'residueIndex', 1, 'uint32' ],\n      [ 'atomTypeId', 1, 'uint16' ],\n\n      [ 'x', 1, 'float32' ],\n      [ 'y', 1, 'float32' ],\n      [ 'z', 1, 'float32' ],\n      [ 'serial', 1, 'int32' ],\n      [ 'bfactor', 1, 'float32' ],\n      [ 'altloc', 1, 'uint8' ],\n      [ 'occupancy', 1, 'float32' ]\n    ] as StoreField[]\n  }\n\n  setAltloc (i: number, str: string) {\n    this.altloc[ i ] = str.charCodeAt(0)\n  }\n\n  getAltloc (i: number) {\n    const code = this.altloc[ i ]\n    return code ? String.fromCharCode(code) : ''\n  }\n}","/**\n * @file Residue Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Residue store\n */\nexport default class ResidueStore extends Store {\n  chainIndex: Uint32Array\n  atomOffset: Uint32Array\n  atomCount: Uint32Array\n  residueTypeId: Uint16Array\n\n  resno: Uint32Array\n  sstruc: Uint8Array\n  inscode: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'chainIndex', 1, 'uint32' ],\n      [ 'atomOffset', 1, 'uint32' ],\n      [ 'atomCount', 1, 'uint32' ],\n      [ 'residueTypeId', 1, 'uint16' ],\n\n      [ 'resno', 1, 'int32' ],\n      [ 'sstruc', 1, 'uint8' ],\n      [ 'inscode', 1, 'uint8' ]\n    ] as StoreField[]\n  }\n\n  setSstruc (i: number, str: string) {\n    this.sstruc[ i ] = str.charCodeAt(0)\n  }\n\n  getSstruc (i: number) {\n    const code = this.sstruc[ i ]\n    return code ? String.fromCharCode(code) : ''\n  }\n\n  setInscode (i: number, str: string) {\n    this.inscode[ i ] = str.charCodeAt(0)\n  }\n\n  getInscode (i: number) {\n    const code = this.inscode[ i ]\n    return code ? String.fromCharCode(code) : ''\n  }\n}","/**\n * @file Chain Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Chain store\n */\nexport default class ChainStore extends Store {\n  entityIndex: Uint16Array\n  modelIndex: Uint16Array\n  residueOffset: Uint32Array\n  residueCount: Uint32Array\n\n  chainname: Uint8Array\n  chainid: Uint8Array\n\n  get _defaultFields () {\n    return [\n      [ 'entityIndex', 1, 'uint16' ],\n      [ 'modelIndex', 1, 'uint16' ],\n      [ 'residueOffset', 1, 'uint32' ],\n      [ 'residueCount', 1, 'uint32' ],\n\n      [ 'chainname', 4, 'uint8' ],\n      [ 'chainid', 4, 'uint8' ]\n    ] as StoreField[]\n  }\n\n  setChainname (i: number, str: string) {\n    const j = 4 * i\n    this.chainname[ j ] = str.charCodeAt(0)\n    this.chainname[ j + 1 ] = str.charCodeAt(1)\n    this.chainname[ j + 2 ] = str.charCodeAt(2)\n    this.chainname[ j + 3 ] = str.charCodeAt(3)\n  }\n\n  getChainname (i: number) {\n    let chainname = ''\n    for (let k = 0; k < 4; ++k) {\n      const code = this.chainname[ 4 * i + k ]\n      if (code) {\n        chainname += String.fromCharCode(code)\n      } else {\n        break\n      }\n    }\n    return chainname\n  }\n\n  setChainid (i: number, str: string) {\n    const j = 4 * i\n    this.chainid[ j ] = str.charCodeAt(0)\n    this.chainid[ j + 1 ] = str.charCodeAt(1)\n    this.chainid[ j + 2 ] = str.charCodeAt(2)\n    this.chainid[ j + 3 ] = str.charCodeAt(3)\n  }\n\n  getChainid (i: number) {\n    let chainid = ''\n    for (let k = 0; k < 4; ++k) {\n      const code = this.chainid[ 4 * i + k ]\n      if (code) {\n        chainid += String.fromCharCode(code)\n      } else {\n        break\n      }\n    }\n    return chainid\n  }\n}\n","/**\n * @file Model Store\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Store, { StoreField } from './store'\n\n/**\n * Model store\n */\nexport default class ModelStore extends Store {\n\tchainOffset: Uint32Array\n\tchainCount: Uint32Array\n\n  get _defaultFields () {\n    return [\n      [ 'chainOffset', 1, 'uint32' ],\n      [ 'chainCount', 1, 'uint32' ]\n    ] as StoreField[]\n  }\n}","/**\n * @file Helixorient\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { ColormakerParameters } from '../color/colormaker'\nimport { AtomPicker } from '../utils/picker'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport { copyArray } from '../math/array-utils'\nimport { projectPointOnVector } from '../math/vector-utils'\nimport Polymer from '../proxy/polymer'\n\nexport interface HelixIterator {\n  size: number\n  next: () => Vector3\n  get: (idx: number) => Vector3\n  reset: () => void\n}\n\nexport interface HelixPosition {\n  center: Float32Array\n  axis: Float32Array\n  bending: Float32Array\n  radius: Float32Array\n  rise: Float32Array\n  twist: Float32Array\n  resdir: Float32Array\n}\n\nclass Helixorient {\n  size: number\n\n  constructor (readonly polymer: Polymer) {\n    this.size = polymer.residueCount\n  }\n\n  getCenterIterator (smooth = 0): HelixIterator {\n    const center = this.getPosition().center\n    const size = center.length / 3\n\n    let i = 0\n    let j = -1\n\n    const cache = [\n      new Vector3(),\n      new Vector3(),\n      new Vector3(),\n      new Vector3()\n    ]\n\n    function next (this: HelixIterator) {\n      const vector = this.get(j)\n      j += 1\n      return vector\n    }\n\n    function get (idx: number) {\n      idx = Math.min(size - 1, Math.max(0, idx))\n      const v = cache[ i % 4 ]\n      const idx3 = 3 * idx\n      v.fromArray(center as any, idx3)  // TODO\n      if (smooth) {\n        const w = Math.min(smooth, idx, size - idx - 1)\n        for (let k = 1; k <= w; ++k) {\n          const l = k * 3\n          const t = (w + 1 - k) / (w + 1)\n          v.x += t * center[ idx3 - l + 0 ] + t * center[ idx3 + l + 0 ]\n          v.y += t * center[ idx3 - l + 1 ] + t * center[ idx3 + l + 1 ]\n          v.z += t * center[ idx3 - l + 2 ] + t * center[ idx3 + l + 2 ]\n        }\n        v.x /= w + 1\n        v.y /= w + 1\n        v.z /= w + 1\n      }\n      i += 1\n      return v\n    }\n\n    function reset () {\n      i = 0\n      j = -1\n    }\n\n    return { size, next, get, reset }\n  }\n\n  getColor (params: { scheme: string } & ColormakerParameters) {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const col = new Float32Array(n * 3)\n\n    const p = params || {}\n    p.structure = structure\n\n    const colormaker = ColormakerRegistry.getScheme(p)\n\n    const rp = structure.getResidueProxy()\n    const ap = structure.getAtomProxy()\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = residueIndexStart + i\n      ap.index = rp.traceAtomIndex\n\n      colormaker.atomColorToArray(ap, col, i * 3)\n    }\n\n    return {\n      'color': col\n    }\n  }\n\n  getPicking () {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const pick = new Float32Array(n)\n    const rp = structure.getResidueProxy()\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = residueIndexStart + i\n      pick[ i ] = rp.traceAtomIndex\n    }\n\n    return {\n      'picking': new AtomPicker(pick, structure)\n    }\n  }\n\n  getSize (params: RadiusParams) {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const size = new Float32Array(n)\n    const radiusFactory = new RadiusFactory(params)\n\n    const rp = structure.getResidueProxy()\n    const ap = structure.getAtomProxy()\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = residueIndexStart + i\n      ap.index = rp.traceAtomIndex\n      size[ i ] = radiusFactory.atomRadius(ap)\n    }\n\n    return { size }\n  }\n\n  getPosition (): HelixPosition {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const n3 = n - 3\n\n    const center = new Float32Array(3 * n)\n    const axis = new Float32Array(3 * n)\n    const diff = new Float32Array(n)\n    const radius = new Float32Array(n)\n    const rise = new Float32Array(n)\n    const twist = new Float32Array(n)\n    const resdir = new Float32Array(3 * n)\n\n    const r12 = new Vector3()\n    const r23 = new Vector3()\n    const r34 = new Vector3()\n\n    const diff13 = new Vector3()\n    const diff24 = new Vector3()\n\n    const v1 = new Vector3()\n    const v2 = new Vector3()\n    const vt = new Vector3()\n\n    const _axis = new Vector3()\n    const _prevAxis = new Vector3()\n\n    const _resdir = new Vector3()\n    const _center = new Vector3(0, 0, 0)\n\n    const type = 'trace'\n    const a1 = structure.getAtomProxy()\n    const a2 = structure.getAtomProxy(polymer.getAtomIndexByType(0, type))\n    const a3 = structure.getAtomProxy(polymer.getAtomIndexByType(1, type))\n    const a4 = structure.getAtomProxy(polymer.getAtomIndexByType(2, type))\n\n    for (let i = 0; i < n3; ++i) {\n      a1.index = a2.index\n      a2.index = a3.index\n      a3.index = a4.index\n      a4.index = polymer.getAtomIndexByType(i + 3, type)!  // TODO\n\n      const j = 3 * i\n\n      // ported from GROMACS src/tools/gmx_helixorient.c\n\n      r12.subVectors(a2 as any, a1 as any)  // TODO\n      r23.subVectors(a3 as any, a2 as any)  // TODO\n      r34.subVectors(a4 as any, a3 as any)  // TODO\n\n      diff13.subVectors(r12, r23)\n      diff24.subVectors(r23, r34)\n\n      _axis.crossVectors(diff13, diff24).normalize()\n      _axis.toArray(axis as any, j)  // TODO\n\n      if (i > 0) {\n        diff[ i ] = _axis.angleTo(_prevAxis)\n      }\n\n      const tmp = Math.cos(diff13.angleTo(diff24))\n      twist[ i ] = 180.0 / Math.PI * Math.acos(tmp)\n\n      const diff13Length = diff13.length()\n      const diff24Length = diff24.length()\n\n      radius[ i ] = (\n        Math.sqrt(diff24Length * diff13Length) /\n        // clamp, to avoid instabilities for when\n        // angle between diff13 and diff24 is near 0\n        Math.max(2.0, 2.0 * (1.0 - tmp))\n      )\n\n      rise[ i ] = Math.abs(r23.dot(_axis))\n\n      //\n\n      v1.copy(diff13).multiplyScalar(radius[ i ] / diff13Length)\n      v2.copy(diff24).multiplyScalar(radius[ i ] / diff24Length)\n\n      v1.subVectors(a2 as any, v1)  // TODO\n      v2.subVectors(a3 as any, v2)  // TODO\n\n      v1.toArray(center as any, j + 3)  // TODO\n      v2.toArray(center as any, j + 6)  // TODO\n\n      //\n\n      _resdir.subVectors(a1 as any, _center)  // TODO\n      _resdir.toArray(resdir as any, j)  // TODO\n\n      _prevAxis.copy(_axis)\n      _center.copy(v1)\n    }\n\n    //\n\n    // calc axis as dir of second and third center pos\n    // project first traceAtom onto axis to get first center pos\n    v1.fromArray(center as any, 3)  // TODO\n    v2.fromArray(center as any, 6)  // TODO\n    _axis.subVectors(v1, v2).normalize()\n      // _center.copy( res[ 0 ].getTraceAtom() );\n    a1.index = polymer.getAtomIndexByType(0, type)!  // TODO\n    _center.copy(a1 as any)  // TODO\n    vt.copy(a1 as any)  // TODO\n    projectPointOnVector(vt, _axis, v1)\n    vt.toArray(center as any, 0)  // TODO\n\n    // calc first resdir\n    _resdir.subVectors(_center, v1)\n    _resdir.toArray(resdir as any, 0)  // TODO\n\n    // calc axis as dir of n-1 and n-2 center pos\n    // project last traceAtom onto axis to get last center pos\n    v1.fromArray(center as any, 3 * n - 6)  // TODO\n    v2.fromArray(center as any, 3 * n - 9)  // TODO\n    _axis.subVectors(v1, v2).normalize()\n    // _center.copy( res[ n - 1 ].getTraceAtom() );\n    a1.index = polymer.getAtomIndexByType(n - 1, type)!  // TODO\n    _center.copy(a1 as any)  // TODO\n    vt.copy(a1 as any)  // TODO\n    projectPointOnVector(vt, _axis, v1)\n    vt.toArray(center as any, 3 * n - 3)  // TODO\n\n    // calc last three resdir\n    for (let i = n - 3; i < n; ++i) {\n      v1.fromArray(center as any, 3 * i)  // TODO\n      // _center.copy( res[ i ].getTraceAtom() );\n      a1.index = polymer.getAtomIndexByType(i, type)!  // TODO\n      _center.copy(a1 as any)  // TODO\n\n      _resdir.subVectors(_center, v1)\n      _resdir.toArray(resdir as any, 3 * i)  // TODO\n    }\n\n    // average measures to define them on the residues\n\n    const resRadius = new Float32Array(n)\n    const resTwist = new Float32Array(n)\n    const resRise = new Float32Array(n)\n    const resBending = new Float32Array(n)\n\n    resRadius[ 1 ] = radius[ 0 ]\n    resTwist[ 1 ] = twist[ 0 ]\n    resRise[ 1 ] = radius[ 0 ]\n\n    for (let i = 2; i < n - 2; ++i) {\n      resRadius[ i ] = 0.5 * (radius[ i - 2 ] + radius[ i - 1 ])\n      resTwist[ i ] = 0.5 * (twist[ i - 2 ] + twist[ i - 1 ])\n      resRise[ i ] = 0.5 * (rise[ i - 2 ] + rise[ i - 1 ])\n\n      v1.fromArray(axis as any, 3 * (i - 2))  // TODO\n      v2.fromArray(axis as any, 3 * (i - 1))  // TODO\n      resBending[ i ] = 180.0 / Math.PI * Math.acos(Math.cos(v1.angleTo(v2)))\n    }\n\n    resRadius[ n - 2 ] = radius[ n - 4 ]\n    resTwist[ n - 2 ] = twist[ n - 4 ]\n    resRise[ n - 2 ] = rise[ n - 4 ]\n\n    // average helix axes to define them on the residues\n\n    const resAxis = new Float32Array(3 * n)\n\n    copyArray(axis, resAxis, 0, 0, 3)\n    copyArray(axis, resAxis, 0, 3, 3)\n\n    for (let i = 2; i < n - 2; ++i) {\n      v1.fromArray(axis as any, 3 * (i - 2))  // TODO\n      v2.fromArray(axis as any, 3 * (i - 1))  // TODO\n\n      _axis.addVectors(v2, v1).multiplyScalar(0.5).normalize()\n      _axis.toArray(resAxis as any, 3 * i)  // TODO\n    }\n\n    copyArray(axis, resAxis, 3 * n - 12, 3 * n - 6, 3)\n    copyArray(axis, resAxis, 3 * n - 12, 3 * n - 3, 3)\n\n    return {\n      center,\n      axis: resAxis,\n      bending: resBending,\n      radius: resRadius,\n      rise: resRise,\n      twist: resTwist,\n      resdir: resdir\n    }\n  }\n\n}\n\nexport default Helixorient\n","/**\n * @file Helixbundle\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { AtomPicker } from '../utils/picker'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport Helixorient, { HelixPosition } from './helixorient'\nimport { calculateMeanVector3, projectPointOnVector } from '../math/vector-utils'\nimport Polymer from '../proxy/polymer'\nimport { ColormakerParameters } from '../color/colormaker';\n\nexport interface Axis {\n  axis: Float32Array\n  center: Float32Array\n  begin: Float32Array\n  end: Float32Array\n  color: Float32Array\n  picking: AtomPicker\n  size: Float32Array\n  residueOffset: number[]\n  residueCount: number[]\n}\n\nclass Helixbundle {\n  helixorient: Helixorient;\n  position: HelixPosition;\n\n  constructor (readonly polymer: Polymer) {\n\n    this.helixorient = new Helixorient(polymer)\n    this.position = this.helixorient.getPosition()\n  }\n\n  getAxis (localAngle: number, centerDist: number, ssBorder: boolean, colorParams: { scheme: string} & ColormakerParameters, radiusParams: RadiusParams): Axis {\n    localAngle = localAngle || 30\n    centerDist = centerDist || 2.5\n    ssBorder = ssBorder === undefined ? false : ssBorder\n\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n    const residueIndexStart = polymer.residueIndexStart\n\n    const pos = this.position\n\n    const cp = colorParams || {}\n    cp.structure = structure\n\n    const colormaker = ColormakerRegistry.getScheme(cp)\n\n    const radiusFactory = new RadiusFactory(radiusParams)\n\n    let j = 0\n    let k = 0\n\n    const axis: number[] = []\n    const center: number[] = []\n    const beg: number[] = []\n    const end: number[] = []\n    const col: number[] = []\n    const pick = []\n    const size = []\n    const residueOffset = []\n    const residueCount = []\n\n    let tmpAxis = new Float32Array(n * 3)\n    let tmpCenter = new Float32Array(n * 3)\n\n    let _axis, _center\n    const _beg = new Vector3()\n    const _end = new Vector3()\n\n    const rp1 = structure.getResidueProxy()\n    const rp2 = structure.getResidueProxy()\n    const ap = structure.getAtomProxy()\n\n    const c1 = new Vector3()\n    const c2 = new Vector3()\n\n    let split = false\n\n    for (let i = 0; i < n; ++i) {\n      rp1.index = residueIndexStart + i\n      c1.fromArray(pos.center as any, i * 3)\n\n      if (i === n - 1) {\n        split = true\n      } else {\n        rp2.index = residueIndexStart + i + 1\n        c2.fromArray(pos.center as any, i * 3 + 3)\n\n        if (ssBorder && rp1.sstruc !== rp2.sstruc) {\n          split = true\n        } else if (c1.distanceTo(c2) > centerDist) {\n          split = true\n        } else if (pos.bending[ i ] > localAngle) {\n          split = true\n        }\n      }\n\n      if (split) {\n        if (i - j < 4) {\n          j = i\n          split = false\n          continue\n        }\n\n        ap.index = rp1.traceAtomIndex\n\n        // ignore first and last axis\n        tmpAxis = pos.axis.subarray(j * 3 + 3, i * 3)\n        tmpCenter = pos.center.subarray(j * 3, i * 3 + 3)\n\n        _axis = calculateMeanVector3(tmpAxis).normalize()\n        _center = calculateMeanVector3(tmpCenter)\n\n        _beg.fromArray(tmpCenter as any)\n        projectPointOnVector(_beg, _axis, _center)\n\n        _end.fromArray(tmpCenter as any, tmpCenter.length - 3)\n        projectPointOnVector(_end, _axis, _center)\n\n        _axis.subVectors(_end, _beg)\n\n        _axis.toArray(axis as any, k)\n        _center.toArray(center as any, k)\n        _beg.toArray(beg as any, k)\n        _end.toArray(end as any, k)\n\n        colormaker.atomColorToArray(ap, col, k)\n\n        pick.push(ap.index)\n\n        size.push(radiusFactory.atomRadius(ap))\n\n        residueOffset.push(residueIndexStart + j)\n        residueCount.push(residueIndexStart + i + 1 - j)\n\n        k += 3\n        j = i\n        split = false\n      }\n    }\n\n    const picking = new Float32Array(pick)\n\n    return {\n      axis: new Float32Array(axis),\n      center: new Float32Array(center),\n      begin: new Float32Array(beg),\n      end: new Float32Array(end),\n      color: new Float32Array(col),\n      picking: new AtomPicker(picking, structure),\n      size: new Float32Array(size),\n      residueOffset: residueOffset,\n      residueCount: residueCount\n    }\n  }\n}\n\nexport default Helixbundle\n","/**\n * @file Binary Heap\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n/**\n * Binary heap implementation\n * @class\n * @author http://eloquentjavascript.net/appendix2.htm\n * @param {Function} scoreFunction - the heap scoring function\n */\nclass BinaryHeap<T> {\n  content: T[] = []\n\n  constructor(readonly scoreFunction: (x: T) => number) {\n\n    this.scoreFunction = scoreFunction\n  }\n\n  push (element: T) {\n    // Add the new element to the end of the array.\n    this.content.push(element)\n\n    // Allow it to bubble up.\n    this.bubbleUp(this.content.length - 1)\n  }\n\n  pop () {\n    // Store the first element so we can return it later.\n    const result = this.content[ 0 ]\n\n    // Get the element at the end of the array.\n    const end = this.content.pop()\n\n    // If there are any elements left, put the end element at the\n    // start, and let it sink down.\n    if (end && this.content.length > 0) {\n      this.content[ 0 ] = end\n      this.sinkDown(0)\n    }\n\n    return result\n  }\n\n  peek () {\n    return this.content[ 0 ]\n  }\n\n  remove (element: T) {\n    const len = this.content.length\n\n    // To remove a value, we must search through the array to find it.\n    for (let i = 0; i < len; i++) {\n      if (this.content[ i ] === element) {\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        const end = this.content.pop()\n\n        if (end && i !== len - 1) {\n          this.content[ i ] = end\n\n          if (this.scoreFunction(end) < this.scoreFunction(element)) {\n            this.bubbleUp(i)\n          } else {\n            this.sinkDown(i)\n          }\n        }\n\n        return\n      }\n    }\n\n    throw new Error('Node not found.')\n  }\n\n  size () {\n    return this.content.length\n  }\n\n  bubbleUp (n: number) {\n    // Fetch the element that has to be moved.\n    const element = this.content[ n ]\n\n    // When at 0, an element can not go up any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      const parentN = Math.floor((n + 1) / 2) - 1\n      const parent = this.content[ parentN ]\n\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n        this.content[ parentN ] = element\n        this.content[ n ] = parent\n\n        // Update 'n' to continue at the new position.\n        n = parentN\n      } else {\n        // Found a parent that is less, no need to move it further.\n        break\n      }\n    }\n  }\n\n  sinkDown (n: number) {\n    // Look up the target element and its score.\n    const length = this.content.length\n    const element = this.content[ n ]\n    const elemScore = this.scoreFunction(element)\n\n    let child1Score = 0\n    let child2Score = 0\n\n    while (true) {\n      // Compute the indices of the child elements.\n      const child2N = (n + 1) * 2\n      const child1N = child2N - 1\n\n      // This is used to store the new position of the element, if any.\n      let swap = null\n\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        const child1 = this.content[ child1N ]\n        child1Score = this.scoreFunction(child1)\n\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore) swap = child1N\n      }\n\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        const child2 = this.content[ child2N ]\n        child2Score = this.scoreFunction(child2)\n\n        if (child2Score < (swap === null ? elemScore : child1Score)) swap = child2N\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap !== null) {\n        this.content[ n ] = this.content[ swap ]\n        this.content[ swap ] = element\n        n = swap\n      } else {\n        // Otherwise, we are done.\n        break\n      }\n    }\n  }\n\n}\n\nexport default BinaryHeap\n","/**\n * @file Kdtree\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { NumberArray } from '../types'\nimport BinaryHeap from './binary-heap'\n\n/**\n * Kdtree\n * @class\n * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016\n * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013\n * @author I4DS http://www.fhnw.ch/i4ds, 2013\n * @license MIT License <http://www.opensource.org/licenses/mit-license.php>\n * @description\n * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place\n * provides fast nearest neighbour search\n *\n * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs\n *\n * Further information (including mathematical properties)\n * http://en.wikipedia.org/wiki/Binary_tree\n * http://en.wikipedia.org/wiki/K-d_tree\n *\n * @example\n * points: [x, y, z, x, y, z, x, y, z, ...]\n * metric: function(a, b){\n *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);\n * }\n *\n * @param {Float32Array} points - points\n * @param {Function} metric - metric\n */\nclass Kdtree {\n  indices: Uint32Array\n  nodes: Int32Array\n  rootIndex: number\n\n  maxDepth = 0\n  currentNode = 0\n\n  constructor(readonly points: NumberArray, readonly metric: (a: NumberArray, b: NumberArray) => number) {\n    const n = points.length / 3\n\n    const indices = new Uint32Array(n)\n    for (let i = 0; i < n; ++i) {\n      indices[ i ] = i\n    }\n    this.indices = indices\n    this.nodes = new Int32Array(n * 4)\n    this.rootIndex = this.buildTree(0, -1, 0, n)\n  }\n\n  buildTree (depth: number, parent: number, arrBegin: number, arrEnd: number) {\n    if (depth > this.maxDepth) this.maxDepth = depth\n\n    const plength = arrEnd - arrBegin\n    if (plength === 0) {\n      return -1\n    }\n\n    const nodeIndex = this.currentNode * 4\n    const nodes = this.nodes\n\n    this.currentNode += 1\n    if (plength === 1) {\n      nodes[ nodeIndex ] = arrBegin\n      nodes[ nodeIndex + 1 ] = -1\n      nodes[ nodeIndex + 2 ] = -1\n      nodes[ nodeIndex + 3 ] = parent\n      return nodeIndex\n    }\n    // if(plength <= 32){\n    //   return nodeIndex;\n    // }\n\n    const indices = this.indices\n    const points = this.points\n\n    const arrMedian = arrBegin + Math.floor(plength / 2)\n    const currentDim = depth % 3\n\n    // inlined quickselect function\n    let j, tmp, pivotIndex, pivotValue, storeIndex\n    let left = arrBegin\n    let right = arrEnd - 1\n    while (right > left) {\n      pivotIndex = (left + right) >> 1\n      pivotValue = points[ indices[ pivotIndex ] * 3 + currentDim ]\n      // swap( pivotIndex, right );\n      tmp = indices[ pivotIndex ]\n      indices[ pivotIndex ] = indices[ right ]\n      indices[ right ] = tmp\n      storeIndex = left\n      for (j = left; j < right; ++j) {\n        if (points[ indices[ j ] * 3 + currentDim ] < pivotValue) {\n          // swap( storeIndex, j );\n          tmp = indices[ storeIndex ]\n          indices[ storeIndex ] = indices[ j ]\n          indices[ j ] = tmp\n          ++storeIndex\n        }\n      }\n      // swap( right, storeIndex );\n      tmp = indices[ right ]\n      indices[ right ] = indices[ storeIndex ]\n      indices[ storeIndex ] = tmp\n      pivotIndex = storeIndex\n      if (arrMedian === pivotIndex) {\n        break\n      } else if (arrMedian < pivotIndex) {\n        right = pivotIndex - 1\n      } else {\n        left = pivotIndex + 1\n      }\n    }\n\n    nodes[ nodeIndex ] = arrMedian\n    nodes[ nodeIndex + 1 ] = this.buildTree(depth + 1, nodeIndex, arrBegin, arrMedian)\n    nodes[ nodeIndex + 2 ] = this.buildTree(depth + 1, nodeIndex, arrMedian + 1, arrEnd)\n    nodes[ nodeIndex + 3 ] = parent\n\n    return nodeIndex\n  }\n\n  getNodeDepth (nodeIndex: number): number {\n    const parentIndex = this.nodes[ nodeIndex + 3 ]\n    return (parentIndex === -1) ? 0 : this.getNodeDepth(parentIndex) + 1\n  }\n\n  // TODO\n  // function getNodePos (node) {}\n\n  /**\n   * find nearest points\n   * @param {Array} point - array of size 3\n   * @param {Integer} maxNodes - max amount of nodes to return\n   * @param {Float} maxDistance - maximum distance of point to result nodes\n   * @return {Array} array of point, distance pairs\n   */\n  nearest (point: NumberArray, maxNodes: number, maxDistance: number) {\n    const bestNodes = new BinaryHeap<[number, number]>(e => -e[ 1 ])\n\n    const nodes = this.nodes\n    const points = this.points\n    const indices = this.indices\n\n    const nearestSearch = (nodeIndex: number) => {\n      let bestChild, otherChild\n      const dimension = this.getNodeDepth(nodeIndex) % 3\n      const pointIndex = indices[ nodes[ nodeIndex ] ] * 3\n      const ownPoint = [\n        points[ pointIndex + 0 ],\n        points[ pointIndex + 1 ],\n        points[ pointIndex + 2 ]\n      ]\n      const ownDistance = this.metric(point, ownPoint)\n\n      function saveNode (nodeIndex: number, distance: number) {\n        bestNodes.push([ nodeIndex, distance ])\n        if (bestNodes.size() > maxNodes) {\n          bestNodes.pop()\n        }\n      }\n\n      const leftIndex = nodes[ nodeIndex + 1 ]\n      const rightIndex = nodes[ nodeIndex + 2 ]\n\n      // if it's a leaf\n      if (rightIndex === -1 && leftIndex === -1) {\n        if ((bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[ 1 ]) &&\n          ownDistance <= maxDistance\n        ) {\n          saveNode(nodeIndex, ownDistance)\n        }\n        return\n      }\n\n      if (rightIndex === -1) {\n        bestChild = leftIndex\n      } else if (leftIndex === -1) {\n        bestChild = rightIndex\n      } else {\n        if (point[ dimension ] <= points[ pointIndex + dimension ]) {\n          bestChild = leftIndex\n        } else {\n          bestChild = rightIndex\n        }\n      }\n\n      // recursive search\n      nearestSearch(bestChild)\n\n      if ((bestNodes.size() < maxNodes || ownDistance < bestNodes.peek()[ 1 ]) &&\n        ownDistance <= maxDistance\n      ) {\n        saveNode(nodeIndex, ownDistance)\n      }\n\n      // if there's still room or the current distance is nearer than the best distance\n      const linearPoint = []\n      for (let i = 0; i < 3; i += 1) {\n        if (i === dimension) {\n          linearPoint[ i ] = point[ i ]\n        } else {\n          linearPoint[ i ] = points[ pointIndex + i ]\n        }\n      }\n      const linearDistance = this.metric(linearPoint, ownPoint)\n\n      if ((bestNodes.size() < maxNodes || Math.abs(linearDistance) < bestNodes.peek()[ 1 ]) &&\n        Math.abs(linearDistance) <= maxDistance\n      ) {\n        if (bestChild === leftIndex) {\n          otherChild = rightIndex\n        } else {\n          otherChild = leftIndex\n        }\n        if (otherChild !== -1) {\n          nearestSearch(otherChild)\n        }\n      }\n    }\n\n    nearestSearch(this.rootIndex)\n\n    const result = []\n    for (let i = 0, il = Math.min(bestNodes.size(), maxNodes); i < il; i += 1) {\n      result.push(bestNodes.content[ i ])\n    }\n\n    return result\n  }\n\n  verify (nodeIndex?: number, depth = 0) {\n    let count = 1\n\n    if (nodeIndex === undefined) {\n      nodeIndex = this.rootIndex\n    }\n\n    if (nodeIndex === -1) {\n      throw new Error('node is null')\n    }\n\n    const dim = depth % 3\n    const nodes = this.nodes\n    const points = this.points\n    const indices = this.indices\n\n    const leftIndex = nodes[ nodeIndex + 1 ]\n    const rightIndex = nodes[ nodeIndex + 2 ]\n\n    if (leftIndex !== -1) {\n      if (points[ indices[ nodes[ leftIndex ] ] * 3 + dim ] >\n        points[ indices[ nodes[ nodeIndex ] ] * 3 + dim ]\n      ) {\n        throw new Error('left child is > parent!')\n      }\n      count += this.verify(leftIndex, depth + 1)\n    }\n\n    if (rightIndex !== -1) {\n      if (points[ indices[ nodes[ rightIndex ] ] * 3 + dim ] <\n        points[ indices[ nodes[ nodeIndex ] ] * 3 + dim ]\n      ) {\n        throw new Error('right child is < parent!')\n      }\n      count += this.verify(rightIndex, depth + 1)\n    }\n\n    return count\n  }\n}\n\nexport default Kdtree\n","/**\n * @file Atom Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { NumberArray } from '../types'\nimport {\n  Elements,\n  SecStrucHelix, SecStrucSheet, SecStrucTurn,\n  ProteinType, RnaType, DnaType, WaterType, IonType, SaccharideType,\n  CgProteinBackboneType, CgRnaBackboneType, CgDnaBackboneType\n} from '../structure/structure-constants'\n\nimport Structure from '../structure/structure'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\nimport AtomStore from '../store/atom-store'\n\nimport AtomMap from '../store/atom-map'\nimport ResidueMap from '../store/residue-map'\n\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomType from '../store/atom-type';\nimport ResidueType from '../store/residue-type';\nimport ResidueProxy from './residue-proxy';\nimport Entity from '../structure/entity';\nimport BondHash from '../store/bond-hash';\n\n/**\n * Atom proxy\n */\nclass AtomProxy {\n  index: number\n\n  chainStore: ChainStore\n  residueStore: ResidueStore\n  atomStore: AtomStore\n\n  residueMap: ResidueMap\n  atomMap: AtomMap\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n    this.atomStore = structure.atomStore\n    this.residueMap = structure.residueMap\n    this.atomMap = structure.atomMap\n  }\n\n  /**\n   * @type {BondHash}\n   */\n  get bondHash (): BondHash|undefined { return this.structure.bondHash }\n\n  /**\n   * Molecular enity\n   * @type {Entity}\n   */\n  get entity (): Entity {\n    return this.structure.entityList[ this.entityIndex ]\n  }\n  get entityIndex () {\n    return this.chainStore.entityIndex[ this.chainIndex ]\n  }\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.chainIndex ]\n  }\n  get chainIndex () {\n    return this.residueStore.chainIndex[ this.residueIndex ]\n  }\n  /**\n   * @type {ResidueProxy}\n   */\n  get residue (): ResidueProxy {\n    console.warn('residue - might be expensive')\n    return this.structure.getResidueProxy(this.residueIndex)\n  }\n\n  get residueIndex () {\n    return this.atomStore.residueIndex[ this.index ]\n  }\n  set residueIndex (value) {\n    this.atomStore.residueIndex[ this.index ] = value\n  }\n\n  //\n\n  /**\n   * Secondary structure code\n   * @type {String}\n   */\n  get sstruc () {\n    return this.residueStore.getSstruc(this.residueIndex)\n  }\n  /**\n   * Insertion code\n   * @type {String}\n   */\n  get inscode () {\n    return this.residueStore.getInscode(this.residueIndex)\n  }\n  /**\n   * Residue number/label\n   * @type {Integer}\n   */\n  get resno () {\n    return this.residueStore.resno[ this.residueIndex ]\n  }\n  /**\n   * Chain name\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.chainIndex)\n  }\n  /**\n   * Chain id\n   * @type {String}\n   */\n  get chainid () {\n    return this.chainStore.getChainid(this.chainIndex)\n  }\n\n  //\n\n  /**\n   * @type {ResidueType}\n   */\n  get residueType (): ResidueType {\n    return this.residueMap.get(this.residueStore.residueTypeId[ this.residueIndex ])\n  }\n  /**\n   * @type {AtomType}\n   */\n  get atomType (): AtomType {\n    return this.atomMap.get(this.atomStore.atomTypeId[ this.index ])\n  }\n  get residueAtomOffset () {\n    return this.residueStore.atomOffset[ this.residueIndex ]\n  }\n\n  //\n\n  /**\n   * Residue name\n   */\n  get resname () {\n    return this.residueType.resname\n  }\n  /**\n   * Hetero flag\n   */\n  get hetero () {\n    return this.residueType.hetero\n  }\n\n  //\n\n  /**\n   * Atom name\n   */\n  get atomname () {\n    return this.atomType.atomname\n  }\n  /**\n   * Atomic number\n   */\n  get number () {\n    return this.atomType.number\n  }\n  /**\n   * Element\n   */\n  get element () {\n    return this.atomType.element\n  }\n  /**\n   * Van-der-Waals radius\n   */\n  get vdw () {\n    return this.atomType.vdw\n  }\n  /**\n   * Covalent radius\n   */\n  get covalent () {\n    return this.atomType.covalent\n  }\n\n  //\n\n  /**\n   * X coordinate\n   */\n  get x () {\n    return this.atomStore.x[ this.index ]\n  }\n  set x (value) {\n    this.atomStore.x[ this.index ] = value\n  }\n\n  /**\n   * Y coordinate\n   */\n  get y () {\n    return this.atomStore.y[ this.index ]\n  }\n  set y (value) {\n    this.atomStore.y[ this.index ] = value\n  }\n\n  /**\n   * Z coordinate\n   */\n  get z () {\n    return this.atomStore.z[ this.index ]\n  }\n  set z (value) {\n    this.atomStore.z[ this.index ] = value\n  }\n\n  /**\n   * Serial number\n   */\n  get serial () {\n    return this.atomStore.serial[ this.index ]\n  }\n  set serial (value) {\n    this.atomStore.serial[ this.index ] = value\n  }\n\n  /**\n   * B-factor value\n   */\n  get bfactor () {\n    return this.atomStore.bfactor[ this.index ]\n  }\n  set bfactor (value) {\n    this.atomStore.bfactor[ this.index ] = value\n  }\n\n  /**\n   * Occupancy value\n   */\n  get occupancy () {\n    return this.atomStore.occupancy[ this.index ]\n  }\n  set occupancy (value) {\n    this.atomStore.occupancy[ this.index ] = value\n  }\n\n  /**\n   * Alternate location identifier\n   */\n  get altloc () {\n    return this.atomStore.getAltloc(this.index)\n  }\n  set altloc (value) {\n    this.atomStore.setAltloc(this.index, value)\n  }\n\n  /**\n   * Partial charge\n   */\n  get partialCharge () {\n    return this.atomStore.partialCharge ? this.atomStore.partialCharge[ this.index ] : null\n  }\n  set partialCharge (value) {\n    if (this.atomStore.partialCharge) {\n      this.atomStore.partialCharge[ this.index ] = value as number\n    }\n  }\n\n  /**\n   * Explicit radius\n   */\n  get radius () {\n    return this.atomStore.radius ? this.atomStore.radius[ this.index ] : null\n  }\n  set radius (value) {\n    if (this.atomStore.radius) {\n      this.atomStore.radius[ this.index ] = value as number\n    }\n  }\n\n  /**\n   * Formal charge\n   */\n  get formalCharge () {\n    return this.atomStore.formalCharge ? this.atomStore.formalCharge[ this.index ] : null\n  }\n  set formalCharge (value) {\n    if (this.atomStore.formalCharge) {\n      this.atomStore.formalCharge[ this.index ] = value as number\n    }\n  }\n\n  /**\n   * Aromaticity flag\n   */\n  get aromatic () {\n    if (this.atomStore.aromatic) {\n      return this.atomStore.aromatic[ this.index ] as number\n    } else {\n      return this.residueType.isAromatic(this) ? 1 : 0\n    }\n  }\n  set aromatic (value) {\n    if (this.atomStore.aromatic) {\n      this.atomStore.aromatic[ this.index ] = value as number\n    }\n  }\n\n  //\n\n  get bondCount () {\n    return this.bondHash!.countArray[ this.index ]  // TODO\n  }\n\n  //\n\n  /**\n   * Iterate over each bond\n   * @param  {function(bond: BondProxy)} callback - iterator callback function\n   * @param  {BondProxy} [bp] - optional target bond proxy for use in the callback\n   * @return {undefined}\n   */\n  eachBond (callback: (bp: BondProxy) => void, bp?: BondProxy) {\n    bp = bp || this.structure._bp\n    const idx = this.index\n    const bondHash = this.bondHash!  // TODO\n    const indexArray = bondHash.indexArray\n    const n = bondHash.countArray[ idx ]\n    const offset = bondHash.offsetArray[ idx ]\n\n    for (let i = 0; i < n; ++i) {\n      bp.index = indexArray[ offset + i ]\n      callback(bp)\n    }\n  }\n\n  /**\n   * Iterate over each bonded atom\n   * @param  {function(atom: AtomProxy)} callback - iterator callback function\n   * @param  {AtomProxy} [ap] - optional target atom proxy for use in the callback\n   * @return {undefined}\n   */\n  eachBondedAtom (callback: (ap: AtomProxy) => void, _ap?: AtomProxy) {\n    const ap = _ap ? _ap : this.structure._ap\n    const idx = this.index\n\n    this.eachBond(function (bp) {\n      ap.index = idx !== bp.atomIndex1 ? bp.atomIndex1 : bp.atomIndex2\n      callback(ap)\n    })\n    this.index = idx\n  }\n\n  /**\n   * Check if this atom is bonded to the given atom,\n   * assumes both atoms are from the same structure\n   * @param  {AtomProxy} ap - the given atom\n   * @return {Boolean} whether a bond exists or not\n   */\n  hasBondTo (ap: AtomProxy) {\n    let flag = false\n    this.eachBondedAtom(function (bap) {\n      if (ap.index === bap.index) flag = true\n    })\n    return flag\n  }\n\n  bondToElementCount (element: Elements) {\n    let count = 0\n    const idx = this.index // Avoid reentrancy problems\n    this.eachBondedAtom(function (bap) {\n      if (bap.number === element) count += 1\n    })\n    this.index = idx\n    return count\n  }\n\n  hasBondToElement (element: Elements) {\n    return this.bondToElementCount(element) > 0\n  }\n\n  //\n\n  /**\n   * If atom is part of a backbone\n   * @return {Boolean} flag\n   */\n  isBackbone () {\n    const backboneIndexList = this.residueType.backboneIndexList\n    if (backboneIndexList.length > 0) {\n      return backboneIndexList.includes(this.index - this.residueAtomOffset)\n    } else {\n      return false\n    }\n  }\n\n  /**\n   * If atom is part of a polymer\n   * @return {Boolean} flag\n   */\n  isPolymer () {\n    if (this.structure.entityList.length > 0) {\n      return this.entity.isPolymer()\n    } else {\n      const moleculeType = this.residueType.moleculeType\n      return (\n        moleculeType === ProteinType ||\n        moleculeType === RnaType ||\n        moleculeType === DnaType\n      )\n    }\n  }\n\n  /**\n   * If atom is part of a sidechin\n   * @return {Boolean} flag\n   */\n  isSidechain () {\n    return this.isPolymer() && !this.isBackbone()\n  }\n\n  /**\n   * If atom is part of a coarse-grain group\n   * @return {Boolean} flag\n   */\n  isCg () {\n    const backboneType = this.residueType.backboneType\n    return (\n      backboneType === CgProteinBackboneType ||\n      backboneType === CgRnaBackboneType ||\n      backboneType === CgDnaBackboneType\n    )\n  }\n\n  isTrace () {\n    return this.index === (this.residueType.traceAtomIndex + this.residueAtomOffset)\n  }\n\n  /**\n   * If atom is part of a hetero group\n   * @return {Boolean} flag\n   */\n  isHetero () {\n    return this.residueType.hetero === 1\n  }\n\n  /**\n   * If atom is part of a protein molecule\n   * @return {Boolean} flag\n   */\n  isProtein () {\n    return this.residueType.moleculeType === ProteinType\n  }\n\n  /**\n   * If atom is part of a nucleic molecule\n   * @return {Boolean} flag\n   */\n  isNucleic () {\n    const moleculeType = this.residueType.moleculeType\n    return moleculeType === RnaType || moleculeType === DnaType\n  }\n\n  /**\n   * If atom is part of a rna\n   * @return {Boolean} flag\n   */\n  isRna () {\n    return this.residueType.moleculeType === RnaType\n  }\n\n  /**\n   * If atom is part of a dna\n   * @return {Boolean} flag\n   */\n  isDna () {\n    return this.residueType.moleculeType === DnaType\n  }\n\n  /**\n   * If atom is part of a water molecule\n   * @return {Boolean} flag\n   */\n  isWater () {\n    return this.residueType.moleculeType === WaterType\n  }\n\n  /**\n   * If atom is part of an ion\n   * @return {Boolean} flag\n   */\n  isIon () {\n    return this.residueType.moleculeType === IonType\n  }\n\n  /**\n   * If atom is part of a saccharide\n   * @return {Boolean} flag\n   */\n  isSaccharide () {\n    return this.residueType.moleculeType === SaccharideType\n  }\n\n  /**\n   * If atom is part of a helix\n   * @return {Boolean} flag\n   */\n  isHelix () {\n    return SecStrucHelix.includes(this.sstruc)\n  }\n\n  /**\n   * If atom is part of a sheet\n   * @return {Boolean} flag\n   */\n  isSheet () {\n    return SecStrucSheet.includes(this.sstruc)\n  }\n\n  /**\n   * If atom is part of a turn\n   * @return {Boolean} flag\n   */\n  isTurn () {\n    return SecStrucTurn.includes(this.sstruc) && this.isProtein()\n  }\n\n  isBonded () {\n    return this.bondHash!.countArray[ this.index ] !== 0   // TODO\n  }\n\n  /**\n   * If atom is part of a ring\n   * @return {Boolean} flag\n   */\n  isRing () {\n    const atomRings = this.residueType.getRings()!.atomRings  // TODO\n    return atomRings[ this.index - this.residueAtomOffset ] !== undefined\n  }\n\n  isAromatic () {\n    return this.aromatic === 1\n  }\n\n  isPolarHydrogen () {\n    let result = false\n\n    if (this.number !== 1) return result\n\n    result = !this.hasBondToElement(Elements.C)\n\n    return result\n  }\n\n  isMetal () { return this.atomType.isMetal() }\n  isNonmetal () { return this.atomType.isNonmetal() }\n  isMetalloid () { return this.atomType.isMetalloid() }\n  isHalogen () { return this.atomType.isHalogen() }\n  isDiatomicNonmetal () { return this.atomType.isDiatomicNonmetal() }\n  isPolyatomicNonmetal () { return this.atomType.isPolyatomicNonmetal() }\n  isAlkaliMetal () { return this.atomType.isAlkaliMetal() }\n  isAlkalineEarthMetal () { return this.atomType.isAlkalineEarthMetal() }\n  isNobleGas () { return this.atomType.isNobleGas() }\n  isTransitionMetal () { return this.atomType.isTransitionMetal() }\n  isPostTransitionMetal () { return this.atomType.isPostTransitionMetal() }\n  isLanthanide () { return this.atomType.isLanthanide() }\n  isActinide () { return this.atomType.isActinide() }\n\n  getDefaultValence () { return this.atomType.getDefaultValence() }\n  getValenceList () { return this.atomType.getValenceList() }\n  getOuterShellElectronCount () { return this.atomType.getOuterShellElectronCount() }\n\n  /**\n   * Distance to another atom\n   * @param  {AtomProxy} atom - the other atom\n   * @return {Number} the distance\n   */\n  distanceTo (atom: AtomProxy) {\n    const taa = this.atomStore\n    const aaa = atom.atomStore\n    const ti = this.index\n    const ai = atom.index\n    const x = taa.x[ ti ] - aaa.x[ ai ]\n    const y = taa.y[ ti ] - aaa.y[ ai ]\n    const z = taa.z[ ti ] - aaa.z[ ai ]\n    const distSquared = x * x + y * y + z * z\n    return Math.sqrt(distSquared)\n  }\n\n  /**\n   * If connected to another atom\n   * @param  {AtomProxy} atom - the other atom\n   * @return {Boolean} flag\n   */\n  connectedTo (atom: AtomProxy) {\n    const taa = this.atomStore\n    const aaa = atom.atomStore\n    const ti = this.index\n    const ai = atom.index\n\n    if (taa.altloc && aaa.altloc) {\n      const ta = taa.altloc[ ti ]  // use Uint8 value to compare\n      const aa = aaa.altloc[ ai ]  // no need to convert to char\n      // 0 is the Null character, 32 is the space character\n      if (!(ta === 0 || aa === 0 || ta === 32 || aa === 32 || (ta === aa))) return false\n    }\n\n    const x = taa.x[ ti ] - aaa.x[ ai ]\n    const y = taa.y[ ti ] - aaa.y[ ai ]\n    const z = taa.z[ ti ] - aaa.z[ ai ]\n\n    const distSquared = x * x + y * y + z * z\n\n    // if( this.isCg() ) console.log( this.qualifiedName(), Math.sqrt( distSquared ), distSquared )\n    if (distSquared < 48.0 && this.isCg()) return true\n\n    if (isNaN(distSquared)) return false\n\n    const d = this.covalent + atom.covalent\n    const d1 = d + 0.3\n    const d2 = d - 0.5\n\n    return distSquared < (d1 * d1) && distSquared > (d2 * d2)\n  }\n\n  /**\n   * Set atom position from array\n   * @param  {Array|TypedArray} array - input array\n   * @param  {Integer} [offset] - the offset\n   * @return {AtomProxy} this object\n   */\n  positionFromArray (array: NumberArray, offset = 0) {\n    this.x = array[ offset + 0 ]\n    this.y = array[ offset + 1 ]\n    this.z = array[ offset + 2 ]\n\n    return this\n  }\n\n  /**\n   * Write atom position to array\n   * @param  {Array|TypedArray} [array] - target array\n   * @param  {Integer} [offset] - the offset\n   * @return {Array|TypedArray} target array\n   */\n  positionToArray (array: NumberArray = [], offset = 0) {\n    const index = this.index\n    const atomStore = this.atomStore\n\n    array[ offset + 0 ] = atomStore.x[ index ]\n    array[ offset + 1 ] = atomStore.y[ index ]\n    array[ offset + 2 ] = atomStore.z[ index ]\n\n    return array\n  }\n\n  /**\n   * Write atom position to vector\n   * @param  {Vector3} [v] - target vector\n   * @return {Vector3} target vector\n   */\n  positionToVector3 (v?: Vector3) {\n    if (v === undefined) v = new Vector3()\n\n    v.x = this.x\n    v.y = this.y\n    v.z = this.z\n\n    return v\n  }\n\n  /**\n   * Set atom position from vector\n   * @param  {Vector3} v - input vector\n   * @return {AtomProxy} this object\n   */\n  positionFromVector3 (v: Vector3) {\n    this.x = v.x\n    this.y = v.y\n    this.z = v.z\n\n    return this\n  }\n\n  /**\n   * Add vector to atom position\n   * @param  {Vector3} v - input vector\n   * @return {AtomProxy} this object\n   */\n  positionAdd (v: Vector3|AtomProxy) {\n    this.x += v.x\n    this.y += v.y\n    this.z += v.z\n\n    return this\n  }\n\n  /**\n   * Subtract vector from atom position\n   * @param  {Vector3} v - input vector\n   * @return {AtomProxy} this object\n   */\n  positionSub (v: Vector3|AtomProxy) {\n    this.x -= v.x\n    this.y -= v.y\n    this.z -= v.z\n\n    return this\n  }\n\n  /**\n   * Get intra group/residue bonds\n   * @param  {Boolean} firstOnly - immediately return the first connected atomIndex\n   * @return {Integer[]|Integer|undefined} connected atomIndices\n   */\n  getResidueBonds (firstOnly = false) {\n    const residueAtomOffset = this.residueAtomOffset\n    const relativeIndex = this.index - this.residueAtomOffset\n    const bonds = this.residueType.getBonds()!  // TODO\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n    let idx1, idx2, connectedAtomIndex\n    let connectedAtomIndices: number[]|undefined\n\n    if (!firstOnly) connectedAtomIndices = []\n\n    idx1 = atomIndices1.indexOf(relativeIndex)\n    while (idx1 !== -1) {\n      connectedAtomIndex = atomIndices2[ idx1 ] + residueAtomOffset\n      if (connectedAtomIndices) {\n        connectedAtomIndices.push(connectedAtomIndex)\n        idx1 = atomIndices1.indexOf(relativeIndex, idx1 + 1)\n      } else {\n        return connectedAtomIndex\n      }\n    }\n\n    idx2 = atomIndices2.indexOf(relativeIndex)\n    while (idx2 !== -1) {\n      connectedAtomIndex = atomIndices1[ idx2 ] + residueAtomOffset\n      if (connectedAtomIndices) {\n        connectedAtomIndices.push(connectedAtomIndex)\n        idx2 = atomIndices2.indexOf(relativeIndex, idx2 + 1)\n      } else {\n        return connectedAtomIndex\n      }\n    }\n\n    return connectedAtomIndices\n  }\n\n  //\n\n  qualifiedName (noResname = false) {\n    var name = ''\n    if (this.resname && !noResname) name += '[' + this.resname + ']'\n    if (this.resno !== undefined) name += this.resno\n    if (this.inscode) name += '^' + this.inscode\n    if (this.chainname) name += ':' + this.chainname\n    if (this.atomname) name += '.' + this.atomname\n    if (this.altloc) name += '%' + this.altloc\n    if (this.structure.modelStore.count > 1) name += '/' + this.modelIndex\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {AtomProxy} cloned atom\n   */\n  clone () {\n    return new AtomProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      residueIndex: this.residueIndex,\n\n      resname: this.resname,\n      x: this.x,\n      y: this.y,\n      z: this.z,\n      element: this.element,\n      chainname: this.chainname,\n      resno: this.resno,\n      serial: this.serial,\n      vdw: this.vdw,\n      covalent: this.covalent,\n      hetero: this.hetero,\n      bfactor: this.bfactor,\n      altloc: this.altloc,\n      atomname: this.atomname,\n      modelIndex: this.modelIndex\n    }\n  }\n}\n\nexport default AtomProxy\n","/**\n * @file Kdtree\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport _Kdtree from '../utils/kdtree'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\n\nfunction euclideanDistSq(a: number[], b: number[]) {\n  const dx = a[0] - b[0]\n  const dy = a[1] - b[1]\n  const dz = a[2] - b[2]\n  return dx * dx + dy * dy + dz * dz\n}\n\nfunction euclideanDist(a: number[], b: number[]) {\n  return Math.sqrt(euclideanDistSq(a, b))\n}\n\nconst pointArray = new Float32Array(3)\n\nclass Kdtree {\n  points: Float32Array\n  atomIndices: Uint32Array\n  kdtree: _Kdtree\n\n  constructor(structure: Structure|ResidueProxy, useSquaredDist = false) {\n    if (Debug) Log.time('Kdtree build')\n\n    const metric = useSquaredDist ? euclideanDistSq : euclideanDist\n\n    const points = new Float32Array(structure.atomCount * 3)\n    const atomIndices = new Uint32Array(structure.atomCount)\n    let i = 0\n\n    structure.eachAtom(function (ap) {\n      points[ i + 0 ] = ap.x\n      points[ i + 1 ] = ap.y\n      points[ i + 2 ] = ap.z\n      atomIndices[ i / 3 ] = ap.index\n      i += 3\n    })\n\n    this.atomIndices = atomIndices\n    this.points = points\n    this.kdtree = new _Kdtree(points, metric)\n\n    if (Debug) Log.timeEnd('Kdtree build')\n\n      // console.log(\"this.kdtree.verify()\", this.kdtree.verify())\n  }\n\n  nearest (point: number[]|Vector3, maxNodes: number, maxDistance: number) {\n    // Log.time( \"Kdtree nearest\" );\n\n    if (point instanceof Vector3) {\n      point.toArray(pointArray as any)\n    } else if (point instanceof AtomProxy) {\n      point.positionToArray(pointArray)\n    }\n\n    const nodeList = this.kdtree.nearest(pointArray, maxNodes, maxDistance)\n\n    const indices = this.kdtree.indices\n    const nodes = this.kdtree.nodes\n    const atomIndices = this.atomIndices\n    const resultList = []\n\n    for (let i = 0, n = nodeList.length; i < n; ++i) {\n      const d = nodeList[ i ]\n      const nodeIndex = d[ 0 ]\n      const dist = d[ 1 ]\n\n      resultList.push({\n        index: atomIndices[ indices[ nodes[ nodeIndex ] ] ],\n        distance: dist\n      })\n    }\n\n    // Log.timeEnd( \"Kdtree nearest\" );\n\n    return resultList\n  }\n}\n\nexport default Kdtree\n","/**\n * @file Symmetry Constants\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport const SymOpCode: { [k: string]: string } = {\n  ' ': 'X',\n  '!': 'Y',\n  '#': 'Z',\n  '$': '-X',\n  '%': '-Y',\n  '&': '-Z',\n  \"'\": 'Y+1/2',\n  '(': '1/2+X',\n  ')': '1/2+Y',\n  '*': '1/2-X',\n  '+': '1/2+Z',\n  ',': '1/2-Y',\n  '-': '1/2-Z',\n  '.': 'X+1/2',\n  '/': 'Z+1/2',\n  '0': '-X+1/2',\n  '1': '-Y+1/2',\n  '2': '-Z+1/2',\n  '3': '1/4+X',\n  '4': '1/4-Y',\n  '5': '1/4+Z',\n  '6': '1/4-X',\n  '7': '1/4+Y',\n  '8': '3/4-Y',\n  '9': '3/4+Z',\n  ':': '3/4+Y',\n  ';': '3/4+X',\n  '<': '3/4-X',\n  '=': '1/4-Z',\n  '>': '3/4-Z',\n  '?': 'X-Y',\n  '@': 'Y-X',\n  'A': 'Z+1/3',\n  'B': 'Z+2/3',\n  'C': 'X+2/3',\n  'D': 'Y+1/3',\n  'E': '-Y+2/3',\n  'F': 'X-Y+1/3',\n  'G': 'Y-X+2/3',\n  'H': '-X+1/3',\n  'I': 'X+1/3',\n  'J': 'Y+2/3',\n  'K': '-Y+1/3',\n  'L': 'X-Y+2/3',\n  'M': 'Y-X+1/3',\n  'N': '-X+2/3',\n  'O': '2/3+X',\n  'P': '1/3+Y',\n  'Q': '1/3+Z',\n  'R': '2/3-Y',\n  'S': '1/3+X-Y',\n  'T': '2/3+Y-X',\n  'U': '1/3-X',\n  'V': '2/3-X',\n  'W': '1/3-Y',\n  'X': '1/3-Z',\n  'Y': '2/3+Y',\n  'Z': '1/3+Y-X',\n  '[': '2/3+X-Y',\n  ']': '1/3+X',\n  '^': '2/3+Z',\n  '_': '2/3-Z',\n  '`': '5/6+Z',\n  'a': '1/6+Z',\n  'b': '5/6-Z',\n  'c': '1/6-Z',\n  'd': 'Z+5/6',\n  'e': 'Z+1/6',\n  'f': 'Z+1/4',\n  'g': '+Y'\n}\n\n// encoded, originally from CCP4 symop.lib\nexport const EncodedSymOp: { [k: string]: string } = {\n  'P 1': ' !#',\n  'P -1': ' !#$%&',\n  'P 1 2 1': ' !#$!&',\n  'P 1 21 1': \" !#$'&\",\n  'C 1 2 1': ' !#$!&()#*)&',\n  'P 1 m 1': ' !# %#',\n  'P 1 c 1': ' !# %+',\n  'C 1 m 1': ' !# %#()#(,#',\n  'C 1 c 1': ' !# %+()#(,+',\n  'P 1 2/m 1': ' !# %#$!&$%&',\n  'P 1 21/m 1': ' !#$)&$%& ,#',\n  'C 1 2/m 1': ' !# %#$!&$%&()#(,#*)&*,&',\n  'P 1 2/c 1': ' !#$!-$%& %+',\n  'P 1 21/c 1': ' !#$%&$)- ,+',\n  'C 1 2/c 1': ' !#$!-$%& %+()#*)-*,&(,+',\n  'P 2 2 2': ' !#$%#$!& %&',\n  'P 2 2 21': ' !#$%+$!- %&',\n  'P 21 21 2': ' !#$%#*)&(,&',\n  'P 21 21 21': ' !#*%+$)-(,&',\n  'C 2 2 21': ' !#$%+$!- %&()#*,+*)-(,&',\n  'C 2 2 2': ' !#$%#$!& %&()#*,#*)&(,&',\n  'F 2 2 2': ' !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&',\n  'I 2 2 2': \" !#$%# %&$!&.'/01/.120'2\",\n  'I 21 21 21': ' !#*%+$)-(,&()+$,#*!& %-',\n  'P m m 2': ' !#$%# %#$!#',\n  'P m c 21': ' !#$%+ %+$!#',\n  'P c c 2': ' !#$%# %+$!+',\n  'P m a 2': ' !#$%#(%#*!#',\n  'P c a 21': ' !#$%+(%#*!+',\n  'P n c 2': ' !#$%# ,+$)+',\n  'P m n 21': ' !#*%+(%+$!#',\n  'P b a 2': ' !#$%#(,#*)#',\n  'P n a 21': ' !#$%+(,#*)+',\n  'P n n 2': ' !#$%#(,+*)+',\n  'C m m 2': ' !#$%# %#$!#()#*,#(,#*)#',\n  'C m c 21': ' !#$%+ %+$!#()#*,+(,+*)#',\n  'C c c 2': ' !#$%# %+$!+()#*,#(,+*)+',\n  'A m m 2': ' !#$%# %#$!# )+$,+ ,+$)+',\n  'A b m 2': ' !#$%# ,#$)# )+$,+ %+$!+',\n  'A m a 2': ' !#$%#(%#*!# )+$,+(,+*)+',\n  'A b a 2': ' !#$%#(,#*)# )+$,+(%+*!+',\n  'F m m 2': ' !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#',\n  'F d d 2': ' !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5',\n  'I m m 2': ' !#$%# %#$!#()+*,+(,+*)+',\n  'I b a 2': ' !#$%#(,#*)#()+*,+ %+$!+',\n  'I m a 2': ' !#$%#(%#*!#()+*,+ ,+$)+',\n  'P 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!#',\n  'P 2/n 2/n 2/n': ' !#$%#$!& %&*,-()-(,+*)+',\n  'P 2/c 2/c 2/m': ' !#$%#$!- %-$%& !& %+$!+',\n  'P 2/b 2/a 2/n': ' !#$%#$!& %&*,&()&(,#*)#',\n  'P 21/m 2/m 2/a': ' !#*%#$!&(%&$%&(!& %#*!#',\n  'P 2/n 21/n 2/a': ' !#*%#*)- ,-$%&(!&(,+$)+',\n  'P 2/m 2/n 21/a': ' !#*%+*!- %&$%&(!-(%+$!#',\n  'P 21/c 2/c 2/a': ' !#*%#$!-(%-$%&(!& %+*!+',\n  'P 21/b 21/a 2/m': ' !#$%#*)&(,&$%& !&(,#*)#',\n  'P 21/c 21/c 2/n': ' !#*,#$)-(%-$%&()& ,+*!+',\n  'P 2/b 21/c 21/m': ' !#$%+$)- ,&$%& !- ,+$)#',\n  'P 21/n 21/n 2/m': ' !#$%#*)-(,-$%& !&(,+*)+',\n  'P 21/m 21/m 2/n': \" !#$%#*'&.,&*,&.'& %#$!#\",\n  'P 21/b 2/c 21/n': ' !#*,+$!-(,&$%&()- %+*)#',\n  'P 21/b 21/c 21/a': ' !#*%+$)-(,&$%&(!- ,+*)#',\n  'P 21/n 21/m 21/a': \" !#0%/$'&.12$%&.!2 1#0'/\",\n  'C 2/m 2/c 21/m': ' !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#',\n  'C 2/m 2/c 21/a': ' !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#',\n  'C 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#',\n  'C 2/c 2/c 2/m': ' !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+',\n  'C 2/m 2/m 2/a': ' !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#',\n  'C 2/c 2/c 2/a': ' !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+',\n  'F 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#',\n  'F 2/d 2/d 2/d': ' !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5',\n  'I 2/m 2/m 2/m': ' !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+',\n  'I 2/b 2/a 2/m': ' !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+',\n  'I 21/b 21/c 21/a': ' !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+',\n  'I 21/m 21/m 21/a': ' !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+',\n  'P 4': ' !#$%#% #!$#',\n  'P 41': ' !#$%+% 5!$9',\n  'P 42': ' !#$%#% +!$+',\n  'P 43': ' !#$%+% 9!$5',\n  'I 4': ' !#$%#% #!$#()+*,+,(+)*+',\n  'I 41': ' !#*,+%(5)$9()+$%#, 9!*5',\n  'P -4': ' !#$%#!$&% &',\n  'I -4': ' !#$%#!$&% &()+*,+)*-,(-',\n  'P 4/m': ' !#$%#% #!$#$%& !&!$&% &',\n  'P 42/m': ' !#$%#% +!$+$%& !&!$-% -',\n  'P 4/n': ' !#$%#,(#)*#*,&()&!$&% &',\n  'P 42/n': ' !#$%#,(+)*+*,-()-!$&% &',\n  'I 4/m': ' !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-',\n  'I 41/a': ' !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &',\n  'P 4 2 2': ' !#$%#% #!$#$!& %&! &%$&',\n  'P 4 21 2': ' !#$%#,(#)*#*)&(,&! &%$&',\n  'P 41 2 2': ' !#$%+% 5!$9$!& %-! >%$=',\n  'P 41 21 2': ' !#$%+,(5)*9*)=(,>! &%$-',\n  'P 42 2 2': ' !#$%#% +!$+$!& %&! -%$-',\n  'P 42 21 2': ' !#$%#,(+)*+*)-(,-! &%$&',\n  'P 43 2 2': ' !#$%+% 9!$5$!& %-! =%$>',\n  'P 43 21 2': ' !#$%+,(9)*5*)>(,=! &%$-',\n  'I 4 2 2': ' !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-',\n  'I 41 2 2': ' !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-',\n  'P 4 m m': ' !#$%#% #!$# %#$!#%$#! #',\n  'P 4 b m': ' !#$%#% #!$#(,#*)#,*#)(#',\n  'P 42 c m': ' !#$%#% +!$+ %+$!+%$#! #',\n  'P 42 n m': ' !#$%#,(+)*+(,+*)+%$#! #',\n  'P 4 c c': ' !#$%#% #!$# %+$!+%$+! +',\n  'P 4 n c': ' !#$%#% #!$#(,+*)+,*+)(+',\n  'P 42 m c': ' !#$%#% +!$+ %#$!#%$+! +',\n  'P 42 b c': ' !#$%#% +!$+(,#*)#,*+)(+',\n  'I 4 m m': ' !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+',\n  'I 4 c m': ' !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#',\n  'I 41 m d': ' !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5',\n  'I 41 c d': ' !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9',\n  'P -4 2 m': ' !#$%#% &!$&$!& %&%$#! #',\n  'P -4 2 c': ' !#$%#% &!$&$!- %-%$+! +',\n  'P -4 21 m': ' !#$%#% &!$&*)&(,&,*#)(#',\n  'P -4 21 c': ' !#$%#% &!$&*)-(,-,*+)(+',\n  'P -4 m 2': ' !#$%#!$&% & %#$!#! &%$&',\n  'P -4 c 2': ' !#$%#% &!$& %+$!+! -%$-',\n  'P -4 b 2': ' !#$%#% &!$&(,#*)#)(&,*&',\n  'P -4 n 2': ' !#$%#% &!$&(,+*)+)(-,*-',\n  'I -4 m 2': ' !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-',\n  'I -4 c 2': ' !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&',\n  'I -4 2 m': ' !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+',\n  'I -4 2 d': ' !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5',\n  'P 4/m 2/m 2/m': ' !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #',\n  'P 4/m 2/c 2/c': ' !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +',\n  'P 4/n 2/b 2/m': ' !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#',\n  'P 4/n 2/n 2/c': ' !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+',\n  'P 4/m 21/b 2/m': ' !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#',\n  'P 4/m 21/n 2/c': ' !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+',\n  'P 4/n 21/m 2/m': ' !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#',\n  'P 4/n 2/c 2/c': ' !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+',\n  'P 42/m 2/m 2/c': ' !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +',\n  'P 42/m 2/c 2/m': ' !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #',\n  'P 42/n 2/b 2/c': ' !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +',\n  'P 42/n 2/n 2/m': ' !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #',\n  'P 42/m 21/b 2/c': ' !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+',\n  'P 42/m 21/n 2/m': \" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #\",\n  'P 42/n 21/m 2/c': ' !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+',\n  'P 42/n 21/c 2/m': ' !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#',\n  'I 4/m 2/m 2/m': ' !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+',\n  'I 4/m 2/c 2/m': ' !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#',\n  'I 41/a 2/m 2/d': ' !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9',\n  'I 41/a 2/c 2/d': ' !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5',\n  'P 3': ' !#%?#@$#',\n  'P 31': ' !#%?A@$B',\n  'P 32': ' !#%?B@$A',\n  'H 3': ' !#%?#@$#CDAEFAGHAIJBKLBMNB',\n  'R 3': ' !## !!# ',\n  'P -3': ' !#%?#@$#$%&!@&? &',\n  'H -3': ' !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_',\n  'R -3': ' !## !!# $%&&$%%&$',\n  'P 3 1 2': ' !#%?#@$#%$&@!& ?&',\n  'P 3 2 1': ' !#%?#@$#! &?%&$@&',\n  'P 31 1 2': ' !#%?Q@$^%$_@!X ?&',\n  'P 31 2 1': ' !#%?A@$B! &?%_$@X',\n  'P 32 1 2': ' !#%?^@$Q%$X@!_ ?&',\n  'P 32 2 1': ' !#%?B@$A! &?%X$@_',\n  'H 3 2': ' !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_',\n  'R 3 2': ' !## !!# %$&$&%&%$',\n  'P 3 m 1': ' !#%?#@$#%$#@!# ?#',\n  'P 3 1 m': ' !#%?#@$#! #?%#$@#',\n  'P 3 c 1': ' !#%?#@$#%$+@!+ ?+',\n  'P 3 1 c': ' !#%?#@$#! +?%+$@+',\n  'H 3 m': ' !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^',\n  'R 3 m': ' !## !!# ! # #!#! ',\n  'H 3 c': ' !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a',\n  'R 3 c': \" !## !!# '././'/'.\",\n  'P -3 1 2/m': ' !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#',\n  'P -3 1 2/c': ' !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+',\n  'P -3 2/m 1': ' !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#',\n  'P -3 2/c 1': ' !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+',\n  'H -3 2/m': ' !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^',\n  'R -3 2/m': ' !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ',\n  'H -3 2/c': ' !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a',\n  'R -3 2/c': \" !## !!# 102021210$%&&$%%&$'././'/'.\",\n  'P 6': ' !#%?#@$#$%#!@#? #',\n  'P 61': ' !#%?A@$B$%/!@d? e',\n  'P 65': ' !#%?B@$A$%/!@e? d',\n  'P 62': ' !#%?^@$Q$%#!@^? Q',\n  'P 64': ' !#%?Q@$^$%#!@Q? ^',\n  'P 63': ' !#%?#@$#$%+!@+? +',\n  'P -6': ' !#%?#@$# !&%?&@$&',\n  'P 6/m': ' !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&',\n  'P 63/m': ' !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-',\n  'P 6 2 2': ' !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&',\n  'P 61 2 2': ' !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c',\n  'P 65 2 2': ' !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b',\n  'P 62 2 2': ' !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X',\n  'P 64 2 2': ' !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_',\n  'P 63 2 2': ' !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-',\n  'P 6 m m': ' !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#',\n  'P 6 c c': ' !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+',\n  'P 63 c m': ' !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#',\n  'P 63 m c': ' !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+',\n  'P -6 m 2': ' !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&',\n  'P -6 c 2': ' !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&',\n  'P -6 2 m': ' !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#',\n  'P -6 2 c': ' !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+',\n  'P 6/m 2/m 2/m': ' !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#',\n  'P 6/m 2/c 2/c': ' !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+',\n  'P 63/m 2/c 2/m': ' !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#',\n  'P 63/m 2/m 2/c': ' !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+',\n  'P 2 3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ',\n  'F 2 3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ',\n  'I 2 3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(',\n  'P 21 3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(',\n  'I 21 3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ',\n  'P 2/m -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$',\n  'P 2/n -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*',\n  'F 2/m -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$',\n  'F 2/d -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96',\n  'I 2/m -3': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*',\n  'P 21/a -3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*',\n  'I 21/a -3': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$',\n  'P 4 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$',\n  'P 42 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*',\n  'F 4 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$',\n  'F 41 3 2': ' !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86',\n  'I 4 3 2': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*',\n  'P 43 3 2': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46',\n  'P 41 3 2': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<',\n  'I 41 3 2': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46',\n  'P -4 3 m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ',\n  'F -4 3 m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ',\n  'I -4 3 m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(',\n  'P -4 3 n': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(',\n  'F -4 3 c': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(',\n  'I -4 3 d': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43',\n  'P 4/m -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ',\n  'P 4/n -3 2/n': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(',\n  'P 42/m -3 2/n': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(',\n  'P 42/n -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ',\n  'F 4/m -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ',\n  'F 4/m -3 2/c': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(',\n  'F 41/d -3 2/m': ' !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ',\n  'F 41/d -3 2/c': ' !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(',\n  'I 4/m -3 2/m': ' !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(',\n  'I 41/a -3 2/d': ' !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;',\n  'P 1 1 2': ' !#$%#',\n  'P 1 1 21': ' !#$%+',\n  'B 1 1 2': ' !#$%#(g+*%+',\n  'A 1 2 1': ' !#$!& )+$)-',\n  'C 1 21 1': ' !#$)&()#*!&',\n  'I 1 2 1': \" !#$!&.'/0'2\",\n  'I 1 21 1': \" !#$)&.'/0!-\",\n  'P 1 1 m': ' !# !&',\n  'P 1 1 b': ' !# )&',\n  'B 1 1 m': ' !# !&(!+(!-',\n  'B 1 1 b': ' !# )&(!+()-',\n  'P 1 1 2/m': ' !# !&$%#$%&',\n  'P 1 1 21/m': ' !#$%+$%& !-',\n  'B 1 1 2/m': ' !# !&$%#$%&(!+(!-*%+*%-',\n  'P 1 1 2/b': ' !#$,#$%& )&',\n  'P 1 1 21/b': ' !#$%&$,+ )-',\n  'B 1 1 2/b': ' !#$,#$%& )&(!+*,+*%-()-',\n  'P 21 2 2': ' !#$!&(%&*%#',\n  'P 2 21 2': ' !# ,&$)&$%#',\n  'P 21 21 2 (a)': \" !#*,#.%&$'&\",\n  'P 21 2 21': ' !#$!&(%-*%+',\n  'P 2 21 21': ' !# %&$)-$,+',\n  'C 2 2 21a)': ' !#*%+(,&$)-()#$,+ %&*!-',\n  'C 2 2 2a': \" !#*,#.%&$'&()#$%# ,&*!&\",\n  'F 2 2 2a': \" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&\",\n  'I 2 2 2a': \" !#*,#.%&$'&()+$%+*!- ,-\",\n  'P 21/m 21/m 2/n a': \" !#*,#$)&(%&$%&.'& ,#*!#\",\n  'P 42 21 2a': \" !#*,#%.+'$+$'&.%&! -,*-\",\n  'I 2 3a': \" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,\"\n}\n","/**\n * @file Symmetry Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Log } from '../globals'\nimport { EncodedSymOp, SymOpCode } from './symmetry-constants'\n\nconst reInteger = /^[1-9]$/\n\nexport function getSymmetryOperations (spacegroup: string) {\n  const encodedSymopList = EncodedSymOp[ spacegroup ]\n  const matrixDict: { [k: string]: Matrix4 } = {}\n\n  if (encodedSymopList === undefined) {\n    console.warn(`spacegroup '${spacegroup}' not found in symop library`)\n    return matrixDict\n  }\n\n  const symopList = []\n  for (let i = 0, il = encodedSymopList.length; i < il; i += 3) {\n    const symop = []\n    for (let j = 0; j < 3; ++j) {\n      symop.push(SymOpCode[ encodedSymopList[ i + j ] ])\n    }\n    symopList.push(symop)\n  }\n\n  symopList.forEach(function (symop) {\n    let row = 0\n    const matrix = new Matrix4().set(\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 1\n    )\n    const me = matrix.elements\n\n    matrixDict[ symop.toString() ] = matrix\n\n    symop.forEach(function (elm) {\n      let negate = false\n      let denominator = false\n\n      for (let i = 0, n = elm.length; i < n; ++i) {\n        const c = elm[ i ]\n\n        if (c === '-') {\n          negate = true\n        } else if (c === '+') {\n          negate = false\n        } else if (c === '/') {\n          denominator = true\n        } else if (c === 'X') {\n          me[ 0 + row ] = negate ? -1 : 1\n        } else if (c === 'Y') {\n          me[ 4 + row ] = negate ? -1 : 1\n        } else if (c === 'Z') {\n          me[ 8 + row ] = negate ? -1 : 1\n        } else if (reInteger.test(c)) {\n          const integer = parseInt(c)\n          if (denominator) {\n            me[ 12 + row ] /= integer\n          } else {\n            me[ 12 + row ] = integer\n          }\n        } else {\n          Log.warn(`getSymmetryOperations: unknown token '${c}'`)\n        }\n      }\n\n      row += 1\n    })\n  })\n\n  return matrixDict\n}\n","/**\n * @file Assembly\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Box3, Vector3 } from 'three'\n\nimport { uniqueArray } from '../utils'\nimport Selection from '../selection/selection'\nimport Structure from '../structure/structure'\nimport StructureView from '../structure/structure-view';\n\nfunction selectionFromChains (chainList: string[]) {\n  let sele = ''\n  if (chainList.length > 0) {\n    sele = ':' + uniqueArray(chainList).join(' OR :')\n  }\n  return new Selection(sele)\n}\n\n/**\n * Assembly of transformed parts of a {@link Structure}\n */\nclass Assembly {\n  partList: AssemblyPart[] = []\n\n  /**\n   * @param {String} name - assembly name\n   */\n  constructor (readonly name = '') {}\n\n  get type () { return 'Assembly' }\n\n  /**\n   * Add transformed parts to the assembly\n   * @example\n   * var m1 = new NGL.Matrix4().set( ... );\n   * var m2 = new NGL.Matrix4().set( ... );\n   * var assembly = new NGL.Assembly( \"myAssembly\" );\n   * // add part that transforms chain 'A' and 'B' using matrices `m1` and `m2`\n   * assembly.addPart( [ m1, m2 ], [ \"A\", \"B\" ] )\n   *\n   * @param {Matrix4[]} matrixList - array of 4x4 transformation matrices\n   * @param {String[]} chainList - array of chain names\n   * @return {AssemblyPart} the added assembly part\n   */\n  addPart (matrixList?: Matrix4[], chainList?: string[]) {\n    const part = new AssemblyPart(matrixList, chainList)\n    this.partList.push(part)\n    return part\n  }\n\n  /**\n   * Get the number of atom for a given structure\n   * @param  {Structure} structure - the given structure\n   * @return {Integer} number of atoms in the assembly\n   */\n  getAtomCount (structure: Structure) {\n    return this.partList.reduce(\n      (count, part) => count + part.getAtomCount(structure), 0\n    )\n  }\n\n  /**\n   * Get the number of residues for a given structure\n   * @param  {Structure} structure - the given structure\n   * @return {Integer} number of residues in the assembly\n   */\n  getResidueCount (structure: Structure) {\n    return this.partList.reduce(\n      (count, part) => count + part.getResidueCount(structure), 0\n    )\n  }\n\n  /**\n   * Get number of instances the assembly will produce, i.e.\n   * the number of transformations performed by the assembly\n   * @return {Integer} number of instances\n   */\n  getInstanceCount () {\n    let instanceCount = 0\n\n    this.partList.forEach(function (part) {\n      instanceCount += part.matrixList.length\n    })\n\n    return instanceCount\n  }\n\n  /**\n   * Determine if the assembly is the full and untransformed structure\n   * @param  {Structure}  structure - the given structure\n   * @return {Boolean} whether the assembly is identical to the structure\n   */\n  isIdentity (structure: Structure) {\n    if (this.partList.length !== 1) return false\n\n    const part = this.partList[ 0 ]\n    if (part.matrixList.length !== 1) return false\n\n    const identityMatrix = new Matrix4()\n    if (!identityMatrix.equals(part.matrixList[ 0 ])) return false\n\n    let structureChainList: string[] = []\n    structure.eachChain(function (cp) {\n      structureChainList.push(cp.chainname)\n    })\n    structureChainList = uniqueArray(structureChainList)\n    if (part.chainList.length !== structureChainList.length) return false\n\n    return true\n  }\n\n  getBoundingBox (structure: Structure) {\n    const boundingBox = new Box3()\n\n    this.partList.forEach(function (part) {\n      const partBox = part.getBoundingBox(structure)\n      boundingBox.expandByPoint(partBox.min)\n      boundingBox.expandByPoint(partBox.max)\n    })\n\n    return boundingBox\n  }\n\n  getCenter (structure: Structure) {\n    return this.getBoundingBox(structure).getCenter(new Vector3())\n  }\n\n  getSelection () {\n    let chainList: string[] = []\n    this.partList.forEach(function (part) {\n      chainList = chainList.concat(part.chainList)\n    })\n    return selectionFromChains(chainList)\n  }\n}\n\nexport class AssemblyPart {\n  constructor (readonly matrixList: Matrix4[] = [], readonly chainList: string[] = []) {}\n\n  get type () { return 'AssemblyPart' }\n\n  _getCount (structure: Structure, propertyName: 'atomCount'|'residueCount') {\n    let count = 0\n\n    structure.eachChain(cp => {\n      if (this.chainList.length === 0 || this.chainList.includes(cp.chainname)) {\n        count += cp[ propertyName ]\n      }\n    })\n\n    return this.matrixList.length * count\n  }\n\n  getAtomCount (structure: Structure) {\n    return this._getCount(structure, 'atomCount')\n  }\n\n  getResidueCount (structure: Structure) {\n    return this._getCount(structure, 'residueCount')\n  }\n\n  getBoundingBox (structure: Structure) {\n    const partBox = new Box3()\n    const instanceBox = new Box3()\n\n    const selection = this.getSelection()\n    const structureBox = structure.getBoundingBox(selection)\n\n    this.matrixList.forEach(function (matrix) {\n      instanceBox.copy(structureBox).applyMatrix4(matrix)\n      partBox.expandByPoint(instanceBox.min)\n      partBox.expandByPoint(instanceBox.max)\n    })\n\n    return partBox\n  }\n\n  getSelection () {\n    return selectionFromChains(this.chainList)\n  }\n\n  getView (structure: Structure): Structure | StructureView {\n    const selection = this.getSelection()\n    if (selection) {\n      return structure.getView(selection)\n    } else {\n      return structure\n    }\n  }\n\n  getInstanceList () {\n    const instanceList = []\n    for (let j = 0, jl = this.matrixList.length; j < jl; ++j) {\n      instanceList.push({\n        id: j + 1,\n        name: j,\n        matrix: this.matrixList[ j ]\n      })\n    }\n    return instanceList\n  }\n}\n\nexport default Assembly\n","/**\n * @file Structure Builder\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from './structure'\n\nclass StructureBuilder {\n  currentModelindex: number|null = null\n  currentChainid: string|null = null\n  currentResname: string|null = null\n  currentResno: number|null = null\n  currentInscode: string|undefined = undefined\n  currentHetero: boolean|null = null\n\n  previousResname: string|null = ''\n  previousHetero: boolean|null = null\n\n  ai = -1\n  ri = -1\n  ci = -1\n  mi = -1\n\n  constructor(readonly structure: Structure) {}\n\n  addResidueType (ri: number) {\n    const atomStore = this.structure.atomStore\n    const residueStore = this.structure.residueStore\n    const residueMap = this.structure.residueMap\n\n    const count = residueStore.atomCount[ ri ]\n    const offset = residueStore.atomOffset[ ri ]\n    const atomTypeIdList = new Array(count)\n    for (let i = 0; i < count; ++i) {\n      atomTypeIdList[ i ] = atomStore.atomTypeId[ offset + i ]\n    }\n    residueStore.residueTypeId[ ri ] = residueMap.add(\n      this.previousResname!, atomTypeIdList, this.previousHetero!  // TODO\n    )\n  }\n\n  addAtom (modelindex: number, chainname: string, chainid: string, resname: string, resno: number, hetero: boolean, sstruc?: string|undefined, inscode?: string|undefined) {\n    const atomStore = this.structure.atomStore\n    const residueStore = this.structure.residueStore\n    const chainStore = this.structure.chainStore\n    const modelStore = this.structure.modelStore\n\n    let addModel = false\n    let addChain = false\n    let addResidue = false\n\n    if (this.currentModelindex !== modelindex) {\n      addModel = true\n      addChain = true\n      addResidue = true\n      this.mi += 1\n      this.ci += 1\n      this.ri += 1\n    } else if (this.currentChainid !== chainid) {\n      addChain = true\n      addResidue = true\n      this.ci += 1\n      this.ri += 1\n    } else if (this.currentResno !== resno || this.currentResname !== resname || this.currentInscode !== inscode) {\n      addResidue = true\n      this.ri += 1\n    }\n    this.ai += 1\n\n    if (addModel) {\n      modelStore.growIfFull()\n      modelStore.chainOffset[ this.mi ] = this.ci\n      modelStore.chainCount[ this.mi ] = 0\n      modelStore.count += 1\n      chainStore.modelIndex[ this.ci ] = this.mi\n    }\n\n    if (addChain) {\n      chainStore.growIfFull()\n      chainStore.setChainname(this.ci, chainname)\n      chainStore.setChainid(this.ci, chainid)\n      chainStore.residueOffset[ this.ci ] = this.ri\n      chainStore.residueCount[ this.ci ] = 0\n      chainStore.count += 1\n      chainStore.modelIndex[ this.ci ] = this.mi\n      modelStore.chainCount[ this.mi ] += 1\n      residueStore.chainIndex[ this.ri ] = this.ci\n    }\n\n    if (addResidue) {\n      this.previousResname = this.currentResname\n      this.previousHetero = this.currentHetero\n      if (this.ri > 0) this.addResidueType(this.ri - 1)\n      residueStore.growIfFull()\n      residueStore.resno[ this.ri ] = resno\n      if (sstruc !== undefined) {\n        residueStore.sstruc[ this.ri ] = sstruc.charCodeAt(0)\n      }\n      if (inscode !== undefined) {\n        residueStore.inscode[ this.ri ] = inscode.charCodeAt(0)\n      }\n      residueStore.atomOffset[ this.ri ] = this.ai\n      residueStore.atomCount[ this.ri ] = 0\n      residueStore.count += 1\n      residueStore.chainIndex[ this.ri ] = this.ci\n      chainStore.residueCount[ this.ci ] += 1\n    }\n\n    atomStore.count += 1\n    atomStore.residueIndex[ this.ai ] = this.ri\n    residueStore.atomCount[ this.ri ] += 1\n\n    this.currentModelindex = modelindex\n    this.currentChainid = chainid\n    this.currentResname = resname\n    this.currentResno = resno\n    this.currentInscode = inscode\n    this.currentHetero = hetero\n  }\n\n  finalize () {\n    this.previousResname = this.currentResname\n    this.previousHetero = this.currentHetero\n    if (this.ri > -1) this.addResidueType(this.ri)\n  }\n}\n\nexport default StructureBuilder\n","/**\n * @file Structure Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport { binarySearchIndexOf } from '../utils'\nimport Helixbundle from '../geometry/helixbundle'\nimport Kdtree from '../geometry/kdtree'\nimport { getSymmetryOperations } from '../symmetry/symmetry-utils'\nimport Assembly from '../symmetry/assembly'\nimport Structure from '../structure/structure'\nimport StructureBuilder from '../structure/structure-builder'\nimport Polymer from '../proxy/polymer'\nimport ResidueProxy from '../proxy/residue-proxy'\n\nimport { UnknownBackboneType, AA3, Bases } from './structure-constants'\n\nexport function reorderAtoms (structure: Structure) {\n  if (Debug) Log.time('reorderAtoms')\n\n  var ap1 = structure.getAtomProxy()\n  var ap2 = structure.getAtomProxy()\n\n  function compareModelChainResno (index1: number, index2: number) {\n    ap1.index = index1\n    ap2.index = index2\n    if (ap1.modelIndex < ap2.modelIndex) {\n      return -1\n    } else if (ap1.modelIndex > ap2.modelIndex) {\n      return 1\n    } else {\n      if (ap1.chainname < ap2.chainname) {\n        return -1\n      } else if (ap1.chainname > ap2.chainname) {\n        return 1\n      } else {\n        if (ap1.resno < ap2.resno) {\n          return -1\n        } else if (ap1.resno > ap2.resno) {\n          return 1\n        } else {\n          return 0\n        }\n      }\n    }\n  }\n\n  structure.atomStore.sort(compareModelChainResno)\n\n  if (Debug) Log.timeEnd('reorderAtoms')\n}\n\nexport interface SecStruct {\n  helices: [string, number, string, string, number, string, number][]\n  sheets: [string, number, string, string, number, string][]\n}\n\nexport function assignSecondaryStructure (structure: Structure, secStruct: SecStruct) {\n  if (!secStruct) return\n\n  if (Debug) Log.time('assignSecondaryStructure')\n\n  const chainnames: string[] = []\n  structure.eachModel(function (mp) {\n    mp.eachChain(function (cp) {\n      chainnames.push(cp.chainname)\n    })\n  })\n\n  const chainnamesSorted = chainnames.slice().sort()\n  const chainnamesIndex: number[] = []\n  chainnamesSorted.forEach(function (c) {\n    chainnamesIndex.push(chainnames.indexOf(c))\n  })\n\n    // helix assignment\n\n  const helices = secStruct.helices.filter(function (h) {\n    return binarySearchIndexOf(chainnamesSorted, h[ 0 ]) >= 0\n  })\n\n  helices.sort(function (h1, h2) {\n    const c1 = h1[ 0 ]\n    const c2 = h2[ 0 ]\n    const r1 = h1[ 1 ]\n    const r2 = h2[ 1 ]\n\n    if (c1 === c2) {\n      if (r1 === r2) {\n        return 0\n      } else {\n        return r1 < r2 ? -1 : 1\n      }\n    } else {\n      const idx1 = binarySearchIndexOf(chainnamesSorted, c1)\n      const idx2 = binarySearchIndexOf(chainnamesSorted, c2)\n      return chainnamesIndex[ idx1 ] < chainnamesIndex[ idx2 ] ? -1 : 1\n    }\n  })\n\n  const residueStore = structure.residueStore\n\n  structure.eachModel(function (mp) {\n    let i = 0\n    const n = helices.length\n    if (n === 0) return\n    let helix = helices[ i ]\n    let helixRun = false\n    let done = false\n\n    mp.eachChain(function (cp) {\n      let chainChange = false\n\n      if (cp.chainname === helix[ 0 ]) {\n        const count = cp.residueCount\n        const offset = cp.residueOffset\n        const end = offset + count\n\n        for (let j = offset; j < end; ++j) {\n          if (residueStore.resno[ j ] === helix[ 1 ] &&  // resnoBeg\n              residueStore.getInscode(j) === helix[ 2 ]   // inscodeBeg\n          ) {\n            helixRun = true\n          }\n\n          if (helixRun) {\n            residueStore.sstruc[ j ] = helix[ 6 ]\n\n            if (residueStore.resno[ j ] === helix[ 4 ] &&  // resnoEnd\n                residueStore.getInscode(j) === helix[ 5 ]   // inscodeEnd\n            ) {\n              helixRun = false\n              i += 1\n\n              if (i < n) {\n                // must look at previous residues as\n                // residues may not be ordered by resno\n                j = offset - 1\n                helix = helices[ i ]\n                chainChange = cp.chainname !== helix[ 0 ]\n              } else {\n                done = true\n              }\n            }\n          }\n\n          if (chainChange || done) return\n        }\n      }\n    })\n  })\n\n    // sheet assignment\n\n  const sheets = secStruct.sheets.filter(function (s) {\n    return binarySearchIndexOf(chainnamesSorted, s[ 0 ]) >= 0\n  })\n\n  sheets.sort(function (s1, s2) {\n    const c1 = s1[ 0 ]\n    const c2 = s2[ 0 ]\n\n    if (c1 === c2) return 0\n    const idx1 = binarySearchIndexOf(chainnamesSorted, c1)\n    const idx2 = binarySearchIndexOf(chainnamesSorted, c2)\n    return chainnamesIndex[ idx1 ] < chainnamesIndex[ idx2 ] ? -1 : 1\n  })\n\n  const strandCharCode = 'e'.charCodeAt(0)\n  structure.eachModel(function (mp) {\n    let i = 0\n    const n = sheets.length\n    if (n === 0) return\n    let sheet = sheets[ i ]\n    let sheetRun = false\n    let done = false\n\n    mp.eachChain(function (cp) {\n      let chainChange = false\n\n      if (cp.chainname === sheet[ 0 ]) {\n        const count = cp.residueCount\n        const offset = cp.residueOffset\n        const end = offset + count\n\n        for (let j = offset; j < end; ++j) {\n          if (residueStore.resno[ j ] === sheet[ 1 ] &&  // resnoBeg\n              residueStore.getInscode(j) === sheet[ 2 ]   // inscodeBeg\n          ) {\n            sheetRun = true\n          }\n\n          if (sheetRun) {\n            residueStore.sstruc[ j ] = strandCharCode\n\n            if (residueStore.resno[ j ] === sheet[ 4 ] &&  // resnoEnd\n                residueStore.getInscode(j) === sheet[ 5 ]   // inscodeEnd\n            ) {\n              sheetRun = false\n              i += 1\n\n              if (i < n) {\n                // must look at previous residues as\n                // residues may not be ordered by resno\n                j = offset - 1\n                sheet = sheets[ i ]\n                chainChange = cp.chainname !== sheet[ 0 ]\n              } else {\n                done = true\n              }\n            }\n          }\n\n          if (chainChange || done) return\n        }\n      }\n    })\n  })\n\n  if (Debug) Log.timeEnd('assignSecondaryStructure')\n}\n\nexport const calculateSecondaryStructure = (function () {\n  // Implementation for proteins based on \"pv\"\n  //\n  // assigns secondary structure information based on a simple and very fast\n  // algorithm published by Zhang and Skolnick in their TM-align paper.\n  // Reference:\n  //\n  // TM-align: a protein structure alignment algorithm based on the Tm-score\n  // (2005) NAR, 33(7) 2302-2309\n\n  const zhangSkolnickSS = function (polymer: Polymer, i: number, distances: number[], delta: number) {\n    const structure = polymer.structure\n    const offset = polymer.residueIndexStart\n    const rp1 = structure.getResidueProxy()\n    const rp2 = structure.getResidueProxy()\n    const ap1 = structure.getAtomProxy()\n    const ap2 = structure.getAtomProxy()\n\n    for (let j = Math.max(0, i - 2); j <= i; ++j) {\n      for (let k = 2; k < 5; ++k) {\n        if (j + k >= polymer.residueCount) {\n          continue\n        }\n\n        rp1.index = offset + j\n        rp2.index = offset + j + k\n        ap1.index = rp1.traceAtomIndex\n        ap2.index = rp2.traceAtomIndex\n\n        const d = ap1.distanceTo(ap2)\n\n        if (Math.abs(d - distances[ k - 2 ]) > delta) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  const isHelical = function (polymer: Polymer, i: number) {\n    const helixDistances = [ 5.45, 5.18, 6.37 ]\n    const helixDelta = 2.1\n    return zhangSkolnickSS(polymer, i, helixDistances, helixDelta)\n  }\n\n  const isSheet = function (polymer: Polymer, i: number) {\n    const sheetDistances = [ 6.1, 10.4, 13.0 ]\n    const sheetDelta = 1.42\n    return zhangSkolnickSS(polymer, i, sheetDistances, sheetDelta)\n  }\n\n  const proteinPolymer = function (p: Polymer) {\n    const residueStore = p.residueStore\n    const offset = p.residueIndexStart\n    for (let i = 0, il = p.residueCount; i < il; ++i) {\n      let sstruc = 'c'\n      if (isHelical(p, i)) {\n        sstruc = 'h'\n      } else if (isSheet(p, i)) {\n        sstruc = 'e'\n      }\n      residueStore.sstruc[ offset + i ] = sstruc.charCodeAt(0)\n    }\n  }\n\n  const cgPolymer = function (p: Polymer) {\n    const localAngle = 20\n    const centerDist = 2.0\n\n    const residueStore = p.residueStore\n    const offset = p.residueIndexStart\n\n    const helixbundle = new Helixbundle(p)\n    const pos = helixbundle.position\n\n    const c1 = new Vector3()\n    const c2 = new Vector3()\n\n    for (let i = 0, il = p.residueCount; i < il; ++i) {\n      c1.fromArray(pos.center as any, i * 3)  // TODO\n      c2.fromArray(pos.center as any, i * 3 + 3)  // TODO\n      const d = c1.distanceTo(c2)\n\n      if (d < centerDist && d > 1.0 && pos.bending[ i ] < localAngle) {\n        residueStore.sstruc[ offset + i ] = 'h'.charCodeAt(0)\n        residueStore.sstruc[ offset + i + 1 ] = 'h'.charCodeAt(0)\n      }\n    }\n  }\n\n  return function calculateSecondaryStructure (structure: Structure) {\n    if (Debug) Log.time('calculateSecondaryStructure')\n\n    structure.eachPolymer(function (p) {\n      // assign secondary structure\n      if (p.residueCount < 4) return\n      if (p.isCg()) {\n        cgPolymer(p)\n      } else if (p.isProtein()) {\n        proteinPolymer(p)\n      } else {\n        return\n      }\n\n      // set lone secondary structure assignments to \"c\"\n      let prevSstruc: string\n      let sstrucCount = 0\n      p.eachResidue(function (r: ResidueProxy) {\n        if (r.sstruc === prevSstruc) {\n          sstrucCount += 1\n        } else {\n          if (sstrucCount === 1) {\n            r.index -= 1\n            r.sstruc = 'c'\n          }\n          sstrucCount = 1\n          prevSstruc = r.sstruc\n        }\n      })\n    })\n\n    if (Debug) Log.timeEnd('calculateSecondaryStructure')\n  }\n}())\n\n// const ChainnameAlphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" +\n//                           \"abcdefghijklmnopqrstuvwxyz\" +\n//                           \"0123456789\";\nconst ChainnameAlphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\nexport function getChainname (index: number) {\n  const n = ChainnameAlphabet.length\n  let j = index\n  let k = 0\n  let chainname = ChainnameAlphabet[j % n]\n  while (j >= n) {\n    j = Math.floor(j / n)\n    chainname += ChainnameAlphabet[j % n]\n    k += 1\n  }\n  if (k >= 5) {\n    Log.warn('chainname overflow')\n  }\n  return chainname\n}\n\ninterface ChainData {\n  mIndex: number\n  chainname: string\n  rStart: number\n  rCount: number\n}\n\nexport function calculateChainnames (structure: Structure, useExistingBonds = false) {\n  if (Debug) Log.time('calculateChainnames')\n\n  let doAutoChainName = true\n  structure.eachChain(function (c) {\n    if (c.chainname) doAutoChainName = false\n  })\n\n  if (doAutoChainName) {\n    const modelStore = structure.modelStore\n    const chainStore = structure.chainStore\n    const residueStore = structure.residueStore\n\n    const addChain = function (mIndex: number, chainname: string, rOffset: number, rCount: number) {\n      const ci = chainStore.count\n      for (let i = 0; i < rCount; ++i) {\n        residueStore.chainIndex[ rOffset + i ] = ci\n      }\n      chainStore.growIfFull()\n      chainStore.modelIndex[ ci ] = mIndex\n      chainStore.setChainname(ci, chainname)\n      chainStore.setChainid(ci, chainname)\n      chainStore.residueOffset[ ci ] = rOffset\n      chainStore.residueCount[ ci ] = rCount\n      chainStore.count += 1\n      modelStore.chainCount[ mIndex ] += 1\n    }\n\n    const ap1 = structure.getAtomProxy()\n    const ap2 = structure.getAtomProxy()\n\n    let i = 0\n    let mi = 0\n    let rStart = 0\n    let rEnd = 0\n    const chainData: ChainData[] = []\n\n    if (residueStore.count === 1) {\n      chainData.push({\n        mIndex: 0,\n        chainname: 'A',\n        rStart: 0,\n        rCount: 1\n      })\n    } else {\n      structure.eachResidueN(2, function (rp1: ResidueProxy, rp2: ResidueProxy) {\n        let newChain = false\n\n        const bbType1 = rp1.backboneType\n        const bbType2 = rp2.backboneType\n        const bbTypeUnk = UnknownBackboneType\n\n        rEnd = rp1.index\n\n        if (rp1.modelIndex !== rp2.modelIndex) {\n          newChain = true\n        } else if (rp1.moleculeType !== rp2.moleculeType) {\n          newChain = true\n        } else if (bbType1 !== bbTypeUnk && bbType1 === bbType2) {\n          ap1.index = rp1.backboneEndAtomIndex\n          ap2.index = rp2.backboneStartAtomIndex\n          if (useExistingBonds) {\n            newChain = !ap1.hasBondTo(ap2)\n          } else {\n            newChain = !ap1.connectedTo(ap2)\n          }\n        }\n\n        // current chain goes to end of the structure\n        if (!newChain && rp2.index === residueStore.count - 1) {\n          newChain = true\n          rEnd = rp2.index\n        }\n\n        if (newChain) {\n          chainData.push({\n            mIndex: mi,\n            chainname: getChainname(i),\n            rStart: rStart,\n            rCount: rEnd - rStart + 1\n          })\n\n          i += 1\n\n          if (rp1.modelIndex !== rp2.modelIndex) {\n            i = 0\n            mi += 1\n          }\n\n          // new chain for the last residue of the structure\n          if (rp2.index === residueStore.count - 1 && rEnd !== rp2.index) {\n            chainData.push({\n              mIndex: mi,\n              chainname: getChainname(i),\n              rStart: residueStore.count - 1,\n              rCount: 1\n            })\n          }\n\n          rStart = rp2.index\n          rEnd = rp2.index\n        }\n      })\n    }\n\n    //\n\n    chainStore.count = 0\n    chainData.forEach(function (d) {\n      addChain(d.mIndex, d.chainname, d.rStart, d.rCount)\n    })\n\n    let chainOffset = 0\n    structure.eachModel(function (mp) {\n      modelStore.chainOffset[ mp.index ] = chainOffset\n      modelStore.chainCount[ mp.index ] -= 1\n      chainOffset += modelStore.chainCount[ mp.index ]\n    })\n  }\n\n  if (Debug) Log.timeEnd('calculateChainnames')\n}\n\nexport function calculateBonds (structure: Structure) {\n  if (Debug) Log.time('calculateBonds')\n\n  calculateBondsWithin(structure)\n  calculateBondsBetween(structure)\n\n  if (Debug) Log.timeEnd('calculateBonds')\n}\n\nexport interface ResidueBonds {\n  atomIndices1: number[]\n  atomIndices2: number[]\n  bondOrders: number[]\n}\n\n\nconst BondOrderTable: { [k: string]: number } = {\n  'HIS|CD2|CG': 2,\n  'HIS|CE1|ND1': 2,\n  'ARG|CZ|NH2': 2,\n  'PHE|CE1|CZ': 2,\n  'PHE|CD2|CE2': 2,\n  'PHE|CD1|CG': 2,\n  'TRP|CD1|CG': 2,\n  'TRP|CD2|CE2': 2,\n  'TRP|CE3|CZ3': 2,\n  'TRP|CH2|CZ2': 2,\n  'ASN|CG|OD1': 2,\n  'GLN|CD|OE1': 2,\n  'TYR|CD1|CG': 2,\n  'TYR|CD2|CE2': 2,\n  'TYR|CE1|CZ': 2,\n  'ASP|CG|OD1': 2,\n  'GLU|CD|OE1': 2,\n\n  'G|C8|N7': 2,\n  'G|C4|C5': 2,\n  'G|C2|N3': 2,\n  'G|C6|O6': 2,\n  'C|C4|N3': 2,\n  'C|C5|C6': 2,\n  'C|C2|O2': 2,\n  'A|C2|N3': 2,\n  'A|C6|N1': 2,\n  'A|C4|C5': 2,\n  'A|C8|N7': 2,\n  'U|C5|C6': 2,\n  'U|C2|O2': 2,\n  'U|C4|O4': 2,\n\n  'DG|C8|N7': 2,\n  'DG|C4|C5': 2,\n  'DG|C2|N3': 2,\n  'DG|C6|O6': 2,\n  'DC|C4|N3': 2,\n  'DC|C5|C6': 2,\n  'DC|C2|O2': 2,\n  'DA|C2|N3': 2,\n  'DA|C6|N1': 2,\n  'DA|C4|C5': 2,\n  'DA|C8|N7': 2,\n  'DT|C5|C6': 2,\n  'DT|C2|O2': 2,\n  'DT|C4|O4': 2\n}\nfunction getBondOrderFromTable (resname: string, atomname1: string, atomname2: string) {\n  [ atomname1, atomname2 ] = atomname1 < atomname2 ? [ atomname1, atomname2 ] : [ atomname2, atomname1 ]\n  if (AA3.includes(resname) && atomname1 === 'C' && atomname2 === 'O') return 2\n  if (Bases.includes(resname) && atomname1 === 'OP1' && atomname2 === 'P') return 2\n  return BondOrderTable[ `${resname}|${atomname1}|${atomname2}` ] || 1\n}\n\nexport function calculateResidueBonds (r: ResidueProxy) {\n  const structure = r.structure\n  const a1 = structure.getAtomProxy()\n  const a2 = structure.getAtomProxy()\n\n  const count = r.atomCount\n  const offset = r.atomOffset\n  const end = offset + count\n  const end1 = end - 1\n\n  const atomIndices1 = []\n  const atomIndices2 = []\n  const bondOrders = []\n\n  if (count > 500) {\n    if (Debug) Log.warn('more than 500 atoms, skip residue for auto-bonding', r.qualifiedName())\n  } else {\n    if (count > 50) {\n      const kdtree = new Kdtree(r, true)\n      const radius = r.isCg() ? 1.2 : 2.3\n\n      for (let i = offset; i < end1; ++i) {\n        a1.index = i\n        const maxd = a1.covalent + radius + 0.3\n        const nearestAtoms = kdtree.nearest(a1 as any, Infinity, maxd * maxd)  // TODO\n        const m = nearestAtoms.length\n        for (let j = 0; j < m; ++j) {\n          a2.index = nearestAtoms[ j ].index\n          if (a1.index < a2.index) {\n            if (a1.connectedTo(a2)) {\n              atomIndices1.push(a1.index - offset)\n              atomIndices2.push(a2.index - offset)\n              bondOrders.push(getBondOrderFromTable(a1.resname, a1.atomname, a2.atomname))\n            }\n          }\n        }\n      }\n    } else {\n      for (let i = offset; i < end1; ++i) {\n        a1.index = i\n        for (let j = i + 1; j <= end1; ++j) {\n          a2.index = j\n          if (a1.connectedTo(a2)) {\n            atomIndices1.push(i - offset)\n            atomIndices2.push(j - offset)\n            bondOrders.push(getBondOrderFromTable(a1.resname, a1.atomname, a2.atomname))\n          }\n        }\n      }\n    }\n  }\n\n  return {\n    atomIndices1: atomIndices1,\n    atomIndices2: atomIndices2,\n    bondOrders: bondOrders\n  }\n}\n\nexport function calculateAtomBondMap (structure: Structure) {\n  if (Debug) Log.time('calculateAtomBondMap')\n\n  var atomBondMap: number[][] = []\n\n  structure.eachBond(function (bp) {\n    var ai1 = bp.atomIndex1\n    var ai2 = bp.atomIndex2\n    if (atomBondMap[ ai1 ] === undefined) atomBondMap[ ai1 ] = []\n    atomBondMap[ ai1 ][ ai2 ] = bp.index\n  })\n\n  if (Debug) Log.timeEnd('calculateAtomBondMap')\n\n  return atomBondMap\n}\n\nexport function calculateBondsWithin (structure: Structure, onlyAddRung = false) {\n  if (Debug) Log.time('calculateBondsWithin')\n\n  const bondStore = structure.bondStore\n  const rungBondStore = structure.rungBondStore\n  const rungAtomSet = structure.getAtomSet(false)\n  const a1 = structure.getAtomProxy()\n  const a2 = structure.getAtomProxy()\n  const bp = structure.getBondProxy()\n  const atomBondMap = onlyAddRung ? null : calculateAtomBondMap(structure)\n\n  structure.eachResidue(function (r) {\n    if (!onlyAddRung && atomBondMap) {\n      const count = r.atomCount\n      const offset = r.atomOffset\n\n      if (count > 500) {\n        Log.warn('more than 500 atoms, skip residue for auto-bonding', r.qualifiedName())\n        return\n      }\n\n      const bonds = r.getBonds()\n      const atomIndices1 = bonds.atomIndices1\n      const atomIndices2 = bonds.atomIndices2\n      const bondOrders = bonds.bondOrders\n      const nn = atomIndices1.length\n\n      for (let i = 0; i < nn; ++i) {\n        const rai1 = atomIndices1[ i ]\n        const rai2 = atomIndices2[ i ]\n        const ai1 = rai1 + offset\n        const ai2 = rai2 + offset\n        const tmp = atomBondMap[ ai1 ]\n        if (tmp !== undefined && tmp[ ai2 ] !== undefined) {\n          bp.index = tmp[ ai2 ]\n          const residueTypeBondIndex = r.residueType.getBondIndex(rai1, rai2)!  // TODO\n          // overwrite residueType bondOrder with value from existing bond\n          bondOrders[ residueTypeBondIndex ] = bp.bondOrder\n        } else {\n          a1.index = ai1\n          a2.index = ai2\n          // only add bond if not already in bondStore\n          bondStore.addBond(a1, a2, bondOrders[ i ])\n        }\n      }\n    }\n\n    // get RNA/DNA rung pseudo bonds\n    const traceAtomIndex = r.residueType.traceAtomIndex\n    const rungEndAtomIndex = r.residueType.rungEndAtomIndex\n    if (traceAtomIndex !== -1 && rungEndAtomIndex !== -1) {\n      a1.index = r.traceAtomIndex\n      a2.index = r.rungEndAtomIndex\n      rungBondStore.addBond(a1, a2)\n      rungAtomSet.set(a1.index)\n      rungAtomSet.set(a2.index)\n    }\n  })\n\n  structure.atomSetDict.rung = rungAtomSet\n\n  if (Debug) Log.timeEnd('calculateBondsWithin')\n}\n\nexport function calculateBondsBetween (structure: Structure, onlyAddBackbone = false, useExistingBonds = false) {\n  if (Debug) Log.time('calculateBondsBetween')\n\n  const bondStore = structure.bondStore\n  const backboneBondStore = structure.backboneBondStore\n  const backboneAtomSet = structure.getAtomSet(false)\n  const ap1 = structure.getAtomProxy()\n  const ap2 = structure.getAtomProxy()\n\n  if (backboneBondStore.count === 0) {\n    backboneBondStore.resize(structure.residueStore.count)\n  }\n\n  function addBondIfConnected (rp1: ResidueProxy, rp2: ResidueProxy) {\n    const bbType1 = rp1.backboneType\n    const bbType2 = rp2.backboneType\n    if (bbType1 !== UnknownBackboneType && bbType1 === bbType2) {\n      ap1.index = rp1.backboneEndAtomIndex\n      ap2.index = rp2.backboneStartAtomIndex\n      if ((useExistingBonds && ap1.hasBondTo(ap2)) || ap1.connectedTo(ap2)) {\n        if (!onlyAddBackbone) {\n          bondStore.addBond(ap1, ap2, 1)  // assume single bond\n        }\n        ap1.index = rp1.traceAtomIndex\n        ap2.index = rp2.traceAtomIndex\n        backboneBondStore.addBond(ap1, ap2)\n        backboneAtomSet.set(ap1.index)\n        backboneAtomSet.set(ap2.index)\n      }\n    }\n  }\n\n  structure.eachResidueN(2, addBondIfConnected)\n\n  const rp1 = structure.getResidueProxy()\n  const rp2 = structure.getResidueProxy()\n\n  // check for cyclic chains\n  structure.eachChain(function (cp) {\n    if (cp.residueCount === 0) return\n    rp1.index = cp.residueOffset\n    rp2.index = cp.residueOffset + cp.residueCount - 1\n    addBondIfConnected(rp2, rp1)\n  })\n\n  structure.atomSetDict.backbone = backboneAtomSet\n\n  if (!onlyAddBackbone) {\n    if (Debug) Log.time('calculateBondsBetween inter')\n    const spatialHash = structure.spatialHash\n    structure.eachResidue(function (rp) {\n      if (rp.backboneType === UnknownBackboneType && !rp.isWater()) {\n        rp.eachAtom(function (ap) {\n          if (ap.isMetal()) return\n          spatialHash!.eachWithin(ap.x, ap.y, ap.z, 4, function (idx) {  // TODO\n            ap2.index = idx\n            if (ap.modelIndex === ap2.modelIndex &&\n                ap.residueIndex !== ap2.residueIndex &&\n                !ap2.isMetal()\n            ) {\n              bondStore.addBondIfConnected(ap, ap2, 1)  // assume single bond\n            }\n          })\n        })\n      }\n    })\n    if (Debug) Log.timeEnd('calculateBondsBetween inter')\n  }\n\n  if (Debug) Log.timeEnd('calculateBondsBetween')\n}\n\nexport function buildUnitcellAssembly (structure: Structure) {\n  if (!structure.unitcell) return\n\n  if (Debug) Log.time('buildUnitcellAssembly')\n\n  const uc = structure.unitcell\n\n  const structureCenterFrac = structure.center.clone().applyMatrix4(uc.cartToFrac)\n  const centerFrac = structureCenterFrac.clone().floor()\n  const symopDict: { [K: string]: Matrix4 } = getSymmetryOperations(uc.spacegroup)\n\n  const centerFracSymop = new Vector3()\n  const positionFracSymop = new Vector3()\n\n  function getMatrixList (shift?: Vector3) {\n    const matrixList: Matrix4[] = []\n\n    Object.keys(symopDict).forEach(function (name) {\n      const m = symopDict[ name ].clone()\n\n      centerFracSymop.copy(structureCenterFrac).applyMatrix4(m).floor()\n      positionFracSymop.setFromMatrixPosition(m)\n      positionFracSymop.sub(centerFracSymop)\n      positionFracSymop.add(centerFrac)\n\n      if (shift) positionFracSymop.add(shift)\n\n      m.setPosition(positionFracSymop)\n      m.multiplyMatrices(uc.fracToCart, m)\n      m.multiply(uc.cartToFrac)\n\n      matrixList.push(m)\n    })\n\n    return matrixList\n  }\n\n  const unitcellAssembly = new Assembly('UNITCELL')\n  const unitcellMatrixList = getMatrixList()\n  const ncsMatrixList: Matrix4[] = []\n  if (structure.biomolDict.NCS) {\n    ncsMatrixList.push(\n      new Matrix4(), ...structure.biomolDict.NCS.partList[ 0 ].matrixList\n    )\n    const ncsUnitcellMatrixList: Matrix4[] = []\n    unitcellMatrixList.forEach(sm => {\n      ncsMatrixList.forEach(nm => {\n        ncsUnitcellMatrixList.push(sm.clone().multiply(nm))\n      })\n    })\n    unitcellAssembly.addPart(ncsUnitcellMatrixList)\n  } else {\n    unitcellAssembly.addPart(unitcellMatrixList)\n  }\n\n  const vec = new Vector3()\n  const supercellAssembly = new Assembly('SUPERCELL')\n  const supercellMatrixList = Array.prototype.concat.call(\n    getMatrixList(vec.set(1, 0, 0)),  // 655\n    getMatrixList(vec.set(0, 1, 0)),  // 565\n    getMatrixList(vec.set(0, 0, 1)),  // 556\n\n    getMatrixList(vec.set(-1, 0, 0)),  // 455\n    getMatrixList(vec.set(0, -1, 0)),  // 545\n    getMatrixList(vec.set(0, 0, -1)),  // 554\n\n    getMatrixList(vec.set(1, 1, 0)),  // 665\n    getMatrixList(vec.set(1, 0, 1)),  // 656\n    getMatrixList(vec.set(0, 1, 1)),  // 566\n\n    getMatrixList(vec.set(-1, -1, 0)),  // 445\n    getMatrixList(vec.set(-1, 0, -1)),  // 454\n    getMatrixList(vec.set(0, -1, -1)),  // 544\n\n    getMatrixList(vec.set(1, -1, -1)),  // 644\n    getMatrixList(vec.set(1, 1, -1)),  // 664\n    getMatrixList(vec.set(1, -1, 1)),  // 646\n    getMatrixList(vec.set(-1, 1, 1)),  // 466\n    getMatrixList(vec.set(-1, -1, 1)),  // 446\n    getMatrixList(vec.set(-1, 1, -1)),  // 464\n\n    getMatrixList(vec.set(0, 1, -1)),  // 564\n    getMatrixList(vec.set(0, -1, 1)),  // 546\n    getMatrixList(vec.set(1, 0, -1)),  // 654\n    getMatrixList(vec.set(-1, 0, 1)),  // 456\n    getMatrixList(vec.set(1, -1, 0)),  // 645\n    getMatrixList(vec.set(-1, 1, 0)),  // 465\n\n    getMatrixList(),  // 555\n    getMatrixList(vec.set(1, 1, 1)),  // 666\n    getMatrixList(vec.set(-1, -1, -1))   // 444\n  )\n  if (structure.biomolDict.NCS) {\n    const ncsSupercellMatrixList: Matrix4[] = []\n    supercellMatrixList.forEach(function (sm: Matrix4) {\n      ncsMatrixList.forEach(function (nm) {\n        ncsSupercellMatrixList.push(sm.clone().multiply(nm))\n      })\n    })\n    supercellAssembly.addPart(ncsSupercellMatrixList)\n  } else {\n    supercellAssembly.addPart(supercellMatrixList)\n  }\n\n  structure.biomolDict.UNITCELL = unitcellAssembly\n  structure.biomolDict.SUPERCELL = supercellAssembly\n\n  if (Debug) Log.timeEnd('buildUnitcellAssembly')\n}\n\nconst elm1 = [ 'H', 'C', 'O', 'N', 'S', 'P' ]\nconst elm2 = [ 'NA', 'CL', 'FE' ]\n\nexport function guessElement (atomName: string) {\n  let at = atomName.trim().toUpperCase()\n  // parseInt('C') -> NaN; (NaN > -1) -> false\n  if (parseInt(at.charAt(0)) > -1) at = at.substr(1)\n    // parse again to check for a second integer\n  if (parseInt(at.charAt(0)) > -1) at = at.substr(1)\n  const n = at.length\n\n  if (n === 0) return ''\n  if (n === 1) return at\n  if (n === 2) {\n    if (elm2.indexOf(at) !== -1) return at\n    if (elm1.indexOf(at[0]) !== -1) return at[0]\n  }\n  if (n >= 3) {\n    if (elm1.indexOf(at[0]) !== -1) return at[0]\n  }\n  return ''\n}\n\n/**\n * Assigns ResidueType bonds.\n * @param {Structure} structure - the structure object\n * @return {undefined}\n */\nexport function assignResidueTypeBonds (structure: Structure) {\n  // if( Debug ) Log.time( \"assignResidueTypeBonds\" )\n\n  const bondHash = structure.bondHash!  // TODO\n  const countArray = bondHash.countArray\n  const offsetArray = bondHash.offsetArray\n  const indexArray = bondHash.indexArray\n  const bp = structure.getBondProxy()\n\n  structure.eachResidue(function (rp) {\n    const residueType = rp.residueType\n    if (residueType.bonds !== undefined) return\n\n    var atomOffset = rp.atomOffset\n    var atomIndices1: number[] = []\n    var atomIndices2: number[] = []\n    var bondOrders: number[] = []\n    var bondDict: { [k: string]: boolean } = {}\n\n    const nextAtomOffset = atomOffset + rp.atomCount\n\n    rp.eachAtom(function (ap) {\n      const index = ap.index\n      const offset = offsetArray[ index ]\n      const count = countArray[ index ]\n      for (let i = 0, il = count; i < il; ++i) {\n        bp.index = indexArray[ offset + i ]\n        let idx1 = bp.atomIndex1\n        if (idx1 < atomOffset || idx1 >= nextAtomOffset) {\n          // Don't add bonds outside of this resiude\n          continue\n        }\n        let idx2 = bp.atomIndex2\n        if (idx2 < atomOffset || idx2 >= nextAtomOffset) {\n          continue\n        }\n\n        if (idx1 > idx2) {\n          const tmp = idx2\n          idx2 = idx1\n          idx1 = tmp\n        }\n        const hash = idx1 + '|' + idx2\n        if (bondDict[ hash ] === undefined) {\n          bondDict[ hash ] = true\n          atomIndices1.push(idx1 - atomOffset)\n          atomIndices2.push(idx2 - atomOffset)\n          bondOrders.push(bp.bondOrder)\n        }\n      }\n    })\n\n    residueType.bonds = {\n      atomIndices1: atomIndices1,\n      atomIndices2: atomIndices2,\n      bondOrders: bondOrders\n    }\n  })\n\n  // if( Debug ) Log.timeEnd( \"assignResidueTypeBonds\" )\n}\n\nexport function concatStructures (name: string, ...structures: Structure[]) {\n  if( Debug ) Log.time( \"concatStructures\" )\n\n  const s = new Structure(name, '')\n  const sb = new StructureBuilder(s)\n\n  const atomStore = s.atomStore as any\n  const atomMap = s.atomMap\n  atomStore.addField('formalCharge', 1, 'int8')\n  atomStore.addField('partialCharge', 1, 'float32')\n\n  const atomIndexDict: { [k: number]: number } = {}\n\n  let idx = 0\n  let atomCount = 0\n  let modelCount = 0\n  structures.forEach(structure => {\n    structure.eachAtom(a => {\n      atomStore.growIfFull()\n      atomStore.atomTypeId[ idx ] = atomMap.add(a.atomname, a.element)\n\n      atomStore.x[ idx ] = a.x\n      atomStore.y[ idx ] = a.y\n      atomStore.z[ idx ] = a.z\n      atomStore.serial[ idx ] = a.serial\n      atomStore.formalCharge[ idx ] = a.formalCharge\n      atomStore.partialCharge[ idx ] = a.partialCharge\n      atomStore.altloc[ idx ] = a.altloc\n      atomStore.occupancy[ idx ] = a.occupancy\n      atomStore.bfactor[ idx ] = a.bfactor\n\n      sb.addAtom(\n        a.modelIndex + modelCount,\n        a.chainname,\n        a.chainid,\n        a.resname,\n        a.resno,\n        a.hetero === 1,\n        a.sstruc,\n        a.inscode\n      )\n\n      atomIndexDict[a.index + atomCount] = idx\n      idx += 1\n    })\n    atomCount += structure.atomStore.count\n    modelCount += structure.modelStore.count\n  })\n\n  const bondStore = s.bondStore\n  const a1 = s.getAtomProxy()\n  const a2 = s.getAtomProxy()\n\n  atomCount = 0\n  structures.forEach(structure => {\n    structure.eachBond(b => {\n      a1.index = atomIndexDict[ b.atomIndex1 + atomCount ]\n      a2.index = atomIndexDict[ b.atomIndex2 + atomCount ]\n      bondStore.addBond(a1, a2, b.bondOrder)\n    })\n    atomCount += structure.atomStore.count\n  })\n\n  sb.finalize()\n\n  calculateBondsBetween(s, true)  // calculate backbone bonds\n  calculateBondsWithin(s, true)  // calculate rung bonds\n\n  s.finalizeAtoms()\n  s.finalizeBonds()\n  assignResidueTypeBonds(s)\n\n  if( Debug ) Log.timeEnd( \"concatStructures\" )\n\n  return s\n}\n","/**\n * @file Atom Type\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { guessElement } from '../structure/structure-utils'\nimport {\n  AtomicNumbers, DefaultAtomicNumber,\n  VdwRadii, DefaultVdwRadius,\n  CovalentRadii, DefaultCovalentRadius,\n  Valences, DefaultValence,\n  OuterShellElectronCounts, DefaultOuterShellElectronCount\n} from '../structure/structure-constants'\nimport Structure from '../structure/structure'\n\n// Li, Na, K, Rb, Cs Fr\nconst AlkaliMetals = [ 3, 11, 19, 37, 55, 87 ]\n\n// Be, Mg, Ca, Sr, Ba, Ra\nconst AlkalineEarthMetals = [ 4, 12, 20, 38, 56, 88 ]\n\n// C, P, S, Se\nconst PolyatomicNonmetals = [ 6, 15, 16, 34, ]\n\n// H, N, O, F, Cl, Br, I\nconst DiatomicNonmetals = [ 1, 7, 8, 9, 17, 35, 53 ]\n\n// He, Ne, Ar, Kr, Xe, Rn\nconst NobleGases = [ 2, 10, 18, 36, 54, 86 ]\n\n// Zn, Ga, Cd, In, Sn, Hg, Ti, Pb, Bi, Po, Cn\nconst PostTransitionMetals = [ 13, 30, 31, 48, 49, 50, 80, 81, 82, 83, 84, 85, 112 ]\n\n// B, Si, Ge, As, Sb, Te, At\nconst Metalloids = [ 5, 14, 32, 33, 51, 52, 85 ]\n\n// F, Cl, Br, I, At\nconst Halogens = [ 9, 17, 35, 53, 85 ]\n\n/**\n * Atom type\n */\nclass AtomType {\n  element: string\n  number: number\n  vdw: number\n  covalent: number\n\n  /**\n   * @param {Structure} structure - the structure object\n   * @param {String} atomname - the name of the atom\n   * @param {String} element - the chemical element\n   */\n  constructor (readonly structure: Structure, readonly atomname: string, element?: string) {\n    element = element || guessElement(atomname)\n\n    this.element = element\n    this.number = AtomicNumbers[ element ] || DefaultAtomicNumber\n    this.vdw = VdwRadii[ this.number ] || DefaultVdwRadius\n    this.covalent = CovalentRadii[ this.number ] || DefaultCovalentRadius\n  }\n\n  getDefaultValence() {\n    const vl = Valences[ this.number ]\n    return vl ? vl[ 0 ] : DefaultValence\n  }\n\n  getValenceList () {\n    return Valences[ this.number ] || []\n  }\n\n  getOuterShellElectronCount () {\n    return OuterShellElectronCounts[ this.number ] || DefaultOuterShellElectronCount\n  }\n\n  isMetal () {\n    return (\n      this.isAlkaliMetal() ||\n      this.isAlkalineEarthMetal() ||\n      this.isLanthanide() ||\n      this.isActinide() ||\n      this.isTransitionMetal() ||\n      this.isPostTransitionMetal()\n    )\n  }\n\n  isNonmetal () {\n    return (\n      this.isDiatomicNonmetal() ||\n      this.isPolyatomicNonmetal() ||\n      this.isNobleGas()\n    )\n  }\n\n  isMetalloid () {\n    return Metalloids.includes(this.number)\n  }\n\n  isHalogen () {\n    return Halogens.includes(this.number)\n  }\n\n  isDiatomicNonmetal () {\n    return DiatomicNonmetals.includes(this.number)\n  }\n\n  isPolyatomicNonmetal () {\n    return PolyatomicNonmetals.includes(this.number)\n  }\n\n  isAlkaliMetal () {\n    return AlkaliMetals.includes(this.number)\n  }\n\n  isAlkalineEarthMetal () {\n    return AlkalineEarthMetals.includes(this.number)\n  }\n\n  isNobleGas () {\n    return NobleGases.includes(this.number)\n  }\n\n  isTransitionMetal () {\n    const no = this.number\n    return (\n      (no >= 21 && no <= 29) ||\n      (no >= 39 && no <= 47) ||\n      (no >= 72 && no <= 79) ||\n      (no >= 104 && no <= 108)\n    )\n  }\n\n  isPostTransitionMetal () {\n    return PostTransitionMetals.includes(this.number)\n  }\n\n  isLanthanide () {\n    return this.number >= 57 && this.number <= 71\n  }\n\n  isActinide () {\n    return this.number >= 89 && this.number <= 103\n  }\n\n}\n\nexport default AtomType","/**\n * @file Atom Map\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport AtomType from './atom-type'\nimport { guessElement } from '../structure/structure-utils'\nimport Structure from '../structure/structure'\n\nfunction getHash (atomname: string, element: string) {\n  return atomname + '|' + element\n}\n\nclass AtomMap {\n  dict: { [k: string]: number } = {}\n  list: AtomType[] = []\n\n  constructor (readonly structure: Structure) {\n    this.structure = structure\n  }\n\n  add (atomname: string, element?: string) {\n    atomname = atomname.toUpperCase()\n    if (!element) {\n      element = guessElement(atomname)\n    } else {\n      element = element.toUpperCase()\n    }\n    const hash = getHash(atomname, element)\n    let id = this.dict[ hash ]\n    if (id === undefined) {\n      const atomType = new AtomType(this.structure, atomname, element)\n      id = this.list.length\n      this.dict[ hash ] = id\n      this.list.push(atomType)\n    }\n    return id\n  }\n\n  get (id: number) {\n    return this.list[ id ]\n  }\n}\n\nexport default AtomMap\n","/**\n * @file Residue Type\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow\n * @private\n */\n\nimport { defaults } from '../utils'\nimport PrincipalAxes from '../math/principal-axes'\nimport { Matrix } from '../math/matrix-utils'\nimport { calculateResidueBonds, ResidueBonds } from '../structure/structure-utils'\nimport {\n  Elements,\n  ProteinType, RnaType, DnaType, WaterType, IonType, SaccharideType, UnknownType,\n  ProteinBackboneType, RnaBackboneType, DnaBackboneType, UnknownBackboneType,\n  CgProteinBackboneType, CgRnaBackboneType, CgDnaBackboneType,\n  ChemCompProtein, ChemCompRna, ChemCompDna, ChemCompSaccharide,\n  AA3, PurinBases, RnaBases, DnaBases, Bases, IonNames, WaterNames, SaccharideNames,\n  ProteinBackboneAtoms, NucleicBackboneAtoms, ResidueTypeAtoms\n} from '../structure/structure-constants'\nimport Structure from '../structure/structure'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\n\nexport interface BondGraph {\n  [k: number]: number[]\n}\n\nexport interface RingData {\n  atomRings: number[][]  // sparse array:\n                         // atomRings[atomIdx] -> array of ring indices\n  rings: number[][]  // rings as arrays of indices\n}\n\n/**\n * Residue type\n */\nexport default class ResidueType {\n  resname: string\n  atomTypeIdList: number[]\n  hetero: number\n  chemCompType: string\n  bonds?: ResidueBonds\n  rings?: RingData\n  bondGraph?: BondGraph\n  aromaticAtoms?: Uint8Array\n  aromaticRings?: number[][]\n\n  atomCount: number\n\n  moleculeType: number\n  backboneType: number\n  backboneEndType: number\n  backboneStartType: number\n  backboneIndexList: number[]\n\n  traceAtomIndex: number\n  direction1AtomIndex: number\n  direction2AtomIndex: number\n  backboneStartAtomIndex: number\n  backboneEndAtomIndex: number\n  rungEndAtomIndex: number\n\n  // Sparse array containing the reference atom index for each bond.\n  bondReferenceAtomIndices: number[] = []\n\n  /**\n   * @param {Structure} structure - the structure object\n   * @param {String} resname - name of the residue\n   * @param {Array} atomTypeIdList - list of IDs of {@link AtomType}s corresponding\n   *                                 to the atoms of the residue\n   * @param {Boolean} hetero - hetero flag\n   * @param {String} chemCompType - chemical component type\n   * @param {Object} [bonds] - TODO\n   */\n  constructor (readonly structure: Structure, resname: string, atomTypeIdList: number[], hetero: boolean, chemCompType: string, bonds?: ResidueBonds) {\n    this.resname = resname\n    this.atomTypeIdList = atomTypeIdList\n    this.hetero = hetero ? 1 : 0\n    this.chemCompType = chemCompType\n    this.bonds = bonds\n    this.atomCount = atomTypeIdList.length\n\n    this.moleculeType = this.getMoleculeType()\n    this.backboneType = this.getBackboneType(0)\n    this.backboneEndType = this.getBackboneType(-1)\n    this.backboneStartType = this.getBackboneType(1)\n    this.backboneIndexList = this.getBackboneIndexList()\n\n    const atomnames = ResidueTypeAtoms[ this.backboneType ]\n    const atomnamesStart = ResidueTypeAtoms[ this.backboneStartType ]\n    const atomnamesEnd = ResidueTypeAtoms[ this.backboneEndType ]\n\n    const traceIndex = this.getAtomIndexByName(atomnames.trace)\n    this.traceAtomIndex = defaults(traceIndex, -1)\n\n    const dir1Index = this.getAtomIndexByName(atomnames.direction1)\n    this.direction1AtomIndex = defaults(dir1Index, -1)\n\n    const dir2Index = this.getAtomIndexByName(atomnames.direction2)\n    this.direction2AtomIndex = defaults(dir2Index, -1)\n\n    const bbStartIndex = this.getAtomIndexByName(atomnamesStart.backboneStart)\n    this.backboneStartAtomIndex = defaults(bbStartIndex, -1)\n\n    const bbEndIndex = this.getAtomIndexByName(atomnamesEnd.backboneEnd)\n    this.backboneEndAtomIndex = defaults(bbEndIndex, -1)\n\n    let rungEndIndex\n    if (PurinBases.includes(resname)) {\n      rungEndIndex = this.getAtomIndexByName('N1')\n    } else {\n      rungEndIndex = this.getAtomIndexByName('N3')\n    }\n    this.rungEndAtomIndex = defaults(rungEndIndex, -1)\n  }\n\n  getBackboneIndexList () {\n    const backboneIndexList: number[] = []\n    let atomnameList\n    switch (this.moleculeType) {\n      case ProteinType:\n        atomnameList = ProteinBackboneAtoms\n        break\n      case RnaType:\n      case DnaType:\n        atomnameList = NucleicBackboneAtoms\n        break\n      default:\n        return backboneIndexList\n    }\n    const atomMap = this.structure.atomMap\n    const atomTypeIdList = this.atomTypeIdList\n    for (let i = 0, il = this.atomCount; i < il; ++i) {\n      const atomType = atomMap.get(atomTypeIdList[ i ])\n      if (atomnameList.includes(atomType.atomname)) {\n        backboneIndexList.push(i)\n      }\n    }\n    return backboneIndexList\n  }\n\n  getMoleculeType () {\n    if (this.isProtein()) {\n      return ProteinType\n    } else if (this.isRna()) {\n      return RnaType\n    } else if (this.isDna()) {\n      return DnaType\n    } else if (this.isWater()) {\n      return WaterType\n    } else if (this.isIon()) {\n      return IonType\n    } else if (this.isSaccharide()) {\n      return SaccharideType\n    } else {\n      return UnknownType\n    }\n  }\n\n  getBackboneType (position: number) {\n    if (this.hasProteinBackbone(position)) {\n      return ProteinBackboneType\n    } else if (this.hasRnaBackbone(position)) {\n      return RnaBackboneType\n    } else if (this.hasDnaBackbone(position)) {\n      return DnaBackboneType\n    } else if (this.hasCgProteinBackbone(position)) {\n      return CgProteinBackboneType\n    } else if (this.hasCgRnaBackbone(position)) {\n      return CgRnaBackboneType\n    } else if (this.hasCgDnaBackbone(position)) {\n      return CgDnaBackboneType\n    } else {\n      return UnknownBackboneType\n    }\n  }\n\n  isProtein () {\n    if (this.chemCompType) {\n      return ChemCompProtein.includes(this.chemCompType)\n    } else {\n      return (\n        this.hasAtomWithName('CA', 'C', 'N') ||\n        AA3.includes(this.resname)\n      )\n    }\n  }\n\n  isCg () {\n    const backboneType = this.backboneType\n    return (\n      backboneType === CgProteinBackboneType ||\n      backboneType === CgRnaBackboneType ||\n      backboneType === CgDnaBackboneType\n    )\n  }\n\n  isNucleic () {\n    return this.isRna() || this.isDna()\n  }\n\n  isRna () {\n    if (this.chemCompType) {\n      return ChemCompRna.includes(this.chemCompType)\n    } else if (this.hetero === 1) {\n      return false\n    } else {\n      return (\n        this.hasAtomWithName(\n          [ 'P', \"O3'\", 'O3*' ], [ \"C4'\", 'C4*' ], [ \"O2'\", 'O2*', \"F2'\", 'F2*' ]\n        ) ||\n        (RnaBases.includes(this.resname) &&\n          (this.hasAtomWithName([ \"O2'\", 'O2*', \"F2'\", 'F2*' ])))\n      )\n    }\n  }\n\n  isDna () {\n    if (this.chemCompType) {\n      return ChemCompDna.includes(this.chemCompType)\n    } else if (this.hetero === 1) {\n      return false\n    } else {\n      return (\n        (this.hasAtomWithName([ 'P', \"O3'\", 'O3*' ], [ \"C3'\", 'C3*' ]) &&\n          !this.hasAtomWithName([ \"O2'\", 'O2*', \"F2'\", 'F2*' ])) ||\n        DnaBases.includes(this.resname)\n      )\n    }\n  }\n\n  isHetero () {\n    return this.hetero === 1\n  }\n\n  isIon () {\n    return IonNames.includes(this.resname)\n  }\n\n  isWater () {\n    return WaterNames.includes(this.resname)\n  }\n\n  isSaccharide () {\n    if (this.chemCompType) {\n      return ChemCompSaccharide.includes(this.chemCompType)\n    } else {\n      return SaccharideNames.includes(this.resname)\n    }\n  }\n\n  isStandardAminoacid () {\n    return AA3.includes(this.resname)\n  }\n\n  isStandardBase () {\n    return Bases.includes(this.resname)\n  }\n\n  hasBackboneAtoms (position: number, type: number) {\n    const atomnames = ResidueTypeAtoms[ type ]\n    if (position === -1) {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.backboneEnd,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    } else if (position === 0) {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    } else if (position === 1) {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.backboneStart,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    } else {\n      return this.hasAtomWithName(\n        atomnames.trace,\n        atomnames.backboneStart,\n        atomnames.backboneEnd,\n        atomnames.direction1,\n        atomnames.direction2\n      )\n    }\n  }\n\n  hasProteinBackbone (position: number) {\n    return (\n      this.isProtein() &&\n      this.hasBackboneAtoms(position, ProteinBackboneType)\n    )\n  }\n\n  hasRnaBackbone (position: number) {\n    return (\n      this.isRna() &&\n      this.hasBackboneAtoms(position, RnaBackboneType)\n    )\n  }\n\n  hasDnaBackbone (position: number) {\n    return (\n      this.isDna() &&\n      this.hasBackboneAtoms(position, DnaBackboneType)\n    )\n  }\n\n  hasCgProteinBackbone (position: number) {\n    return (\n      this.atomCount < 7 &&\n      this.isProtein() &&\n      this.hasBackboneAtoms(position, CgProteinBackboneType)\n    )\n  }\n\n  hasCgRnaBackbone (position: number) {\n    return (\n      this.atomCount < 11 &&\n      this.isRna() &&\n      this.hasBackboneAtoms(position, CgRnaBackboneType)\n    )\n  }\n\n  hasCgDnaBackbone (position: number) {\n    return (\n      this.atomCount < 11 &&\n      this.isDna() &&\n      this.hasBackboneAtoms(position, CgDnaBackboneType)\n    )\n  }\n\n  hasBackbone (position: number) {\n    return (\n      this.hasProteinBackbone(position) ||\n      this.hasRnaBackbone(position) ||\n      this.hasDnaBackbone(position) ||\n      this.hasCgProteinBackbone(position) ||\n      this.hasCgRnaBackbone(position) ||\n      this.hasCgDnaBackbone(position)\n    )\n  }\n\n  getAtomIndexByName (atomname: string|string[]) {\n    const n = this.atomCount\n    const atomMap = this.structure.atomMap\n    const atomTypeIdList = this.atomTypeIdList\n    if (Array.isArray(atomname)) {\n      for (let i = 0; i < n; ++i) {\n        const index = atomTypeIdList[ i ]\n        if (atomname.includes(atomMap.get(index).atomname)) {\n          return i\n        }\n      }\n    } else {\n      for (let i = 0; i < n; ++i) {\n        const index = atomTypeIdList[ i ]\n        if (atomname === atomMap.get(index).atomname) {\n          return i\n        }\n      }\n    }\n    return undefined\n  }\n\n  hasAtomWithName (...atomnames: (string|string[])[]) {\n    const n = atomnames.length\n    for (let i = 0; i < n; ++i) {\n      if (atomnames[ i ] === undefined) continue\n      if (this.getAtomIndexByName(atomnames[ i ]) === undefined) {\n        return false\n      }\n    }\n    return true\n  }\n\n  getBonds (r?: ResidueProxy) {\n    if (this.bonds === undefined) {\n      this.bonds = calculateResidueBonds(r!)  // TODO\n    }\n    return this.bonds\n  }\n\n  getRings () {\n    if (this.rings === undefined) {\n      this.calculateRings()\n    }\n    return this.rings\n  }\n\n  getBondGraph () {\n    if (this.bondGraph === undefined) {\n      this.calculateBondGraph()\n    }\n    return this.bondGraph\n  }\n\n  getAromatic (a?: AtomProxy) {\n    if (this.aromaticAtoms === undefined) {\n      this.calculateAromatic(this.structure.getResidueProxy((a!).residueIndex))  // TODO\n    }\n    return this.aromaticAtoms\n  }\n\n  getAromaticRings (r?: ResidueProxy) {\n    if (this.aromaticRings === undefined) {\n      this.calculateAromatic(r!)  // TODO\n    }\n    return this.aromaticRings\n  }\n\n  /**\n   * @return {Object} bondGraph - represents the bonding in this\n   *   residue: { ai1: [ ai2, ai3, ...], ...}\n   */\n  calculateBondGraph () {\n    const bondGraph: BondGraph = this.bondGraph = {}\n    const bonds = this.getBonds()\n    const nb = bonds.atomIndices1.length\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n\n    for (let i = 0; i < nb; ++i) {\n      const ai1 = atomIndices1[i]\n      const ai2 = atomIndices2[i]\n\n      const a1 = bondGraph[ ai1 ] = bondGraph[ ai1 ] || []\n      a1.push(ai2)\n\n      const a2 = bondGraph[ ai2 ] = bondGraph[ ai2 ] || []\n      a2.push(ai1)\n    }\n  }\n\n  /**\n   * Find all rings up to 2 * RingFinderMaxDepth\n   */\n  calculateRings () {\n    const bondGraph = this.getBondGraph()!  // TODO\n    const state = RingFinderState(bondGraph, this.atomCount)\n\n    for (let i = 0; i < state.count; i++) {\n      if (state.visited[i] >= 0) continue\n      findRings(state, i)\n    }\n\n    this.rings = { atomRings: state.atomRings, rings: state.rings }\n  }\n\n  isAromatic (atom: AtomProxy) {\n    this.aromaticAtoms = this.getAromatic(atom)!  // TODO\n    return this.aromaticAtoms[atom.index - atom.residueAtomOffset] === 1\n  }\n\n  calculateAromatic (r: ResidueProxy) {\n    const aromaticAtoms = this.aromaticAtoms = new Uint8Array(this.atomCount)\n    const rings = this.getRings()!.rings\n\n    const aromaticRingFlags = rings.map(ring => {\n      return isRingAromatic(ring.map(idx => {\n        return this.structure.getAtomProxy(idx + r.atomOffset)\n      }))\n    })\n\n    const aromaticRings: number[][] = this.aromaticRings = []\n    rings.forEach((ring, i) => {\n      if (aromaticRingFlags[i]) {\n        aromaticRings.push(ring)\n        ring.forEach(idx => aromaticAtoms[idx] = 1)\n      }\n    })\n  }\n\n  /**\n   * For bonds with order > 1, pick a reference atom\n   * @return {undefined}\n   */\n  assignBondReferenceAtomIndices () {\n    const bondGraph = this.getBondGraph()!  // TODO\n    const rings = this.getRings()!  // TODO\n    const atomRings = rings.atomRings\n    const ringData = rings.rings\n\n    const bonds = this.bonds!  // TODO\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n    const bondOrders = bonds.bondOrders\n    const bondReferenceAtomIndices = this.bondReferenceAtomIndices\n\n    const nb = bonds.atomIndices1.length\n\n    bondReferenceAtomIndices.length = 0  // reset array\n\n    for (let i = 0; i < nb; ++i) {\n      // Not required for single bonds\n      if (bondOrders[i] <= 1) continue\n\n      let refRing\n\n      const ai1 = atomIndices1[i]\n      const ai2 = atomIndices2[i]\n\n      const rings1 = atomRings[ ai1 ]\n      const rings2 = atomRings[ ai2 ]\n      // Are both atoms in a ring?\n      if (rings1 && rings2) {\n        // Are they in the same ring? (If not, ignore ring info)\n        for (let ri1 = 0; ri1 < rings1.length; ri1++){\n          if (rings2.indexOf(rings1[ ri1 ]) !== -1) {\n            refRing = ringData[ rings1[ ri1 ] ]\n            break\n          }\n        }\n      }\n\n      // Find the first neighbour.\n      if (bondGraph[ ai1 ].length > 1) {\n        for (let j = 0; j < bondGraph[ ai1 ].length; ++j) {\n          const ai3 = bondGraph[ ai1 ][ j ]\n          if (ai3 !== ai2) {\n            if (refRing === undefined || refRing.indexOf(ai3) !== -1){\n              bondReferenceAtomIndices[i] = ai3\n              break\n            }\n          }\n        }\n      } else if (bondGraph[ ai2 ].length > 1) {\n        for (let j = 0; j < bondGraph[ ai2 ].length; ++j) {\n          const ai3 = bondGraph[ ai2 ][ j ]\n          if (ai3 !== ai1) {\n            if (refRing === undefined || refRing.indexOf(ai3) !== -1){\n              bondReferenceAtomIndices[i] = ai3\n              break\n            }\n          }\n        }\n      } // No reference atom could be found (e.g. diatomic molecule/fragment)\n    }\n  }\n\n  getBondIndex (atomIndex1: number, atomIndex2: number) {\n    const bonds = this.bonds!  // TODO\n    const atomIndices1 = bonds.atomIndices1\n    const atomIndices2 = bonds.atomIndices2\n    let idx1 = atomIndices1.indexOf(atomIndex1)\n    let idx2 = atomIndices2.indexOf(atomIndex2)\n    const _idx2 = idx2\n    while (idx1 !== -1) {\n      while (idx2 !== -1) {\n        if (idx1 === idx2) return idx1\n        idx2 = atomIndices2.indexOf(atomIndex2, idx2 + 1)\n      }\n      idx1 = atomIndices1.indexOf(atomIndex1, idx1 + 1)\n      idx2 = _idx2\n    }\n    // returns undefined when no bond is found\n  }\n\n  getBondReferenceAtomIndex (atomIndex1: number, atomIndex2: number) {\n    const bondIndex = this.getBondIndex(atomIndex1, atomIndex2)\n    if (bondIndex === undefined) return undefined\n    if (this.bondReferenceAtomIndices.length === 0) {\n      this.assignBondReferenceAtomIndices()\n    }\n    return this.bondReferenceAtomIndices[ bondIndex ]\n  }\n}\n\n//\n\nconst AromaticRingElements = [\n  Elements.B, Elements.C, Elements.N, Elements.O,\n  Elements.SI, Elements.P, Elements.S,\n  Elements.GE, Elements.AS,\n  Elements.SN, Elements.SB,\n  Elements.BI\n]\nconst AromaticRingPlanarityThreshold = 0.05\n\nfunction isRingAromatic (ring: AtomProxy[]) {\n  if (ring.some(a => !AromaticRingElements.includes(a.number))) return false\n\n  let i = 0\n  const coords = new Matrix(3, ring.length)\n  const cd = coords.data\n\n  ring.forEach(a => {\n    cd[ i + 0 ] = a.x\n    cd[ i + 1 ] = a.y\n    cd[ i + 2 ] = a.z\n    i += 3\n  })\n\n  const pa = new PrincipalAxes(coords)\n\n  return pa.vecC.length() < AromaticRingPlanarityThreshold\n}\n\n//\n\n/**\n * Ring finding code below adapted from MolQL\n * Copyright (c) 2017 MolQL contributors, licensed under MIT\n * @author David Sehnal <david.sehnal@gmail.com>\n */\n\nfunction addRing(state: RingFinderState, a: number, b: number) {\n  // only \"monotonous\" rings\n  if (b < a) return\n\n  const { pred, color, left, right } = state\n  const nc = ++state.currentColor\n\n  let current = a\n\n  for (let t = 0; t < RingFinderMaxDepth; t++) {\n    color[current] = nc\n    current = pred[current]\n    if (current < 0) break\n  }\n\n  let leftOffset = 0\n  let rightOffset = 0\n\n  let found = false\n  let target = 0\n  current = b\n  for (let t = 0; t < RingFinderMaxDepth; t++) {\n    if (color[current] === nc) {\n      target = current\n      found = true\n      break\n    }\n    right[rightOffset++] = current\n    current = pred[current]\n    if (current < 0) break\n  }\n  if (!found) return\n\n  current = a\n  for (let t = 0; t < RingFinderMaxDepth; t++) {\n    left[leftOffset++] = current\n    if (target === current) break\n    current = pred[current]\n    if (current < 0) break\n  }\n\n  const rn = leftOffset + rightOffset\n  const ring: number[] = new Array(rn)\n  let ringOffset = 0;\n  for (let t = 0; t < leftOffset; t++) {\n    ring[ringOffset++] = left[t]\n  }\n  for (let t = rightOffset - 1; t >= 0; t--) {\n    ring[ringOffset++] = right[t]\n  }\n\n  const ri = state.rings.length\n  // set atomRing indices:\n  for (let i = 0; i < rn; ++i) {\n    const ai = ring[i]\n    if (state.atomRings[ai]) {\n      state.atomRings[ai].push(ri)\n    } else {\n      state.atomRings[ai] = [ri]\n    }\n  }\n\n  state.rings.push(ring)\n}\n\nfunction findRings(state: RingFinderState, from: number) {\n  const { bonds, visited, queue, pred } = state\n\n  visited[from] = 1\n  queue[0] = from\n\n  let head = 0\n  let size = 1\n\n  while (head < size) {\n    const top = queue[head++]\n    const start = 0\n    if (bonds[top] === undefined) {\n      continue\n    }\n    const end = bonds[top].length\n\n    for (let i = start; i < end; i++) {\n      const other = bonds[top][i]\n\n      if (visited[other] > 0) {\n        if (pred[other] !== top && pred[top] !== other) {\n          addRing(state, top, other)\n        }\n        continue\n      }\n\n      visited[other] = 1\n      queue[size++] = other\n      pred[other] = top\n    }\n  }\n}\n\nconst RingFinderMaxDepth = 4\n\ninterface RingFinderState {\n  count: number,\n  visited: Int32Array,\n  queue: Int32Array,\n  color: Int32Array,\n  pred: Int32Array,\n\n  left: Int32Array,\n  right: Int32Array,\n\n  currentColor: number,\n\n  rings: number[][],\n  atomRings: number[][],\n\n  bonds: BondGraph\n}\n\nfunction RingFinderState(bonds: BondGraph, capacity: number): RingFinderState {\n  const state = {\n    count: capacity,\n    visited: new Int32Array(capacity),\n    queue: new Int32Array(capacity),\n    pred: new Int32Array(capacity),\n    left: new Int32Array(RingFinderMaxDepth),\n    right: new Int32Array(RingFinderMaxDepth),\n    color: new Int32Array(capacity),\n    currentColor: 0,\n    rings: [],\n    atomRings: [],\n    bonds\n  }\n  for (let i = 0; i < capacity; i++) {\n    state.visited[i] = -1\n    state.pred[i] = -1\n  }\n  return state\n}\n","/**\n * @file Residue Map\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport { ResidueBonds } from '../structure/structure-utils'\nimport ResidueType from './residue-type'\n\nfunction getHash (resname: string, atomTypeIdList: number[], hetero: boolean, chemCompType = '') {\n  return (\n    resname + '|' +\n    atomTypeIdList.join(',') + '|' +\n    (hetero ? 1 : 0) + '|' +\n    chemCompType\n  )\n}\n\nclass ResidueMap {\n  dict: { [k: string]: number } = {}\n  list: ResidueType[] = []\n\n  constructor (readonly structure: Structure) {}\n\n  add (resname: string, atomTypeIdList: number[], hetero: boolean, chemCompType = '', bonds?: ResidueBonds) {\n    resname = resname.toUpperCase()\n    const hash = getHash(resname, atomTypeIdList, hetero, chemCompType)\n    let id = this.dict[ hash ]\n    if (id === undefined) {\n      const residueType = new ResidueType(\n        this.structure, resname, atomTypeIdList, hetero, chemCompType, bonds\n      )\n      id = this.list.length\n      this.dict[ hash ] = id\n      this.list.push(residueType)\n    }\n    return id\n  }\n\n  get (id: number) {\n    return this.list[ id ]\n  }\n}\n\nexport default ResidueMap\n","/**\n * @file Bond Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport Structure from '../structure/structure'\nimport BondStore from '../store/bond-store'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Bond proxy\n */\nclass BondProxy {\n  index: number\n\n  bondStore: BondStore\n\n  private _v12: Vector3\n  private _v13: Vector3\n  private _ap1: AtomProxy\n  private _ap2: AtomProxy\n  private _ap3: AtomProxy\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.bondStore = structure.bondStore\n\n    this._v12 = new Vector3()\n    this._v13 = new Vector3()\n    this._ap1 = this.structure.getAtomProxy()\n    this._ap2 = this.structure.getAtomProxy()\n    this._ap3 = this.structure.getAtomProxy()\n  }\n\n  /**\n   * @type {AtomProxy}\n   */\n  get atom1 () {\n    return this.structure.getAtomProxy(this.atomIndex1)\n  }\n\n  /**\n   * @type {AtomProxy}\n   */\n  get atom2 () {\n    return this.structure.getAtomProxy(this.atomIndex2)\n  }\n\n  /**\n   * @type {Integer}\n   */\n  get atomIndex1 () {\n    return this.bondStore.atomIndex1[ this.index ]\n  }\n  set atomIndex1 (value) {\n    this.bondStore.atomIndex1[ this.index ] = value\n  }\n\n  /**\n   * @type {Integer}\n   */\n  get atomIndex2 () {\n    return this.bondStore.atomIndex2[ this.index ]\n  }\n  set atomIndex2 (value) {\n    this.bondStore.atomIndex2[ this.index ] = value\n  }\n\n  /**\n   * @type {Integer}\n   */\n  get bondOrder () {\n    return this.bondStore.bondOrder[ this.index ]\n  }\n  set bondOrder (value) {\n    this.bondStore.bondOrder[ this.index ] = value\n  }\n\n  getOtherAtomIndex (atomIndex: number) {\n    return atomIndex === this.atomIndex1 ? this.atomIndex2 : this.atomIndex1\n  }\n\n  getOtherAtom (atom: AtomProxy) {\n    return this.structure.getAtomProxy(this.getOtherAtomIndex(atom.index))\n  }\n\n  /**\n   * Get reference atom index for the bond\n   * @return {Integer|undefined} atom index, or `undefined` if unavailable\n   */\n  getReferenceAtomIndex () {\n    const ap1 = this._ap1\n    const ap2 = this._ap2\n    ap1.index = this.atomIndex1\n    ap2.index = this.atomIndex2\n    if (ap1.residueIndex !== ap2.residueIndex) {\n      return undefined  // Bond between residues, for now ignore (could detect)\n    }\n    const typeAtomIndex1 = ap1.index - ap1.residueAtomOffset\n    const typeAtomIndex2 = ap2.index - ap2.residueAtomOffset\n    const residueType = ap1.residueType\n    const ix = residueType.getBondReferenceAtomIndex(typeAtomIndex1, typeAtomIndex2)\n    if (ix !== undefined) {\n      return ix + ap1.residueAtomOffset\n    } else {\n      console.warn('No reference atom found', ap1.index, ap2.index)\n    }\n  }\n\n  /**\n   * calculate shift direction for displaying double/triple bonds\n   * @param  {Vector3} [v] pre-allocated output vector\n   * @return {Vector3} the shift direction vector\n   */\n  calculateShiftDir (v = new Vector3()) {\n    const ap1 = this._ap1\n    const ap2 = this._ap2\n    const ap3 = this._ap3\n    const v12 = this._v12\n    const v13 = this._v13\n\n    ap1.index = this.atomIndex1\n    ap2.index = this.atomIndex2\n    const ai3 = this.getReferenceAtomIndex()\n\n    v12.subVectors(ap1 as any, ap2 as any).normalize()  // TODO\n    if (ai3 !== undefined) {\n      ap3.index = ai3\n      v13.subVectors(ap1 as any, ap3 as any)  // TODO\n    } else {\n      v13.copy(ap1 as any)  // no reference point, use origin  // TODO\n    }\n    v13.normalize()\n\n    // make sure v13 and v12 are not colinear\n    let dp = v12.dot(v13)\n    if (1 - Math.abs(dp) < 1e-5) {\n      v13.set(1, 0, 0)\n      dp = v12.dot(v13)\n      if (1 - Math.abs(dp) < 1e-5) {\n        v13.set(0, 1, 0)\n        dp = v12.dot(v13)\n      }\n    }\n\n    return v.copy(v13.sub(v12.multiplyScalar(dp))).normalize()\n  }\n\n  qualifiedName () {\n    return this.atomIndex1 + '=' + this.atomIndex2\n  }\n\n  /**\n   * Clone object\n   * @return {BondProxy} cloned bond\n   */\n  clone () {\n    return new BondProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      atomIndex1: this.atomIndex1,\n      atomIndex2: this.atomIndex2,\n      bondOrder: this.bondOrder\n    }\n  }\n}\n\nexport default BondProxy\n","/**\n * @file Residue Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { NumberArray } from '../types'\nimport { defaults } from '../utils'\nimport {\n    SecStrucHelix, SecStrucSheet, SecStrucTurn,\n    ProteinType, RnaType, DnaType, WaterType, IonType, SaccharideType,\n    CgProteinBackboneType, CgRnaBackboneType, CgDnaBackboneType,\n    AA1\n} from '../structure/structure-constants'\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\nimport AtomStore from '../store/atom-store'\n\nimport AtomMap from '../store/atom-map'\nimport ResidueMap from '../store/residue-map'\n\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueType, { RingData } from '../store/residue-type';\nimport { ResidueBonds } from '../structure/structure-utils';\nimport AtomType from '../store/atom-type';\nimport ChainProxy from './chain-proxy';\nimport Entity from '../structure/entity';\n\n/**\n * Residue proxy\n */\nclass ResidueProxy {\n  index: number\n\n  chainStore: ChainStore\n  residueStore: ResidueStore\n  atomStore: AtomStore\n\n  residueMap: ResidueMap\n  atomMap: AtomMap\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n    this.atomStore = structure.atomStore\n    this.residueMap = structure.residueMap\n    this.atomMap = structure.atomMap\n  }\n\n  /**\n   * Entity\n   * @type {Entity}\n   */\n  get entity (): Entity {\n    return this.structure.entityList[ this.entityIndex ]\n  }\n  get entityIndex () {\n    return this.chainStore.entityIndex[ this.chainIndex ]\n  }\n  /**\n   * Chain\n   * @type {ChainProxy}\n   */\n  get chain (): ChainProxy {\n    return this.structure.getChainProxy(this.chainIndex)\n  }\n\n  get chainIndex () {\n    return this.residueStore.chainIndex[ this.index ]\n  }\n  set chainIndex (value) {\n    this.residueStore.chainIndex[ this.index ] = value\n  }\n\n  get atomOffset () {\n    return this.residueStore.atomOffset[ this.index ]\n  }\n  set atomOffset (value) {\n    this.residueStore.atomOffset[ this.index ] = value\n  }\n\n  /**\n   * Atom count\n   * @type {Integer}\n   */\n  get atomCount () {\n    return this.residueStore.atomCount[ this.index ]\n  }\n  set atomCount (value) {\n    this.residueStore.atomCount[ this.index ] = value\n  }\n\n  get atomEnd () {\n    return this.atomOffset + this.atomCount - 1\n  }\n\n  //\n\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.chainIndex ]\n  }\n  /**\n   * Chain name\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.chainIndex)\n  }\n  /**\n   * Chain id\n   * @type {String}\n   */\n  get chainid () {\n    return this.chainStore.getChainid(this.chainIndex)\n  }\n\n  //\n\n  /**\n   * Residue number/label\n   * @type {Integer}\n   */\n  get resno () {\n    return this.residueStore.resno[ this.index ]\n  }\n  set resno (value) {\n    this.residueStore.resno[ this.index ] = value\n  }\n\n  /**\n   * Secondary structure code\n   * @type {String}\n   */\n  get sstruc () {\n    return this.residueStore.getSstruc(this.index)\n  }\n  set sstruc (value) {\n    this.residueStore.setSstruc(this.index, value)\n  }\n\n  /**\n   * Insertion code\n   * @type {String}\n   */\n  get inscode () {\n    return this.residueStore.getInscode(this.index)\n  }\n  set inscode (value) {\n    this.residueStore.setInscode(this.index, value)\n  }\n\n  //\n\n  get residueType (): ResidueType {\n    return this.residueMap.get(this.residueStore.residueTypeId[ this.index ])\n  }\n\n  /**\n   * Residue name\n   * @type {String}\n   */\n  get resname () {\n    return this.residueType.resname\n  }\n  /**\n   * Hetero flag\n   * @type {Boolean}\n   */\n  get hetero () {\n    return this.residueType.hetero\n  }\n  get moleculeType () {\n    return this.residueType.moleculeType\n  }\n  get backboneType () {\n    return this.residueType.backboneType\n  }\n  get backboneStartType () {\n    return this.residueType.backboneStartType\n  }\n  get backboneEndType () {\n    return this.residueType.backboneEndType\n  }\n  get traceAtomIndex () {\n    return this.residueType.traceAtomIndex + this.atomOffset\n  }\n  get direction1AtomIndex () {\n    return this.residueType.direction1AtomIndex + this.atomOffset\n  }\n  get direction2AtomIndex () {\n    return this.residueType.direction2AtomIndex + this.atomOffset\n  }\n  get backboneStartAtomIndex () {\n    return this.residueType.backboneStartAtomIndex + this.atomOffset\n  }\n  get backboneEndAtomIndex () {\n    return this.residueType.backboneEndAtomIndex + this.atomOffset\n  }\n  get rungEndAtomIndex () {\n    return this.residueType.rungEndAtomIndex + this.atomOffset\n  }\n\n  //\n\n  get x () {\n    let x = 0\n    for (let i = this.atomOffset; i <= this.atomEnd; ++i) {\n      x += this.atomStore.x[ i ]\n    }\n    return x / this.atomCount\n  }\n\n  get y () {\n    let y = 0\n    for (let i = this.atomOffset; i <= this.atomEnd; ++i) {\n      y += this.atomStore.y[ i ]\n    }\n    return y / this.atomCount\n  }\n\n  get z () {\n    let z = 0\n    for (let i = this.atomOffset; i <= this.atomEnd; ++i) {\n      z += this.atomStore.z[ i ]\n    }\n    return z / this.atomCount\n  }\n\n  //\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    const count = this.atomCount\n    const offset = this.atomOffset\n    const ap = this.structure._ap\n    const end = offset + count\n\n    if (selection && selection.atomOnlyTest) {\n      const atomOnlyTest = selection.atomOnlyTest\n      for (let i = offset; i < end; ++i) {\n        ap.index = i\n        if (atomOnlyTest(ap)) callback(ap)\n      }\n    } else {\n      for (let i = offset; i < end; ++i) {\n        ap.index = i\n        callback(ap)\n      }\n    }\n  }\n\n  //\n\n  /**\n   * Write residue center position to array\n   * @param  {Array|TypedArray} [array] - target array\n   * @param  {Integer} [offset] - the offset\n   * @return {Array|TypedArray} target array\n   */\n  positionToArray (array: NumberArray = [], offset = 0) {\n    array[ offset + 0 ] = this.x\n    array[ offset + 1 ] = this.y\n    array[ offset + 2 ] = this.z\n\n    return array\n  }\n\n  //\n\n  /**\n   * If residue is from a protein\n   * @return {Boolean} flag\n   */\n  isProtein () {\n    return this.residueType.moleculeType === ProteinType\n  }\n\n  /**\n   * If residue is nucleic\n   * @return {Boolean} flag\n   */\n  isNucleic () {\n    const moleculeType = this.residueType.moleculeType\n    return moleculeType === RnaType || moleculeType === DnaType\n  }\n\n  /**\n   * If residue is rna\n   * @return {Boolean} flag\n   */\n  isRna () {\n    return this.residueType.moleculeType === RnaType\n  }\n\n  /**\n   * If residue is dna\n   * @return {Boolean} flag\n   */\n  isDna () {\n    return this.residueType.moleculeType === DnaType\n  }\n\n  /**\n   * If residue is coarse-grain\n   * @return {Boolean} flag\n   */\n  isCg () {\n    const backboneType = this.residueType.backboneType\n    return (\n      backboneType === CgProteinBackboneType ||\n      backboneType === CgRnaBackboneType ||\n      backboneType === CgDnaBackboneType\n    )\n  }\n\n  /**\n   * If residue is from a polymer\n   * @return {Boolean} flag\n   */\n  isPolymer () {\n    if (this.structure.entityList.length > 0) {\n      return this.entity.isPolymer()\n    } else {\n      const moleculeType = this.residueType.moleculeType\n      return (\n        moleculeType === ProteinType ||\n        moleculeType === RnaType ||\n        moleculeType === DnaType\n      )\n    }\n  }\n\n  /**\n   * If residue is hetero\n   * @return {Boolean} flag\n   */\n  isHetero () {\n    return this.residueType.hetero === 1\n  }\n\n  /**\n   * If residue is a water molecule\n   * @return {Boolean} flag\n   */\n  isWater () {\n    return this.residueType.moleculeType === WaterType\n  }\n\n  /**\n   * If residue is an ion\n   * @return {Boolean} flag\n   */\n  isIon () {\n    return this.residueType.moleculeType === IonType\n  }\n\n  /**\n   * If residue is a saccharide\n   * @return {Boolean} flag\n   */\n  isSaccharide () {\n    return this.residueType.moleculeType === SaccharideType\n  }\n\n  isStandardAminoacid () {\n    return this.residueType.isStandardAminoacid()\n  }\n\n  isStandardBase () {\n    return this.residueType.isStandardBase()\n  }\n\n  /**\n   * If residue is part of a helix\n   * @return {Boolean} flag\n   */\n  isHelix () {\n    return SecStrucHelix.includes(this.sstruc)\n  }\n\n  /**\n   * If residue is part of a sheet\n   * @return {Boolean} flag\n   */\n  isSheet () {\n    return SecStrucSheet.includes(this.sstruc)\n  }\n\n  /**\n   * If residue is part of a turn\n   * @return {Boolean} flag\n   */\n  isTurn () {\n    return SecStrucTurn.includes(this.sstruc) && this.isProtein()\n  }\n\n  getAtomType (index: number): AtomType {\n    return this.atomMap.get(this.atomStore.atomTypeId[ index ])\n  }\n\n  getResname1 () {\n    // FIXME nucleic support\n    return AA1[ this.resname.toUpperCase() ] || 'X'\n  }\n\n  getBackboneType (position: number) {\n    switch (position) {\n      case -1:\n        return this.residueType.backboneStartType\n      case 1:\n        return this.residueType.backboneEndType\n      default:\n        return this.residueType.backboneType\n    }\n  }\n\n  getAtomIndexByName (atomname: string) {\n    let index = this.residueType.getAtomIndexByName(atomname)\n    if (index !== undefined) {\n      index += this.atomOffset\n    }\n    return index\n  }\n\n  hasAtomWithName (atomname: string) {\n    return this.residueType.hasAtomWithName(atomname)\n  }\n\n  getAtomnameList () {\n    console.warn('getAtomnameList - might be expensive')\n\n    const n = this.atomCount\n    const offset = this.atomOffset\n    const list = new Array(n)\n    for (let i = 0; i < n; ++i) {\n      list[ i ] = this.getAtomType(offset + i).atomname\n    }\n    return list\n  }\n\n  /**\n   * If residue is connected to another\n   * @param  {ResidueProxy} rNext - the other residue\n   * @return {Boolean} - flag\n   */\n  connectedTo (rNext: ResidueProxy) {\n    const bbAtomEnd = this.structure.getAtomProxy(this.backboneEndAtomIndex)\n    const bbAtomStart = this.structure.getAtomProxy(rNext.backboneStartAtomIndex)\n    if (bbAtomEnd && bbAtomStart) {\n      return bbAtomEnd.connectedTo(bbAtomStart)\n    } else {\n      return false\n    }\n  }\n\n  getNextConnectedResidue () {\n    const rOffset = this.chainStore.residueOffset[ this.chainIndex ]\n    const rCount = this.chainStore.residueCount[ this.chainIndex ]\n    const nextIndex = this.index + 1\n    if (nextIndex < rOffset + rCount) {\n      const rpNext = this.structure.getResidueProxy(nextIndex)\n      if (this.connectedTo(rpNext)) {\n        return rpNext\n      }\n    } else if (nextIndex === rOffset + rCount) {  // cyclic\n      const rpFirst = this.structure.getResidueProxy(rOffset)\n      if (this.connectedTo(rpFirst)) {\n        return rpFirst\n      }\n    }\n    return undefined\n  }\n\n  getPreviousConnectedResidue (residueProxy?: ResidueProxy) {\n    const rOffset = this.chainStore.residueOffset[ this.chainIndex ]\n    const prevIndex = this.index - 1\n    if (prevIndex >= rOffset) {\n      const rpPrev = defaults(residueProxy, this.structure.getResidueProxy())\n      rpPrev.index = prevIndex\n      if (rpPrev.connectedTo(this)) {\n        return rpPrev\n      }\n    } else if (prevIndex === rOffset - 1) {  // cyclic\n      const rCount = this.chainStore.residueCount[ this.chainIndex ]\n      const rpLast = defaults(residueProxy, this.structure.getResidueProxy())\n      rpLast.index = rOffset + rCount - 1\n      if (rpLast.connectedTo(this)) {\n        return rpLast\n      }\n    }\n    return undefined\n  }\n\n  getBonds (): ResidueBonds {\n    return this.residueType.getBonds(this)\n  }\n\n  getRings (): RingData|undefined {\n    return this.residueType.getRings()\n  }\n\n  getAromaticRings () {\n    return this.residueType.getAromaticRings(this)\n  }\n\n  qualifiedName (noResname = false) {\n    let name = ''\n    if (this.resname && !noResname) name += '[' + this.resname + ']'\n    if (this.resno !== undefined) name += this.resno\n    if (this.inscode) name += '^' + this.inscode\n    if (this.chain) name += ':' + this.chainname\n    name += '/' + this.modelIndex\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {ResidueProxy} cloned residue\n   */\n  clone () {\n    return new ResidueProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      chainIndex: this.chainIndex,\n      atomOffset: this.atomOffset,\n      atomCount: this.atomCount,\n\n      resno: this.resno,\n      resname: this.resname,\n      sstruc: this.sstruc\n    }\n  }\n}\n\nexport default ResidueProxy\n","/**\n * @file Polymer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// import { Log } from '../globals'\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\nimport AtomStore from '../store/atom-store'\n\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Polymer\n */\nclass Polymer {\n  chainStore: ChainStore\n  residueStore: ResidueStore\n  atomStore: AtomStore\n\n  residueCount: number\n\n  isPrevConnected: boolean\n  isNextConnected: boolean\n  isNextNextConnected: boolean\n  isCyclic: boolean\n\n  private __residueProxy: ResidueProxy\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} residueIndexStart - the index of the first residue\n   * @param {Integer} residueIndexEnd - the index of the last residue\n   */\n  constructor (readonly structure: Structure, readonly residueIndexStart: number, readonly residueIndexEnd: number) {\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n    this.atomStore = structure.atomStore\n\n    /**\n     * @type {Integer}\n     */\n    this.residueCount = residueIndexEnd - residueIndexStart + 1\n\n    const rpStart = this.structure.getResidueProxy(this.residueIndexStart)\n    const rpEnd = this.structure.getResidueProxy(this.residueIndexEnd)\n    this.isPrevConnected = rpStart.getPreviousConnectedResidue() !== undefined\n    const rpNext = rpEnd.getNextConnectedResidue()\n    this.isNextConnected = rpNext !== undefined\n    this.isNextNextConnected = rpNext !== undefined && rpNext.getNextConnectedResidue() !== undefined\n    this.isCyclic = rpEnd.connectedTo(rpStart)\n\n    this.__residueProxy = this.structure.getResidueProxy()\n\n    // console.log( this.qualifiedName(), this );\n  }\n\n  get chainIndex () {\n    return this.residueStore.chainIndex[ this.residueIndexStart ]\n  }\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.chainIndex ]\n  }\n\n  /**\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.chainIndex)\n  }\n\n  //\n\n  /**\n   * If first residue is from aprotein\n   * @return {Boolean} flag\n   */\n  isProtein () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.isProtein()\n  }\n\n  /**\n   * If atom is part of a coarse-grain group\n   * @return {Boolean} flag\n   */\n  isCg () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.isCg()\n  }\n\n  /**\n   * If atom is part of a nucleic molecule\n   * @return {Boolean} flag\n   */\n  isNucleic () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.isNucleic()\n  }\n\n  getMoleculeType () {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.moleculeType\n  }\n\n  getBackboneType (position: number) {\n    this.__residueProxy.index = this.residueIndexStart\n    return this.__residueProxy.getBackboneType(position)\n  }\n\n  getAtomIndexByType (index: number, type: string) {\n    // TODO pre-calculate, add to residueStore???\n\n    if (this.isCyclic) {\n      if (index === -1) {\n        index = this.residueCount - 1\n      } else if (index === this.residueCount) {\n        index = 0\n      }\n    } else {\n      if (index === -1 && !this.isPrevConnected) index += 1\n      if (index === this.residueCount && !this.isNextNextConnected) index -= 1\n      // if( index === this.residueCount - 1 && !this.isNextConnected ) index -= 1;\n    }\n\n    const rp = this.__residueProxy\n    rp.index = this.residueIndexStart + index\n    let aIndex\n\n    switch (type) {\n      case 'trace':\n        aIndex = rp.traceAtomIndex\n        break\n      case 'direction1':\n        aIndex = rp.direction1AtomIndex\n        break\n      case 'direction2':\n        aIndex = rp.direction2AtomIndex\n        break\n      default:\n        aIndex = rp.getAtomIndexByName(type)\n    }\n\n    // if (!ap){\n    //   console.log(this, type, rp.residueType)\n    //   // console.log(rp.qualifiedName(), rp.index, index, this.residueCount - 1)\n    //   // rp.index = this.residueIndexStart;\n    //   // console.log(rp.qualifiedName(), this.residueIndexStart)\n    //   // rp.index = this.residueIndexEnd;\n    //   // console.log(rp.qualifiedName(), this.residueIndexEnd)\n    // }\n\n    return aIndex\n  }\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    this.eachResidue(function (rp) {\n      rp.eachAtom(callback, selection)\n    })\n  }\n\n  eachAtomN (n: number, callback: (...apArray: AtomProxy[]) => void, type: string) {\n    const m = this.residueCount\n    const array: AtomProxy[] = new Array(n)\n\n    for (let i = 0; i < n; ++i) {\n      array[ i ] = this.structure.getAtomProxy(this.getAtomIndexByType(i, type))\n    }\n    callback.apply(this, array)\n\n    for (var j = n; j < m; ++j) {\n      for (let i = 1; i < n; ++i) {\n        array[ i - 1 ].index = array[ i ].index\n      }\n      array[ n - 1 ].index = this.getAtomIndexByType(j, type)!  // TODO\n      callback.apply(this, array)\n    }\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @return {undefined}\n   */\n  eachResidue (callback: (rp: ResidueProxy) => void) {\n    const rp = this.structure.getResidueProxy()\n    const n = this.residueCount\n    const rStartIndex = this.residueIndexStart\n\n    for (let i = 0; i < n; ++i) {\n      rp.index = rStartIndex + i\n      callback(rp)\n    }\n  }\n\n  qualifiedName () {\n    const rpStart = this.structure.getResidueProxy(this.residueIndexStart)\n    const rpEnd = this.structure.getResidueProxy(this.residueIndexEnd)\n    return rpStart.qualifiedName() + ' - ' + rpEnd.qualifiedName()\n  }\n}\n\nexport default Polymer\n","/**\n * @file Chain Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { UnknownBackboneType } from '../structure/structure-constants'\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\n\nimport Polymer from '../proxy/polymer'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ModelProxy from './model-proxy';\nimport Entity from '../structure/entity';\n\n/**\n * Chain proxy\n */\nclass ChainProxy {\n  index: number\n\n  chainStore: ChainStore\n  residueStore: ResidueStore\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n  }\n\n  /**\n   * Entity\n   * @type {Entity}\n   */\n  get entity (): Entity {\n    return this.structure.entityList[ this.entityIndex ]\n  }\n  /**\n   * Model\n   * @type {ModelProxy}\n   */\n  get model (): ModelProxy {\n    return this.structure.getModelProxy(this.modelIndex)\n  }\n\n  get entityIndex () {\n    return this.chainStore.entityIndex[ this.index ]\n  }\n  set entityIndex (value) {\n    this.chainStore.entityIndex[ this.index ] = value\n  }\n\n  get modelIndex () {\n    return this.chainStore.modelIndex[ this.index ]\n  }\n  set modelIndex (value) {\n    this.chainStore.modelIndex[ this.index ] = value\n  }\n\n  get residueOffset () {\n    return this.chainStore.residueOffset[ this.index ]\n  }\n  set residueOffset (value) {\n    this.chainStore.residueOffset[ this.index ] = value\n  }\n\n  /**\n   * Residue count\n   * @type {Integer}\n   */\n  get residueCount () {\n    return this.chainStore.residueCount[ this.index ]\n  }\n  set residueCount (value) {\n    this.chainStore.residueCount[ this.index ] = value\n  }\n\n  get residueEnd () {\n    return this.residueOffset + this.residueCount - 1\n  }\n\n  get atomOffset () {\n    return this.residueStore.atomOffset[ this.residueOffset ]\n  }\n  get atomEnd () {\n    return (\n      this.residueStore.atomOffset[ this.residueEnd ] +\n      this.residueStore.atomCount[ this.residueEnd ] - 1\n    )\n  }\n  /**\n   * Atom count\n   * @type {Integer}\n   */\n  get atomCount () {\n    if (this.residueCount === 0) {\n      return 0\n    } else {\n      return this.atomEnd - this.atomOffset + 1\n    }\n  }\n\n  //\n\n  /**\n   * Chain name\n   * @type {String}\n   */\n  get chainname () {\n    return this.chainStore.getChainname(this.index)\n  }\n  set chainname (value) {\n    this.chainStore.setChainname(this.index, value)\n  }\n\n  /**\n   * Chain id\n   * @type {String}\n   */\n  get chainid () {\n    return this.chainStore.getChainid(this.index)\n  }\n  set chainid (value) {\n    this.chainStore.setChainid(this.index, value)\n  }\n\n  //\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    this.eachResidue(function (rp) {\n      rp.eachAtom(callback, selection)\n    }, selection)\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachResidue (callback: (rp: ResidueProxy) => void, selection?: Selection) {\n    const count = this.residueCount\n    const offset = this.residueOffset\n    const rp = this.structure._rp\n    const end = offset + count\n\n    if (selection && selection.test) {\n      const residueOnlyTest = selection.residueOnlyTest\n      if (residueOnlyTest) {\n        for (let i = offset; i < end; ++i) {\n          rp.index = i\n          if (residueOnlyTest(rp)) {\n            callback(rp)\n          }\n        }\n      } else {\n        for (let i = offset; i < end; ++i) {\n          rp.index = i\n          callback(rp)\n        }\n      }\n    } else {\n      for (let i = offset; i < end; ++i) {\n        rp.index = i\n        callback(rp)\n      }\n    }\n  }\n\n  /**\n   * Multi-residue iterator\n   * @param {Integer} n - window size\n   * @param  {function(residueList: ResidueProxy[])} callback - the callback\n   * @return {undefined}\n   */\n  eachResidueN (n: number, callback: (...rpArray: ResidueProxy[]) => void) {\n    const count = this.residueCount\n    const offset = this.residueOffset\n    const end = offset + count\n    if (count < n) return\n    const array: ResidueProxy[] = new Array(n)\n\n    for (let i = 0; i < n; ++i) {\n      array[ i ] = this.structure.getResidueProxy(offset + i)\n    }\n    callback.apply(this, array)\n\n    for (let j = offset + n; j < end; ++j) {\n      for (let i = 0; i < n; ++i) {\n        array[ i ].index += 1\n      }\n      callback.apply(this, array)\n    }\n  }\n\n  /**\n   * Polymer iterator\n   * @param  {function(polymer: Polymer)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachPolymer (callback: (p: Polymer) => void, selection?: Selection) {\n    let rStartIndex = 0\n    let rNextIndex = 0\n    const test = selection ? selection.residueOnlyTest : undefined\n    const structure = this.model.structure\n\n    const count = this.residueCount\n    const offset = this.residueOffset\n    const end = offset + count\n\n    const rp1 = this.structure.getResidueProxy()\n    const rp2 = this.structure.getResidueProxy(offset)\n\n    const ap1 = this.structure.getAtomProxy()\n    const ap2 = this.structure.getAtomProxy()\n\n    let first = true\n\n    for (let i = offset + 1; i < end; ++i) {\n      rp1.index = rp2.index\n      rp2.index = i\n\n      const bbType1 = first ? rp1.backboneEndType : rp1.backboneType\n      const bbType2 = rp2.backboneType\n\n      if (first) {\n        rStartIndex = rp1.index\n        first = false\n      }\n      rNextIndex = rp2.index\n\n      if (bbType1 !== UnknownBackboneType && bbType1 === bbType2) {\n        ap1.index = rp1.backboneEndAtomIndex\n        ap2.index = rp2.backboneStartAtomIndex\n      } else {\n        if (bbType1 !== UnknownBackboneType) {\n          if (rp1.index - rStartIndex > 1) {\n            // console.log(\"FOO1\",rStartIndex, rp1.index)\n            callback(new Polymer(structure, rStartIndex, rp1.index))\n          }\n        }\n        rStartIndex = rNextIndex\n\n        continue\n      }\n\n      if (!ap1 || !ap2 || !ap1.connectedTo(ap2) ||\n        (test && (!test(rp1) || !test(rp2)))\n      ) {\n        if (rp1.index - rStartIndex > 1) {\n          // console.log(\"FOO2\",rStartIndex, rp1.index)\n          callback(new Polymer(structure, rStartIndex, rp1.index))\n        }\n        rStartIndex = rNextIndex\n      }\n    }\n\n    if (rNextIndex - rStartIndex > 1) {\n      if (this.structure.getResidueProxy(rStartIndex).backboneEndType) {\n        // console.log(\"FOO3\",rStartIndex, rNextIndex)\n        callback(new Polymer(structure, rStartIndex, rNextIndex))\n      }\n    }\n  }\n\n  //\n\n  qualifiedName () {\n    var name = ':' + this.chainname + '/' + this.modelIndex\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {ChainProxy} cloned chain\n   */\n  clone () {\n    return new ChainProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      residueOffset: this.residueOffset,\n      residueCount: this.residueCount,\n\n      chainname: this.chainname\n    }\n  }\n}\n\nexport default ChainProxy\n","/**\n * @file Model Proxy\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\n\nimport ModelStore from '../store/model-store'\nimport ChainStore from '../store/chain-store'\nimport ResidueStore from '../store/residue-store'\n\nimport ChainProxy from '../proxy/chain-proxy'\nimport Polymer from '../proxy/polymer'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Model proxy\n */\nclass ModelProxy {\n  index: number\n\n  modelStore: ModelStore\n  chainStore: ChainStore\n  residueStore: ResidueStore\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Integer} index - the index\n   */\n  constructor (readonly structure: Structure, index = 0) {\n    this.index = index\n    this.modelStore = structure.modelStore\n    this.chainStore = structure.chainStore\n    this.residueStore = structure.residueStore\n  }\n\n  get chainOffset () {\n    return this.modelStore.chainOffset[ this.index ]\n  }\n  set chainOffset (value) {\n    this.modelStore.chainOffset[ this.index ] = value\n  }\n\n  get chainCount () {\n    return this.modelStore.chainCount[ this.index ]\n  }\n  set chainCount (value) {\n    this.modelStore.chainCount[ this.index ] = value\n  }\n\n  get residueOffset () {\n    return this.chainStore.residueOffset[ this.chainOffset ]\n  }\n  get atomOffset () {\n    return this.residueStore.atomOffset[ this.residueOffset ]\n  }\n\n  get chainEnd () {\n    return this.chainOffset + this.chainCount - 1\n  }\n  get residueEnd () {\n    return (\n      this.chainStore.residueOffset[ this.chainEnd ] +\n      this.chainStore.residueCount[ this.chainEnd ] - 1\n    )\n  }\n  get atomEnd () {\n    return (\n      this.residueStore.atomOffset[ this.residueEnd ] +\n      this.residueStore.atomCount[ this.residueEnd ] - 1\n    )\n  }\n\n  /**\n   * Residue count\n   * @type {Integer}\n   */\n  get residueCount () {\n    if (this.chainCount === 0) {\n      return 0\n    } else {\n      return this.residueEnd - this.residueOffset + 1\n    }\n  }\n\n  /**\n   * Atom count\n   * @type {Integer}\n   */\n  get atomCount () {\n    if (this.residueCount === 0) {\n      return 0\n    } else {\n      return this.atomEnd - this.atomOffset + 1\n    }\n  }\n\n  //\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (ap: AtomProxy) => void, selection?: Selection) {\n    this.eachChain(function (cp) {\n      cp.eachAtom(callback, selection)\n    }, selection)\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachResidue (callback: (rp: ResidueProxy) => void, selection?: Selection) {\n    this.eachChain(function (cp) {\n      cp.eachResidue(callback, selection)\n    }, selection)\n  }\n\n  /**\n   * Polymer iterator\n   * @param  {function(polymer: Polymer)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachPolymer (callback: (p: Polymer) => void, selection?: Selection) {\n    if (selection && selection.chainOnlyTest) {\n      const chainOnlyTest = selection.chainOnlyTest\n\n      this.eachChain(function (cp) {\n        if (chainOnlyTest(cp)) {\n          cp.eachPolymer(callback, selection)\n        }\n      })\n    } else {\n      this.eachChain(function (cp) {\n        cp.eachPolymer(callback, selection)\n      })\n    }\n  }\n\n  /**\n   * Chain iterator\n   * @param  {function(chain: ChainProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachChain (callback: (cp: ChainProxy) => void, selection?: Selection) {\n    const count = this.chainCount\n    const offset = this.chainOffset\n    const cp = this.structure._cp\n    const end = offset + count\n\n    if (selection && selection.test) {\n      const chainOnlyTest = selection.chainOnlyTest\n      if (chainOnlyTest) {\n        for (let i = offset; i < end; ++i) {\n          cp.index = i\n          if (chainOnlyTest(cp)) {\n            callback(cp)\n          }\n        }\n      } else {\n        for (let i = offset; i < end; ++i) {\n          cp.index = i\n          callback(cp)\n        }\n      }\n    } else {\n      for (let i = offset; i < end; ++i) {\n        cp.index = i\n        callback(cp)\n      }\n    }\n  }\n\n  //\n\n  qualifiedName () {\n    const name = '/' + this.index\n    return name\n  }\n\n  /**\n   * Clone object\n   * @return {ModelProxy} cloned model\n   */\n  clone () {\n    return new ModelProxy(this.structure, this.index)\n  }\n\n  toObject () {\n    return {\n      index: this.index,\n      chainOffset: this.chainOffset,\n      chainCount: this.chainCount\n    }\n  }\n}\n\nexport default ModelProxy\n","/**\n * @file Structure\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3 } from 'three'\nimport { Signal } from 'signals'\n\nimport { Debug, Log, ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { AtomPicker, BondPicker } from '../utils/picker'\nimport { copyWithin, arrayMin, arrayMax } from '../math/array-utils'\nimport BitArray from '../utils/bitarray'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport { Matrix } from '../math/matrix-utils'\nimport PrincipalAxes from '../math/principal-axes'\nimport SpatialHash from '../geometry/spatial-hash'\nimport FilteredVolume from '../surface/filtered-volume'\nimport StructureView from './structure-view'\nimport { AtomDataParams, AtomData, BondDataParams, BondData } from './structure-data'\nimport { Data, createData } from './data'\n\nimport Entity from './entity'\nimport Unitcell from '../symmetry/unitcell'\nimport Validation from './validation'\nimport Selection from '../selection/selection'\nimport Assembly from '../symmetry/assembly'\nimport Volume from '../surface/volume'\nimport Polymer from '../proxy/polymer'\n\nimport BondHash from '../store/bond-hash'\nimport BondStore from '../store/bond-store'\nimport AtomStore from '../store/atom-store'\nimport ResidueStore from '../store/residue-store'\nimport ChainStore from '../store/chain-store'\nimport ModelStore from '../store/model-store'\n\nimport AtomMap from '../store/atom-map'\nimport ResidueMap from '../store/residue-map'\n\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\ninterface Structure {\n  signals: StructureSignals\n\n  name: string\n  path: string\n  title: string\n  id: string\n\n  data: Data\n\n  atomCount: number\n  bondCount: number\n\n  header: StructureHeader\n  extraData: StructureExtraData\n\n  atomSetCache: { [k: string]: BitArray }\n  atomSetDict: { [k: string]: BitArray }\n  biomolDict: { [k: string]: Assembly }\n\n  entityList: Entity[]\n  unitcell?: Unitcell\n\n  frames: Float32Array[]\n  boxes: Float32Array[]\n\n  validation?: Validation\n\n  bondStore: BondStore\n  backboneBondStore: BondStore\n  rungBondStore: BondStore\n  atomStore: AtomStore\n  residueStore: ResidueStore\n  chainStore: ChainStore\n  modelStore: ModelStore\n\n  atomMap: AtomMap\n  residueMap: ResidueMap\n\n  bondHash?: BondHash\n  spatialHash?: SpatialHash\n\n  atomSet?: BitArray\n  bondSet?: BitArray\n\n  center: Vector3\n  boundingBox: Box3\n\n  trajectory?: {\n    name: string\n    frame: number\n  }\n\n  getView(selection: Selection): StructureView\n\n  _hasCoords?: boolean\n\n  _bp: BondProxy\n  _ap: AtomProxy\n  _rp: ResidueProxy\n  _cp: ChainProxy\n}\n\nexport type StructureHeader = {\n  releaseDate?: string\n  depositionDate?: string\n  resolution?: number\n  rFree?: number\n  rWork?: number\n  experimentalMethods?: string[]\n}\n\nexport type StructureExtraData = {\n  cif?: object\n  sdf?: object[]\n}\n\nexport type StructureSignals = {\n  refreshed: Signal\n}\n\n/**\n * Structure\n */\nclass Structure implements Structure{\n  signals: StructureSignals = {\n    refreshed: new Signal()\n  }\n\n  /**\n   * @param {String} name - structure name\n   * @param {String} path - source path\n   */\n  constructor (name = '', path = '') {\n    this.init(name, path)\n  }\n\n  init (name: string, path: string) {\n    this.name = name\n    this.path = path\n    this.title = ''\n    this.id = ''\n\n    this.data = createData(this)\n\n    this.header = {}\n    this.extraData = {}\n\n    this.atomSetCache = {}\n    this.atomSetDict = {}\n    this.biomolDict = {}\n\n    this.entityList = []\n    this.unitcell = undefined\n\n    this.frames = []\n    this.boxes = []\n\n    this.validation = undefined\n\n    this.bondStore = new BondStore(0)\n    this.backboneBondStore = new BondStore(0)\n    this.rungBondStore = new BondStore(0)\n    this.atomStore = new AtomStore(0)\n    this.residueStore = new ResidueStore(0)\n    this.chainStore = new ChainStore(0)\n    this.modelStore = new ModelStore(0)\n\n    this.atomMap = new AtomMap(this)\n    this.residueMap = new ResidueMap(this)\n\n    this.bondHash = undefined\n    this.spatialHash = undefined\n\n    this.atomSet = undefined\n    this.bondSet = undefined\n\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    this._bp = this.getBondProxy()\n    this._ap = this.getAtomProxy()\n    this._rp = this.getResidueProxy()\n    this._cp = this.getChainProxy()\n  }\n\n  get type () { return 'Structure' }\n\n  finalizeAtoms () {\n    this.atomSet = this.getAtomSet()\n    this.atomCount = this.atomStore.count\n    this.boundingBox = this.getBoundingBox(undefined, this.boundingBox)\n    this.center = this.boundingBox.getCenter(new Vector3())\n    this.spatialHash = new SpatialHash(this.atomStore, this.boundingBox)\n  }\n\n  finalizeBonds () {\n    this.bondSet = this.getBondSet()\n    this.bondCount = this.bondStore.count\n    this.bondHash = new BondHash(this.bondStore, this.atomStore.count)\n\n    this.atomSetCache = {}\n    if (!this.atomSetDict.rung) {\n      this.atomSetDict.rung = this.getAtomSet(false)\n    }\n\n    for (let name in this.atomSetDict) {\n      this.atomSetCache[ '__' + name ] = this.atomSetDict[ name ].clone()\n    }\n  }\n\n  //\n\n  getBondProxy (index?: number) {\n    return new BondProxy(this, index)\n  }\n\n  getAtomProxy (index?: number) {\n    return new AtomProxy(this, index)\n  }\n\n  getResidueProxy (index?: number) {\n    return new ResidueProxy(this, index)\n  }\n\n  getChainProxy (index?: number) {\n    return new ChainProxy(this, index)\n  }\n\n  getModelProxy (index?: number) {\n    return new ModelProxy(this, index)\n  }\n\n  //\n\n  getBondSet (/* selection */) {\n    // TODO implement selection parameter\n\n    const n = this.bondStore.count\n    const bondSet = new BitArray(n)\n    const atomSet = this.atomSet\n\n    if (atomSet) {\n      if (atomSet.isAllSet()) {\n        bondSet.setAll()\n      } else if (atomSet.isAllClear()) {\n        bondSet.clearAll()\n      } else {\n        const bp = this.getBondProxy()\n\n        for (let i = 0; i < n; ++i) {\n          bp.index = i\n          if (atomSet.isSet(bp.atomIndex1, bp.atomIndex2)) {\n            bondSet.set(bp.index)\n          }\n        }\n      }\n    } else {\n      bondSet.setAll()\n    }\n\n    return bondSet\n  }\n\n  getBackboneBondSet (/* selection */) {\n    // TODO implement selection parameter\n\n    const n = this.backboneBondStore.count\n    const backboneBondSet = new BitArray(n)\n    const backboneAtomSet = this.atomSetCache.__backbone\n\n    if (backboneAtomSet) {\n      const bp = this.getBondProxy()\n      bp.bondStore = this.backboneBondStore\n\n      for (let i = 0; i < n; ++i) {\n        bp.index = i\n        if (backboneAtomSet.isSet(bp.atomIndex1, bp.atomIndex2)) {\n          backboneBondSet.set(bp.index)\n        }\n      }\n    } else {\n      backboneBondSet.setAll()\n    }\n\n    return backboneBondSet\n  }\n\n  getRungBondSet (/* selection */) {\n    // TODO implement selection parameter\n\n    const n = this.rungBondStore.count\n    const rungBondSet = new BitArray(n)\n    const rungAtomSet = this.atomSetCache.__rung\n\n    if (rungAtomSet) {\n      const bp = this.getBondProxy()\n      bp.bondStore = this.rungBondStore\n\n      for (let i = 0; i < n; ++i) {\n        bp.index = i\n        if (rungAtomSet.isSet(bp.atomIndex1, bp.atomIndex2)) {\n          rungBondSet.set(bp.index)\n        }\n      }\n    } else {\n      rungBondSet.setAll()\n    }\n\n    return rungBondSet\n  }\n\n  /**\n   * Get a set of atoms\n   * @param  {Boolean|Selection|BitArray} selection - object defining how to\n   *                                      initialize the atom set.\n   *                                      Boolean: init with value;\n   *                                      Selection: init with selection;\n   *                                      BitArray: return bit array\n   * @return {BitArray} set of atoms\n   */\n  getAtomSet (selection?: boolean|Selection|BitArray) {\n    const n = this.atomStore.count\n\n    if (selection === undefined) {\n      return new BitArray(n, true)\n    } else if (selection instanceof BitArray) {\n      return selection\n    } else if (selection === true) {\n      return new BitArray(n, true)\n    } else if (selection && selection.test) {\n      const seleString = selection.string\n      if (seleString in this.atomSetCache) {\n        return this.atomSetCache[ seleString ]\n      } else {\n        if (seleString === '') {\n          return new BitArray(n, true)\n        } else {\n          const atomSet = new BitArray(n)\n          this.eachAtom(function (ap: AtomProxy) {\n            atomSet.set(ap.index)\n          }, selection)\n          this.atomSetCache[ seleString ] = atomSet\n          return atomSet\n        }\n      }\n    } else if (selection === false) {\n      return new BitArray(n)\n    }\n\n    return new BitArray(n, true)\n  }\n\n  /**\n   * Get set of atoms around a set of atoms from a selection\n   * @param  {Selection} selection - the selection object\n   * @param  {Number} radius - radius to select within\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinSelection (selection: boolean|Selection|BitArray, radius: number) {\n    const spatialHash = this.spatialHash\n    const atomSet = this.getAtomSet(false)\n    const ap = this.getAtomProxy()\n\n    if (!spatialHash) return atomSet\n\n    this.getAtomSet(selection).forEach(function (idx: number) {\n      ap.index = idx\n      spatialHash.within(ap.x, ap.y, ap.z, radius).forEach(function (idx2: number) {\n        atomSet.set(idx2)\n      })\n    })\n\n    return atomSet\n  }\n\n  /**\n   * Get set of atoms around a point\n   * @param  {Vector3|AtomProxy} point - the point\n   * @param  {Number} radius - radius to select within\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinPoint (point: Vector3|AtomProxy, radius: number) {\n    const p = point\n    const atomSet = this.getAtomSet(false)\n\n    if (!this.spatialHash) return atomSet\n\n    this.spatialHash.within(p.x, p.y, p.z, radius).forEach(function (idx: number) {\n      atomSet.set(idx)\n    })\n\n    return atomSet\n  }\n\n  /**\n   * Get set of atoms within a volume\n   * @param  {Volume} volume - the volume\n   * @param  {Number} radius - radius to select within\n   * @param  {[type]} minValue - minimum value to be considered as within the volume\n   * @param  {[type]} maxValue - maximum value to be considered as within the volume\n   * @param  {[type]} outside - use only values falling outside of the min/max values\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinVolume (volume: Volume, radius: number, minValue: number, maxValue: number, outside: boolean) {\n    const fv = new FilteredVolume(volume, minValue, maxValue, outside) as any  // TODO\n\n    const dp = fv.getDataPosition()\n    const n = dp.length\n    const r = fv.matrix.getMaxScaleOnAxis()\n    const atomSet = this.getAtomSet(false)\n\n    if (!this.spatialHash) return atomSet\n\n    for (let i = 0; i < n; i += 3) {\n      this.spatialHash.within(dp[ i ], dp[ i + 1 ], dp[ i + 2 ], r).forEach(function (idx) {\n        atomSet.set(idx)\n      })\n    }\n\n    return atomSet\n  }\n\n  /**\n   * Get set of all atoms within the groups of a selection\n   * @param  {Selection} selection - the selection object\n   * @return {BitArray} set of atoms\n   */\n  getAtomSetWithinGroup (selection: boolean|Selection) {\n    const atomResidueIndex = this.atomStore.residueIndex\n    const atomSet = this.getAtomSet(false)\n    const rp = this.getResidueProxy()\n\n    this.getAtomSet(selection).forEach(function (idx) {\n      rp.index = atomResidueIndex[ idx ]\n      for (let idx2 = rp.atomOffset; idx2 <= rp.atomEnd; ++idx2) {\n        atomSet.set(idx2)\n      }\n    })\n\n    return atomSet\n  }\n\n  //\n\n  getSelection (): undefined|Selection {\n    return\n  }\n\n  getStructure (): Structure|StructureView {\n    return this\n  }\n\n  /**\n   * Entity iterator\n   * @param  {function(entity: Entity)} callback - the callback\n   * @param  {EntityType} type - entity type\n   * @return {undefined}\n   */\n  eachEntity (callback: (entity: Entity) => void, type: number) {\n    this.entityList.forEach(function (entity) {\n      if (type === undefined || entity.getEntityType() === type) {\n        callback(entity)\n      }\n    })\n  }\n\n  /**\n   * Bond iterator\n   * @param  {function(bond: BondProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachBond (callback: (entity: BondProxy) => void, selection?: Selection) {\n    const bp = this.getBondProxy()\n    let bondSet\n\n    if (selection && selection.test) {\n      bondSet = this.getBondSet(/*selection*/)\n      if (this.bondSet) {\n        bondSet.intersection(this.bondSet)\n      }\n    }\n\n    if (bondSet) {\n      bondSet.forEach(function (index) {\n        bp.index = index\n        callback(bp)\n      })\n    } else {\n      const n = this.bondStore.count\n      for (let i = 0; i < n; ++i) {\n        bp.index = i\n        callback(bp)\n      }\n    }\n  }\n\n  /**\n   * Atom iterator\n   * @param  {function(atom: AtomProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachAtom (callback: (entity: AtomProxy) => void, selection?: Selection) {\n    if (selection && selection.test) {\n      this.eachModel(function (mp) {\n        mp.eachAtom(callback, selection)\n      }, selection)\n    } else {\n      const an = this.atomStore.count\n      const ap = this.getAtomProxy()\n      for (let i = 0; i < an; ++i) {\n        ap.index = i\n        callback(ap)\n      }\n    }\n  }\n\n  /**\n   * Residue iterator\n   * @param  {function(residue: ResidueProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachResidue (callback: (entity: ResidueProxy) => void, selection?: Selection) {\n    if (selection && selection.test) {\n      const mn = this.modelStore.count\n      const mp = this.getModelProxy()\n      const modelOnlyTest = selection.modelOnlyTest\n      if (modelOnlyTest) {\n        for (let i = 0; i < mn; ++i) {\n          mp.index = i\n          if (modelOnlyTest(mp)) {\n            mp.eachResidue(callback, selection)\n          }\n        }\n      } else {\n        for (let i = 0; i < mn; ++i) {\n          mp.index = i\n          mp.eachResidue(callback, selection)\n        }\n      }\n    } else {\n      const rn = this.residueStore.count\n      const rp = this.getResidueProxy()\n      for (let i = 0; i < rn; ++i) {\n        rp.index = i\n        callback(rp)\n      }\n    }\n  }\n\n  /**\n   * Multi-residue iterator\n   * @param {Integer} n - window size\n   * @param  {function(residueList: ResidueProxy[])} callback - the callback\n   * @return {undefined}\n   */\n  eachResidueN (n: number, callback: (...entityArray: ResidueProxy[]) => void) {\n    const rn = this.residueStore.count\n    if (rn < n) return\n    const array: ResidueProxy[] = new Array(n)\n\n    for (let i = 0; i < n; ++i) {\n      array[ i ] = this.getResidueProxy(i)\n    }\n    callback.apply(this, array)\n\n    for (let j = n; j < rn; ++j) {\n      for (let i = 0; i < n; ++i) {\n        array[ i ].index += 1\n      }\n      callback.apply(this, array)\n    }\n  }\n\n  /**\n   * Polymer iterator\n   * @param  {function(polymer: Polymer)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachPolymer (callback: (entity: Polymer) => void, selection?: Selection) {\n    if (selection && selection.modelOnlyTest) {\n      const modelOnlyTest = selection.modelOnlyTest\n\n      this.eachModel(function (mp) {\n        if (modelOnlyTest(mp)) {\n          mp.eachPolymer(callback, selection)\n        }\n      })\n    } else {\n      this.eachModel(function (mp) {\n        mp.eachPolymer(callback, selection)\n      })\n    }\n  }\n\n  /**\n   * Chain iterator\n   * @param  {function(chain: ChainProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachChain (callback: (entity: ChainProxy) => void, selection?: Selection) {\n    if (selection && selection.test) {\n      this.eachModel(function (mp) {\n        mp.eachChain(callback, selection)\n      })\n    } else {\n      const cn = this.chainStore.count\n      const cp = this.getChainProxy()\n      for (let i = 0; i < cn; ++i) {\n        cp.index = i\n        callback(cp)\n      }\n    }\n  }\n\n  /**\n   * Model iterator\n   * @param  {function(model: ModelProxy)} callback - the callback\n   * @param  {Selection} [selection] - the selection\n   * @return {undefined}\n   */\n  eachModel (callback: (entity: ModelProxy) => void, selection?: Selection) {\n    const n = this.modelStore.count\n    const mp = this.getModelProxy()\n\n    if (selection && selection.test) {\n      const modelOnlyTest = selection.modelOnlyTest\n      if (modelOnlyTest) {\n        for (let i = 0; i < n; ++i) {\n          mp.index = i\n          if (modelOnlyTest(mp)) {\n            callback(mp)\n          }\n        }\n      } else {\n        for (let i = 0; i < n; ++i) {\n          mp.index = i\n          callback(mp)\n        }\n      }\n    } else {\n      for (let i = 0; i < n; ++i) {\n        mp.index = i\n        callback(mp)\n      }\n    }\n  }\n\n  //\n\n  getAtomData (params: AtomDataParams) {\n    const p = Object.assign({}, params)\n    if (p.colorParams) p.colorParams.structure = this.getStructure()\n\n    const what = p.what\n    const atomSet = defaults(p.atomSet, this.atomSet)\n\n    let radiusFactory: any  // TODO\n    let colormaker: any  // TODO\n\n    const atomData: AtomData = {}\n    const ap = this.getAtomProxy()\n    const atomCount = atomSet.getSize()\n\n    if (!what || what.position) {\n      atomData.position = new Float32Array(atomCount * 3)\n    }\n    if ((!what || what.color) && p.colorParams) {\n      atomData.color = new Float32Array(atomCount * 3)\n      colormaker = ColormakerRegistry.getScheme(p.colorParams)\n    }\n    if (!what || what.picking) {\n      atomData.picking = new AtomPicker(new Float32Array(atomCount), this.getStructure())\n    }\n    if (!what || what.radius) {\n      atomData.radius = new Float32Array(atomCount)\n      radiusFactory = new RadiusFactory(p.radiusParams as RadiusParams)\n    }\n    if (!what || what.index) {\n      atomData.index = new Uint32Array(atomCount)\n    }\n\n    const {position, color, picking, radius, index} = atomData\n\n    atomSet.forEach((idx: number, i: number) => {\n      const i3 = i * 3\n      ap.index = idx\n      if (position) {\n        ap.positionToArray(position, i3)\n      }\n      if (color) {\n        colormaker.atomColorToArray(ap, color, i3)\n      }\n      if (picking) {\n        picking.array![ i ] = idx\n      }\n      if (radius) {\n        radius[ i ] = radiusFactory.atomRadius(ap)\n      }\n      if (index) {\n        index[ i ] = idx\n      }\n    })\n    return atomData\n  }\n\n  getBondData (params: BondDataParams) {\n    const p = Object.assign({}, params)\n    if (p.colorParams) p.colorParams.structure = this.getStructure()\n\n    const what = p.what\n    const bondSet = defaults(p.bondSet, this.bondSet)\n    const multipleBond = defaults(p.multipleBond, 'off')\n    const isMulti = multipleBond !== 'off'\n    const isOffset = multipleBond === 'offset'\n    const bondScale = defaults(p.bondScale, 0.4)\n    const bondSpacing = defaults(p.bondSpacing, 1.0)\n\n    let radiusFactory: any  // TODO\n    let colormaker: any  // TODO\n\n    const bondData: BondData = {}\n    const bp = this.getBondProxy()\n    if (p.bondStore) bp.bondStore = p.bondStore\n    const ap1 = this.getAtomProxy()\n    const ap2 = this.getAtomProxy()\n\n    let bondCount: number\n    if (isMulti) {\n      const storeBondOrder = bp.bondStore.bondOrder\n      bondCount = 0\n      bondSet.forEach(function (index: number) {\n        bondCount += storeBondOrder[ index ]\n      })\n    } else {\n      bondCount = bondSet.getSize()\n    }\n\n    if (!what || what.position) {\n      bondData.position1 = new Float32Array(bondCount * 3)\n      bondData.position2 = new Float32Array(bondCount * 3)\n    }\n    if ((!what || what.color) && p.colorParams) {\n      bondData.color = new Float32Array(bondCount * 3)\n      bondData.color2 = new Float32Array(bondCount * 3)\n      colormaker = ColormakerRegistry.getScheme(p.colorParams)\n    }\n    if (!what || what.picking) {\n      bondData.picking = new BondPicker(new Float32Array(bondCount), this.getStructure(), p.bondStore)\n    }\n    if (!what || what.radius || (isMulti && what.position)) {\n      radiusFactory = new RadiusFactory(p.radiusParams as RadiusParams)\n    }\n    if (!what || what.radius) {\n      bondData.radius = new Float32Array(bondCount)\n      if (p.radius2) {\n        bondData.radius2 = new Float32Array(bondCount)\n      }\n    }\n\n    const {position1, position2, color, color2, picking, radius, radius2} = bondData\n\n    let i = 0\n    let j, i3, k, bondOrder, absOffset\n    let multiRadius\n\n    const vt = new Vector3()\n    const vShortening = new Vector3()\n    const vShift = new Vector3()\n\n    bondSet.forEach((index: number) => {\n      i3 = i * 3\n      bp.index = index\n      ap1.index = bp.atomIndex1\n      ap2.index = bp.atomIndex2\n      bondOrder = bp.bondOrder\n      if (position1) {\n        if (isMulti && bondOrder > 1) {\n          const atomRadius = radiusFactory.atomRadius(ap1)\n          multiRadius = atomRadius * bondScale / (0.5 * bondOrder)\n\n          bp.calculateShiftDir(vShift)\n\n          if (isOffset) {\n            absOffset = 2 * bondSpacing * atomRadius\n            vShift.multiplyScalar(absOffset)\n            vShift.negate()\n\n            // Shortening is calculated so that neighbouring double\n            // bonds on tetrahedral geometry (e.g. sulphonamide)\n            // are not quite touching (arccos(1.9 / 2) ~ 109deg)\n            // but don't shorten beyond 10% each end or it looks odd\n            vShortening.subVectors(ap2 as any, ap1 as any).multiplyScalar(  // TODO\n              Math.max(0.1, absOffset / 1.88)\n            )\n            ap1.positionToArray(position1, i3)\n            ap2.positionToArray(position2, i3)\n\n            if (bondOrder >= 2) {\n              vt.addVectors(ap1 as any, vShift).add(vShortening).toArray(position1 as any, i3 + 3)  // TODO\n              vt.addVectors(ap2 as any, vShift).sub(vShortening).toArray(position2 as any, i3 + 3)  // TODO\n\n              if (bondOrder >= 3) {\n                vt.subVectors(ap1 as any, vShift).add(vShortening).toArray(position1 as any, i3 + 6)  // TODO\n                vt.subVectors(ap2 as any, vShift).sub(vShortening).toArray(position2 as any, i3 + 6)  // TODO\n              }\n            }\n          } else {\n            absOffset = (bondSpacing - bondScale) * atomRadius\n            vShift.multiplyScalar(absOffset)\n\n            if (bondOrder === 2) {\n              vt.addVectors(ap1 as any, vShift).toArray(position1 as any, i3)  // TODO\n              vt.subVectors(ap1 as any, vShift).toArray(position1 as any, i3 + 3)  // TODO\n              vt.addVectors(ap2 as any, vShift).toArray(position2 as any, i3)  // TODO\n              vt.subVectors(ap2 as any, vShift).toArray(position2 as any, i3 + 3)  // TODO\n            } else if (bondOrder === 3) {\n              ap1.positionToArray(position1, i3)\n              vt.addVectors(ap1 as any, vShift).toArray(position1 as any, i3 + 3)  // TODO\n              vt.subVectors(ap1 as any, vShift).toArray(position1 as any, i3 + 6)  // TODO\n              ap2.positionToArray(position2, i3)\n              vt.addVectors(ap2 as any, vShift).toArray(position2 as any, i3 + 3)  // TODO\n              vt.subVectors(ap2 as any, vShift).toArray(position2 as any, i3 + 6)  // TODO\n            } else {\n              // todo, better fallback\n              ap1.positionToArray(position1, i3)\n              ap2.positionToArray(position2, i3)\n            }\n          }\n        } else {\n          ap1.positionToArray(position1, i3)\n          ap2.positionToArray(position2, i3)\n        }\n      }\n      if (color && color2) {\n        colormaker.bondColorToArray(bp, 1, color, i3)\n        colormaker.bondColorToArray(bp, 0, color2, i3)\n        if (isMulti && bondOrder > 1) {\n          for (j = 1; j < bondOrder; ++j) {\n            k = j * 3 + i3\n            copyWithin(color, i3, k, 3)\n            copyWithin(color2, i3, k, 3)\n          }\n        }\n      }\n      if (picking && picking.array) {\n        picking.array[ i ] = index\n        if (isMulti && bondOrder > 1) {\n          for (j = 1; j < bondOrder; ++j) {\n            picking.array[ i + j ] = index\n          }\n        }\n      }\n      if (radius) {\n        radius[ i ] = radiusFactory.atomRadius(ap1)\n        if (isMulti && bondOrder > 1) {\n          multiRadius = radius[ i ] * bondScale / (isOffset ? 1 : (0.5 * bondOrder))\n          for (j = isOffset ? 1 : 0; j < bondOrder; ++j) {\n            radius[ i + j ] = multiRadius\n          }\n        }\n      }\n      if (radius2) {\n        radius2[ i ] = radiusFactory.atomRadius(ap2)\n        if (isMulti && bondOrder > 1) {\n          multiRadius = radius2[ i ] * bondScale / (isOffset ? 1 : (0.5 * bondOrder))\n          for (j = isOffset ? 1 : 0; j < bondOrder; ++j) {\n            radius2[ i + j ] = multiRadius\n          }\n        }\n      }\n      i += isMulti ? bondOrder : 1\n    })\n\n    return bondData\n  }\n\n  getBackboneAtomData (params: AtomDataParams) {\n    params = Object.assign({\n      atomSet: this.atomSetCache.__backbone\n    }, params)\n\n    return this.getAtomData(params)\n  }\n\n  getBackboneBondData (params: BondDataParams) {\n    params = Object.assign({\n      bondSet: this.getBackboneBondSet(),\n      bondStore: this.backboneBondStore\n    }, params)\n\n    return this.getBondData(params)\n  }\n\n  getRungAtomData (params: AtomDataParams) {\n    params = Object.assign({\n      atomSet: this.atomSetCache.__rung\n    }, params)\n\n    return this.getAtomData(params)\n  }\n\n  getRungBondData (params: BondDataParams) {\n    params = Object.assign({\n      bondSet: this.getRungBondSet(),\n      bondStore: this.rungBondStore\n    }, params)\n\n    return this.getBondData(params)\n  }\n\n  //\n\n  /**\n   * Gets the bounding box of the (selected) structure atoms\n   * @param  {Selection} [selection] - the selection\n   * @param  {Box3} [box] - optional target\n   * @return {Vector3} the box\n   */\n  getBoundingBox (selection?: Selection, box?: Box3) {\n    if (Debug) Log.time('getBoundingBox')\n\n    box = box || new Box3()\n\n    let minX = +Infinity\n    let minY = +Infinity\n    let minZ = +Infinity\n\n    let maxX = -Infinity\n    let maxY = -Infinity\n    let maxZ = -Infinity\n\n    this.eachAtom(ap => {\n      const x = ap.x\n      const y = ap.y\n      const z = ap.z\n\n      if (x < minX) minX = x\n      if (y < minY) minY = y\n      if (z < minZ) minZ = z\n\n      if (x > maxX) maxX = x\n      if (y > maxY) maxY = y\n      if (z > maxZ) maxZ = z\n    }, selection)\n\n    box.min.set(minX, minY, minZ)\n    box.max.set(maxX, maxY, maxZ)\n\n    if (Debug) Log.timeEnd('getBoundingBox')\n\n    return box\n  }\n\n  /**\n   * Gets the principal axes of the (selected) structure atoms\n   * @param  {Selection} [selection] - the selection\n   * @return {PrincipalAxes} the principal axes\n   */\n  getPrincipalAxes (selection?: Selection) {\n    if (Debug) Log.time('getPrincipalAxes')\n\n    let i = 0\n    const coords = new Matrix(3, this.atomCount)\n    const cd = coords.data\n\n    this.eachAtom(a => {\n      cd[ i + 0 ] = a.x\n      cd[ i + 1 ] = a.y\n      cd[ i + 2 ] = a.z\n      i += 3\n    }, selection)\n\n    if (Debug) Log.timeEnd('getPrincipalAxes')\n\n    return new PrincipalAxes(coords)\n  }\n\n  /**\n   * Gets the center of the (selected) structure atoms\n   * @param  {Selection} [selection] - the selection\n   * @return {Vector3} the center\n   */\n  atomCenter (selection?: Selection) {\n    if (selection) {\n      return this.getBoundingBox(selection).getCenter(new Vector3())\n    } else {\n      return this.center.clone()\n    }\n  }\n\n  hasCoords () {\n    if (this._hasCoords === undefined) {\n      const atomStore = this.atomStore\n      this._hasCoords = (\n        arrayMin(atomStore.x) !== 0 || arrayMax(atomStore.x) !== 0 ||\n        arrayMin(atomStore.y) !== 0 || arrayMax(atomStore.y) !== 0 ||\n        arrayMin(atomStore.z) !== 0 || arrayMax(atomStore.z) !== 0\n      ) || (\n        // allow models with a single atom at the origin\n        atomStore.count / this.modelStore.count === 1\n      )\n    }\n    return this._hasCoords;\n  }\n\n  getSequence (selection?: Selection) {\n    const seq: string[] = []\n    const rp = this.getResidueProxy()\n\n    this.eachAtom(function (ap: AtomProxy) {\n      rp.index = ap.residueIndex\n      if (ap.index === rp.traceAtomIndex) {\n        seq.push(rp.getResname1())\n      }\n    }, selection)\n\n    return seq\n  }\n\n  getAtomIndices (selection?: Selection) {\n    if (selection && selection.string) {\n      const indices: number[] = []\n      this.eachAtom(function (ap: AtomProxy) {\n        indices.push(ap.index)\n      }, selection)\n      return new Uint32Array(indices)\n    } else {\n      const p = { what: { index: true } }\n      return this.getAtomData(p).index\n    }\n  }\n\n  /**\n   * Get number of unique chainnames\n   * @param  {Selection} selection - limit count to selection\n   * @return {Integer} count\n   */\n  getChainnameCount (selection?: Selection) {\n    const chainnames = new Set()\n    this.eachChain(function (cp: ChainProxy) {\n      if (cp.residueCount) {\n        chainnames.add(cp.chainname)\n      }\n    }, selection)\n\n    return chainnames.size\n  }\n\n  //\n\n  updatePosition (position: Float32Array|number[]) {\n    let i = 0\n\n    this.eachAtom(function (ap: AtomProxy) {\n      ap.positionFromArray(position, i)\n      i += 3\n    }, undefined)\n\n    this._hasCoords = undefined  // to trigger recalculation\n  }\n\n  refreshPosition () {\n    this.getBoundingBox(undefined, this.boundingBox)\n    this.boundingBox.getCenter(this.center)\n    this.spatialHash = new SpatialHash(this.atomStore, this.boundingBox)\n  }\n\n  /**\n   * Calls dispose() method of property objects.\n   * Unsets properties to help garbage collection.\n   * @return {undefined}\n   */\n  dispose () {\n    if (this.frames) this.frames.length = 0\n    if (this.boxes) this.boxes.length = 0\n\n    this.bondStore.dispose()\n    this.backboneBondStore.dispose()\n    this.rungBondStore.dispose()\n    this.atomStore.dispose()\n    this.residueStore.dispose()\n    this.chainStore.dispose()\n    this.modelStore.dispose()\n\n    // can't delete non-optional properties as of TS 4\n    // and since we've already disposed them, don't need to.\n\n    delete this.bondSet\n    delete this.atomSet\n  }\n}\n\nexport default Structure\n","/**\n * @file Shape\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Matrix4 required for declaration only\nimport { Box3, Vector3, Color, Matrix4 } from 'three'\n\nimport { createParams, ensureFloat32Array, getUintArray } from '../utils'\nimport {\n  ArrowPrimitive, BoxPrimitive, ConePrimitive, CylinderPrimitive, EllipsoidPrimitive,\n  OctahedronPrimitive, SpherePrimitive, TetrahedronPrimitive, TextPrimitive,\n  TorusPrimitive, PointPrimitive, WidelinePrimitive\n} from './primitive'\nimport { MeshPicker } from '../utils/picker'\nimport Buffer from '../buffer/buffer'\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport { TextBufferParameters } from '../buffer/text-buffer'\n\nconst tmpBox = new Box3()\n\nconst Primitives = [\n  ArrowPrimitive, BoxPrimitive, ConePrimitive, CylinderPrimitive,\n  EllipsoidPrimitive, OctahedronPrimitive, SpherePrimitive, TetrahedronPrimitive,\n  TextPrimitive, TorusPrimitive, PointPrimitive, WidelinePrimitive\n]\n\nexport const ShapeDefaultParameters = {\n  aspectRatio: 1.5,\n  sphereDetail: 2,\n  radialSegments: 50,\n  disableImpostor: false,\n  openEnded: false,\n  dashedCylinder: false,\n  labelParams: {} as Partial<TextBufferParameters>,\n  pointSize: 2,\n  sizeAttenuation: false,\n  useTexture: true,\n  linewidth: 2\n}\nexport type ShapeParameters = typeof ShapeDefaultParameters\n\n/**\n * Class for building custom shapes.\n *\n * @example\n * var shape = new NGL.Shape('shape', { disableImpostor: true });\n * shape.addSphere([ 0, 0, 9 ], [ 1, 0, 0 ], 1.5 );\n * shape.addEllipsoid([ 6, 0, 0 ], [ 1, 0, 0 ], 1.5, [ 3, 0, 0 ], [ 0, 2, 0 ]);\n * shape.addCylinder([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ], 0.5);\n * shape.addCone([ 0, 2, 7 ], [ 0, 3, 3 ], [ 1, 1, 0 ], 1.5);\n * shape.addArrow([ 1, 2, 7 ], [ 30, 3, 3 ], [ 1, 0, 1 ], 1.0);\n * shape.addBox([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n * var shapeComp = stage.addComponentFromObject(shape);\n * geoComp.addRepresentation('buffer');\n */\nclass Shape {\n  name: string\n  parameters: ShapeParameters\n\n  boundingBox = new Box3()\n  bufferList: Buffer[] = []\n  meshCount = 0\n\n  _center?: Vector3\n  _primitiveData: { [k: string]: any } = {}\n\n  /**\n   * @param {String} name - name\n   * @param {Object} params - parameter object\n   * @param {Integer} params.aspectRatio - arrow aspect ratio, used for cylinder radius and cone length\n   * @param {Integer} params.sphereDetail - sphere quality (icosahedron subdivisions)\n   * @param {Integer} params.radialSegments - cylinder quality (number of segments)\n   * @param {Boolean} params.disableImpostor - disable use of raycasted impostors for rendering\n   * @param {Boolean} params.openEnded - capped or not\n   * @param {TextBufferParameters} params.labelParams - label parameters\n   */\n  constructor (name = 'shape', params: Partial<ShapeParameters> = {}) {\n    this.name = name\n\n    this.parameters = createParams(params, ShapeDefaultParameters)\n\n    Primitives.forEach(P => {\n      Object.keys(P.fields).forEach(name => {\n        this._primitiveData[ P.getShapeKey(name) ] = []\n      })\n      this._primitiveData[ P.getShapeKey('name') ] = []\n    })\n  }\n\n  /**\n   * Add a buffer\n   * @param {Buffer} buffer - buffer object\n   * @return {Shape} this object\n   */\n  addBuffer (buffer: Buffer) {\n    this.bufferList.push(buffer)\n\n    const geometry = (buffer as any).geometry  // TODO\n    if (!geometry.boundingBox) {\n      geometry.computeBoundingBox()\n    }\n    this.boundingBox.union(geometry.boundingBox)\n\n    return this\n  }\n\n  /**\n   * Add a mesh\n   * @example\n   * shape.addMesh(\n   *   [ 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1 ],\n   *   [ 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0 ]\n   * );\n   *\n   * @param {Float32Array|Array} position - positions\n   * @param {Float32Array|Array} color - colors\n   * @param {Uint32Array|Uint16Array|Array} [index] - indices\n   * @param {Float32Array|Array} [normal] - normals\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addMesh (position: Float32Array|number[], color:Float32Array|number[], index: Uint32Array|Uint16Array|number[], normal?: Float32Array|number[], name?: string) {\n    position = ensureFloat32Array(position)\n    color = ensureFloat32Array(color)\n\n    if (Array.isArray(index)) {\n      index = getUintArray(index, position.length)\n    }\n    if (normal) {\n      normal = ensureFloat32Array(normal)\n    }\n\n    let data\n    if (normal === undefined || normal.length == 0 ) {\n      data = { position, color, index }\n    } else {\n      data = { position, color, index, normal }\n    }\n    //const data = { position, color, index, normal }\n    const picking = new MeshPicker(\n      this, Object.assign({ serial: this.meshCount, name }, data)\n    )\n    const meshBuffer = new MeshBuffer(\n      Object.assign({ picking }, data) as any\n    )\n    this.bufferList.push(meshBuffer)\n\n    tmpBox.setFromArray(position)\n    this.boundingBox.union(tmpBox)\n    this.meshCount += 1\n\n    return this\n  }\n\n  /**\n   * Add a sphere\n   * @example\n   * shape.addSphere([ 0, 0, 9 ], [ 1, 0, 0 ], 1.5);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addSphere (position: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    SpherePrimitive.objectToShape(\n      this, { position, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an ellipsoid\n   * @example\n   * shape.addEllipsoid([ 6, 0, 0 ], [ 1, 0, 0 ], 1.5, [ 3, 0, 0 ], [ 0, 2, 0 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {Vector3|Array} majorAxis - major axis vector or array\n   * @param {Vector3|Array} minorAxis - minor axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addEllipsoid (position: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, majorAxis: Vector3|[number, number, number], minorAxis: Vector3|[number, number, number], name: string) {\n    EllipsoidPrimitive.objectToShape(\n      this, { position, color, radius, majorAxis, minorAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a torus\n   * @example\n   * shape.addTorus([ 6, 0, 0 ], [ 1, 0, 0 ], 1.5, [ 3, 0, 0 ], [ 0, 2, 0 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {Vector3|Array} majorAxis - major axis vector or array\n   * @param {Vector3|Array} minorAxis - minor axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addTorus (position: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, majorAxis: Vector3|[number, number, number], minorAxis: Vector3|[number, number, number], name: string) {\n    TorusPrimitive.objectToShape(\n      this, { position, color, radius, majorAxis, minorAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a cylinder\n   * @example\n   * shape.addCylinder([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ], 0.5);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addCylinder (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    CylinderPrimitive.objectToShape(\n      this, { position1, position2, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a cone\n   * @example\n   * shape.addCone([ 0, 2, 7 ], [ 0, 3, 3 ], [ 1, 1, 0 ], 1.5);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addCone (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    ConePrimitive.objectToShape(\n      this, { position1, position2, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an arrow\n   * @example\n   * shape.addArrow([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ], 0.5);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} radius - radius value\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addArrow (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], radius: number, name: string) {\n    ArrowPrimitive.objectToShape(\n      this, { position1, position2, color, radius, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a box\n   * @example\n   * shape.addBox([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addBox (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    BoxPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add an octahedron\n   * @example\n   * shape.addOctahedron([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addOctahedron (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    OctahedronPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a tetrahedron\n   * @example\n   * shape.addTetrahedron([ 0, 3, 0 ], [ 1, 0, 1 ], 2, [ 0, 1, 1 ], [ 1, 0, 1 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {Vector3|Array} heightAxis - height axis vector or array\n   * @param {Vector3|Array} depthAxis - depth axis vector or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addTetrahedron (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, heightAxis: Vector3|[number, number, number], depthAxis: Vector3|[number, number, number], name: string) {\n    TetrahedronPrimitive.objectToShape(\n      this, { position, color, size, heightAxis, depthAxis, name }\n    )\n    return this\n  }\n\n  /**\n   * Add text\n   * @example\n   * shape.addText([ 10, -2, 4 ], [ 0.2, 0.5, 0.8 ], 0.5, \"Hello\");\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {Float} size - size value\n   * @param {String} text - text value\n   * @return {Shape} this object\n   */\n  addText (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, text: string) {\n    TextPrimitive.objectToShape(\n      this, { position, color, size, text }\n    )\n    return this\n  }\n\n  /**\n   * Add point\n   * @example\n   * shape.addPoint([ 10, -2, 4 ], [ 0.2, 0.5, 0.8 ]);\n   *\n   * @param {Vector3|Array} position - position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addPoint (position: Vector3|[number, number, number], color: Color|[number, number, number], name: string) {\n    PointPrimitive.objectToShape(\n      this, { position, color, name }\n    )\n    return this\n  }\n\n  /**\n   * Add a wideline\n   * @example\n   * shape.addWideline([ 0, 2, 7 ], [ 0, 0, 9 ], [ 1, 1, 0 ]);\n   *\n   * @param {Vector3|Array} position1 - from position vector or array\n   * @param {Vector3|Array} position2 - to position vector or array\n   * @param {Color|Array} color - color object or array\n   * @param {String} [name] - text\n   * @return {Shape} this object\n   */\n  addWideline (position1: Vector3|[number, number, number], position2: Vector3|[number, number, number], color: Color|[number, number, number], linewidth: number, name: string) {\n    this.parameters.linewidth = linewidth\n    WidelinePrimitive.objectToShape(\n      this, { position1, position2, color, name }\n    )\n    return this\n  }\n\n  /**\n   * Deprecated, use `.addText`\n   */\n  addLabel (position: Vector3|[number, number, number], color: Color|[number, number, number], size: number, text: string) {\n    console.warn('Shape.addLabel is deprecated, use .addText instead')\n    return this.addText(position, color, size, text)\n  }\n\n  getBufferList () {\n    const buffers: Buffer[] = []\n\n    Primitives.forEach(P => {\n      if (this._primitiveData[ P.getShapeKey('color') ].length) {\n        buffers.push(P.bufferFromShape(this, this.parameters))\n      }\n    })\n\n    return this.bufferList.concat(buffers)\n  }\n\n  dispose () {\n    this.bufferList.forEach(function (buffer) {\n      buffer.dispose()\n    })\n    this.bufferList.length = 0\n\n    Primitives.forEach(P => {\n      Object.keys(P.fields).forEach(name => {\n        this._primitiveData[ P.getShapeKey(name) ].length = 0\n      })\n      this._primitiveData[ P.getShapeKey('name') ].length = 0\n    })\n  }\n\n  get center () {\n    if (!this._center) {\n      this._center = this.boundingBox.getCenter(new Vector3())\n    }\n    return this._center\n  }\n\n  get type () { return 'Shape' }\n}\n\nexport default Shape\n","/**\n * @file Buffer Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Representation, { RepresentationParameters } from './representation'\nimport Viewer from '../viewer/viewer';\n\n/**\n * Representation for showing buffer objects. Good for efficiently showing\n * large amounts of geometric primitives e.g. spheres via {@link SphereBuffer}.\n * Smaller numbers of geometric primitives are more easily shown with help\n * from the {@link Shape} class.\n *\n * __Name:__ _buffer_\n *\n * @example\n * // add a single red sphere from a buffer to a shape instance\n * var shape = new NGL.Shape( \"shape\" );\n * var sphereBuffer = new NGL.SphereBuffer( {\n *     position: new Float32Array( [ 0, 0, 0 ] ),\n *     color: new Float32Array( [ 1, 0, 0 ] ),\n *     radius: new Float32Array( [ 1 ] )\n * } );\n * shape.addBuffer( sphereBuffer );\n * var shapeComp = stage.addComponentFromObject( shape );\n * shapeComp.addRepresentation( \"buffer\" );\n *\n * @example\n * // add a single red sphere from a buffer to a structure component instance\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     var sphereBuffer = new NGL.SphereBuffer( {\n *         position: new Float32Array( [ 0, 0, 0 ] ),\n *         color: new Float32Array( [ 1, 0, 0 ] ),\n *         radius: new Float32Array( [ 1 ] )\n *     } );\n *     o.addBufferRepresentation( sphereBuffer, { opacity: 0.5 } );\n * } );\n */\nclass BufferRepresentation extends Representation {\n  buffer: Buffer[]\n  /**\n   * Create Buffer representation\n   * @param {Buffer} buffer - a buffer object\n   * @param {Viewer} viewer - a viewer object\n   * @param {RepresentationParameters} params - representation parameters\n   */\n  constructor (buffer: Buffer|Buffer[], viewer: Viewer, params: Partial<RepresentationParameters>) {\n    if (!Array.isArray(buffer)) {\n      buffer = [ buffer ]\n    }\n\n    super(buffer, viewer, params)\n\n    this.type = 'buffer'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n\n      colorScheme: null,\n      colorScale: null,\n      colorValue: null,\n      colorDomain: null,\n      colorMode: null\n\n    })\n\n    this.buffer = buffer\n\n    this.init(params)\n  }\n\n  init (params: Partial<RepresentationParameters>) {\n    super.init(params)\n\n    this.build()\n  }\n\n  create () {\n    this.bufferList.push.apply(this.bufferList, this.buffer)\n  }\n\n  attach (callback: ()=> void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n      buffer.setParameters(this.getBufferParams())\n    })\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n}\n\nexport default BufferRepresentation\n","/**\n * @file Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\n import {  Vector3, Matrix4, Matrix3, BufferGeometry } from 'three'\n\nimport { getUintArray } from '../utils'\nimport { serialBlockArray } from '../math/array-utils'\nimport { applyMatrix3toVector3array, applyMatrix4toVector3array } from '../math/vector-utils'\nimport MeshBuffer from './mesh-buffer'\nimport { BufferParameters, BufferData } from './buffer'\nimport {Log} from \"../globals\";\n\nconst matrix = new Matrix4()\nconst normalMatrix = new Matrix3()\n\nfunction getData(data: BufferData, geo: BufferGeometry){\n  const geoPosition = (geo.attributes as any).position.array\n  const geoIndex = geo.index ? geo.index.array : undefined\n\n  const n = data.position!.length / 3\n  const m = geoPosition.length / 3\n\n  const size = n * m\n\n  const meshPosition = new Float32Array(size * 3)\n  const meshNormal = new Float32Array(size * 3)\n  const meshColor = new Float32Array(size * 3)\n\n  let meshIndex\n  if (geoIndex) {\n    meshIndex = getUintArray(n * geoIndex.length, size)\n  }\n\n  return {\n    position: meshPosition,\n    color: meshColor,\n    index: meshIndex,\n    normal: meshNormal,\n    primitiveId: data.primitiveId || serialBlockArray(n, m) as Float32Array,\n    picking: data.picking\n  }\n}\n\n/**\n * Geometry buffer. Base class for geometry-based buffers. Used to draw\n * geometry primitives given a mesh.\n * @interface\n */\nabstract class GeometryBuffer extends MeshBuffer {\n  updateNormals = false\n\n  geoPosition: Float32Array\n  geoNormal: Float32Array\n  geoIndex?: Uint32Array|Uint16Array\n\n  positionCount: number\n  geoPositionCount: number\n\n  transformedGeoPosition: Float32Array\n  transformedGeoNormal: Float32Array\n\n  meshPosition: Float32Array\n  meshColor: Float32Array\n  meshIndex: Uint32Array|Uint16Array\n  meshNormal: Float32Array\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position - positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   * @param {BufferGeometry} geo - geometry object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}, geo: BufferGeometry) {\n    super(getData(data, geo), params)\n\n    const geoPosition = (geo.attributes as any).position.array\n    const geoNormal = (geo.attributes as any).normal.array\n    const geoIndex = geo.index ? (geo.index.array as Uint32Array|Uint16Array) : undefined\n\n    this.geoPosition = geoPosition\n    this.geoNormal = geoNormal\n    this.geoIndex = geoIndex\n\n    this.positionCount = data.position!.length / 3\n    this.geoPositionCount = geoPosition.length / 3\n\n    this.transformedGeoPosition = new Float32Array(this.geoPositionCount * 3)\n    this.transformedGeoNormal = new Float32Array(this.geoPositionCount * 3)\n\n    const attributes = this.geometry.attributes as any  // TODO\n    this.meshPosition = attributes.position.array\n    this.meshColor = attributes.color.array\n    this.meshNormal = attributes.normal.array\n\n    this.setAttributes(data)\n\n    if (geoIndex) {\n      const index = this.geometry.getIndex()\n      if (!index) { Log.error('Index is null'); return; }\n      this.meshIndex = index.array as Uint32Array|Uint16Array\n      this.makeIndex()\n    }\n  }\n\n  abstract applyPositionTransform (matrix: Matrix4, i: number, i3?: number): void\n\n  setAttributes (data: Partial<BufferData> = {}, initNormals = false) {\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let position, color\n    let geoPosition, geoNormal\n    let transformedGeoPosition, transformedGeoNormal\n    let meshPosition, meshColor, meshNormal\n\n    const updateNormals = this.updateNormals\n\n    if (data.position) {\n      position = data.position\n      geoPosition = this.geoPosition\n      meshPosition = this.meshPosition\n      transformedGeoPosition = this.transformedGeoPosition\n      attributes.position.needsUpdate = true\n      if (updateNormals || initNormals) {\n        geoNormal = this.geoNormal\n        meshNormal = this.meshNormal\n        transformedGeoNormal = this.transformedGeoNormal\n        attributes.normal.needsUpdate = true\n      }\n    }\n\n    if (data.color) {\n      color = data.color\n      meshColor = this.meshColor\n      attributes.color.needsUpdate = true\n    }\n\n    const n = this.positionCount\n    const m = this.geoPositionCount\n\n    for (let i = 0; i < n; ++i) {\n      let j, l\n      const k = i * m * 3\n      const i3 = i * 3\n\n      if (position && transformedGeoPosition && meshPosition && meshNormal && geoPosition && geoNormal) {\n        transformedGeoPosition.set(geoPosition)\n        matrix.makeTranslation(\n          position[ i3 ], position[ i3 + 1 ], position[ i3 + 2 ]\n        )\n        this.applyPositionTransform(matrix, i, i3)\n        applyMatrix4toVector3array(matrix.elements as unknown as Float32Array,\n                                   transformedGeoPosition)\n\n        meshPosition.set(transformedGeoPosition, k)\n\n        if (updateNormals && transformedGeoNormal) {\n          transformedGeoNormal.set(geoNormal)\n          normalMatrix.getNormalMatrix(matrix)\n          applyMatrix3toVector3array(normalMatrix.elements as unknown as Float32Array,\n                                     transformedGeoNormal)\n\n          meshNormal.set(transformedGeoNormal, k)\n        } else if (initNormals) {\n          meshNormal.set(geoNormal, k)\n        }\n      }\n\n      if (color && meshColor) {\n        for (j = 0; j < m; ++j) {\n          l = k + 3 * j\n\n          meshColor[ l ] = color[ i3 ]\n          meshColor[ l + 1 ] = color[ i3 + 1 ]\n          meshColor[ l + 2 ] = color[ i3 + 2 ]\n        }\n      }\n    }\n  }\n\n  makeIndex () {\n    const geoIndex = this.geoIndex\n    const meshIndex = this.meshIndex\n\n    if (!geoIndex) return\n\n    const n = this.positionCount\n    const m = this.geoPositionCount\n    const o = geoIndex.length / 3\n\n    const o3 = o * 3\n\n    for (let i = 0; i < n; ++i) {\n      const j = i * o3\n      const q = j + o3\n\n      meshIndex.set(geoIndex, j)\n      for (let p = j; p < q; ++p) meshIndex[ p ] += i * m\n    }\n  }\n}\n\nexport default GeometryBuffer\n","/**\n * @file Sphere Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { IcosahedronBufferGeometry, Vector3, Matrix4 } from 'three'\nimport { defaults } from '../utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { SphereBufferData } from './sphere-buffer'\nimport { BufferDefaultParameters } from './buffer'\n\nconst scale = new Vector3()\n\nexport const SphereGeometryBufferDefaultParameters = Object.assign({\n  sphereDetail: 1\n}, BufferDefaultParameters)\nexport type SphereGeometryBufferParameters = typeof SphereGeometryBufferDefaultParameters\n\n/**\n * Sphere geometry buffer.\n *\n * @example\n * var sphereGeometryBuffer = new SphereGeometryBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass SphereGeometryBuffer extends GeometryBuffer {\n  get defaultParameters() { return SphereGeometryBufferDefaultParameters }\n  parameters: SphereGeometryBufferParameters\n\n  private _radius: Float32Array\n\n  /**\n   * @param {Object} data - attribute object\n   * @param {Float32Array} data.position - positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} params - parameter object\n   */\n  constructor (data: SphereBufferData, params: Partial<SphereGeometryBufferParameters> = {}) {\n    super(data, params, new IcosahedronBufferGeometry(1, defaults(params.sphereDetail, 1)))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number) {\n    const r = this._radius[ i ]\n    scale.set(r, r, r)\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<SphereBufferData> = {}, initNormals?: boolean) {\n    if (data.radius) this._radius = data.radius\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nexport default SphereGeometryBuffer\n","/**\n * @file Mapped Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getUintArray } from '../utils'\nimport { calculateCenterArray, serialArray } from '../math/array-utils'\nimport Buffer, { BufferParameters, BufferData } from './buffer'\n\nexport type MappingType = 'v2'|'v3'\n\n/**\n * Mapped buffer. Sends mapping attribute to the GPU and repeats data in\n * others attributes. Used to render imposters.\n * @interface\n */\nabstract class MappedBuffer extends Buffer {\n  index: Uint32Array|Uint16Array\n\n  constructor (mappingType: MappingType, data: BufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params)\n\n    this.index = getUintArray(this.indexSize, this.attributeSize)\n    this.makeIndex()\n    this.initIndex(this.index)\n\n    this.addAttributes({\n      'mapping': { type: mappingType, value: null }\n    })\n\n    this.setAttributes({ primitiveId: serialArray(this.size) })\n  }\n\n  abstract get mapping (): Float32Array\n  abstract get mappingIndices (): Uint32Array|Uint16Array\n  abstract get mappingIndicesSize (): number\n  abstract get mappingSize (): number\n  abstract get mappingItemSize (): number\n\n  get attributeSize () {\n    return this.size * this.mappingSize\n  }\n\n  get indexSize () {\n    return this.size * this.mappingIndicesSize\n  }\n\n  addAttributes (attributes: any) {\n    const nullValueAttributes: any = {}\n    for (const name in attributes) {\n      const a = attributes[ name ]\n      nullValueAttributes[ name ] = {\n        type: a.type,\n        value: null\n      }\n    }\n\n    super.addAttributes(nullValueAttributes)\n  }\n\n  getAttributeIndex (dataIndex: number) {\n    return dataIndex * 3 * this.mappingSize\n  }\n\n  setAttributes (data: any) {  // TODO\n    if (data && !data.position && data.position1 && data.position2) {\n      data.position = calculateCenterArray(data.position1, data.position2)\n    }\n\n    const size = this.size\n    const mappingSize = this.mappingSize\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let a, d, itemSize, array, n, i, j\n\n    for (const name in data) {\n      if (name === 'index' || name === 'picking') continue\n\n      d = data[ name ]\n      a = attributes[ name ]\n      itemSize = a.itemSize\n      array = a.array\n\n      for (let k = 0; k < size; ++k) {\n        n = k * itemSize\n        i = n * mappingSize\n\n        for (let l = 0; l < mappingSize; ++l) {\n          j = i + (itemSize * l)\n\n          for (let m = 0; m < itemSize; ++m) {\n            array[ j + m ] = d[ n + m ]\n          }\n        }\n      }\n\n      a.needsUpdate = true\n    }\n  }\n\n  makeMapping () {\n    const size = this.size\n    const mapping = this.mapping\n    const mappingSize = this.mappingSize\n    const mappingItemSize = this.mappingItemSize\n\n    const attributes = this.geometry.attributes as any  // TODO\n    const aMapping = attributes.mapping.array\n\n    for (let v = 0; v < size; v++) {\n      aMapping.set(mapping, v * mappingItemSize * mappingSize)\n    }\n  }\n\n  makeIndex () {\n    const size = this.size\n    const mappingSize = this.mappingSize\n    const mappingIndices = this.mappingIndices\n    const mappingIndicesSize = this.mappingIndicesSize\n\n    const index = this.index\n\n    for (let v = 0; v < size; v++) {\n      const ix = v * mappingIndicesSize\n      const it = v * mappingSize\n\n      index.set(mappingIndices, ix)\n\n      for (let s = 0; s < mappingIndicesSize; ++s) {\n        index[ ix + s ] += it\n      }\n    }\n  }\n}\n\nexport default MappedBuffer\n","/**\n * @file Mapped Quad Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferParameters, BufferData } from './buffer'\nimport MappedBuffer from './mapped-buffer'\n\nconst mapping = new Float32Array([\n  -1.0, 1.0,\n  -1.0, -1.0,\n  1.0, 1.0,\n  1.0, -1.0\n])\n\nconst mappingIndices = new Uint16Array([\n  0, 1, 2,\n  1, 3, 2\n])\n\n/**\n * Mapped Quad buffer. Draws screen-aligned quads. Used to render impostors.\n * @interface\n */\nclass MappedQuadBuffer extends MappedBuffer {\n  constructor(data: BufferData, params: Partial<BufferParameters> = {}) {\n    super('v2', data, params)\n  }\n  get mapping () { return mapping }\n  get mappingIndices () { return mappingIndices }\n  get mappingIndicesSize () { return 6 }\n  get mappingSize () { return 4 }\n  get mappingItemSize () { return 2 }\n}\n\nexport default MappedQuadBuffer\n","/**\n * @file Sphere Impostor Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport '../shader/SphereImpostor.vert'\nimport '../shader/SphereImpostor.frag'\n\nimport MappedQuadBuffer from './mappedquad-buffer'\nimport { SphereBufferData } from './sphere-buffer'\nimport { BufferParameters } from './buffer'\n\n/**\n * Sphere impostor buffer.\n *\n * @example\n * var sphereImpostorBuffer = new SphereImpostorBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass SphereImpostorBuffer extends MappedQuadBuffer {\n  isImpostor = true\n  vertexShader = 'SphereImpostor.vert'\n  fragmentShader = 'SphereImpostor.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: SphereBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'projectionMatrixInverse': { value: new Matrix4() },\n      'ortho': { value: 0.0 }\n    })\n\n    this.addAttributes({\n      'radius': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n}\n\nexport default SphereImpostorBuffer\n","/**\n * @file Sphere Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only \nimport { Vector3, Matrix4 } from 'three'\nimport { BufferRegistry, ExtensionFragDepth } from '../globals'\nimport SphereGeometryBuffer, { SphereGeometryBufferDefaultParameters } from './spheregeometry-buffer'\nimport SphereImpostorBuffer from './sphereimpostor-buffer'\nimport { BufferData } from './buffer'\n\nexport interface SphereBufferData extends BufferData {\n  radius: Float32Array\n}\n\nexport const SphereBufferDefaultParameters = Object.assign({\n  disableImpostor: false\n}, SphereGeometryBufferDefaultParameters)\nexport type SphereBufferParameters = typeof SphereBufferDefaultParameters\n\n/**\n * Sphere buffer. Depending on the value {@link ExtensionFragDepth} and\n * `params.disableImpostor` the constructor returns either a\n * {@link SphereGeometryBuffer} or a {@link SphereImpostorBuffer}\n * @implements {Buffer}\n *\n * @example\n * var sphereBuffer = new SphereBuffer( {\n *     position: new Float32Array( [ 0, 0, 0 ] ),\n *     color: new Float32Array( [ 1, 0, 0 ] ),\n *     radius: new Float32Array( [ 1 ] )\n * } );\n */\nclass SphereBuffer {\n    /**\n     * @param {Object} data - buffer data\n     * @param {Float32Array} data.position - positions\n     * @param {Float32Array} data.color - colors\n     * @param {Float32Array} data.radius - radii\n     * @param {Picker} [data.picking] - picking ids\n     * @param {BufferParameters} params - parameters object\n     * @return {SphereGeometryBuffer|SphereImpostorBuffer} the buffer object\n     */\n  constructor (data: SphereBufferData, params: SphereBufferParameters) {\n    if (!ExtensionFragDepth || (params && params.disableImpostor)) {\n      return new SphereGeometryBuffer(data, params)\n    } else {\n      return new SphereImpostorBuffer(data, params)\n    }\n  }\n}\n\nBufferRegistry.add('sphere', SphereBuffer)\n\nexport default SphereBuffer\n","/**\n * @file Point Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { DataTexture, Vector3, Matrix4 } from 'three'\n\nimport '../shader/Point.vert'\nimport '../shader/Point.frag'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { smoothstep } from '../math/math-utils'\nimport Buffer, { BufferDefaultParameters, BufferParameterTypes, BufferData, BufferTypes } from './buffer'\n\nfunction distance (x0: number, y0: number, x1: number, y1: number) {\n  const dx = x1 - x0\n  const dy = y1 - y0\n  return Math.sqrt(dx * dx + dy * dy)\n}\n\ninterface PointTextureParams {\n  width?: number\n  height?: number\n  delta?: number\n}\n\nfunction makePointTexture (params: PointTextureParams) {\n  const p = params || {}\n\n  const width = defaults(p.width, 256)\n  const height = defaults(p.height, 256)\n  const center = [ width / 2, height / 2 ]\n  const radius = Math.min(width / 2, height / 2)\n  const delta = defaults(p.delta, 1 / (radius + 1)) * radius\n\n  let x = 0\n  let y = 0\n  const data = new Uint8Array(width * height * 4)\n\n  for (let i = 0, il = data.length; i < il; i += 4) {\n    const dist = distance(x, y, center[ 0 ], center[ 1 ])\n    const value = 1 - smoothstep(radius - delta, radius, dist)\n\n    data[ i ] = value * 255\n    data[ i + 1 ] = value * 255\n    data[ i + 2 ] = value * 255\n    data[ i + 3 ] = value * 255\n\n    if (++x === width) {\n      x = 0\n      y++\n    }\n  }\n\n  const tex = new DataTexture(data, width, height)\n  tex.needsUpdate = true\n\n  return tex\n}\n\nexport const PointBufferDefaultParameters = Object.assign({\n  pointSize: 1,\n  sizeAttenuation: true,\n  sortParticles: false,\n  alphaTest: 0.5,\n  useTexture: false,\n  forceTransparent: false,\n  edgeBleach: 0.0\n}, BufferDefaultParameters)\nexport type PointBufferParameters = typeof PointBufferDefaultParameters\n\nconst PointBufferParameterTypes = Object.assign({\n  pointSize: { uniform: 'size' },\n  sizeAttenuation: { updateShader: true },\n  sortParticles: {},\n  alphaTest: { updateShader: true },\n  useTexture: { updateShader: true },\n  forceTransparent: {},\n  edgeBleach: { uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Point buffer. Draws points. Optionally textured.\n *\n * @example\n * var pointBuffer = new PointBuffer( {\n *     position: new Float32Array( [ 0, 0, 0 ] ),\n *     color: new Float32Array( [ 1, 0, 0 ] )\n * } );\n */\nclass PointBuffer extends Buffer {\n  parameterTypes = PointBufferParameterTypes\n  get defaultParameters() { return PointBufferDefaultParameters }\n  parameters: PointBufferParameters\n\n  vertexShader = 'Point.vert'\n  fragmentShader ='Point.frag'\n\n  isPoint = true\n  tex: DataTexture\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: BufferData, params: Partial<PointBufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'size': { value: this.parameters.pointSize },\n      'canvasHeight': { value: 1.0 },\n      'pixelRatio': { value: 1.0 },\n      'map': { value: null }\n    })\n  }\n\n  makeMaterial () {\n    super.makeMaterial()\n\n    this.makeTexture()\n\n    const m = this.material\n    const wm = this.wireframeMaterial\n    const pm = this.pickingMaterial\n\n    m.uniforms.map.value = this.tex\n    m.needsUpdate = true\n\n    wm.uniforms.map.value = this.tex\n    wm.needsUpdate = true\n\n    pm.uniforms.map.value = this.tex\n    pm.needsUpdate = true\n  }\n\n  makeTexture () {\n    if (this.tex) this.tex.dispose()\n    this.tex = makePointTexture({ delta: this.parameters.edgeBleach })\n  }\n\n  getDefines (type?: BufferTypes) {\n    const defines = super.getDefines(type)\n\n    if (this.parameters.sizeAttenuation) {\n      defines.USE_SIZEATTENUATION = 1\n    }\n\n    if (this.parameters.useTexture) {\n      defines.USE_MAP = 1\n    }\n\n    if (this.parameters.alphaTest > 0 && this.parameters.alphaTest <= 1) {\n      defines.ALPHATEST = this.parameters.alphaTest.toPrecision(2)\n    }\n\n    return defines\n  }\n\n  setUniforms (data: any) {\n    if (data && data.edgeBleach !== undefined) {\n      this.makeTexture()\n      data.map = this.tex\n    }\n\n    super.setUniforms(data)\n  }\n\n  dispose () {\n    super.dispose()\n\n    if (this.tex) this.tex.dispose()\n  }\n}\n\nBufferRegistry.add('point', PointBuffer)\n\nexport default PointBuffer\n","/**\n * @file Dot Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ExtensionFragDepth } from '../globals'\nimport { defaults } from '../utils'\nimport Representation, { RepresentationParameters } from './representation'\nimport Volume from '../surface/volume'\nimport FilteredVolume from '../surface/filtered-volume'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport PointBuffer from '../buffer/point-buffer'\nimport Surface from '../surface/surface';\nimport Viewer from '../viewer/viewer';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\n\nexport interface DotDataFields {\n  color?: boolean,\n  radius?: boolean,\n  scale?: boolean\n}\n\n/**\n * Dot representation parameter object. Extends {@link RepresentationParameters}\n *\n * @typedef {Object} DotRepresentationParameters - dot representation parameters\n *\n * @property {String} thresholdType - Meaning of the threshold values. Either *value* for the literal value or *sigma* as a factor of the sigma of the data. For volume data only.\n * @property {Number} thresholdMin - Minimum value to be displayed. For volume data only.\n * @property {Number} thresholdMax - Maximum value to be displayed. For volume data only.\n * @property {Number} thresholdOut - Show only values falling outside of the treshold minumum and maximum. For volume data only.\n */\nexport interface DotRepresentationParameters extends RepresentationParameters {\n  thresholdType: 'value'|'value'|'sigma'|'sigma'\n  thresholdMin: number\n  thresholdMax: number\n  thresholdOut: boolean\n  dotType: ''|'sphere'|'point'\n  radiusType: ''|'value'|'abs-value'|'value-min'|'deviation'|'size'|'radius' //TODO had to add 'radius' because of test in line 333\n  radius: number\n  scale: number\n  sphereDetail: number\n  disableImpostor: boolean\n  pointSize: number\n  sizeAttenuation: boolean\n  sortParticles: boolean\n  useTexture: boolean\n  alphaTest: number\n  forceTransparent: boolean\n  edgeBleach: number\n}\n/**\n * Dot representation\n */\nclass DotRepresentation extends Representation {\n  protected thresholdType: 'value'|'value'|'sigma'|'sigma'\n  protected thresholdMin: number\n  protected thresholdMax: number\n  protected thresholdOut: boolean\n  protected dotType: ''|'sphere'|'point'\n  protected radiusType: ''|'value'|'abs-value'|'value-min'|'deviation'|'size'|'radius' //TODO had to add 'radius' because of test in line 333\n  protected radius: number\n  protected scale: number\n  protected sphereDetail: number\n  protected disableImpostor: boolean\n  protected pointSize: number\n  protected sizeAttenuation: boolean\n  protected sortParticles: boolean\n  protected useTexture: boolean\n  protected alphaTest: number\n  protected forceTransparent: boolean\n  protected edgeBleach: number\n\n  protected surface: Surface|undefined\n  protected volume: FilteredVolume|undefined\n  protected dotBuffer: SphereBuffer|PointBuffer\n  /**\n   * Create Dot representation object\n   * @param {Surface|Volume} surface - the surface or volume to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {DotRepresentationParameters} params - dot representation parameters\n   */\n  constructor (surface: Surface, viewer: Viewer, params: Partial<DotRepresentationParameters>) {\n    super(surface, viewer, params)\n\n    this.type = 'dot'\n\n    this.parameters = Object.assign({\n\n      thresholdType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'value': 'value', 'sigma': 'sigma'\n        }\n      },\n      thresholdMin: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      thresholdMax: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      thresholdOut: {\n        type: 'boolean', rebuild: true\n      },\n      dotType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          '': '',\n          'sphere': 'sphere',\n          'point': 'point'\n        }\n      },\n      radiusType: {\n        type: 'select',\n        options: {\n          '': '',\n          'value': 'value',\n          'abs-value': 'abs-value',\n          'value-min': 'value-min',\n          'deviation': 'deviation',\n          'size': 'size'\n        }\n      },\n      radius: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001, property: 'size'\n      },\n      scale: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      sphereDetail: true,\n      disableImpostor: true,\n\n      pointSize: {\n        type: 'number', precision: 1, max: 100, min: 0, buffer: true\n      },\n      sizeAttenuation: {\n        type: 'boolean', buffer: true\n      },\n      sortParticles: {\n        type: 'boolean', rebuild: true\n      },\n      useTexture: {\n        type: 'boolean', buffer: true\n      },\n      alphaTest: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      },\n      forceTransparent: {\n        type: 'boolean', buffer: true\n      },\n      edgeBleach: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      }\n\n    }, this.parameters, {\n\n      colorScheme: {\n        type: 'select',\n        update: 'color',\n        options: {\n          '': '',\n          'value': 'value',\n          'uniform': 'uniform',\n          'random': 'random'\n        }\n      }\n\n    })\n\n    if (surface instanceof Volume) {\n      this.surface = undefined\n      this.volume = new FilteredVolume(surface)\n    } else {\n      this.surface = surface\n      this.volume = undefined\n    }\n\n    this.init(params)\n  }\n\n  init (params: Partial<DotRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'uniform')\n    p.colorValue = defaults(p.colorValue, 0xDDDDDD)\n\n    this.thresholdType = defaults(p.thresholdType, 'sigma')\n    this.thresholdMin = defaults(p.thresholdMin, 2.0)\n    this.thresholdMax = defaults(p.thresholdMax, Infinity)\n    this.thresholdOut = defaults(p.thresholdOut, false)\n    this.dotType = defaults(p.dotType, 'point')\n    this.radius = defaults(p.radius, 0.1)\n    this.scale = defaults(p.scale, 1.0)\n\n    this.pointSize = defaults(p.pointSize, 1)\n    this.sizeAttenuation = defaults(p.sizeAttenuation, true)\n    this.sortParticles = defaults(p.sortParticles, false)\n    this.useTexture = defaults(p.useTexture, false)\n    this.alphaTest = defaults(p.alphaTest, 0.5)\n    this.forceTransparent = defaults(p.forceTransparent, false)\n    this.edgeBleach = defaults(p.edgeBleach, 0.0)\n\n    super.init(p)\n\n    this.build()\n  }\n\n  attach (callback: () => void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n    })\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  create () {\n    var dotData: SphereBufferData|{} = {}\n\n    if (this.volume) {\n      var volume = this.volume\n      var thresholdMin, thresholdMax\n\n      if (this.thresholdType === 'sigma') {\n        thresholdMin = volume.getValueForSigma(this.thresholdMin)\n        thresholdMax = volume.getValueForSigma(this.thresholdMax)\n      } else {\n        thresholdMin = this.thresholdMin\n        thresholdMax = this.thresholdMax\n      }\n      volume.setFilter(thresholdMin, thresholdMax, this.thresholdOut)\n\n      Object.assign(dotData, {\n        position: volume.getDataPosition(),\n        color: volume.getDataColor(this.getColorParams())\n      })\n      if (this.dotType === 'sphere') {\n        Object.assign(dotData, {\n          radius: volume.getDataSize(this.radius, this.scale),\n          picking: volume.getDataPicking()\n        })\n      }\n    } else {\n      var surface = this.surface\n      Object.assign(dotData, {\n        position: (surface as Surface).getPosition(),\n        color: (surface as Surface).getColor(this.getColorParams())\n      })\n      if (this.dotType === 'sphere') {\n        Object.assign(dotData, {\n          radius: (surface as Surface).getSize(this.radius, this.scale),\n          picking: (surface as Surface).getPicking()\n        })\n      }\n    }\n\n    if (this.dotType === 'sphere') {\n      this.dotBuffer = new SphereBuffer(\n        dotData as SphereBufferData,\n        this.getBufferParams({\n          sphereDetail: this.sphereDetail,\n          disableImpostor: this.disableImpostor,\n          dullInterior: false\n        }) as SphereBufferParameters\n      ) as SphereGeometryBuffer\n    } else {\n      this.dotBuffer = new PointBuffer(\n        dotData,\n        this.getBufferParams({\n          pointSize: this.pointSize,\n          sizeAttenuation: this.sizeAttenuation,\n          sortParticles: this.sortParticles,\n          useTexture: this.useTexture,\n          alphaTest: this.alphaTest,\n          forceTransparent: this.forceTransparent,\n          edgeBleach: this.edgeBleach\n        })\n      )\n    }\n\n    this.bufferList.push(this.dotBuffer as SphereGeometryBuffer)\n  }\n\n  update (what: DotDataFields = {}) {\n    if (this.bufferList.length === 0) return\n\n    const dotData: SphereBufferData|{} = {}\n\n    if (what.color) {\n      if (this.volume) {\n        Object.assign(dotData, {\n          color: this.volume.getDataColor(\n            this.getColorParams()\n          )\n        })\n      } else {\n        Object.assign(dotData, {\n          color: (this.surface as Surface).getColor(\n            this.getColorParams()\n          )\n        })\n      }\n    }\n\n    if (this.dotType === 'sphere' && (what.radius || what.scale)) {\n      if (this.volume) {\n        Object.assign(dotData, {\n          radius: this.volume.getDataSize(\n            this.radius, this.scale\n          )\n        })\n      } else {\n        Object.assign(dotData, {\n          radius: (this.surface as Surface).getSize(\n            this.radius, this.scale\n          )\n        })\n      }\n    }\n\n    (this.dotBuffer as SphereGeometryBuffer).setAttributes(dotData)\n  }\n\n  setParameters (params: Partial<DotRepresentationParameters>, what: DotDataFields = {}, rebuild: boolean) {\n    \n    if (params && params.thresholdType !== undefined &&\n        this.volume instanceof Volume\n    ) {\n      if (this.thresholdType === 'value' &&\n          params.thresholdType === 'sigma'\n      ) {\n        this.thresholdMin = this.volume.getSigmaForValue(\n          this.thresholdMin\n        )\n        this.thresholdMax = this.volume.getSigmaForValue(\n          this.thresholdMax\n        )\n      } else if (this.thresholdType === 'sigma' &&\n                 params.thresholdType === 'value'\n      ) {\n        this.thresholdMin = this.volume.getValueForSigma(\n          this.thresholdMin\n        )\n        this.thresholdMax = this.volume.getValueForSigma(\n          this.thresholdMax\n        )\n      }\n\n      this.thresholdType = params.thresholdType\n    }\n\n    if (params && params.radiusType !== undefined) {\n      if (params.radiusType === 'radius') {\n        this.radius = 0.1\n      } else {\n        this.radius = parseFloat(params.radiusType)\n      }\n      what.radius = true\n      if (this.dotType === 'sphere' &&\n          (!ExtensionFragDepth || this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    if (params && params.radius !== undefined) {\n      what.radius = true\n      if (this.dotType === 'sphere' &&\n          (!ExtensionFragDepth || this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    if (params && params.scale !== undefined) {\n      what.scale = true\n      if (this.dotType === 'sphere' &&\n          (!ExtensionFragDepth || this.disableImpostor)\n      ) {\n        rebuild = true\n      }\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nexport default DotRepresentation\n","/**\n * @file Image Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport {\n    // @ts-ignore: unused import Vector3, Matrix4 required for declaration only\n    Vector2, Vector3, Matrix4, BufferAttribute, DataTexture,\n    NormalBlending, NearestFilter, LinearFilter\n} from 'three'\n\nimport '../shader/Image.vert'\nimport '../shader/Image.frag'\n\nimport { Picker } from '../utils/picker'\nimport Buffer, { BufferDefaultParameters, BufferParameterTypes, BufferTypes } from './buffer'\n\n\nconst quadIndices = new Uint16Array([\n  0, 1, 2,\n  1, 3, 2\n])\n\nconst quadUvs = new Float32Array([\n  0, 1,\n  0, 0,\n  1, 1,\n  1, 0\n])\n\ntype ImageFilterTypes = 'nearest'|'linear'|'cubic-bspline'|'cubic-catmulrom'|'cubic-mitchell'\n\nexport interface ImageBufferData {\n  position: Float32Array\n  imageData: Uint8Array\n  width: number\n  height: number\n\n  picking?: Picker\n}\n\nexport const ImageBufferDefaultParameters = Object.assign({\n  filter: 'nearest' as ImageFilterTypes,\n  forceTransparent: true\n}, BufferDefaultParameters)\nexport type ImageBufferParameters = typeof ImageBufferDefaultParameters\n\nexport const ImageBufferParameterTypes = Object.assign({\n  filter: { updateShader: true, uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Image buffer. Draw a single image. Optionally interpolate.\n */\nclass ImageBuffer extends Buffer {\n  parameterTypes = ImageBufferParameterTypes\n  get defaultParameters() { return ImageBufferDefaultParameters }\n  parameters: ImageBufferParameters\n\n  alwaysTransparent = true\n  hasWireframe = false\n  vertexShader = 'Image.vert'\n  fragmentShader = 'Image.frag'\n\n  tex: DataTexture\n  pickingTex: DataTexture\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position - image position\n   * @param {Float32Array} data.imageData - image data, rgba channels\n   * @param {Float32Array} data.width - image width\n   * @param {Float32Array} data.height - image height\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: ImageBufferData, params: ImageBufferParameters) {\n    super({\n      position: data.position,\n      index: quadIndices,\n      picking: data.picking\n    }, params)\n\n    const {imageData, width, height} = data\n\n    const tex = new DataTexture(imageData, width, height)\n    tex.flipY = true\n    this.tex = tex\n\n    const n = imageData.length\n    const pickingData = new Uint8Array(n)\n    for (let i = 0; i < n; i += 4) {\n      const j = i / 4\n      pickingData[ i ] = j >> 16 & 255\n      pickingData[ i + 1 ] = j >> 8 & 255\n      pickingData[ i + 2 ] = j & 255\n    }\n\n    const pickingTex = new DataTexture(pickingData, width, height)\n    pickingTex.flipY = true\n    pickingTex.minFilter = NearestFilter\n    pickingTex.magFilter = NearestFilter\n    this.pickingTex = pickingTex\n\n    this.addUniforms({\n      'map': { value: tex },\n      'pickingMap': { value: pickingTex },\n      'mapSize': { value: new Vector2(width, height) }\n    })\n\n    this.geometry.setAttribute('uv', new BufferAttribute(quadUvs, 2))\n  }\n\n  getDefines (type: BufferTypes) {\n    const defines = super.getDefines(type)\n    const filter = this.parameters.filter\n\n    if (filter.startsWith('cubic')) {\n      defines.CUBIC_INTERPOLATION = 1\n      if (filter.endsWith('bspline')) {\n        defines.BSPLINE_FILTER = 1\n      } else if (filter.endsWith('catmulrom')) {\n        defines.CATMULROM_FILTER = 1\n      } else if (filter.endsWith('mitchell')) {\n        defines.MITCHELL_FILTER = 1\n      }\n    }\n\n    return defines\n  }\n\n  updateTexture () {\n    const tex = this.tex\n    const filter = this.parameters.filter\n\n    if (filter.startsWith('cubic')) {\n      tex.minFilter = NearestFilter\n      tex.magFilter = NearestFilter\n    } else if (filter === 'linear') {\n      tex.minFilter = LinearFilter\n      tex.magFilter = LinearFilter\n    } else {  // filter === \"nearest\"\n      tex.minFilter = NearestFilter\n      tex.magFilter = NearestFilter\n    }\n\n    tex.needsUpdate = true\n    this.pickingTex.needsUpdate = true\n  }\n\n  makeMaterial () {\n    super.makeMaterial()\n    this.updateTexture()\n\n    const m = this.material\n    m.uniforms.map.value = this.tex\n    m.blending = NormalBlending\n    m.needsUpdate = true\n\n    const wm = this.wireframeMaterial\n    wm.uniforms.map.value = this.tex\n    wm.blending = NormalBlending\n    wm.needsUpdate = true\n\n    const pm = this.pickingMaterial\n    pm.uniforms.map.value = this.tex\n    pm.uniforms.pickingMap.value = this.pickingTex\n    pm.blending = NormalBlending\n    pm.needsUpdate = true\n  }\n\n  setUniforms (data: any) {  // TODO\n    if (data && data.filter !== undefined) {\n      this.updateTexture()\n      data.map = this.tex\n    }\n\n    super.setUniforms(data)\n  }\n}\n\nexport default ImageBuffer\n","/**\n * @file Volume Slice\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { SlicePicker } from '../utils/picker'\nimport { Volume } from '../ngl';\nimport { SliceRepresentationParameters } from '../representation/slice-representation';\n\nclass VolumeSlice {\n  dimension: 'x'|'y'|'z'\n  positionType: 'percent'|'coordinate'\n  position: number\n  thresholdType: 'sigma'|'value'\n  thresholdMin: number\n  thresholdMax: number\n  normalize: boolean\n  volume: Volume\n\n  constructor (volume: Volume, params: Partial<SliceRepresentationParameters>) {\n    const p = params || {}\n\n    this.dimension = defaults(p.dimension, 'x')\n    this.positionType = defaults(p.positionType, 'percent')\n    this.position = defaults(p.position, 30)\n    this.thresholdType = defaults(p.thresholdType, 'sigma')\n    this.thresholdMin = defaults(p.thresholdMin, -Infinity)\n    this.thresholdMax = defaults(p.thresholdMax, Infinity)\n    this.normalize = defaults(p.normalize, false)\n\n    this.volume = volume\n  }\n\n  getPositionFromCoordinate (coord: number) {\n    const dim = this.dimension\n    const v = this.volume\n    const m = v.matrix\n\n    const mp = new Vector3().setFromMatrixPosition(m)[ dim ]\n    const ms = new Vector3().setFromMatrixScale(m)[ dim ]\n\n    let vn\n    if (dim === 'x') {\n      vn = v.nx\n    } else if (dim === 'y') {\n      vn = v.ny\n    } else {\n      vn = v.nz\n    }\n\n    return Math.round((((coord - mp) / (vn / 100)) + 1) / ms)\n  }\n\n  getData (params: any) {\n    params = params || {}\n\n    const v = this.volume\n    const d = v.data\n    const m = v.matrix\n\n    let p: number\n    if (this.positionType === 'coordinate') {\n      p = this.getPositionFromCoordinate(this.position)\n    } else {\n      p = this.position\n    }\n\n    function pos (dimLen: number) {\n      return Math.round((dimLen / 100) * (p - 1))\n    }\n\n    function index (x: number, y: number, z: number, i: number) {\n      return (z * v.ny * v.nx + y * v.nx + x) * 3 + i\n    }\n\n    const position = new Float32Array(4 * 3)\n    const vec = new Vector3()\n\n    let width, height\n    let x\n    let y\n    let z\n    let x0 = 0\n    let y0 = 0\n    let z0 = 0\n    let nx = v.nx\n    let ny = v.ny\n    let nz = v.nz\n\n    function setVec (x: number, y: number, z: number, offset: number) {\n      vec.set(x, y, z).applyMatrix4(m).toArray(position as any, offset)\n    }\n\n    if (this.dimension === 'x') {\n      x = pos(v.nx)\n      y = v.ny - 1\n      z = v.nz - 1\n\n      width = v.nz\n      height = v.ny\n\n      x0 = x\n      nx = x0 + 1\n\n      setVec(x, 0, 0, 0)\n      setVec(x, y, 0, 3)\n      setVec(x, 0, z, 6)\n      setVec(x, y, z, 9)\n    } else if (this.dimension === 'y') {\n      x = v.nx - 1\n      y = pos(v.ny)\n      z = v.nz - 1\n\n      width = v.nz\n      height = v.nx\n\n      y0 = y\n      ny = y0 + 1\n\n      setVec(0, y, 0, 0)\n      setVec(x, y, 0, 3)\n      setVec(0, y, z, 6)\n      setVec(x, y, z, 9)\n    } else if (this.dimension === 'z') {\n      x = v.nx - 1\n      y = v.ny - 1\n      z = pos(v.nz)\n\n      width = v.nx\n      height = v.ny\n\n      z0 = z\n      nz = z0 + 1\n\n      setVec(0, 0, z, 0)\n      setVec(0, y, z, 3)\n      setVec(x, 0, z, 6)\n      setVec(x, y, z, 9)\n    }\n\n    let i = 0\n    let j = 0\n    const imageData = new Uint8Array(<number>width * <number>height * 4)\n    const pickingArray = new Float32Array(<number>width * <number>height)\n\n    let tMin, tMax\n    if (this.thresholdType === 'sigma') {\n      tMin = v.getValueForSigma(this.thresholdMin)\n      tMax = v.getValueForSigma(this.thresholdMax)\n    } else {\n      tMin = this.thresholdMin\n      tMax = this.thresholdMax\n    }\n\n    const cp = Object.assign({}, params.colorParams, { volume: v })\n    if (this.normalize) {\n      cp.domain = [ 0, 1 ]\n    }\n    const colormaker = ColormakerRegistry.getScheme(cp)\n    const tmp = new Float32Array(3)\n    const scale = colormaker.getScale()\n\n    let min = 0, max, diff = 0\n    if (this.normalize) {\n      min = +Infinity\n      max = -Infinity\n      for (let iy = y0; iy < ny; ++iy) {\n        for (let ix = x0; ix < nx; ++ix) {\n          for (let iz = z0; iz < nz; ++iz) {\n            const idx = index(ix, iy, iz, 0) / 3\n            const val = d[ idx ]\n            if (val < min) min = val\n            if (val > max) max = val\n          }\n        }\n      }\n      diff = max - min\n    }\n\n    for (let iy = y0; iy < ny; ++iy) {\n      for (let ix = x0; ix < nx; ++ix) {\n        for (let iz = z0; iz < nz; ++iz) {\n          const idx = index(ix, iy, iz, 0) / 3\n          let val = d[ idx ]\n          if (this.normalize) {\n            val = (val - min) / diff\n          }\n\n          colormaker.colorToArray(scale(val), tmp)\n          imageData[ i ] = Math.round(tmp[ 0 ] * 255)\n          imageData[ i + 1 ] = Math.round(tmp[ 1 ] * 255)\n          imageData[ i + 2 ] = Math.round(tmp[ 2 ] * 255)\n          imageData[ i + 3 ] = (val > tMin && val < tMax) ? 255 : 0\n\n          pickingArray[ j ] = idx\n\n          ++j\n          i += 4\n        }\n      }\n    }\n\n    const picking = new SlicePicker(pickingArray, v)\n\n    return { position, imageData, width, height, picking }\n  }\n}\n\nexport default VolumeSlice\n","/**\n * @file Slice Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Representation, { RepresentationParameters } from './representation'\nimport ImageBuffer, { ImageBufferParameters, ImageBufferData } from '../buffer/image-buffer'\nimport VolumeSlice from '../surface/volume-slice'\nimport Viewer from '../viewer/viewer';\nimport { Volume } from '../ngl';\n\n/**\n * Slice representation parameter object. Extends {@link RepresentationParameters}\n *\n * @typedef {Object} SliceRepresentationParameters - slice representation parameters\n *\n * @property {String} filter - filter applied to map the volume data on the slice, one of \"nearest\", \"linear\", \"cubic-bspline\", \"cubic-catmulrom\", \"cubic-mitchell\".\n * @property {String} positionType - Meaning of the position value. Either \"percent\" od \"coordinate\".\n * @property {Number} position - position of the slice.\n * @property {String} dimension - one of \"x\", \"y\" or \"z\"\n * @property {String} thresholdType - Meaning of the threshold values. Either *value* for the literal value or *sigma* as a factor of the sigma of the data. For volume data only.\n * @property {Number} thresholdMin - Minimum value to be displayed. For volume data only.\n * @property {Number} thresholdMax - Maximum value to be displayed. For volume data only.\n * @property {Boolean} normalize - Flag indicating wheather to normalize the data in a slice when coloring.\n */\nexport interface SliceRepresentationParameters extends RepresentationParameters {\n  filter: 'nearest'|'linear'|'cubic-bspline'|'cubic-catmulrom'|'cubic-mitchell'\n  positionType: 'percent'|'coordinate'\n  position: number\n  dimension: 'x'|'y'|'z'\n  thresholdType: 'value'|'sigma'\n  thresholdMin: number\n  thresholdMax: number\n  normalize: boolean\n}\n/**\n * Slice representation\n */\nclass SliceRepresentation extends Representation {\n  protected filter: 'nearest'|'linear'|'cubic-bspline'|'cubic-catmulrom'|'cubic-mitchell'\n  protected positionType: 'percent'|'coordinate'\n  protected position: number\n  protected dimension: 'x'|'y'|'z'\n  protected thresholdType: 'value'|'sigma'\n  protected thresholdMin: number\n  protected thresholdMax: number\n  protected normalize: boolean\n  protected volume: Volume\n  /**\n   * Create Slice representation object\n   * @param {Volume} surface - the volume to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {SliceRepresentationParameters} params - slice representation parameters\n   */\n  constructor (volume: Volume, viewer: Viewer, params: Partial<SliceRepresentationParameters>) {\n    super(volume, viewer, params)\n\n    this.type = 'slice'\n\n    this.parameters = Object.assign({\n\n      filter: {\n        type: 'select',\n        buffer: true,\n        options: {\n          'nearest': 'nearest',\n          'linear': 'linear',\n          'cubic-bspline': 'cubic-bspline',\n          'cubic-catmulrom': 'cubic-catmulrom',\n          'cubic-mitchell': 'cubic-mitchell'\n        }\n      },\n      positionType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'percent': 'percent', 'coordinate': 'coordinate'\n        }\n      },\n      position: {\n        type: 'range',\n        step: 0.1,\n        max: 100,\n        min: 1,\n        rebuild: true\n      },\n      dimension: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'x': 'x', 'y': 'y', 'z': 'z'\n        }\n      },\n      thresholdType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'value': 'value', 'sigma': 'sigma'\n        }\n      },\n      thresholdMin: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      thresholdMax: {\n        type: 'number', precision: 3, max: Infinity, min: -Infinity, rebuild: true\n      },\n      normalize: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      side: null,\n      wireframe: null,\n      linewidth: null,\n      colorScheme: null,\n\n      roughness: null,\n      metalness: null,\n      diffuse: null\n\n    })\n\n    this.volume = volume\n\n    this.init(params)\n  }\n\n  init (params: Partial<SliceRepresentationParameters>) {\n    const v = this.volume\n    const p = params || {}\n    p.colorDomain = defaults(p.colorDomain, [ v.min, v.max ])\n    p.colorScheme = defaults(p.colorScheme, 'value')\n    p.colorScale = defaults(p.colorScale, 'Spectral')\n\n    this.colorScheme = 'value'\n    this.dimension = defaults(p.dimension, 'x')\n    this.filter = defaults(p.filter, 'cubic-bspline')\n    this.positionType = defaults(p.positionType, 'percent')\n    this.position = defaults(p.position, 30)\n    this.thresholdType = defaults(p.thresholdType, 'sigma')\n    this.thresholdMin = defaults(p.thresholdMin, -Infinity)\n    this.thresholdMax = defaults(p.thresholdMax, Infinity)\n    this.normalize = defaults(p.normalize, false)\n\n    super.init(p)\n\n    this.build()\n  }\n\n  attach (callback: () => void) {\n    this.bufferList.forEach(buffer => {\n      this.viewer.add(buffer)\n    })\n    this.setVisibility(this.visible)\n\n    callback()\n  }\n\n  create () {\n    const volumeSlice = new VolumeSlice(this.volume, {\n      positionType: this.positionType,\n      position: this.position,\n      dimension: this.dimension,\n      thresholdType: this.thresholdType,\n      thresholdMin: this.thresholdMin,\n      thresholdMax: this.thresholdMax,\n      normalize: this.normalize\n    })\n\n    const sliceBuffer = new ImageBuffer(\n      volumeSlice.getData({ colorParams: this.getColorParams() }) as ImageBufferData,\n      this.getBufferParams({\n        filter: this.filter\n      }) as ImageBufferParameters\n    )\n\n    this.bufferList.push(sliceBuffer)\n  }\n}\n\nexport default SliceRepresentation\n","/**\n * @file Representation Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, RepresentationRegistry } from '../globals'\n\nimport Viewer from '../viewer/viewer'\nimport Structure from '../structure/structure'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport Shape from '../geometry/shape'\n\nimport BufferRepresentation from './buffer-representation'\nimport SurfaceRepresentation from './surface-representation'\nimport DotRepresentation from './dot-representation'\nimport SliceRepresentation from './slice-representation'\n\nfunction logReprUnknown (type: string) {\n  Log.error(`makeRepresentation: representation type ${type} unknown`)\n}\n\nexport function makeRepresentation (type: string, object: any, viewer: Viewer, params: any) {  // TODO\n  if (Debug) Log.time('makeRepresentation ' + type)\n\n  var ReprClass\n\n  if (object instanceof Structure) {\n    ReprClass = RepresentationRegistry.get(type)\n\n    if (!ReprClass) {\n      logReprUnknown(type)\n      return\n    }\n  } else if (object instanceof Surface) {\n    if (type === 'surface') {\n      ReprClass = SurfaceRepresentation\n    } else if (type === 'dot') {\n      ReprClass = DotRepresentation\n    } else {\n      logReprUnknown(type)\n      return\n    }\n  } else if (object instanceof Volume) {\n    if (type === 'surface') {\n      ReprClass = SurfaceRepresentation\n    } else if (type === 'dot') {\n      ReprClass = DotRepresentation\n    } else if (type === 'slice') {\n      ReprClass = SliceRepresentation\n    } else {\n      logReprUnknown(type)\n      return\n    }\n  } else if (object instanceof Shape) {\n    ReprClass = BufferRepresentation\n    object = object.getBufferList()\n  } else if (type === 'buffer') {\n    ReprClass = BufferRepresentation\n  } else {\n    Log.error('makeRepresentation: object ' + object + ' unknown')\n    return\n  }\n\n  const repr = new ReprClass(object, viewer, params)\n\n  if (Debug) Log.timeEnd('makeRepresentation ' + type)\n\n  return repr\n}\n","/**\n * @file Element\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { createParams } from '../utils'\nimport { generateUUID } from '../math/math-utils'\nimport Stage from '../stage/stage'\n\nexport const ElementDefaultParameters = {\n  name: 'some element',\n  status: ''\n}\nexport type ElementParameters = typeof ElementDefaultParameters\n\nexport interface ElementSignals {\n  statusChanged: Signal  // on status change\n  nameChanged: Signal  // on name change\n  disposed: Signal  // on dispose\n}\n\n/**\n * Element base class\n */\nabstract class Element {\n  /**\n   * Events emitted by the element\n   */\n  signals: ElementSignals = {\n    statusChanged: new Signal(),\n    nameChanged: new Signal(),\n    disposed: new Signal()\n  }\n  readonly parameters: ElementParameters\n  readonly uuid: string\n\n  get defaultParameters() { return ElementDefaultParameters }\n\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {ElementParameters} params - component parameters\n   */\n  constructor (readonly stage: Stage, params: Partial<ElementParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n    this.uuid = generateUUID()\n  }\n\n  abstract get type (): string\n\n  get name () { return this.parameters.name }\n\n  setStatus (value: string) {\n    this.parameters.status = value\n    this.signals.statusChanged.dispatch(value)\n\n    return this\n  }\n\n  setName (value: string) {\n    this.parameters.name = value\n    this.signals.nameChanged.dispatch(value)\n\n    return this\n  }\n\n  dispose () {\n    this.signals.disposed.dispatch()\n  }\n}\n\nexport default Element\n","/**\n * @file Representation Element\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\nimport { Color } from 'three'\n\nimport Stage from '../stage/stage'\nimport Representation, { RepresentationParameters } from '../representation/representation'\nimport Component from './component'\nimport Element, { ElementDefaultParameters, ElementSignals } from './element'\n\nexport const RepresentationElementDefaultParameters = Object.assign({\n  visible: true\n}, ElementDefaultParameters)\nexport type RepresentationElementParameters = typeof RepresentationElementDefaultParameters\n\nexport interface RepresentationElementSignals extends ElementSignals {\n  visibilityChanged: Signal  // on visibility change\n  parametersChanged: Signal  // on parameters change\n}\n\n/**\n * Element wrapping a {@link Representation} object\n */\nclass RepresentationElement extends Element {\n  signals: RepresentationElementSignals\n  parameters: RepresentationElementParameters\n  get defaultParameters() { return RepresentationElementDefaultParameters }\n\n  repr: Representation\n\n  /**\n   * Create representation component\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Representation} repr - representation object to wrap\n   * @param {RepresentationParameters} [params] - component parameters\n   * @param {Component} [parent] - parent component\n   */\n  constructor (stage: Stage, repr: Representation, params: Partial<RepresentationElementParameters> = {}, readonly parent: Component) {\n    super(stage, Object.assign({ name: repr.type }, params))\n\n    this.signals = Object.assign({\n      visibilityChanged: new Signal(),\n      parametersChanged: new Signal()\n    }, this.signals)\n\n    this.setRepresentation(repr)\n  }\n\n  get visible () { return this.parameters.visible }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'representation' }\n\n  getType () {\n    return this.repr.type\n  }\n\n  setRepresentation (repr: Representation) {\n    this._disposeRepresentation()\n    this.repr = repr\n    // this.name = repr.type;\n    this.stage.tasks.listen(this.repr.tasks)\n    this.updateVisibility()\n  }\n\n  _disposeRepresentation () {\n    if (this.repr) {\n      this.stage.tasks.unlisten(this.repr.tasks)\n      this.repr.dispose()\n    }\n  }\n\n  dispose () {\n    if (this.parent && this.parent.hasRepresentation(this)) {\n      this.parent.removeRepresentation(this)\n    } else {\n      this._disposeRepresentation()\n      this.signals.disposed.dispatch()\n    }\n  }\n\n  /**\n   * Set the visibility of the component, takes parent visibility into account\n   * @param {Boolean} value - visibility flag\n   * @return {RepresentationElement} this object\n   */\n  setVisibility (value: boolean) {\n    this.parameters.visible = value\n    this.updateVisibility()\n    this.signals.visibilityChanged.dispatch(this.parameters.visible)\n\n    return this\n  }\n\n  getVisibility () {\n    if (this.parent) {\n      return this.parent.parameters.visible && this.parameters.visible\n    } else {\n      return this.parameters.visible\n    }\n  }\n\n  /**\n   * Toggle visibility of the component, takes parent visibility into account\n   * @return {RepresentationElement} this object\n   */\n  toggleVisibility () {\n    return this.setVisibility(!this.parameters.visible)\n  }\n\n  updateVisibility () {\n    this.repr.setVisibility(this.getVisibility())\n  }\n\n  /**\n   * Set selection\n   * @param {Object} what - flags indicating what attributes to update\n   * @param {Boolean} what.position - update position attribute\n   * @param {Boolean} what.color - update color attribute\n   * @param {Boolean} what.radius - update radius attribute\n   * @return {RepresentationElement} this object\n   */\n  update (what: any) {  // TODO\n    (this.repr as any).update(what)  // TODO\n\n    return this\n  }\n\n  build (params?: any) {  // TODO\n    this.repr.build(params)\n\n    return this\n  }\n\n  /**\n   * Set selection\n   * @param {String} string - selection string\n   * @return {RepresentationElement} this object\n   */\n  setSelection (string: string) {\n    const repr: any = this.repr  // TODO\n\n    if (repr.setSelection) {\n      repr.setSelection(string)\n    }\n\n    return this\n  }\n\n  /**\n   * Set representation parameters\n   * @param {RepresentationParameters} params - parameter object\n   * @return {RepresentationElement} this object\n   */\n  setParameters (params: any) {  // TODO\n    this.repr.setParameters(params)\n    this.signals.parametersChanged.dispatch(\n      this.repr.getParameters()\n    )\n\n    return this\n  }\n\n  /**\n   * Get representation parameters\n   * @return {RepresentationParameters} parameter object\n   */\n  getParameters (): Partial<RepresentationParameters> {\n    return this.repr.getParameters()\n  }\n\n  /**\n   * Set color\n   * @param {String|Color|Hex} value - color value\n   * @return {RepresentationElement} this object\n   */\n  setColor (value: string|number|Color) {\n    this.repr.setColor(value)\n\n    return this\n  }\n}\n\nexport default RepresentationElement\n","\n/**\n * @file Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Quaternion, Matrix4, Euler, Box3 } from 'three'\nimport { Signal } from 'signals'\n\nimport { defaults, createParams } from '../utils'\nimport { generateUUID } from '../math/math-utils'\nimport Annotation, { AnnotationParams } from '../component/annotation'\nimport ComponentControls from '../controls/component-controls'\nimport { makeRepresentation } from '../representation/representation-utils'\nimport RepresentationElement from './representation-element'\nimport Stage from '../stage/stage'\nimport Viewer from '../viewer/viewer'\n\nconst _m = new Matrix4()\nconst _v = new Vector3()\n\nexport const ComponentDefaultParameters = {\n  name: '',\n  status: '',\n  visible: true\n}\nexport type ComponentParameters = typeof ComponentDefaultParameters\n\n\nexport interface ComponentSignals {\n  representationAdded: Signal  // when a representation is added\n  representationRemoved: Signal  // when a representation is removed\n  visibilityChanged: Signal  // on visibility change\n  matrixChanged: Signal  // on matrix change\n  statusChanged: Signal  // on status change\n  nameChanged: Signal  // on name change\n  disposed: Signal  // on dispose\n}\n\n/**\n * Base class for components\n */\nabstract class Component {\n  /**\n   * Events emitted by the component\n   */\n  readonly signals: ComponentSignals = {\n    representationAdded: new Signal(),\n    representationRemoved: new Signal(),\n    visibilityChanged: new Signal(),\n    matrixChanged: new Signal(),\n    statusChanged: new Signal(),\n    nameChanged: new Signal(),\n    disposed: new Signal()\n  }\n\n  readonly parameters: ComponentParameters\n  get defaultParameters () { return ComponentDefaultParameters }\n\n  readonly uuid: string\n  readonly viewer: Viewer\n\n  reprList: RepresentationElement[] = []\n  annotationList: Annotation[] = []\n\n  matrix = new Matrix4()\n  position = new Vector3()\n  quaternion = new Quaternion()\n  scale = new Vector3(1, 1, 1)\n  transform = new Matrix4()\n\n  controls: ComponentControls\n\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {ComponentParameters} params - parameter object\n   */\n  constructor (readonly stage: Stage, readonly object: any, params: Partial<ComponentParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n    this.uuid = generateUUID()\n    this.viewer = stage.viewer\n\n    this.controls = new ComponentControls(this)\n  }\n\n  abstract get type (): string\n\n  get name () { return this.parameters.name }\n  get status () { return this.parameters.status }\n  get visible () { return this.parameters.visible }\n\n  /**\n   * Set position transform\n   *\n   * @example\n   * // translate by 25 angstrom along x axis\n   * component.setPosition([ 25, 0, 0 ]);\n   *\n   * @param {Vector3|Array} p - the coordinates\n   * @return {Component} this object\n   */\n  setPosition (p: [number, number, number]|Vector3) {\n    if (Array.isArray(p)) {\n      this.position.fromArray(p)\n    } else {\n      this.position.copy(p)\n    }\n    this.updateMatrix()\n\n    return this\n  }\n\n  /**\n   * Set local rotation transform\n   * (for global rotation use setTransform)\n   *\n   * @example\n   * // rotate by 2 degree radians on x axis\n   * component.setRotation( [ 2, 0, 0 ] );\n   *\n   * @param {Quaternion|Euler|Array} r - the rotation\n   * @return {Component} this object\n   */\n  setRotation (r: [number, number, number]|Euler|Quaternion) {\n    if (Array.isArray(r)) {\n      if (r.length === 3) {\n        const e = new Euler().fromArray(r)\n        this.quaternion.setFromEuler(e)\n      } else {\n        this.quaternion.fromArray(r)\n      }\n    } else if (r instanceof Euler) {\n      this.quaternion.setFromEuler(r)\n    } else {\n      this.quaternion.copy(r)\n    }\n    this.updateMatrix()\n\n    return this\n  }\n\n  /**\n   * Set scale transform\n   *\n   * @example\n   * // scale by factor of two\n   * component.setScale( 2 );\n   *\n   * @param {Number} s - the scale\n   * @return {Component} this object\n   */\n  setScale (s: number) {\n    this.scale.set(s, s, s)\n    this.updateMatrix()\n\n    return this\n  }\n\n  /**\n   * Set general transform. Is applied before and in addition\n   * to the position, rotation and scale transformations\n   *\n   * @example\n   * component.setTransform( matrix );\n   *\n   * @param {Matrix4} m - the matrix\n   * @return {Component} this object\n   */\n  setTransform (m: Matrix4) {\n    this.transform.copy(m)\n    this.updateMatrix()\n\n    return this\n  }\n\n  updateMatrix () {\n    const c = this.getCenterUntransformed(_v)\n    this.matrix.makeTranslation(-c.x, -c.y, -c.z)\n\n    _m.makeRotationFromQuaternion(this.quaternion)\n    this.matrix.premultiply(_m)\n\n    _m.makeScale(this.scale.x, this.scale.y, this.scale.z)\n    this.matrix.premultiply(_m)\n\n    const p = this.position\n    _m.makeTranslation(p.x + c.x, p.y + c.y, p.z + c.z)\n    this.matrix.premultiply(_m)\n\n    this.matrix.premultiply(this.transform)\n\n    this.updateRepresentationMatrices()\n\n    this.stage.viewer.updateBoundingBox()\n\n    this.signals.matrixChanged.dispatch(this.matrix)\n  }\n\n  /**\n   * Propogates our matrix to each representation\n   */\n  updateRepresentationMatrices () {\n    this.reprList.forEach(repr => {\n      repr.setParameters({ matrix: this.matrix })\n    })\n  }\n\n  /**\n   * Add an anotation object\n   * @param {Vector3} position - the 3d position\n   * @param {String|Element} content - the HTML content\n   * @param {Object} [params] - parameters\n   * @param {Integer} params.offsetX - 2d offset in x direction\n   * @param {Integer} params.offsetY - 2d offset in y direction\n   * @return {Annotation} the added annotation object\n   */\n  addAnnotation (position: Vector3, content: string|HTMLElement, params: AnnotationParams) {\n    const annotation = new Annotation(this, position, content, params)\n    this.annotationList.push(annotation)\n\n    return annotation\n  }\n\n  /**\n   * Iterator over each annotation and executing the callback\n   * @param  {Function} callback - function to execute\n   * @return {undefined}\n   */\n  eachAnnotation (callback: (a: Annotation) => void) {\n    this.annotationList.slice().forEach(callback)\n  }\n\n  /**\n   * Remove the give annotation from the component\n   * @param {Annotation} annotation - the annotation to remove\n   * @return {undefined}\n   */\n  removeAnnotation (annotation: Annotation) {\n    const idx = this.annotationList.indexOf(annotation)\n    if (idx !== -1) {\n      this.annotationList.splice(idx, 1)\n      annotation.dispose()\n    }\n  }\n\n  /**\n   * Remove all annotations from the component\n   * @return {undefined}\n   */\n  removeAllAnnotations () {\n    this.eachAnnotation(annotation => annotation.dispose())\n    this.annotationList.length = 0\n  }\n\n  /**\n   * Add a new representation to the component\n   * @param {String} type - the name of the representation\n   * @param {Object} object - the object on which the representation should be based\n   * @param {RepresentationParameters} [params] - representation parameters\n   * @return {RepresentationElement} the created representation wrapped into\n   *                                   a representation element object\n   */\n  protected _addRepresentation (type: string, object: any, params: any, hidden = false) {  // TODO\n    const p = params || {}\n    const sp = this.stage.getParameters() as any  // TODO\n    p.matrix = this.matrix.clone()\n    p.quality = p.quality || sp.quality\n    p.disableImpostor = defaults(p.disableImpostor, !sp.impostor)\n    p.useWorker = defaults(p.useWorker, sp.workerDefault)\n    p.visible = defaults(p.visible, true)\n\n    const p2 = Object.assign({}, p, { visible: this.parameters.visible && p.visible })\n    const repr = makeRepresentation(type, object, this.viewer, p2)\n    const reprElem = new RepresentationElement(this.stage, repr, p, this)\n\n    if (!hidden) {\n      this.reprList.push(reprElem)\n      this.signals.representationAdded.dispatch(reprElem)\n    }\n    return reprElem\n  }\n\n  abstract addRepresentation (type: any, params: any): any\n\n  addBufferRepresentation (buffer: any, params: any) {  // TODO\n    return this._addRepresentation.call(this, 'buffer', buffer, params)\n  }\n\n  hasRepresentation (repr: RepresentationElement) {\n    return this.reprList.indexOf(repr) !== -1\n  }\n\n  /**\n   * Iterator over each representation and executing the callback\n   * @param  {Function} callback - function to execute\n   * @return {undefined}\n   */\n  eachRepresentation (callback: (repr: RepresentationElement) => void) {\n    this.reprList.slice().forEach(callback)\n  }\n\n  /**\n   * Removes a representation component\n   * @param {RepresentationElement} repr - the representation element\n   * @return {undefined}\n   */\n  removeRepresentation (repr: RepresentationElement) {\n    const idx = this.reprList.indexOf(repr)\n    if (idx !== -1) {\n      this.reprList.splice(idx, 1)\n      repr.dispose()\n      this.signals.representationRemoved.dispatch(repr)\n    }\n  }\n\n  updateRepresentations (what: any) {  // TODO\n    this.reprList.forEach(repr => repr.update(what))\n    this.stage.viewer.requestRender()\n  }\n\n  /**\n   * Removes all representation components\n   * @return {undefined}\n   */\n  removeAllRepresentations () {\n    this.eachRepresentation(repr => repr.dispose())\n  }\n\n  dispose () {\n    this.removeAllAnnotations()\n    this.removeAllRepresentations()\n\n    this.reprList.length = 0\n\n    this.signals.disposed.dispatch()\n  }\n\n  /**\n   * Set the visibility of the component, including added representations\n   * @param {Boolean} value - visibility flag\n   * @return {Component} this object\n   */\n  setVisibility (value: boolean) {\n    this.parameters.visible = value\n\n    this.eachRepresentation((repr: RepresentationElement) => repr.updateVisibility())\n    this.eachAnnotation((annotation: Annotation) => annotation.updateVisibility())\n\n    this.signals.visibilityChanged.dispatch(value)\n\n    return this\n  }\n\n  setStatus (value: string) {\n    this.parameters.status = value\n    this.signals.statusChanged.dispatch(value)\n\n    return this\n  }\n\n  setName (value: string) {\n    this.parameters.name = value\n    this.signals.nameChanged.dispatch(value)\n\n    return this\n  }\n\n  /**\n   * @return {Box3} the component's bounding box\n   */\n  getBox (...args: any[]) {\n    return this.getBoxUntransformed(...args)\n              .clone().applyMatrix4(this.matrix)\n  }\n\n  /**\n   * @return {Vector3} the component's center position\n   */\n  getCenter (...args: any[]) {\n    return this.getCenterUntransformed(...args)\n              .clone().applyMatrix4(this.matrix)\n  }\n\n  getZoom (...args: any[]) {\n    return this.stage.getZoomForBox(this.getBox(...args))\n  }\n\n  /**\n   * @abstract\n   * @return {Box3} the untransformed component's bounding box\n   */\n  getBoxUntransformed (...args: any[]): Box3 {\n    return new Box3()\n  }\n\n  getCenterUntransformed (...args: any[]) {\n    return this.getBoxUntransformed().getCenter(new Vector3())\n  }\n\n  /**\n   * Automatically center and zoom the component\n   * @param  {Integer} [duration] - duration of the animation, defaults to 0\n   * @return {undefined}\n   */\n  autoView (duration?: number) {\n    this.stage.animationControls.zoomMove(\n      this.getCenter(),\n      this.getZoom(),\n      defaults(duration, 0)\n    )\n  }\n}\n\nexport default Component\n","/**\n * @file Collection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Component from './component'\nimport Element from './element'\n\nclass Collection<T extends (Component|Element)> {\n  constructor (readonly list: T[] = []) {\n    // remove elements from list when they get disposed\n    const n = list.length\n\n    for (let i = 0; i < n; ++i) {\n      const elm = list[ i ]\n      elm.signals.disposed.add(this._remove, this)\n    }\n  }\n\n  _remove (elm: T) {\n    const idx = this.list.indexOf(elm)\n\n    if (idx !== -1) {\n      this.list.splice(idx, 1)\n    }\n  }\n\n  get first () {\n    return this.list.length > 0 ? this.list[0] : undefined\n  }\n\n  forEach (fn: (x: T) => any) {\n    this.list.forEach(fn)\n\n    return this\n  }\n\n  dispose () {\n    return this.forEach((elm) => elm.dispose())\n  }\n}\n\nexport default Collection\n","/**\n * @file Component Collection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color } from 'three'\n\nimport RepresentationElement from './representation-element'\nimport Collection from './collection'\n\nclass RepresentationCollection extends Collection<RepresentationElement> {\n  setParameters (params: any) {\n    return this.forEach((repr) => repr.setParameters(params))\n  }\n\n  setVisibility (value: boolean) {\n    return this.forEach((repr) => repr.setVisibility(value))\n  }\n\n  setSelection (string: string) {\n    return this.forEach((repr) => repr.setSelection(string))\n  }\n\n  setColor (color: number|string|Color) {\n    return this.forEach((repr) => repr.setColor(color))\n  }\n\n  update (what: any) {\n    return this.forEach((repr) => repr.update(what))\n  }\n\n  build (params?: any) {\n    return this.forEach((repr) => repr.build(params))\n  }\n\n  dispose (params?: any) {\n    return this.forEach((repr) => repr.dispose())\n  }\n}\n\nexport default RepresentationCollection\n","/**\n * @file Trajectory Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport Element, { ElementSignals, ElementDefaultParameters } from './element'\nimport Stage from '../stage/stage'\nimport Trajectory, { TrajectoryParameters } from '../trajectory/trajectory'\nimport TrajectoryPlayer, {\n  TrajectoryPlayerDirection, TrajectoryPlayerMode, TrajectoryPlayerInterpolateType\n} from '../trajectory/trajectory-player'\n\n/**\n * Trajectory component parameter object.\n * @typedef {Object} TrajectoryComponentParameters - component parameters\n *\n * @property {String} name - component name\n * @property {Integer} initialFrame - initial frame the trajectory is set to\n * @property {Integer} defaultStep - default step size to be used by trajectory players\n * @property {Integer} defaultTimeout - default timeout to be used by trajectory players\n * @property {String} defaultInterpolateType - one of \"\" (empty string), \"linear\" or \"spline\"\n * @property {Integer} defaultInterpolateStep - window size used for interpolation\n * @property {String} defaultMode - either \"loop\" or \"once\"\n * @property {String} defaultDirection - either \"forward\" or \"backward\"\n */\n\nexport const TrajectoryElementDefaultParameters = Object.assign({\n  defaultStep: 1,\n  defaultTimeout: 50,\n  defaultInterpolateType: '' as TrajectoryPlayerInterpolateType,\n  defaultInterpolateStep: 5,\n  defaultMode: 'loop' as TrajectoryPlayerMode,\n  defaultDirection: 'forward' as TrajectoryPlayerDirection,\n  initialFrame: 0\n}, ElementDefaultParameters)\nexport type TrajectoryElementParameters = typeof TrajectoryElementDefaultParameters\n\nexport interface TrajectoryElementSignals extends ElementSignals {\n  frameChanged: Signal  // on frame change\n  playerChanged: Signal  // on player change\n  countChanged: Signal  // when frame count is available\n  parametersChanged: Signal  // on parameters change\n}\n\n/**\n * Component wrapping a {@link Trajectory} object\n */\nclass TrajectoryElement extends Element {\n  signals: TrajectoryElementSignals\n  parameters: TrajectoryElementParameters\n  get defaultParameters () { return TrajectoryElementDefaultParameters }\n\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Trajectory} trajectory - the trajectory object\n   * @param {TrajectoryComponentParameters} params - component parameters\n   * @param {StructureComponent} parent - the parent structure\n   */\n  constructor (stage: Stage, readonly trajectory: Trajectory, params: Partial<TrajectoryElementParameters> = {}) {\n    super(stage, Object.assign({ name: trajectory.name }, params))\n\n    this.signals = Object.assign(this.signals, {\n      frameChanged: new Signal(),\n      playerChanged: new Signal(),\n      countChanged: new Signal(),\n      parametersChanged: new Signal()\n    })\n\n    // signals\n\n    trajectory.signals.frameChanged.add((i: number) => {\n      this.signals.frameChanged.dispatch(i)\n    })\n\n    trajectory.signals.playerChanged.add((player: TrajectoryPlayer) => {\n      this.signals.playerChanged.dispatch(player)\n    })\n\n    trajectory.signals.countChanged.add((n: number) => {\n      this.signals.countChanged.dispatch(n)\n    })\n\n    //\n\n    if (params.initialFrame !== undefined) {\n      this.setFrame(params.initialFrame)\n    }\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'trajectory' }\n\n  /**\n   * Set the frame of the trajectory\n   * @param {Integer} i - frame number\n   * @return {undefined}\n   */\n  setFrame (i: number) {\n    this.trajectory.setFrame(i)\n  }\n\n  /**\n   * Set trajectory parameters\n   * @param {TrajectoryParameters} params - trajectory parameters\n   * @return {undefined}\n   */\n  setParameters (params: Partial<TrajectoryParameters> = {}) {\n    this.trajectory.setParameters(params)\n    this.signals.parametersChanged.dispatch(params)\n  }\n\n  dispose () {\n    this.trajectory.dispose()\n    super.dispose()\n  }\n}\n\nexport default TrajectoryElement\n","/**\n * @file Frames\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nexport default class Frames {\n  coordinates = []\n  boxes = []\n  times = []\n\n  timeOffset = 0\n  deltaTime = 1\n\n  constructor (readonly name: string, readonly path: string) {}\n\n  get type () { return 'Frames' }\n}\n","/**\n * @file Superposition\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\nimport { Debug, Log } from '../globals'\nimport {\n    Matrix, svd, meanRows, subRows, transpose,\n    multiplyABt, invert3x3, multiply3x3, mat3x3determinant, multiply\n} from '../math/matrix-utils'\nimport Structure from '../structure/structure'\n\nclass Superposition {\n  coords1t: Matrix\n  coords2t: Matrix\n\n  transformationMatrix: Matrix4\n\n  mean1: number[]\n  mean2: number[]\n\n  A = new Matrix(3, 3)\n  W = new Matrix(1, 3)\n  U = new Matrix(3, 3)\n  V = new Matrix(3, 3)\n  VH = new Matrix(3, 3)\n  R = new Matrix(3, 3)\n\n  private tmp = new Matrix(3, 3)\n  private c = new Matrix(3, 3)\n\n  constructor (atoms1: Structure|Float32Array, atoms2: Structure|Float32Array) {\n    // allocate & init data structures\n\n    let n1\n    if (atoms1 instanceof Structure) {\n      n1 = atoms1.atomCount\n    } else if (atoms1 instanceof Float32Array) {\n      n1 = atoms1.length / 3\n    } else {\n      return\n    }\n\n    let n2\n    if (atoms2 instanceof Structure) {\n      n2 = atoms2.atomCount\n    } else if (atoms2 instanceof Float32Array) {\n      n2 = atoms2.length / 3\n    } else {\n      return\n    }\n\n    const n = Math.min(n1, n2)\n\n    const coords1 = new Matrix(3, n)\n    const coords2 = new Matrix(3, n)\n\n    this.coords1t = new Matrix(n, 3)\n    this.coords2t = new Matrix(n, 3)\n\n    this.transformationMatrix = new Matrix4()\n\n    this.c.data.set([ 1, 0, 0, 0, 1, 0, 0, 0, -1 ])\n\n    // prep coords\n\n    this.prepCoords(atoms1, coords1, n, false)\n    this.prepCoords(atoms2, coords2, n, false)\n\n    // superpose\n\n    this._superpose(coords1, coords2)\n  }\n\n  _superpose (coords1: Matrix, coords2: Matrix) {\n    this.mean1 = meanRows(coords1)\n    this.mean2 = meanRows(coords2)\n\n    subRows(coords1, this.mean1)\n    subRows(coords2, this.mean2)\n\n    transpose(this.coords1t, coords1)\n    transpose(this.coords2t, coords2)\n\n    multiplyABt(this.A, this.coords2t, this.coords1t)\n\n    svd(this.A, this.W, this.U, this.V)\n\n    invert3x3(this.V, this.VH)\n    multiply3x3(this.R, this.U, this.VH)\n\n    if (mat3x3determinant(this.R) < 0.0) {\n      if (Debug) Log.log('R not a right handed system')\n\n      multiply3x3(this.tmp, this.c, this.VH)\n      multiply3x3(this.R, this.U, this.tmp)\n    }\n\n    //get the transformation matrix\n\n    const transformMat_ = new Matrix(4,4)\n    const tmp_1 = new Matrix(4,4)\n    const tmp_2 = new Matrix(4,4)\n\n    const sub = new Matrix(4,4)\n    const mult = new Matrix(4,4)\n    const add = new Matrix(4,4)\n\n    const R = this.R.data\n    const M1 = this.mean1\n    const M2 = this.mean2\n\n    sub.data.set([ 1, 0, 0, -M1[0],\n                   0, 1, 0, -M1[1],\n                   0, 0, 1, -M1[2],\n                   0, 0, 0, 1 ])\n\n    mult.data.set([ R[0], R[1], R[2], 0,\n                    R[3], R[4], R[5], 0,\n                    R[6], R[7], R[8], 0,\n                    0, 0, 0, 1 ])\n\n    add.data.set([ 1, 0, 0, M2[0],\n                   0, 1, 0, M2[1],\n                   0, 0, 1, M2[2],\n                   0, 0, 0, 1 ])\n\n    transpose(tmp_1,sub)\n    multiplyABt(transformMat_,mult,tmp_1)\n    transpose(tmp_2,transformMat_)\n    multiplyABt(tmp_1,add,tmp_2)\n\n    transpose(transformMat_,tmp_1)\n    this.transformationMatrix.elements = transformMat_.data as unknown as number[]\n\n  }\n\n  prepCoords (atoms: Structure|Float32Array, coords: Matrix, n: number, is4X4: boolean) {\n    let i = 0\n    const cd = coords.data\n\n    let c = 3\n    let d = n * 3\n\n    if (is4X4) {\n      d = n * 4\n      c = 4\n    }\n    if (atoms instanceof Structure) {\n      atoms.eachAtom(function (a) {\n        if (i < d) {\n          cd[ i + 0 ] = a.x\n          cd[ i + 1 ] = a.y\n          cd[ i + 2 ] = a.z\n          if (is4X4) cd[ i + 3 ] = 1\n\n          i += c\n        }\n      })\n    } else if (atoms instanceof Float32Array) {\n      for (; i < d; i += c){\n        if (i < d) {\n          cd[ i ] = atoms[ i ]\n          cd[ i + 1 ] = atoms[ i + 1 ]\n          cd[ i + 2 ] = atoms[ i + 2 ]\n          if (is4X4) cd[ i + 3 ] = 1\n        }\n      }\n    } else {\n      Log.warn('prepCoords: input type unknown')\n    }\n  }\n\n  transform (atoms: Structure|Float32Array) {\n    // allocate data structures\n\n    let n\n    if (atoms instanceof Structure) {\n      n = atoms.atomCount\n    } else if (atoms instanceof Float32Array) {\n      n = atoms.length / 3\n    } else {\n      return\n    }\n\n    const coords = new Matrix(4, n)\n    const tCoords = new Matrix(n,4)\n\n    // prep coords\n\n    this.prepCoords(atoms, coords, n, true)\n\n    // check for transformation matrix correctness\n\n    const transform = this.transformationMatrix\n    const det = transform.determinant()\n    if (!det){\n      return det\n    }\n\n    // do transform\n\n    const mult = new Matrix(4,4)\n    mult.data = transform.elements as unknown as Float32Array\n    multiply(tCoords,coords,mult)\n\n    let i = 0\n    const cd = tCoords.data\n    if (atoms instanceof Structure) {\n        atoms.eachAtom(function (a) {\n          a.x = cd[ i ]\n          a.y = cd[ i + 1 ]\n          a.z = cd[ i + 2 ]\n          i += 4\n        })\n\n        //update transformation matrices for each assembly\n\n        const invertTrasform = new Matrix4()\n        invertTrasform.getInverse(transform)\n\n        const biomolDict = atoms.biomolDict\n\n        for (let key in biomolDict) {\n\n          if (biomolDict.hasOwnProperty(key)) {\n            let assembly = biomolDict[key]\n\n            assembly.partList.forEach(function(part){\n\n              part.matrixList.forEach(function(mat){\n\n                mat.premultiply(transform)\n                mat.multiply(invertTrasform)\n\n              })\n            })\n          }\n        }\n    } else if (atoms instanceof Float32Array) {\n\n      const n4 = n * 4\n      for (; i < n4; i += 4){\n\n        atoms[ i ] = cd[ i ]\n        atoms[ i + 1 ] = cd[ i + 1 ]\n        atoms[ i + 2 ] = cd[ i + 2 ]\n\n      }\n    } else {\n      Log.warn('transform: input type unknown')\n    }\n\n    return this.transformationMatrix\n  }\n}\nexport default Superposition\n","/**\n * @file Trajectory Player\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { defaults, createParams, updateParams } from '../utils'\nimport Trajectory from './trajectory'\n\nexport type TrajectoryPlayerInterpolateType = ''|'linear'|'spline'\nexport type TrajectoryPlayerMode = 'loop'|'once'\nexport type TrajectoryPlayerDirection = 'forward'|'backward'|'bounce'\n\nexport const TrajectoryPlayerDefaultParameters = {\n  step: 1,  // how many frames to advance when playing\n  timeout: 50,  // how many milliseconds to wait between playing frames\n  start: 0,  // first frame to play\n  end: 0,  // last frame to play\n  interpolateType: '' as TrajectoryPlayerInterpolateType,\n  interpolateStep: 5,  // window size used for interpolation\n  mode: 'loop' as TrajectoryPlayerMode,\n  direction: 'forward' as TrajectoryPlayerDirection\n}\nexport type TrajectoryPlayerParameters = typeof TrajectoryPlayerDefaultParameters\n\nexport interface TrajectoryPlayerSignals {\n  startedRunning: Signal\n  haltedRunning: Signal\n}\n\n/**\n * Trajectory player for animating coordinate frames\n * @example\n * var player = new TrajectoryPlayer(trajectory, {step: 1, timeout: 50});\n * player.play();\n */\nclass TrajectoryPlayer {\n  signals: TrajectoryPlayerSignals = {\n    startedRunning: new Signal(),\n    haltedRunning: new Signal()\n  }\n\n  parameters: TrajectoryPlayerParameters\n  traj: Trajectory\n\n  private _run = false\n  private _previousTime = 0\n  private _currentTime = 0\n  private _currentStep = 1\n  private _currentFrame: number|[number, number, number, number]\n  private _direction: TrajectoryPlayerDirection\n\n  /**\n   * make trajectory player\n   * @param {Trajectory} traj - the trajectory\n   * @param {TrajectoryPlayerParameters} [params] - parameter object\n   */\n  constructor (traj: Trajectory, params: Partial<TrajectoryPlayerParameters> = {}) {\n    traj.signals.playerChanged.add((player: TrajectoryPlayer) => {\n      if (player !== this) {\n        this.pause()\n      }\n    }, this)\n\n    const n = defaults(traj.frameCount, 1)\n\n    this.traj = traj\n    this.parameters = createParams(params, TrajectoryPlayerDefaultParameters)\n    this.parameters.end = Math.min(defaults(params.end, n - 1), n - 1)\n    this.parameters.step = defaults(params.step, Math.ceil((n + 1) / 100))\n\n    this._currentFrame = this.parameters.start\n    this._direction = this.parameters.direction === 'bounce' ? 'forward' : this.parameters.direction\n\n    traj.signals.countChanged.add((n: number) => {\n      this.parameters.end = Math.min(defaults(this.parameters.end, n - 1), n - 1)\n    }, this)\n\n    this._animate = this._animate.bind(this)\n  }\n\n  get isRunning () { return this._run }\n\n  /**\n   * set player parameters\n   * @param {TrajectoryPlayerParameters} [params] - parameter object\n   */\n  setParameters (params: Partial<TrajectoryPlayerParameters> = {}) {\n    updateParams(this.parameters, params)\n\n    if (params.direction !== undefined && this.parameters.direction !== 'bounce') {\n      this._direction = this.parameters.direction\n    }\n  }\n\n  _animate () {\n    if (!this._run) return\n\n    this._currentTime = window.performance.now()\n    const dt = this._currentTime - this._previousTime\n    const step = this.parameters.interpolateType ? this.parameters.interpolateStep : 1\n    const timeout = this.parameters.timeout / step\n    const traj = this.traj\n\n    if (traj && traj.frameCount && !traj.inProgress && dt >= timeout) {\n      if (this.parameters.interpolateType) {\n        if (this._currentStep > this.parameters.interpolateStep) {\n          this._currentStep = 1\n        }\n        if (this._currentStep === 1) {\n          this._currentFrame = this._nextInterpolated()\n        }\n        if (traj.hasFrame(this._currentFrame)) {\n          this._currentStep += 1\n          const t = this._currentStep / (this.parameters.interpolateStep + 1)\n          const [i, ip, ipp, ippp] = this._currentFrame as [number, number, number, number]\n          traj.setFrameInterpolated(\n            i, ip, ipp, ippp, t, this.parameters.interpolateType\n          )\n          this._previousTime = this._currentTime\n        } else {\n          traj.loadFrame(this._currentFrame)\n        }\n      } else {\n        const i = this._next()\n        if (traj.hasFrame(i)) {\n          traj.setFrame(i)\n          this._previousTime = this._currentTime\n        } else {\n          traj.loadFrame(i)\n        }\n      }\n    }\n\n    window.requestAnimationFrame(this._animate)\n  }\n\n  _next () {\n    const p = this.parameters\n    let i\n\n    if (this._direction === 'forward') {\n      i = this.traj.currentFrame + p.step\n    } else {\n      i = this.traj.currentFrame - p.step\n    }\n\n    if (i > p.end || i < p.start) {\n      if (p.direction === 'bounce') {\n        if (this._direction === 'forward') {\n          this._direction = 'backward'\n        } else {\n          this._direction = 'forward'\n        }\n      }\n\n      if (p.mode === 'once') {\n        this.pause()\n\n        if (p.direction === 'forward') {\n          i = p.end\n        } else if (p.direction === 'backward') {\n          i = p.start\n        } else {\n          if (this._direction === 'forward') {\n            i = p.start\n          } else {\n            i = p.end\n          }\n        }\n      } else {\n        if (this._direction === 'forward') {\n          i = p.start\n          if (p.interpolateType) {\n            i = Math.min(p.end, i + p.step)\n          }\n        } else {\n          i = p.end\n          if (p.interpolateType) {\n            i = Math.max(p.start, i - p.step)\n          }\n        }\n      }\n    }\n\n    return i\n  }\n\n  _nextInterpolated () {\n    const p = this.parameters\n    const i = this._next()\n    let ip, ipp, ippp\n\n    if (this._direction === 'forward') {\n      ip = Math.max(p.start, i - p.step)\n      ipp = Math.max(p.start, i - 2 * p.step)\n      ippp = Math.max(p.start, i - 3 * p.step)\n    } else {\n      ip = Math.min(p.end, i + p.step)\n      ipp = Math.min(p.end, i + 2 * p.step)\n      ippp = Math.min(p.end, i + 3 * p.step)\n    }\n\n    return [i, ip, ipp, ippp] as [number, number, number, number]\n  }\n\n  /**\n   * toggle between playing and pausing the animation\n   * @return {undefined}\n   */\n  toggle () {\n    if (this._run) {\n      this.pause()\n    } else {\n      this.play()\n    }\n  }\n\n  /**\n   * start the animation\n   * @return {undefined}\n   */\n  play () {\n    if (!this._run) {\n      if (this.traj.player !== this) {\n        this.traj.setPlayer(this)\n      }\n      this._currentStep = 1\n\n      const p = this.parameters\n      const frame = this.traj.currentFrame\n\n      // snap to the grid implied by this.step division and multiplication\n      // thus minimizing cache misses\n      let i = Math.ceil(frame / p.step) * p.step\n      // wrap when restarting from the limit (i.e. end or start)\n      if (p.direction === 'forward' && frame >= p.end) {\n        i = p.start\n      } else if (p.direction === 'backward' && frame <= p.start) {\n        i = p.end\n      }\n\n      this.traj.setFrame(i)\n\n      this._run = true\n      this._animate()\n      this.signals.startedRunning.dispatch()\n    }\n  }\n\n  /**\n   * pause the animation\n   * @return {undefined}\n   */\n  pause () {\n    this._run = false\n    this.signals.haltedRunning.dispatch()\n  }\n\n  /**\n   * stop the animation (pause and go to start-frame)\n   * @return {undefined}\n   */\n  stop () {\n    this.pause()\n    this.traj.setFrame(this.parameters.start)\n  }\n}\n\nexport default TrajectoryPlayer\n","/**\n * @file Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { Log } from '../globals'\nimport { defaults } from '../utils'\nimport { NumberArray } from '../types'\nimport { circularMean, arrayMean } from '../math/array-utils'\nimport { lerp, spline } from '../math/math-utils'\nimport Selection from '../selection/selection'\nimport Superposition from '../align/superposition'\nimport Structure from '../structure/structure'\nimport AtomProxy from '../proxy/atom-proxy'\nimport TrajectoryPlayer, { TrajectoryPlayerInterpolateType } from './trajectory-player'\n\n\nfunction centerPbc (coords: NumberArray, mean: number[], box: ArrayLike<number>) {\n  if (box[ 0 ] === 0 || box[ 8 ] === 0 || box[ 4 ] === 0) {\n    return\n  }\n\n  const n = coords.length\n\n  const bx = box[ 0 ]\n  const by = box[ 1 ]\n  const bz = box[ 2 ]\n  const mx = mean[ 0 ]\n  const my = mean[ 1 ]\n  const mz = mean[ 2 ]\n\n  const fx = -mx + bx + bx / 2\n  const fy = -my + by + by / 2\n  const fz = -mz + bz + bz / 2\n\n  for (let i = 0; i < n; i += 3) {\n    coords[ i + 0 ] = (coords[ i + 0 ] + fx) % bx\n    coords[ i + 1 ] = (coords[ i + 1 ] + fy) % by\n    coords[ i + 2 ] = (coords[ i + 2 ] + fz) % bz\n  }\n}\n\nfunction removePbc (x: NumberArray, box: ArrayLike<number>) {\n  if (box[ 0 ] === 0 || box[ 8 ] === 0 || box[ 4 ] === 0) {\n    return\n  }\n\n  // ported from GROMACS src/gmxlib/rmpbc.c:rm_gropbc()\n  // in-place\n\n  const n = x.length\n\n  for (let i = 3; i < n; i += 3) {\n    for (let j = 0; j < 3; ++j) {\n      const dist = x[ i + j ] - x[ i - 3 + j ]\n\n      if (Math.abs(dist) > 0.9 * box[ j * 3 + j ]) {\n        if (dist > 0) {\n          for (let d = 0; d < 3; ++d) {\n            x[ i + d ] -= box[ j * 3 + d ]\n          }\n        } else {\n          for (let d = 0; d < 3; ++d) {\n            x[ i + d ] += box[ j * 3 + d ]\n          }\n        }\n      }\n    }\n  }\n\n  return x\n}\n\nfunction removePeriodicity (x: NumberArray, box: ArrayLike<number>, mean: number[]) {\n  if (box[ 0 ] === 0 || box[ 8 ] === 0 || box[ 4 ] === 0) {\n    return\n  }\n\n  const n = x.length\n  for (let i = 3; i < n; i += 3) {\n    for (let j = 0; j < 3; ++j) {\n      const f = (x[ i + j ] - mean[ j ]) / box[ j * 3 + j ]\n      if (Math.abs(f) > 0.5) {\n        x[ i + j ] -= box[ j * 3 + j ] * Math.round(f)\n      }\n    }\n  }\n\n  return x\n}\n\nfunction circularMean3 (indices: NumberArray, coords: NumberArray, box: ArrayLike<number>) {\n  return [\n    circularMean(coords, box[ 0 ], 3, 0, indices),\n    circularMean(coords, box[ 1 ], 3, 1, indices),\n    circularMean(coords, box[ 2 ], 3, 2, indices)\n  ]\n}\n\nfunction arrayMean3 (coords: NumberArray) {\n  return [\n    arrayMean(coords, 3, 0),\n    arrayMean(coords, 3, 1),\n    arrayMean(coords, 3, 2)\n  ]\n}\n\nfunction interpolateSpline (c: NumberArray, cp: NumberArray, cpp: NumberArray, cppp: NumberArray, t: number) {\n  const m = c.length\n  const coords = new Float32Array(m)\n\n  for (let j0 = 0; j0 < m; j0 += 3) {\n    const j1 = j0 + 1\n    const j2 = j0 + 2\n    coords[ j0 ] = spline(cppp[ j0 ], cpp[ j0 ], cp[ j0 ], c[ j0 ], t, 1)\n    coords[ j1 ] = spline(cppp[ j1 ], cpp[ j1 ], cp[ j1 ], c[ j1 ], t, 1)\n    coords[ j2 ] = spline(cppp[ j2 ], cpp[ j2 ], cp[ j2 ], c[ j2 ], t, 1)\n  }\n\n  return coords\n}\n\nfunction interpolateLerp (c: NumberArray, cp: NumberArray, t: number) {\n  const m = c.length\n  const coords = new Float32Array(m)\n\n  for (let j0 = 0; j0 < m; j0 += 3) {\n    const j1 = j0 + 1\n    const j2 = j0 + 2\n    coords[ j0 ] = lerp(cp[ j0 ], c[ j0 ], t)\n    coords[ j1 ] = lerp(cp[ j1 ], c[ j1 ], t)\n    coords[ j2 ] = lerp(cp[ j2 ], c[ j2 ], t)\n  }\n\n  return coords\n}\n\n/**\n * Trajectory parameter object.\n * @typedef {Object} TrajectoryParameters - parameters\n *\n * @property {Number} deltaTime - timestep between frames in picoseconds\n * @property {Number} timeOffset - starting time of frames in picoseconds\n * @property {String} sele - to restrict atoms used for superposition\n * @property {Boolean} centerPbc - center on initial frame\n * @property {Boolean} removePeriodicity - move atoms into the origin box\n * @property {Boolean} remo - try fixing periodic boundary discontinuities\n * @property {Boolean} superpose - superpose on initial frame\n */\n\n/**\n * @example\n * trajectory.signals.frameChanged.add( function(i){ ... } );\n *\n * @typedef {Object} TrajectorySignals\n * @property {Signal<Integer>} countChanged - when the frame count is changed\n * @property {Signal<Integer>} frameChanged - when the set frame is changed\n * @property {Signal<TrajectoryPlayer>} playerChanged - when the player is changed\n */\n\nexport interface TrajectoryParameters {\n  deltaTime: number  // timestep between frames in picoseconds\n  timeOffset: number  // starting time of frames in picoseconds\n  sele: string  // to restrict atoms used for superposition\n  centerPbc: boolean  // center on initial frame\n  removePbc: boolean  // move atoms into the origin box\n  removePeriodicity: boolean  // try fixing periodic boundary discontinuities\n  superpose: boolean  // superpose on initial frame\n}\n\nexport interface TrajectorySignals {\n  countChanged: Signal\n  frameChanged: Signal\n  playerChanged: Signal\n}\n\n/**\n * Base class for trajectories, tying structures and coordinates together\n * @interface\n */\nclass Trajectory {\n  signals: TrajectorySignals = {\n    countChanged: new Signal(),\n    frameChanged: new Signal(),\n    playerChanged: new Signal()\n  }\n\n  deltaTime: number\n  timeOffset: number\n  sele: string\n  centerPbc: boolean\n  removePbc: boolean\n  removePeriodicity: boolean\n  superpose: boolean\n\n  name: string\n  frame: number\n  trajPath: string\n\n  initialCoords: Float32Array\n  structureCoords: Float32Array\n  selectionIndices: NumberArray\n  backboneIndices: NumberArray\n\n  coords1: Float32Array\n  coords2: Float32Array\n\n  frameCache: { [k: number]: Float32Array } = {}\n  loadQueue: { [k: number]: boolean } = {}\n  boxCache: { [k: number]: ArrayLike<number> } = {}\n  pathCache = {}\n  frameCacheSize = 0\n\n  atomCount: number\n  inProgress: boolean\n\n  selection: Selection  // selection to restrict atoms used for superposition\n  structure: Structure\n  player: TrajectoryPlayer\n\n  private _frameCount = 0\n  private _currentFrame = -1\n  private _disposed = false\n\n  /**\n   * @param {String} trajPath - trajectory source\n   * @param {Structure} structure - the structure object\n   * @param {TrajectoryParameters} params - trajectory parameters\n   */\n  constructor (trajPath: string, structure: Structure, params: Partial<TrajectoryParameters> = {}) {\n    this.deltaTime = defaults(params.deltaTime, 0)\n    this.timeOffset = defaults(params.timeOffset, 0)\n    this.centerPbc = defaults(params.centerPbc, false)\n    this.removePbc = defaults(params.removePbc, false)\n    this.removePeriodicity = defaults(params.removePeriodicity, false)\n    this.superpose = defaults(params.superpose, false)\n\n    this.name = trajPath.replace(/^.*[\\\\/]/, '')\n    this.trajPath = trajPath\n\n    this.selection = new Selection(\n      defaults(params.sele, 'backbone and not hydrogen')\n    )\n\n    this.selection.signals.stringChanged.add(() => {\n      this.selectionIndices = this.structure.getAtomIndices(this.selection)!\n      this._resetCache()\n      this._saveInitialCoords()\n      this.setFrame(this._currentFrame)\n    })\n  }\n\n  /**\n   * Number of frames in the trajectory\n   */\n  get frameCount () {\n    return this._frameCount\n  }\n\n  /**\n   * Currently set frame of the trajectory\n   */\n  get currentFrame () {\n    return this._currentFrame\n  }\n\n  _init (structure: Structure) {\n    this.setStructure(structure)\n    this._loadFrameCount()\n    this.setPlayer(new TrajectoryPlayer(this))\n  }\n\n  _loadFrameCount () {}\n\n  setStructure (structure: Structure) {\n    this.structure = structure\n    this.atomCount = structure.atomCount\n\n    this.backboneIndices = this._getIndices(\n      new Selection('backbone and not hydrogen')\n    )\n    this._makeAtomIndices()\n    this._saveStructureCoords()\n\n    this.selectionIndices = this._getIndices(this.selection)\n    this._resetCache()\n    this._saveInitialCoords()\n    this.setFrame(this._currentFrame)\n  }\n\n  _saveInitialCoords () {\n    if (this.structure.hasCoords()) {\n      this.initialCoords = new Float32Array(this.structureCoords)\n      this._makeSuperposeCoords()\n    } else if (this.frameCache[0]) {\n      this.initialCoords = new Float32Array(this.frameCache[0])\n      this._makeSuperposeCoords()\n    } else {\n      this.loadFrame(0, () => this._saveInitialCoords())\n    }\n  }\n\n  _saveStructureCoords () {\n    const p = { what: { position: true } }\n    this.structureCoords = this.structure.getAtomData(p).position!\n  }\n\n  setSelection (string: string) {\n    this.selection.setString(string)\n    return this\n  }\n\n  _getIndices (selection: Selection) {\n    let i = 0\n    const test = selection.test\n    const indices: number[] = []\n\n    if (test) {\n      this.structure.eachAtom((ap: AtomProxy) => {\n        if (test(ap)) indices.push(i)\n        i += 1\n      })\n    }\n\n    return indices\n  }\n\n  _makeSuperposeCoords () {\n    const n = this.selectionIndices.length * 3\n\n    this.coords1 = new Float32Array(n)\n    this.coords2 = new Float32Array(n)\n\n    const y = this.initialCoords\n    const coords2 = this.coords2\n\n    for (let i = 0; i < n; i += 3) {\n      const j = this.selectionIndices[ i / 3 ] * 3\n\n      coords2[ i + 0 ] = y[ j + 0 ]\n      coords2[ i + 1 ] = y[ j + 1 ]\n      coords2[ i + 2 ] = y[ j + 2 ]\n    }\n  }\n\n  _makeAtomIndices () {\n    Log.error('Trajectory._makeAtomIndices not implemented')\n  }\n\n  _resetCache () {\n    this.frameCache = {}\n    this.loadQueue = {}\n    this.boxCache = {}\n    this.pathCache = {}\n    this.frameCacheSize = 0\n    this.initialCoords = new Float32Array(0)\n  }\n\n  setParameters (params: Partial<TrajectoryParameters> = {}) {\n    let resetCache = false\n\n    if (params.centerPbc !== undefined && params.centerPbc !== this.centerPbc) {\n      this.centerPbc = params.centerPbc\n      resetCache = true\n    }\n\n    if (params.removePeriodicity !== undefined && params.removePeriodicity !== this.removePeriodicity) {\n      this.removePeriodicity = params.removePeriodicity\n      resetCache = true\n    }\n\n    if (params.removePbc !== undefined && params.removePbc !== this.removePbc) {\n      this.removePbc = params.removePbc\n      resetCache = true\n    }\n\n    if (params.superpose !== undefined && params.superpose !== this.superpose) {\n      this.superpose = params.superpose\n      resetCache = true\n    }\n\n    this.deltaTime = defaults(params.deltaTime, this.deltaTime)\n    this.timeOffset = defaults(params.timeOffset, this.timeOffset)\n\n    if (resetCache) {\n      this._resetCache()\n      this.setFrame(this._currentFrame)\n    }\n  }\n\n  /**\n   * Check if a frame is available\n   * @param  {Integer|Integer[]} i - the frame index\n   * @return {Boolean} frame availability\n   */\n  hasFrame (i: number|number[]) {\n    if (Array.isArray(i)) {\n      return i.every(j => !!this.frameCache[j])\n    } else {\n      return !!this.frameCache[i]\n    }\n  }\n\n  /**\n   * Set trajectory to a frame index\n   * @param {Integer} i - the frame index\n   * @param {Function} [callback] - fired when the frame has been set\n   */\n  setFrame (i: number, callback?: Function) {\n    if (i === undefined) return this\n\n    this.inProgress = true\n\n    // i = parseInt(i)  // TODO\n\n    if (i === -1 || this.frameCache[ i ]) {\n      this._updateStructure(i)\n      if (callback) callback()\n    } else {\n      this.loadFrame(i, () => {\n        this._updateStructure(i)\n        if (callback) callback()\n      })\n    }\n\n    return this\n  }\n\n  _interpolate (i: number, ip: number, ipp: number, ippp: number, t: number, type: TrajectoryPlayerInterpolateType) {\n    const fc = this.frameCache\n\n    let coords\n    if (type === 'spline') {\n      coords = interpolateSpline(fc[ i ], fc[ ip ], fc[ ipp ], fc[ ippp ], t)\n    } else {\n      coords = interpolateLerp(fc[ i ], fc[ ip ], t)\n    }\n\n    this.structure.updatePosition(coords)\n    this._currentFrame = i\n    this.signals.frameChanged.dispatch(i)\n  }\n\n  /**\n   * Interpolated and set trajectory to frame indices\n   * @param {Integer} i - the frame index\n   * @param {Integer} ip - one before frame index\n   * @param {Integer} ipp - two before frame index\n   * @param {Integer} ippp - three before frame index\n   * @param {Number} t - interpolation step [0,1]\n   * @param {String} type - interpolation type, '', 'spline' or 'linear'\n   * @param {Function} callback - fired when the frame has been set\n   */\n  setFrameInterpolated (i: number, ip: number, ipp: number, ippp: number, t: number, type: TrajectoryPlayerInterpolateType, callback?: Function) {\n    if (i === undefined) return this\n\n    const fc = this.frameCache\n    const iList: number[] = []\n\n    if (!fc[ ippp ]) iList.push(ippp)\n    if (!fc[ ipp ]) iList.push(ipp)\n    if (!fc[ ip ]) iList.push(ip)\n    if (!fc[ i ]) iList.push(i)\n\n    if (iList.length) {\n      this.loadFrame(iList, () => {\n        this._interpolate(i, ip, ipp, ippp, t, type)\n        if (callback) callback()\n      })\n    } else {\n      this._interpolate(i, ip, ipp, ippp, t, type)\n      if (callback) callback()\n    }\n\n    return this\n  }\n\n  /**\n   * Load frame index\n   * @param {Integer|Integer[]} i - the frame index\n   * @param {Function} callback - fired when the frame has been loaded\n   */\n  loadFrame (i: number|number[], callback?: Function) {\n    if (Array.isArray(i)) {\n      i.forEach(j => {\n        if (!this.loadQueue[j] && !this.frameCache[j]) {\n          this.loadQueue[j] = true\n          this._loadFrame(j, () => {\n            delete this.loadQueue[j]\n          })\n        }\n      })\n    } else {\n      if (!this.loadQueue[i] && !this.frameCache[i]) {\n        this.loadQueue[i] = true\n        this._loadFrame(i, () => {\n          delete this.loadQueue[i]\n          if (callback) callback()\n        })\n      }\n    }\n  }\n\n  /**\n   * Load frame index\n   * @abstract\n   * @param {Integer} i - the frame index\n   * @param {Function} callback - fired when the frame has been loaded\n   */\n  _loadFrame (i: number, callback?: Function) {\n    Log.error('Trajectory._loadFrame not implemented', i, callback)\n  }\n\n  _updateStructure (i: number) {\n    if (this._disposed) {\n      console.error('updateStructure: traj disposed')\n      return\n    }\n\n    if (i === -1) {\n      if (this.structureCoords) {\n        this.structure.updatePosition(this.structureCoords)\n      }\n    } else {\n      this.structure.updatePosition(this.frameCache[ i ])\n    }\n\n    this.structure.trajectory = {\n      name: this.trajPath,\n      frame: i\n    }\n\n    this._currentFrame = i\n    this.inProgress = false\n    this.signals.frameChanged.dispatch(i)\n  }\n\n  _doSuperpose (x: Float32Array) {\n    const n = this.selectionIndices.length * 3\n\n    const coords1 = this.coords1\n    const coords2 = this.coords2\n\n    for (let i = 0; i < n; i += 3) {\n      const j = this.selectionIndices[ i / 3 ] * 3\n\n      coords1[ i + 0 ] = x[ j + 0 ]\n      coords1[ i + 1 ] = x[ j + 1 ]\n      coords1[ i + 2 ] = x[ j + 2 ]\n    }\n\n    // TODO re-use superposition object\n    const sp = new Superposition(coords1, coords2)\n    sp.transform(x)\n  }\n\n  _process (i: number, box: ArrayLike<number>, coords: Float32Array, frameCount: number) {\n    this._setFrameCount(frameCount)\n\n    if (box) {\n      if (this.backboneIndices.length > 0 && this.centerPbc) {\n        const box2 = [ box[ 0 ], box[ 4 ], box[ 8 ] ]\n        const circMean = circularMean3(this.backboneIndices, coords, box2)\n        centerPbc(coords, circMean, box2)\n      }\n\n      if (this.removePeriodicity) {\n        const mean = arrayMean3(coords)\n        removePeriodicity(coords, box, mean)\n      }\n\n      if (this.removePbc) {\n        removePbc(coords, box)\n      }\n    }\n\n    if (this.selectionIndices.length > 0 && this.coords1 && this.superpose) {\n      this._doSuperpose(coords)\n    }\n\n    this.frameCache[ i ] = coords\n    this.boxCache[ i ] = box\n    this.frameCacheSize += 1\n  }\n\n  _setFrameCount (n: number) {\n    if (n !== this._frameCount) {\n      this._frameCount = n\n      this.signals.countChanged.dispatch(n)\n    }\n  }\n\n  /**\n   * Dispose of the trajectory object\n   * @return {undefined}\n   */\n  dispose () {\n    this._resetCache()  // aid GC\n    this._disposed = true\n    if (this.player) this.player.stop()\n  }\n\n  /**\n   * Set player for this trajectory\n   * @param {TrajectoryPlayer} player - the player\n   */\n  setPlayer (player: TrajectoryPlayer) {\n    this.player = player\n    this.signals.playerChanged.dispatch(player)\n  }\n\n  /**\n   * Get time for frame\n   * @param  {Integer} i - frame index\n   * @return {Number} time in picoseconds\n   */\n  getFrameTime (i: number) {\n    return this.timeOffset + i * this.deltaTime\n  }\n}\n\nexport default Trajectory\n","/**\n * @file Frames Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Structure from '../structure/structure'\nimport Frames from './frames'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\n/**\n * Frames trajectory class. Gets data from a frames object.\n */\nclass FramesTrajectory extends Trajectory {\n  path: string\n\n  frames: ArrayLike<number>[]\n  boxes: ArrayLike<number>[]\n\n  atomIndices?: ArrayLike<number>\n\n  constructor (frames: Frames, structure: Structure, params: TrajectoryParameters) {\n    const p = params || {}\n    p.timeOffset = defaults(p.timeOffset, frames.timeOffset)\n    p.deltaTime = defaults(p.deltaTime, frames.deltaTime)\n\n    super('', structure, p)\n\n    this.name = frames.name\n    this.path = frames.path\n\n    this.frames = frames.coordinates\n    this.boxes = frames.boxes\n\n    this._init(structure)\n  }\n\n  get type () { return 'frames' }\n\n  _makeAtomIndices () {\n    if (this.structure.type === 'StructureView') {\n      this.atomIndices = this.structure.getAtomIndices()\n    } else {\n      this.atomIndices = undefined\n    }\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    let coords\n    const frame = this.frames[ i ]\n\n    if (this.atomIndices) {\n      const indices = this.atomIndices\n      const m = indices.length\n\n      coords = new Float32Array(m * 3)\n\n      for (let j = 0; j < m; ++j) {\n        const j3 = j * 3\n        const idx3 = indices[ j ] * 3\n\n        coords[ j3 + 0 ] = frame[ idx3 + 0 ]\n        coords[ j3 + 1 ] = frame[ idx3 + 1 ]\n        coords[ j3 + 2 ] = frame[ idx3 + 2 ]\n      }\n    } else {\n      coords = new Float32Array(frame)\n    }\n\n    const box = this.boxes[ i ]\n    const frameCount = this.frames.length\n\n    this._process(i, box, coords, frameCount)\n\n    if (typeof callback === 'function') {\n      callback()\n    }\n  }\n\n  _loadFrameCount () {\n    if (this.frames) {\n      this._setFrameCount(this.frames.length)\n    }\n  }\n}\n\nexport default FramesTrajectory\n","/**\n * @file Structure Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\n/**\n * Structure trajectory class. Gets data from a structure object.\n */\nclass StructureTrajectory extends Trajectory {\n  atomIndices?: ArrayLike<number>\n\n  constructor (trajPath: string, structure: Structure, params: TrajectoryParameters) {\n    super('', structure, params)\n    this._init(structure)\n  }\n\n  get type () { return 'structure' }\n\n  _makeAtomIndices () {\n    if (this.structure.atomSet && this.structure.atomSet.getSize() < this.structure.atomStore.count) {\n      this.atomIndices = this.structure.getAtomIndices()\n    } else {\n      this.atomIndices = undefined\n    }\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    let coords\n    const structure = this.structure\n    const frame = structure.frames[ i ]\n\n    if (this.atomIndices) {\n      const indices = this.atomIndices\n      const m = indices.length\n\n      coords = new Float32Array(m * 3)\n\n      for (let j = 0; j < m; ++j) {\n        const j3 = j * 3\n        const idx3 = indices[ j ] * 3\n\n        coords[ j3 + 0 ] = frame[ idx3 + 0 ]\n        coords[ j3 + 1 ] = frame[ idx3 + 1 ]\n        coords[ j3 + 2 ] = frame[ idx3 + 2 ]\n      }\n    } else {\n      coords = new Float32Array(frame)\n    }\n\n    const box = structure.boxes[ i ]\n    const frameCount = structure.frames.length\n\n    this._process(i, box, coords, frameCount)\n\n    if (typeof callback === 'function') {\n      callback()\n    }\n  }\n\n  _loadFrameCount () {\n    this._setFrameCount(this.structure.frames.length)\n  }\n}\n\nexport default StructureTrajectory\n","/**\n * @file Remote Trajectory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, TrajectoryDatasource } from '../globals'\nimport Structure from '../structure/structure'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\n/**\n * Remote trajectory class. Gets data from an MDsrv instance.\n */\nclass RemoteTrajectory extends Trajectory {\n  atomIndices: number[][]\n\n  constructor (trajPath: string, structure: Structure, params: TrajectoryParameters) {\n    super(trajPath, structure, params)\n    this._init(structure)\n  }\n\n  get type () { return 'remote' }\n\n  _makeAtomIndices () {\n    const atomIndices = []\n\n    if (this.structure.type === 'StructureView') {\n      const indices = this.structure.getAtomIndices()!  // TODO\n      const n = indices.length\n\n      let p = indices[ 0 ]\n      let q = indices[ 0 ]\n\n      for (let i = 1; i < n; ++i) {\n        const r = indices[ i ]\n\n        if (q + 1 < r) {\n          atomIndices.push([ p, q + 1 ])\n          p = r\n        }\n\n        q = r\n      }\n\n      atomIndices.push([ p, q + 1 ])\n    } else {\n      atomIndices.push([ 0, this.atomCount ])\n    }\n\n    this.atomIndices = atomIndices\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    // TODO implement max frameCache size, re-use arrays\n\n    const request = new XMLHttpRequest()\n\n    const url = TrajectoryDatasource.getFrameUrl(this.trajPath, i)\n    const params = TrajectoryDatasource.getFrameParams(this.trajPath, this.atomIndices)\n\n    request.open('POST', url, true)\n    request.responseType = 'arraybuffer'\n    request.setRequestHeader(\n      'Content-type', 'application/x-www-form-urlencoded'\n    )\n\n    request.addEventListener('load', () => {\n      const arrayBuffer = request.response\n      if (!arrayBuffer) {\n        Log.error(`empty arrayBuffer for '${url}'`)\n        return\n      }\n\n      const frameCount = new Int32Array(arrayBuffer, 0, 1)[ 0 ]\n      // const time = new Float32Array( arrayBuffer, 1 * 4, 1 )[ 0 ];\n      const box = new Float32Array(arrayBuffer, 2 * 4, 9)\n      const coords = new Float32Array(arrayBuffer, 11 * 4)\n\n      this._process(i, box, coords, frameCount)\n      if (typeof callback === 'function') {\n        callback()\n      }\n    }, false)\n\n    request.send(params)\n  }\n\n  _loadFrameCount () {\n    const request = new XMLHttpRequest()\n\n    const url = TrajectoryDatasource.getCountUrl(this.trajPath)\n\n    request.open('GET', url, true)\n    request.addEventListener('load', () => {\n      this._setFrameCount(parseInt(request.response))\n    }, false)\n    request.send()\n  }\n}\n\nexport default RemoteTrajectory\n","/**\n * @file Callback Trajectory\n * @author Tarn W. Burton <twburton@gmail.com>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Trajectory, { TrajectoryParameters } from './trajectory'\n\ntype RequestCallback = (responseCallback: Function, i?: number, atomIndices?: number[][]) => void\n\n/**\n * Callback trajectory class. Gets data from an JavaScript function.\n */\nclass CallbackTrajectory extends Trajectory {\n  atomIndices: number[][]\n  requestCallback: RequestCallback\n\n  constructor (requestCallback: RequestCallback, structure: Structure, params: TrajectoryParameters) {\n    super('', structure, params)\n    this.requestCallback = requestCallback;\n    this._init(structure)\n  }\n\n  get type () { return 'callback' }\n\n  _makeAtomIndices () {\n    const atomIndices = []\n\n    if (this.structure.type === 'StructureView') {\n      const indices = this.structure.getAtomIndices()!  // TODO\n      const n = indices.length\n\n      let p = indices[ 0 ]\n      let q = indices[ 0 ]\n\n      for (let i = 1; i < n; ++i) {\n        const r = indices[ i ]\n\n        if (q + 1 < r) {\n          atomIndices.push([ p, q + 1 ])\n          p = r\n        }\n\n        q = r\n      }\n\n      atomIndices.push([ p, q + 1 ])\n    } else {\n      atomIndices.push([ 0, this.atomCount ])\n    }\n\n    this.atomIndices = atomIndices\n  }\n\n  _loadFrame (i: number, callback?: Function) {\n    this.requestCallback(\n      (i: number, box: ArrayLike<number>, coords: Float32Array, frameCount: number) => {\n        this._process(i, box, coords, frameCount)\n        if (typeof callback === 'function') {\n          callback()\n        }\n      }, i, this.atomIndices)\n  }\n\n  _loadFrameCount () {\n    this.requestCallback((count: number) => this._setFrameCount(count))\n  }\n}\n\nexport default CallbackTrajectory\n\n","/**\n * @file Structure View\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3 } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport Structure from './structure'\nimport Selection from '../selection/selection'\nimport BitArray from '../utils/bitarray'\n\nimport BondProxy from '../proxy/bond-proxy'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\nimport SpatialHash from '../geometry/spatial-hash';\nimport BondHash from '../store/bond-hash';\nimport ResidueMap from '../store/residue-map';\nimport AtomMap from '../store/atom-map';\nimport ModelStore from '../store/model-store';\nimport ChainStore from '../store/chain-store';\nimport ResidueStore from '../store/residue-store';\nimport AtomStore from '../store/atom-store';\nimport BondStore from '../store/bond-store';\nimport Validation from './validation';\nimport Unitcell from '../symmetry/unitcell';\nimport Entity from './entity';\nimport Assembly from '../symmetry/assembly';\nimport { Data } from './data';\n\n/**\n * Get view on structure restricted to the selection\n * @param  {Selection} selection - the selection\n * @return {StructureView} the view on the structure\n */\nStructure.prototype.getView = function (this: Structure, selection: Selection) {\n  // added here to avoid cyclic import dependency\n  return new StructureView(this, selection)\n}\n\n/**\n * View on the structure, restricted to the selection\n */\nclass StructureView extends Structure {\n  structure: Structure\n  selection: Selection\n\n  /**\n   * @param {Structure} structure - the structure\n   * @param {Selection} selection - the selection\n   */\n  constructor (structure: Structure, selection: Selection) {\n    super()\n\n    this.structure = structure\n    this.selection = selection\n\n    this.center = new Vector3()\n    this.boundingBox = new Box3()\n\n    this._bp = this.getBondProxy()\n    this._ap = this.getAtomProxy()\n    this._rp = this.getResidueProxy()\n    this._cp = this.getChainProxy()\n\n    if (this.selection) {\n      this.selection.signals.stringChanged.add(this.refresh, this)\n    }\n\n    this.structure.signals.refreshed.add(this.refresh, this)\n\n    this.refresh()\n  }\n\n  init () {}\n\n  get type () { return 'StructureView' }\n\n  get name () { return this.structure.name }\n  get path () { return this.structure.path }\n  get title () { return this.structure.title }\n  get id () { return this.structure.id }\n  get data (): Data { return this.structure.data }\n  get atomSetDict () { return this.structure.atomSetDict }\n  get biomolDict (): {[k: string]: Assembly} { return this.structure.biomolDict }\n  get entityList (): Entity[] { return this.structure.entityList }\n  get unitcell (): Unitcell|undefined { return this.structure.unitcell }\n  get frames () { return this.structure.frames }\n  get boxes () { return this.structure.boxes }\n  get validation (): Validation|undefined { return this.structure.validation }\n  get bondStore () { return this.structure.bondStore }\n  get backboneBondStore () { return this.structure.backboneBondStore }\n  get rungBondStore (): BondStore { return this.structure.rungBondStore }\n  get atomStore (): AtomStore { return this.structure.atomStore }\n  get residueStore (): ResidueStore { return this.structure.residueStore }\n  get chainStore (): ChainStore { return this.structure.chainStore }\n  get modelStore (): ModelStore { return this.structure.modelStore }\n  get atomMap (): AtomMap { return this.structure.atomMap }\n  get residueMap (): ResidueMap { return this.structure.residueMap }\n  get bondHash (): BondHash|undefined { return this.structure.bondHash }\n  get spatialHash (): SpatialHash|undefined { return this.structure.spatialHash }\n\n  get _hasCoords () { return this.structure._hasCoords }\n  set _hasCoords (value) { this.structure._hasCoords = value }\n\n  /**\n   * Updates atomSet, bondSet, atomSetCache, atomCount, bondCount, boundingBox, center.\n   * @emits {Structure.signals.refreshed} when refreshed\n   * @return {undefined}\n   */\n  refresh () {\n    if (Debug) Log.time('StructureView.refresh')\n\n    this.atomSetCache = {}\n    const structure = this.structure\n\n    if (this.selection.isAllSelection() &&\n        structure !== this && structure.atomSet && structure.bondSet\n    ) {\n      this.atomSet = structure.atomSet.clone()\n      this.bondSet = structure.bondSet.clone()\n\n      for (let name in this.atomSetDict) {\n        const atomSet = this.atomSetDict[ name ]\n        this.atomSetCache[ '__' + name ] = atomSet.clone()\n      }\n\n      this.atomCount = structure.atomCount\n      this.bondCount = structure.bondCount\n\n      this.boundingBox.copy(structure.boundingBox)\n      this.center.copy(structure.center)\n    } else if (this.selection.isNoneSelection() &&\n        structure !== this && structure.atomSet && structure.bondSet\n    ) {\n      this.atomSet = new BitArray(structure.atomCount)\n      this.bondSet = new BitArray(structure.bondCount)\n\n      for (let name in this.atomSetDict) {\n        this.atomSetCache[ '__' + name ] = new BitArray(structure.atomCount)\n      }\n\n      this.atomCount = 0\n      this.bondCount = 0\n\n      this.boundingBox.makeEmpty()\n      this.center.set(0, 0, 0)\n    } else {\n      this.atomSet = this.getAtomSet(this.selection, true)\n      if (structure.atomSet) {\n        this.atomSet = this.atomSet.intersection(structure.atomSet)\n      }\n\n      this.bondSet = this.getBondSet()\n\n      for (let name in this.atomSetDict) {\n        const atomSet = this.atomSetDict[ name ]\n        this.atomSetCache[ '__' + name ] = atomSet.makeIntersection(this.atomSet)\n      }\n\n      this.atomCount = this.atomSet.getSize()\n      this.bondCount = this.bondSet.getSize()\n\n      this.boundingBox = this.getBoundingBox()\n      this.center = this.boundingBox.getCenter(new Vector3())\n    }\n\n    if (Debug) Log.timeEnd('StructureView.refresh')\n\n    this.signals.refreshed.dispatch()\n  }\n\n  //\n\n  setSelection (selection: Selection) {\n    this.selection = selection\n\n    this.refresh()\n  }\n\n  getSelection (selection?: Selection) {\n    const seleList: string[] = []\n\n    if (selection && selection.string) {\n      seleList.push(selection.string)\n    }\n\n    const parentSelection = this.structure.getSelection()\n    if (parentSelection && parentSelection.string) {\n      seleList.push(parentSelection.string)\n    }\n\n    if (this.selection && this.selection.string) {\n      seleList.push(this.selection.string)\n    }\n\n    let sele = ''\n    if (seleList.length > 0) {\n      sele = `( ${seleList.join(' ) AND ( ')} )`\n    }\n\n    return new Selection(sele)\n  }\n\n  getStructure () {\n    return this.structure.getStructure()\n  }\n\n  //\n\n  eachBond (callback: (entity: BondProxy) => any, selection?: Selection) {\n    this.structure.eachBond(callback, this.getSelection(selection))\n  }\n\n  eachAtom (callback: (entity: AtomProxy) => any, selection?: Selection) {\n    const ap = this.getAtomProxy()\n    const atomSet = this.getAtomSet(selection)\n    const n = this.atomStore.count\n\n    if (atomSet.getSize() < n) {\n      atomSet.forEach(function (index) {\n        ap.index = index\n        callback(ap)\n      })\n    } else {\n      for (let i = 0; i < n; ++i) {\n        ap.index = i\n        callback(ap)\n      }\n    }\n  }\n\n  eachResidue (callback: (entity: ResidueProxy) => any, selection?: Selection) {\n    this.structure.eachResidue(callback, this.getSelection(selection))\n  }\n\n  /**\n   * Not implemented\n   * @alias StructureView#eachResidueN\n   * @return {undefined}\n   */\n  eachResidueN (n: number, callback: (entity: ResidueProxy) => any) {\n    console.error('StructureView.eachResidueN() not implemented')\n  }\n\n  eachChain (callback: (entity: ChainProxy) => any, selection?: Selection) {\n    this.structure.eachChain(callback, this.getSelection(selection))\n  }\n\n  eachModel (callback: (entity: ModelProxy) => any, selection?: Selection) {\n    this.structure.eachModel(callback, this.getSelection(selection))\n  }\n\n    //\n\n  getAtomSet (selection?: boolean|Selection|BitArray, ignoreView = false) {\n    let atomSet = this.structure.getAtomSet(selection)\n    if (!ignoreView && this.atomSet) {\n      atomSet = atomSet.makeIntersection(this.atomSet)\n    }\n\n    return atomSet\n  }\n\n  //\n\n  getAtomIndices (selection?: Selection) {\n    return this.structure.getAtomIndices(this.getSelection(selection))\n  }\n\n  refreshPosition () {\n    return this.structure.refreshPosition()\n  }\n\n  //\n\n  dispose () {\n    if (this.selection) {\n      this.selection.signals.stringChanged.remove(this.refresh, this)\n    }\n\n    this.structure.signals.refreshed.remove(this.refresh, this)\n\n    this.structure = new Structure() // delete old data\n\n    delete this.atomSet\n    delete this.bondSet\n\n  }\n}\n\nexport default StructureView\n","/**\n * @file Alignment\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log } from '../globals'\n\n// const nucleotides = 'ACTG';\nconst aminoacidsX = 'ACDEFGHIKLMNPQRSTVWY'\nconst aminoacids = 'ARNDCQEGHILKMFPSTWYVBZ?'\n\nconst blosum62x = [\n  [4, 0, -2, -1, -2, 0, -2, -1, -1, -1, -1, -2, -1, -1, -1, 1, 0, 0, -3, -2],        // A\n  [0, 9, -3, -4, -2, -3, -3, -1, -3, -1, -1, -3, -3, -3, -3, -1, -1, -1, -2, -2],    // C\n  [-2, -3, 6, 2, -3, -1, -1, -3, -1, -4, -3, 1, -1, 0, -2, 0, -1, -3, -4, -3],       // D\n  [-1, -4, 2, 5, -3, -2, 0, -3, 1, -3, -2, 0, -1, 2, 0, 0, -1, -2, -3, -2],          // E\n  [-2, -2, -3, -3, 6, -3, -1, 0, -3, 0, 0, -3, -4, -3, -3, -2, -2, -1, 1, 3],        // F\n  [0, -3, -1, -2, -3, 6, -2, -4, -2, -4, -3, 0, -2, -2, -2, 0, -2, -3, -2, -3],      // G\n  [-2, -3, -1, 0, -1, -2, 8, -3, -1, -3, -2, 1, -2, 0, 0, -1, -2, -3, -2, 2],        // H\n  [-1, -1, -3, -3, 0, -4, -3, 4, -3, 2, 1, -3, -3, -3, -3, -2, -1, 3, -3, -1],       // I\n  [-1, -3, -1, 1, -3, -2, -1, -3, 5, -2, -1, 0, -1, 1, 2, 0, -1, -2, -3, -2],        // K\n  [-1, -1, -4, -3, 0, -4, -3, 2, -2, 4, 2, -3, -3, -2, -2, -2, -1, 1, -2, -1],       // L\n  [-1, -1, -3, -2, 0, -3, -2, 1, -1, 2, 5, -2, -2, 0, -1, -1, -1, 1, -1, -1],        // M\n  [-2, -3, 1, 0, -3, 0, 1, -3, 0, -3, -2, 6, -2, 0, 0, 1, 0, -3, -4, -2],            // N\n  [-1, -3, -1, -1, -4, -2, -2, -3, -1, -3, -2, -2, 7, -1, -2, -1, -1, -2, -4, -3],   // P\n  [-1, -3, 0, 2, -3, -2, 0, -3, 1, -2, 0, 0, -1, 5, 1, 0, -1, -2, -2, -1],           // Q\n  [-1, -3, -2, 0, -3, -2, 0, -3, 2, -2, -1, 0, -2, 1, 5, -1, -1, -3, -3, -2],        // R\n  [1, -1, 0, 0, -2, 0, -1, -2, 0, -2, -1, 1, -1, 0, -1, 4, 1, -2, -3, -2],           // S\n  [0, -1, -1, -1, -2, -2, -2, -1, -1, -1, -1, 0, -1, -1, -1, 1, 5, 0, -2, -2],       // T\n  [0, -1, -3, -2, -1, -3, -3, 3, -2, 1, 1, -3, -2, -2, -3, -2, 0, 4, -3, -1],        // V\n  [-3, -2, -4, -3, 1, -2, -2, -3, -3, -2, -1, -4, -4, -2, -3, -3, -2, -3, 11, 2],    // W\n  [-2, -2, -3, -2, 3, -3, 2, -1, -2, -1, -1, -2, -3, -1, -2, -2, -2, -1, 2, 7]       // Y\n]\n\nconst blosum62 = [\n  // A  R  N  D  C  Q  E  G  H  I  L  K  M  F  P  S  T  W  Y  V  B  Z  X\n  [4, -1, -2, -2, 0, -1, -1, 0, -2, -1, -1, -1, -1, -2, -1, 1, 0, -3, -2, 0, -2, -1, 0], // A\n  [-1, 5, 0, -2, -3, 1, 0, -2, 0, -3, -2, 2, -1, -3, -2, -1, -1, -3, -2, -3, -1, 0, -1], // R\n  [-2, 0, 6, 1, -3, 0, 0, 0, 1, -3, -3, 0, -2, -3, -2, 1, 0, -4, -2, -3, 3, 0, -1], // N\n  [-2, -2, 1, 6, -3, 0, 2, -1, -1, -3, -4, -1, -3, -3, -1, 0, -1, -4, -3, -3, 4, 1, -1], // D\n  [0, -3, -3, -3, 9, -3, -4, -3, -3, -1, -1, -3, -1, -2, -3, -1, -1, -2, -2, -1, -3, -3, -2], // C\n  [-1, 1, 0, 0, -3, 5, 2, -2, 0, -3, -2, 1, 0, -3, -1, 0, -1, -2, -1, -2, 0, 3, -1], // Q\n  [-1, 0, 0, 2, -4, 2, 5, -2, 0, -3, -3, 1, -2, -3, -1, 0, -1, -3, -2, -2, 1, 4, -1], // E\n  [0, -2, 0, -1, -3, -2, -2, 6, -2, -4, -4, -2, -3, -3, -2, 0, -2, -2, -3, -3, -1, -2, -1], // G\n  [-2, 0, 1, -1, -3, 0, 0, -2, 8, -3, -3, -1, -2, -1, -2, -1, -2, -2, 2, -3, 0, 0, -1], // H\n  [-1, -3, -3, -3, -1, -3, -3, -4, -3, 4, 2, -3, 1, 0, -3, -2, -1, -3, -1, 3, -3, -3, -1], // I\n  [-1, -2, -3, -4, -1, -2, -3, -4, -3, 2, 4, -2, 2, 0, -3, -2, -1, -2, -1, 1, -4, -3, -1], // L\n  [-1, 2, 0, -1, -3, 1, 1, -2, -1, -3, -2, 5, -1, -3, -1, 0, -1, -3, -2, -2, 0, 1, -1], // K\n  [-1, -1, -2, -3, -1, 0, -2, -3, -2, 1, 2, -1, 5, 0, -2, -1, -1, -1, -1, 1, -3, -1, -1], // M\n  [-2, -3, -3, -3, -2, -3, -3, -3, -1, 0, 0, -3, 0, 6, -4, -2, -2, 1, 3, -1, -3, -3, -1], // F\n  [-1, -2, -2, -1, -3, -1, -1, -2, -2, -3, -3, -1, -2, -4, 7, -1, -1, -4, -3, -2, -2, -1, -2], // P\n  [1, -1, 1, 0, -1, 0, 0, 0, -1, -2, -2, 0, -1, -2, -1, 4, 1, -3, -2, -2, 0, 0, 0], // S\n  [0, -1, 0, -1, -1, -1, -1, -2, -2, -1, -1, -1, -1, -2, -1, 1, 5, -2, -2, 0, -1, -1, 0], // T\n  [-3, -3, -4, -4, -2, -2, -3, -2, -2, -3, -2, -3, -1, 1, -4, -3, -2, 11, 2, -3, -4, -3, -2], // W\n  [-2, -2, -2, -3, -2, -1, -2, -3, 2, -1, -1, -2, -1, 3, -3, -2, -2, 2, 7, -1, -3, -2, -1], // Y\n  [0, -3, -3, -3, -1, -2, -2, -3, -3, 3, 1, -2, 1, -1, -2, -2, 0, -3, -1, 4, -3, -2, -1], // V\n  [-2, -1, 3, 4, -3, 0, 1, -1, 0, -3, -4, 0, -3, -3, -2, 0, -1, -4, -3, -3, 4, 1, -1], // B\n  [-1, 0, 0, 1, -3, 3, 4, -2, 0, -3, -3, 1, -1, -3, -1, 0, -1, -3, -2, -2, 1, 4, -1], // Z\n  [0, -1, -1, -1, -2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -2, 0, 0, -2, -1, -1, -1, -1, -1]  // X\n]\n\nfunction prepareMatrix (cellNames: string, mat: number[][]) {\n  let j: number\n  let i = 0\n  const matDict: { [k: string]: { [k: string]: number } } = {}\n  mat.forEach(function (row) {\n    j = 0\n    const rowDict: { [k: string]: number } = {}\n    row.forEach(function (elm) {\n      rowDict[ cellNames[ j++ ] ] = elm\n    })\n    matDict[ cellNames[ i++ ] ] = rowDict\n  })\n  return matDict\n}\n\nconst SubstitutionMatrices = (function () {\n  return {\n    blosum62: prepareMatrix(aminoacids, blosum62),\n    blosum62x: prepareMatrix(aminoacidsX, blosum62x)\n  }\n}())\nexport type SubstitutionMatrix = ''|'blosum62'|'blosum62x'\n\nclass Alignment {\n  substMatrix: { [k: string]: { [k: string]: number } }\n\n  n: number\n  m: number\n  score?: number\n  ali: string\n\n  S: number[][]\n  V: number[][]\n  H: number[][]\n\n  ali1: string\n  ali2: string\n\n  constructor (readonly seq1: string, readonly seq2: string, readonly gapPenalty = -10, readonly gapExtensionPenalty = -1, substMatrix: SubstitutionMatrix = 'blosum62') {\n    // TODO try encoding seqs as integers and use array subst matrix, maybe faster\n\n    if (substMatrix) {\n      this.substMatrix = SubstitutionMatrices[ substMatrix ]\n    }\n  }\n\n  initMatrices () {\n    this.n = this.seq1.length\n    this.m = this.seq2.length\n\n    // Log.log(this.n, this.m);\n\n    this.score = undefined\n    this.ali = ''\n\n    this.S = []\n    this.V = []\n    this.H = []\n\n    for (let i = 0; i <= this.n; ++i) {\n      this.S[ i ] = []\n      this.V[ i ] = []\n      this.H[ i ] = []\n\n      for (let j = 0; j <= this.m; ++j) {\n        this.S[ i ][ j ] = 0\n        this.V[ i ][ j ] = 0\n        this.H[ i ][ j ] = 0\n      }\n    }\n\n    for (let i = 0; i <= this.n; ++i) {\n      this.S[ i ][ 0 ] = this.gap(0)\n      this.H[ i ][ 0 ] = -Infinity\n    }\n\n    for (let j = 0; j <= this.m; ++j) {\n      this.S[ 0 ][ j ] = this.gap(0)\n      this.V[ 0 ][ j ] = -Infinity\n    }\n\n    this.S[ 0 ][ 0 ] = 0\n\n    // Log.log(this.S, this.V, this.H);\n  }\n\n  gap (len: number) {\n    return this.gapPenalty + len * this.gapExtensionPenalty\n  }\n\n  makeScoreFn () {\n    const seq1 = this.seq1\n    const seq2 = this.seq2\n\n    const substMatrix = this.substMatrix\n\n    if (substMatrix) {\n      return function score (i: number, j: number) {\n        const c1 = seq1[ i ]\n        const c2 = seq2[ j ]\n\n        try {\n          return substMatrix[ c1 ][ c2 ]\n        } catch (e) {\n          return -4\n        }\n      }\n    } else {\n      Log.warn('Alignment: no subst matrix')\n\n      return function scoreNoSubstMat (i: number, j: number) {\n        const c1 = seq1[ i ]\n        const c2 = seq2[ j ]\n\n        return c1 === c2 ? 5 : -3\n      }\n    }\n  }\n\n  calc () {\n    if (Debug) Log.time('Alignment.calc')\n\n    this.initMatrices()\n\n    const gap0 = this.gap(0)\n    const scoreFn = this.makeScoreFn()\n    const gapExtensionPenalty = this.gapExtensionPenalty\n\n    const V = this.V\n    const H = this.H\n    const S = this.S\n\n    const n = this.n\n    const m = this.m\n\n    let Vi1, Si1, Vi, Hi, Si\n\n    for (let i = 1; i <= n; ++i) {\n      Si1 = S[ i - 1 ]\n      Vi1 = V[ i - 1 ]\n\n      Vi = V[ i ]\n      Hi = H[ i ]\n      Si = S[ i ]\n\n      for (let j = 1; j <= m; ++j) {\n        Vi[j] = Math.max(\n          Si1[ j ] + gap0,\n          Vi1[ j ] + gapExtensionPenalty\n        )\n\n        Hi[j] = Math.max(\n          Si[ j - 1 ] + gap0,\n          Hi[ j - 1 ] + gapExtensionPenalty\n        )\n\n        Si[j] = Math.max(\n          Si1[ j - 1 ] + scoreFn(i - 1, j - 1), // match\n          Vi[ j ], // del\n          Hi[ j ]  // ins\n        )\n      }\n    }\n\n    if (Debug) Log.timeEnd('Alignment.calc')\n\n    if (Debug) Log.log(this.S, this.V, this.H)\n  }\n\n  trace () {\n    if (Debug) Log.time('Alignment.trace')\n\n    this.ali1 = ''\n    this.ali2 = ''\n\n    const scoreFn = this.makeScoreFn()\n\n    let i = this.n\n    let j = this.m\n    let mat\n\n    if (this.S[i][j] >= this.V[i][j]) {\n      mat = 'S'\n      this.score = this.S[i][j]\n    } else if (this.V[i][j] >= this.H[i][j]) {\n      mat = 'V'\n      this.score = this.V[i][j]\n    } else {\n      mat = 'H'\n      this.score = this.H[i][j]\n    }\n\n    if (Debug) Log.log('Alignment: SCORE', this.score)\n    if (Debug) Log.log('Alignment: S, V, H', this.S[i][j], this.V[i][j], this.H[i][j])\n\n    while (i > 0 && j > 0) {\n      if (mat === 'S') {\n        if (this.S[i][j] === this.S[i - 1][j - 1] + scoreFn(i - 1, j - 1)) {\n          this.ali1 = this.seq1[i - 1] + this.ali1\n          this.ali2 = this.seq2[j - 1] + this.ali2\n          --i\n          --j\n          mat = 'S'\n        } else if (this.S[i][j] === this.V[i][j]) {\n          mat = 'V'\n        } else if (this.S[i][j] === this.H[i][j]) {\n          mat = 'H'\n        } else {\n          // Log.debug('Alignment: S');\n          --i\n          --j\n        }\n      } else if (mat === 'V') {\n        if (this.V[i][j] === this.V[i - 1][j] + this.gapExtensionPenalty) {\n          this.ali1 = this.seq1[i - 1] + this.ali1\n          this.ali2 = '-' + this.ali2\n          --i\n          mat = 'V'\n        } else if (this.V[i][j] === this.S[i - 1][j] + this.gap(0)) {\n          this.ali1 = this.seq1[i - 1] + this.ali1\n          this.ali2 = '-' + this.ali2\n          --i\n          mat = 'S'\n        } else {\n          // Log.debug('Alignment: V');\n          --i\n        }\n      } else if (mat === 'H') {\n        if (this.H[i][j] === this.H[i][j - 1] + this.gapExtensionPenalty) {\n          this.ali1 = '-' + this.ali1\n          this.ali2 = this.seq2[j - 1] + this.ali2\n          --j\n          mat = 'H'\n        } else if (this.H[i][j] === this.S[i][j - 1] + this.gap(0)) {\n          this.ali1 = '-' + this.ali1\n          this.ali2 = this.seq2[j - 1] + this.ali2\n          --j\n          mat = 'S'\n        } else {\n          // Log.debug('Alignment: H');\n          --j\n        }\n      } else {\n        Log.error('Alignment: no matrix')\n      }\n    }\n\n    while (i > 0) {\n      this.ali1 = this.seq1[ i - 1 ] + this.ali1\n      this.ali2 = '-' + this.ali2\n      --i\n    }\n\n    while (j > 0) {\n      this.ali1 = '-' + this.ali1\n      this.ali2 = this.seq2[ j - 1 ] + this.ali2\n      --j\n    }\n\n    if (Debug) Log.timeEnd('Alignment.trace')\n\n    if (Debug) Log.log([this.ali1, this.ali2])\n  }\n}\n\nexport default Alignment\n","/**\n * @file Align Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Selection from '../selection/selection'\nimport Alignment from './alignment'\nimport Superposition from './superposition'\n\n/**\n * Perform structural superposition of two structures,\n * optionally guided by a sequence alignment\n * @param  {Structure|StructureView} s1 - structure 1 which is superposed onto structure 2\n * @param  {Structure|StructureView} s2 - structure 2 onto which structure 1 is superposed\n * @param  {Boolean} [align] - guide the superposition by a sequence alignment\n * @param  {String} [sele1] - selection string for structure 1\n * @param  {String} [sele2] - selection string for structure 2\n * @return {undefined}\n */\nfunction superpose (s1: Structure, s2: Structure, align = false, sele1 = '', sele2 = '') {\n  let i: number\n  let j: number\n  let n: number\n  let atoms1\n  let atoms2\n\n  if (align) {\n    let _s1 = s1\n    let _s2 = s2\n\n    if (sele1 && sele2) {\n      _s1 = s1.getView(new Selection(sele1))\n      _s2 = s2.getView(new Selection(sele2))\n    }\n\n    const seq1 = _s1.getSequence()\n    const seq2 = _s2.getSequence()\n\n    // Log.log( seq1.join(\"\") );\n    // Log.log( seq2.join(\"\") );\n\n    const ali = new Alignment(seq1.join(''), seq2.join(''))\n\n    ali.calc()\n    ali.trace()\n\n    // Log.log( \"superpose alignment score\", ali.score );\n\n    // Log.log( ali.ali1 );\n    // Log.log( ali.ali2 );\n\n    let _i, _j\n    i = 0\n    j = 0\n    n = ali.ali1.length\n    const aliIdx1: boolean[] = []\n    const aliIdx2: boolean[] = []\n\n    for (let l = 0; l < n; ++l) {\n      const x = ali.ali1[ l ]\n      const y = ali.ali2[ l ]\n\n      _i = 0\n      _j = 0\n\n      if (x === '-') {\n        aliIdx2[ j ] = false\n      } else {\n        aliIdx2[ j ] = true\n        _i = 1\n      }\n\n      if (y === '-') {\n        aliIdx1[ i ] = false\n      } else {\n        aliIdx1[ i ] = true\n        _j = 1\n      }\n\n      i += _i\n      j += _j\n    }\n\n    // Log.log( i, j );\n\n    // Log.log( aliIdx1 );\n    // Log.log( aliIdx2 );\n\n    const _atoms1: number[] = []\n    const _atoms2: number[] = []\n    const ap1 = _s1.getAtomProxy()\n    const ap2 = _s2.getAtomProxy()\n\n    i = 0\n    _s1.eachResidue(function (r) {\n      if (r.traceAtomIndex === undefined ||\n            r.traceAtomIndex !== r.getAtomIndexByName('CA')) return\n\n      if (aliIdx1[ i ]) {\n        ap1.index = r.getAtomIndexByName('CA')!  // TODO\n        _atoms1.push(ap1.x, ap1.y, ap1.z)\n      }\n      i += 1\n    })\n\n    i = 0\n    _s2.eachResidue(function (r) {\n      if (r.traceAtomIndex === undefined ||\n            r.traceAtomIndex !== r.getAtomIndexByName('CA')) return\n\n      if (aliIdx2[ i ]) {\n        ap2.index = r.getAtomIndexByName('CA')!  // TODO\n        _atoms2.push(ap2.x, ap2.y, ap2.z)\n      }\n      i += 1\n    })\n\n    atoms1 = new Float32Array(_atoms1)\n    atoms2 = new Float32Array(_atoms2)\n  } else {\n    const sviewCa1 = s1.getView(new Selection(`${sele1} and .CA`))\n    const sviewCa2 = s2.getView(new Selection(`${sele2} and .CA`))\n\n    atoms1 = sviewCa1\n    atoms2 = sviewCa2\n  }\n\n  const superpose = new Superposition(atoms1, atoms2)\n  const result = superpose.transform(s1)\n  s1.refreshPosition()\n  return result\n}\n\nexport {\n  superpose\n}\n","/**\n * @file Sturucture Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Signal } from 'signals'\n\nimport { ComponentRegistry, MeasurementDefaultParams } from '../globals'\nimport {\n  defaults, /*deepEqual, */createRingBuffer, RingBuffer, createSimpleDict, SimpleDict\n} from '../utils'\nimport { smoothstep } from '../math/math-utils'\nimport Component, { ComponentSignals, ComponentDefaultParameters } from './component'\nimport RepresentationCollection from './representation-collection'\nimport TrajectoryElement from './trajectory-element'\nimport RepresentationElement from './representation-element'\nimport { makeTrajectory } from '../trajectory/trajectory-utils'\nimport { TrajectoryParameters } from '../trajectory/trajectory'\nimport Selection from '../selection/selection'\nimport Structure from '../structure/structure'\nimport StructureView from '../structure/structure-view'\nimport { superpose } from '../align/align-utils'\nimport Stage from '../stage/stage'\nimport StructureRepresentation, { StructureRepresentationParameters } from '../representation/structure-representation'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { Vector3, Box3 } from 'three';\nimport { AngleRepresentationParameters } from '../representation/angle-representation';\nimport { AxesRepresentationParameters } from '../representation/axes-representation';\nimport { BallAndStickRepresentationParameters } from '../representation/ballandstick-representation';\nimport { CartoonRepresentationParameters } from '../representation/cartoon-representation';\nimport { ContactRepresentationParameters } from '../representation/contact-representation';\nimport { DihedralRepresentationParameters } from '../representation/dihedral-representation';\nimport { DihedralHistogramRepresentationParameters } from '../representation/dihedral-histogram-representation';\nimport { DistanceRepresentationParameters } from '../representation/distance-representation';\nimport { HyperballRepresentationParameters } from '../representation/hyperball-representation';\nimport { LabelRepresentationParameters } from '../representation/label-representation';\nimport { LineRepresentationParameters } from '../representation/line-representation';\nimport { PointRepresentationParameters } from '../representation/point-representation';\nimport { SurfaceRepresentationParameters } from '../representation/surface-representation';\nimport { RibbonRepresentationParameters } from '../representation/ribbon-representation';\nimport { RocketRepresentationParameters } from '../representation/rocket-representation';\nimport { TraceRepresentationParameters } from '../representation/trace-representation';\nimport { UnitcellRepresentationParameters } from '../representation/unitcell-representation';\nimport { SliceRepresentationParameters } from '../representation/slice-representation'\nimport { MolecularSurfaceRepresentationParameters } from '../representation/molecularsurface-representation'\nimport { DotRepresentationParameters } from '../representation/dot-representation'\n\nexport type StructureRepresentationType = keyof StructureRepresentationParametersMap\n\ninterface StructureRepresentationParametersMap {\n  'angle':  AngleRepresentationParameters,\n  'axes' :  AxesRepresentationParameters,\n  'backbone': BallAndStickRepresentationParameters,\n  'ball+stick': BallAndStickRepresentationParameters,\n  'base': BallAndStickRepresentationParameters,\n  'cartoon': CartoonRepresentationParameters,\n  'contact': ContactRepresentationParameters,\n  'dihedral': DihedralRepresentationParameters,\n  'dihedral-histogram': DihedralHistogramRepresentationParameters,\n  'distance': DistanceRepresentationParameters,\n  'dot': DotRepresentationParameters,\n  'helixorient': StructureRepresentationParameters,\n  'hyperball': HyperballRepresentationParameters,\n  'label': LabelRepresentationParameters,\n  'licorice': BallAndStickRepresentationParameters,\n  'line': LineRepresentationParameters,\n  'molecularsurface': MolecularSurfaceRepresentationParameters,\n  'point': PointRepresentationParameters,\n  'ribbon': RibbonRepresentationParameters,\n  'rocket': RocketRepresentationParameters,\n  'rope': CartoonRepresentationParameters,\n  'slice': SliceRepresentationParameters,\n  'spacefill': BallAndStickRepresentationParameters,\n  'surface': SurfaceRepresentationParameters,\n  'trace': TraceRepresentationParameters,\n  'tube': CartoonRepresentationParameters,\n  'unitcell': UnitcellRepresentationParameters,\n  'validation': StructureRepresentationParameters\n}\n\nexport const StructureComponentDefaultParameters = Object.assign({\n  sele: '',\n  defaultAssembly: ''\n}, ComponentDefaultParameters)\nexport type StructureComponentParameters = typeof StructureComponentDefaultParameters\n\nexport interface StructureComponentSignals extends ComponentSignals {\n  trajectoryAdded: Signal  // when a trajectory is added\n  trajectoryRemoved: Signal  // when a trajectory is removed\n  defaultAssemblyChanged: Signal  // on default assembly change\n}\n\n/**\n * Component wrapping a {@link Structure} object\n *\n * @example\n * // get a structure component by loading a structure file into the stage\n * stage.loadFile( \"rcsb://4opj\" ).then( function( structureComponent ){\n *     structureComponent.addRepresentation( \"cartoon\" );\n *     structureComponent.autoView();\n * } );\n */\nclass StructureComponent extends Component {\n  readonly signals: StructureComponentSignals\n  readonly parameters: StructureComponentParameters\n  get defaultParameters () { return StructureComponentDefaultParameters }\n\n  selection: Selection\n  structureView: StructureView\n  readonly trajList: TrajectoryElement[] = []\n\n  pickBuffer: RingBuffer<number>\n  pickDict: SimpleDict<number[], number[]>\n  lastPick?: number\n\n  spacefillRepresentation: RepresentationElement\n  distanceRepresentation: RepresentationElement\n  angleRepresentation: RepresentationElement\n  dihedralRepresentation: RepresentationElement\n\n  measureRepresentations: RepresentationCollection\n\n  constructor (stage: Stage, readonly structure: Structure, params: Partial<StructureComponentParameters> = {}) {\n    super(stage, structure, Object.assign({ name: structure.name }, params))\n\n    this.signals = Object.assign(this.signals, {\n      trajectoryAdded: new Signal(),\n      trajectoryRemoved: new Signal(),\n      defaultAssemblyChanged: new Signal()\n    })\n\n    this.initSelection(this.parameters.sele)\n\n    //\n\n    this.pickBuffer = createRingBuffer(4)\n    this.pickDict = createSimpleDict()\n\n    this.spacefillRepresentation = this.addRepresentation('spacefill', {\n      sele: 'none',\n      opacity: MeasurementDefaultParams.opacity,\n      color: MeasurementDefaultParams.color,\n      disablePicking: true,\n      radiusType: 'data'\n    }, true)\n\n    this.distanceRepresentation = this.addRepresentation(\n      'distance', MeasurementDefaultParams, true\n    )\n    this.angleRepresentation = this.addRepresentation(\n      'angle', MeasurementDefaultParams, true\n    )\n    this.dihedralRepresentation = this.addRepresentation(\n      'dihedral', MeasurementDefaultParams, true\n    )\n\n    this.measureRepresentations = new RepresentationCollection([\n      this.spacefillRepresentation,\n      this.distanceRepresentation,\n      this.angleRepresentation,\n      this.dihedralRepresentation\n    ])\n\n    //\n\n    this.setDefaultAssembly(this.parameters.defaultAssembly)\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'structure' }\n\n  /**\n   * Initialize selection\n   * @private\n   * @param {String} sele - selection string\n   * @return {undefined}\n   */\n  initSelection (sele: string) {\n    /**\n     * Selection for {@link StructureComponent#structureView}\n     * @private\n     * @type {Selection}\n     */\n    this.selection = new Selection(sele)\n\n    /**\n     * View on {@link StructureComponent#structure}.\n     * Change its selection via {@link StructureComponent#setSelection}.\n     * @type {StructureView}\n     */\n    this.structureView = new StructureView(\n      this.structure, this.selection\n    )\n\n    this.selection.signals.stringChanged.add(() => {\n      this.structureView.setSelection(this.selection)\n\n      this.rebuildRepresentations()\n      this.rebuildTrajectories()\n    })\n  }\n\n  /**\n   * Set selection of {@link StructureComponent#structureView}\n   * @param {String} string - selection string\n   * @return {StructureComponent} this object\n   */\n  setSelection (string: string) {\n    this.parameters.sele = string\n    this.selection.setString(string)\n    return this\n  }\n\n  /**\n   * Set the default assembly\n   * @param {String} value - assembly name\n   * @return {undefined}\n   */\n  setDefaultAssembly (value:string) {\n    // filter out non-exsisting assemblies\n    if (this.structure.biomolDict[value] === undefined) value = ''\n    // only set default assembly when changed\n    if (this.parameters.defaultAssembly !== value) {\n      const reprParams = { defaultAssembly: value }\n      this.reprList.forEach(repr => repr.setParameters(reprParams))\n      this.measureRepresentations.setParameters(reprParams)\n      this.parameters.defaultAssembly = value\n      this.signals.defaultAssemblyChanged.dispatch(value)\n    }\n    return this\n  }\n\n  /**\n   * Rebuild all representations\n   * @return {undefined}\n   */\n  rebuildRepresentations () {\n    this.reprList.forEach((repr: RepresentationElement) => {\n      repr.build()\n    })\n    this.measureRepresentations.build()\n  }\n\n  /**\n   * Rebuild all trajectories\n   * @return {undefined}\n   */\n  rebuildTrajectories () {\n    this.trajList.forEach(trajComp => {\n      trajComp.trajectory.setStructure(this.structureView)\n    })\n  }\n\n  updateRepresentations (what: any) {\n    super.updateRepresentations(what)\n    this.measureRepresentations.update(what)\n  }\n\n  /**\n   * Overrides {@link Component.updateRepresentationMatrices} \n   * to also update matrix for measureRepresentations \n   */\n  updateRepresentationMatrices () {\n    super.updateRepresentationMatrices()\n    this.measureRepresentations.setParameters({ matrix: this.matrix })\n  }\n\n  addRepresentation <K extends keyof StructureRepresentationParametersMap>(\n    type: K,\n    params: Partial<StructureRepresentationParametersMap[K]>|{defaultAssembly: string} = {},\n    hidden = false\n  ) {\n    params.defaultAssembly = this.parameters.defaultAssembly\n\n    const reprComp = this._addRepresentation(type, this.structureView, params, hidden)\n    if (!hidden) {\n      reprComp.signals.parametersChanged.add(() => this.measureUpdate())\n    }\n    return reprComp\n  }\n\n  /**\n   * Add a new trajectory component to the structure\n   */\n  addTrajectory (trajPath = '', params: { [k: string]: any } = {}) {\n    const traj = makeTrajectory(trajPath, this.structureView, params as TrajectoryParameters)\n\n    traj.signals.frameChanged.add(() => {\n      this.updateRepresentations({ 'position': true })\n    })\n\n    const trajComp = new TrajectoryElement(this.stage, traj, params)\n    this.trajList.push(trajComp)\n    this.signals.trajectoryAdded.dispatch(trajComp)\n\n    return trajComp\n  }\n\n  removeTrajectory (traj: TrajectoryElement) {\n    const idx = this.trajList.indexOf(traj)\n    if (idx !== -1) {\n      this.trajList.splice(idx, 1)\n    }\n\n    traj.dispose()\n\n    this.signals.trajectoryRemoved.dispatch(traj)\n  }\n\n  dispose () {\n    // copy via .slice because side effects may change trajList\n    this.trajList.slice().forEach(traj => traj.dispose())\n\n    this.trajList.length = 0\n    this.structure.dispose()\n    this.measureRepresentations.dispose()\n\n    super.dispose()\n  }\n\n  /**\n   * Automatically center and zoom the component\n   * @param  {String|Integer} [sele] - selection string or duration if integer\n   * @param  {Integer} [duration] - duration of the animation, defaults to 0\n   * @return {undefined}\n   */\n  autoView (duration?: number): any\n  autoView (sele?: string|number, duration?: number) {\n    if (typeof sele === 'number') {\n      duration = sele\n      sele = ''\n    }\n\n    this.stage.animationControls.zoomMove(\n      this.getCenter(sele),\n      this.getZoom(sele),\n      defaults(duration, 0)\n    )\n  }\n\n  getBoxUntransformed (sele: string): Box3 {\n    let bb\n\n    if (sele) {\n      bb = this.structureView.getBoundingBox(new Selection(sele))\n    } else {\n      bb = this.structureView.boundingBox\n    }\n\n    return bb\n  }\n\n  getCenterUntransformed (sele: string): Vector3 {\n    if (sele && typeof sele === 'string') {\n      return this.structure.atomCenter(new Selection(sele))\n    } else {\n      return this.structure.center\n    }\n  }\n\n  superpose (component: StructureComponent, align: boolean, sele1: string, sele2: string) {\n    superpose(\n      this.structureView, component.structureView, align, sele1, sele2\n    )\n\n    this.updateRepresentations({ 'position': true })\n\n    return this\n  }\n\n  getMaxRepresentationRadius (atomIndex: number) {\n    let maxRadius = 0\n    const atom = this.structure.getAtomProxy(atomIndex)\n    this.eachRepresentation(reprElem => {\n      if (reprElem.getVisibility()) {\n        const repr: StructureRepresentation = reprElem.repr as any  // TODO\n        maxRadius = Math.max(repr.getAtomRadius(atom), maxRadius)\n      }\n    })\n    return maxRadius\n  }\n\n  measurePick (atom: AtomProxy) {\n    const pickCount = this.pickBuffer.count\n\n    if (this.lastPick === atom.index && pickCount >= 1) {\n      if (pickCount > 1) {\n        const atomList = this.pickBuffer.data\n        const atomListSorted = this.pickBuffer.data.sort()\n        if (this.pickDict.has(atomListSorted)) {\n          this.pickDict.del(atomListSorted)\n        } else {\n          this.pickDict.add(atomListSorted, atomList)\n        }\n        if (pickCount === 2) {\n          this.distanceRepresentation.setParameters({\n            atomPair: this.pickDict.values.filter(l => l.length === 2)\n          })\n        } else if (pickCount === 3) {\n          this.angleRepresentation.setParameters({\n            atomTriple: this.pickDict.values.filter(l => l.length === 3)\n          })\n        } else if (pickCount === 4) {\n          this.dihedralRepresentation.setParameters({\n            atomQuad: this.pickDict.values.filter(l => l.length === 4)\n          })\n        }\n      }\n      this.pickBuffer.clear()\n      this.lastPick = undefined\n    } else {\n      if (!this.pickBuffer.has(atom.index)) {\n        this.pickBuffer.push(atom.index)\n      }\n      this.lastPick = atom.index\n    }\n\n    this.measureUpdate()\n  }\n\n  measureClear () {\n    this.pickBuffer.clear()\n    this.lastPick = undefined\n    this.spacefillRepresentation.setSelection('none')\n  }\n\n  measureBuild () {\n    const md = this.measureData()\n    this.distanceRepresentation.setParameters({ atomPair: md.distance })\n    this.angleRepresentation.setParameters({ atomTriple: md.angle })\n    this.dihedralRepresentation.setParameters({ atomQuad: md.dihedral })\n  }\n\n  measureUpdate () {\n    const pickData = this.pickBuffer.data\n    const radiusData: { [k: number]: number } = {}\n    pickData.forEach(ai => {\n      const r = Math.max(0.1, this.getMaxRepresentationRadius(ai))\n      radiusData[ ai ] = r * (2.3 - smoothstep(0.1, 2, r))\n    })\n    this.spacefillRepresentation.setSelection(\n      pickData.length ? ( '@' + pickData.join(',') ) : 'none'\n    )\n    if (pickData.length)\n      this.spacefillRepresentation.setParameters({ radiusData })\n  }\n\n  measureData () {\n    const pv = this.pickDict.values\n    return {\n      distance: pv.filter(l => l.length === 2),\n      angle: pv.filter(l => l.length === 3),\n      dihedral: pv.filter(l => l.length === 4)\n    }\n  }\n\n  /**\n   * Remove all measurements, optionally limit to distance, angle or dihedral\n   */\n  removeAllMeasurements (type?: MeasurementFlags) {\n    const pd = this.pickDict\n    const pv = pd.values\n    const remove = function (len: number) {\n      pv.filter(l => l.length === len).forEach(l => pd.del(l.slice().sort()))\n    }\n    if (!type || type & MeasurementFlags.Distance) remove(2)\n    if (!type || type & MeasurementFlags.Angle) remove(3)\n    if (!type || type & MeasurementFlags.Dihedral) remove(4)\n    this.measureBuild()\n  }\n\n  /**\n   * Remove a measurement given as a pair, triple, quad of atom indices\n   */\n  removeMeasurement (atomList: number[]) {\n    this.pickDict.del(atomList.slice().sort())\n    this.measureBuild()\n  }\n\n  /**\n   * Add a measurement given as a pair, triple, quad of atom indices\n   */\n  addMeasurement (atomList: number[]) {\n    if (atomList.length < 2 || atomList.length > 4) return\n    const atomListSorted = atomList.slice().sort()\n    if (!this.pickDict.has(atomListSorted)) {\n      this.pickDict.add(atomListSorted, atomList)\n    }\n    this.measureBuild()\n  }\n}\n\nexport const enum MeasurementFlags {\n  Distance = 0x1,\n  Angle = 0x2,\n  Dihedral = 0x4\n}\n\nComponentRegistry.add('structure', StructureComponent)\nComponentRegistry.add('structureview', StructureComponent)\n\nexport default StructureComponent\n","/**\n * @file Trajectory Utils\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from '../structure/structure'\nimport Frames from './frames'\nimport { TrajectoryParameters } from './trajectory'\nimport FramesTrajectory from './frames-trajectory'\nimport StructureTrajectory from './structure-trajectory'\nimport RemoteTrajectory from './remote-trajectory'\nimport CallbackTrajectory from './callback-trajectory'\n\nexport function makeTrajectory (trajSrc: string|Frames, structure: Structure, params: TrajectoryParameters) {\n  let traj\n\n  if (trajSrc && trajSrc instanceof Frames) {\n    traj = new FramesTrajectory(trajSrc, structure, params)\n  } else if (!trajSrc && structure.frames) {\n    traj = new StructureTrajectory(trajSrc, structure, params)\n  } else if (trajSrc && typeof trajSrc === 'function') {\n    traj = new CallbackTrajectory(trajSrc, structure, params)\n  } else {\n    traj = new RemoteTrajectory(trajSrc, structure, params)\n  }\n\n  return traj\n}\n\n","/**\n * @file Surface Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ComponentRegistry } from '../globals'\nimport Component, { ComponentParameters } from './component'\nimport Stage from '../stage/stage'\nimport Surface from '../surface/surface'\nimport { Vector3, Box3 } from 'three';\nimport RepresentationElement from './representation-element';\n\nexport type SurfaceRepresentationType = 'surface'|'dot'\n\n/**\n * Component wrapping a {@link Surface} object\n *\n * @example\n * // get a surface component by loading a surface file into the stage\n * stage.loadFile( \"url/for/surface\" ).then( function( surfaceComponent ){\n *     surfaceComponent.addRepresentation( \"surface\" );\n *     surfaceComponent.autoView();\n * } );\n */\nclass SurfaceComponent extends Component {\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Surface} surface - surface object to wrap\n   * @param {ComponentParameters} params - component parameters\n   */\n  constructor (stage: Stage, readonly surface: Surface, params: Partial<ComponentParameters> = {}) {\n    super(stage, surface, Object.assign({ name: surface.name }, params))\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'surface' }\n\n  /**\n   * Add a new surface representation to the component\n   * @param {String} type - the name of the representation, one of:\n   *                        surface, dot.\n   * @param {SurfaceRepresentationParameters} params - representation parameters\n   * @return {RepresentationComponent} the created representation wrapped into\n   *                                   a representation component object\n   */\n  addRepresentation (type: SurfaceRepresentationType, params: { [k: string]: any } = {}): RepresentationElement {\n    return this._addRepresentation(type, this.surface, params)\n  }\n\n  getBoxUntransformed (): Box3 {\n    return this.surface.boundingBox\n  }\n\n  getCenterUntransformed (): Vector3 {\n    return this.surface.center\n  }\n\n  dispose () {\n    this.surface.dispose()\n    super.dispose()\n  }\n}\n\nComponentRegistry.add('surface', SurfaceComponent)\n\nexport default SurfaceComponent\n","/**\n * @file Volume Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ComponentRegistry } from '../globals'\nimport Component, { ComponentParameters } from './component'\nimport Stage from '../stage/stage'\nimport Volume from '../surface/volume'\nimport { Box3, Vector3 } from 'three';\nimport RepresentationElement from './representation-element';\n\nexport type VolumeRepresentationType = 'surface'|'slice'|'dot'\n\n/**\n * Component wrapping a {@link Volume} object\n *\n * @example\n * // get a volume component by loading a volume file into the stage\n * stage.loadFile( \"url/for/volume\" ).then(function(volumeComponent){\n *   volumeComponent.addRepresentation('surface');\n *   volumeComponent.autoView();\n * });\n */\nclass VolumeComponent extends Component {\n  /**\n   * @param {Stage} stage - stage object the component belongs to\n   * @param {Volume} volume - volume object to wrap\n   * @param {ComponentParameters} params - component parameters\n   */\n  constructor (stage: Stage, readonly volume: Volume, params: Partial<ComponentParameters> = {}) {\n    super(stage, volume, Object.assign({ name: volume.name }, params))\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'volume' }\n\n  /**\n   * Add a new volume representation to the component\n   */\n  addRepresentation (type: VolumeRepresentationType, params: { [k: string]: any } = {}): RepresentationElement {\n    return this._addRepresentation(type, this.volume, params)\n  }\n\n  getBoxUntransformed (): Box3 {\n    return this.volume.boundingBox\n  }\n\n  getCenterUntransformed (): Vector3 {\n    return this.volume.center\n  }\n\n  dispose () {\n    this.volume.dispose()\n\n    super.dispose()\n  }\n}\n\nComponentRegistry.add('volume', VolumeComponent)\n\nexport default VolumeComponent\n","/**\n * @file Component Collection\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Component from './component'\nimport Collection from './collection'\n\nclass ComponentCollection extends Collection<Component> {\n  addRepresentation (name: string, params: any) {\n  \treturn this.forEach((comp) => comp.addRepresentation(name, params))\n  }\n\n  autoView (duration: number) {\n    return this.forEach((comp) => comp.autoView(duration))\n  }\n}\n\nexport default ComponentCollection\n","/**\n * @file Stage\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Box3 } from 'three'\nimport { Signal } from 'signals'\n\nimport {\n  Debug, Log, Mobile, ComponentRegistry, ParserRegistry\n} from '../globals'\nimport { defaults, createParams, updateParams } from '../utils'\nimport { degToRad, clamp, pclamp } from '../math/math-utils'\nimport Counter from '../utils/counter'\nimport Viewer from '../viewer/viewer'\nimport { ImageParameters } from '../viewer/viewer-utils'\nimport MouseObserver from './mouse-observer'\n\nimport TrackballControls from '../controls/trackball-controls'\nimport PickingControls from '../controls/picking-controls'\nimport ViewerControls from '../controls/viewer-controls'\nimport AnimationControls from '../controls/animation-controls'\nimport MouseControls, { MouseControlPreset } from '../controls/mouse-controls'\nimport KeyControls from '../controls/key-controls'\n\nimport PickingBehavior from './picking-behavior'\nimport MouseBehavior from './mouse-behavior'\nimport AnimationBehavior from './animation-behavior'\nimport KeyBehavior from './key-behavior'\n\nimport Component, { ComponentParameters } from '../component/component'\nimport RepresentationElement from '../component/representation-element'\nimport StructureComponent from '../component/structure-component'\nimport SurfaceComponent from '../component/surface-component'\nimport VolumeComponent from '../component/volume-component'\nimport ComponentCollection from '../component/component-collection'\nimport RepresentationCollection from '../component/representation-collection'\nimport { autoLoad, getFileInfo, LoaderParameters } from '../loader/loader-utils'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Animation from '../animation/animation'\nimport Selection from '../selection/selection'\n\nimport Structure from '../structure/structure'\nimport Surface from '../surface/surface'\nimport Volume from '../surface/volume'\nimport Shape from '../geometry/shape'\nimport Script from '../script'\n\nfunction matchName (name: string|RegExp, object: { name: string }) {\n  if (name instanceof RegExp) {\n    return object.name.match(name) !== null\n  } else {\n    return object.name === name\n  }\n}\n\nconst tmpZoomVector = new Vector3()\n\ndeclare global {\n  interface Document {\n    mozFullScreen: boolean\n    mozFullScreenEnabled: boolean\n    mozFullScreenElement: Element\n    mozCancelFullScreen(): void\n\n    msFullscreenEnabled: boolean\n    msFullscreenElement: Element\n    msExitFullscreen(): void\n  }\n\n  interface Element {\n    mozRequestFullScreen(): void\n    msRequestFullscreen(): void\n  }\n}\n\n/**\n * Stage parameter object.\n * @typedef {Object} StageParameters - stage parameters\n * @property {Color} backgroundColor - background color\n * @property {Integer} sampleLevel - sampling level for antialiasing, between -1 and 5;\n *                                   -1: no sampling, 0: only sampling when not moving\n * @property {Boolean} workerDefault - default value for useWorker parameter of representations\n * @property {Float} rotateSpeed - camera-controls rotation speed, between 0 and 10\n * @property {Float} zoomSpeed - camera-controls zoom speed, between 0 and 10\n * @property {Float} panSpeed - camera-controls pan speed, between 0 and 10\n * @property {Float} clipNear - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {Float} clipFar - position of camera far/back clipping plane\n *                               in percent of scene bounding box\n * @property {Float} clipDist - camera clipping distance in Angstrom\n * @property {String} clipMode - how to interpret clipNear/Far and fogNear/Far values: \"scene\" for scene-relative, \"camera\" for camera-relative\n * @property {String} clipScale - \"relative\" or \"absolute\": interpret clipNear/Far and fogNear/Far as percentage of bounding box or absolute Angstroms (ignored when clipMode==camera)\n * @property {Float} fogNear - position of the start of the fog effect\n *                               in percent of scene bounding box\n * @property {Float} fogFar - position where the fog is in full effect\n *                              in percent of scene bounding box\n * @property {String} cameraType - type of camera, either 'persepective' or 'orthographic'\n * @property {Float} cameraFov - perspective camera field of view in degree, between 15 and 120\n * @property {Float} cameraEyeSep - stereo camera eye seperation\n * @property {Color} lightColor - point light color\n * @property {Float} lightIntensity - point light intensity\n * @property {Color} ambientColor - ambient light color\n * @property {Float} ambientIntensity - ambient light intensity\n * @property {Integer} hoverTimeout - timeout for hovering\n */\n\nexport interface StageSignals {\n  parametersChanged: Signal\n  fullscreenChanged: Signal\n  componentAdded: Signal\n  componentRemoved: Signal\n  clicked: Signal\n  hovered: Signal\n}\n\nexport type RenderQualityType = 'auto'|'low'|'medium'|'high'\n\nexport const StageDefaultParameters = {\n  impostor: true,\n  quality: 'medium' as RenderQualityType,\n  workerDefault: true,\n  sampleLevel: 0,\n  backgroundColor: 'black' as string|number,\n  rotateSpeed: 2.0,\n  zoomSpeed: 1.2,\n  panSpeed: 1.0,\n  clipNear: 0,\n  clipFar: 100,\n  clipDist: 10,\n  clipMode: 'scene',\n  clipScale: 'relative',\n  fogNear: 50,\n  fogFar: 100,\n  cameraFov: 40,\n  cameraEyeSep: 0.3,\n  cameraType: 'perspective' as 'perspective'|'orthographic'|'stereo',\n  lightColor: 0xdddddd as string|number,\n  lightIntensity: 1.0,\n  ambientColor: 0xdddddd as string|number,\n  ambientIntensity: 0.2,\n  hoverTimeout: 0,\n  tooltip: true,\n  mousePreset: 'default' as MouseControlPreset\n}\nexport type StageParameters = typeof StageDefaultParameters\n\nexport interface StageLoadFileParams extends LoaderParameters {\n  defaultRepresentation: boolean,\n  assembly: string\n}\n\n/**\n * Stage class, central for creating molecular scenes with NGL.\n *\n * @example\n * var stage = new Stage( \"elementId\", { backgroundColor: \"white\" } );\n */\nclass Stage {\n  signals: StageSignals = {\n    parametersChanged: new Signal(),\n    fullscreenChanged: new Signal(),\n    componentAdded: new Signal(),\n    componentRemoved: new Signal(),\n    clicked: new Signal(),\n    hovered: new Signal()\n  }\n  parameters: StageParameters\n\n  /**\n   * Counter that keeps track of various potentially long-running tasks,\n   * including file loading and surface calculation.\n   */\n  tasks = new Counter()\n  compList: Component[] = []\n  defaultFileParams = {}\n  logList: string[] = []\n\n  transformComponent?: Component\n  transformAtom?: AtomProxy\n\n  viewer: Viewer\n  tooltip: HTMLElement\n  lastFullscreenElement: HTMLElement\n\n  mouseObserver: MouseObserver\n  viewerControls: ViewerControls\n  trackballControls: TrackballControls\n  pickingControls: PickingControls\n  animationControls: AnimationControls\n  mouseControls: MouseControls\n  keyControls: KeyControls\n\n  pickingBehavior: PickingBehavior\n  mouseBehavior: MouseBehavior\n  animationBehavior: AnimationBehavior\n  keyBehavior: KeyBehavior\n\n  spinAnimation: Animation\n  rockAnimation: Animation\n\n  constructor (idOrElement: string|HTMLElement, params: Partial<StageParameters> = {}) {\n    this.viewer = new Viewer(idOrElement)\n    if (!this.viewer.renderer) return\n\n    this.tooltip = document.createElement('div')\n    Object.assign(this.tooltip.style, {\n      display: 'none',\n      position: 'fixed',\n      zIndex: '1000000',\n      pointerEvents: 'none',\n      backgroundColor: 'rgba( 0, 0, 0, 0.6 )',\n      color: 'lightgrey',\n      padding: '8px',\n      fontFamily: 'sans-serif'\n    })\n    this.viewer.container.appendChild(this.tooltip)\n\n    this.mouseObserver = new MouseObserver(this.viewer.renderer.domElement)\n    this.viewerControls = new ViewerControls(this)\n    this.trackballControls = new TrackballControls(this)\n    this.pickingControls = new PickingControls(this)\n    this.animationControls = new AnimationControls(this)\n    this.mouseControls = new MouseControls(this)\n    this.keyControls = new KeyControls(this)\n\n    this.pickingBehavior = new PickingBehavior(this)\n    this.mouseBehavior = new MouseBehavior(this)\n    this.animationBehavior = new AnimationBehavior(this)\n    this.keyBehavior = new KeyBehavior(this)\n\n    this.spinAnimation = this.animationControls.spin([ 0, 1, 0 ], 0.005)\n    this.spinAnimation.pause(true)\n    this.rockAnimation = this.animationControls.rock([ 0, 1, 0 ], 0.005)\n    this.rockAnimation.pause(true)\n\n    // must come after the viewer has been instantiated\n    this.parameters = createParams(params, StageDefaultParameters)\n    this.setParameters(this.parameters)\n\n    this.viewer.animate()\n  }\n\n  /**\n   * Set stage parameters\n   */\n  setParameters (params: Partial<StageParameters> = {}) {\n    updateParams(this.parameters, params)\n\n    const p = params\n    const tp = this.parameters\n\n    const viewer = this.viewer\n    const controls = this.trackballControls\n\n    // apply parameters\n    if (p.quality !== undefined) this.setQuality(tp.quality)\n    if (p.impostor !== undefined) this.setImpostor(tp.impostor)\n    if (p.rotateSpeed !== undefined) controls.rotateSpeed = tp.rotateSpeed\n    if (p.zoomSpeed !== undefined) controls.zoomSpeed = tp.zoomSpeed\n    if (p.panSpeed !== undefined) controls.panSpeed = tp.panSpeed\n    if (p.mousePreset !== undefined) this.mouseControls.preset(tp.mousePreset)\n    this.mouseObserver.setParameters({ hoverTimeout: tp.hoverTimeout })\n    viewer.setClip(tp.clipNear, tp.clipFar, tp.clipDist, tp.clipMode, tp.clipScale)\n    viewer.setFog(undefined, tp.fogNear, tp.fogFar)\n    viewer.setCamera(tp.cameraType, tp.cameraFov, tp.cameraEyeSep)\n    viewer.setSampling(tp.sampleLevel)\n    viewer.setBackground(tp.backgroundColor)\n    viewer.setLight(tp.lightColor, tp.lightIntensity, tp.ambientColor, tp.ambientIntensity)\n\n    this.signals.parametersChanged.dispatch(this.getParameters())\n\n    return this\n  }\n\n  log (msg: string) {\n    console.log('STAGE LOG', msg)\n    this.logList.push(msg)\n  }\n\n  /**\n   * Get stage parameters\n   */\n  getParameters () {\n    return Object.assign({}, this.parameters)\n  }\n\n  /**\n   * Create default representations for the given component\n   * @param  {StructureComponent|SurfaceComponent} object - component to create the representations for\n   * @return {undefined}\n   */\n  defaultFileRepresentation (component: Component) {\n    if (component instanceof StructureComponent) {\n      component.setSelection('/0')\n\n      let atomCount, residueCount, instanceCount\n      const structure = component.structure\n\n      if (structure.biomolDict.BU1) {\n        const assembly = structure.biomolDict.BU1\n        atomCount = assembly.getAtomCount(structure)\n        residueCount = assembly.getResidueCount(structure)\n        instanceCount = assembly.getInstanceCount()\n        component.setDefaultAssembly('BU1')\n      } else {\n        atomCount = structure.getModelProxy(0).atomCount\n        residueCount = structure.getModelProxy(0).residueCount\n        instanceCount = 1\n      }\n\n      let sizeScore = atomCount\n\n      if (Mobile) {\n        sizeScore *= 4\n      }\n\n      const backboneOnly = structure.atomStore.count / structure.residueStore.count < 2\n      if (backboneOnly) {\n        sizeScore *= 10\n      }\n\n      let colorScheme = 'chainname'\n      let colorScale = 'RdYlBu'\n      let colorReverse = false\n      if (structure.getChainnameCount(new Selection('polymer and /0')) === 1) {\n        colorScheme = 'residueindex'\n        colorScale = 'Spectral'\n        colorReverse = true\n      }\n\n      if (Debug) console.log(sizeScore, atomCount, instanceCount, backboneOnly)\n\n      if (residueCount / instanceCount < 4) {\n        component.addRepresentation('ball+stick', {\n          colorScheme: 'element',\n          radiusScale: 2.0,\n          aspectRatio: 1.5,\n          bondScale: 0.3,\n          bondSpacing: 0.75,\n          quality: 'auto'\n        })\n      } else if ((instanceCount > 5 && sizeScore > 15000) || sizeScore > 700000) {\n        let scaleFactor = (\n          Math.min(\n            2.0,\n            Math.max(\n              0.1,\n              6000 / (sizeScore / instanceCount)\n            )\n          )\n        )\n        if (backboneOnly) scaleFactor = Math.min(scaleFactor, 0.5)\n\n        component.addRepresentation('surface', {\n          colorScheme, colorScale, colorReverse,\n          sele: 'polymer',\n          surfaceType: 'av',\n          probeRadius: 1.4,\n          scaleFactor: scaleFactor,\n          useWorker: false\n        })\n      } else if (sizeScore > 250000) {\n        component.addRepresentation('backbone', {\n          colorScheme, colorScale, colorReverse,\n          lineOnly: true\n        })\n      } else if (sizeScore > 100000) {\n        component.addRepresentation('backbone', {\n          colorScheme, colorScale, colorReverse,\n          quality: 'low',\n          disableImpostor: true,\n          radiusScale: 2.0\n        })\n      } else if (sizeScore > 80000) {\n        component.addRepresentation('backbone', {\n          colorScheme, colorScale, colorReverse,\n          radiusScale: 2.0\n        })\n      } else {\n        component.addRepresentation('cartoon', {\n          colorScheme, colorScale, colorReverse,\n          radiusScale: 0.7,\n          aspectRatio: 5,\n          quality: 'auto'\n        })\n        if (sizeScore < 50000) {\n          component.addRepresentation('base', {\n            colorScheme, colorScale, colorReverse,\n            quality: 'auto'\n          })\n        }\n        component.addRepresentation('ball+stick', {\n          sele: 'ligand',\n          colorScheme: 'element',\n          radiusScale: 2.0,\n          aspectRatio: 1.5,\n          bondScale: 0.3,\n          bondSpacing: 0.75,\n          quality: 'auto'\n        })\n      }\n\n      // add frames as trajectory\n      if (component.structure.frames.length) {\n        component.addTrajectory()\n      }\n    } else if (component instanceof SurfaceComponent) {\n      component.addRepresentation('surface')\n    } else if (component instanceof VolumeComponent) {\n      component.addRepresentation('surface')\n    }\n\n    this.tasks.onZeroOnce(this.autoView, this)\n  }\n\n  /**\n   * Load a file onto the stage\n   *\n   * @example\n   * // load from URL\n   * stage.loadFile( \"http://files.rcsb.org/download/5IOS.cif\" );\n   *\n   * @example\n   * // load binary data in CCP4 format via a Blob\n   * var binaryBlob = new Blob( [ ccp4Data ], { type: 'application/octet-binary'} );\n   * stage.loadFile( binaryBlob, { ext: \"ccp4\" } );\n   *\n   * @example\n   * // load string data in PDB format via a Blob\n   * var stringBlob = new Blob( [ pdbData ], { type: 'text/plain'} );\n   * stage.loadFile( stringBlob, { ext: \"pdb\" } );\n   *\n   * @example\n   * // load a File object\n   * stage.loadFile( file );\n   *\n   * @example\n   * // load from URL and add a 'ball+stick' representation with double/triple bonds\n   * stage.loadFile( \"http://files.rcsb.org/download/1crn.cif\" ).then( function( comp ){\n   *     comp.addRepresentation( \"ball+stick\", { multipleBond: true } );\n   * } );\n   *\n   * @param  {String|File|Blob} path - either a URL or an object containing the file data\n   * @param  {LoaderParameters} params - loading parameters\n   * @param  {Boolean} params.asTrajectory - load multi-model structures as a trajectory\n   * @return {Promise} A Promise object that resolves to a {@link StructureComponent},\n   *                   a {@link SurfaceComponent} or a {@link ScriptComponent} object,\n   *                   depending on the type of the loaded file.\n   */\n  loadFile (path: string|File|Blob, params: Partial<StageLoadFileParams> = {}) {\n    const p = Object.assign({}, this.defaultFileParams, params)\n    const name = getFileInfo(path).name\n\n    this.tasks.increment()\n    this.log(`loading file '${name}'`)\n\n    const onLoadFn = (object: Structure|Surface|Volume) => {\n      this.log(`loaded '${name}'`)\n\n      const component = this.addComponentFromObject(object, p)\n      if (p.defaultRepresentation) {\n        this.defaultFileRepresentation(component as Component)\n      }\n      this.tasks.decrement()\n\n      return component\n    }\n\n    const onErrorFn = (e: Error|string) => {\n      this.tasks.decrement()\n      const errorMsg = `error loading file: '${e}'`\n      this.log(errorMsg)\n      throw errorMsg  // throw so it can be catched\n    }\n\n    const ext = defaults(p.ext, getFileInfo(path).ext)\n    let promise: Promise<any>\n\n    if (ParserRegistry.isTrajectory(ext)) {\n      promise = Promise.reject(\n        new Error(`loadFile: ext '${ext}' is a trajectory and must be loaded into a structure component`)\n      )\n    } else {\n      promise = autoLoad(path, p)\n    }\n\n    return promise.then(onLoadFn, onErrorFn)\n  }\n\n  loadScript (path: string|File|Blob) {\n    const name = getFileInfo(path).name\n\n    this.log(`loading script '${name}'`)\n\n    return autoLoad(path).then(\n      (script: Script) => {\n        this.tasks.increment()\n        this.log(`running script '${name}'`)\n        script.run(this).then(() => {\n          this.tasks.decrement()\n          this.log(`finished script '${name}'`)\n        })\n        this.log(`called script '${name}'`)\n      },\n      (error: Error|string) => {\n        this.tasks.decrement()\n        const errorMsg = `errored script '${name}' \"${error}\"`\n        this.log(errorMsg)\n        throw errorMsg  // throw so it can be catched\n      }\n    )\n  }\n\n  /**\n   * Add the given component to the stage\n   * @param {Component} component - the component to add\n   * @return {undefined}\n   */\n  addComponent (component: Component) {\n    if (!component) {\n      Log.warn('Stage.addComponent: no component given')\n      return\n    }\n\n    this.compList.push(component)\n    this.signals.componentAdded.dispatch(component)\n  }\n\n  /**\n   * Create a component from the given object and add to the stage\n   */\n  addComponentFromObject (object: Structure|Surface|Volume|Shape, params: Partial<ComponentParameters> = {}): void|Component {\n    const CompClass = ComponentRegistry.get(object.type)\n\n    if (CompClass) {\n      const component = new CompClass(this, object, params)\n      this.addComponent(component)\n      return component\n    }\n\n    Log.warn('no component for object type', object.type)\n  }\n\n  /**\n   * Remove the given component\n   * @param  {Component} component - the component to remove\n   * @return {undefined}\n   */\n  removeComponent (component: Component) {\n    const idx = this.compList.indexOf(component)\n    if (idx !== -1) {\n      this.compList.splice(idx, 1)\n      component.dispose()\n      this.signals.componentRemoved.dispatch(component)\n    }\n  }\n\n  /**\n   * Remove all components from the stage\n   */\n  removeAllComponents () {\n    this.compList.slice().forEach(o => this.removeComponent(o))\n  }\n\n  /**\n   * Handle any size-changes of the container element\n   * @return {undefined}\n   */\n  handleResize () {\n    this.viewer.handleResize()\n  }\n\n  /**\n   * Set width and height\n   * @param {String} width - CSS width value\n   * @param {String} height - CSS height value\n   * @return {undefined}\n   */\n  setSize (width: string, height: string) {\n    const container = this.viewer.container\n\n    if (container !== document.body) {\n      if (width !== undefined) container.style.width = width\n      if (height !== undefined) container.style.height = height\n      this.handleResize()\n    }\n  }\n\n  /**\n   * Toggle fullscreen\n   * @param  {Element} [element] - document element to put into fullscreen,\n   *                               defaults to the viewer container\n   * @return {undefined}\n   */\n  toggleFullscreen (element: HTMLElement) {\n    if (!document.fullscreenEnabled && !document.mozFullScreenEnabled &&\n        !(document as any).webkitFullscreenEnabled && !document.msFullscreenEnabled\n    ) {\n      Log.log('fullscreen mode (currently) not possible')\n      return\n    }\n\n    const self = this\n    element = element || this.viewer.container\n    this.lastFullscreenElement = element\n\n    //\n\n    function getFullscreenElement () {\n      return document.fullscreenElement || document.mozFullScreenElement ||\n        (document as any).webkitFullscreenElement || document.msFullscreenElement\n    }\n\n    function resizeElement () {\n      if (!getFullscreenElement() && self.lastFullscreenElement) {\n        const element = self.lastFullscreenElement\n        element.style.width = element.dataset.normalWidth || ''\n        element.style.height = element.dataset.normalHeight || ''\n\n        document.removeEventListener('fullscreenchange', resizeElement)\n        document.removeEventListener('mozfullscreenchange', resizeElement)\n        document.removeEventListener('webkitfullscreenchange', resizeElement)\n        document.removeEventListener('MSFullscreenChange', resizeElement)\n\n        self.handleResize()\n        self.signals.fullscreenChanged.dispatch(false)\n      }\n    }\n\n    //\n\n    if (!getFullscreenElement()) {\n      element.dataset.normalWidth = element.style.width || ''\n      element.dataset.normalHeight = element.style.height || ''\n      element.style.width = window.screen.width + 'px'\n      element.style.height = window.screen.height + 'px'\n\n      if (element.requestFullscreen) {\n        element.requestFullscreen()\n      } else if (element.msRequestFullscreen) {\n        element.msRequestFullscreen()\n      } else if (element.mozRequestFullScreen) {\n        element.mozRequestFullScreen()\n      } else if ((element as any).webkitRequestFullscreen) {\n        (element as any).webkitRequestFullscreen()\n      }\n\n      document.addEventListener('fullscreenchange', resizeElement)\n      document.addEventListener('mozfullscreenchange', resizeElement)\n      document.addEventListener('webkitfullscreenchange', resizeElement)\n      document.addEventListener('MSFullscreenChange', resizeElement)\n\n      this.handleResize()\n      this.signals.fullscreenChanged.dispatch(true)\n\n      // workaround for Safari\n      setTimeout(function () { self.handleResize() }, 100)\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen()\n      } else if (document.msExitFullscreen) {\n        document.msExitFullscreen()\n      } else if (document.mozCancelFullScreen) {\n        document.mozCancelFullScreen()\n      } else if ((document as any).webkitExitFullscreen) {\n        (document as any).webkitExitFullscreen()\n      }\n    }\n  }\n\n  /**\n   * Set spin\n   * @param {Boolean} flag - if true start rocking and stop spinning\n   * @return {undefined}\n   */\n  setSpin (flag: boolean) {\n    if (flag) {\n      this.spinAnimation.resume(true)\n      this.rockAnimation.pause(true)\n    } else {\n      this.spinAnimation.pause(true)\n    }\n  }\n\n  /**\n   * Set rock\n   * @param {Boolean} flag - if true start rocking and stop spinning\n   * @return {undefined}\n   */\n  setRock (flag: boolean) {\n    if (flag) {\n      this.rockAnimation.resume(true)\n      this.spinAnimation.pause(true)\n    } else {\n      this.rockAnimation.pause(true)\n    }\n  }\n\n  /**\n   * Toggle spin\n   * @return {undefined}\n   */\n  toggleSpin () {\n    this.setSpin(this.spinAnimation.paused)\n  }\n\n  /**\n   * Toggle rock\n   * @return {undefined}\n   */\n  toggleRock () {\n    this.setRock(this.rockAnimation.paused)\n  }\n\n  /**\n   * Get the current focus from the current clipNear value expressed\n   * as 0 (full view) to 100 (completely clipped)\n   * Negative values may be returned in some cases.\n   *\n   * In 'camera' clipMode focus isn't applicable, this method returns 0.0\n   *\n   * @return {number} focus\n   */\n  getFocus () : number {\n    const p = this.parameters\n    if (p.clipMode !== 'scene') return 0.0\n\n    let clipNear = p.clipNear\n    if (p.clipScale === 'absolute') {\n      clipNear = this.viewer.absoluteToRelative(clipNear)\n    }\n    return clipNear * 2\n  }\n\n\n  /**\n   * Set the focus, a value of 0 sets clipping planes to show full scene,\n   * while a value of 100 will compltely clip the scene.\n   *\n   * @param {number} value focus\n   */\n  setFocus (value: number) {\n    if (this.parameters.clipMode !== 'scene') return\n\n    let clipNear\n    let clipFar\n    let fogNear\n    let fogFar\n\n    if (this.parameters.clipScale === 'relative') {\n      clipNear = clamp(value / 2.0, 0.0, 49.9)\n      clipFar = 100 - clipNear\n      fogNear = 50\n      fogFar = pclamp(2 * clipFar - 50)\n\n    } else {\n      clipNear = this.viewer.relativeToAbsolute(value / 2.0)\n      clipFar = clipNear\n      fogNear = 0\n      fogFar = 2 * clipFar\n    }\n\n    this.setParameters({ clipNear, clipFar, fogNear, fogFar })\n  }\n\n  getZoomForBox (boundingBox: Box3) {\n    const bbSize = boundingBox.getSize(tmpZoomVector)\n    const maxSize = Math.max(bbSize.x, bbSize.y, bbSize.z)\n    const minSize = Math.min(bbSize.x, bbSize.y, bbSize.z)\n    let distance = maxSize + Math.sqrt(minSize)\n\n    const fov = degToRad(this.viewer.perspectiveCamera.fov)\n    const width = this.viewer.width\n    const height = this.viewer.height\n    const aspect = width / height\n    const aspectFactor = (height < width ? 1 : aspect)\n\n    distance = Math.abs(\n      ((distance * 0.5) / aspectFactor) / Math.sin(fov / 2)\n    )\n    distance += this.parameters.clipDist\n    return -distance\n  }\n\n  getBox () {\n    return this.viewer.boundingBox\n  }\n\n  getZoom () {\n    return this.getZoomForBox(this.getBox())\n  }\n\n  getCenter (optionalTarget?: Vector3) {\n    return this.getBox().getCenter(optionalTarget || new Vector3())\n  }\n\n  /**\n   * Add a zoom and a move animation with automatic targets\n   * @param  {Integer} duration - animation time in milliseconds\n   * @return {undefined}\n   */\n  autoView (duration?: number) {\n    this.animationControls.zoomMove(\n      this.getCenter(),\n      this.getZoom(),\n      defaults(duration, 0)\n    )\n  }\n\n  /**\n   * Make image from what is shown in a viewer canvas\n   */\n  makeImage (params: Partial<ImageParameters> = {}) {\n    return new Promise<Blob>((resolve, reject) => {\n      this.tasks.onZeroOnce(() => {\n        this.tasks.increment()\n        this.viewer.makeImage(params).then(blob => {\n          this.tasks.decrement()\n          resolve(blob)\n        }).catch(e => {\n          this.tasks.decrement()\n          reject(e)\n        })\n      })\n    })\n  }\n\n  setImpostor (value: boolean) {\n    this.parameters.impostor = value\n\n    const types = [\n      'spacefill', 'ball+stick', 'licorice', 'hyperball',\n      'backbone', 'rocket', 'helixorient', 'contact', 'distance',\n      'dot'\n    ]\n\n    this.eachRepresentation(function (reprElem) {\n      if (!types.includes(reprElem.getType())) return\n\n      const p = reprElem.getParameters() as any  // TODO\n      p.disableImpostor = !value\n      reprElem.build(p)\n    })\n  }\n\n  setQuality (value: RenderQualityType) {\n    this.parameters.quality = value\n\n    const types = [\n      'tube', 'cartoon', 'ribbon', 'trace', 'rope'\n    ]\n\n    const impostorTypes = [\n      'spacefill', 'ball+stick', 'licorice', 'hyperball',\n      'backbone', 'rocket', 'helixorient', 'contact', 'distance',\n      'dot'\n    ]\n\n    this.eachRepresentation(function (repr) {\n      const p = repr.getParameters() as any  // TODO\n\n      if (!types.includes(repr.getType())) {\n        if (!impostorTypes.includes(repr.getType())) return\n\n        if (!p.disableImpostor) {\n          (repr.repr as any).quality = value  // TODO\n          return\n        }\n      }\n\n      p.quality = value\n      repr.build(p)\n    })\n  }\n\n  /**\n   * Iterator over each component and executing the callback\n   */\n  eachComponent (callback: (comp: Component) => void, type?: string) {\n    this.compList.slice().forEach(comp => {\n      if (type === undefined || type === comp.type) callback(comp)\n    })\n  }\n\n  /**\n   * Iterator over each representation and executing the callback\n   */\n  eachRepresentation (callback: (reprElem: RepresentationElement, comp: Component) => void, type?: string) {\n    this.eachComponent(comp => {\n      comp.reprList.slice().forEach(reprElem => {\n        if (type === undefined || type === reprElem.getType()) callback(reprElem, comp)\n      })\n    })\n  }\n\n  /**\n   * Get collection of components by name\n   */\n  getComponentsByName (name: string|RegExp) {\n    const compList: Component[] = []\n\n    this.eachComponent(comp => {\n      if (name === undefined || matchName(name, comp)) compList.push(comp)\n    })\n\n    return new ComponentCollection(compList)\n  }\n\n  /**\n   * Get collection of components by object\n   */\n  getComponentsByObject (object: Structure|Surface|Volume|Shape) {\n    const compList: Component[] = []\n\n    this.eachComponent(comp => {\n      if (comp.object === object) compList.push(comp)\n    })\n\n    return new ComponentCollection(compList)\n  }\n\n  /**\n   * Get collection of representations by name\n   */\n  getRepresentationsByName (name: string|RegExp) {\n    const reprList: RepresentationElement[] = []\n\n    this.eachRepresentation((repr, comp) => {\n      if (name === undefined || matchName(name, repr)) reprList.push(repr)\n    })\n\n    return new RepresentationCollection(reprList)\n  }\n\n  measureClear () {\n    this.eachComponent((sc: StructureComponent) => sc.measureClear(), 'structure')\n  }\n\n  measureUpdate () {\n    this.eachComponent((sc: StructureComponent) => sc.measureUpdate(), 'structure')\n  }\n\n  /**\n   * Cleanup when disposing of a stage object\n   */\n  dispose () {\n    this.tasks.dispose()\n    this.viewer.dispose()\n    this.mouseObserver.dispose()\n  }\n}\n\nexport default Stage\n","/**\n * @file Shape Component\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ComponentRegistry } from '../globals'\nimport Component, { ComponentParameters } from './component'\nimport Stage from '../stage/stage'\nimport Shape from '../geometry/shape'\nimport { Vector3, Box3 } from 'three';\nimport RepresentationElement from './representation-element';\n\nexport type ShapeRepresentationType = 'buffer'\n\n/**\n * Component wrapping a {@link Shape} object\n *\n * @example\n * // get a shape component by adding a shape object to the stage\n * var shape = new NGL.Shape( \"shape\" );\n * shape.addSphere( [ 0, 0, 0 ], [ 1, 0, 0 ], 1.5 );\n * var shapeComponent = stage.addComponentFromObject( shape );\n * shapeComponent.addRepresentation( \"buffer\" );\n */\nclass ShapeComponent extends Component {\n  constructor (stage: Stage, readonly shape: Shape, params: Partial<ComponentParameters> = {}) {\n    super(stage, shape, Object.assign({ name: shape.name }, params))\n  }\n\n  /**\n   * Component type\n   * @type {String}\n   */\n  get type () { return 'shape' }\n\n  /**\n   * Add a new shape representation to the component\n   * @param {String} type - the name of the representation, one of:\n   *                        buffer.\n   * @param {BufferRepresentationParameters} params - representation parameters\n   * @return {RepresentationComponent} the created representation wrapped into\n   *                                   a representation component object\n   */\n  addRepresentation (type: ShapeRepresentationType, params: { [k: string]: any } = {}): RepresentationElement {\n    return this._addRepresentation(type, this.shape, params)\n  }\n\n  getBoxUntransformed (): Box3 {\n    return this.shape.boundingBox\n  }\n\n  getCenterUntransformed (): Vector3 {\n    return this.shape.center\n  }\n\n  dispose () {\n    this.shape.dispose()\n    super.dispose()\n  }\n}\n\nComponentRegistry.add('shape', ShapeComponent)\n\nexport default ShapeComponent\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/**\n * @file Atomindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\n/**\n * Color by atom index. The {@link AtomProxy.index} property is used for coloring.\n * Each {@link ModelProxy} of a {@link Structure} is colored seperately. The\n * `params.domain` parameter is ignored.\n *\n * __Name:__ _atomindex_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"ball+stick\", { colorScheme: \"atomindex\" } );\n *     o.autoView();\n * } );\n */\nclass AtomindexColormaker extends Colormaker {\n  scalePerModel: { [k: number]: ColormakerScale }\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rainbow'\n      this.parameters.reverse = defaults(params.reverse, true)\n    }\n\n    this.scalePerModel = {}\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      this.parameters.domain = [ mp.atomOffset, mp.atomEnd ]\n      this.scalePerModel[ mp.index ] = this.getScale()  // TODO\n    })\n  }\n\n  /**\n   * get color for an atom\n   * @param  {AtomProxy} atom - atom to get color for\n   * @return {Integer} hex atom color\n   */\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    return this.scalePerModel[ atom.modelIndex ](atom.index)\n  }\n}\n\nColormakerRegistry.add('atomindex', AtomindexColormaker)\n\nexport default AtomindexColormaker\n","/**\n * @file Bfactor Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Selection from '../selection/selection'\n\n/**\n * Color by b-factor. The {@link AtomProxy.bfactor} property is used for coloring.\n * By default the min and max b-factor values are used for the scale`s domain.\n *\n * __Name:__ _bfactor_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"ball+stick\", { colorScheme: \"bfactor\" } );\n *     o.autoView();\n * } );\n */\nclass BfactorColormaker extends Colormaker {\n  bfactorScale: ColormakerScale\n\n  constructor (params: { sele?: string } & StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'OrRd'\n    }\n\n    if (!params.domain) {\n      let selection\n      let min = Infinity\n      let max = -Infinity\n\n      if (params.sele) {\n        selection = new Selection(params.sele)\n      }\n\n      params.structure.eachAtom(function (a) {\n        const bfactor = a.bfactor\n        min = Math.min(min, bfactor)\n        max = Math.max(max, bfactor)\n      }, selection)\n\n      this.parameters.domain = [ min, max ]\n    }\n\n    this.bfactorScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.bfactorScale(a.bfactor)\n  }\n}\n\nColormakerRegistry.add('bfactor', BfactorColormaker)\n\nexport default BfactorColormaker\n","/**\n * @file Chainid Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\nexport type ChainidDict = { [k: string]: number }\n\n/**\n * Color by chain id\n */\nclass ChainidColormaker extends Colormaker {\n  chainidDictPerModel: { [k: number]: ChainidDict } = {}\n  scalePerModel: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      let i = 0\n      const chainidDict: ChainidDict = {}\n      mp.eachChain(function (cp: ChainProxy) {\n        if (chainidDict[ cp.chainid ] === undefined) {\n          chainidDict[ cp.chainid ] = i\n          i += 1\n        }\n      })\n      this.parameters.domain = [ 0, i - 1 ]\n      this.chainidDictPerModel[ mp.index ] = chainidDict\n      this.scalePerModel[ mp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const chainidDict = this.chainidDictPerModel[ a.modelIndex ]\n    return this.scalePerModel[ a.modelIndex ](chainidDict[ a.chainid ])\n  }\n}\n\nColormakerRegistry.add('chainid', ChainidColormaker)\n\nexport default ChainidColormaker\n","/**\n * @file Chainindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\n/**\n * Color by chain index\n */\nclass ChainindexColormaker extends Colormaker {\n  scalePerModel: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      this.parameters.domain = [ mp.chainOffset, mp.chainEnd ]\n      this.scalePerModel[ mp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.scalePerModel[ a.modelIndex ](a.chainIndex)\n  }\n}\n\nColormakerRegistry.add('chainindex', ChainindexColormaker)\n\nexport default ChainindexColormaker\n","/**\n * @file Chainname Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\nimport ModelProxy from '../proxy/model-proxy'\n\nexport type ChainnameDict = { [k: string]: number }\n\n/**\n * Color by chain name\n */\nclass ChainnameColormaker extends Colormaker {\n  chainnameDictPerModel: { [k: number]: ChainnameDict } = {}\n  scalePerModel: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n\n    params.structure.eachModel((mp: ModelProxy) => {\n      let i = 0\n      const chainnameDict: ChainnameDict = {}\n      mp.eachChain(function (cp: ChainProxy) {\n        if (chainnameDict[ cp.chainname ] === undefined) {\n          chainnameDict[ cp.chainname ] = i\n          i += 1\n        }\n      })\n      this.parameters.domain = [ 0, i - 1 ]\n      this.chainnameDictPerModel[ mp.index ] = chainnameDict\n      this.scalePerModel[ mp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const chainnameDict = this.chainnameDictPerModel[ a.modelIndex ]\n    return this.scalePerModel[ a.modelIndex ](chainnameDict[ a.chainname ])\n  }\n}\n\nColormakerRegistry.add('chainname', ChainnameColormaker)\n\nexport default ChainnameColormaker\n","/**\n * @file Densityfit Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by validation density fit\n */\nclass DensityfitColormaker extends Colormaker {\n  rsrzScale: ColormakerScale\n  rsccScale: ColormakerScale\n\n  rsrzDict: { [k: string]: number|undefined } = {}\n  rsccDict: { [k: string]: number|undefined } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'RdYlBu'\n    }\n\n    this.rsrzScale = this.getScale({ domain: [ 2, 0 ] })\n    this.rsccScale = this.getScale({ domain: [ 0.678, 1.0 ] })\n\n    const val = params.structure.validation\n    if (val) {\n      this.rsrzDict = val.rsrzDict\n      this.rsccDict = val.rsccDict\n    }\n\n  }\n\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    let sele = atom.resno + ''\n    if (atom.inscode) sele += '^' + atom.inscode\n    if (atom.chainname) sele += ':' + atom.chainname\n    sele += '/' + atom.modelIndex\n\n    const rsrz = this.rsrzDict[ sele ]\n    if (rsrz !== undefined) {\n      return this.rsrzScale(rsrz)\n    }\n\n    const rscc = this.rsccDict[ sele ]\n    if (rscc !== undefined) {\n      return this.rsccScale(rscc)\n    }\n\n    return 0x909090\n  }\n}\n\nColormakerRegistry.add('densityfit', DensityfitColormaker)\n\nexport default DensityfitColormaker\n","/**\n * @file Atomindex Colormaker\n * @author Fred Ludlow <Fred.Ludlow@astx.com>\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport SpatialHash from '../geometry/spatial-hash'\n\n// from CHARMM\nconst partialCharges: { [k: string]: { [k: string]: number } } = {\n  'ARG': {\n    'CD': 0.1,\n    'CZ': 0.5,\n    'NE': -0.1\n  },\n  'ASN': {\n    'CG': 0.55,\n    'OD1': -0.55\n  },\n  'ASP': {\n    'CB': -0.16,\n    'CG': 0.36,\n    'OD1': -0.6,\n    'OD2': -0.6\n  },\n  'CYS': {\n    'CB': 0.19,\n    'SG': -0.19\n  },\n  'GLN': {\n    'CD': 0.55,\n    'OE1': -0.55\n  },\n  'GLU': {\n    'CD': 0.36,\n    'CG': -0.16,\n    'OE1': -0.6,\n    'OE2': -0.6\n  },\n  'HIS': {\n    'CB': 0.1,\n    'CD2': 0.2,\n    'CE1': 0.45,\n    'CG': 0.15,\n    'ND1': 0.05,\n    'NE2': 0.05\n  },\n  'LYS': {\n    'CE': 0.25,\n    'NZ': 0.75\n  },\n  'MET': {\n    'CE': 0.06,\n    'CG': 0.06,\n    'SD': -0.12\n  },\n  'PTR': {\n    'C': 0.55,\n    'CA': 0.1,\n    'CZ': 0.25,\n    'N': -0.35,\n    'O': -0.55,\n    'O1P': -0.85,\n    'O2P': -0.85,\n    'O3P': -0.85,\n    'OG1': -1.1,\n    'P': 1.4\n  },\n  'SEP': {\n    'C': 0.55,\n    'CA': 0.1,\n    'CB': 0.25,\n    'N': -0.35,\n    'O': -0.55,\n    'O1P': -0.85,\n    'O2P': -0.85,\n    'O3P': -0.85,\n    'OG1': -1.1,\n    'P': 1.4\n  },\n  'SER': {\n    'CB': 0.25,\n    'OG': -0.25\n  },\n  'THR': {\n    'CB': 0.25,\n    'OG1': -0.25\n  },\n  'TPO': {\n    'C': 0.55,\n    'CA': 0.1,\n    'CB': 0.25,\n    'N': -0.35,\n    'O': -0.55,\n    'OG1': -1.1,\n    'O1P': -0.85,\n    'O2P': -0.85,\n    'O3P': -0.85,\n    'P': 1.4\n  },\n  'TRP': {\n    'CD1': 0.06,\n    'CD2': 0.1,\n    'CE2': -0.04,\n    'CE3': -0.03,\n    'CG': -0.03,\n    'NE1': -0.06\n  },\n  'TYR': {\n    'CZ': 0.25,\n    'OH': -0.25\n  },\n  'backbone': {\n    'C': 0.55,\n    'O': -0.55,\n    'N': -0.35,\n    'CA': 0.1\n  }\n}\n\nconst maxRadius = 12.0\nconst nHBondDistance = 1.04\nconst nHCharge = 0.25\n\n/**\n * Populates position vector with location of implicit or explicit H\n * Returns position or undefined if not able to locate H\n *\n * @param {AtomProxy} ap - the nitrogen atom\n * @param {Vector3} [position] - optional target\n * @return {Vectors|undefined} the hydrogen atom position\n */\nfunction backboneNHPosition (ap: AtomProxy, position = new Vector3()) {\n  let h = false\n  let ca = false\n  let c = false\n  position.set(2 * ap.x, 2 * ap.y, 2 * ap.z)\n\n  ap.eachBondedAtom(function (a2: AtomProxy) {\n    // Any time we detect H, reset position and skip\n    // future tests\n    if (h) return\n    if (a2.atomname === 'H') {\n      position.set(a2.x, a2.y, a2.z)\n      h = true\n      return\n    }\n    if (!ca && a2.atomname === 'CA') {\n      position.sub(a2 as any)  // TODO\n      ca = true\n    } else if (!c && a2.atomname === 'C') {\n      c = true\n      position.sub(a2 as any)  // TODO\n    }\n  })\n\n  if (h) { return position }\n\n  if (ca && c) {\n    position.normalize()\n    position.multiplyScalar(nHBondDistance)\n    position.add(ap as any)\n    return position\n  }\n}\n\n/**\n * Takes an array of Vector3 objects and\n * converts to an object that looks like an AtomStore\n *\n * @param {Vector3[]} positions - array of positions\n * @return {Object} AtomStore-like object\n */\nfunction buildStoreLike (positions: Vector3[]) {\n  const n = positions.length\n  const x = new Float32Array(n)\n  const y = new Float32Array(n)\n  const z = new Float32Array(n)\n\n  for (let i = 0; i < positions.length; i++) {\n    const v = positions[ i ]\n    x[ i ] = v.x\n    y[ i ] = v.y\n    z[ i ] = v.z\n  }\n\n  return { x: x, y: y, z: z, count: n }\n}\n\nfunction chargeForAtom (a: AtomProxy): number {\n  if (a.partialCharge !== null) return a.partialCharge\n  if (!a.isProtein()) { return 0.0 }\n  return (\n    (partialCharges[ a.resname ] &&\n        partialCharges[ a.resname ][ a.atomname ]) ||\n    partialCharges[ 'backbone' ][ a.atomname ] || 0.0\n  )\n}\n\n/**\n * Color a surface by electrostatic charge. This is a highly approximate\n * calculation! The partial charges are CHARMM with hydrogens added to heavy\n * atoms and hydrogen positions generated for amides.\n *\n * __Name:__ _electrostatic_\n *\n * @example\n * stage.loadFile( \"rcsb://3dqb\" ).then( function( o ){\n *     o.addRepresentation( \"surface\", { colorScheme: \"electrostatic\" } );\n *     o.autoView();\n * } );\n */\nclass ElectrostaticColormaker extends Colormaker {\n  scale: ColormakerScale\n  hHash: SpatialHash\n  hash: SpatialHash\n  charges: Float32Array\n  hStore: { x: Float32Array, y: Float32Array, z: Float32Array, count: number }\n  atomProxy: AtomProxy\n\n  delta = new Vector3()\n  hCharges: number[] = []\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rwb'\n    }\n    if (!params.domain) {\n      this.parameters.domain = [ -50, 50 ]\n    }\n\n    this.scale = this.getScale()\n\n    this.charges = new Float32Array(params.structure.atomCount)\n    const hPositions: Vector3[] = []\n\n    params.structure.eachAtom((ap: AtomProxy) => {\n      this.charges[ ap.index ] = chargeForAtom(ap) * ap.occupancy\n      if (ap.atomname === 'N') {\n\n        // In the specific case where N forms two bonds to\n        // CA and C, try and place a dummy hydrogen\n\n        if (ap.bondCount >= 3) return; // Skip if 3 bonds already (e.g. PRO)\n\n        if (ap.bondToElementCount(1)) return; // Skip if any H specificed\n\n        const hPos = backboneNHPosition(ap)\n        if (hPos !== undefined) {\n          hPositions.push(hPos)\n          this.hCharges.push(nHCharge * ap.occupancy)\n        }\n      }\n    })\n\n    const bbox = params.structure.getBoundingBox()\n    bbox.expandByScalar(nHBondDistance) // Worst case\n\n    // SpatialHash requires x,y,z and count\n    this.hStore = buildStoreLike(hPositions)\n    this.hHash = new SpatialHash(this.hStore as any, bbox)  // TODO\n    this.hash = new SpatialHash(params.structure.atomStore, bbox)\n  }\n\n  @manageColor\n  positionColor (v: Vector3) {\n\n    const charges = this.charges\n    const hCharges = this.hCharges\n\n    let p = 0.0\n    this.hash.eachWithin(v.x, v.y, v.z, maxRadius, (atomIndex, dSq) => {\n      const charge = charges[atomIndex]\n      if (charge === 0.0) return\n      p += charge / dSq\n    })\n\n    this.hHash.eachWithin(v.x, v.y, v.z, maxRadius, (atomIndex, dSq) => {\n      const charge = hCharges[atomIndex]\n      if (charge === 0.0) return\n      p += charge / dSq\n    })\n\n    return this.scale(p * 332) // 332 to convert to kcal/mol\n  }\n}\n\nColormakerRegistry.add('electrostatic', ElectrostaticColormaker)\n\nexport default ElectrostaticColormaker\n","/**\n * @file Element Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Colormaker, { ColormakerParameters, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// from Jmol http://jmol.sourceforge.net/jscolors/ (or 0xFFFFFF)\nconst ElementColors: { [k: string]: number } = {\n  'H': 0xFFFFFF,\n  'HE': 0xD9FFFF,\n  'LI': 0xCC80FF,\n  'BE': 0xC2FF00,\n  'B': 0xFFB5B5,\n  'C': 0x909090,\n  'N': 0x3050F8,\n  'O': 0xFF0D0D,\n  'F': 0x90E050,\n  'NE': 0xB3E3F5,\n  'NA': 0xAB5CF2,\n  'MG': 0x8AFF00,\n  'AL': 0xBFA6A6,\n  'SI': 0xF0C8A0,\n  'P': 0xFF8000,\n  'S': 0xFFFF30,\n  'CL': 0x1FF01F,\n  'AR': 0x80D1E3,\n  'K': 0x8F40D4,\n  'CA': 0x3DFF00,\n  'SC': 0xE6E6E6,\n  'TI': 0xBFC2C7,\n  'V': 0xA6A6AB,\n  'CR': 0x8A99C7,\n  'MN': 0x9C7AC7,\n  'FE': 0xE06633,\n  'CO': 0xF090A0,\n  'NI': 0x50D050,\n  'CU': 0xC88033,\n  'ZN': 0x7D80B0,\n  'GA': 0xC28F8F,\n  'GE': 0x668F8F,\n  'AS': 0xBD80E3,\n  'SE': 0xFFA100,\n  'BR': 0xA62929,\n  'KR': 0x5CB8D1,\n  'RB': 0x702EB0,\n  'SR': 0x00FF00,\n  'Y': 0x94FFFF,\n  'ZR': 0x94E0E0,\n  'NB': 0x73C2C9,\n  'MO': 0x54B5B5,\n  'TC': 0x3B9E9E,\n  'RU': 0x248F8F,\n  'RH': 0x0A7D8C,\n  'PD': 0x006985,\n  'AG': 0xC0C0C0,\n  'CD': 0xFFD98F,\n  'IN': 0xA67573,\n  'SN': 0x668080,\n  'SB': 0x9E63B5,\n  'TE': 0xD47A00,\n  'I': 0x940094,\n  'XE': 0x940094,\n  'CS': 0x57178F,\n  'BA': 0x00C900,\n  'LA': 0x70D4FF,\n  'CE': 0xFFFFC7,\n  'PR': 0xD9FFC7,\n  'ND': 0xC7FFC7,\n  'PM': 0xA3FFC7,\n  'SM': 0x8FFFC7,\n  'EU': 0x61FFC7,\n  'GD': 0x45FFC7,\n  'TB': 0x30FFC7,\n  'DY': 0x1FFFC7,\n  'HO': 0x00FF9C,\n  'ER': 0x00E675,\n  'TM': 0x00D452,\n  'YB': 0x00BF38,\n  'LU': 0x00AB24,\n  'HF': 0x4DC2FF,\n  'TA': 0x4DA6FF,\n  'W': 0x2194D6,\n  'RE': 0x267DAB,\n  'OS': 0x266696,\n  'IR': 0x175487,\n  'PT': 0xD0D0E0,\n  'AU': 0xFFD123,\n  'HG': 0xB8B8D0,\n  'TL': 0xA6544D,\n  'PB': 0x575961,\n  'BI': 0x9E4FB5,\n  'PO': 0xAB5C00,\n  'AT': 0x754F45,\n  'RN': 0x428296,\n  'FR': 0x420066,\n  'RA': 0x007D00,\n  'AC': 0x70ABFA,\n  'TH': 0x00BAFF,\n  'PA': 0x00A1FF,\n  'U': 0x008FFF,\n  'NP': 0x0080FF,\n  'PU': 0x006BFF,\n  'AM': 0x545CF2,\n  'CM': 0x785CE3,\n  'BK': 0x8A4FE3,\n  'CF': 0xA136D4,\n  'ES': 0xB31FD4,\n  'FM': 0xB31FBA,\n  'MD': 0xB30DA6,\n  'NO': 0xBD0D87,\n  'LR': 0xC70066,\n  'RF': 0xCC0059,\n  'DB': 0xD1004F,\n  'SG': 0xD90045,\n  'BH': 0xE00038,\n  'HS': 0xE6002E,\n  'MT': 0xEB0026,\n  'DS': 0xFFFFFF,\n  'RG': 0xFFFFFF,\n  'CN': 0xFFFFFF,\n  'UUT': 0xFFFFFF,\n  'FL': 0xFFFFFF,\n  'UUP': 0xFFFFFF,\n  'LV': 0xFFFFFF,\n  'UUH': 0xFFFFFF,\n\n  'D': 0xFFFFC0,\n  'T': 0xFFFFA0\n}\nconst DefaultElementColor = 0xFFFFFF\n\n/**\n * Color by element\n */\nclass ElementColormaker extends Colormaker {\n  constructor (params: ColormakerParameters) {\n    params.value = defaults(params.value, ElementColors.C)\n\n    super(params)\n  }\n\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const element = a.element\n\n    if (element === 'C') {\n      return this.parameters.value\n    } else {\n      return ElementColors[ element ] || DefaultElementColor\n    }\n  }\n}\n\nColormakerRegistry.add('element', ElementColormaker)\n\nexport default ElementColormaker\n","/**\n * @file Entityindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by entity index\n */\nclass EntityindexColormaker extends Colormaker {\n  entityindexScale: ColormakerScale\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'Spectral'\n    }\n    if (!params.domain) {\n      this.parameters.domain = [ 0, params.structure.entityList.length - 1 ]\n    }\n\n    this.entityindexScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.entityindexScale(a.entityIndex)\n  }\n}\n\nColormakerRegistry.add('entityindex', EntityindexColormaker)\n\nexport default EntityindexColormaker\n","/**\n * @file Entitytype Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\nimport {\n    PolymerEntity, NonPolymerEntity, MacrolideEntity, WaterEntity\n} from '../structure/structure-constants'\n\n/**\n * Color by entity type\n */\nclass EntitytypeColormaker extends Colormaker {\n  @manageColor\n  atomColor (a: AtomProxy) {\n    const e = a.entity\n    const et = e ? e.entityType : undefined\n    switch (et) {\n      case PolymerEntity:\n        return 0x7fc97f\n      case NonPolymerEntity:\n        return 0xfdc086\n      case MacrolideEntity:\n        return 0xbeaed4\n      case WaterEntity:\n        return 0x386cb0\n      default:\n        return 0xffff99\n    }\n  }\n}\n\nColormakerRegistry.add('entitytype', EntitytypeColormaker)\n\nexport default EntitytypeColormaker\n","/**\n * @file Geoquality Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { countSetBits } from '../math/math-utils'\n\n/**\n * Color by validation gometry quality\n */\nclass GeoqualityColormaker extends Colormaker {\n  geoAtomDict: { [k: string]: { [k: string]: number } } = {}\n  geoDict: { [k: string]: number|undefined } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    const val = params.structure.validation\n    if (val) {\n      this.geoAtomDict = val.geoAtomDict\n      this.geoDict = val.geoDict\n    }\n  }\n\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    let sele = atom.resno + ''\n    if (atom.inscode) sele += '^' + atom.inscode\n    if (atom.chainname) sele += ':' + atom.chainname\n    sele += '/' + atom.modelIndex\n\n    let geoProblemCount\n    const geoAtom = this.geoAtomDict[ sele ]\n    if (geoAtom !== undefined) {\n      const atomProblems: number = geoAtom[ atom.atomname ] || 0\n      geoProblemCount = countSetBits(atomProblems)\n    } else {\n      geoProblemCount = this.geoDict[ sele ] || 0\n    }\n\n    if (geoProblemCount === 0) {\n      return 0x2166ac\n    } else if (geoProblemCount === 1) {\n      return 0xfee08b\n    } else if (geoProblemCount === 2) {\n      return 0xf46d43\n    } else if (geoProblemCount >= 3) {\n      return 0xa50026\n    }\n    return 0x909090\n  }\n}\n\nColormakerRegistry.add('geoquality', GeoqualityColormaker)\n\nexport default GeoqualityColormaker\n","/**\n * @file Hydrophobicity Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColormakerParameters, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\nimport {\n    ResidueHydrophobicity, DefaultResidueHydrophobicity\n} from '../structure/structure-constants'\n\n/**\n * Color by hydrophobicity\n */\nclass HydrophobicityColormaker extends Colormaker {\n  hfScale: ColormakerScale\n  resHF: { [k: string]: number } = {}\n  defaultResidueHydrophobicity: number\n\n  constructor (params: ColormakerParameters) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'RdYlGn'\n    }\n\n    const idx = 0  // 0: DGwif, 1: DGwoct, 2: Oct-IF\n\n    for (const name in ResidueHydrophobicity) {\n      this.resHF[ name ] = ResidueHydrophobicity[ name ][ idx ]\n    }\n    this.defaultResidueHydrophobicity = DefaultResidueHydrophobicity[idx]\n\n    if (!params.domain) {\n      let min = Infinity\n      let max = -Infinity\n\n      for (const name in this.resHF) {\n        const val = this.resHF[ name ]\n        min = Math.min(min, val)\n        max = Math.max(max, val)\n      }\n\n      this.parameters.domain = [ min, 0, max ]\n    }\n\n    this.hfScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.hfScale(this.resHF[ a.resname ] || this.defaultResidueHydrophobicity)\n  }\n}\n\nColormakerRegistry.add('hydrophobicity', HydrophobicityColormaker)\n\nexport default HydrophobicityColormaker\n","/**\n * @file Modelindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by model index\n */\nclass ModelindexColormaker extends Colormaker {\n  modelindexScale: ColormakerScale\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rainbow'\n    }\n    if (!params.domain) {\n      this.parameters.domain = [ 0, params.structure.modelStore.count ]\n    }\n\n    this.modelindexScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.modelindexScale(a.modelIndex)\n  }\n}\n\nColormakerRegistry.add('modelindex', ModelindexColormaker)\n\nexport default ModelindexColormaker\n","/**\n * @file Moleculetype Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\nimport {\n    WaterType, IonType, ProteinType, RnaType, DnaType, SaccharideType\n} from '../structure/structure-constants'\n\n/**\n * Color by molecule type\n */\nclass MoleculetypeColormaker extends Colormaker {\n  @manageColor\n  atomColor (a: AtomProxy) {\n    switch (a.residueType.moleculeType) {\n      case WaterType:\n        return 0x386cb0\n      case IonType:\n        return 0xf0027f\n      case ProteinType:\n        return 0xbeaed4\n      case RnaType:\n        return 0xfdc086\n      case DnaType:\n        return 0xbf5b17\n      case SaccharideType:\n        return 0x7fc97f\n      default:\n        return 0xffff99\n    }\n  }\n}\n\nColormakerRegistry.add('moleculetype', MoleculetypeColormaker)\n\nexport default MoleculetypeColormaker\n","/**\n * @file Occupancy Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColormakerParameters, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by occupancy\n */\nclass OccupancyColormaker extends Colormaker {\n  occupancyScale: ColormakerScale\n\n  constructor (params: ColormakerParameters) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'PuBu'\n    }\n\n    if (!params.domain) {\n      this.parameters.domain = [ 0.0, 1.0 ]\n    }\n\n    this.occupancyScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.occupancyScale(a.occupancy)\n  }\n}\n\nColormakerRegistry.add('occupancy', OccupancyColormaker)\n\nexport default OccupancyColormaker\n","/**\n * @file Partialcharge Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColormakerParameters, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by partial charge. The {@link AtomProxy.partialCharge} property is used for coloring.\n * The default domain is [-1, 1].\n *\n * __Name:__ _partialCharge_\n *\n * @example\n * stage.loadFile(\"rcsb://1crn\").then(function (o) {\n *   o.addRepresentation(\"ball+stick\", {colorScheme: \"partialCharge\"});\n *   o.autoView();\n * });\n */\nclass PartialchargeColormaker extends Colormaker {\n  partialchargeScale: ColormakerScale\n\n  constructor (params: ColormakerParameters) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rwb'\n    }\n\n    if (!params.domain) {\n      this.parameters.domain = [-1, 1]\n    }\n\n    this.partialchargeScale = this.getScale()\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.partialchargeScale(a.partialCharge || 0)\n  }\n}\n\nColormakerRegistry.add('partialcharge', PartialchargeColormaker)\n\nexport default PartialchargeColormaker\n","/**\n * @file Random Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\n\nfunction randomColor () {\n  return Math.random() * 0xFFFFFF\n}\n\n/**\n * Class by random color\n */\nclass RandomColormaker extends Colormaker {\n  /**\n   * get color for an atom\n   * @return {Integer} random hex color\n   */\n  @manageColor\n  atomColor () {\n    return randomColor()\n  }\n\n  /**\n   * get color for volume cell\n   * @return {Integer} random hex color\n   */\n  @manageColor\n  volumeColor () {\n    return randomColor()\n  }\n\n  /**\n   * get color for coordinates in space\n   * @return {Integer} random hex color\n   */\n  @manageColor\n  positionColor () {\n    return randomColor()\n  }\n}\n\nColormakerRegistry.add('random', RandomColormaker)\n\nexport default RandomColormaker\n","/**\n * @file Randomcoilindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n/**\n * Color by random coil index\n */\nclass RandomcoilindexColormaker extends Colormaker {\n  rciScale: ColormakerScale\n  rciDict: { [k: string]: number|undefined } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'RdYlBu'\n    }\n\n    this.rciScale = this.getScale({ domain: [ 0.6, 0 ] })\n\n    const val = params.structure.validation\n    if (val) this.rciDict = val.rciDict\n\n  }\n\n  @manageColor\n  atomColor (atom: AtomProxy) {\n    let sele = `[${atom.resname}]${atom.resno}`\n    if (atom.chainname) sele += ':' + atom.chainname\n\n    const rci = this.rciDict[ sele ]\n    return rci !== undefined ? this.rciScale(rci) : 0x909090\n  }\n}\n\nColormakerRegistry.add('randomcoilindex', RandomcoilindexColormaker)\n\nexport default RandomcoilindexColormaker\n","/**\n * @file Residueindex Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Colormaker, { StuctureColormakerParams, ColormakerScale, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ChainProxy from '../proxy/chain-proxy'\n\n/**\n * Color by residue index\n */\nclass ResidueindexColormaker extends Colormaker {\n  scalePerChain: { [k: number]: ColormakerScale } = {}\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    if (!params.scale) {\n      this.parameters.scale = 'rainbow'\n      this.parameters.reverse = defaults(params.reverse, true)\n    }\n\n    params.structure.eachChain((cp: ChainProxy) => {\n      this.parameters.domain = [ cp.residueOffset, cp.residueEnd ]\n      this.scalePerChain[ cp.index ] = this.getScale()\n    })\n  }\n\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return this.scalePerChain[ a.chainIndex ](a.residueIndex)\n  }\n}\n\nColormakerRegistry.add('residueindex', ResidueindexColormaker)\n\nexport default ResidueindexColormaker\n","/**\n * @file Resname Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\n\n// protein colors from Jmol http://jmol.sourceforge.net/jscolors/\nconst ResidueColors: { [k: string]: number } = {\n  'ALA': 0x8CFF8C,\n  'ARG': 0x00007C,\n  'ASN': 0xFF7C70,\n  'ASP': 0xA00042,\n  'CYS': 0xFFFF70,\n  'GLN': 0xFF4C4C,\n  'GLU': 0x660000,\n  'GLY': 0xFFFFFF,\n  'HIS': 0x7070FF,\n  'ILE': 0x004C00,\n  'LEU': 0x455E45,\n  'LYS': 0x4747B8,\n  'MET': 0xB8A042,\n  'PHE': 0x534C52,\n  'PRO': 0x525252,\n  'SER': 0xFF7042,\n  'THR': 0xB84C00,\n  'TRP': 0x4F4600,\n  'TYR': 0x8C704C,\n  'VAL': 0xFF8CFF,\n\n  'ASX': 0xFF00FF,\n  'GLX': 0xFF00FF,\n  'ASH': 0xFF00FF,\n  'GLH': 0xFF00FF,\n\n  'A': 0xDC143C,  // Crimson Red\n  'G': 0x32CD32,  // Lime Green\n  'I': 0x9ACD32,  // Yellow Green\n  'X': 0x7CFC00,  // Lawn Green\n  'C': 0xFFD700,  // Gold Yellow\n  'T': 0x4169E1,  // Royal Blue\n  'U': 0x40E0D0,  // Turquoise Cyan\n  'D': 0x008B8B,  // Dark Cyan\n\n  'DA': 0xDC143C,\n  'DG': 0x32CD32,\n  'DI': 0x9ACD32,\n  'DX': 0x7CFC00,\n  'DC': 0xFFD700,\n  'DT': 0x4169E1,\n  'DU': 0x40E0D0,\n  'DD': 0x008B8B\n}\nconst DefaultResidueColor = 0xFF00FF\n\n/**\n * Color by residue name\n */\nclass ResnameColormaker extends Colormaker {\n  @manageColor\n  atomColor (a: AtomProxy) {\n    return ResidueColors[ a.resname ] || DefaultResidueColor\n  }\n}\n\nColormakerRegistry.add('resname', ResnameColormaker)\n\nexport default ResnameColormaker\n","/**\n * @file Sstruc Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { StuctureColormakerParams, manageColor } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport ResidueProxy from '../proxy/residue-proxy'\n\n// from Jmol http://jmol.sourceforge.net/jscolors/ (shapely)\nconst StructureColors = {\n  'alphaHelix': 0xFF0080,\n  'threeTenHelix': 0xA00080,\n  'piHelix': 0x600080,\n  'betaStrand': 0xFFC800,\n  'betaTurn': 0x6080FF,\n  'coil': 0xFFFFFF,\n\n  'dna': 0xAE00FE,\n  'rna': 0xFD0162,\n\n  'carbohydrate': 0xA6A6FA\n}\nconst DefaultStructureColor = 0x808080\n\n/**\n * Color by secondary structure\n */\nclass SstrucColormaker extends Colormaker {\n  residueProxy: ResidueProxy\n\n  constructor (params: StuctureColormakerParams) {\n    super(params)\n\n    this.residueProxy = params.structure.getResidueProxy()\n  }\n\n  @manageColor\n  atomColor (ap: AtomProxy) {\n    const sstruc = ap.sstruc\n    const rp = this.residueProxy\n\n    if (sstruc === 'h') {\n      return StructureColors.alphaHelix\n    } else if (sstruc === 'g') {\n      return StructureColors.threeTenHelix\n    } else if (sstruc === 'i') {\n      return StructureColors.piHelix\n    } else if (sstruc === 'e' || sstruc === 'b') {\n      return StructureColors.betaStrand\n    } else if (sstruc === 't') {\n      return StructureColors.betaTurn\n    } else {\n      rp.index = ap.residueIndex\n      if (rp.isDna()) {\n        return StructureColors.dna\n      } else if (rp.isRna()) {\n        return StructureColors.rna\n      } else if (rp.isSaccharide()) {\n        return StructureColors.carbohydrate\n      } else if (rp.isProtein() || sstruc === 's' || sstruc === 'l') {\n        return StructureColors.coil\n      } else {\n        return DefaultStructureColor\n      }\n    }\n  }\n}\n\nColormakerRegistry.add('sstruc', SstrucColormaker)\n\nexport default SstrucColormaker\n","/**\n * @file Colordata Colormaker\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { ColorData, ColormakerScale, manageColor, StuctureColormakerParams } from './colormaker'\nimport AtomProxy from '../proxy/atom-proxy'\nimport BondProxy from '../proxy/bond-proxy'\n\n\nclass StructuredataColormaker extends Colormaker {\n  atomData?: ColorData['atomData']\n  bondData?: ColorData['bondData']\n  scale: ColormakerScale\n\n  constructor(params: StuctureColormakerParams) {\n    super(params)\n    if (!params.scale) {\n      this.parameters.scale = 'rwb'\n    }\n    this.atomData = this.parameters.data?.atomData\n    this.bondData = this.parameters.data?.bondData\n    this.scale = this.getScale(this.parameters)\n  }\n\n  @manageColor\n  atomColor(a: AtomProxy) {\n    const val = this.atomData?.[a.index]\n    return  (val !== undefined) ? this.scale(val) : this.parameters.value\n  }\n\n  @manageColor\n  bondColor(bond: BondProxy, fromTo: boolean) {\n      const val = this.bondData?.[bond.index]\n      \n      // Explicit bond data?\n      if (val !== undefined) return this.scale(val)\n      \n      \n      if (this.atomProxy) {\n        this.atomProxy.index = fromTo ? bond.atomIndex1 : bond.atomIndex2\n        return this.atomColor(this.atomProxy)\n      } \n      \n      // Fallback\n      return this.parameters.value\n  }\n}\n\nColormakerRegistry.add('structuredata', StructuredataColormaker)\n\nexport default StructuredataColormaker","/**\n * @file Uniform Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { manageColor } from './colormaker'\n\n/**\n * Color by uniform color\n */\nclass UniformColormaker extends Colormaker {\n  @manageColor\n  atomColor () {\n    return this.parameters.value\n  }\n\n  @manageColor\n  bondColor () {\n    return this.parameters.value\n  }\n\n  @manageColor\n  valueColor () {\n    return this.parameters.value\n  }\n\n  @manageColor\n  volumeColor () {\n    return this.parameters.value\n  }\n}\n\nColormakerRegistry.add('uniform', UniformColormaker)\n\nexport default UniformColormaker\n","/**\n * @file Value Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { VolumeColormakerParams, ColormakerScale, manageColor } from './colormaker'\n\n/**\n * Color by volume value\n */\nclass ValueColormaker extends Colormaker {\n  valueScale: ColormakerScale\n\n  constructor (params: VolumeColormakerParams) {\n    super(params)\n    this.valueScale = this.getScale()\n  }\n\n  /**\n   * return the color for a volume cell\n   * @param  {Integer} index - volume cell index\n   * @return {Integer} hex cell color\n   */\n  @manageColor\n  volumeColor (index: number) {\n    return this.valueScale((this.parameters.volume! as any).data[ index ])  // TODO\n  }\n}\n\nColormakerRegistry.add('value', ValueColormaker)\n\nexport default ValueColormaker\n","/**\n * @file Volume Colormaker\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\nimport { lerp } from '../math/math-utils'\n\nimport { ColormakerRegistry } from '../globals'\nimport Colormaker, { VolumeColormakerParams, ColormakerScale, manageColor } from './colormaker'\n\n/**\n * Color by volume position\n */\nclass VolumeColormaker extends Colormaker {\n  valueScale: ColormakerScale\n  vec = new Vector3()\n\n  constructor (params: VolumeColormakerParams) {\n    super(params)\n    this.valueScale = this.getScale()\n  }\n\n  /**\n   * return the color for coordinates in space\n   * @param  {Vector3} coords - xyz coordinates\n   * @return {Integer} hex coords color\n   */\n  @manageColor\n  positionColor (coords: Vector3) {\n    const volume = this.parameters.volume as any  // TODO\n\n    if (!volume || !volume.inverseMatrix) {\n      return this.parameters.value\n    }\n\n    const vec = this.vec\n    const data = volume.data\n    const nx = volume.nx\n    const ny = volume.ny\n    const nxy = nx * ny\n\n    vec.copy(coords)\n    vec.applyMatrix4(volume.inverseMatrix)\n\n    // position of grid cell\n    const x0 = Math.floor(vec.x)\n    const y0 = Math.floor(vec.y)\n    const z0 = Math.floor(vec.z)\n\n    // Indices\n    const i = ((((z0 * ny) + y0) * nx) + x0)\n    const i1 = i + 1\n    const iy = i + nx\n    const iz = i + nxy\n    const i1y = iy + 1\n    const i1z = iz + 1\n    const iyz = iy + nxy\n    const i1yz = iyz + 1\n\n    // Values\n    const v = data[ i ]\n    const v1 = data[ i1 ]\n    const vy = data[ iy ]\n    const vz = data[ iz ]\n    const v1y = data[ i1y ]\n    const v1z = data[ i1z ]\n    const vyz = data[ iyz ]\n    const v1yz = data[ i1yz ]\n\n    // Position of point in fraction of grid\n    const xd = vec.x - x0\n    const yd = vec.y - y0\n    const zd = vec.z - z0\n\n    // 1st Dimension\n    const c00 = lerp(v, v1, xd)\n    const c01 = lerp(vz, v1z, xd)\n    const c10 = lerp(vy, v1y, xd)\n    const c11 = lerp(vyz, v1yz, xd)\n\n    // 2nd Dimension\n    const c0 = lerp(c00, c10, yd)\n    const c1 = lerp(c01, c11, yd)\n\n    // 3rd Dimension\n    const c = lerp(c0, c1, zd)\n\n    return this.valueScale(c)\n  }\n}\n\nColormakerRegistry.add('volume', VolumeColormaker)\n\nexport default VolumeColormaker\n","/**\n * @file Structure Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ExtensionFragDepth, Mobile } from '../globals'\nimport { defaults } from '../utils'\nimport { RepresentationParameters, default as Representation } from './representation'\nimport Selection from '../selection/selection'\nimport RadiusFactory, { RadiusFactoryTypes, RadiusType } from '../utils/radius-factory'\nimport Structure from '../structure/structure'\nimport Viewer from '../viewer/viewer'\n// @ts-ignore: unused import Volume required for declaration only\nimport { Assembly, Volume } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport AtomProxy from '../proxy/atom-proxy';\nimport Polymer from '../proxy/polymer';\nimport Buffer from '../buffer/buffer';\nimport { AtomDataFields, BondDataFields, AtomDataParams, BondDataParams } from '../structure/structure-data';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface'\n\n/**\n * Structure representation parameter object.\n * @typedef {Object} StructureRepresentationParameters - structure representation parameters\n * @mixes RepresentationParameters\n *\n * @property {String} radiusType - A list of possible sources of the radius used for rendering the representation. The radius can be based on the *vdW radius*, the *covalent radius* or the *B-factor* value of the corresponding atom. Additionally the radius can be based on the *secondary structure*. Alternatively, when set to *size*, the value from the *radius* parameter is used for all atoms.\n * @property {Float} radius - A number providing a fixed radius used for rendering the representation.\n * @property {Float} scale - A number that scales the value defined by the *radius* or the *radiusType* parameter.\n * @property {String} assembly - name of an assembly object. Included are the asymmetric unit (*AU*) corresponding to the coordinates given in the structure file, biological assemblies from *PDB*, *mmCIF* or *MMTF* files (*BU1*, *BU2*, ...), a filled (crystallographic) unitcell of a given space group (*UNITCELL*), a supercell consisting of a center unitcell and its 26 direct neighbors (*SUPERCELL*). Set to *default* to use the default asemmbly of the structure object.\n */\nexport interface StructureRepresentationParameters extends RepresentationParameters {\n  radiusType: string\n  radius: number\n  scale: number\n  assembly: string\n}\nexport interface StructureRepresentationData {\n  bufferList: Buffer[]\n  polymerList?: Polymer[]\n  sview?: StructureView | Structure\n  [k: string]: any\n}\n/**\n * Structure representation\n * @interface\n */\nabstract class StructureRepresentation extends Representation {\n\n  protected selection: Selection\n  protected dataList: StructureRepresentationData[]\n  structure: Structure\n  structureView: StructureView\n\n  protected radiusType: RadiusType\n  protected radiusData: {[k: number]: number}\n  protected radiusSize: number\n  protected radiusScale: number\n  protected assembly: string\n  protected defaultAssembly: string\n  protected needsBuild: boolean\n\n  /**\n   * Create Structure representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {StructureRepresentationParameters} params - structure representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n\n    super(structure, viewer, p)\n\n    this.type = 'structure'\n\n    this.parameters = Object.assign({\n      radiusType: {\n        type: 'select', options: RadiusFactory.types\n      },\n      radiusData: {\n        type: 'hidden'\n      },\n      radiusSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      radiusScale: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      assembly: null,\n      defaultAssembly: {\n        type: 'hidden'\n      }\n    }, this.parameters)\n\n    /**\n     * @type {Selection}\n     * @private\n     */\n    this.selection = new Selection(p.sele)\n\n    /**\n     * @type {Array}\n     * @private\n     */\n    this.dataList = []\n\n    /**\n     * @type {Structure}\n     */\n    this.structure = structure\n\n    /**\n     * @type {StructureView}\n     */\n    this.structureView = this.structure.getView(this.selection)\n\n    if (structure.biomolDict) {\n      const biomolOptions:{[key: string]: string} = {\n        'default': 'default',\n        '': (structure.unitcell ? 'AU' : 'FULL')\n      }\n      Object.keys(structure.biomolDict).forEach(function (k) {\n        biomolOptions[ k ] = k\n      })\n      this.parameters.assembly = {\n        type: 'select',\n        options: biomolOptions,\n        rebuild: true\n      }\n    } else {\n      this.parameters.assembly = null\n    }\n  }\n\n  get defaultScale () {\n    return {\n      'vdw': 1.0,\n      'covalent': 1.0,\n      'bfactor': 0.01,\n      'sstruc': 1.0\n    }\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'element')\n\n    this.setRadius(p.radius, p)\n\n    this.radiusType = defaults(p.radiusType, 'vdw')\n    this.radiusData = defaults(p.radiusData, {})\n    this.radiusSize = defaults(p.radiusSize, 1.0)\n    this.radiusScale = defaults(p.radiusScale, 1.0)\n    this.assembly = defaults(p.assembly, 'default')\n    this.defaultAssembly = defaults(p.defaultAssembly, '')\n\n    if (p.quality === 'auto') {\n      p.quality = this.getQuality()\n    }\n\n    super.init(p)\n\n    this.selection.signals.stringChanged.add((/* sele */) => {\n      this.build()\n    })\n\n    this.build()\n  }\n\n  setRadius (value: string | number | undefined, p: Partial<StructureRepresentationParameters>) {\n    const types = Object.keys(RadiusFactoryTypes)\n\n    if (typeof value === 'string' && types.includes(value.toLowerCase())) {\n      p.radiusType = value\n    } else if (value !== undefined) {\n      p.radiusType = 'size'\n      p.radiusSize = value\n    }\n\n    return this\n  }\n\n  getAssembly (): Assembly {\n    const name = this.assembly === 'default' ? this.defaultAssembly : this.assembly\n    return this.structure.biomolDict[ name ]\n  }\n\n  getQuality () {\n    let atomCount\n    const s = this.structureView\n    const assembly = this.getAssembly()\n    if (assembly) {\n      atomCount = assembly.getAtomCount(s)\n    } else {\n      atomCount = s.atomCount\n    }\n    if (Mobile) {\n      atomCount *= 4\n    }\n    const backboneOnly = s.atomStore.count / s.residueStore.count < 2\n    if (backboneOnly) {\n      atomCount *= 10\n    }\n\n    if (atomCount < 15000) {\n      return 'high'\n    } else if (atomCount < 80000) {\n      return 'medium'\n    } else {\n      return 'low'\n    }\n  }\n\n  create () {\n    if (this.structureView.atomCount === 0) return\n\n    if (!this.structureView.hasCoords()) {\n      this.needsBuild = true\n      return\n    } else {\n      this.needsBuild = false\n    }\n\n    const assembly = this.getAssembly()\n\n    if (assembly) {\n      assembly.partList.forEach((part, i) => {\n        const sview = <StructureView>part.getView(this.structureView)\n        if (sview.atomCount === 0) return\n        const data = this.createData(sview, i)\n        if (data) {\n          data.sview = sview\n          data.instanceList = part.getInstanceList()\n          this.dataList.push(data)\n        }\n      })\n    } else {\n      const data = this.createData(this.structureView, 0)\n      if (data) {\n        data.sview = this.structureView\n        this.dataList.push(data)\n      }\n    }\n  }\n\n  abstract createData (sview: StructureView, k?: number): StructureRepresentationData|undefined\n\n  update (what: AtomDataFields|BondDataFields) {\n    if (this.lazy && !this.visible) {\n      Object.assign(this.lazyProps.what, what)\n      return\n    }\n\n    if (this.needsBuild) {\n      this.build()\n      return\n    }\n\n    this.dataList.forEach((data) => {\n      if (data.bufferList.length > 0) {\n        this.updateData(what, data)\n      }\n    }, this)\n  }\n\n  updateData (what?: AtomDataFields|BondDataFields, data?: any) {\n    this.build()\n  }\n\n  getColorParams () {\n    return {\n      ...super.getColorParams(),\n      structure: this.structure\n    }\n  }\n\n  getRadiusParams (param?: any) {\n    return {\n      type: this.radiusType,\n      scale: this.radiusScale,\n      size: this.radiusSize,\n      data: this.radiusData\n    }\n  }\n\n  getAtomParams (what?: AtomDataFields, params?: AtomDataParams) {\n    return Object.assign({\n      what: what,\n      colorParams: this.getColorParams(),\n      radiusParams: this.getRadiusParams()\n    }, params)\n  }\n\n  getBondParams (what?: BondDataFields, params?: BondDataParams) {\n    return Object.assign({\n      what: what,\n      colorParams: this.getColorParams(),\n      radiusParams: this.getRadiusParams()\n    }, params)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    if (this.structureView.atomSet!.isSet(atom.index)) {\n      const radiusFactory = new RadiusFactory(this.getRadiusParams())\n      return radiusFactory.atomRadius(atom)\n    }\n    return 0\n  }\n\n  /**\n   * Set representation parameters\n   * @alias StructureRepresentation#setSelection\n   * @param {String} string - selection string, see {@tutorial selection-language}\n   * @param {Boolean} [silent] - don't trigger a change event in the selection\n   * @return {StructureRepresentation} this object\n   */\n  setSelection (string: string, silent?: boolean) {\n    this.selection.setString(string, silent)\n\n    return this\n  }\n\n  /**\n   * Set representation parameters\n   * @alias StructureRepresentation#setParameters\n   * @param {StructureRepresentationParameters} params - structure parameter object\n   * @param {Object} [what] - buffer data attributes to be updated,\n   *                        note that this needs to be implemented in the\n   *                        derived classes. Generally it allows more\n   *                        fine-grained control over updating than\n   *                        forcing a rebuild.\n   * @param {Boolean} what.position - update position data\n   * @param {Boolean} what.color - update color data\n   * @param {Boolean} [rebuild] - whether or not to rebuild the representation\n   * @return {StructureRepresentation} this object\n   */\n  setParameters (params: Partial<StructureRepresentationParameters>, what: AtomDataFields = {}, rebuild = false) {\n    const p = params || {}\n\n    this.setRadius(p.radius, p)\n\n    if (p.radiusType !== undefined || p.radiusData !== undefined || p.radiusSize !== undefined || p.radiusScale !== undefined) {\n      what.radius = true\n      if (!ExtensionFragDepth || this.disableImpostor) {\n        rebuild = true\n      }\n    }\n\n    if (p.defaultAssembly !== undefined &&\n        p.defaultAssembly !== this.defaultAssembly &&\n        ((this.assembly === 'default' && p.assembly === undefined) ||\n          p.assembly === 'default')\n    ) {\n      rebuild = true\n    }\n\n    super.setParameters(p, what, rebuild)\n\n    return this\n  }\n\n  getParameters () {\n    const params = Object.assign(\n      super.getParameters(),\n      {\n        sele: this.selection ? this.selection.string : undefined,\n        defaultAssembly: this.defaultAssembly\n      }\n    )\n\n    return params\n  }\n\n  attach (callback: ()=> void) {\n    const viewer = this.viewer\n    const bufferList = this.bufferList\n\n    this.dataList.forEach(function (data) {\n      data.bufferList.forEach(function (buffer) {\n        bufferList.push(buffer)\n        viewer.add(buffer, data.instanceList)\n      })\n    })\n\n    this.setVisibility(this.visible)\n    callback()\n  }\n\n  clear () {\n    this.dataList.length = 0\n\n    super.clear()\n  }\n\n  dispose () {\n    this.structureView.dispose()\n    this.structure.dispose()\n\n    super.dispose()\n  }\n}\n\nexport default StructureRepresentation\n","/**\n * @file Measurement Representation\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Color, Vector3, Matrix4 } from 'three'\n\nimport Selection from '../selection/selection'\nimport { Browser } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport { uniformArray, uniformArray3 } from '../math/array-utils'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { LabelRepresentationParameters } from './label-representation';\nimport TextBuffer, { TextBufferData } from '../buffer/text-buffer';\n\nexport interface LabelDataField {\n  position?: boolean\n  labelColor?: boolean\n  labelSize?: boolean\n  radius?: boolean\n  labelText?: boolean\n}\n\n/**\n * Measurement representation parameter object.\n * @typedef {Object} MeasurementRepresentationParameters - measurement representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n *\n * @property {Float} labelSize - size of the distance label\n * @property {Color} labelColor - color of the distance label\n * @property {Boolean} labelVisible - visibility of the distance label\n * @property {Float} labelZOffset - offset in z-direction (i.e. in camera direction)\n */\nexport interface MeasurementRepresentationParameters extends StructureRepresentationParameters {\n  labelVisible: boolean\n  labelSize: number\n  labelColor: number\n  labelType: 'atomname'|'atomindex'|'occupancy'|'bfactor'|'serial'|'element'|'atom'|'resname'|'resno'|'res'|'text'|'qualified'\n  labelText: string\n  labelFormat: string\n  labelGrouping: 'atom'|'residue'\n  labelFontFamily: 'sans-serif'|'monospace'|'serif'\n  labelFontStyle: 'normal'|'italic'\n  labelFontWeight: 'normal'|'bold'\n  labelsdf: boolean\n  labelXOffset: number\n  labelYOffset: number\n  labelZOffset: number\n  labelAttachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  labelBorder: boolean\n  labelBorderColor: number\n  labelBorderWidth: number\n  labelBackground: boolean\n  labelBackgroundColor: number\n  labelBackgroundMargin: number\n  labelBackgroundOpacity: number\n  labelFixedSize: boolean\n  lineOpacity: number\n  linewidth: number\n}\n\n/**\n * Measurement representation\n * @interface\n */\nabstract class MeasurementRepresentation extends StructureRepresentation {\n  protected n: number\n  protected labelVisible: boolean\n  protected labelSize: number\n  protected labelColor: number\n  protected labelType: 'atomname'|'atomindex'|'occupancy'|'bfactor'|'serial'|'element'|'atom'|'resname'|'resno'|'res'|'text'|'qualified'\n  protected labelText: string\n  protected labelFormat: string\n  protected labelGrouping: 'atom'|'residue'\n  protected labelFontFamily: 'sans-serif'|'monospace'|'serif'\n  protected labelFontStyle: 'normal'|'italic'\n  protected labelFontWeight: 'normal'|'bold'\n  protected labelsdf: boolean\n  protected labelXOffset: number\n  protected labelYOffset: number\n  protected labelZOffset: number\n  protected labelAttachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  protected labelBorder: boolean\n  protected labelBorderColor: number\n  protected labelBorderWidth: number\n  protected labelBackground: boolean\n  protected labelBackgroundColor: number\n  protected labelBackgroundMargin: number\n  protected labelBackgroundOpacity: number\n  protected labelFixedSize: boolean\n  protected lineOpacity: number\n  protected linewidth: number\n  protected lineVisible: boolean\n\n  protected textBuffer: TextBuffer\n  /**\n   * Handles common label settings and position logic for\n   * distance, angle and dihedral representations\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<MeasurementRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.n = 0 // Subclass create sets value\n    this.parameters = Object.assign({\n      labelVisible: {\n        type: 'boolean'\n      },\n      labelSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      labelColor: {\n        type: 'color'\n      },\n      labelFontFamily: {\n        type: 'select',\n        options: {\n          'sans-serif': 'sans-serif',\n          'monospace': 'monospace',\n          'serif': 'serif'\n        },\n        buffer: 'fontFamily'\n      },\n      labelFontStyle: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'italic': 'italic'\n        },\n        buffer: 'fontStyle'\n      },\n      labelFontWeight: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'bold': 'bold'\n        },\n        buffer: 'fontWeight'\n      },\n      labelsdf: {\n        type: 'boolean', buffer: 'sdf'\n      },\n      labelXOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: 'xOffset'\n      },\n      labelYOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: 'yOffset'\n      },\n      labelZOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: 'zOffset'\n      },\n      labelAttachment: {\n        type: 'select',\n        options: {\n          'bottom-left': 'bottom-left',\n          'bottom-center': 'bottom-center',\n          'bottom-right': 'bottom-right',\n          'middle-left': 'middle-left',\n          'middle-center': 'middle-center',\n          'middle-right': 'middle-right',\n          'top-left': 'top-left',\n          'top-center': 'top-center',\n          'top-right': 'top-right'\n        },\n        rebuild: true\n      },\n      labelBorder: {\n        type: 'boolean', buffer: 'showBorder'\n      },\n      labelBorderColor: {\n        type: 'color', buffer: 'borderColor'\n      },\n      labelBorderWidth: {\n        type: 'number', precision: 2, max: 0.3, min: 0, buffer: 'borderWidth'\n      },\n      labelBackground: {\n        type: 'boolean', rebuild: true\n      },\n      labelBackgroundColor: {\n        type: 'color', buffer: 'backgroundColor'\n      },\n      labelBackgroundMargin: {\n        type: 'number', precision: 2, max: 2, min: 0, rebuild: true\n      },\n      labelBackgroundOpacity: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: 'backgroundOpacity'\n      },\n      labelFixedSize: {\n        type: 'boolean', buffer: 'fixedSize'\n      },\n      lineOpacity: {\n        type: 'range', min: 0.0, max: 1.0, step: 0.01\n      },\n      linewidth: {\n        type: 'integer', max: 50, min: 1, buffer: true\n      }\n    }, this.parameters, {\n      flatShaded: null\n    })\n  }\n\n  init (params: Partial<MeasurementRepresentationParameters>) {\n    const p = params || {}\n    this.labelVisible = defaults(p.labelVisible, true)\n    this.labelSize = defaults(p.labelSize, 2.0)\n    this.labelColor = defaults(p.labelColor, 0xFFFFFF)\n    this.labelFontFamily = defaults(p.labelFontFamily, 'sans-serif')\n    this.labelFontStyle = defaults(p.labelFontstyle, 'normal')\n    this.labelFontWeight = defaults(p.labelFontWeight, 'bold')\n    this.labelsdf = defaults(p.labelsdf, Browser === 'Chrome')\n    this.labelXOffset = defaults(p.labelXOffset, 0.0)\n    this.labelYOffset = defaults(p.labelYOffset, 0.0)\n    this.labelZOffset = defaults(p.labelZOffset, 0.5)\n    this.labelAttachment = defaults(p.labelAttachment, 'bottom-left')\n    this.labelBorder = defaults(p.labelBorder, false)\n    this.labelBorderColor = defaults(p.labelBorderColor, 'lightgrey')\n    this.labelBorderWidth = defaults(p.labelBorderWidth, 0.15)\n    this.labelBackground = defaults(p.labelBackground, false)\n    this.labelBackgroundColor = defaults(p.labelBackgroundColor, 'lightgrey')\n    this.labelBackgroundMargin = defaults(p.labelBackgroundMargin, 0.5)\n    this.labelBackgroundOpacity = defaults(p.labelBackgroundOpacity, 1.0)\n    this.labelFixedSize = defaults(p.labelFixedSize, false)\n    this.lineOpacity = defaults(p.lineOpacity, 1.0)\n    this.linewidth = defaults(p.linewidth, 2)\n\n    super.init(p)\n  }\n\n  // All measurements need to rebuild on position change\n  update (what: LabelDataField) {\n    if (what.position) {\n      this.build()\n    } else {\n      super.update(what)\n    }\n  }\n\n  updateData (what: LabelDataField & {[k: string]: any}, data: any) {\n    const textData: TextBufferData | {} = {}\n    if (!what || what.labelSize) {\n      Object.assign(textData, {size: uniformArray(this.n, this.labelSize)})\n    }\n\n    if (!what || what.labelColor) {\n      const c = new Color(this.labelColor)\n      Object.assign(textData, {color: uniformArray3(this.n, c.r, c.g, c.b)})\n    }\n\n    this.textBuffer.setAttributes(textData as TextBufferData)\n  }\n\n  setParameters (params: Partial<MeasurementRepresentationParameters>, what: LabelDataField = {}, rebuild = false) {\n    if (params && params.labelSize) {\n      what.labelSize = true\n    }\n\n    if (params && (params.labelColor || params.labelColor === 0x000000)) {\n      what.labelColor = true\n      rebuild = true\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    if (params && params.opacity !== undefined) {\n      this.textBuffer.setParameters({ opacity: 1.0 }) // only opaque labels\n    }\n\n    if (params && params.labelVisible !== undefined) {\n      this.setVisibility(this.visible)\n    }\n\n    return this\n  }\n\n  setVisibility (value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n    if (this.textBuffer) {\n      this.textBuffer.setVisibility(\n        this.labelVisible && this.visible\n      )\n    }\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n\n  getLabelBufferParams (params: Partial<LabelRepresentationParameters> = {}) {\n    return super.getBufferParams(Object.assign({\n      fontFamily: this.labelFontFamily,\n      fontStyle: this.labelFontStyle,\n      fontWeight: this.labelFontWeight,\n      sdf: this.labelsdf,\n      xOffset: this.labelXOffset,\n      yOffset: this.labelYOffset,\n      zOffset: this.labelZOffset,\n      attachment: this.labelAttachment,\n      showBorder: this.labelBorder,\n      borderColor: this.labelBorderColor,\n      borderWidth: this.labelBorderWidth,\n      showBackground: this.labelBackground,\n      backgroundColor: this.labelBackgroundColor,\n      backgroundMargin: this.labelBackgroundMargin,\n      backgroundOpacity: this.labelBackgroundOpacity,\n      fixedSize: this.labelFixedSize,\n      disablePicking: true,\n      visible: this.labelVisible\n    }, params, {\n      opacity: 1.0 // only opaque labels\n    }))\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n}\n\n/**\n * MeasurementRepresentations take atom[Pair|Triple|Quad] parameters.\n *\n * Parses nested array of either integer atom indices or selection\n * expressions into a flat array of coordinates.\n *\n * @param  {Structure} sview The structure to which the atoms refer\n * @param  {Array} atoms Nested array of atom pairs|triples|quads as\n *   Integer indices or selection expressions\n * @return {Float32Array} Flattened array of position coordinates\n */\nfunction parseNestedAtoms (sview: StructureView, atoms: (number|string)[][]) {\n  const ap = sview.getAtomProxy()\n  const sele = new Selection()\n\n  const nSets = atoms.length\n  if (nSets === 0) return new Float32Array(0)\n\n  // Peek-ahead at first item to determine order and parse mode\n  const order = atoms[ 0 ].length\n  const selected = sview.getAtomSet()\n\n  const a = new Float32Array(nSets * order * 3)\n\n  let p = 0\n  atoms.forEach(function (group) {\n    let _break = false\n    for (let j = 0; j < order; j++) {\n      const value = group[ j ]\n      if (typeof (value) === 'number' && Number.isInteger(value)) {\n        if (selected.get(value)) {\n          ap.index = value\n        } else {\n          _break = true\n          break\n        }\n      } else {\n        sele.setString(value as string)\n        const atomIndices = sview.getAtomIndices(sele)\n        if (atomIndices!.length) {\n          ap.index = atomIndices![ 0 ]\n        } else {\n          _break = true\n          break\n        }\n      }\n\n      let offset = p + j * 3\n      a[ offset++ ] = ap.x\n      a[ offset++ ] = ap.y\n      a[ offset++ ] = ap.z\n    }\n    if (!_break) p += 3 * order\n  })\n\n  return a.subarray(0, p)\n}\n\n/* out = v1 * cos(angle) + v2 * sin(angle) */\nfunction calcArcPoint (out: Float32Array, center: Float32Array, v1: Float32Array, v2: Float32Array, angle: number) {\n  const x = Math.cos(angle)\n  const y = Math.sin(angle)\n  out[ 0 ] = center[ 0 ] + v1[ 0 ] * x + v2[ 0 ] * y\n  out[ 1 ] = center[ 1 ] + v1[ 1 ] * x + v2[ 1 ] * y\n  out[ 2 ] = center[ 2 ] + v1[ 2 ] * x + v2[ 2 ] * y\n}\n\nexport {\n  MeasurementRepresentation as default,\n  calcArcPoint,\n  parseNestedAtoms\n}\n","/**\n * @file Edt\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { NumberArray } from '../types'\n\n// 2D Euclidean distance transform by Felzenszwalb & Huttenlocher https://cs.brown.edu/~pff/papers/dt-final.pdf\nexport function edt(data: NumberArray, width: number, height: number, f: NumberArray, d: NumberArray, v: NumberArray, z: NumberArray) {\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            f[y] = data[y * width + x]\n        }\n        edt1d(f, d, v, z, height)\n        for (let y = 0; y < height; y++) {\n            data[y * width + x] = d[y]\n        }\n    }\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n            f[x] = data[y * width + x]\n        }\n        edt1d(f, d, v, z, width)\n        for (let x = 0; x < width; x++) {\n            data[y * width + x] = Math.sqrt(d[x])\n        }\n    }\n}\n\n// 1D squared distance transform\nfunction edt1d(f: NumberArray, d: NumberArray, v: NumberArray, z: NumberArray, n: number) {\n    v[0] = 0\n    z[0] = Number.MIN_SAFE_INTEGER\n    z[1] = Number.MAX_SAFE_INTEGER\n\n    for (let q = 1, k = 0; q < n; q++) {\n        let s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k])\n        while (s <= z[k]) {\n            k--\n            s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k])\n        }\n        k++\n        v[k] = q\n        z[k] = s\n        z[k + 1] = Number.MAX_SAFE_INTEGER\n    }\n\n    for (let q = 0, k = 0; q < n; q++) {\n        while (z[k + 1] < q) k++\n        d[q] = (q - v[k]) * (q - v[k]) + f[v[k]]\n    }\n}\n","/**\n * @file Text Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Color, CanvasTexture, Vector3, Matrix4 } from 'three'\n\nimport '../shader/SDFFont.vert'\nimport '../shader/SDFFont.frag'\n\nimport { BufferRegistry } from '../globals'\nimport { createParams } from '../utils'\nimport MappedQuadBuffer from './mappedquad-buffer'\nimport { IgnorePicker } from '../utils/picker'\nimport { edt } from '../utils/edt'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferData, BufferTypes } from './buffer'\n\nconst TextAtlasCache: { [k: string]: TextAtlas } = {}\n\nfunction getTextAtlas (params: Partial<TextAtlasParams>) {\n  const hash = JSON.stringify(params)\n  if (TextAtlasCache[ hash ] === undefined) {\n    TextAtlasCache[ hash ] = new TextAtlas(params)\n  }\n  return TextAtlasCache[ hash ]\n}\n\ntype TextFonts = 'sans-serif'|'monospace'|'serif'\ntype TextStyles = 'normal'|'italic'\ntype TextVariants = 'normal'\ntype TextWeights = 'normal'|'bold'\n\nexport const TextAtlasDefaultParams = {\n  font: 'sans-serif' as TextFonts,\n  size: 36,\n  style: 'normal' as TextStyles,\n  variant: 'normal' as TextVariants,\n  weight: 'normal' as TextWeights,\n  outline: 3,\n  width: 1024,\n  height: 1024\n}\nexport type TextAtlasParams = typeof TextAtlasDefaultParams\n\nexport type TextAtlasMap = { x: number, y: number, w: number, h: number }\n\nexport class TextAtlas {\n  parameters: TextAtlasParams\n\n  gamma = 1\n  mapped: { [k: string]: TextAtlasMap } = {}\n  scratchW = 0\n  scratchH = 0\n  currentX = 0\n  currentY = 0\n\n  cutoff = 0.25\n  padding: number\n  radius: number\n\n  gridOuter: Float64Array\n  gridInner: Float64Array\n  f: Float64Array\n  d: Float64Array\n  z: Float64Array\n  v: Int16Array\n\n  paddedSize: number\n  middle: number\n\n  texture: CanvasTexture\n  canvas: HTMLCanvasElement\n  context: CanvasRenderingContext2D\n\n  lineHeight: number\n  maxWidth: number\n  colors: string[]\n  scratch: Uint8Array\n  canvas2: HTMLCanvasElement\n  context2: CanvasRenderingContext2D\n  data: Uint8Array\n\n  placeholder: TextAtlasMap\n\n  constructor (params: Partial<TextAtlasParams> = {}) {\n    this.parameters = createParams(params, TextAtlasDefaultParams)\n    const p = this.parameters\n\n    this.radius = p.size / 8\n    this.padding = p.size / 3\n\n    // Prepare line-height with room for outline and descenders/ascenders\n    const lineHeight = this.lineHeight = p.size + 2 * p.outline + Math.round(p.size / 4)\n    const maxWidth = this.maxWidth = p.width / 4\n\n    // Prepare scratch canvas\n    const canvas = this.canvas = document.createElement('canvas')\n    canvas.width = maxWidth\n    canvas.height = lineHeight\n\n    const ctx = this.context = this.canvas.getContext('2d')!\n    ctx.font = `${p.style} ${p.variant} ${p.weight} ${p.size}px ${p.font}`\n    ctx.fillStyle = 'black'\n    ctx.textAlign = 'left'\n    ctx.textBaseline = 'bottom'\n    ctx.lineJoin = 'round'\n\n    // temporary arrays for the distance transform\n    this.gridOuter = new Float64Array(lineHeight * maxWidth)\n    this.gridInner = new Float64Array(lineHeight * maxWidth)\n    this.f = new Float64Array(Math.max(lineHeight, maxWidth))\n    this.d = new Float64Array(Math.max(lineHeight, maxWidth))\n    this.z = new Float64Array(Math.max(lineHeight, maxWidth) + 1)\n    this.v = new Int16Array(Math.max(lineHeight, maxWidth))\n\n    //\n    this.data = new Uint8Array(p.width * p.height * 4)\n    this.canvas2 = document.createElement('canvas')\n    this.canvas2.width = p.width\n    this.canvas2.height = p.height\n    this.context2 = this.canvas2.getContext('2d')!\n\n    // Replacement Character\n    this.placeholder = this.map(String.fromCharCode(0xFFFD))\n\n    // Basic Latin (subset)\n    for (let i = 0x0020; i <= 0x007E; ++i) {\n      this.map(String.fromCharCode(i))\n    }\n\n    // TODO: to slow to always prepare them\n    // // Latin-1 Supplement (subset)\n    // for (let i = 0x00A1; i <= 0x00FF; ++i) {\n    //   this.map(String.fromCharCode(i))\n    // }\n\n    // Degree sign\n    this.map(String.fromCharCode(0x00B0))\n\n    // // Greek and Coptic (subset)\n    // for (let i = 0x0391; i <= 0x03C9; ++i) {\n    //   this.map(String.fromCharCode(i))\n    // }\n\n    // // Cyrillic (subset)\n    // for (let i = 0x0400; i <= 0x044F; ++i) {\n    //   this.map(String.fromCharCode(i))\n    // }\n\n    // Angstrom Sign\n    this.map(String.fromCharCode(0x212B))\n\n    this.texture = new CanvasTexture(this.canvas2)\n    this.texture.flipY = false\n    this.texture.needsUpdate = true\n  }\n\n  map (text: string) {\n    const p = this.parameters\n\n    if (this.mapped[ text ] === undefined) {\n      this.draw(text)\n\n      if (this.currentX + this.scratchW > p.width) {\n        this.currentX = 0\n        this.currentY += this.scratchH\n      }\n      if (this.currentY + this.scratchH > p.height) {\n        console.warn('canvas to small')\n      }\n\n      this.mapped[ text ] = {\n        x: this.currentX,\n        y: this.currentY,\n        w: this.scratchW,\n        h: this.scratchH\n      }\n\n      this.context2.drawImage(\n        this.canvas,\n        0, 0,\n        this.scratchW, this.scratchH,\n        this.currentX, this.currentY,\n        this.scratchW, this.scratchH\n      )\n\n      this.currentX += this.scratchW\n    }\n\n    return this.mapped[ text ]\n  }\n\n  get (text: string) {\n    return this.mapped[ text ] || this.placeholder\n  }\n\n  draw (text: string) {\n    const p = this.parameters\n\n    const h = this.lineHeight\n    const o = p.outline\n    const ctx = this.context\n    // const dst = this.scratch\n    const max = this.maxWidth\n    // const colors = this.colors\n\n    // Bottom aligned, take outline into account\n    const x = o\n    const y = h - p.outline\n\n    // Measure text\n    const m = ctx.measureText(text)\n    const w = Math.min(max, Math.ceil(m.width + 2 * x + 1))\n\n    const n = w * h\n\n    // Clear scratch area\n    ctx.clearRect(0, 0, w, h)\n\n    // Draw text\n    ctx.fillText(text, x, y)\n\n    const imageData = ctx.getImageData(0, 0, w, h)\n    const data = imageData.data\n\n    for (let i = 0; i < n; i++) {\n        const a = imageData.data[i * 4 + 3] / 255; // alpha value\n        this.gridOuter[i] = a === 1 ? 0 : a === 0 ? Number.MAX_SAFE_INTEGER : Math.pow(Math.max(0, 0.5 - a), 2);\n        this.gridInner[i] = a === 1 ? Number.MAX_SAFE_INTEGER : a === 0 ? 0 : Math.pow(Math.max(0, a - 0.5), 2);\n    }\n\n    edt(this.gridOuter, w, h, this.f, this.d, this.v, this.z);\n    edt(this.gridInner, w, h, this.f, this.d, this.v, this.z);\n\n    for (let i = 0; i < n; i++) {\n        const d = this.gridOuter[i] - this.gridInner[i];\n        data[i * 4 + 3] = Math.max(0, Math.min(255, Math.round(255 - 255 * (d / this.radius + this.cutoff))));\n    }\n\n    ctx.putImageData(imageData, 0, 0)\n    this.scratchW = w\n    this.scratchH = h\n  }\n}\n\n/**\n * Text buffer parameter object.\n * @typedef {Object} TextBufferParameters - text buffer parameters\n *\n * @property {Float} opacity - translucency: 1 is fully opaque, 0 is fully transparent\n * @property {Integer} clipNear - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {String} labelType - type of the label, one of:\n *                                 \"atomname\", \"atomindex\", \"occupancy\", \"bfactor\",\n *                                 \"serial\", \"element\", \"atom\", \"resname\", \"resno\",\n *                                 \"res\", \"text\", \"qualified\". When set to \"text\", the\n *                                 `labelText` list is used.\n * @property {String[]} labelText - list of label strings, must set `labelType` to \"text\"\n *                                   to take effect\n * @property {String} fontFamily - font family, one of: \"sans-serif\", \"monospace\", \"serif\"\n * @property {String} fontStyle - font style, \"normal\" or \"italic\"\n * @property {String} fontWeight - font weight, \"normal\" or \"bold\"\n * @property {Float} xOffset - offset in x-direction\n * @property {Float} yOffset - offset in y-direction\n * @property {Float} zOffset - offset in z-direction (i.e. in camera direction)\n * @property {String} attachment - attachment of the label, one of:\n *                                 \"bottom-left\", \"bottom-center\", \"bottom-right\",\n *                                 \"middle-left\", \"middle-center\", \"middle-right\",\n *                                 \"top-left\", \"top-center\", \"top-right\"\n * @property {Boolean} showBorder - show border/outline\n * @property {Color} borderColor - color of the border/outline\n * @property {Float} borderWidth - width of the border/outline\n * @property {Boolean} showBackground - show background rectangle\n * @property {Color} backgroundColor - color of the background\n * @property {Float} backgroundMargin - width of the background\n * @property {Float} backgroundOpacity - opacity of the background\n * @property {Boolean} fixedSize - show text with a fixed pixel size\n */\n\nexport interface TextBufferData extends BufferData {\n  size: Float32Array\n  text: string[]\n}\n\ntype TextAttachments = 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n\nexport const TextBufferDefaultParameters = Object.assign({\n  fontFamily: 'sans-serif' as TextFonts,\n  fontStyle: 'normal' as TextStyles,\n  fontWeight: 'bold' as TextWeights,\n  fontSize: 36,\n  xOffset: 0.0,\n  yOffset: 0.0,\n  zOffset: 0.5,\n  attachment: 'bottom-left' as TextAttachments,\n  showBorder: false,\n  borderColor: 'lightgrey' as number|string,\n  borderWidth: 0.15,\n  showBackground: false,\n  backgroundColor: 'lightgrey' as number|string,\n  backgroundMargin: 0.5,\n  backgroundOpacity: 1.0,\n  forceTransparent: true,\n  fixedSize: false\n}, BufferDefaultParameters)\nexport type TextBufferParameters = typeof TextBufferDefaultParameters\n\nconst TextBufferParameterTypes = Object.assign({\n  fontFamily: { uniform: true },\n  fontStyle: { uniform: true },\n  fontWeight: { uniform: true },\n  fontSize: { uniform: true },\n  xOffset: { uniform: true },\n  yOffset: { uniform: true },\n  zOffset: { uniform: true },\n  showBorder: { uniform: true },\n  borderColor: { uniform: true },\n  borderWidth: { uniform: true },\n  backgroundColor: { uniform: true },\n  backgroundOpacity: { uniform: true },\n  fixedSize: { updateShader: true }\n}, BufferParameterTypes)\n\nfunction getCharCount (data: TextBufferData, params: Partial<TextBufferParameters>) {\n  const n = data.position!.length / 3\n  let charCount = 0\n  for (let i = 0; i < n; ++i) {\n    charCount += data.text[ i ].length\n  }\n  if (params.showBackground) charCount += n\n\n  return charCount\n}\n\n/**\n * Text buffer. Renders screen-aligned text strings.\n *\n * @example\n * var textBuffer = new TextBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   size: new Float32Array([ 2 ]),\n *   text: [ \"Hello\" ]\n * });\n */\nclass TextBuffer extends MappedQuadBuffer {\n  parameterTypes = TextBufferParameterTypes\n  get defaultParameters() { return TextBufferDefaultParameters }\n  parameters: TextBufferParameters\n\n  alwaysTransparent = true\n  hasWireframe = false\n  isText = true\n  vertexShader = 'SDFFont.vert'\n  fragmentShader = 'SDFFont.frag'\n\n  text: string[]\n  positionCount: number\n  texture: CanvasTexture\n  textAtlas: TextAtlas\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.size - sizes\n   * @param  {String[]} data.text - text strings\n   * @param  {TextBufferParameters} params - parameters object\n   */\n  constructor (data: TextBufferData, params: Partial<TextBufferParameters> = {}) {\n    super({\n      position: new Float32Array(getCharCount(data, params) * 3),\n      color: new Float32Array(getCharCount(data, params) * 3),\n      picking: new IgnorePicker()\n    }, params)\n\n    this.text = data.text\n    this.positionCount = data.position!.length / 3\n\n    this.addUniforms({\n      'fontTexture': { value: null },\n      'xOffset': { value: this.parameters.xOffset },\n      'yOffset': { value: this.parameters.yOffset },\n      'zOffset': { value: this.parameters.zOffset },\n      'ortho': { value: false },\n      'showBorder': { value: this.parameters.showBorder },\n      'borderColor': { value: new Color(this.parameters.borderColor as number) },\n      'borderWidth': { value: this.parameters.borderWidth },\n      'backgroundColor': { value: new Color(this.parameters.backgroundColor as number) },\n      'backgroundOpacity': { value: this.parameters.backgroundOpacity },\n      'canvasHeight': { value: 1.0 },\n      'pixelRatio': { value: 1.0 }\n    })\n\n    this.addAttributes({\n      'inputTexCoord': { type: 'v2', value: null },\n      'inputSize': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n\n    this.makeTexture()\n    this.makeMapping()\n  }\n\n  makeMaterial () {\n    super.makeMaterial()\n\n    const tex = this.texture\n\n    const m = this.material\n    m.transparent = true\n    m.extensions.derivatives = true\n    m.lights = false\n    m.uniforms.fontTexture.value = tex\n    m.needsUpdate = true\n\n    const wm = this.wireframeMaterial\n    wm.transparent = true\n    wm.extensions.derivatives = true\n    wm.lights = false\n    wm.uniforms.fontTexture.value = tex\n    wm.needsUpdate = true\n\n    const pm = this.pickingMaterial\n    pm.extensions.derivatives = true\n    pm.lights = false\n    pm.uniforms.fontTexture.value = tex\n    pm.needsUpdate = true\n  }\n\n  setAttributes (data: Partial<TextBufferData> = {}) {\n    let position, size, color\n    let aPosition, inputSize, aColor\n\n    const text = this.text\n    const attributes = this.geometry.attributes as any  // TODO\n\n    if (data.position) {\n      position = data.position\n      aPosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    if (data.size) {\n      size = data.size\n      inputSize = attributes.inputSize.array\n      attributes.inputSize.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      aColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    const n = this.positionCount\n\n    let j, o\n    let iCharAll = 0\n    let txt, iChar, nChar\n\n    for (let v = 0; v < n; ++v) {\n      o = 3 * v\n      txt = text[ v ]\n      nChar = txt.length\n      if (this.parameters.showBackground) nChar += 1\n\n      for (iChar = 0; iChar < nChar; ++iChar, ++iCharAll) {\n        for (let m = 0; m < 4; m++) {\n          j = iCharAll * 4 * 3 + (3 * m)\n\n          if (position) {\n            aPosition[ j ] = position[ o ]\n            aPosition[ j + 1 ] = position[ o + 1 ]\n            aPosition[ j + 2 ] = position[ o + 2 ]\n          }\n\n          if (size) {\n            inputSize[ (iCharAll * 4) + m ] = size[ v ]\n          }\n\n          if (color) {\n            aColor[ j ] = color[ o ]\n            aColor[ j + 1 ] = color[ o + 1 ]\n            aColor[ j + 2 ] = color[ o + 2 ]\n          }\n        }\n      }\n    }\n  }\n\n  makeTexture () {\n    this.textAtlas = getTextAtlas({\n      font: this.parameters.fontFamily,\n      style: this.parameters.fontStyle,\n      weight: this.parameters.fontWeight,\n      size: this.parameters.fontSize\n    })\n\n    this.texture = this.textAtlas.texture\n  }\n\n  makeMapping () {\n    const ta = this.textAtlas\n    const text = this.text\n    const attachment = this.parameters.attachment\n    const margin = (ta.lineHeight * this.parameters.backgroundMargin * 0.1) - 10\n\n    const attribs = this.geometry.attributes as any  // TODO\n    const inputTexCoord = attribs.inputTexCoord.array\n    const inputMapping = attribs.mapping.array\n\n    const n = this.positionCount\n    let iCharAll = 0\n    let c, i, txt, xadvance, iChar, nChar, xShift, yShift\n\n    for (let v = 0; v < n; ++v) {\n      txt = text[ v ]\n      xadvance = 0\n      nChar = txt.length\n\n      // calculate width\n      for (iChar = 0; iChar < nChar; ++iChar) {\n        c = ta.get(txt[ iChar ])\n        xadvance += c.w - 2 * ta.parameters.outline\n      }\n\n      // attachment\n      if (attachment.startsWith('top')) {\n        yShift = ta.lineHeight / 1.25\n      } else if (attachment.startsWith('middle')) {\n        yShift = ta.lineHeight / 2.5\n      } else {\n        yShift = 0  // \"bottom\"\n      }\n      if (attachment.endsWith('right')) {\n        xShift = xadvance\n      } else if (attachment.endsWith('center')) {\n        xShift = xadvance / 2\n      } else {\n        xShift = 0  // \"left\"\n      }\n      xShift += ta.parameters.outline\n      yShift += ta.parameters.outline\n\n      // background\n      if (this.parameters.showBackground) {\n        i = iCharAll * 2 * 4\n        inputMapping[ i + 0 ] = -ta.lineHeight / 6 - xShift - margin  // top left\n        inputMapping[ i + 1 ] = ta.lineHeight - yShift + margin\n        inputMapping[ i + 2 ] = -ta.lineHeight / 6 - xShift - margin  // bottom left\n        inputMapping[ i + 3 ] = 0 - yShift - margin\n        inputMapping[ i + 4 ] = xadvance + ta.lineHeight / 6 - xShift + 2 * ta.parameters.outline + margin  // top right\n        inputMapping[ i + 5 ] = ta.lineHeight - yShift + margin\n        inputMapping[ i + 6 ] = xadvance + ta.lineHeight / 6 - xShift + 2 * ta.parameters.outline + margin  // bottom right\n        inputMapping[ i + 7 ] = 0 - yShift - margin\n        inputTexCoord[ i + 0 ] = 10\n        inputTexCoord[ i + 2 ] = 10\n        inputTexCoord[ i + 4 ] = 10\n        inputTexCoord[ i + 6 ] = 10\n        iCharAll += 1\n      }\n\n      xadvance = 0\n\n      for (iChar = 0; iChar < nChar; ++iChar, ++iCharAll) {\n        c = ta.get(txt[ iChar ])\n        i = iCharAll * 2 * 4\n\n        inputMapping[ i + 0 ] = xadvance - xShift  // top left\n        inputMapping[ i + 1 ] = c.h - yShift\n        inputMapping[ i + 2 ] = xadvance - xShift  // bottom left\n        inputMapping[ i + 3 ] = 0 - yShift\n        inputMapping[ i + 4 ] = xadvance + c.w - xShift  // top right\n        inputMapping[ i + 5 ] = c.h - yShift\n        inputMapping[ i + 6 ] = xadvance + c.w - xShift  // bottom right\n        inputMapping[ i + 7 ] = 0 - yShift\n\n        const texWidth = ta.parameters.width\n        const texHeight = ta.parameters.height\n\n        const texCoords = [\n          c.x / texWidth, c.y / texHeight,             // top left\n          c.x / texWidth, (c.y + c.h) / texHeight,       // bottom left\n          (c.x + c.w) / texWidth, c.y / texHeight,       // top right\n          (c.x + c.w) / texWidth, (c.y + c.h) / texHeight  // bottom right\n        ]\n        inputTexCoord.set(texCoords, i)\n\n        xadvance += c.w - 2 * ta.parameters.outline\n      }\n    }\n\n    attribs.inputTexCoord.needsUpdate = true\n    attribs.mapping.needsUpdate = true\n  }\n\n  getDefines (type: BufferTypes) {\n    const defines = super.getDefines(type)\n\n    if (this.parameters.fixedSize) {\n      defines.FIXED_SIZE = 1\n    }\n\n    return defines\n  }\n\n  setUniforms (data: any) {  // TODO\n    if (data && (\n      data.fontFamily !== undefined ||\n      data.fontStyle !== undefined ||\n      data.fontWeight !== undefined ||\n      data.fontSize !== undefined\n    )) {\n      this.makeTexture()\n      this.makeMapping()\n      this.texture.needsUpdate = true\n      data.fontTexture = this.texture\n    }\n\n    super.setUniforms(data)\n  }\n}\n\nBufferRegistry.add('text', TextBuffer)\n\nexport default TextBuffer\n","/**\n * @file Wide Line Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\nimport { Vector2, Vector3, Matrix4 } from 'three'\n\nimport '../shader/WideLine.vert'\nimport '../shader/WideLine.frag'\n\nimport { BufferRegistry } from '../globals'\nimport MappedQuadBuffer from './mappedquad-buffer'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferData } from './buffer'\n\nexport interface WideLineBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n}\n\nexport const WideLineBufferDefaultParameters = Object.assign({\n  linewidth: 2\n}, BufferDefaultParameters)\nexport type WideLineBufferParameters = typeof WideLineBufferDefaultParameters\n\nconst WideLineBufferParameterTypes = Object.assign({\n  linewidth: { uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Wide Line buffer. Draws lines with a fixed width in pixels.\n *\n * @example\n * var lineBuffer = new WideLineBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ])\n * });\n */\nclass WideLineBuffer extends MappedQuadBuffer {\n  parameterTypes = WideLineBufferParameterTypes\n  get defaultParameters() { return WideLineBufferDefaultParameters }\n  parameters: WideLineBufferParameters\n\n  vertexShader = 'WideLine.vert'\n  fragmentShader ='WideLine.frag'\n\n  constructor (data: Partial<WideLineBufferData>, params: Partial<WideLineBufferParameters> = {}) {\n    super(data, params)\n\n    if (!data.color2 && data.color) data.color2 = data.color\n\n    this.addUniforms({\n      'linewidth': { value: this.parameters.linewidth },\n      'resolution': { value: new Vector2() },\n      'projectionMatrixInverse': { value: new Matrix4() }\n    })\n\n    this.addAttributes({\n      'position1': { type: 'v3', value: null },\n      'position2': { type: 'v3', value: null },\n      'color2': { type: 'c', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n\n  setParameters (params: Partial<WideLineBufferParameters>) {\n    super.setParameters(params)\n  }\n}\n\nBufferRegistry.add('wideline', WideLineBuffer)\n\nexport default WideLineBuffer\n","/**\n * @file Angle Representation\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\nimport { Color } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport MeasurementRepresentation, { parseNestedAtoms, calcArcPoint, MeasurementRepresentationParameters, LabelDataField } from './measurement-representation'\nimport { defaults } from '../utils'\n\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport TextBuffer, { TextBufferData, TextBufferParameters } from '../buffer/text-buffer'\nimport WideLineBuffer, { WideLineBufferData } from '../buffer/wideline-buffer'\n\nimport { v3add, v3cross, v3dot, v3fromArray, v3length, v3new,\n  v3normalize, v3sub, v3toArray } from '../math/vector-utils'\nimport { copyArray, uniformArray, uniformArray3 } from '../math/array-utils'\nimport { RAD2DEG } from '../math/math-constants'\nimport { getFixedLengthWrappedDashData } from '../geometry/dash'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { BufferData } from '../buffer/buffer';\nimport { StructureRepresentationData, StructureRepresentationParameters } from './structure-representation';\n\n/**\n * @typedef {Object} AngleRepresentationParameters - angle representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n * @mixes MeasurementRepresentationParameters\n *\n * @property {String} atomTriple - list of triplets of selection strings\n *                                 or atom indices\n * @property {Boolean} vectorVisible - Indicate the 3 points for each angle by drawing lines 1-2-3\n * @property {Boolean} arcVisible - Show the arc outline for each angle\n * @property {Number}  lineOpacity - opacity for the line part of the representation\n * @property {Number} linewidth - width for line part of representation\n * @property {Boolean} sectorVisible - Show the filled arc for each angle\n */\n\nexport interface AngleRepresentationParameters extends MeasurementRepresentationParameters {\n  atomTriple: (number|string)[][]\n  vectorVisible: boolean\n  arcVisible: boolean\n  lineOpacity: number\n  lineWidth: number\n  sectorVisible: boolean\n}\n\n/**\n * Angle representation object\n *\n * Reperesentation consists of four parts, visibility can be set for each\n * label - the text label with the angle size\n * vectors - lines joining the three points\n * sector - triangles representing the angle\n * arc - line bordering the sector\n *\n * @param {Structure} structure - the structure to measure angles in\n * @param {Viewer} viewer - a viewer object\n * @param {AngleRepresentationParameters} params - angle representation parameters\n */\nclass AngleRepresentation extends MeasurementRepresentation {\n  protected atomTriple: (number|string)[][]\n  protected vectorVisible: boolean\n  protected arcVisible: boolean\n  protected lineOpacity: number\n  protected lineWidth: number\n  protected sectorVisible: boolean\n  protected vectorBuffer: WideLineBuffer\n  arcLength: number\n  sectorLength: number\n  arcBuffer: WideLineBuffer\n  sectorBuffer: MeshBuffer\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<AngleRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'angle'\n\n    this.parameters = Object.assign({\n      atomTriple: {\n        type: 'hidden', rebuild: true\n      },\n      vectorVisible: {\n        type: 'boolean', default: true\n      },\n      arcVisible: {\n        type: 'boolean', default: true\n      },\n      sectorVisible: {\n        type: 'boolean', default: true\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<AngleRepresentationParameters>) {\n    const p = params || {}\n    p.side = defaults(p.side, 'double')\n    p.opacity = defaults(p.opacity, 0.5)\n\n    this.atomTriple = defaults(p.atomTriple, [])\n    this.arcVisible = defaults(p.arcVisible, true)\n    this.sectorVisible = defaults(p.sectorVisible, true)\n    this.vectorVisible = defaults(p.vectorVisible, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.atomCount || !this.atomTriple.length) return\n\n    const atomPosition = atomTriplePositions(sview, this.atomTriple)\n    const angleData = getAngleData(atomPosition)\n    const n = this.n = angleData.labelPosition.length / 3\n\n    const labelColor = new Color(this.labelColor)\n\n    // Create buffers\n    this.textBuffer = new TextBuffer({\n      position: angleData.labelPosition,\n      size: uniformArray(n, this.labelSize),\n      color: uniformArray3(n, labelColor.r, labelColor.g, labelColor.b),\n      text: angleData.labelText\n    } as TextBufferData, this.getLabelBufferParams() as TextBufferParameters)\n\n    const c = new Color(this.colorValue)\n\n    this.vectorBuffer = new WideLineBuffer(\n      getFixedLengthWrappedDashData({\n        position1: angleData.vectorPosition1,\n        position2: angleData.vectorPosition2,\n        color: uniformArray3(2 * n, c.r, c.g, c.b),\n        color2: uniformArray3(2 * n, c.r, c.g, c.b)\n      } as WideLineBufferData),\n      this.getBufferParams({\n        linewidth: this.linewidth,\n        visible: this.vectorVisible,\n        opacity: this.lineOpacity\n      })\n    )\n\n    this.arcLength = angleData.arcPosition1.length / 3\n\n    this.arcBuffer = new WideLineBuffer(\n      getFixedLengthWrappedDashData({\n        position1: angleData.arcPosition1,\n        position2: angleData.arcPosition2,\n        color: uniformArray3(this.arcLength, c.r, c.g, c.b),\n        color2: uniformArray3(this.arcLength, c.r, c.g, c.b)\n      } as WideLineBufferData), this.getBufferParams({\n        linewidth: this.linewidth,\n        visible: this.arcVisible,\n        opacity: this.lineOpacity\n      }))\n\n    this.sectorLength = angleData.sectorPosition.length / 3\n\n    this.sectorBuffer = new MeshBuffer({\n      position: angleData.sectorPosition,\n      color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n    } as BufferData, this.getBufferParams({\n      visible: this.sectorVisible\n    }))\n\n    return {\n      bufferList: [\n        this.textBuffer,\n        this.vectorBuffer,\n        this.arcBuffer,\n        this.sectorBuffer\n      ]\n    }\n  }\n\n  updateData (what: LabelDataField & {color?: boolean}, data: StructureRepresentationData) {\n    super.updateData(what, data)\n    const vectorData = {}\n    const arcData = {}\n    const sectorData = {}\n\n    if (what.color) {\n      const c = new Color(this.colorValue)\n      Object.assign(vectorData, {\n        color: uniformArray3(this.n * 2, c.r, c.g, c.b),\n        color2: uniformArray3(this.n * 2, c.r, c.g, c.b)\n      })\n      Object.assign(arcData, {\n        color: uniformArray3(this.arcLength, c.r, c.g, c.b),\n        color2: uniformArray3(this.arcLength, c.r, c.g, c.b)\n      })\n      Object.assign(sectorData, {\n        color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n      })\n    }\n\n    // if (what.sectorOpacity) {\n    //   this.sectorBuffer.opacity = what.sectorOpacity\n    // }\n\n    this.vectorBuffer.setAttributes(vectorData)\n    this.arcBuffer.setAttributes(arcData)\n    this.sectorBuffer.setAttributes(sectorData)\n  }\n\n  setParameters (params: Partial<AngleRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    super.setParameters(params, what, rebuild)\n\n    if (params && (\n      params.vectorVisible !== undefined ||\n      params.arcVisible !== undefined ||\n      params.sectorVisible !== undefined)) {\n      this.setVisibility(this.visible)\n    }\n\n    if (params && params.lineOpacity) {\n      this.vectorBuffer.setParameters({ opacity: params.lineOpacity })\n      this.arcBuffer.setParameters({ opacity: params.lineOpacity })\n    }\n\n    if (params && params.opacity !== undefined) {\n      this.vectorBuffer.setParameters({ opacity: this.lineOpacity })\n      this.arcBuffer.setParameters({ opacity: this.lineOpacity })\n    }\n\n    if (params && params.linewidth) {\n      this.vectorBuffer.setParameters({ linewidth: params.linewidth })\n      this.arcBuffer.setParameters({ linewidth: params.linewidth })\n    }\n\n    return this\n  }\n\n  setVisibility (value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n\n    if (this.vectorBuffer) {\n      this.vectorBuffer.setVisibility(this.vectorVisible && this.visible)\n    }\n\n    if (this.arcBuffer) {\n      this.arcBuffer.setVisibility(this.arcVisible && this.visible)\n    }\n\n    if (this.sectorBuffer) {\n      this.sectorBuffer.setVisibility(this.sectorVisible && this.visible)\n    }\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n}\n\n/**\n * Ensure mid point does not coincide with first or second\n * @param  {Float32Array} position 9*nAngle array of coordinates\n * @return {Float32Array}          Filtered position array, may be shorter\n */\nfunction validatePositions (position: Float32Array) {\n  const include = []\n  const n = position.length / 9\n  for (let i = 0; i < n; i++) {\n    // Check that first point not same as second and that second not same as third\n    let okay = true\n    for (let j = i; j < i + 3; j += 3) {\n      if (position[j] === position[j + 3] &&\n        position[j + 1] === position[j + 4] &&\n        position[j + 2] === position[j + 5]) {\n        okay = false\n      }\n    }\n    if (okay) include.push(i)\n  }\n  const outPosition = new Float32Array(include.length * 9)\n  let outIdx = 0\n  include.forEach(function (i) {\n    copyArray(position, outPosition, i * 9, outIdx * 9, 9)\n    outIdx++\n  })\n  return outPosition\n}\n\nfunction atomTriplePositions (sview: StructureView, atomTriple: (number|string)[][]) {\n  return validatePositions(parseNestedAtoms(sview, atomTriple))\n}\n\n/**\n * Converts triple positions into data required to build various buffers.\n */\nfunction getAngleData (position: Float32Array, params: Partial<StructureRepresentationParameters> = {}) {\n  const angleStep = defaults(params.angleStep, Math.PI / 90)\n  const n = position.length / 9\n  const angles = new Float32Array(n)\n  const labelPosition = new Float32Array(n * 3)\n  const labelText = new Array(n)\n\n  const vectorPosition1 = new Float32Array(n * 6) // Two lines per angle\n  const vectorPosition2 = new Float32Array(n * 6)\n\n  const arcPositionTmp1 = new Array(n) // Start points for arc lines\n  const arcPositionTmp2 = new Array(n) // End points for arc lines\n  const sectorPositionTmp = new Array(n) // Triangle points\n\n  let totalSegments = 0\n\n  // Re-used vectors etc\n  const p1 = v3new() // Positions of points for each angel\n  const p2 = v3new()\n  const p3 = v3new()\n  const v21 = v3new() // Vectors\n  const v23 = v3new()\n  const cross = v3new() // Cross product v21xv23\n  const cross2 = v3new() // In-plane cross product v21 x (v21 x v23)\n  const labelTmp = v3new()\n  const arcPoint = v3new()\n\n  for (var i = 0; i < n; i++) {\n    let p = 9 * i\n    v3fromArray(p1, position, p)\n    v3fromArray(p2, position, p + 3)\n    v3fromArray(p3, position, p + 6)\n\n    let v = 6 * i\n    v3toArray(p1, vectorPosition1, v)\n    v3toArray(p2, vectorPosition2, v)\n    v3toArray(p2, vectorPosition1, v + 3)\n    v3toArray(p3, vectorPosition2, v + 3)\n\n    v3sub(v21, p1, p2)\n    v3sub(v23, p3, p2)\n\n    v3normalize(v21, v21) // validatePositions ensures valid\n    v3normalize(v23, v23)\n\n    v3cross(cross, v21, v23)\n    const crossLength = v3length(cross)\n    const dot = v3dot(v21, v23)\n\n    const angle = angles[i] = Math.atan2(crossLength, dot)\n    labelText[i] = (RAD2DEG * angle).toFixed(1) + String.fromCharCode(0x00B0)\n\n    if (v3length(cross) === 0.0) {\n      // Angle exactly 0/180, pick an arbitrary direction\n      cross[ 0 ] = 1.0\n      cross[ 1 ] = 0.0\n      cross[ 2 ] = 0.0\n    }\n    v3cross(cross2, cross, v21)\n    v3normalize(cross2, cross2)\n\n    calcArcPoint(labelTmp, p2, v21, cross2, angle / 2.0)\n    // TODO: Scale label position?\n    v3toArray(labelTmp, labelPosition, 3 * i)\n\n    // Build the arc and sector\n\n    const nSegments = Math.ceil(angle / angleStep)\n    const sectorVertices = new Float32Array(nSegments * 9)\n    sectorPositionTmp[ i ] = sectorVertices\n    const arcVertices1 = new Float32Array(nSegments * 3)\n    const arcVertices2 = new Float32Array(nSegments * 3)\n    arcPositionTmp1[ i ] = arcVertices1\n    arcPositionTmp2[ i ] = arcVertices2\n\n    v3add(arcPoint, p2, v21) // Our initial arc point\n\n    const appendArcSection = function (a: number, j: number) {\n      const si = j * 9\n      const ai = j * 3\n      v3toArray(p2, sectorVertices, si)\n      v3toArray(arcPoint, sectorVertices, si + 3)\n      v3toArray(arcPoint, arcVertices1, ai)\n\n      calcArcPoint(arcPoint, p2, v21, cross2, a)\n\n      v3toArray(arcPoint, sectorVertices, si + 6)\n      v3toArray(arcPoint, arcVertices2, ai)\n    }\n\n    let j = 0\n    for (let a = angleStep; a < angle; a += angleStep) {\n      appendArcSection(a, j)\n      j++\n    }\n    appendArcSection(angle, j)\n    totalSegments += nSegments\n  }\n\n  // Flatten nested arrays of arc/segment points\n  const arcSize = totalSegments * 3\n  const sectorSize = totalSegments * 9\n  const arcPosition1 = new Float32Array(arcSize)\n  const arcPosition2 = new Float32Array(arcSize)\n  const sectorPosition = new Float32Array(sectorSize)\n\n  let sectorOffset = 0\n  let arcOffset = 0\n  for (let i = 0; i < n; i++) {\n    const ap1 = arcPositionTmp1[ i ]\n    const ap2 = arcPositionTmp2[ i ]\n    copyArray(ap1, arcPosition1, 0, arcOffset, ap1.length)\n    copyArray(ap2, arcPosition2, 0, arcOffset, ap2.length)\n    arcOffset += ap1.length // === ap2.length\n\n    const sp = sectorPositionTmp[ i ]\n    copyArray(sp, sectorPosition, 0, sectorOffset, sp.length)\n    sectorOffset += sp.length\n  }\n\n  return {\n    labelPosition,\n    labelText,\n    vectorPosition1,\n    vectorPosition2,\n    arcPosition1,\n    arcPosition2,\n    sectorPosition\n  }\n}\n\nRepresentationRegistry.add('angle', AngleRepresentation)\n\nexport default AngleRepresentation\n","/**\n * @file Cylinder Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, CylinderBufferGeometry } from 'three'\n\nimport { defaults } from '../utils'\nimport { calculateCenterArray, serialBlockArray } from '../math/array-utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { CylinderBufferData } from './cylinder-buffer'\nimport { BufferDefaultParameters } from './buffer'\n\nconst scale = new Vector3()\nconst eye = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3(0, 1, 0)\n\nexport const CylinderGeometryBufferDefaultParameters = Object.assign({\n  radialSegments: 1,\n  openEnded: true\n}, BufferDefaultParameters)\nexport type CylinderGeometryBufferParameters = typeof CylinderGeometryBufferDefaultParameters\n\nfunction getData (data: CylinderBufferData, params: Partial<CylinderGeometryBufferParameters> = {}) {\n  const geo = getGeo(params)\n\n  const n = data.position1.length\n\n  const geoLength = (geo.attributes as any).position.array.length / 3\n  const count = n / 3\n  const primitiveId = new Float32Array(count * 2 * geoLength)\n  serialBlockArray(count, geoLength, 0, primitiveId)\n  serialBlockArray(count, geoLength, count * geoLength, primitiveId)\n\n  const position = new Float32Array(n * 2)\n  const color = new Float32Array(n * 2)\n\n  return {\n    position, color, primitiveId, picking: data.picking\n  }\n}\n\nfunction getGeo (params: Partial<CylinderGeometryBufferParameters> = {}) {\n  const radialSegments = defaults(params.radialSegments, 10)\n  const openEnded = defaults(params.openEnded, true)\n  const matrix = new Matrix4().makeRotationX(Math.PI / 2)\n\n  const geo = new CylinderBufferGeometry(\n    1,  // radiusTop,\n    1,  // radiusBottom,\n    1,  // height,\n    radialSegments,  // radialSegments,\n    1,  // heightSegments,\n    openEnded  // openEnded\n  )\n  geo.applyMatrix4(matrix)\n\n  return geo\n}\n\n/**\n * Cylinder geometry buffer.\n *\n * @example\n * var cylinderGeometryBuffer = new CylinderGeometryBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass CylinderGeometryBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return CylinderGeometryBufferDefaultParameters }\n  parameters: CylinderGeometryBufferParameters\n\n  __center: Float32Array\n  _position: Float32Array\n  _color: Float32Array\n  _from: Float32Array\n  _to: Float32Array\n  _radius: Float32Array\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position1 - from positions\n   * @param {Float32Array} data.position2 - to positions\n   * @param {Float32Array} data.color - from colors\n   * @param {Float32Array} data.color2 - to colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: CylinderBufferData, params: Partial<CylinderGeometryBufferParameters> = {}) {\n    super(getData(data, params), params, getGeo(params))\n\n    const n = data.position1.length\n    const m = data.radius.length\n\n    this.__center = new Float32Array(n)\n    this._position = new Float32Array(n * 2)\n    this._color = new Float32Array(n * 2)\n    this._from = new Float32Array(n * 2)\n    this._to = new Float32Array(n * 2)\n    this._radius = new Float32Array(m * 2)\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    eye.fromArray(this._from as any, i3)\n    target.fromArray(this._to as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    const r = this._radius[ i ]\n    scale.set(r, r, eye.distanceTo(target))\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<CylinderBufferData> = {}, initNormals?: boolean) {\n    const meshData: Partial<CylinderBufferData> = {}\n\n    if (data.position1 && data.position2) {\n      calculateCenterArray(\n        data.position1, data.position2, this.__center\n      )\n      calculateCenterArray(\n        data.position1, this.__center, this._position\n      )\n      calculateCenterArray(\n        this.__center, data.position2, this._position, data.position1.length\n      )\n      this._from.set(data.position1)\n      this._from.set(this.__center, data.position1.length)\n      this._to.set(this.__center)\n      this._to.set(data.position2, this.__center.length)\n      meshData.position = this._position\n    }\n\n    if (data.color && data.color2) {\n      this._color.set(data.color)\n      this._color.set(data.color2, data.color.length)\n      meshData.color = this._color\n    }\n\n    if (data.radius) {\n      this._radius.set(data.radius)\n      this._radius.set(data.radius, data.radius.length)\n      meshData.radius = this._radius\n    }\n\n    super.setAttributes(meshData, initNormals)\n  }\n}\n\nexport default CylinderGeometryBuffer\n","/**\n * @file Mapped Aligned Box Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferParameters, BufferData } from './buffer'\nimport MappedBuffer from './mapped-buffer'\n\n//       +Y   /\n//    0**********2\n//    *   | /   **\n//    *   |/   * *\n// -----------3---- +X\n//    *  /|   *  *\n//    * / |   *  *\n//    1/**|******4\n//    /   |   * *\n//   /    |   **  \n//  +Z    |   5 \nconst mapping = new Float32Array([\n  -1.0, 1.0, -1.0,\n  -1.0, -1.0, -1.0,\n  1.0, 1.0, -1.0,\n  1.0, 1.0, 1.0,\n  1.0, -1.0, -1.0,\n  1.0, -1.0, 1.0\n])\n\nconst mappingIndices = new Uint16Array([\n  0, 1, 2,\n  1, 4, 2,\n  2, 4, 3,\n  4, 5, 3\n])\n\n/**\n * Mapped Aligned box buffer. Draws boxes where one side is always screen-space aligned.\n * Used to render cylinder imposters.\n * @interface\n */\nclass MappedAlignedBoxBuffer extends MappedBuffer {\n  constructor(data: BufferData, params: Partial<BufferParameters> = {}) {\n    super('v3', data, params)\n  }\n  get mapping () { return mapping }\n  get mappingIndices () { return mappingIndices }\n  get mappingIndicesSize () { return 12 }\n  get mappingSize () { return 6 }\n  get mappingItemSize () { return 3 }\n}\n\nexport default MappedAlignedBoxBuffer\n","/**\n * @file Cylinder Impostor Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\nimport { Matrix4, Vector3 } from 'three'\n\nimport '../shader/CylinderImpostor.vert'\nimport '../shader/CylinderImpostor.frag'\n\nimport MappedAlignedBoxBuffer from './mappedalignedbox-buffer'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferTypes } from './buffer'\nimport { CylinderBufferData } from './cylinder-buffer'\n\nexport const CylinderImpostorBufferDefaultParameters = Object.assign({\n  openEnded: false\n}, BufferDefaultParameters)\nexport type CylinderImpostorBufferParameters = typeof CylinderImpostorBufferDefaultParameters\n\nconst CylinderImpostorBufferParameterTypes = Object.assign({\n  openEnded: { updateShader: true }\n}, BufferParameterTypes)\n\n/**\n * Cylinder impostor buffer.\n *\n * @example\n * var cylinderimpostorBuffer = new CylinderImpostorBuffer({\n *     position1: new Float32Array([ 0, 0, 0 ]),\n *     position2: new Float32Array([ 1, 1, 1 ]),\n *     color: new Float32Array([ 1, 0, 0 ]),\n *     color2: new Float32Array([ 0, 1, 0 ]),\n *     radius: new Float32Array([ 1 ])\n * });\n */\nclass CylinderImpostorBuffer extends MappedAlignedBoxBuffer {\n  parameterTypes = CylinderImpostorBufferParameterTypes\n  get defaultParameters() { return CylinderImpostorBufferDefaultParameters }\n  parameters: CylinderImpostorBufferParameters\n\n  isImpostor = true\n  vertexShader = 'CylinderImpostor.vert'\n  fragmentShader = 'CylinderImpostor.frag'\n\n  /**\n   * make cylinder impostor buffer\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position1 - from positions\n   * @param  {Float32Array} data.position2 - to positions\n   * @param  {Float32Array} data.color - from colors\n   * @param  {Float32Array} data.color2 - to colors\n   * @param  {Float32Array} data.radius - radii\n   * @param  {Picker} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: CylinderBufferData, params: Partial<CylinderImpostorBufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'modelViewMatrixInverse': { value: new Matrix4() },\n      'ortho': { value: 0.0 }\n    })\n\n    this.addAttributes({\n      'position1': { type: 'v3', value: null },\n      'position2': { type: 'v3', value: null },\n      'color2': { type: 'c', value: null },\n      'radius': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n\n  getDefines (type?: BufferTypes) {\n    const defines = MappedAlignedBoxBuffer.prototype.getDefines.call(this, type)\n\n    if (!this.parameters.openEnded) {\n      defines.CAP = 1\n    }\n\n    return defines\n  }\n}\n\nexport default CylinderImpostorBuffer\n","/**\n * @file Cylinder Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import required for declaration only\nimport { Vector3, Matrix4 } from 'three'\nimport { BufferRegistry, ExtensionFragDepth } from '../globals'\nimport CylinderGeometryBuffer, { CylinderGeometryBufferDefaultParameters } from './cylindergeometry-buffer'\nimport CylinderImpostorBuffer, { CylinderImpostorBufferDefaultParameters } from './cylinderimpostor-buffer'\nimport { BufferData } from './buffer'\n\nexport interface CylinderBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n  radius: Float32Array\n}\n\nexport const CylinderBufferDefaultParameters = Object.assign({\n  disableImpostor: false\n}, CylinderGeometryBufferDefaultParameters, CylinderImpostorBufferDefaultParameters)\nexport type CylinderBufferParameters = typeof CylinderBufferDefaultParameters\n\n/**\n * Cylinder buffer. Depending on the value {@link ExtensionFragDepth} and\n * `params.disableImpostor` the constructor returns either a\n * {@link CylinderGeometryBuffer} or a {@link CylinderImpostorBuffer}\n * @implements {Buffer}\n *\n * @example\n * var cylinderBuffer = new CylinderBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass CylinderBuffer {\n  constructor (data: CylinderBufferData, params: Partial<CylinderBufferParameters> = {}) {\n    if (!data.color2 && data.color) data.color2 = data.color\n    if (!ExtensionFragDepth || (params && params.disableImpostor)) {\n      return new CylinderGeometryBuffer(data, params)\n    } else {\n      return new CylinderImpostorBuffer(data, params)\n    }\n  }\n}\n\nBufferRegistry.add('cylinder', CylinderBuffer)\n\nexport default CylinderBuffer\n","/**\n * @file Axes Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color, Vector3 } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { AxesPicker } from '../utils/picker'\nimport { uniformArray, uniformArray3 } from '../math/array-utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport StructureView from '../structure/structure-view';\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport { AtomDataFields } from '../structure/structure-data';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport PrincipalAxes from '../math/principal-axes';\n\nexport interface AxesRepresentationParameters extends StructureRepresentationParameters {\n  showAxes: boolean\n  showBox: boolean\n}\n\n/**\n * Axes representation. Show principal axes and/or a box aligned with them\n * that fits the structure or selection.\n *\n * __Name:__ _axes_\n *\n * @example\n * stage.loadFile( \"rcsb://3pqr\", {\n *     assembly: \"BU1\"\n * } ).then( function( o ){\n *     o.addRepresentation( \"cartoon\" );\n *     o.addRepresentation( \"axes\", {\n *         sele: \"RET\", showAxes: false, showBox: true, radius: 0.2\n *     } );\n *     o.addRepresentation( \"ball+stick\", { sele: \"RET\" } );\n *     o.addRepresentation( \"axes\", {\n *         sele: \":B and backbone\", showAxes: false, showBox: true, radius: 0.2\n *     } );\n *     stage.autoView();\n *     var pa = o.structure.getPrincipalAxes();\n *     stage.animationControls.rotate( pa.getRotationQuaternion(), 1500 );\n * } );\n */\nclass AxesRepresentation extends StructureRepresentation {\n  \n  protected showAxes: boolean\n  protected showBox: boolean\n  protected sphereBuffer: SphereBuffer\n  protected cylinderBuffer: CylinderBuffer\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Viewer} viewer - the viewer object\n   * @param  {StructureRepresentationParameters} params - parameters object\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<AxesRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'axes'\n\n    this.parameters = Object.assign({\n\n      radiusSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      sphereDetail: true,\n      radialSegments: true,\n      disableImpostor: true,\n      showAxes: {\n        type: 'boolean', rebuild: true\n      },\n      showBox: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n      assembly: null\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<AxesRepresentationParameters>) {\n    const p = params || {}\n    p.radiusSize = defaults(p.radiusSize, 0.5)\n    p.colorValue = defaults(p.colorValue, 'lightgreen')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.showAxes = defaults(p.showAxes, true)\n    this.showBox = defaults(p.showBox, false)\n\n    super.init(p)\n  }\n\n  getPrincipalAxes (): PrincipalAxes {\n    let selection\n    const assembly = this.getAssembly()\n\n    if (assembly) {\n      selection = assembly.partList[ 0 ].getSelection()\n    }\n\n    return this.structureView.getPrincipalAxes(selection)\n  }\n\n  getAxesData (sview: StructureView) {\n    const pa = this.getPrincipalAxes()\n    const c = new Color(this.colorValue)\n\n    let vn = 0\n    let en = 0\n\n    if (this.showAxes) {\n      vn += 6\n      en += 3\n    }\n\n    if (this.showBox) {\n      vn += 8\n      en += 12\n    }\n\n    const vertexPosition = new Float32Array(3 * vn)\n    const vertexColor = uniformArray3(vn, c.r, c.g, c.b)\n    const vertexRadius = uniformArray(vn, this.radiusSize)\n\n    const edgePosition1 = new Float32Array(3 * en)\n    const edgePosition2 = new Float32Array(3 * en)\n    const edgeColor = uniformArray3(en, c.r, c.g, c.b)\n    const edgeRadius = uniformArray(en, this.radiusSize)\n\n    let offset = 0\n\n    if (this.showAxes) {\n      const addAxis = function (v1: Vector3, v2: Vector3) {\n        v1.toArray(vertexPosition as any, offset * 2)\n        v2.toArray(vertexPosition as any, offset * 2 + 3)\n        v1.toArray(edgePosition1 as any, offset)\n        v2.toArray(edgePosition2 as any, offset)\n        offset += 3\n      }\n\n      addAxis(pa.begA, pa.endA)\n      addAxis(pa.begB, pa.endB)\n      addAxis(pa.begC, pa.endC)\n    }\n\n    if (this.showBox) {\n      const v = new Vector3()\n      const { d1a, d2a, d3a, d1b, d2b, d3b } = pa.getProjectedScaleForAtoms(sview)\n\n      // console.log(d1a, d2a, d3a, d1b, d2b, d3b)\n\n      let offset2 = offset * 2\n      const addCorner = function (d1: number, d2: number, d3: number) {\n        v.copy(pa.center)\n          .addScaledVector(pa.normVecA, d1)\n          .addScaledVector(pa.normVecB, d2)\n          .addScaledVector(pa.normVecC, d3)\n        v.toArray(vertexPosition as any, offset2)\n        offset2 += 3\n      }\n      addCorner(d1a, d2a, d3a)\n      addCorner(d1a, d2a, d3b)\n      addCorner(d1a, d2b, d3b)\n      addCorner(d1a, d2b, d3a)\n      addCorner(d1b, d2b, d3b)\n      addCorner(d1b, d2b, d3a)\n      addCorner(d1b, d2a, d3a)\n      addCorner(d1b, d2a, d3b)\n\n      let edgeOffset = offset\n      const addEdge = function (a: number, b: number) {\n        v.fromArray(vertexPosition as any, offset * 2 + a * 3)\n          .toArray(edgePosition1 as any, edgeOffset)\n        v.fromArray(vertexPosition as any, offset * 2 + b * 3)\n          .toArray(edgePosition2 as any, edgeOffset)\n        edgeOffset += 3\n      }\n      addEdge(0, 1)\n      addEdge(0, 3)\n      addEdge(0, 6)\n      addEdge(1, 2)\n      addEdge(1, 7)\n      addEdge(2, 3)\n      addEdge(2, 4)\n      addEdge(3, 5)\n      addEdge(4, 5)\n      addEdge(4, 7)\n      addEdge(5, 6)\n      addEdge(6, 7)\n    }\n\n    const picker = new AxesPicker(pa)\n\n    return {\n      vertex: {\n        position: vertexPosition,\n        color: vertexColor,\n        radius: vertexRadius,\n        picking: picker\n      },\n      edge: {\n        position1: edgePosition1,\n        position2: edgePosition2,\n        color: edgeColor,\n        color2: edgeColor,\n        radius: edgeRadius,\n        picking: picker\n      }\n    }\n  }\n\n  create () {\n    const axesData = this.getAxesData(this.structureView)\n\n    this.sphereBuffer = new SphereBuffer(\n      axesData.vertex as SphereBufferData,\n      this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      }) as SphereBufferParameters\n    )\n\n    this.cylinderBuffer = new CylinderBuffer(\n      axesData.edge as CylinderBufferData,\n      this.getBufferParams({\n        openEnded: true,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    this.dataList.push({\n      sview: this.structureView,\n      bufferList: [ this.sphereBuffer as SphereGeometryBuffer, this.cylinderBuffer as CylinderGeometryBuffer]\n    })\n  }\n\n  createData (sview: StructureView): undefined {\n    return\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    const axesData = this.getAxesData(data.sview as StructureView)\n    const sphereData = {}\n    const cylinderData = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {\n        position: axesData.vertex.position\n      })\n      Object.assign(cylinderData, {\n        position1: axesData.edge.position1,\n        position2: axesData.edge.position2\n      })\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {\n        color: axesData.vertex.color as Float32Array\n      })\n      Object.assign(cylinderData, {\n        color: axesData.edge.color as Float32Array,\n        color2: axesData.edge.color as Float32Array\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {\n        radius: axesData.vertex.radius as Float32Array\n      })\n      Object.assign(cylinderData, {\n        radius: axesData.edge.radius as Float32Array\n      })\n    }\n\n    (this.sphereBuffer as SphereGeometryBuffer).setAttributes(sphereData);\n    (this.cylinderBuffer as CylinderGeometryBuffer).setAttributes(cylinderData)\n  }\n}\n\nRepresentationRegistry.add('axes', AxesRepresentation)\n\nexport default AxesRepresentation\n","/**\n * @file Ball And Stick Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { ExtensionFragDepth, RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport WideLineBuffer from '../buffer/wideline-buffer'\nimport Viewer from '../viewer/viewer';\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Volume } from '../ngl';\nimport AtomProxy from '../proxy/atom-proxy';\nimport { AtomDataParams, BondDataParams, BondDataFields, AtomDataFields, BondData, AtomData } from '../structure/structure-data';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface';\n\nexport interface BallAndStickRepresentationParameters extends StructureRepresentationParameters {\n  sphereDetail: number\n  radialSegments: number\n  openEnded: boolean\n  disableImpostor: boolean\n  aspectRatio: number\n  lineOnly: boolean\n  lineWidth: number\n  cylinderOnly: boolean\n  multipleBond: 'off' | 'symmetric' | 'offset'\n  bondSpacing: number\n  bondScale: number\n  linewidth: number\n}\n\n/**\n * Ball And Stick representation parameter object. Extends {@link RepresentationParameters} and\n * {@link StructureRepresentationParameters}.\n *\n * @typedef {Object} BallAndStickRepresentationParameters - ball and stick representation parameters\n *\n * @property {Integer} sphereDetail - sphere quality (icosahedron subdivisions)\n * @property {Integer} radialSegments - cylinder quality (number of segments)\n * @property {Boolean} openEnded - capped or not\n * @property {Boolean} disableImpostor - disable use of raycasted impostors for rendering\n * @property {Float} aspectRatio - size difference between atom and bond radii\n * @property {Boolean} lineOnly - render only bonds, and only as lines\n * @property {Integer} linewidth - width of lines\n * @property {Boolean} cylinderOnly - render only bonds (no atoms)\n * @property {String} multipleBond - one off \"off\", \"symmetric\", \"offset\"\n * @property {Float} bondSpacing - spacing for multiple bond rendering\n * @property {Float} bondScale - scale/radius for multiple bond rendering\n */\n\n/**\n * Ball And Stick representation. Show atoms as spheres and bonds as cylinders.\n *\n * __Name:__ _ball+stick_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"ball+stick\" );\n *     o.autoView();\n * } );\n */\nclass BallAndStickRepresentation extends StructureRepresentation {\n  protected sphereDetail: number\n  protected radialSegments: number\n  protected openEnded: boolean\n  protected disableImpostor: boolean\n  protected aspectRatio: number\n  protected lineOnly: boolean\n  protected lineWidth: number\n  protected cylinderOnly: boolean\n  protected multipleBond: 'off' | 'symmetric' | 'offset'\n  protected bondSpacing: number\n  protected bondScale: number\n  protected linewidth: number\n\n  protected lineBuffer: WideLineBuffer\n  /**\n   * Create Ball And Stick representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {BallAndStickRepresentationParameters} params - ball and stick representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'ball+stick'\n\n    this.parameters = Object.assign({\n\n      sphereDetail: true,\n      radialSegments: true,\n      openEnded: true,\n      disableImpostor: true,\n      aspectRatio: {\n        type: 'number', precision: 1, max: 10.0, min: 1.0\n      },\n      lineOnly: {\n        type: 'boolean', rebuild: true\n      },\n      cylinderOnly: {\n        type: 'boolean', rebuild: true\n      },\n      multipleBond: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'off': 'off',\n          'symmetric': 'symmetric',\n          'offset': 'offset'\n        }\n      },\n      bondScale: {\n        type: 'number', precision: 2, max: 1.0, min: 0.01\n      },\n      bondSpacing: {\n        type: 'number', precision: 2, max: 2.0, min: 0.5\n      },\n      linewidth: {\n        type: 'integer', max: 50, min: 1, buffer: true\n      }\n\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    var p = params || {}\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.15)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.aspectRatio = defaults(p.aspectRatio, 2.0)\n    this.lineOnly = defaults(p.lineOnly, false)\n    this.cylinderOnly = defaults(p.cylinderOnly, false)\n    this.multipleBond = defaults(p.multipleBond, 'off')\n    this.bondSpacing = defaults(p.bondSpacing, 1.0)\n    this.bondScale = defaults(p.bondScale, 0.4)\n    this.linewidth = defaults(p.linewidth, 2)\n\n    super.init(p)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return this.aspectRatio * super.getAtomRadius(atom)\n  }\n\n  getAtomParams (what?: AtomDataFields, params?: Partial<AtomDataParams>) {\n    var p = super.getAtomParams(what, params)\n    p.radiusParams.scale *= this.aspectRatio\n\n    return p\n  }\n\n  getAtomData (sview: StructureView, what?: AtomDataFields, params?: Partial<AtomDataParams>): AtomData {\n    return sview.getAtomData(this.getAtomParams(what, params))\n  }\n\n  getBondParams (what?: BondDataFields, params?: Partial<BondDataParams>) {\n    params = Object.assign({\n      multipleBond: this.multipleBond,\n      bondSpacing: this.bondSpacing,\n      bondScale: this.bondScale\n    }, params)\n\n    return super.getBondParams(what, params)\n  }\n\n  getBondData (sview: StructureView, what?: BondDataFields, params?: Partial<BondDataParams>): BondData {\n    return sview.getBondData(this.getBondParams(what, params))\n  }\n\n  createData (sview: StructureView) {\n    const bufferList: any[] = []\n\n    if (this.lineOnly) {\n      this.lineBuffer = new WideLineBuffer(\n        this.getBondData(sview, { position: true, color: true, picking: true }),\n        this.getBufferParams({ linewidth: this.linewidth })\n      )\n\n      bufferList.push(this.lineBuffer)\n    } else {\n      const cylinderBuffer = new CylinderBuffer(\n        (this.getBondData(sview) as CylinderBufferData),\n        this.getBufferParams({\n          openEnded: this.openEnded,\n          radialSegments: this.radialSegments,\n          disableImpostor: this.disableImpostor,\n          dullInterior: true\n        })\n      )\n\n      bufferList.push(cylinderBuffer as CylinderGeometryBuffer)\n\n      if (!this.cylinderOnly) {\n        const sphereBuffer = new SphereBuffer(\n          (this.getAtomData(sview) as SphereBufferData),\n          (this.getBufferParams({\n            sphereDetail: this.sphereDetail,\n            disableImpostor: this.disableImpostor,\n            dullInterior: true\n          }) as SphereBufferParameters)\n        )\n\n        bufferList.push(sphereBuffer as SphereGeometryBuffer)\n      }\n    }\n\n    return {\n      bufferList: bufferList\n    }\n  }\n\n  updateData (what: BondDataFields | AtomDataFields, data: StructureRepresentationData) {\n    if (this.multipleBond !== 'off' && what && what.radius) {\n      what.position = true\n    }\n\n    const bondData = this.getBondData(data.sview as StructureView, what)\n\n    if (this.lineOnly) {\n      const lineData:Partial<CylinderBufferData> = {}\n\n      if (!what || what.position) {\n        Object.assign(lineData, {\n          position1: bondData.position1,\n          position2: bondData.position2\n        })\n      }\n\n      if (!what || what.color) {\n        Object.assign(lineData, {\n          color: bondData.color,\n          color2: bondData.color2\n        })\n      }\n\n      data.bufferList[ 0 ].setAttributes(lineData)\n    } else {\n      var cylinderData: Partial<CylinderBufferData> = {}\n\n      if (!what || what.position) {\n        Object.assign(cylinderData, {\n          position1: bondData.position1,\n          position2: bondData.position2\n        })\n      }\n\n      if (!what || what.color) {\n        Object.assign(cylinderData, {\n          color: bondData.color,\n          color2: bondData.color2\n        })\n      }\n\n      if (!what || what.radius) {\n        Object.assign(cylinderData, {\n          radius: bondData.radius\n        })\n      }\n\n      data.bufferList[ 0 ].setAttributes(cylinderData)\n\n      if (!this.cylinderOnly) {\n        var atomData = this.getAtomData(data.sview as StructureView, what)\n\n        var sphereData: Partial<SphereBufferData> = {}\n\n        if (!what || what.position) {\n          Object.assign(sphereData, {\n            position: atomData.position\n          })\n        }\n\n        if (!what || what.color) {\n          Object.assign(sphereData, {\n            color: atomData.color\n          })\n        }\n\n        if (!what || what.radius) {\n          Object.assign(sphereData, {\n            radius: atomData.radius\n          })\n        }\n\n        data.bufferList[ 1 ].setAttributes(sphereData)\n      }\n    }\n  }\n\n  setParameters (params: Partial<BallAndStickRepresentationParameters> = {}) {\n    let rebuild = false\n    const what: AtomDataFields = {}\n\n    if (params.aspectRatio || params.bondSpacing || params.bondScale) {\n      Object.assign(what, {radius: true})\n      if (!ExtensionFragDepth || this.disableImpostor) {\n        rebuild = true\n      }\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('ball+stick', BallAndStickRepresentation)\n\nexport default BallAndStickRepresentation\n","/**\n * @file Backbone Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport BallAndStickRepresentation, { BallAndStickRepresentationParameters } from './ballandstick-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport { AtomDataFields, AtomDataParams, BondDataFields, BondDataParams, BondData, AtomData } from '../structure/structure-data';\n\n/**\n * Backbone representation. Show cylinders (or lines) connecting .CA (protein)\n * or .C4'/.C3' (RNA/DNA) of polymers.\n *\n * __Name:__ _backbone_\n *\n * @example\n * stage.loadFile( \"rcsb://1sfi\" ).then( function( o ){\n *     o.addRepresentation( \"backbone\" );\n *     o.autoView();\n * } );\n */\nclass BackboneRepresentation extends BallAndStickRepresentation {\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Viewer} viewer - the viewer object\n   * @param  {BallAndStickRepresentationParameters} params - parameters object\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'backbone'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n\n      multipleBond: null,\n      bondSpacing: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = defaults(p.aspectRatio, 1.0)\n    p.radiusSize = defaults(p.radiusSize, 0.25)\n\n    super.init(p)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return atom.isTrace() ? super.getAtomRadius(atom) : 0\n  }\n\n  getAtomData (sview: StructureView, what?: AtomDataFields, params?: Partial<AtomDataParams>): AtomData {\n    return sview.getBackboneAtomData(this.getAtomParams(what, params))\n  }\n\n  getBondData (sview: StructureView, what?: BondDataFields, params?: Partial<BondDataParams>): BondData {\n    return sview.getBackboneBondData(this.getBondParams(what, params))\n  }\n}\n\nRepresentationRegistry.add('backbone', BackboneRepresentation)\n\nexport default BackboneRepresentation\n","/**\n * @file Base Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport BallAndStickRepresentation, { BallAndStickRepresentationParameters } from './ballandstick-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { AtomDataFields, AtomDataParams, BondDataFields, BondDataParams, BondData, AtomData } from '../structure/structure-data';\n\n/**\n * Base representation. Show cylinders for RNA/DNA ladders.\n *\n * __Name:__ _base_\n *\n * @example\n * stage.loadFile( \"rcsb://1d66\" ).then( function( o ){\n *     o.addRepresentation( \"cartoon\", { sele: \"nucleic\" } );\n *     o.addRepresentation( \"base\", { color: \"resname\" } );\n *     o.autoView( \"nucleic\" );\n * } );\n */\nclass BaseRepresentation extends BallAndStickRepresentation {\n  /**\n   * @param  {Structure} structure - the structure object\n   * @param  {Viewer} viewer - the viewer object\n   * @param  {BallAndStickRepresentationParameters} params - parameters object\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'base'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n\n      multipleBond: null,\n      bondSpacing: null\n\n    })\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    let p = params || {}\n    p.aspectRatio = defaults(p.aspectRatio, 1.0)\n    p.radiusSize = defaults(p.radiusSize, 0.3)\n\n    super.init(p)\n  }\n\n  getAtomData (sview: StructureView, what?: AtomDataFields, params?: AtomDataParams): AtomData {\n    return sview.getRungAtomData(this.getAtomParams(what, params))\n  }\n\n  getBondData (sview: StructureView, what?: BondDataFields, params?: BondDataParams): BondData {\n    let p = this.getBondParams(what, params)\n    Object.assign(p.colorParams, {rung: true})\n\n    return sview.getRungBondData(p)\n  }\n}\n\nRepresentationRegistry.add('base', BaseRepresentation)\n\nexport default BaseRepresentation\n","/**\n * @file Spline\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3 } from 'three'\n\nimport { ColormakerRegistry } from '../globals'\nimport { AtomPicker } from '../utils/picker'\nimport RadiusFactory, { RadiusParams } from '../utils/radius-factory'\nimport { copyArray } from '../math/array-utils'\nimport { spline } from '../math/math-utils'\nimport Polymer from '../proxy/polymer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport { ColormakerParameters } from '../color/colormaker';\nimport { NumberArray } from '../types';\n\nexport class Interpolator {\n  \n  m: number\n  tension: number\n  dt: number\n  delta: number\n  vec1: Vector3\n  vec2: Vector3\n  vDir: Vector3 \n  vTan: Vector3\n  vNorm: Vector3\n  vBin: Vector3\n  m2: number\n\n  constructor (m: number, tension: number) {\n    this.m = m\n    this.tension = tension\n    this.dt = 1.0 / this.m\n    this.delta = 0.0001\n\n    this.vec1 = new Vector3()\n    this.vec2 = new Vector3()\n\n    this.vDir = new Vector3()\n    this.vTan = new Vector3()\n    this.vNorm = new Vector3()\n    this.vBin = new Vector3()\n  \n    this.m2 = Math.ceil(this.m / 2)\n  }\n\n  private interpolateToArr (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, t: number, arr: Float32Array, offset: number) {\n    arr[ offset + 0 ] = spline(v0.x, v1.x, v2.x, v3.x, t, this.tension)\n    arr[ offset + 1 ] = spline(v0.y, v1.y, v2.y, v3.y, t, this.tension)\n    arr[ offset + 2 ] = spline(v0.z, v1.z, v2.z, v3.z, t, this.tension)\n  }\n\n  private interpolateToVec (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, t: number, vec: Vector3) {\n    vec.x = spline(v0.x, v1.x, v2.x, v3.x, t, this.tension)\n    vec.y = spline(v0.y, v1.y, v2.y, v3.y, t, this.tension)\n    vec.z = spline(v0.z, v1.z, v2.z, v3.z, t, this.tension)\n  }\n\n  private interpolatePosition (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, pos: Float32Array, offset: number) {\n    for (var j = 0; j < this.m; ++j) {\n      var l = offset + j * 3\n      var d = this.dt * j\n      this.interpolateToArr(v0, v1, v2, v3, d, pos, l)\n    }\n  }\n\n  private interpolateTangent (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, tan: Float32Array, offset: number) {\n    for (var j = 0; j < this.m; ++j) {\n      var d = this.dt * j\n      var d1 = d - this.delta\n      var d2 = d + this.delta\n      var l = offset + j * 3\n      // capping as a precaution\n      if (d1 < 0) d1 = 0\n      if (d2 > 1) d2 = 1\n      //\n      this.interpolateToVec(v0, v1, v2, v3, d1, this.vec1)\n      this.interpolateToVec(v0, v1, v2, v3, d2, this.vec2)\n      //\n      this.vec2.sub(this.vec1).normalize()\n      this.vec2.toArray(tan as any, l)\n    }\n  }\n\n  private vectorSubdivide (interpolationFn: (v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3, array: Float32Array, offset: number) => void,\n                            iterator: AtomIterator, array: Float32Array, offset: number, isCyclic: boolean) {\n    let v0: Vector3\n    let v1 = <Vector3>iterator.next()\n    let v2 = <Vector3>iterator.next()\n    let v3 = <Vector3>iterator.next()\n    //\n    const n = iterator.size\n    const n1 = n - 1\n    let k = offset || 0\n    for (let i = 0; i < n1; ++i) {\n      v0 = v1\n      v1 = v2\n      v2 = v3\n      v3 = <Vector3>iterator.next()\n      interpolationFn.apply(this, [v0, v1, v2, v3, array, k])\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      v0 = <Vector3>iterator.get(n - 2)\n      v1 = <Vector3>iterator.get(n - 1)\n      v2 = <Vector3>iterator.get(0)\n      v3 = <Vector3>iterator.get(1)\n      interpolationFn.apply(this, [v0, v1, v2, v3, array, k])\n      k += 3 * this.m\n    }\n  }\n\n  //\n\n  public getPosition (iterator: AtomIterator, array: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    this.vectorSubdivide(this.interpolatePosition, iterator, array, offset, isCyclic)\n    var n1 = iterator.size - 1\n    var k = n1 * this.m * 3\n    if (isCyclic) k += this.m * 3\n    var v = iterator.get(isCyclic ? 0 : n1)\n    array[ k ] = v.x\n    array[ k + 1 ] = v.y\n    array[ k + 2 ] = v.z\n  }\n\n  public getTangent (iterator: AtomIterator, array: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    this.vectorSubdivide(this.interpolateTangent, iterator, array, offset, isCyclic)\n    const n1 = iterator.size - 1\n    let k = n1 * this.m * 3\n    if (isCyclic) k += this.m * 3\n    copyArray(array, array, k - 3, k, 3)\n  }\n\n  private interpolateNormalDir (u0: Vector3, u1: Vector3, u2: Vector3, u3: Vector3,\n                                v0: Vector3, v1: Vector3, v2: Vector3, v3: Vector3,\n                                tan: Float32Array, norm: Float32Array, bin: Float32Array,\n                                offset: number, shift: boolean) {\n    for (let j = 0; j < this.m; ++j) {\n      let l = offset + j * 3\n      if (shift) l += this.m2 * 3\n      const d = this.dt * j\n      this.interpolateToVec(u0, u1, u2, u3, d, this.vec1)\n      this.interpolateToVec(v0, v1, v2, v3, d, this.vec2)\n      this.vDir.subVectors(this.vec2, this.vec1).normalize()\n      this.vTan.fromArray(tan as any, l)\n      this.vBin.crossVectors(this.vDir, this.vTan).normalize()\n      this.vBin.toArray(bin as any, l)\n      this.vNorm.crossVectors(this.vTan, this.vBin).normalize()\n      this.vNorm.toArray(norm as any, l)\n    }\n  }\n\n  private interpolateNormal (vDir: Vector3, tan: Float32Array, norm: Float32Array, bin: Float32Array, offset: number) {\n    for (var j = 0; j < this.m; ++j) {\n      var l = offset + j * 3\n      vDir.copy(this.vNorm)\n      this.vTan.fromArray(tan as any, l)\n      this.vBin.crossVectors(vDir, this.vTan).normalize()\n      this.vBin.toArray(bin as any, l)\n      this.vNorm.crossVectors(this.vTan, this.vBin).normalize()\n      this.vNorm.toArray(norm as any, l)\n    }\n  }\n\n  public getNormal (size: number, tan: Float32Array, norm: Float32Array, bin: Float32Array, offset: number, isCyclic: boolean) {\n    this.vNorm.set(0, 0, 1)\n    const n = size\n    const n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      this.interpolateNormal(this.vDir, tan, norm, bin, k)\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      this.interpolateNormal(this.vDir, tan, norm, bin, k)\n      k += 3 * this.m\n    }\n    this.vBin.toArray(bin as any, k)\n    this.vNorm.toArray(norm as any, k)\n  }\n\n  public getNormalDir (iterDir1: AtomIterator, iterDir2: AtomIterator, tan: Float32Array, norm: Float32Array, bin: Float32Array, offset: number, isCyclic: boolean, shift: boolean) {\n    iterDir1.reset()\n    iterDir2.reset()\n    //\n    const vSub1 = new Vector3()\n    const vSub2 = new Vector3()\n    const vSub3 = new Vector3()\n    const vSub4 = new Vector3()\n    //\n    const d1v1 = new Vector3()\n    const d1v2 = new Vector3().copy(<Vector3>iterDir1.next())\n    const d1v3 = new Vector3().copy(<Vector3>iterDir1.next())\n    const d1v4 = new Vector3().copy(<Vector3>iterDir1.next())\n    const d2v1 = new Vector3()\n    const d2v2 = new Vector3().copy(<Vector3>iterDir2.next())\n    const d2v3 = new Vector3().copy(<Vector3>iterDir2.next())\n    const d2v4 = new Vector3().copy(<Vector3>iterDir2.next())\n    //\n    this.vNorm.set(0, 0, 1)\n    let n = iterDir1.size\n    let n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      d1v1.copy(d1v2)\n      d1v2.copy(d1v3)\n      d1v3.copy(d1v4)\n      d1v4.copy(<Vector3>iterDir1.next())\n      d2v1.copy(d2v2)\n      d2v2.copy(d2v3)\n      d2v3.copy(d2v4)\n      d2v4.copy(<Vector3>iterDir2.next())\n      //\n      if (i === 0) {\n        vSub1.subVectors(d2v1, d1v1)\n        vSub2.subVectors(d2v2, d1v2)\n        if (vSub1.dot(vSub2) < 0) {\n          vSub2.multiplyScalar(-1)\n          d2v2.addVectors(d1v2, vSub2)\n        }\n        vSub3.subVectors(d2v3, d1v3)\n        if (vSub2.dot(vSub3) < 0) {\n          vSub3.multiplyScalar(-1)\n          d2v3.addVectors(d1v3, vSub3)\n        }\n      } else {\n        vSub3.copy(vSub4)\n      }\n      vSub4.subVectors(d2v4, d1v4)\n      if (vSub3.dot(vSub4) < 0) {\n        vSub4.multiplyScalar(-1)\n        d2v4.addVectors(d1v4, vSub4)\n      }\n      this.interpolateNormalDir(\n        d1v1, d1v2, d1v3, d1v4,\n        d2v1, d2v2, d2v3, d2v4,\n        tan, norm, bin, k, shift\n      )\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      d1v1.copy(<Vector3>iterDir1.get(n - 2))\n      d1v2.copy(<Vector3>iterDir1.get(n - 1))\n      d1v3.copy(<Vector3>iterDir1.get(0))\n      d1v4.copy(<Vector3>iterDir1.get(1))\n      d2v1.copy(<Vector3>iterDir2.get(n - 2))\n      d2v2.copy(<Vector3>iterDir2.get(n - 1))\n      d2v3.copy(<Vector3>iterDir2.get(0))\n      d2v4.copy(<Vector3>iterDir2.get(1))\n      //\n      vSub3.copy(vSub4)\n      vSub4.subVectors(d2v4, d1v4)\n      if (vSub3.dot(vSub4) < 0) {\n        vSub4.multiplyScalar(-1)\n        d2v4.addVectors(d1v4, vSub4)\n      }\n      this.interpolateNormalDir(\n        d1v1, d1v2, d1v3, d1v4,\n        d2v1, d2v2, d2v3, d2v4,\n        tan, norm, bin, k, shift\n      )\n      k += 3 * this.m\n    }\n    if (shift) {\n      // FIXME shift requires data from one this.more preceeding residue\n      this.vBin.fromArray(bin as any, this.m2 * 3)\n      this.vNorm.fromArray(norm as any, this.m2 * 3)\n      for (var j = 0; j < this.m2; ++j) {\n        this.vBin.toArray(bin as any, j * 3)\n        this.vNorm.toArray(norm as any, j * 3)\n      }\n    } else {\n      this.vBin.toArray(bin as any, k)\n      this.vNorm.toArray(norm as any, k)\n    }\n  }\n\n  //\n\n  private interpolateColor (item1: AtomProxy, item2: AtomProxy, colFn: (...arg: any[]) => void, col: any, offset: number) {\n    var j, l\n    for (j = 0; j < this.m2; ++j) {\n      l = offset + j * 3\n      colFn.apply(this, [item1, col, l]) // itemColorToArray\n    }\n    for (j = this.m2; j < this.m; ++j) {\n      l = offset + j * 3\n      colFn.apply(this, [item2, col, l]) // itemColorToArray\n    }\n  }\n\n  public getColor (iterator: AtomIterator, colFn: (...arg: any[]) => void, col: any, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    iterator.next() // first element not needed\n    let i0: AtomProxy\n    let i1 = <AtomProxy>iterator.next()\n    //\n    var n = iterator.size\n    var n1 = n - 1\n    var k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      i0 = i1\n      i1 = <AtomProxy>iterator.next()\n      this.interpolateColor(i0, i1, colFn, col, k)\n      k += 3 * this.m\n    }\n    if (isCyclic) {\n      i0 = <AtomProxy>iterator.get(n - 1)\n      i1 = <AtomProxy>iterator.get(0)\n      this.interpolateColor(i0, i1, colFn, col, k)\n      k += 3 * this.m\n    }\n    //\n    col[ k ] = col[ k - 3 ]\n    col[ k + 1 ] = col[ k - 2 ]\n    col[ k + 2 ] = col[ k - 1 ]\n  }\n\n  //\n\n  private interpolatePicking (item1: AtomProxy, item2: AtomProxy, pickFn: (item: AtomProxy) => number, pick: Float32Array, offset: number) {\n    var j\n    for (j = 0; j < this.m2; ++j) {\n      pick[ offset + j ] = pickFn.apply(this, [item1])\n    }\n    for (j = this.m2; j < this.m; ++j) {\n      pick[ offset + j ] = pickFn.apply(this, [item2])\n    }\n  }\n\n  public getPicking (iterator: AtomIterator, pickFn: (item: AtomProxy) => number, pick: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    iterator.next() // first element not needed\n    let i0: AtomProxy\n    let i1 = <AtomProxy>iterator.next()\n    //\n    const n = iterator.size\n    const n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      i0 = i1\n      i1 = <AtomProxy>iterator.next()\n      this.interpolatePicking(i0, i1, pickFn, pick, k)\n      k += this.m\n    }\n    if (isCyclic) {\n      i0 = <AtomProxy>iterator.get(n - 1)\n      i1 = <AtomProxy>iterator.get(0)\n      this.interpolatePicking(i0, i1, pickFn, pick, k)\n      k += this.m\n    }\n    //\n    pick[ k ] = pick[ k - 1 ]\n  }\n\n  //\n\n  private interpolateSize (item1: AtomProxy, item2: AtomProxy, sizeFn: (item: AtomProxy) => number, size: Float32Array, offset: number) {\n    const s1: number = sizeFn.apply(this, [item1])\n    const s2: number = sizeFn.apply(this, [item2])\n    for (let j = 0; j < this.m; ++j) {\n      // linear interpolation\n      let t = j / this.m\n      size[ offset + j ] = (1 - t) * s1 + t * s2\n    }\n  }\n\n  public getSize (iterator: AtomIterator, sizeFn: (item: AtomProxy) => number, size: Float32Array, offset: number, isCyclic: boolean) {\n    iterator.reset()\n    iterator.next() // first element not needed\n    let i0: AtomProxy\n    let i1: AtomProxy = <AtomProxy>iterator.next()\n    //\n    const n = iterator.size\n    const n1 = n - 1\n    let k = offset || 0\n    for (var i = 0; i < n1; ++i) {\n      i0 = i1\n      i1 = <AtomProxy>iterator.next()\n      this.interpolateSize(i0, i1, sizeFn, size, k)\n      k += this.m\n    }\n    if (isCyclic) {\n      i0 = <AtomProxy>iterator.get(n - 1)\n      i1 = <AtomProxy>iterator.get(0)\n      this.interpolateSize(i0, i1, sizeFn, size, k)\n      k += this.m\n    }\n    //\n    size[ k ] = size[ k - 1 ]\n  }\n}\n\nexport interface SplineParameters {\n  directional?: boolean\n  positionIterator?: boolean\n  subdiv?: number\n  smoothSheet?: boolean\n  tension?: number\n}\nexport interface AtomIterator {\n  size: number,\n  next: () => AtomProxy | Vector3,\n  get: (idx: number) => AtomProxy | Vector3,\n  reset: () => void\n}\nclass Spline {\n\n  polymer: Polymer\n  size: number\n  directional: boolean\n  positionIterator: any\n  subdiv: number\n  smoothSheet: boolean\n  tension: number\n  interpolator: Interpolator\n\n  constructor (polymer: Polymer, params?: SplineParameters) {\n    this.polymer = polymer\n      this.size = polymer.residueCount\n\n      var p = params || {}\n      this.directional = p.directional || false\n      this.positionIterator = p.positionIterator || false\n      this.subdiv = p.subdiv || 1\n      this.smoothSheet = p.smoothSheet || false\n\n      if (!p.tension) {\n        this.tension = this.polymer.isNucleic() ? 0.5 : 0.9\n      } else {\n        this.tension = p.tension\n      }\n\n      this.interpolator = new Interpolator(this.subdiv, this.tension)\n  }\n\n  getAtomIterator (type: string, smooth?: boolean): AtomIterator {\n    const polymer = this.polymer\n    const structure = polymer.structure\n    const n = polymer.residueCount\n\n    let i = 0\n    let j = -1\n\n    const cache = [\n      structure.getAtomProxy(),\n      structure.getAtomProxy(),\n      structure.getAtomProxy(),\n      structure.getAtomProxy()\n    ]\n\n    const cache2 = [\n      new Vector3(),\n      new Vector3(),\n      new Vector3(),\n      new Vector3()\n    ]\n\n    function next () {\n      var atomProxy = get(j)\n      j += 1\n      return atomProxy\n    }\n\n    var apPrev = structure.getAtomProxy()\n    var apNext = structure.getAtomProxy()\n\n    function get (idx: number) {\n      var atomProxy = cache[ i % 4 ]\n      atomProxy.index = polymer.getAtomIndexByType(idx, type) as number\n      if (smooth && idx > 0 && idx < n && atomProxy.sstruc === 'e') {\n        var vec = cache2[ i % 4 ]\n        apPrev.index = polymer.getAtomIndexByType(idx + 1, type) as number\n        apNext.index = polymer.getAtomIndexByType(idx - 1, type) as number\n        vec.addVectors(apPrev as any, apNext as any)\n          .add(atomProxy as any).add(atomProxy as any)\n          .multiplyScalar(0.25)\n        i += 1\n        return vec\n      }\n      i += 1\n      return atomProxy\n    }\n\n    function reset () {\n      i = 0\n      j = -1\n    }\n\n    return {\n      size: n,\n      next: next,\n      get: get,\n      reset: reset\n    }\n  }\n\n  getSubdividedColor (params: {scheme: string, [k: string]: any } & ColormakerParameters) {\n    var m = this.subdiv\n    var polymer = this.polymer\n    var n = polymer.residueCount\n    var n1 = n - 1\n    var nCol = n1 * m * 3 + 3\n    if (polymer.isCyclic) nCol += m * 3\n\n    var col = new Float32Array(nCol)\n    var iterator = this.getAtomIterator('trace')\n\n    var p = params || {}\n    p.structure = polymer.structure\n\n    var colormaker = ColormakerRegistry.getScheme(p)\n\n    function colFn (item: AtomProxy, array: NumberArray, offset: number) {\n      colormaker.atomColorToArray(item, array, offset)\n    }\n\n    this.interpolator.getColor(\n      iterator, colFn, col, 0, polymer.isCyclic\n    )\n\n    return {\n      'color': col\n    }\n  }\n  \n  getSubdividedPicking () {\n    var m = this.subdiv\n    var polymer = this.polymer\n    var n = polymer.residueCount\n    var n1 = n - 1\n    var nCol = n1 * m + 1\n    if (polymer.isCyclic) nCol += m\n\n    var structure = polymer.structure\n    var iterator = this.getAtomIterator('trace')\n    var pick = new Float32Array(nCol)\n\n    function pickFn (item: AtomProxy) {\n      return item.index\n    }\n\n    this.interpolator.getPicking(\n      iterator, pickFn, pick, 0, polymer.isCyclic\n    )\n\n    return {\n      'picking': new AtomPicker(pick, structure)\n    }\n  }\n\n  getSubdividedPosition () {\n    var pos = this.getPosition()\n\n    return {\n      'position': pos\n    }\n  }\n  \n  getSubdividedOrientation () {\n    const tan = this.getTangent()\n    const normals = this.getNormals(tan)\n\n    return {\n      'tangent': tan,\n      'normal': normals.normal,\n      'binormal': normals.binormal\n    }\n  }\n\n  getSubdividedSize (params: RadiusParams) {\n    var m = this.subdiv\n    var polymer = this.polymer\n    var n = polymer.residueCount\n    var n1 = n - 1\n    var nSize = n1 * m + 1\n    if (polymer.isCyclic) nSize += m\n\n    var size = new Float32Array(nSize)\n    var iterator = this.getAtomIterator('trace')\n\n    var radiusFactory = new RadiusFactory(params)\n\n    function sizeFn (item: AtomProxy) {\n      return radiusFactory.atomRadius(item)\n    }\n\n    this.interpolator.getSize(\n      iterator, sizeFn, size, 0, polymer.isCyclic\n    )\n\n    return {\n      'size': size\n    }\n  }\n\n  getPosition () {\n    const m = this.subdiv\n    const polymer = this.polymer\n    const n = polymer.residueCount\n    const n1 = n - 1\n    let nPos = n1 * m * 3 + 3\n    if (polymer.isCyclic) nPos += m * 3\n\n    const pos = new Float32Array(nPos)\n    const iterator = this.positionIterator || this.getAtomIterator('trace', this.smoothSheet)\n\n    this.interpolator.getPosition(iterator, pos, 0, polymer.isCyclic)\n\n    return pos\n  }\n\n  getTangent () {\n    const m = this.subdiv\n    const polymer = this.polymer\n    const n = this.size\n    const n1 = n - 1\n    let nTan = n1 * m * 3 + 3\n    if (polymer.isCyclic) nTan += m * 3\n\n    const tan = new Float32Array(nTan)\n    const iterator = this.positionIterator || this.getAtomIterator('trace', this.smoothSheet)\n\n    this.interpolator.getTangent(iterator, tan, 0, polymer.isCyclic)\n\n    return tan\n  }\n\n  getNormals (tan: Float32Array) {\n    const m = this.subdiv\n    const polymer = this.polymer\n    const isProtein = polymer.isProtein()\n    const n = this.size\n    const n1 = n - 1\n    let nNorm = n1 * m * 3 + 3\n    if (polymer.isCyclic) nNorm += m * 3\n\n    const norm = new Float32Array(nNorm)\n    const bin = new Float32Array(nNorm)\n\n    if (this.directional && !this.polymer.isCg()) {\n      const iterDir1 = this.getAtomIterator('direction1')\n      const iterDir2 = this.getAtomIterator('direction2')\n      this.interpolator.getNormalDir(\n        iterDir1, iterDir2, tan, norm, bin, 0, polymer.isCyclic, isProtein\n      )\n    } else {\n      this.interpolator.getNormal(\n        n, tan, norm, bin, 0, polymer.isCyclic\n      )\n    }\n\n    return {\n      'normal': norm,\n      'binormal': bin\n    }\n  }\n\n}\n\nexport default Spline\n","/**\n * @file Tube Mesh Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Matrix4 required for declaration only\nimport { Vector3, Matrix4 } from 'three'\n\nimport { defaults, getUintArray } from '../utils'\nimport { serialArray } from '../math/array-utils'\nimport MeshBuffer from './mesh-buffer'\nimport { BufferDefaultParameters, BufferData } from './buffer'\nimport {Log} from \"../globals\";\n\nconst vTangent = new Vector3()\nconst vMeshNormal = new Vector3()\n\nexport interface TubeMeshBufferData extends BufferData {\n  binormal: Float32Array\n  tangent: Float32Array\n  size: Float32Array\n}\n\nexport const TubeMeshBufferDefaultParameters = Object.assign({\n  radialSegments: 4,\n  capped: false,\n  aspectRatio: 1.0\n}, BufferDefaultParameters)\nexport type TubeMeshBufferParameters = typeof TubeMeshBufferDefaultParameters\n\nfunction getData (data: TubeMeshBufferData, params: Partial<TubeMeshBufferParameters> = {}) {\n  const radialSegments = defaults(params.radialSegments, 4)\n  const capped = defaults(params.capped, false)\n\n  const capVertices = capped ? radialSegments : 0\n  const capTriangles = capped ? radialSegments - 2 : 0\n\n  const n = data.position!.length / 3\n  const n1 = n - 1\n  const x = n * radialSegments * 3 + 2 * capVertices * 3\n  const xi = n1 * 2 * radialSegments * 3 + 2 * capTriangles * 3\n\n  return {\n    position: new Float32Array(x),\n    color: new Float32Array(x),\n    index: getUintArray(xi, x / 3),\n    normal: new Float32Array(x),\n    picking: data.picking\n  }\n}\n\n/**\n * Tube mesh buffer. Draws a tube.\n */\nclass TubeMeshBuffer extends MeshBuffer {\n  get defaultParameters() { return TubeMeshBufferDefaultParameters }\n  parameters: TubeMeshBufferParameters\n\n  capVertices: number\n  capTriangles: number\n  size2: number\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.normal - normals\n   * @param  {Float32Array} data.binormal - binormals\n   * @param  {Float32Array} data.tangent - tangents\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.size - sizes\n   * @param  {Picker} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: TubeMeshBufferData, params: Partial<TubeMeshBufferParameters> = {}) {\n    super(getData(data, params), params)\n\n    this.capVertices = this.parameters.capped ? this.parameters.radialSegments : 0\n    this.capTriangles = this.parameters.capped ? this.parameters.radialSegments - 2 : 0\n\n    this.size2 = data.position!.length / 3\n    data.primitiveId = serialArray(this.size2)\n\n    this.setAttributes(data)\n    this.makeIndex()\n  }\n\n  setAttributes (data: Partial<TubeMeshBufferData> = {}) {\n    const aspectRatio = this.parameters.aspectRatio\n\n    const n = this.size2\n    const n1 = n - 1\n    const radialSegments = this.parameters.radialSegments\n\n    const attributes = this.geometry.attributes as any\n\n    let position, normal, binormal, tangent, color, size, primitiveId\n    let meshPosition, meshColor, meshNormal, meshPrimitiveId\n\n    if (data.position) {\n      position = data.position\n      normal = data.normal\n      binormal = data.binormal\n      tangent = data.tangent\n      size = data.size\n\n      meshPosition = attributes.position.array\n      meshNormal = attributes.normal.array\n\n      attributes.position.needsUpdate = true\n      attributes.normal.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      meshColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    if (data.primitiveId) {\n      primitiveId = data.primitiveId\n      meshPrimitiveId = attributes.primitiveId.array\n      attributes.primitiveId.needsUpdate = true\n    }\n\n    let k, l\n    let radius = 0\n\n    let normX = 0\n    let normY = 0\n    let normZ = 0\n    let biX = 0\n    let biY = 0\n    let biZ = 0\n    let posX = 0\n    let posY = 0\n    let posZ = 0\n\n    const cxArr = []\n    const cyArr = []\n    const cx1Arr = []\n    const cy1Arr = []\n    const cx2Arr = []\n    const cy2Arr = []\n\n    if (position) {\n      for (let j = 0; j < radialSegments; ++j) {\n        const v = (j / radialSegments) * 2 * Math.PI\n\n        cxArr[ j ] = aspectRatio * Math.cos(v)\n        cyArr[ j ] = Math.sin(v)\n\n        cx1Arr[ j ] = aspectRatio * Math.cos(v - 0.01)\n        cy1Arr[ j ] = Math.sin(v - 0.01)\n        cx2Arr[ j ] = aspectRatio * Math.cos(v + 0.01)\n        cy2Arr[ j ] = Math.sin(v + 0.01)\n      }\n    }\n\n    for (let i = 0; i < n; ++i) {\n      k = i * 3\n      l = k * radialSegments\n\n      if (position && tangent && normal && binormal && size) {\n        vTangent.set(\n          tangent[ k ], tangent[ k + 1 ], tangent[ k + 2 ]\n        )\n\n        normX = normal[ k ]\n        normY = normal[ k + 1 ]\n        normZ = normal[ k + 2 ]\n\n        biX = binormal[ k ]\n        biY = binormal[ k + 1 ]\n        biZ = binormal[ k + 2 ]\n\n        posX = position[ k ]\n        posY = position[ k + 1 ]\n        posZ = position[ k + 2 ]\n\n        radius = size[ i ]\n      }\n\n      for (let j = 0; j < radialSegments; ++j) {\n        const s = l + j * 3\n\n        if (position) {\n          const cx = -radius * cxArr[ j ] // TODO: Hack: Negating it so it faces outside.\n          const cy = radius * cyArr[ j ]\n\n          const cx1 = -radius * cx1Arr[ j ]\n          const cy1 = radius * cy1Arr[ j ]\n          const cx2 = -radius * cx2Arr[ j ]\n          const cy2 = radius * cy2Arr[ j ]\n\n          meshPosition[ s ] = posX + cx * normX + cy * biX\n          meshPosition[ s + 1 ] = posY + cx * normY + cy * biY\n          meshPosition[ s + 2 ] = posZ + cx * normZ + cy * biZ\n\n                    // TODO half of these are symmetric\n          vMeshNormal.set(\n            // ellipse tangent approximated as vector from/to adjacent points\n            (cx2 * normX + cy2 * biX) - (cx1 * normX + cy1 * biX),\n            (cx2 * normY + cy2 * biY) - (cx1 * normY + cy1 * biY),\n            (cx2 * normZ + cy2 * biZ) - (cx1 * normZ + cy1 * biZ)\n          ).cross(vTangent)\n\n          meshNormal[ s ] = vMeshNormal.x\n          meshNormal[ s + 1 ] = vMeshNormal.y\n          meshNormal[ s + 2 ] = vMeshNormal.z\n        }\n\n        if (color) {\n          meshColor[ s ] = color[ k ]\n          meshColor[ s + 1 ] = color[ k + 1 ]\n          meshColor[ s + 2 ] = color[ k + 2 ]\n        }\n\n        if (primitiveId) {\n          meshPrimitiveId[ i * radialSegments + j ] = primitiveId[ i ]\n        }\n      }\n    }\n\n        // front cap\n\n    k = 0\n    l = n * 3 * radialSegments\n\n    for (let j = 0; j < radialSegments; ++j) {\n      const s = k + j * 3\n      const t = l + j * 3\n\n      if (position && tangent) {\n        meshPosition[ t ] = meshPosition[ s ]\n        meshPosition[ t + 1 ] = meshPosition[ s + 1 ]\n        meshPosition[ t + 2 ] = meshPosition[ s + 2 ]\n\n        meshNormal[ t ] = tangent[ k ]\n        meshNormal[ t + 1 ] = tangent[ k + 1 ]\n        meshNormal[ t + 2 ] = tangent[ k + 2 ]\n      }\n\n      if (color) {\n        meshColor[ t ] = meshColor[ s ]\n        meshColor[ t + 1 ] = meshColor[ s + 1 ]\n        meshColor[ t + 2 ] = meshColor[ s + 2 ]\n      }\n\n      if (primitiveId) {\n        meshPrimitiveId[ n * radialSegments + j ] = meshPrimitiveId[ 0 + j ]\n      }\n    }\n\n        // back cap\n\n    k = (n - 1) * 3 * radialSegments\n    l = (n + 1) * 3 * radialSegments\n\n    for (let j = 0; j < radialSegments; ++j) {\n      const s = k + j * 3\n      const t = l + j * 3\n\n      if (position && tangent) {\n        meshPosition[ t ] = meshPosition[ s ]\n        meshPosition[ t + 1 ] = meshPosition[ s + 1 ]\n        meshPosition[ t + 2 ] = meshPosition[ s + 2 ]\n\n        meshNormal[ t ] = tangent[ n1 * 3 ]\n        meshNormal[ t + 1 ] = tangent[ n1 * 3 + 1 ]\n        meshNormal[ t + 2 ] = tangent[ n1 * 3 + 2 ]\n      }\n\n      if (color) {\n        meshColor[ t ] = meshColor[ s ]\n        meshColor[ t + 1 ] = meshColor[ s + 1 ]\n        meshColor[ t + 2 ] = meshColor[ s + 2 ]\n      }\n\n      if (primitiveId) {\n        meshPrimitiveId[ (n + 1) * radialSegments + j ] = meshPrimitiveId[ (n - 1) * radialSegments + j ]\n      }\n    }\n  }\n\n  makeIndex () {\n    const index = this.geometry.getIndex()\n    if (!index) { Log.error('Index is null'); return; }\n    const meshIndex = index.array as Uint32Array|Uint16Array\n\n    const n = this.size2\n    const n1 = n - 1\n    const capTriangles = this.capTriangles\n    const radialSegments = this.parameters.radialSegments\n    const radialSegments1 = this.parameters.radialSegments + 1\n\n    let k, l\n\n    for (let i = 0; i < n1; ++i) {\n      const k = i * radialSegments * 3 * 2\n\n      const irs = i * radialSegments\n      const irs1 = (i + 1) * radialSegments\n\n      for (let j = 0; j < radialSegments; ++j) {\n        l = k + j * 3 * 2\n\n        // meshIndex[ l + 0 ] = irs + ( ( j + 0 ) % radialSegments );\n        meshIndex[ l ] = irs + j\n        meshIndex[ l + 1 ] = irs + ((j + 1) % radialSegments)\n        // meshIndex[ l + 2 ] = irs1 + ( ( j + 0 ) % radialSegments );\n        meshIndex[ l + 2 ] = irs1 + j\n\n        // meshIndex[ l + 3 ] = irs1 + ( ( j + 0 ) % radialSegments );\n        meshIndex[ l + 3 ] = irs1 + j\n        meshIndex[ l + 4 ] = irs + ((j + 1) % radialSegments)\n        meshIndex[ l + 5 ] = irs1 + ((j + 1) % radialSegments)\n      }\n    }\n\n    // capping\n\n    const strip = [ 0 ]\n\n    for (let j = 1; j < radialSegments1 / 2; ++j) {\n      strip.push(j)\n      if (radialSegments - j !== j) {\n        strip.push(radialSegments - j)\n      }\n    }\n\n    // front cap\n\n    l = n1 * radialSegments * 3 * 2\n    k = n * radialSegments\n\n    for (let j = 0; j < strip.length - 2; ++j) {\n      if (j % 2 === 0) {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 0 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 2 ]\n      } else {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 2 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 0 ]\n      }\n    }\n\n    // back cap\n\n    l = n1 * radialSegments * 3 * 2 + 3 * capTriangles\n    k = n * radialSegments + radialSegments\n\n    for (let j = 0; j < strip.length - 2; ++j) {\n      if (j % 2 === 0) {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 0 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 2 ]\n      } else {\n        meshIndex[ l + j * 3 + 0 ] = k + strip[ j + 2 ]\n        meshIndex[ l + j * 3 + 1 ] = k + strip[ j + 1 ]\n        meshIndex[ l + j * 3 + 2 ] = k + strip[ j + 0 ]\n      }\n    }\n  }\n}\n\nexport default TubeMeshBuffer\n","/**\n * @file Cartoon Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { Debug, Log, RepresentationRegistry } from '../globals'\nimport Spline from '../geometry/spline'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport TubeMeshBuffer from '../buffer/tubemesh-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport Polymer from '../proxy/polymer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport Buffer from '../buffer/buffer';\n\nexport interface CartoonRepresentationParameters extends StructureRepresentationParameters {\n  aspectRatio: number\n  subdiv: number\n  radialSegments: number\n  tension: number\n  capped: boolean\n  smoothSheet: boolean\n}\n\n/**\n * Cartoon representation. Show a thick ribbon that\n * smoothly connecting backbone atoms in polymers.\n *\n * __Name:__ _cartoon_\n *\n * @example\n * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n *     o.addRepresentation( \"cartoon\" );\n *     o.autoView();\n * } );\n */\nclass CartoonRepresentation extends StructureRepresentation {\n  protected aspectRatio: number\n  protected tension: number\n  protected capped: boolean\n  protected smoothSheet: boolean\n  protected subdiv: number\n  \n  /**\n   * Create Cartoon representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {StructureRepresentationParameters} params - representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<CartoonRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'cartoon'\n\n    this.parameters = Object.assign({\n\n      aspectRatio: {\n        type: 'number', precision: 1, max: 10.0, min: 1.0, rebuild: true\n      },\n      subdiv: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      radialSegments: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      tension: {\n        type: 'number', precision: 1, max: 1.0, min: 0.1\n      },\n      capped: {\n        type: 'boolean', rebuild: true\n      },\n      smoothSheet: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<CartoonRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'chainname')\n    p.colorScale = defaults(p.colorScale, 'RdYlBu')\n    p.radiusType = defaults(p.radiusType, 'sstruc')\n    p.radiusScale = defaults(p.radiusScale, 0.7)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.aspectRatio = defaults(p.aspectRatio, 5.0)\n    this.tension = defaults(p.tension, NaN)\n    this.capped = defaults(p.capped, true)\n    this.smoothSheet = defaults(p.smoothSheet, false)\n\n    if (p.quality === 'low') {\n      this.subdiv = 3\n      this.radialSegments = 6\n    } else if (p.quality === 'medium') {\n      this.subdiv = 6\n    } else if (p.quality === 'high') {\n      this.subdiv = 12\n    } else {\n      this.subdiv = defaults(p.subdiv, 6)\n    }\n\n    super.init(p)\n  }\n\n  getSplineParams (params?: Partial<CartoonRepresentationParameters>) {\n    return Object.assign({\n      subdiv: this.subdiv,\n      tension: this.tension,\n      directional: this.aspectRatio !== 1.0,\n      smoothSheet: this.smoothSheet\n    }, params)\n  }\n\n  getSpline (polymer: Polymer): Spline {\n    return new Spline(polymer, this.getSplineParams())\n  }\n\n  getAspectRatio (polymer: Polymer): number {\n    return polymer.isCg() ? 1.0 : this.aspectRatio\n  }\n\n  getAtomRadius (atom: AtomProxy): number {\n    return atom.isTrace() ? super.getAtomRadius(atom) : 0\n  }\n\n  createData (sview: StructureView) {\n    let bufferList: Buffer[] = []\n    let polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      const spline = this.getSpline(polymer)\n      const aspectRatio = this.getAspectRatio(polymer)\n\n      const subPos = spline.getSubdividedPosition()\n      const subOri = spline.getSubdividedOrientation()\n      const subCol = spline.getSubdividedColor(this.getColorParams())\n      const subPick = spline.getSubdividedPicking()\n      const subSize = spline.getSubdividedSize(this.getRadiusParams())\n\n      bufferList.push(\n        new TubeMeshBuffer(\n          Object.assign({}, subPos, subOri, subCol, subPick, subSize),\n          this.getBufferParams({\n            radialSegments: this.radialSegments,\n            aspectRatio: aspectRatio,\n            capped: this.capped\n          })\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList,\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: any, data: StructureRepresentationData) {\n    if (Debug) Log.time(this.type + ' repr update')\n\n    what = what || {}\n\n    for (var i = 0, il = data.polymerList!.length; i < il; ++i) {\n      var bufferData: {[key: string]: any} = {}\n      var polymer = data.polymerList![ i ]\n      var spline = this.getSpline(polymer)\n      var aspectRatio = this.getAspectRatio(polymer)\n\n      Object.assign(data.bufferList[ i ], {aspectRatio: aspectRatio})\n\n      if (what.position || what.radius) {\n        var subPos = spline.getSubdividedPosition()\n        var subOri = spline.getSubdividedOrientation()\n        var subSize = spline.getSubdividedSize(this.getRadiusParams(aspectRatio))\n\n        bufferData.position = subPos.position\n        bufferData.normal = subOri.normal\n        bufferData.binormal = subOri.binormal\n        bufferData.tangent = subOri.tangent\n        bufferData.size = subSize.size\n      }\n\n      if (what.color) {\n        var subCol = spline.getSubdividedColor(this.getColorParams())\n        bufferData.color = subCol.color\n      }\n\n      if (what.picking) {\n        var subPick = spline.getSubdividedPicking()\n        bufferData.picking = subPick.picking\n      }\n\n      data.bufferList[ i ].setAttributes(bufferData)\n    }\n\n    if (Debug) Log.timeEnd(this.type + ' repr update')\n  }\n\n  setParameters (params: Partial<CartoonRepresentationParameters>) {\n    const rebuild = false\n    var what: {[k: string]: any} = {}\n\n    if (params && params.aspectRatio) {\n      what.radius = true\n    }\n\n    if (params && params.tension) {\n      what.position = true\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('cartoon', CartoonRepresentation)\n\nexport default CartoonRepresentation\n","/**\n * @file Contact Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport { calculateContacts, getContactData, getLabelData } from '../chemistry/interactions/contact'\nimport CylinderBuffer from '../buffer/cylinder-buffer'\nimport TextBuffer from '../buffer/text-buffer'\nimport { getFixedCountDashData } from '../geometry/dash'\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport CylinderImpostorBuffer from '../buffer/cylinderimpostor-buffer';\n// @ts-ignore: unused import ContactPicker required for declaration only\nimport { ContactPicker } from '../utils/picker';\n\nexport interface ContactRepresentationParameters extends StructureRepresentationParameters {\n  hydrogenBond: boolean\n  weakHydrogenBond: boolean\n  waterHydrogenBond: boolean\n  backboneHydrogenBond: boolean\n  hydrophobic: boolean\n  halogenBond: boolean\n  ionicInteraction: boolean\n  metalCoordination: boolean\n  cationPi: boolean\n  piStacking: boolean\n  filterSele: string|[string, string]\n  maxHydrophobicDist: number\n  maxHbondDist: number\n  maxHbondSulfurDist: number\n  maxHbondAccAngle: number\n  maxHbondDonAngle: number\n  maxHbondAccPlaneAngle: number\n  maxHbondDonPlaneAngle: number\n  maxPiStackingDist: number\n  maxPiStackingOffset: number\n  maxPiStackingAngle: number\n  maxCationPiDist: number\n  maxCationPiOffset: number\n  maxIonicDist: number\n  maxHalogenBondDist: number\n  maxHalogenBondAngle: number\n  maxMetalDist: number\n  refineSaltBridges: boolean\n  masterModelIndex: number\n  lineOfSightDistFactor: number\n}\n\n/**\n * Contact representation.\n */\nclass ContactRepresentation extends StructureRepresentation {\n  protected hydrogenBond: boolean\n  protected weakHydrogenBond: boolean\n  protected waterHydrogenBond: boolean\n  protected backboneHydrogenBond: boolean\n  protected hydrophobic: boolean\n  protected halogenBond: boolean\n  protected ionicInteraction: boolean\n  protected metalCoordination: boolean\n  protected cationPi: boolean\n  protected piStacking: boolean\n  protected filterSele: string|[string, string]\n  protected maxHydrophobicDist: number\n  protected maxHbondDist: number\n  protected maxHbondSulfurDist: number\n  protected maxHbondAccAngle: number\n  protected maxHbondDonAngle: number\n  protected maxHbondAccPlaneAngle: number\n  protected maxHbondDonPlaneAngle: number\n  protected maxPiStackingDist: number\n  protected maxPiStackingOffset: number\n  protected maxPiStackingAngle: number\n  protected maxCationPiDist: number\n  protected maxCationPiOffset: number\n  protected maxIonicDist: number\n  protected maxHalogenBondDist: number\n  protected maxHalogenBondAngle: number\n  protected maxMetalDist: number\n  protected refineSaltBridges: boolean\n  protected masterModelIndex: number\n  protected lineOfSightDistFactor: number\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<ContactRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'contact'\n\n    this.parameters = Object.assign({\n      hydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      weakHydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      waterHydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      backboneHydrogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      hydrophobic: {\n        type: 'boolean', rebuild: true\n      },\n      halogenBond: {\n        type: 'boolean', rebuild: true\n      },\n      ionicInteraction: {\n        type: 'boolean', rebuild: true\n      },\n      metalCoordination: {\n        type: 'boolean', rebuild: true\n      },\n      cationPi: {\n        type: 'boolean', rebuild: true\n      },\n      piStacking: {\n        type: 'boolean', rebuild: true\n      },\n\n      filterSele: {\n        type: 'text', rebuild: true\n      },\n\n      labelVisible: {\n        type: 'boolean', rebuild: true\n      },\n\n      labelFixedSize: {\n        type: 'boolean', buffer: 'fixedSize'\n      },\n\n      labelSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001, rebuild: true\n      },\n\n      labelUnit: {\n        type: 'select',\n        rebuild: true,\n        options: { '': '', angstrom: 'angstrom', nm: 'nm' }\n      },\n\n      maxHydrophobicDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHbondDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHbondSulfurDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHbondAccAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxHbondDonAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxHbondAccPlaneAngle: {\n        type: 'integer', max: 90, min: 0, rebuild: true\n      },\n      maxHbondDonPlaneAngle: {\n        type: 'integer', max: 90, min: 0, rebuild: true\n      },\n      maxPiStackingDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxPiStackingOffset: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxPiStackingAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxCationPiDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxCationPiOffset: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxIonicDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHalogenBondDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      maxHalogenBondAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      maxMetalDist: {\n        type: 'number', precision: 1, max: 10, min: 0.1, rebuild: true\n      },\n      refineSaltBridges: {\n        type: 'boolean', rebuild: true\n      },\n      masterModelIndex: {\n        type: 'integer', max: 1000, min: -1, rebuild: true\n      },\n      lineOfSightDistFactor: {\n        type: 'number', precision: 1, max: 10, min: 0.0, rebuild: true\n      },\n\n      radialSegments: true,\n      disableImpostor: true\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<ContactRepresentationParameters>) {\n    var p = params || {}\n    p.radiusSize = defaults(p.radiusSize, 0.05)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.hydrogenBond = defaults(p.hydrogenBond, true)\n    this.weakHydrogenBond = defaults(p.weakHydrogenBond, false)\n    this.waterHydrogenBond = defaults(p.waterHydrogenBond, false)\n    this.backboneHydrogenBond = defaults(p.backboneHydrogenBond, false)\n    this.hydrophobic = defaults(p.hydrophobic, false)\n    this.halogenBond = defaults(p.halogenBond, true)\n    this.ionicInteraction = defaults(p.ionicInteraction, true)\n    this.metalCoordination = defaults(p.metalCoordination, true)\n    this.cationPi = defaults(p.cationPi, true)\n    this.piStacking = defaults(p.piStacking, true)\n\n    this.filterSele = defaults(p.filterSele, '')\n    this.labelVisible = defaults(p.labelVisible, false)\n    this.labelFixedSize = defaults(p.labelFixedSize, false)\n    this.labelSize = defaults(p.labelSize, 2.0)\n    this.labelUnit = defaults(p.labelUnit, '')\n\n    this.maxHydrophobicDist = defaults(p.maxHydrophobicDist, 4.0)\n    this.maxHbondDist = defaults(p.maxHbondDist, 3.5)\n    this.maxHbondSulfurDist = defaults(p.maxHbondSulfurDist, 4.1)\n    this.maxHbondAccAngle = defaults(p.maxHbondAccAngle, 45)\n    this.maxHbondDonAngle = defaults(p.maxHbondDonAngle, 45)\n    this.maxHbondAccPlaneAngle = defaults(p.maxHbondAccPlaneAngle, 90)\n    this.maxHbondDonPlaneAngle = defaults(p.maxHbondDonPlaneAngle, 30)\n    this.maxPiStackingDist = defaults(p.maxPiStackingDist, 5.5)\n    this.maxPiStackingOffset = defaults(p.maxPiStackingOffset, 2.0)\n    this.maxPiStackingAngle = defaults(p.maxPiStackingAngle, 30)\n    this.maxCationPiDist = defaults(p.maxCationPiDist, 6.0)\n    this.maxCationPiOffset = defaults(p.maxCationPiOffset, 2.0)\n    this.maxIonicDist = defaults(p.maxIonicDist, 5.0)\n    this.maxHalogenBondDist = defaults(p.maxHalogenBondDist, 3.5)\n    this.maxHalogenBondAngle = defaults(p.maxHalogenBondAngle, 30)\n    this.maxMetalDist = defaults(p.maxMetalDist, 3.0)\n    this.refineSaltBridges = defaults(p.refineSaltBridges, true)\n    this.masterModelIndex = defaults(p.masterModelIndex, -1)\n    this.lineOfSightDistFactor = defaults(p.lineOfSightDistFactor, 1.0)\n\n    super.init(p)\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n\n  getContactData (sview: StructureView) {\n    const params = {\n      maxHydrophobicDist: this.maxHydrophobicDist,\n      maxHbondDist: this.maxHbondDist,\n      maxHbondSulfurDist: this.maxHbondSulfurDist,\n      maxHbondAccAngle: this.maxHbondAccAngle,\n      maxHbondDonAngle: this.maxHbondDonAngle,\n      maxHbondAccPlaneAngle: this.maxHbondAccPlaneAngle,\n      maxHbondDonPlaneAngle: this.maxHbondDonPlaneAngle,\n      maxPiStackingDist: this.maxPiStackingDist,\n      maxPiStackingOffset: this.maxPiStackingOffset,\n      maxPiStackingAngle: this.maxPiStackingAngle,\n      maxCationPiDist: this.maxCationPiDist,\n      maxCationPiOffset: this.maxCationPiOffset,\n      maxIonicDist: this.maxIonicDist,\n      maxHalogenBondDist: this.maxHalogenBondDist,\n      maxHalogenBondAngle: this.maxHalogenBondAngle,\n      maxMetalDist: this.maxMetalDist,\n      refineSaltBridges: this.refineSaltBridges,\n      masterModelIndex: this.masterModelIndex,\n      lineOfSightDistFactor: this.lineOfSightDistFactor\n    }\n\n    const dataParams = {\n      hydrogenBond: this.hydrogenBond,\n      weakHydrogenBond: this.weakHydrogenBond,\n      waterHydrogenBond: this.waterHydrogenBond,\n      backboneHydrogenBond: this.backboneHydrogenBond,\n      hydrophobic: this.hydrophobic,\n      halogenBond: this.halogenBond,\n      ionicInteraction: this.ionicInteraction,\n      metalCoordination: this.metalCoordination,\n      cationPi: this.cationPi,\n      piStacking: this.piStacking,\n      radius: this.radiusSize * this.radiusScale,\n      filterSele: this.filterSele\n    }\n\n    const contacts = calculateContacts(sview, params)\n    return getContactData(contacts, sview, dataParams)\n  }\n\n  createData (sview: StructureView) {\n    const contactData = this.getContactData(sview)\n\n    const bufferList = [\n      new CylinderBuffer(\n        getFixedCountDashData(contactData),\n        this.getBufferParams({\n          sphereDetail: 1,\n          dullInterior: true,\n          disableImpostor: this.disableImpostor\n        })\n      ) as (CylinderGeometryBuffer | CylinderImpostorBuffer | TextBuffer)\n    ]\n\n    if (this.labelVisible) {\n      const labelParams = {\n        size: this.labelSize,\n        unit: this.labelUnit\n      }\n      bufferList.push(new TextBuffer(\n        getLabelData(contactData, labelParams),\n        this.getBufferParams({fixedSize: this.labelFixedSize})\n      ))\n    }\n\n    return { bufferList }\n  }\n}\n\nRepresentationRegistry.add('contact', ContactRepresentation)\n\nexport default ContactRepresentation\n","/**\n * @file Dihedral Representation\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\nimport { Color } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport MeasurementRepresentation, { calcArcPoint, parseNestedAtoms, MeasurementRepresentationParameters, LabelDataField } from './measurement-representation'\nimport { defaults } from '../utils'\n\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport TextBuffer, { TextBufferData } from '../buffer/text-buffer'\nimport WideLineBuffer from '../buffer/wideline-buffer'\n\nimport { copyArray, uniformArray, uniformArray3 } from '../math/array-utils'\nimport { v3add, v3angle, v3cross, v3dot, v3multiplyScalar, v3fromArray, v3length,\n  v3negate, v3new, v3normalize, v3sub, v3toArray } from '../math/vector-utils'\nimport { RAD2DEG } from '../math/math-constants'\nimport { getFixedLengthWrappedDashData } from '../geometry/dash'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { CylinderBufferData } from '../buffer/cylinder-buffer';\nimport { BufferData } from '../buffer/buffer';\nimport { StructureRepresentationData } from './structure-representation';\n\n/**\n * @typedef {Object} DihedralRepresentationParameters - dihedral representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n * @mixes MeasurementRepresentationParameters\n *\n * @property {String} atomQuad - list of quadruplets of selection strings\n *                               or atom indices\n * @property {Boolean} extendLine - Extend lines in planes\n * @property {Number} lineOpacity - Opacity for the line part of the representation\n * @property {Boolean} lineVisible - Display the line part of the representation\n * @property {Number} linewidth - width for line part of representation\n * @property {Boolean} planeVisible - Display the two planes corresponding to dihedral\n * @property {Boolean} sectorVisible - Display the filled arc for each angle\n */\n\nexport interface DihedralRepresentationParameters extends MeasurementRepresentationParameters {\n  atomQuad: (number|string)[][]\n  extendLine: boolean\n  lineOpacity: number\n  lineVisible: boolean\n  linewidth: number\n  planeVisible: boolean\n  sectorVisible: boolean\n}\n\n/**\n * Dihedral representation object\n *\n * Reperesentation consists of three parts, visibility can be set for each\n * label - text label indicating dihedral angle\n * line - line indicating four positions that define the dihedral\n * sector - filled arc section\n *\n * @param {Structure} structure - the structure to measure angles in\n * @param {Viewer} viewer - a viewer object\n * @param {AngleRepresentationParameters} params - angle representation parameters\n */\nclass DihedralRepresentation extends MeasurementRepresentation {\n  protected atomQuad: (number|string)[][]\n  protected extendLine: boolean\n  protected lineOpacity: number\n  protected lineVisible: boolean\n  protected linewidth: number\n  protected planeVisible: boolean\n  protected sectorVisible: boolean\n\n  protected lineLength: number\n  protected planeLength: number\n  protected sectorLength: number\n\n  protected lineBuffer: WideLineBuffer\n  protected planeBuffer: MeshBuffer\n  protected sectorBuffer: MeshBuffer\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<DihedralRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'dihedral'\n\n    this.parameters = Object.assign({\n      atomQuad: {\n        type: 'hidden', rebuild: true\n      },\n      extendLine: {\n        type: 'boolean', rebuild: true, default: true\n      },\n      lineVisible: {\n        type: 'boolean', default: true\n      },\n      planeVisible: {\n        type: 'boolean', default: true\n      },\n      sectorVisible: {\n        type: 'boolean', default: true\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<DihedralRepresentationParameters>) {\n    const p = params || {}\n    p.side = defaults(p.side, 'double')\n    p.opacity = defaults(p.opacity, 0.5)\n\n    this.atomQuad = defaults(p.atomQuad, [])\n    this.extendLine = defaults(p.extendLine, true)\n    this.lineVisible = defaults(p.lineVisible, true)\n    this.planeVisible = defaults(p.planeVisible, true)\n    this.sectorVisible = defaults(p.sectorVisible, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.atomCount || !this.atomQuad.length) return\n\n    const atomPosition = parseNestedAtoms(sview, this.atomQuad)\n    const dihedralData = getDihedralData(\n      atomPosition, {\n        extendLine: this.extendLine\n      }\n    )\n\n    const n = this.n = dihedralData.labelText.length\n    const labelColor = new Color(this.labelColor)\n\n    this.textBuffer = new TextBuffer({\n      position: dihedralData.labelPosition,\n      size: uniformArray(n, this.labelSize),\n      color: uniformArray3(n, labelColor.r, labelColor.g, labelColor.b),\n      text: dihedralData.labelText\n    } as TextBufferData, this.getLabelBufferParams())\n\n    const c = new Color(this.colorValue)\n    this.lineLength = dihedralData.linePosition1.length / 3\n    const lineColor = uniformArray3(this.lineLength, c.r, c.g, c.b)\n\n    this.lineBuffer = new WideLineBuffer(\n      getFixedLengthWrappedDashData({\n        position1: dihedralData.linePosition1,\n        position2: dihedralData.linePosition2,\n        color: lineColor,\n        color2: lineColor\n      } as CylinderBufferData) ,\n      this.getBufferParams({\n        linewidth: this.linewidth,\n        visible: this.lineVisible,\n        opacity: this.lineOpacity\n      })\n    )\n\n    this.planeLength = dihedralData.planePosition.length / 3\n    this.planeBuffer = new MeshBuffer({\n      position: dihedralData.planePosition,\n      color: uniformArray3(this.planeLength, c.r, c.g, c.b)\n    } as BufferData, this.getBufferParams({\n      visible: this.planeVisible\n    }))\n\n    this.sectorLength = dihedralData.sectorPosition.length / 3\n    this.sectorBuffer = new MeshBuffer({\n      position: dihedralData.sectorPosition,\n      color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n    } as BufferData, this.getBufferParams({\n      visible: this.sectorVisible\n    }))\n\n    return {\n      bufferList: [\n        this.textBuffer,\n        this.lineBuffer,\n        this.planeBuffer,\n        this.sectorBuffer\n      ]\n    }\n  }\n\n  updateData (what: LabelDataField & {color?: boolean}, data: StructureRepresentationData) {\n    super.updateData(what, data)\n    const lineData = {}\n    const planeData = {}\n    const sectorData = {}\n\n    if (what.color) {\n      const c = new Color(this.colorValue)\n      Object.assign(lineData, {\n        color: uniformArray3(this.lineLength, c.r, c.g, c.b),\n        color2: uniformArray3(this.lineLength, c.r, c.g, c.b)\n      })\n      Object.assign(planeData, {\n        color: uniformArray3(this.planeLength, c.r, c.g, c.b)\n      })\n      Object.assign(sectorData, {\n        color: uniformArray3(this.sectorLength, c.r, c.g, c.b)\n      })\n    }\n\n    this.lineBuffer.setAttributes(lineData)\n    this.planeBuffer.setAttributes(planeData)\n    this.sectorBuffer.setAttributes(sectorData)\n  }\n\n  setParameters (params: Partial<DihedralRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    super.setParameters(params, what, rebuild)\n\n    if (params && (\n      params.lineVisible !== undefined ||\n      params.sectorVisible !== undefined ||\n      params.planeVisible !== undefined)) {\n      this.setVisibility(this.visible)\n    }\n\n    if (params && params.lineOpacity) {\n      this.lineBuffer.setParameters({ opacity: params.lineOpacity })\n    }\n\n    if (params && params.opacity !== undefined) {\n      this.lineBuffer.setParameters({ opacity: this.lineOpacity })\n    }\n\n    if (params && params.linewidth) {\n      this.lineBuffer.setParameters({ linewidth: params.linewidth })\n    }\n\n    return this\n  }\n\n  setVisibility (value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n\n    if (this.lineBuffer) {\n      this.lineBuffer.setVisibility(this.lineVisible && this.visible)\n    }\n\n    if (this.planeBuffer) {\n      this.planeBuffer.setVisibility(this.planeVisible && this.visible)\n    }\n\n    if (this.sectorBuffer) {\n      this.sectorBuffer.setVisibility(this.sectorVisible && this.visible)\n    }\n\n    if (!noRenderRequest) this.viewer.requestRender()\n\n    return this\n  }\n}\n\n/**\n * Build the data required to create {Buffer} objects, given positions\n * @param  {Float32Array} atomPosition 3*4*nDihedral array of coordinates\n * @return {Object}              Arrays for building buffers\n */\nfunction getDihedralData (position: Float32Array, params: Partial<DihedralRepresentationParameters> = {}) {\n  const angleStep = defaults(params.angleStep, Math.PI / 90)\n  const nPos = position.length\n  const n = position.length / 12\n  const angles = new Float32Array(n)\n  const labelPosition = new Float32Array(n * 3)\n  const labelText = new Array(n)\n\n  // Temporary arrays as don't know output length yet\n  const lineTmp1 = new Array(n)\n  const lineTmp2 = new Array(n)\n  const sectorTmp = new Array(n)\n  const planeTmp = new Array(n)\n\n  // Eventual sizes of output arrays\n  let totalLines = 0\n  let totalSegments = 0\n  let totalPlanes = 0\n\n  const p1 = v3new()\n  const p2 = v3new()\n  const p3 = v3new()\n  const p4 = v3new()\n\n  const v21 = v3new()\n  const v23 = v3new()\n  const v34 = v3new()\n\n  const tmp = v3new()\n  const mid = v3new()\n  const inPlane1 = v3new()\n  const inPlane2 = v3new()\n  const start = v3new()\n  const end = v3new()\n\n  const cross = v3new()\n  const arcPoint = v3new()\n\n  let i = 0 // Actual output index (after skipping inappropriate)\n\n  for (var p = 0; p < nPos; p += 12) {\n    // Set Positions\n    v3fromArray(p1, position, p)\n    v3fromArray(p2, position, p + 3)\n    v3fromArray(p3, position, p + 6)\n    v3fromArray(p4, position, p + 9)\n\n    // Vectors between points\n    v3sub(v21, p1, p2)\n    v3sub(v23, p3, p2)\n    if (v3length(v23) === 0.0) {\n      continue // Can't define axis\n    }\n\n    v3sub(v34, p4, p3)\n\n    v3multiplyScalar(tmp, v23, 0.5)\n    v3add(mid, p2, tmp)\n\n    v3normalize(v21, v21)\n    v3normalize(v23, v23)\n    v3normalize(v34, v34)\n\n    // Which side of plane are p1, p4 (are we measuring something that\n    // looks more like an improper? e.g. C, CA, CB, N)\n    v3sub(tmp, p1, mid)\n    const improperStart = v3dot(tmp, v23) > 0.0\n    v3sub(tmp, p4, mid)\n    const improperEnd = v3dot(tmp, v23) < 0.0\n\n    // Calculate vectors perp to v23 (lying in plane (1,2,3) and (2,3,4))\n    v3multiplyScalar(tmp, v23, v3dot(v23, v21))\n    v3sub(inPlane1, v21, tmp)\n\n    v3multiplyScalar(tmp, v23, v3dot(v23, v34))\n    v3sub(inPlane2, v34, tmp)\n\n    if (v3length(inPlane1) === 0.0 || v3length(inPlane2) === 0.0) {\n      continue // Indeterminate angle\n    }\n\n    v3normalize(inPlane1, inPlane1)\n    v3normalize(inPlane2, inPlane2)\n\n    const angle = angles[ i ] = v3angle(inPlane1, inPlane2)\n    labelText[ i ] = (RAD2DEG * angle).toFixed(1) + String.fromCharCode(0x00B0)\n\n    v3cross(cross, inPlane1, v23)\n    v3normalize(cross, cross)\n    if (v3dot(cross, inPlane2) < 0.0) {\n      v3negate(cross, cross) // Ensure cp faces correct way\n    }\n\n    calcArcPoint(tmp, mid, inPlane1, cross, angle / 2.0)\n    v3toArray(tmp, labelPosition, 3 * i)\n\n    const nSegments = Math.ceil(angle / angleStep)\n    // For extended display mode, 4 straight lines plus arc/segment edge\n    // For non-extended, 2 straight lines plus segment edge\n    const nLines = nSegments + ((params.extendLine) ? 4 : 2)\n\n    // Don't draw planes if not extending lines\n    const nPlanes = params.extendLine ? 36 : 0\n\n    const line1 = new Float32Array(nLines * 3)\n    const line2 = new Float32Array(nLines * 3)\n    const sector = new Float32Array(nSegments * 9)\n    // 2 planes, 2 triangles each per dihedral (2*2*9)\n    const plane = new Float32Array(nPlanes)\n\n    lineTmp1[ i ] = line1\n    lineTmp2[ i ] = line2\n    sectorTmp[ i ] = sector\n    planeTmp[ i ] = plane\n\n    // Start points for lines/planes, only required\n    // if extending lines\n    if (params.extendLine) {\n      if (improperStart) { // We'll start on the v3->1 line (tmp)\n        v3sub(tmp, p1, p3)\n        v3normalize(tmp, tmp)\n        v3multiplyScalar(start, tmp, 1.0 / v3dot(inPlane1, tmp))\n        v3add(start, start, p3)\n      } else { // start on the 2->1 line\n        v3multiplyScalar(start, v21, 1.0 / v3dot(inPlane1, v21))\n        v3add(start, start, p2)\n      }\n\n      if (improperEnd) { // Finish on 2->4 line\n        v3sub(tmp, p4, p2)\n        v3normalize(tmp, tmp)\n        v3multiplyScalar(end, tmp, 1.0 / v3dot(inPlane2, tmp))\n        v3add(end, end, p2)\n      } else { // end on the 3->4 line\n        v3multiplyScalar(end, v34, 1.0 / v3dot(inPlane2, v34))\n        v3add(end, end, p3)\n      }\n    }\n\n    v3add(arcPoint, mid, inPlane1)\n\n    // index into line1, line2\n    let li = 0\n    // If extending lines, there's a bit of stuff to do here\n    // figuring out start and end positions\n    if (params.extendLine) {\n      v3toArray(p1, line1, li)\n      v3toArray(start, line2, li)\n      li += 3\n      v3toArray(start, line1, li)\n      v3toArray(arcPoint, line2, li)\n      li += 3\n\n      // Construct plane at start, if not extening lines\n      // this is skipped\n      v3toArray(start, plane, 0)\n      v3toArray(arcPoint, plane, 3)\n      v3toArray(improperStart ? p3 : p2, plane, 6)\n      v3toArray(improperStart ? p3 : p2, plane, 9)\n      v3toArray(arcPoint, plane, 12)\n      v3toArray(mid, plane, 15)\n    } else {\n      // Not extending lines\n      v3toArray(mid, line1, li)\n      v3toArray(arcPoint, line2, li)\n      li += 3\n    }\n\n    const appendArcSection = function (a: number, j: number) {\n      const si = j * 9\n\n      v3toArray(mid, sector, si)\n      v3toArray(arcPoint, sector, si + 3)\n      v3toArray(arcPoint, line1, li)\n\n      calcArcPoint(arcPoint, mid, inPlane1, cross, a)\n\n      v3toArray(arcPoint, sector, si + 6)\n      v3toArray(arcPoint, line2, li)\n      li += 3\n    }\n\n    let j = 0\n    for (let a = angleStep; a < angle; a += angleStep) {\n      appendArcSection(a, j++)\n    }\n    appendArcSection(angle, j++)\n\n    if (params.extendLine) {\n      v3toArray(arcPoint, line1, (nLines - 2) * 3)\n      v3toArray(end, line2, (nLines - 2) * 3)\n      v3toArray(end, line1, (nLines - 1) * 3)\n      v3toArray(p4, line2, (nLines - 1) * 3)\n\n      // Construct plane at end\n      v3toArray(end, plane, 18)\n      v3toArray(arcPoint, plane, 21)\n      v3toArray(improperEnd ? p2 : p3, plane, 24)\n      v3toArray(improperEnd ? p2 : p3, plane, 27)\n      v3toArray(arcPoint, plane, 30)\n      v3toArray(mid, plane, 33)\n    } else {\n      v3toArray(arcPoint, line1, li)\n      v3toArray(mid, line2, li)\n      li += 3\n    }\n\n    totalLines += nLines * 3\n    totalSegments += nSegments * 9\n    totalPlanes += nPlanes\n    i += 1\n  }\n\n  const nSuccess = i\n\n  const linePosition1 = new Float32Array(totalLines)\n  const linePosition2 = new Float32Array(totalLines)\n  const sectorPosition = new Float32Array(totalSegments)\n  const planePosition = new Float32Array(totalPlanes)\n\n  let lineOffset = 0\n  let sectorOffset = 0\n  let planeOffset = 0\n\n  for (let i = 0; i < nSuccess; i++) {\n    const lp1 = lineTmp1[ i ]\n    const lp2 = lineTmp2[ i ]\n    const sp = sectorTmp[ i ]\n    const pp = planeTmp[ i ]\n\n    copyArray(lp1, linePosition1, 0, lineOffset, lp1.length)\n    copyArray(lp2, linePosition2, 0, lineOffset, lp2.length)\n    copyArray(sp, sectorPosition, 0, sectorOffset, sp.length)\n    copyArray(pp, planePosition, 0, planeOffset, pp.length)\n\n    lineOffset += lp1.length\n    sectorOffset += sp.length\n    planeOffset += pp.length\n  }\n\n  return {\n    labelPosition: labelPosition.subarray(0, nSuccess * 3),\n    labelText: labelText.slice(0, nSuccess),\n    linePosition1,\n    linePosition2,\n    planePosition,\n    sectorPosition\n  }\n}\n\nRepresentationRegistry.add('dihedral', DihedralRepresentation)\n\nexport default DihedralRepresentation\n","/**\n * @file Dihedral Histogram Representation\n * @author Rudolfs Petrovs <rudolfs.petrovs@astx.com>\n * @private\n */\nimport { Color } from 'three'\n\nimport { calcArcPoint, parseNestedAtoms } from './measurement-representation'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\n\nimport { RepresentationRegistry } from '../globals'\nimport { Structure } from '../ngl'\nimport { defaults } from '../utils'\n\nimport { BufferData } from '../buffer/buffer'\nimport MeshBuffer from '../buffer/mesh-buffer'\nimport WideLineBuffer, { WideLineBufferData } from '../buffer/wideline-buffer'\n\nimport { copyArray, uniformArray3, arraySum } from '../math/array-utils'\nimport {\n  v3add, v3cross, v3dot, v3multiplyScalar, v3fromArray,\n  v3negate, v3new, v3normalize, v3sub, v3toArray, v3length\n} from '../math/vector-utils'\n\nimport StructureView from '../structure/structure-view'\n\nimport Viewer from '../viewer/viewer'\n\n\nconst pointLength = 3 // One Point Length (number of coordinates of one point in 3D)\nconst pointsInTriangle = 3\n\ntype ColorDefinition = Color | string | number | undefined\n\ninterface HistogramColorParameters {\n  histogramBinBorderColor: ColorDefinition\n  adjacentBondArrowColor: ColorDefinition\n  distantBondArrowColor: ColorDefinition\n  frontHistogramColor: ColorDefinition\n  backHistogramColor: ColorDefinition\n  opaqueMiddleDiscColor: ColorDefinition\n}\n\ninterface HistogramInputData extends Partial<HistogramColorParameters> {\n  atomQuad: (number | string)[]\n  histogram360: number[]\n}\n\ninterface HistogramData extends HistogramInputData {\n  atomPositions: Float32Array\n  histogram360Scaled: number[]\n}\n\ninterface WideLineData {\n  startPoints: Float32Array\n  endPoints: Float32Array\n  startColors: Float32Array\n  endColors: Float32Array\n}\n\ninterface MeshData {\n  triangles: Float32Array\n  triangleColors: Float32Array\n}\n\nfunction createUpdatedObject(o: Object, updateSource: Object) {\n  function hasKey<O>(obj: O, key: keyof any): key is keyof O {\n    return key in obj\n  }\n\n  const result = { ...o } // Shallow copy\n  for (const key in result) {\n    if (hasKey(result, key) && hasKey(updateSource, key)) {\n      result[key] = defaults(updateSource[key], result[key])\n    }\n  }\n  return result\n}\n\nfunction createColorArray(color: ColorDefinition, arrayLength: number) {\n  const colorValue = new Color(color)\n  const targetArray = new Float32Array(arrayLength * 3)\n  uniformArray3(arrayLength, colorValue.r, colorValue.g, colorValue.b, targetArray)\n  return targetArray\n}\n\n/**\n * @typedef {Object} DihedralHistogramRepresentationParameters - dihedral representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n *\n * @property {HistogramInputData[]} histogramsData\n * List of HistogramInputData objects, which properties specifies each particular\n * histogram, and can contain particular histogram-specific parameters.\n * Obligatory properties are:\n * atomQuad - Quadruplet of selection strings or atom indices\n * histogram360 - List of values, representing histogram from 0 to 360 degrees.\n * @property {Boolean} histogramBinBorderVisible - Display the lines that separate circular histogram bins\n * @property {Boolean} scaleBinToSectorArea - Should sector-based histogram bins'\n * area be proportional to the bins' value\n */\n\nexport interface DihedralHistogramRepresentationParameters extends StructureRepresentationParameters {\n  histogramsData: HistogramInputData[]\n\n  histogramBinBorderVisible: boolean\n  scaleBinToSectorArea: boolean\n}\n\n/**\n * Dihedral Histogram representation object\n *\n * Reperesentation consists of several parts:\n * opaqueMiddleDisc - opaque disc in the middle of the dihedral between front and back histograms\n * frontHistogram - circular histogram from the adjacent bond viewpoint\n * backHistogram - circular histogram from the distant bond viewpoint\n * histogramBinBorder - lines, which separate histogram bins\n * bondArrows - lines, which show the actual angle on the histogram disc\n *\n * @param {Structure} structure - the structure to measure angles in\n * @param {Viewer} viewer - a viewer object\n * @param {DihedralHistogramRepresentationParameters} params - Dihedral histogram representation parameters\n */\nclass DihedralHistogramRepresentation extends StructureRepresentation {\n  protected histogramsData: HistogramData[]\n\n  protected histogramBinBorderVisible: boolean\n  protected histogramBinBorderWidth: number\n  protected histogramBinBorderColor: ColorDefinition\n  protected histogramBinBorderOpacity: number\n\n  protected bondArrowVisible: boolean\n  protected bondArrowWidth: number\n  protected bondArrowOpacity: number\n\n  protected adjacentBondArrowColor: ColorDefinition\n  protected distantBondArrowColor: ColorDefinition\n\n  protected histogramOpacity: number\n  protected frontHistogramColor: ColorDefinition\n  protected backHistogramColor: ColorDefinition\n\n  protected opaqueMiddleDiscVisible: boolean\n  protected opaqueMiddleDiscColor: ColorDefinition\n  protected opaqueMiddleDiscOpacity: number\n\n  protected scaleBinToSectorArea: boolean\n\n  constructor(structure: Structure, viewer: Viewer, params: DihedralHistogramRepresentationParameters) {\n    super(structure, viewer, params)\n\n    this.type = 'dihedral-histogram'\n\n    this.parameters = Object.assign({\n      histogramsData: {\n        type: 'hidden', rebuild: true\n      },\n      histogramBinBorderVisible: {\n        type: 'boolean', default: true\n      },\n      scaleBinToSectorArea: {\n        type: 'boolean',\n        rebuild: true,\n        default: false\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init(params: Partial<DihedralHistogramRepresentationParameters>) {\n    const p = params || {}\n\n    const defaultColorData = {\n      histogramBinBorderColor: 'grey',\n      adjacentBondArrowColor: 'black',\n      distantBondArrowColor: 'magenta',\n      frontHistogramColor: 'green',\n      backHistogramColor: 'blue',\n      opaqueMiddleDiscColor: 'white'\n    }\n\n    const colorData = createUpdatedObject(defaultColorData, p)\n    Object.assign(this, colorData)\n\n    const defaultParameters = {\n      histogramsData: [],\n      histogramOpacity: 1.0,\n\n      opaqueMiddleDiscVisible: true,\n      opaqueMiddleDiscOpacity: 1.0,\n\n      histogramBinBorderVisible: true,\n      histogramBinBorderWidth: 1,\n      histogramBinBorderOpacity: 0.5,\n\n      bondArrowVisible: true,\n      bondArrowWidth: 2,\n      bondArrowOpacity: 1.0,\n\n      scaleBinToSectorArea: false,\n    }\n    const parameters = createUpdatedObject(defaultParameters, p)\n    Object.assign(this, parameters)\n\n    this.histogramsData.forEach(x => {\n      const specificColorData = createUpdatedObject(colorData, x)\n      Object.assign(x, specificColorData)\n    })\n\n    p.side = defaults(p.side, 'double')\n    p.opacity = defaults(p.opacity, 0.5)\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.15)\n\n    super.init(p)\n  }\n\n  getHistogramBinBorderBufferParameters() {\n    return this.getBufferParams({\n      linewidth: this.histogramBinBorderWidth,\n      visible: this.histogramBinBorderVisible,\n      opacity: this.histogramBinBorderOpacity,\n    })\n  }\n\n  getBondArrowsBufferParameters() {\n    return this.getBufferParams({\n      linewidth: this.bondArrowWidth,\n      visible: this.bondArrowVisible,\n      opacity: this.bondArrowOpacity,\n    })\n  }\n\n  getOpaqueMiddleDiscBufferParameters() {\n    return this.getBufferParams({\n      visible: this.opaqueMiddleDiscVisible,\n      opacity: this.opaqueMiddleDiscOpacity\n    })\n  }\n\n  getHistogramBufferParameters() {\n    return this.getBufferParams({\n      visible: true,\n      opacity: this.histogramOpacity,\n      side: \"double\"\n    })\n  }\n\n  createData(sview: StructureView) {\n    if (!sview.atomCount || !this.histogramsData.length) return\n    this.histogramsData.forEach(x => x.atomPositions = parseNestedAtoms(sview, [x.atomQuad]))\n    const scaleData = this.scaleBinToSectorArea ? function (y: number) { return Math.sqrt(y) } : function (y: number) { return y }\n    this.histogramsData.forEach(x => x.histogram360Scaled = x.histogram360.map(scaleData))\n    function Float32Concat(arrays: Float32Array[]) {\n      const lengths = arrays.map(x => x.length)\n      const result = new Float32Array(arraySum(lengths))\n      let accumulatedOffset = 0\n      for (let i = 0; i < arrays.length; i++) {\n        result.set(arrays[i], accumulatedOffset)\n        accumulatedOffset += arrays[i].length\n      }\n      return result\n    }\n\n    function createWideLineBuffer(linesList: WideLineData[], params: {}) {\n      return new WideLineBuffer(\n        {\n          position1: Float32Concat(linesList.map(x => x.startPoints)),\n          position2: Float32Concat(linesList.map(x => x.endPoints)),\n          color: Float32Concat(linesList.map(x => x.startColors)),\n          color2: Float32Concat(linesList.map(x => x.endColors)),\n        } as WideLineBufferData,\n        params)\n    }\n\n    function createMeshBuffer(mesh: MeshData[], params: {}) {\n      return new MeshBuffer(\n        {\n          position: Float32Concat(mesh.map(x => x.triangles)),\n          color: Float32Concat(mesh.map(x => x.triangleColors))\n        } as BufferData,\n        params)\n    }\n\n    const dihedralDataArray = []\n\n    for (let i = 0; i < this.histogramsData.length; i++) {\n      let dihedralData = undefined\n      let currentHistogramData = this.histogramsData[i]\n      let currentHistogram360 = currentHistogramData.histogram360\n      if (currentHistogram360.length >= 3) {\n        dihedralData = calculateDihedralHistogram(currentHistogramData)\n      }\n      if (typeof dihedralData === \"undefined\") continue\n      dihedralDataArray.push(dihedralData)\n    }\n\n    this.frontHistogramBinBordersBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.frontHistogramBinBorders),\n      this.getHistogramBinBorderBufferParameters()\n    )\n\n    this.backHistogramBinBordersBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.backHistogramBinBorders),\n      this.getHistogramBinBorderBufferParameters()\n    )\n\n    this.adjacentBondArrowsBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.adjacentBondArrows),\n      this.getBondArrowsBufferParameters()\n    )\n\n    this.distantBondArrowsBuffer = createWideLineBuffer(\n      dihedralDataArray.map(x => x.distantBondArrows),\n      this.getBondArrowsBufferParameters()\n    )\n\n    this.opaqueMiddleDiscBuffer = createMeshBuffer(\n      dihedralDataArray.map(x => x.opaqueMiddleDisc),\n      this.getOpaqueMiddleDiscBufferParameters()\n    )\n\n    this.frontHistogramBuffer = createMeshBuffer(\n      dihedralDataArray.map(x => x.frontHistogram),\n      this.getHistogramBufferParameters()\n    )\n\n    this.backHistogramBuffer = createMeshBuffer(\n      dihedralDataArray.map(x => x.backHistogram),\n      this.getHistogramBufferParameters()\n    )\n\n    return {\n      bufferList: [].concat(\n        this.frontHistogramBinBordersBuffer,\n        this.backHistogramBinBordersBuffer,\n        this.adjacentBondArrowsBuffer,\n        this.distantBondArrowsBuffer,\n        this.opaqueMiddleDiscBuffer,\n        this.frontHistogramBuffer,\n        this.backHistogramBuffer\n      )\n    }\n  }\n\n  setParameters(params: Partial<DihedralHistogramRepresentationParameters>) {\n    const rebuild = false\n    const what = {}\n    super.setParameters(params, what, rebuild)\n\n    if (params && (params.histogramBinBorderVisible !== undefined)) {\n      this.setVisibility(this.visible)\n    }\n    return this\n  }\n\n  setVisibility(value: boolean, noRenderRequest?: boolean) {\n    super.setVisibility(value, true)\n    if (this.frontHistogramBinBordersBuffer) {\n      this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible)\n    }\n    if (this.backHistogramBinBordersBuffer) {\n      this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible)\n    }\n    if (!noRenderRequest) this.viewer.requestRender()\n    return this\n  }\n}\n\n/**\n * Calculates the data required to create {Buffer} objects for one histogram, given positions\n * @param  Float32Array positionOfDihedralAtoms 3*4 array of coordinates\n * @param  NumberArray histogram array of coordinates\n * @return Arrays for building buffers\n */\nfunction calculateDihedralHistogram(histogramData: HistogramData) {\n  const positionOfDihedralAtoms = histogramData.atomPositions\n  const histogram = histogramData.histogram360Scaled;\n  const totalSectorTrianglesInOpaqueMiddleDisc = histogram.length <= 180 ? 360 : histogram.length * 2\n  const frontAndBack = 2\n\n  const opaqueMiddleDisc = {\n    triangles: new Float32Array(totalSectorTrianglesInOpaqueMiddleDisc * pointsInTriangle * pointLength),\n    triangleColors: createColorArray(histogramData.opaqueMiddleDiscColor, totalSectorTrianglesInOpaqueMiddleDisc * pointsInTriangle)\n  }\n\n  const frontHistogram = {\n    triangles: new Float32Array(histogram.length * pointsInTriangle * pointLength),\n    triangleColors: createColorArray(histogramData.frontHistogramColor, histogram.length * pointsInTriangle)\n  }\n\n  const backHistogram = {\n    triangles: new Float32Array(histogram.length * pointsInTriangle * pointLength),\n    triangleColors: createColorArray(histogramData.backHistogramColor, histogram.length * pointsInTriangle)\n  }\n\n  const frontHistogramBinBorders = {\n    startPoints: new Float32Array(histogram.length * pointLength),\n    endPoints: new Float32Array(histogram.length * pointLength),\n    startColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length),\n    endColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length)\n  }\n\n  const backHistogramBinBorders = {\n    startPoints: new Float32Array(histogram.length * pointLength),\n    endPoints: new Float32Array(histogram.length * pointLength),\n    startColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length),\n    endColors: createColorArray(histogramData.histogramBinBorderColor, histogram.length)\n  }\n\n  const adjacentBondArrows = {\n    startPoints: new Float32Array(frontAndBack * pointLength),\n    endPoints: new Float32Array(frontAndBack * pointLength),\n    startColors: createColorArray(histogramData.adjacentBondArrowColor, histogram.length),\n    endColors: createColorArray(histogramData.adjacentBondArrowColor, histogram.length)\n  }\n  const distantBondArrows = {\n    startPoints: new Float32Array(frontAndBack * pointLength),\n    endPoints: new Float32Array(frontAndBack * pointLength),\n    startColors: createColorArray(histogramData.distantBondArrowColor, histogram.length),\n    endColors: createColorArray(histogramData.distantBondArrowColor, histogram.length)\n  }\n\n  const p1 = v3new()\n  const p2 = v3new()\n  const p3 = v3new()\n  const p4 = v3new()\n\n  const v21 = v3new()\n  const v23 = v3new()\n  const v32 = v3new()\n  const v34 = v3new()\n\n  const mid = v3new()\n  const inPlane1 = v3new()\n  const inPlane2 = v3new()\n\n  const cross1 = v3new()\n  const cross2 = v3new()\n\n  const arcPoint = v3new()\n  const tmp = v3new()\n  const tmp2 = v3new()\n\n  // Set Atom Coordinates\n  const dihedralAtomVectors = [p1, p2, p3, p4]\n\n  for (let i = 0; i < dihedralAtomVectors.length; i++) {\n    v3fromArray(dihedralAtomVectors[i], positionOfDihedralAtoms, i * pointLength)\n  }\n\n  // Vectors between points\n  v3sub(v21, p1, p2)\n  v3sub(v23, p3, p2)\n  v3sub(v34, p4, p3)\n  if (v3length(v23) === 0.0) {\n    return // Can't define axis\n  }\n\n  v3multiplyScalar(tmp, v23, 0.5)\n  v3add(mid, p2, tmp)\n\n  v3normalize(v21, v21)\n  v3normalize(v23, v23)\n  v3normalize(v34, v34)\n\n  v3negate(v32, v23)\n  // Calculate vectors perp to v23 (lying in plane (1,2,3) and (2,3,4))\n  v3multiplyScalar(tmp, v32, v3dot(v32, v21))\n  v3sub(inPlane1, v21, tmp)\n\n  v3multiplyScalar(tmp, v23, v3dot(v23, v34))\n  v3sub(inPlane2, v34, tmp)\n\n  if (v3length(inPlane1) === 0.0 || v3length(inPlane2) === 0.0) {\n    return // Indeterminate angle\n  }\n\n  v3normalize(inPlane1, inPlane1)\n  v3normalize(inPlane2, inPlane2)\n\n  // Can use acos as normalized and non-zero\n  const absAngle = Math.acos(v3dot(inPlane1, inPlane2))\n\n  v3cross(cross1, v32, inPlane1)\n  v3cross(cross2, v23, inPlane2)\n  v3normalize(cross1, cross1)\n  v3normalize(cross2, cross2)\n\n  let angle = absAngle\n  if (v3dot(cross1, inPlane2) < 0.0) {\n    angle = -absAngle\n  }\n\n  v3add(arcPoint, mid, inPlane1)\n\n  // Calculate necessary constants\n  const maxHist = Math.max.apply(null, histogram)\n  const histBinAngleStep = (Math.PI * 2) / histogram.length\n\n  function setHistogramBinCoordinates(out: Float32Array, ind: number, zeroDegreeVector: Float32Array, crossVector: Float32Array, histBinAngleStep: number) {\n    const startOffset = ind * pointsInTriangle * pointLength\n    v3toArray(mid, out, startOffset)\n    const scalingFactor = Number(histogram[ind]) / maxHist\n    v3multiplyScalar(tmp, zeroDegreeVector, scalingFactor)\n    v3multiplyScalar(tmp2, crossVector, scalingFactor)\n    calcArcPoint(arcPoint, mid, tmp, tmp2, ind * histBinAngleStep)\n    v3toArray(arcPoint, out, startOffset + 1 * pointLength)\n    calcArcPoint(arcPoint, mid, tmp, tmp2, (ind + 1) * histBinAngleStep)\n    v3toArray(arcPoint, out, startOffset + 2 * pointLength)\n  }\n\n  function setOneSideHistogram(discHistogram: MeshData, binBorders: { startPoints: Float32Array, endPoints: Float32Array }, ind: number, zeroDegreeVector: Float32Array, crossVector: Float32Array) {\n    // Set Bond Arrows\n\n    copyArray(mid, adjacentBondArrows.startPoints, 0, ind * pointLength, mid.length)\n    calcArcPoint(tmp, mid, zeroDegreeVector, crossVector, 0 + histBinAngleStep * 0)\n    copyArray(tmp, adjacentBondArrows.endPoints, 0, ind * pointLength, mid.length)\n\n    copyArray(mid, distantBondArrows.startPoints, 0, ind * pointLength, mid.length)\n    calcArcPoint(tmp, mid, zeroDegreeVector, crossVector, angle)\n    copyArray(tmp, distantBondArrows.endPoints, 0, ind * pointLength, mid.length)\n\n    // Set Histogram Bin Borders\n\n    for (let i = 0; i < histogram.length; i++) {\n      copyArray(mid, binBorders.startPoints, 0, i * 3, mid.length)\n      calcArcPoint(tmp, mid, zeroDegreeVector, crossVector, 0 + histBinAngleStep * i)\n      copyArray(tmp, binBorders.endPoints, 0, i * 3, tmp.length)\n    }\n\n    // Set Histogram Bins\n\n    for (let sectionIndex = 0; sectionIndex < histogram.length; sectionIndex++) {\n      setHistogramBinCoordinates(discHistogram.triangles, sectionIndex, zeroDegreeVector, crossVector, histBinAngleStep)\n    }\n  }\n\n  // Opaque disc\n  const opaqueCircleSectorAngleStep = Math.PI * 2 / totalSectorTrianglesInOpaqueMiddleDisc\n\n  for (let sectionIndex = 0; sectionIndex < totalSectorTrianglesInOpaqueMiddleDisc; sectionIndex++) {\n    const startOffset = sectionIndex * pointsInTriangle * pointLength\n    v3toArray(mid, opaqueMiddleDisc.triangles, startOffset)\n    calcArcPoint(arcPoint, mid, inPlane1, cross1, sectionIndex * opaqueCircleSectorAngleStep)\n    v3toArray(arcPoint, opaqueMiddleDisc.triangles, startOffset + 1 * pointLength)\n    calcArcPoint(arcPoint, mid, inPlane1, cross1, (sectionIndex + 1) * opaqueCircleSectorAngleStep)\n    v3toArray(arcPoint, opaqueMiddleDisc.triangles, startOffset + 2 * pointLength)\n  }\n\n  // Front Histogram\n  const distanceToOpaqueDisc = 0.01\n  v3multiplyScalar(tmp, v23, -distanceToOpaqueDisc) // Get a vector to move \"mid\" just a bit from opaque disc\n  v3add(mid, mid, tmp)\n  setOneSideHistogram(frontHistogram, frontHistogramBinBorders, 0, inPlane1, cross1)\n\n  // Back Histogram\n  v3multiplyScalar(tmp, v23, 2 * distanceToOpaqueDisc) // Get a vector to move \"mid\" back and plus just a bit from opaque disc the other way\n  v3add(mid, mid, tmp)\n  setOneSideHistogram(backHistogram, backHistogramBinBorders, 1, inPlane2, cross2)\n\n  return {\n    opaqueMiddleDisc,\n    frontHistogram,\n    backHistogram,\n    frontHistogramBinBorders,\n    backHistogramBinBorders,\n    adjacentBondArrows,\n    distantBondArrows\n  }\n}\n\nRepresentationRegistry.add('dihedral-histogram', DihedralHistogramRepresentation)\n\nexport default DihedralHistogramRepresentation\n","/**\n * @file Distance Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport { Color } from 'three'\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { DistancePicker } from '../utils/picker'\nimport { uniformArray, uniformArray3 } from '../math/array-utils'\nimport BitArray from '../utils/bitarray'\nimport MeasurementRepresentation, { MeasurementRepresentationParameters } from './measurement-representation'\nimport Selection from '../selection/selection'\nimport BondStore from '../store/bond-store'\nimport TextBuffer, { TextBufferData, TextBufferParameters } from '../buffer/text-buffer'\nimport WideLineBuffer from '../buffer/wideline-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport { getFixedLengthDashData } from '../geometry/dash'\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport { BondDataFields, BondDataParams, BondData } from '../structure/structure-data';\nimport { StructureRepresentationData } from './structure-representation';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\n\n/**\n * Distance representation parameter object.\n * @typedef {Object} DistanceRepresentationParameters - distance representation parameters\n * @mixes RepresentationParameters\n * @mixes StructureRepresentationParameters\n * @mixes MeasurementRepresentationParameters\n *\n * @property {String} labelUnit - distance unit (e.g. \"angstrom\" or \"nm\"). If set, a distance\n *                                symbol is appended to the label (i.e. 'nm' or '\\u00C5'). In case of 'nm', the\n *                                distance value is computed in nanometers instead of Angstroms.\n * @property {Array[]} atomPair - list of pairs of selection strings (see {@link Selection})\n *                                or pairs of atom indices. Using atom indices is much more\n *                                efficient when the representation is updated often, e.g. by\n *                                changing the selection or the atom positions, as there\n *                                are no selection strings to be evaluated.\n */\nexport interface DistanceRepresentationParameters extends MeasurementRepresentationParameters {\n  labelUnit: string\n  atomPair: AtomPair\n  useCylinder: boolean\n}\nexport type AtomPair = (number|string)[][]\n/**\n * Distance representation\n */\nclass DistanceRepresentation extends MeasurementRepresentation {\n  protected labelUnit: string\n  protected atomPair: AtomPair\n  protected useCylinder: boolean\n  protected distanceBuffer: WideLineBuffer|CylinderGeometryBuffer\n  /**\n   * Create Distance representation object\n   * @example\n   * stage.loadFile( \"rcsb://1crn\" ).then( function( o ){\n   *     o.addRepresentation( \"cartoon\" );\n   *     // either give selections (uses first selected atom) ...\n   *     var atomPair = [ [ \"1.CA\", \"4.CA\" ], [ \"7.CA\", \"13.CA\" ] ];\n   *     // or atom indices\n   *     var atomPair = [ [ 8, 28 ], [ 173, 121 ] ];\n   *     o.addRepresentation( \"distance\", { atomPair: atomPair } );\n   *     stage.autoView();\n   * } );\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {DistanceRepresentationParameters} params - distance representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<DistanceRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'distance'\n\n    this.parameters = Object.assign({\n      radialSegments: true,\n      openEnded: true,\n      disableImpostor: true,\n      labelUnit: {\n        type: 'select',\n        rebuild: true,\n        options: { '': '', angstrom: 'angstrom', nm: 'nm' }\n      },\n      useCylinder: {\n        type: 'boolean', rebuild: true\n      },\n      atomPair: {\n        type: 'hidden', rebuild: true\n      }\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<DistanceRepresentationParameters>) {\n    const p = params || {}\n    p.linewidth = defaults(p.linewidth, 5.0)\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.2)\n\n    this.labelUnit = defaults(p.labelUnit, '')\n    this.useCylinder = defaults(p.useCylinder, false)\n    this.atomPair = defaults(p.atomPair, [])\n\n    super.init(p)\n  }\n\n  getDistanceData (sview: StructureView, atomPair: AtomPair) {\n    let n = atomPair.length\n    const text = new Array(n)\n    let position = new Float32Array(n * 3)\n    const sele1 = new Selection()\n    const sele2 = new Selection()\n\n    const bondStore = new BondStore()\n\n    const ap1 = sview.getAtomProxy()\n    const ap2 = sview.getAtomProxy()\n\n    let j = 0 // Skipped pairs\n    const selected = sview.getAtomSet()\n\n    atomPair.forEach((pair, i) => {\n      let v1 = pair[ 0 ]\n      let v2 = pair[ 1 ]\n\n      if (typeof(v1) === 'number' && Number.isInteger(v1) && typeof(v2) === 'number' && Number.isInteger(v2)) {\n        if (selected.get(v1) && selected.get(v2)) {\n          ap1.index = v1\n          ap2.index = v2\n        } else {\n          j += 1\n          return\n        }\n      } else {\n        sele1.setString(v1 as string)\n        sele2.setString(v2 as string)\n\n        var atomIndices1 = sview.getAtomIndices(sele1)\n        var atomIndices2 = sview.getAtomIndices(sele2)\n\n        if (atomIndices1!.length && atomIndices2!.length) {\n          ap1.index = atomIndices1![ 0 ]\n          ap2.index = atomIndices2![ 0 ]\n        } else {\n          j += 1\n          return\n        }\n      }\n\n      bondStore.addBond(ap1, ap2, 1)\n\n      i -= j\n      var d = ap1.distanceTo(ap2)\n      switch (this.labelUnit) {\n        case 'angstrom':\n          text[ i ] = d.toFixed(2) + ' ' + String.fromCharCode(0x212B)\n          break\n        case 'nm':\n          text[ i ] = (d / 10).toFixed(2) + ' nm'\n          break\n        default:\n          text[ i ] = d.toFixed(2)\n          break\n      }\n\n      var i3 = i * 3\n      position[ i3 + 0 ] = (ap1.x + ap2.x) / 2\n      position[ i3 + 1 ] = (ap1.y + ap2.y) / 2\n      position[ i3 + 2 ] = (ap1.z + ap2.z) / 2\n    })\n\n    if (j > 0) {\n      n -= j\n      position = position.subarray(0, n * 3)\n    }\n\n    var bondSet = new BitArray(bondStore.count, true)\n\n    return {\n      text: text,\n      position: position,\n      bondSet: bondSet,\n      bondStore: bondStore\n    }\n  }\n\n  getBondData (sview: StructureView, what: BondDataFields, params: BondDataParams): BondData {\n    const bondData = sview.getBondData(this.getBondParams(what, params))\n    if (bondData.picking) {\n      bondData.picking = new DistancePicker(\n        bondData.picking.array,\n        bondData.picking.structure,\n        params.bondStore!\n      ) as any\n    }\n    return bondData\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.atomCount || !this.atomPair.length) return\n\n    const n = this.atomPair.length\n    const c = new Color(this.labelColor)\n    const distanceData = this.getDistanceData(sview, this.atomPair)\n\n    this.textBuffer = new TextBuffer({\n      position: distanceData.position,\n      size: uniformArray(n, this.labelSize),\n      color: uniformArray3(n, c.r, c.g, c.b),\n      text: distanceData.text\n    } as TextBufferData, this.getLabelBufferParams() as TextBufferParameters)\n\n    const bondParams = {\n      bondSet: distanceData.bondSet,\n      bondStore: distanceData.bondStore\n    }\n\n    const bondData = this.getBondData(\n      sview,\n      { position: true, color: true, picking: true, radius: this.useCylinder },\n      bondParams\n    )\n\n    if (this.useCylinder) {\n      this.distanceBuffer = new CylinderBuffer(\n        bondData as CylinderBufferData,\n        this.getBufferParams({\n          openEnded: this.openEnded,\n          radialSegments: this.radialSegments,\n          disableImpostor: this.disableImpostor,\n          dullInterior: true\n        }) \n      ) as CylinderGeometryBuffer\n    } else {\n      this.distanceBuffer = new WideLineBuffer(\n        getFixedLengthDashData(bondData as CylinderBufferData),\n        this.getBufferParams({\n          linewidth: this.linewidth,\n          visible: this.lineVisible,\n          opacity: this.lineOpacity\n        })\n      )\n    }\n\n    return {\n      bondSet: distanceData.bondSet,\n      bondStore: distanceData.bondStore,\n      position: distanceData.position,\n      bufferList: [ this.textBuffer, this.distanceBuffer ]\n    }\n  }\n\n  updateData (what: BondDataFields, data: StructureRepresentationData) {\n    super.updateData(what, data)\n\n    const bondParams = {\n      bondSet: data.bondSet,\n      bondStore: data.bondStore\n    }\n\n    const bondData = this.getBondData(data.sview as StructureView, what, bondParams)\n    const distanceData = {}\n\n    if (!what || what.color) {\n      Object.assign( distanceData, {\n        color: bondData.color,\n        color2: bondData.color2\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign( distanceData, {radius: bondData.radius})\n    }\n\n    (this.distanceBuffer as CylinderGeometryBuffer).setAttributes(distanceData)\n  }\n\n  setParameters (params: Partial<DistanceRepresentationParameters>) {\n    let rebuild = false\n    const what = {}\n\n    super.setParameters(params, what, rebuild)\n\n    if (!this.useCylinder) {\n      if (params && params.lineOpacity) {\n        (this.distanceBuffer as WideLineBuffer).setParameters({ opacity: params.lineOpacity })\n      }\n      if (params && params.opacity !== undefined) {\n        (this.distanceBuffer as WideLineBuffer).setParameters({ opacity: this.lineOpacity })\n      }\n      if (params && params.linewidth) {\n        (this.distanceBuffer as WideLineBuffer).setParameters({ linewidth: params.linewidth })\n      }\n    }\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('distance', DistanceRepresentation)\n\nexport default DistanceRepresentation\n","/**\n * @file Vector Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3, Matrix4 required for declaration only\nimport { Color, Matrix4, Vector3 } from 'three'\n\nimport '../shader/Line.vert'\nimport '../shader/Line.frag'\n\nimport { uniformArray3 } from '../math/array-utils'\nimport Buffer, { BufferDefaultParameters, BufferData } from './buffer'\n\nfunction getSize(data: BufferData){\n  const n = data.position!.length / 3\n  return n * 2 * 3\n}\n\nexport interface VectorBufferData extends BufferData {\n  vector: Float32Array\n}\n\nexport const VectorBufferDefaultParameters = Object.assign({\n  scale: 1,\n  color: 'grey'\n}, BufferDefaultParameters)\nexport type VectorBufferParameters = typeof VectorBufferDefaultParameters\n\n/**\n * Vector buffer. Draws vectors as lines.\n */\nclass VectorBuffer extends Buffer {\n  get defaultParameters() { return VectorBufferDefaultParameters }\n  parameters: VectorBufferParameters\n\n  isLine = true\n  vertexShader = 'Line.vert'\n  fragmentShader = 'Line.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.vector - vectors\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: VectorBufferData, params: Partial<VectorBufferParameters> = {}) {\n    super({\n      position: new Float32Array(getSize(data)),\n      color: new Float32Array(getSize(data))\n    }, params)\n\n    const color = new Color(this.parameters.color)\n    const attributes = this.geometry.attributes as any  // TODO\n    uniformArray3(getSize(data) / 3, color.r, color.g, color.b, attributes.color.array)\n\n    this.setAttributes(data)\n  }\n\n  setAttributes (data: Partial<VectorBufferData> = {}) {\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let position, vector\n    let aPosition\n\n    if (data.position && data.vector) {\n      position = data.position\n      vector = data.vector\n      aPosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    const n = this.size / 2\n    const scale = this.parameters.scale\n\n    if (position && vector) {\n      for (let v = 0; v < n; v++) {\n        const i = v * 2 * 3\n        const j = v * 3\n\n        aPosition[ i + 0 ] = position[ j + 0 ]\n        aPosition[ i + 1 ] = position[ j + 1 ]\n        aPosition[ i + 2 ] = position[ j + 2 ]\n        aPosition[ i + 3 ] = position[ j + 0 ] + vector[ j + 0 ] * scale\n        aPosition[ i + 4 ] = position[ j + 1 ] + vector[ j + 1 ] * scale\n        aPosition[ i + 5 ] = position[ j + 2 ] + vector[ j + 2 ] * scale\n      }\n    }\n  }\n}\n\nexport default VectorBuffer\n","/**\n * @file Helixorient Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Helixorient from '../geometry/helixorient'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferParameters } from '../buffer/sphere-buffer'\nimport VectorBuffer from '../buffer/vector-buffer'\nimport Viewer from '../viewer/viewer';\nimport { Structure } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport Polymer from '../proxy/polymer';\nimport { AtomDataFields } from '../structure/structure-data';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport SphereImpostorBuffer from '../buffer/sphereimpostor-buffer';\nimport { BufferData } from '../buffer/buffer';\n\n/**\n * Helixorient Representation\n */\nclass HelixorientRepresentation extends StructureRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'helixorient'\n\n    this.parameters = Object.assign({\n      sphereDetail: true,\n      disableImpostor: true\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'sstruc')\n    p.radiusType = defaults(p.radiusType, 'size')\n    p.radiusSize = defaults(p.radiusSize, 0.15)\n    p.radiusScale = defaults(p.radiusScale, 1.0)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    const bufferList: (SphereBuffer|VectorBuffer)[] = []\n    const polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      const helixorient = new Helixorient(polymer)\n      const position = helixorient.getPosition()\n      const color = helixorient.getColor(this.getColorParams())\n      const size = helixorient.getSize(this.getRadiusParams())\n      const picking = helixorient.getPicking()\n\n      bufferList.push(\n        new SphereBuffer(\n          {\n            position: position.center,\n            color: color.color,\n            radius: size.size,\n            picking: picking.picking\n          },\n          this.getBufferParams({\n            sphereDetail: this.sphereDetail,\n            disableImpostor: this.disableImpostor,\n            dullInterior: true\n          }) as SphereBufferParameters\n        ),\n        new VectorBuffer(\n          {\n            position: position.center,\n            vector: position.axis\n          },\n          this.getBufferParams({\n            color: 'skyblue',\n            scale: 1\n          })\n        ),\n        new VectorBuffer(\n          {\n            position: position.center,\n            vector: position.resdir\n          },\n          this.getBufferParams({\n            color: 'lightgreen',\n            scale: 1\n          })\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList as (SphereGeometryBuffer|SphereImpostorBuffer|VectorBuffer)[],\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    if (Debug) Log.time(this.type + ' repr update')\n\n    what = what || {}\n\n    for (let i = 0, il = data.polymerList!.length; i < il; ++i) {\n      const j = i * 3\n\n      const bufferData: Partial<BufferData> = {}\n      const polymer = data.polymerList![ i ]\n      const helixorient = new Helixorient(polymer)\n\n      if (what.position) {\n        const position = helixorient.getPosition()\n\n        Object.assign(bufferData, {position: position.center})\n\n        data.bufferList[ j + 1 ].setAttributes({\n          'position': position.center,\n          'vector': position.axis\n        })\n        data.bufferList[ j + 2 ].setAttributes({\n          'position': position.center,\n          'vector': position.resdir\n        })\n      }\n\n      data.bufferList[ j ].setAttributes(bufferData)\n    }\n\n    if (Debug) Log.timeEnd(this.type + ' repr update')\n  }\n}\n\nRepresentationRegistry.add('helixorient', HelixorientRepresentation)\n\nexport default HelixorientRepresentation\n","/**\n * @file Licorice Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport BallAndStickRepresentation, { BallAndStickRepresentationParameters } from './ballandstick-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\n\n/**\n * Licorice representation object ({@link BallAndStickRepresentation} with `aspectRatio` fixed at 1.0)\n */\nclass LicoriceRepresentation extends BallAndStickRepresentation {\n  /**\n   * Create Licorice representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {BallAndStickRepresentationParameters} params - ball and stick representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<BallAndStickRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'licorice'\n\n    this.parameters = Object.assign(\n      {}, this.parameters, { aspectRatio: null }\n    )\n  }\n\n  init (params: Partial<BallAndStickRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = 1.0\n\n    super.init(p)\n  }\n}\n\nRepresentationRegistry.add('licorice', LicoriceRepresentation)\n\nexport default LicoriceRepresentation\n","/**\n * @file Mapped Box Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferParameters, BufferData } from './buffer'\nimport MappedBuffer from './mapped-buffer'\n\nconst mapping = new Float32Array([\n  -1.0, -1.0, -1.0,\n  1.0, -1.0, -1.0,\n  1.0, -1.0, 1.0,\n  -1.0, -1.0, 1.0,\n  -1.0, 1.0, -1.0,\n  1.0, 1.0, -1.0,\n  1.0, 1.0, 1.0,\n  -1.0, 1.0, 1.0\n])\n\nconst mappingIndices = new Uint16Array([\n  0, 1, 2,\n  0, 2, 3,\n  1, 5, 6,\n  1, 6, 2,\n  4, 6, 5,\n  4, 7, 6,\n  0, 7, 4,\n  0, 3, 7,\n  0, 5, 1,\n  0, 4, 5,\n  3, 2, 6,\n  3, 6, 7\n])\n\n/**\n * Mapped Box buffer. Draws boxes. Used to render general imposters.\n * @interface\n */\nclass MappedBoxBuffer extends MappedBuffer {\n  constructor(data: BufferData, params: Partial<BufferParameters> = {}) {\n    super('v3', data, params)\n  }\n  get mapping () { return mapping }\n  get mappingIndices () { return mappingIndices }\n  get mappingIndicesSize () { return 36 }\n  get mappingSize () { return 8 }\n  get mappingItemSize () { return 3 }\n}\n\nexport default MappedBoxBuffer\n","/**\n * @file Hyperball Stick Impostor Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import Vector3 required for declaration only\nimport { Matrix4, Vector3 } from 'three'\n\nimport '../shader/HyperballStickImpostor.vert'\nimport '../shader/HyperballStickImpostor.frag'\n\nimport MappedBoxBuffer from './mappedbox-buffer'\nimport { BufferDefaultParameters, BufferParameterTypes, BufferData } from './buffer'\n\nexport interface HyperballStickImpostorBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n  radius: Float32Array\n  radius2: Float32Array\n}\n\nexport const HyperballStickImpostorBufferDefaultParameters = Object.assign({\n  shrink: 0.14\n}, BufferDefaultParameters)\nexport type HyperballStickImpostorBufferParameters = typeof HyperballStickImpostorBufferDefaultParameters\n\nconst HyperballStickImpostorBufferParameterTypes = Object.assign({\n  shrink: { uniform: true }\n}, BufferParameterTypes)\n\n/**\n * Hyperball stick impostor buffer.\n *\n * @example\n * var hyperballStickImpostorBuffer = new HyperballStickImpostorBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 2, 2, 2 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   radius2: new Float32Array([ 2 ])\n * });\n */\nclass HyperballStickImpostorBuffer extends MappedBoxBuffer {\n  parameterTypes = HyperballStickImpostorBufferParameterTypes\n  get defaultParameters() { return HyperballStickImpostorBufferDefaultParameters }\n  parameters: HyperballStickImpostorBufferParameters\n\n  isImpostor = true\n  vertexShader = 'HyperballStickImpostor.vert'\n  fragmentShader = 'HyperballStickImpostor.frag'\n\n  constructor (data: HyperballStickImpostorBufferData, params: Partial<HyperballStickImpostorBufferParameters> = {}) {\n    super(data, params)\n\n    this.addUniforms({\n      'modelViewProjectionMatrix': { value: new Matrix4() },\n      'modelViewProjectionMatrixInverse': { value: new Matrix4() },\n      'modelViewMatrixInverseTranspose': { value: new Matrix4() },\n      'shrink': { value: this.parameters.shrink }\n    })\n\n    this.addAttributes({\n      'position1': { type: 'v3', value: null },\n      'position2': { type: 'v3', value: null },\n      'color2': { type: 'c', value: null },\n      'radius': { type: 'f', value: null },\n      'radius2': { type: 'f', value: null }\n    })\n\n    this.setAttributes(data)\n    this.makeMapping()\n  }\n}\n\nexport default HyperballStickImpostorBuffer\n","/**\n * @file Hyperball Stick Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// @ts-ignore: unused import required for declaration only\nimport { Vector3, Matrix4 } from 'three'\nimport { ExtensionFragDepth } from '../globals'\nimport { calculateMinArray } from '../math/array-utils'\nimport CylinderGeometryBuffer, { CylinderGeometryBufferDefaultParameters } from './cylindergeometry-buffer'\nimport HyperballStickImpostorBuffer, { HyperballStickImpostorBufferDefaultParameters } from './hyperballstickimpostor-buffer'\nimport { BufferData } from './buffer'\n\nexport interface HyperballStickBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  color2: Float32Array\n  radius: Float32Array\n  radius2: Float32Array\n}\n\nexport const HyperballStickBufferDefaultParameters = Object.assign({\n  disableImpostor: false\n}, CylinderGeometryBufferDefaultParameters, HyperballStickImpostorBufferDefaultParameters)\nexport type HyperballStickBufferParameters = typeof HyperballStickBufferDefaultParameters\n\n/**\n * Hyperball stick buffer. Depending on the value {@link ExtensionFragDepth} and\n * `params.disableImpostor` the constructor returns either a\n * {@link CylinderGeometryBuffer} or a {@link HyperballStickImpostorBuffer}\n * @implements {Buffer}\n *\n * @example\n * var hyperballStickBuffer = new HyperballStickBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 2, 2, 2 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   radius2: new Float32Array([ 2 ])\n * });\n */\nclass HyperballStickBuffer {\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position1 - from positions\n   * @param  {Float32Array} data.position2 - to positions\n   * @param  {Float32Array} data.color - from colors\n   * @param  {Float32Array} data.color2 - to colors\n   * @param  {Float32Array} data.radius - from radii\n   * @param  {Float32Array} data.radius2 - to radii\n   * @param  {Float32Array} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: HyperballStickBufferData, params: Partial<HyperballStickBufferParameters> = {}) {\n    if (!ExtensionFragDepth || (params && params.disableImpostor)) {\n      data.radius = calculateMinArray(data.radius, data.radius2)\n      return new CylinderGeometryBuffer(data, params)\n    } else {\n      return new HyperballStickImpostorBuffer(data, params)\n    }\n  }\n}\n\nexport default HyperballStickBuffer\n","/**\n * @file Hyperball Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { calculateCenterArray } from '../math/array-utils'\nimport LicoriceRepresentation from './licorice-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport HyperballStickBuffer, { HyperballStickBufferData } from '../buffer/hyperballstick-buffer'\nimport { BallAndStickRepresentationParameters } from './ballandstick-representation';\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Volume } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport { BondDataParams, BondDataFields, AtomDataFields } from '../structure/structure-data';\nimport StructureView from '../structure/structure-view';\nimport { StructureRepresentationData } from './structure-representation';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface';\n\nexport interface HyperballRepresentationParameters extends BallAndStickRepresentationParameters {\n  shrink: number\n}\n\n/**\n * Hyperball Representation\n */\nclass HyperballRepresentation extends LicoriceRepresentation {\n  protected shrink: number\n  protected __center: Float32Array\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<HyperballRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'hyperball'\n\n    this.parameters = Object.assign({\n\n      shrink: {\n        type: 'number', precision: 3, max: 1.0, min: 0.001, buffer: true\n      }\n\n    }, this.parameters, {\n\n      multipleBond: null,\n      bondSpacing: null\n\n    })\n  }\n\n  init (params: Partial<HyperballRepresentationParameters>) {\n    var p = params || {}\n    p.radiusScale = defaults(p.radiusScale, 0.2)\n    p.radiusType = defaults(p.radiusType, 'vdw')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.shrink = defaults(p.shrink, 0.12)\n\n    super.init(p)\n  }\n\n  getBondParams (what?: BondDataFields, params?: BondDataParams) {\n    if (!what || what.radius) {\n      params = Object.assign({ radius2: true }, params)\n    }\n\n    return super.getBondParams(what, params)\n  }\n\n  createData (sview: StructureView) {\n    var sphereBuffer = new SphereBuffer(\n      (sview.getAtomData(this.getAtomParams()) as SphereBufferData),\n      this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      }) as SphereBufferParameters\n    ) as SphereGeometryBuffer\n\n    this.__center = new Float32Array(sview.bondCount * 3)\n\n    var stickBuffer = new HyperballStickBuffer(\n      sview.getBondData(this.getBondParams()) as HyperballStickBufferData,\n      this.getBufferParams({\n        shrink: this.shrink,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    return {\n      bufferList: [ sphereBuffer, stickBuffer ]\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    var atomData = data.sview!.getAtomData(this.getAtomParams())\n    var bondData = data.sview!.getBondData(this.getBondParams())\n    var sphereData = {}\n    var stickData = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {position: atomData.position})\n      var from = bondData.position1\n      var to = bondData.position2\n      Object.assign(stickData, {\n        position: calculateCenterArray(from!, to!, this.__center),\n        position1: from,\n        position2: to\n      })\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {color: atomData.color})\n      Object.assign(stickData, {\n        color: bondData.color,\n        color2: bondData.color2\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {radius: atomData.radius})\n      Object.assign(stickData, {\n        radius: bondData.radius,\n        radius2: bondData.radius2\n      })\n    }\n\n    data.bufferList[ 0 ].setAttributes(sphereData)\n    data.bufferList[ 1 ].setAttributes(stickData)\n  }\n}\n\nRepresentationRegistry.add('hyperball', HyperballRepresentation)\n\nexport default HyperballRepresentation\n","/**\n * @file Label Factory\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { AA1 } from '../structure/structure-constants'\nimport AtomProxy from '../proxy/atom-proxy'\nimport { sprintf } from 'sprintf-js'\n\nexport const LabelFactoryTypes = {\n  '': '',\n  'atomname': 'atom name',\n  'atomindex': 'atom index',\n  'occupancy': 'occupancy',\n  'bfactor': 'b-factor',\n  'serial': 'serial',\n  'element': 'element',\n  'atom': 'atom name + index',\n  'resname': 'residue name',\n  'resno': 'residue no',\n  'res': 'one letter code + no',\n  'residue': '[residue name] + no + inscode',\n  'text': 'text',\n  'format': 'format',\n  'qualified': 'qualified name'\n}\nexport type LabelType = keyof typeof LabelFactoryTypes\n\nclass LabelFactory {\n\n  static types = LabelFactoryTypes\n  errorLogged: boolean = false\n\n  constructor(readonly type: LabelType, readonly text: { [k: number]: string } = {},\n    readonly format: string = '') {}\n\n  atomLabel (a: AtomProxy) {\n    const type = this.type\n\n    let l\n\n    switch (type) {\n      case 'atomname':\n        l = a.atomname\n        break\n\n      case 'atomindex':\n        l = `${a.index}`\n        break\n\n      case 'occupancy':\n        l = a.occupancy.toFixed(2)\n        break\n\n      case 'bfactor':\n        l = a.bfactor.toFixed(2)\n        break\n\n      case 'serial':\n        l = `${a.serial}`\n        break\n\n      case 'element':\n        l = a.element\n        break\n\n      case 'atom':\n        l = `${a.atomname}|${a.index}`\n        break\n\n      case 'resname':\n        l = a.resname\n        break\n\n      case 'resno':\n        l = `${a.resno}`\n        break\n\n      case 'res':\n        l = `${(AA1[ a.resname.toUpperCase() ] || a.resname)}${a.resno}`\n        break\n\n      case 'residue':\n        const aa1 = AA1[ a.resname.toUpperCase() ]\n        if (aa1 && !a.inscode) {\n          l = `${aa1}${a.resno}`\n        } else {\n          l = `[${a.resname}]${a.resno}${a.inscode}`\n        }\n        break\n\n      case 'text':\n        l = this.text[ a.index ]\n        break\n\n      case 'format':\n        try {\n          l = sprintf(this.format, a)\n        } catch (e) {\n          if (!this.errorLogged) {\n            this.errorLogged = true\n            console.log(e.message)\n          }\n        }\n        break\n\n      // case \"qualified\":\n      default:\n        l = a.qualifiedName()\n        break\n    }\n\n    return l === undefined ? '' : l\n  }\n}\n\nexport default LabelFactory\n","/**\n * @file Label Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry, ColormakerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport LabelFactory, { LabelType } from '../utils/label-factory'\nimport RadiusFactory from '../utils/radius-factory'\nimport StructureRepresentation, { StructureRepresentationData } from './structure-representation'\nimport TextBuffer, { TextBufferData } from '../buffer/text-buffer'\nimport { RepresentationParameters } from './representation';\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\n\nexport interface TextDataField {\n  position?: boolean\n  color?: boolean\n  radius?: boolean\n  text?: boolean\n}\n\n/**\n * Label representation parameter object. Extends {@link RepresentationParameters} and\n * {@link StructureRepresentationParameters}.\n *\n * @typedef {Object} LabelRepresentationParameters - label representation parameters\n *\n * @property {Integer} clipNear - position of camera near/front clipping plane\n *                                in percent of scene bounding box\n * @property {Float} opacity - translucency: 1 is fully opaque, 0 is fully transparent\n * @property {String} labelType - type of the label, one of:\n *                                 \"atomname\", \"atomindex\", \"occupancy\", \"bfactor\",\n *                                 \"serial\", \"element\", \"atom\", \"resname\", \"resno\",\n *                                 \"res\", \"text\", \"qualified\". When set to \"text\", the\n *                                 `labelText` list is used.\n * @property {String[]} labelText - list of label strings, must set `labelType` to \"text\"\n *                                   to take effect\n * @property {String[]} labelFormat - sprintf-js format string, any attribute of\n *                                  {@link  AtomProxy} can be used\n * @property {String} labelGrouping - grouping of the label, one of:\n *                                 \"atom\", \"residue\".\n * @property {String} fontFamily - font family, one of: \"sans-serif\", \"monospace\", \"serif\"\n * @property {String} fontStyle - font style, \"normal\" or \"italic\"\n * @property {String} fontWeight - font weight, \"normal\" or \"bold\"\n * @property {Float} xOffset - offset in x-direction\n * @property {Float} yOffset - offset in y-direction\n * @property {Float} zOffset - offset in z-direction (i.e. in camera direction)\n * @property {String} attachment - attachment of the label, one of:\n *                                 \"bottom-left\", \"bottom-center\", \"bottom-right\",\n *                                 \"middle-left\", \"middle-center\", \"middle-right\",\n *                                 \"top-left\", \"top-center\", \"top-right\"\n * @property {Boolean} showBorder - show border/outline\n * @property {Color} borderColor - color of the border/outline\n * @property {Float} borderWidth - width of the border/outline\n * @property {Boolean} showBackground - show background rectangle\n * @property {Color} backgroundColor - color of the background\n * @property {Float} backgroundMargin - width of the background\n * @property {Float} backgroundOpacity - opacity of the background\n * @property {Boolean} fixedSize - show text with a fixed pixel size\n */\nexport interface LabelRepresentationParameters extends RepresentationParameters {\n  labelType: LabelType\n  labelText: string\n  labelFormat: string\n  labelGrouping: 'atom'|'residue'\n  fontFamily: 'sans-serif'|'monospace'|'serif'\n  fontStyle: 'normal'|'italic'\n  fontWeight: 'normal'|'bold'\n  xOffset: number\n  yOffset: number\n  zOffset: number\n  attachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  showBorder: boolean\n  borderColor: number\n  borderWidth: number\n  showBackground: boolean\n  backgroundColor: number\n  backgroundMargin: number\n  backgroundOpacity: number\n  fixedSize: boolean\n}\n/**\n * Label representation\n */\nclass LabelRepresentation extends StructureRepresentation {\n\n  protected labelType: LabelType\n  protected labelText: string\n  protected labelFormat: string\n  protected labelGrouping: 'atom'|'residue'\n  protected fontFamily: 'sans-serif'|'monospace'|'serif'\n  protected fontStyle: 'normal'|'italic'\n  protected fontWeight: 'normal'|'bold'\n  protected xOffset: number\n  protected yOffset: number\n  protected zOffset: number\n  protected attachment: 'bottom-left'|'bottom-center'|'bottom-right'|'middle-left'|'middle-center'|'middle-right'|'top-left'|'top-center'|'top-right'\n  protected showBorder: boolean\n  protected borderColor: number\n  protected borderWidth: number\n  protected showBackground: boolean\n  protected backgroundColor: number\n  protected backgroundMargin: number\n  protected backgroundOpacity: number\n  protected fixedSize: boolean\n\n  /**\n   * Create Label representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {LabelRepresentationParameters} params - label representation parameters\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<LabelRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'label'\n\n    this.parameters = Object.assign({\n\n      labelType: {\n        type: 'select', options: LabelFactory.types, rebuild: true\n      },\n      labelText: {\n        type: 'hidden', rebuild: true\n      },\n      labelFormat: {\n        type: 'text', rebuild: true\n      },\n      labelGrouping: {\n        type: 'select',\n        options: {\n          'atom': 'atom',\n          'residue': 'residue'\n        },\n        rebuild: true\n      },\n      fontFamily: {\n        type: 'select',\n        options: {\n          'sans-serif': 'sans-serif',\n          'monospace': 'monospace',\n          'serif': 'serif'\n        },\n        buffer: true\n      },\n      fontStyle: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'italic': 'italic'\n        },\n        buffer: true\n      },\n      fontWeight: {\n        type: 'select',\n        options: {\n          'normal': 'normal',\n          'bold': 'bold'\n        },\n        buffer: true\n      },\n      xOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: true\n      },\n      yOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: true\n      },\n      zOffset: {\n        type: 'number', precision: 1, max: 20, min: -20, buffer: true\n      },\n      attachment: {\n        type: 'select',\n        options: {\n          'bottom-left': 'bottom-left',\n          'bottom-center': 'bottom-center',\n          'bottom-right': 'bottom-right',\n          'middle-left': 'middle-left',\n          'middle-center': 'middle-center',\n          'middle-right': 'middle-right',\n          'top-left': 'top-left',\n          'top-center': 'top-center',\n          'top-right': 'top-right'\n        },\n        rebuild: true\n      },\n      showBorder: {\n        type: 'boolean', buffer: true\n      },\n      borderColor: {\n        type: 'color', buffer: true\n      },\n      borderWidth: {\n        type: 'number', precision: 2, max: 0.3, min: 0, buffer: true\n      },\n      showBackground: {\n        type: 'boolean', rebuild: true\n      },\n      backgroundColor: {\n        type: 'color', buffer: true\n      },\n      backgroundMargin: {\n        type: 'number', precision: 2, max: 2, min: 0, rebuild: true\n      },\n      backgroundOpacity: {\n        type: 'range', step: 0.01, max: 1, min: 0, buffer: true\n      },\n      fixedSize: {\n        type: 'boolean', buffer: true\n      }\n\n    }, this.parameters, {\n\n      side: null,\n      flatShaded: null,\n      wireframe: null,\n      linewidth: null,\n\n      roughness: null,\n      metalness: null,\n      diffuse: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<LabelRepresentationParameters>) {\n    const p = params || {}\n\n    this.labelType = defaults(p.labelType, 'res')\n    this.labelText = defaults(p.labelText, {})\n    this.labelFormat = defaults(p.labelFormat, '')\n    this.labelGrouping = defaults(p.labelGrouping, 'atom')\n    this.fontFamily = defaults(p.fontFamily, 'sans-serif')\n    this.fontStyle = defaults(p.fontStyle, 'normal')\n    this.fontWeight = defaults(p.fontWeight, 'bold')\n    this.xOffset = defaults(p.xOffset, 0.0)\n    this.yOffset = defaults(p.yOffset, 0.0)\n    this.zOffset = defaults(p.zOffset, 0.5)\n    this.attachment = defaults(p.attachment, 'bottom-left')\n    this.showBorder = defaults(p.showBorder, false)\n    this.borderColor = defaults(p.borderColor, 'lightgrey')\n    this.borderWidth = defaults(p.borderWidth, 0.15)\n    this.showBackground = defaults(p.showBackground, false)\n    this.backgroundColor = defaults(p.backgroundColor, 'lightgrey')\n    this.backgroundMargin = defaults(p.backgroundMargin, 0.5)\n    this.backgroundOpacity = defaults(p.backgroundOpacity, 1.0)\n    this.fixedSize = defaults(p.fixedSize, false)\n\n    super.init(p)\n  }\n\n  getTextData (sview: StructureView, what?: TextDataField) {\n    const p = this.getAtomParams(what)\n    const labelFactory = new LabelFactory(this.labelType, this.labelText, this.labelFormat)\n    let position: Float32Array, size: Float32Array, color: Float32Array, text: string[],\n      positionN: number[], sizeN: number[], colorN: number[]\n    if (this.labelGrouping === 'atom') {\n      const atomData = sview.getAtomData(p)\n      position = atomData.position as Float32Array\n      size = atomData.radius as Float32Array\n      color = atomData.color as Float32Array\n      if (!what || what.text) {\n        text = []\n        sview.eachAtom(ap => text.push(labelFactory.atomLabel(ap)))\n      }\n    } else if (this.labelGrouping === 'residue') {\n      if (!what || what.position) positionN = []\n      if (!what || what.color) colorN = []\n      if (!what || what.radius) sizeN = []\n      if (!what || what.text) text = []\n      if (p.colorParams) p.colorParams.structure = sview.getStructure()\n      const colormaker = ColormakerRegistry.getScheme(p.colorParams)\n      const radiusFactory = new RadiusFactory(p.radiusParams)\n      const ap1 = sview.getAtomProxy()\n\n      let i = 0\n      sview.eachResidue(rp => {\n        const i3 = i * 3\n        if (rp.isProtein() || rp.isNucleic()) {\n          ap1.index = rp.traceAtomIndex\n          if (!what || what.position) {\n            ap1.positionToArray(positionN, i3)\n          }\n        } else {\n          ap1.index = rp.atomOffset\n          if (!what || what.position) {\n            rp.positionToArray(positionN, i3)\n          }\n        }\n        if (!what || what.color) {\n          colormaker.atomColorToArray(ap1, colorN, i3)\n        }\n        if (!what || what.radius) {\n          sizeN[ i ] = radiusFactory.atomRadius(ap1)\n        }\n        if (!what || what.text) {\n          text.push(labelFactory.atomLabel(ap1))\n        }\n        ++i\n      })\n\n      if (!what || what.position) position = new Float32Array(positionN!)\n      if (!what || what.color) color = new Float32Array(colorN!)\n      if (!what || what.radius) size = new Float32Array(sizeN!)\n    }\n\n    return { position: position!, size: size!, color: color!, text: text! }\n  }\n\n  createData (sview: StructureView) {\n    const what: TextDataField = { position: true, color: true, radius: true, text: true }\n\n    const textBuffer = new TextBuffer(\n      this.getTextData(sview, what) as TextBufferData,\n      this.getBufferParams({\n        fontFamily: this.fontFamily,\n        fontStyle: this.fontStyle,\n        fontWeight: this.fontWeight,\n        xOffset: this.xOffset,\n        yOffset: this.yOffset,\n        zOffset: this.zOffset,\n        attachment: this.attachment,\n        showBorder: this.showBorder,\n        borderColor: this.borderColor,\n        borderWidth: this.borderWidth,\n        showBackground: this.showBackground,\n        backgroundColor: this.backgroundColor,\n        backgroundMargin: this.backgroundMargin,\n        backgroundOpacity: this.backgroundOpacity,\n        fixedSize: this.fixedSize\n      })\n    )\n\n    return { bufferList: [ textBuffer ] }\n  }\n\n  updateData (what: TextDataField, data: StructureRepresentationData) {\n    data.bufferList[ 0 ].setAttributes(this.getTextData(data.sview as StructureView, what))\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n}\n\nRepresentationRegistry.add('label', LabelRepresentation)\n\nexport default LabelRepresentation\n","/**\n * @file Line Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport WideLineBuffer from '../buffer/wideline-buffer'\nimport { AtomPicker } from '../utils/picker'\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Volume } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\n// @ts-ignore: unused import Surface required for declaration only\nimport Surface from '../surface/surface';\n// @ts-ignore: unused import BondDataFields, BondDataParams required for declaration only\nimport { BondDataFields, BondDataParams } from '../structure/structure-data';\n\n/**\n * Determine which atoms in  a Structure[View] form no bonds to any other atoms\n * in that Structure.\n *\n * This differs from setting the selection to \"nonbonded\" as it finds atoms\n * that have no bonds within the current selection.\n * @param  {Structure} structure - The Structure or StructureView object\n * @return {AtomSet} AtomSet of lone atoms\n */\nfunction getLoneAtomSet (structure: Structure | StructureView) {\n  const atomSet = structure.getAtomSet()\n  const bondSet = structure.getBondSet()\n  const bp = structure.getBondProxy()\n  bondSet.forEach(function (idx) {\n    bp.index = idx\n    atomSet.clear(bp.atomIndex1)\n    atomSet.clear(bp.atomIndex2)\n  })\n  return atomSet\n}\n\nexport interface LineRepresentationParameters extends StructureRepresentationParameters {\n  multipleBond: 'off' | 'symmetric' | 'offset'\n  bondSpacing: number\n  linewidth: number\n  lines: boolean\n  crosses: 'off' | 'all' | 'lone'\n  crossSize: number\n}\n\nexport interface CrossData {\n  position1?: Float32Array\n  position2?: Float32Array\n  color?: Float32Array\n  color2?: Float32Array\n  picking?: AtomPicker\n}\n\n/**\n * Line representation\n */\nclass LineRepresentation extends StructureRepresentation {\n  protected multipleBond: 'off' | 'symmetric' | 'offset'\n  protected bondSpacing: number\n  protected linewidth: number\n  protected lines: boolean\n  protected crosses: 'off' | 'all' | 'lone'\n  protected crossSize: number\n  /**\n   * Create Line representation object\n   * @param {Structure} structure - the structure to be represented\n   * @param {Viewer} viewer - a viewer object\n   * @param {RepresentationParameters} params - representation parameters, plus the properties listed below\n   * @property {String} multipleBond - one off \"off\", \"symmetric\", \"offset\"\n   * @param {Float} params.bondSpacing - spacing for multiple bond rendering\n   * @param {Integer} params.linewidth - width of lines\n   * @param {Boolean} params.lines - render bonds as lines\n   * @param {String} params.crosses - render atoms as crosses: \"off\", \"all\" or \"lone\" (default)\n   * @param {Float} params.crossSize - size of cross\n   * @param {null} params.flatShaded - not available\n   * @param {null} params.side - not available\n   * @param {null} params.wireframe - not available\n   * @param {null} params.roughness - not available\n   * @param {null} params.metalness - not available\n   * @param {null} params.diffuse - not available\n   */\n  constructor (structure: Structure, viewer: Viewer, params: Partial<LineRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'line'\n\n    this.parameters = Object.assign({\n\n      multipleBond: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'off': 'off',\n          'symmetric': 'symmetric',\n          'offset': 'offset'\n        }\n      },\n      bondSpacing: {\n        type: 'number', precision: 2, max: 2.0, min: 0.5\n      },\n      linewidth: {\n        type: 'integer', max: 50, min: 1, buffer: true\n      },\n      lines: {\n        type: 'boolean', rebuild: true\n      },\n      crosses: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'off': 'off',\n          'lone': 'lone',\n          'all': 'all'\n        }\n      },\n      crossSize: {\n        type: 'number', precision: 2, max: 2.0, min: 0.1\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      side: null,\n      wireframe: null,\n\n      roughness: null,\n      metalness: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<LineRepresentationParameters>) {\n    var p = params || {}\n\n    this.multipleBond = defaults(p.multipleBond, 'off')\n    this.bondSpacing = defaults(p.bondSpacing, 1.0)\n    this.linewidth = defaults(p.linewidth, 2)\n    this.lines = defaults(p.lines, true)\n    this.crosses = defaults(p.crosses, 'lone')\n    this.crossSize = defaults(p.crossSize, 0.4)\n\n    super.init(p)\n  }\n\n  getAtomRadius (atom:AtomProxy) {\n    return 0.1\n  }\n\n  getBondParams (what: any, params?: Partial<LineRepresentationParameters>) {\n    params = Object.assign({\n      multipleBond: this.multipleBond,\n      bondSpacing: this.bondSpacing,\n      radiusParams: { 'type': 'size', 'size': 0.1, 'scale': 1 }\n    }, params)\n\n    return super.getBondParams(what, params)\n  }\n\n  _crossData (what: any, sview: StructureView) {\n    if (what) {\n      if (!what.position && !what.color) return\n    }\n\n    const p = {}\n    if (this.crosses === 'lone') {\n      Object.assign(p, {atomSet : getLoneAtomSet(sview)})\n    }\n\n    const atomData = sview.getAtomData(this.getAtomParams(what, p))\n    const crossData: CrossData = {}\n    const position = atomData.position\n    const color = atomData.color\n    const picking = atomData.picking\n\n    const size = (position! || color).length\n    const attrSize = size * 3\n\n    let cPosition1 = new Float32Array(0)\n    let cPosition2 = new Float32Array(0)\n    let cColor = new Float32Array(0)\n    let cColor2 = new Float32Array(0)\n    let cOffset: number = 0\n\n    let pickingArray = new Float32Array(0)\n\n    if (!what || what.position) {\n      cPosition1 = crossData.position1 = new Float32Array(attrSize)\n      cPosition2 = crossData.position2 = new Float32Array(attrSize)\n      cOffset = this.crossSize / 2\n    }\n    if (!what || what.color) {\n      cColor = crossData.color = new Float32Array(attrSize)\n      cColor2 = crossData.color2 = new Float32Array(attrSize)\n    }\n    if (!what || what.picking) {\n      pickingArray = new Float32Array(atomData.picking!.array!.length * 3) // Needs padding??\n    }\n\n    for (let v = 0; v < size; v++) {\n      const j = v * 3\n      const i = j * 3\n\n      if (!what || what.position) {\n        const x = position![ j ]\n        const y = position![ j + 1 ]\n        const z = position![ j + 2 ]\n\n        cPosition1[ i ] = x - cOffset!\n        cPosition1[ i + 1 ] = y\n        cPosition1[ i + 2 ] = z\n        cPosition2[ i ] = x + cOffset\n        cPosition2[ i + 1 ] = y\n        cPosition2[ i + 2 ] = z\n\n        cPosition1[ i + 3 ] = x\n        cPosition1[ i + 4 ] = y - cOffset\n        cPosition1[ i + 5 ] = z\n        cPosition2[ i + 3 ] = x\n        cPosition2[ i + 4 ] = y + cOffset\n        cPosition2[ i + 5 ] = z\n\n        cPosition1[ i + 6 ] = x\n        cPosition1[ i + 7 ] = y\n        cPosition1[ i + 8 ] = z - cOffset\n        cPosition2[ i + 6 ] = x\n        cPosition2[ i + 7 ] = y\n        cPosition2[ i + 8 ] = z + cOffset\n      }\n\n      if (!what || what.color) {\n        const cimax = i + 9\n        for (let ci = i; ci < cimax; ci += 3) {\n          cColor[ ci ] = cColor2[ ci ] = color![ j ]\n          cColor[ ci + 1 ] = cColor2[ ci + 1 ] = color![ j + 1 ]\n          cColor[ ci + 2 ] = cColor2[ ci + 2 ] = color![ j + 2 ]\n        }\n      }\n\n      if (!what || what.picking) {\n        pickingArray[ j ] =\n        pickingArray[ j + 1 ] =\n        pickingArray[ j + 2 ] = picking!.array![ v ]\n      }\n    }\n\n    if (!what || what.picking) {\n      crossData.picking = new AtomPicker(\n        pickingArray, picking!.structure\n      )\n    }\n\n    return crossData\n  }\n\n  createData (sview: StructureView) {\n    const what = { position: true, color: true, picking: true }\n\n    const bufferList = []\n\n    if (this.lines) {\n      const bondData = sview.getBondData(this.getBondParams(what))\n\n      const lineBuffer = new WideLineBuffer(\n        bondData, this.getBufferParams({ linewidth: this.linewidth })\n      )\n\n      bufferList.push(lineBuffer)\n    }\n\n    if (this.crosses !== 'off') {\n      const crossBuffer = new WideLineBuffer(\n        (this._crossData(what, sview) as CrossData),\n        this.getBufferParams({linewidth: this.linewidth})\n      )\n      bufferList.push(crossBuffer)\n    }\n\n    return {\n      bufferList: bufferList\n    }\n  }\n\n  updateData (what: any, data: StructureRepresentationData) {\n    let bufferIdx = 0\n\n    if (this.lines) {\n      const bondData = data.sview!.getBondData(this.getBondParams(what))\n      const lineAttributes = {}\n\n      if (!what || what.position) {\n        Object.assign(lineAttributes, {\n          position1: bondData.position1,\n          position2: bondData.position2\n        })\n      }\n\n      if (!what || what.color) {\n        Object.assign(lineAttributes, {\n          color: bondData.color,\n          color2: bondData.color2\n        })\n      }\n\n      data.bufferList[ bufferIdx++ ].setAttributes(lineAttributes)\n    }\n\n    if (this.crosses !== 'off') {\n      const crossData = this._crossData(what, (data.sview as StructureView))\n      const crossAttributes = {}\n\n      if (!what || what.position) {\n        Object.assign(crossAttributes, {\n          position1: crossData!.position1,\n          position2: crossData!.position2\n        })\n      }\n      if (!what || what.color) {\n        Object.assign(crossAttributes, {\n          color: crossData!.color,\n          color2: crossData!.color2\n        })\n      }\n\n      data.bufferList[ bufferIdx++ ].setAttributes(crossAttributes)\n    }\n  }\n\n  setParameters (params: Partial<LineRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    if (params && (params.bondSpacing || params.crossSize)) {\n      Object.assign(what, { position: true })\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('line', LineRepresentation)\n\nexport default LineRepresentation\n","import { NumberArray, TypedArray } from \"../types\";\n\n/**\n * @file Grid\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\nexport interface iGrid {\n  data: TypedArray\n  index: (x: number, y: number, z: number) => number\n  set: (x: number, y: number, z: number, ...arg: number[]) => void\n  toArray: (x: number, y: number, z: number, array?: NumberArray, offset?: number) => void\n  fromArray: (x: number, y: number, z: number, array: NumberArray, offset?: number) => void\n  copy: (grid: iGrid) => void\n  // clone: () => iGrid\n}\n\nfunction makeGrid (length: number, width: number, height: number, DataCtor: any, elemSize: number) : iGrid {\n  DataCtor = DataCtor || Int32Array\n  elemSize = elemSize || 1\n\n  const data = new DataCtor(length * width * height * elemSize)\n\n  function index (x: number, y: number, z: number) {\n    return ((((x * width) + y) * height) + z) * elemSize\n  }\n\n  function set (x: number, y: number, z: number, ...args: number[]) {\n    const i = index(x, y, z)\n\n    for (let j = 0; j < elemSize; ++j) {\n      data[ i + j ] = args[ j ]\n    }\n  }\n\n  function toArray (x: number, y: number, z: number, array: NumberArray = [], offset: number = 0) {\n    const i = index(x, y, z)\n\n    for (let j = 0; j < elemSize; ++j) {\n      array[ offset + j ] = data[ i + j ]\n    }\n  }\n\n  function fromArray(x: number, y: number, z: number, array: NumberArray, offset: number = 0) {\n    const i = index(x, y, z)\n\n    for (let j = 0; j < elemSize; ++j) {\n      data[ i + j ] = array[ offset + j ]\n    }\n  }\n\n  function copy(grid: iGrid) {\n    data.set(grid.data)\n  }\n\n  // function clone() {\n  //   return makeGrid(\n  //     length, width, height, DataCtor, elemSize\n  //   ).copy(this)\n  // }\n  return { data, index, set, toArray, fromArray, copy }\n}\n\nexport { makeGrid }","/**\n * @file EDT Surface\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { VolumeSurface } from './volume'\nimport { iGrid, makeGrid } from '../geometry/grid'\nimport { computeBoundingBox } from '../math/vector-utils'\nimport { getRadiusDict, getSurfaceGrid } from './surface-utils'\nimport { TypedArray } from '../types';\n\ninterface EDTSurface {\n  getVolume: (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean) => {\n    data: TypedArray\n    nx: number\n    ny: number\n    nz: number\n    atomindex: TypedArray\n  }\n  getSurface: (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) => any\n}\n\nfunction EDTSurface (this: EDTSurface, coordList: Float32Array, radiusList: Float32Array, indexList: Uint16Array|Uint32Array) {\n  // based on D. Xu, Y. Zhang (2009) Generating Triangulated Macromolecular\n  // Surfaces by Euclidean Distance Transform. PLoS ONE 4(12): e8140.\n  //\n  // Permission to use, copy, modify, and distribute this program for\n  // any purpose, with or without fee, is hereby granted, provided that\n  // the notices on the head, the reference information, and this\n  // copyright notice appear in all copies or substantial portions of\n  // the Software. It is provided \"as is\" without express or implied\n  // warranty.\n  //\n  // ported to JavaScript by biochem_fan (http://webglmol.sourceforge.jp/)\n  // refactored by dkoes (https://github.com/dkoes)\n  //\n  // adapted to NGL by Alexander Rose\n\n  var radiusDict = getRadiusDict(radiusList as any)\n  var bbox = computeBoundingBox(coordList)\n  if (coordList.length === 0) {\n    bbox[ 0 ].set([ 0, 0, 0 ])\n    bbox[ 1 ].set([ 0, 0, 0 ])\n  }\n  var min = bbox[ 0 ]\n  var max = bbox[ 1 ]\n\n  var probeRadius: number, scaleFactor: number, cutoff: number\n  var pLength: number, pWidth: number, pHeight: number\n  var matrix: Float32Array, ptran: Float32Array\n  var depty: {[k: string]: TypedArray}, widxz: {[k: string]: number}\n  var cutRadius: number\n  var setAtomID: boolean\n  var vpBits: TypedArray, vpDistance: TypedArray, vpAtomID: TypedArray\n\n  function init (btype: boolean, _probeRadius: number, _scaleFactor: number, _cutoff: number, _setAtomID: boolean) {\n    probeRadius = _probeRadius || 1.4\n    scaleFactor = _scaleFactor || 2.0\n    setAtomID = _setAtomID || true\n\n    var maxRadius = 0\n    for (var radius in radiusDict) {\n      maxRadius = Math.max(maxRadius, radius as any)\n    }\n\n    var grid = getSurfaceGrid(\n      min, max, maxRadius, scaleFactor, btype ? probeRadius : 0\n    )\n\n    pLength = grid.dim[0]\n    pWidth = grid.dim[1]\n    pHeight = grid.dim[2]\n\n    matrix = grid.matrix\n    ptran = grid.tran\n    scaleFactor = grid.scaleFactor\n\n    // boundingatom caches\n    depty = {}\n    widxz = {}\n    boundingatom(btype)\n\n    cutRadius = probeRadius * scaleFactor\n\n    if (_cutoff) {\n      cutoff = _cutoff\n    } else {\n      // cutoff = Math.max( 0.1, -1.2 + scaleFactor * probeRadius );\n      cutoff = probeRadius / scaleFactor\n    }\n\n    vpBits = new Uint8Array(pLength * pWidth * pHeight)\n    if (btype) {\n      vpDistance = new Float64Array(pLength * pWidth * pHeight)\n    }\n    if (setAtomID) {\n      vpAtomID = new Int32Array(pLength * pWidth * pHeight)\n    }\n  }\n\n  // constants for vpBits bitmasks\n  var INOUT = 1\n  var ISDONE = 2\n  var ISBOUND = 4\n\n  var nb = [\n    new Int32Array([ 1, 0, 0 ]), new Int32Array([ -1, 0, 0 ]),\n    new Int32Array([ 0, 1, 0 ]), new Int32Array([ 0, -1, 0 ]),\n    new Int32Array([ 0, 0, 1 ]), new Int32Array([ 0, 0, -1 ]),\n    new Int32Array([ 1, 1, 0 ]), new Int32Array([ 1, -1, 0 ]),\n    new Int32Array([ -1, 1, 0 ]), new Int32Array([ -1, -1, 0 ]),\n    new Int32Array([ 1, 0, 1 ]), new Int32Array([ 1, 0, -1 ]),\n    new Int32Array([ -1, 0, 1 ]), new Int32Array([ -1, 0, -1 ]),\n    new Int32Array([ 0, 1, 1 ]), new Int32Array([ 0, 1, -1 ]),\n    new Int32Array([ 0, -1, 1 ]), new Int32Array([ 0, -1, -1 ]),\n    new Int32Array([ 1, 1, 1 ]), new Int32Array([ 1, 1, -1 ]),\n    new Int32Array([ 1, -1, 1 ]), new Int32Array([ -1, 1, 1 ]),\n    new Int32Array([ 1, -1, -1 ]), new Int32Array([ -1, -1, 1 ]),\n    new Int32Array([ -1, 1, -1 ]), new Int32Array([ -1, -1, -1 ])\n  ]\n\n  //\n\n  this.getVolume = function (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean) {\n    console.time('EDTSurface.getVolume')\n\n    var btype = type !== 'vws'\n\n    init(btype, probeRadius, scaleFactor, cutoff, setAtomID)\n\n    fillvoxels(btype)\n    buildboundary()\n\n    if (type === 'ms' || type === 'ses') {\n      fastdistancemap()\n    }\n\n    if (type === 'ses') {\n      boundingatom(false)\n      fillvoxelswaals()\n    }\n\n    marchingcubeinit(type)\n\n    // set atomindex in the volume data\n    for (var i = 0, il = vpAtomID.length; i < il; ++i) {\n      vpAtomID[ i ] = indexList[ vpAtomID[ i ] ]\n    }\n\n    console.timeEnd('EDTSurface.getVolume')\n\n    return {\n      data: vpBits,\n      nx: pHeight,\n      ny: pWidth,\n      nz: pLength,\n      atomindex: vpAtomID\n    }\n  }\n\n  this.getSurface = function (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) {\n    var vd = this.getVolume(\n      type, probeRadius, scaleFactor, cutoff, setAtomID\n    )\n\n    var volsurf = new (VolumeSurface as any)(\n      vd.data, vd.nx, vd.ny, vd.nz, vd.atomindex\n    ) as VolumeSurface\n\n    return (volsurf!.getSurface as any)(1, smooth, undefined, matrix, contour)\n  }\n\n  function boundingatom (btype: boolean) {\n    var r\n    var j\n    var k\n    var txz\n    var tdept\n    var sradius\n    var tradius\n    var widxzR\n    var deptyName\n    var indx\n\n    for (var name in radiusDict) {\n      r = parseFloat(name)\n\n      if (depty[ name ]) continue\n\n      if (!btype) {\n        tradius = r * scaleFactor + 0.5\n      } else {\n        tradius = (r + probeRadius) * scaleFactor + 0.5\n      }\n\n      sradius = tradius * tradius\n      widxzR = Math.floor(tradius) + 1\n      deptyName = new Int32Array(widxzR * widxzR)\n      indx = 0\n\n      for (j = 0; j < widxzR; ++j) {\n        for (k = 0; k < widxzR; ++k) {\n          txz = j * j + k * k\n\n          if (txz > sradius) {\n            deptyName[ indx ] = -1\n          } else {\n            tdept = Math.sqrt(sradius - txz)\n            deptyName[ indx ] = Math.floor(tdept)\n          }\n\n          ++indx\n        }\n      }\n\n      widxz[ name ] = widxzR\n      depty[ name ] = deptyName\n    }\n  }\n\n  function fillatom (idx: number) {\n    var ci = idx * 3\n    var ri = idx\n\n    var cx, cy, cz, ox, oy, oz, mi, mj, mk, i, j, k, si, sj, sk\n    var ii, jj, kk\n\n    cx = Math.floor(0.5 + scaleFactor * (coordList[ ci ] + ptran[0]))\n    cy = Math.floor(0.5 + scaleFactor * (coordList[ ci + 1 ] + ptran[1]))\n    cz = Math.floor(0.5 + scaleFactor * (coordList[ ci + 2 ] + ptran[2]))\n\n    var at = radiusList[ ri ]\n    var deptyAt = depty[ at ]\n    var nind = 0\n    var pWH = pWidth * pHeight\n    var n = widxz[ at ]\n\n    var deptyAtNind\n\n    for (i = 0; i < n; ++i) {\n      for (j = 0; j < n; ++j) {\n        deptyAtNind = deptyAt[ nind ]\n\n        if (deptyAtNind !== -1) {\n          for (ii = -1; ii < 2; ++ii) {\n            for (jj = -1; jj < 2; ++jj) {\n              for (kk = -1; kk < 2; ++kk) {\n                if (ii !== 0 && jj !== 0 && kk !== 0) {\n                  mi = ii * i\n                  mk = kk * j\n\n                  for (k = 0; k <= deptyAtNind; ++k) {\n                    mj = k * jj\n                    si = cx + mi\n                    sj = cy + mj\n                    sk = cz + mk\n\n                    if (si < 0 || sj < 0 || sk < 0 ||\n                      si >= pLength || sj >= pWidth || sk >= pHeight\n                    ) {\n                      continue\n                    }\n\n                    var index = si * pWH + sj * pHeight + sk\n\n                    if (!setAtomID) {\n                      vpBits[ index ] |= INOUT\n                    } else {\n                      if (!(vpBits[ index ] & INOUT)) {\n                        vpBits[ index ] |= INOUT\n                        vpAtomID[ index ] = idx\n                      } else if (vpBits[ index ] & INOUT) {\n                        var ci2 = vpAtomID[ index ]\n\n                        if (ci2 !== ci) {\n                          ox = cx + mi - Math.floor(0.5 + scaleFactor * (coordList[ci2] + ptran[0]))\n                          oy = cy + mj - Math.floor(0.5 + scaleFactor * (coordList[ci2 + 1] + ptran[1]))\n                          oz = cz + mk - Math.floor(0.5 + scaleFactor * (coordList[ci2 + 2] + ptran[2]))\n\n                          if (mi * mi + mj * mj + mk * mk < ox * ox + oy * oy + oz * oz) {\n                            vpAtomID[ index ] = idx\n                          }\n                        }\n                      }\n                    }\n                  } // k\n                } // if\n              } // kk\n            } // jj\n          } // ii\n        } // if\n\n        nind++\n      } // j\n    } // i\n  }\n\n  function fillvoxels (btype: boolean) {\n    console.time('EDTSurface fillvoxels')\n\n    var i, il\n\n    for (i = 0, il = vpBits.length; i < il; ++i) {\n      vpBits[ i ] = 0\n      if (btype) vpDistance[ i ] = -1.0\n      if (setAtomID) vpAtomID[ i ] = -1\n    }\n\n    for (i = 0, il = coordList.length / 3; i < il; ++i) {\n      fillatom(i)\n    }\n\n    for (i = 0, il = vpBits.length; i < il; ++i) {\n      if (vpBits[ i ] & INOUT) {\n        vpBits[ i ] |= ISDONE\n      }\n    }\n\n    console.timeEnd('EDTSurface fillvoxels')\n  }\n\n  function fillAtomWaals (idx: number) {\n    var ci = idx * 3\n    var ri = idx\n\n    var cx\n    var cy\n    var cz\n    var ox\n    var oy\n    var oz\n    var nind = 0\n\n    var mi\n    var mj\n    var mk\n    var si\n    var sj\n    var sk\n    var i\n    var j\n    var k\n    var ii\n    var jj\n    var kk\n    var n\n\n    cx = Math.floor(0.5 + scaleFactor * (coordList[ ci ] + ptran[0]))\n    cy = Math.floor(0.5 + scaleFactor * (coordList[ ci + 1 ] + ptran[1]))\n    cz = Math.floor(0.5 + scaleFactor * (coordList[ ci + 2 ] + ptran[2]))\n\n    var at = radiusList[ ri ]\n    var pWH = pWidth * pHeight\n\n    for (i = 0, n = widxz[at]; i < n; ++i) {\n      for (j = 0; j < n; ++j) {\n        if (depty[ at ][ nind ] !== -1) {\n          for (ii = -1; ii < 2; ++ii) {\n            for (jj = -1; jj < 2; ++jj) {\n              for (kk = -1; kk < 2; ++kk) {\n                if (ii !== 0 && jj !== 0 && kk !== 0) {\n                  mi = ii * i\n                  mk = kk * j\n\n                  for (k = 0; k <= depty[ at ][ nind ]; ++k) {\n                    mj = k * jj\n                    si = cx + mi\n                    sj = cy + mj\n                    sk = cz + mk\n\n                    if (si < 0 || sj < 0 || sk < 0 ||\n                      si >= pLength || sj >= pWidth || sk >= pHeight\n                    ) {\n                      continue\n                    }\n\n                    var index = si * pWH + sj * pHeight + sk\n\n                    if (!(vpBits[ index ] & ISDONE)) {\n                      vpBits[ index ] |= ISDONE\n                      if (setAtomID) vpAtomID[ index ] = idx\n                    } else if (setAtomID) {\n                      var ci2 = vpAtomID[ index ]\n\n                      ox = Math.floor(0.5 + scaleFactor * (coordList[ ci2 ] + ptran[0]))\n                      oy = Math.floor(0.5 + scaleFactor * (coordList[ ci2 + 1 ] + ptran[1]))\n                      oz = Math.floor(0.5 + scaleFactor * (coordList[ ci2 + 2 ] + ptran[2]))\n\n                      if (mi * mi + mj * mj + mk * mk < ox * ox + oy * oy + oz * oz) {\n                        vpAtomID[ index ] = idx\n                      }\n                    }\n                  } // k\n                } // if\n              } // kk\n            } // jj\n          } // ii\n        } // if\n\n        nind++\n      } // j\n    } // i\n  }\n\n  function fillvoxelswaals () {\n    var i, il\n\n    for (i = 0, il = vpBits.length; i < il; ++i) {\n      vpBits[ i ] &= ~ISDONE // not isdone\n    }\n\n    for (i = 0, il = coordList.length / 3; i < il; ++i) {\n      fillAtomWaals(i)\n    }\n  }\n\n  function buildboundary () {\n    var i, j, k\n    var pWH = pWidth * pHeight\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pHeight; ++j) {\n        for (k = 0; k < pWidth; ++k) {\n          var index = i * pWH + k * pHeight + j\n\n          if (vpBits[ index ] & INOUT) {\n            // var flagbound = false;\n            var ii = 0\n\n            // while( !flagbound && ii < 26 ){\n            while (ii < 26) {\n              var ti = i + nb[ ii ][ 0 ]\n              var tj = j + nb[ ii ][ 2 ]\n              var tk = k + nb[ ii ][ 1 ]\n\n              if (ti > -1 && ti < pLength &&\n                        tk > -1 && tk < pWidth &&\n                        tj > -1 && tj < pHeight &&\n                        !(vpBits[ ti * pWH + tk * pHeight + tj ] & INOUT)\n              ) {\n                vpBits[ index ] |= ISBOUND\n                // flagbound = true;\n                break\n              } else {\n                ii++\n              }\n            }\n          }\n        } // k\n      } // j\n    } // i\n  }\n\n  function fastdistancemap () {\n    console.time('EDTSurface fastdistancemap')\n\n    var i, j, k, n\n\n    var boundPoint = makeGrid(\n      pLength, pWidth, pHeight, Uint16Array, 3\n    )\n    var pWH = pWidth * pHeight\n    var cutRSq = cutRadius * cutRadius\n\n    var totalsurfacevox = 0\n    // var totalinnervox = 0;\n\n    var index\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pWidth; ++j) {\n        for (k = 0; k < pHeight; ++k) {\n          index = i * pWH + j * pHeight + k\n\n          vpBits[ index ] &= ~ISDONE\n\n          if (vpBits[ index ] & INOUT) {\n            if (vpBits[ index ] & ISBOUND) {\n              boundPoint.set(\n                i, j, k,\n                i, j, k\n              )\n\n              vpDistance[ index ] = 0\n              vpBits[ index ] |= ISDONE\n\n              totalsurfacevox += 1\n            }/* else{\n                totalinnervox += 1;\n            } */\n          }\n        }\n      }\n    }\n\n    var inarray = new Int32Array(3 * totalsurfacevox)\n    var positin = 0\n    var outarray = new Int32Array(3 * totalsurfacevox)\n    var positout = 0\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pWidth; ++j) {\n        for (k = 0; k < pHeight; ++k) {\n          index = i * pWH + j * pHeight + k\n\n          if (vpBits[ index ] & ISBOUND) {\n            inarray[ positin ] = i\n            inarray[ positin + 1 ] = j\n            inarray[ positin + 2 ] = k\n            positin += 3\n\n            vpBits[ index ] &= ~ISBOUND\n          }\n        }\n      }\n    }\n\n    do {\n      positout = fastoneshell(inarray, boundPoint, positin, outarray)\n      positin = 0\n\n      for (i = 0, n = positout; i < n; i += 3) {\n        index = pWH * outarray[ i ] + pHeight * outarray[ i + 1 ] + outarray[ i + 2 ]\n        vpBits[ index ] &= ~ISBOUND\n\n        if (vpDistance[ index ] <= 1.0404 * cutRSq) {\n          // if( vpDistance[ index ] <= 1.02 * cutRadius ){\n\n          inarray[ positin ] = outarray[ i ]\n          inarray[ positin + 1 ] = outarray[ i + 1 ]\n          inarray[ positin + 2 ] = outarray[ i + 2 ]\n          positin += 3\n        }\n      }\n    } while (positin > 0)\n\n    // var cutsf = Math.max( 0, scaleFactor - 0.5 );\n    // cutoff = cutRadius - 0.5 / ( 0.1 + cutsf );\n    var cutoffSq = cutoff * cutoff\n\n    var index2\n    var bp = new Uint16Array(3)\n\n    for (i = 0; i < pLength; ++i) {\n      for (j = 0; j < pWidth; ++j) {\n        for (k = 0; k < pHeight; ++k) {\n          index = i * pWH + j * pHeight + k\n          vpBits[ index ] &= ~ISBOUND\n\n          // ses solid\n\n          if (vpBits[ index ] & INOUT) {\n            if (!(vpBits[ index ] & ISDONE) ||\n              ((vpBits[ index ] & ISDONE) && vpDistance[ index ] >= cutoffSq)\n            ) {\n              vpBits[ index ] |= ISBOUND\n\n              if (setAtomID && (vpBits[ index ] & ISDONE)) {\n                boundPoint.toArray(i, j, k, bp)\n                index2 = bp[ 0 ] * pWH + bp[ 1 ] * pHeight + bp[ 2 ]\n\n                vpAtomID[ index ] = vpAtomID[ index2 ]\n              }\n            }\n          }\n        }\n      }\n    }\n\n    console.timeEnd('EDTSurface fastdistancemap')\n  }\n\n  function fastoneshell (inarray: Int32Array, boundPoint: iGrid, positin: number, outarray: Int32Array) {\n    // *allocout,voxel2\n    // ***boundPoint, int*\n    // outnum, int *elimi)\n    var tx, ty, tz\n    var dx, dy, dz\n    var i, j, n\n    var square\n    var index\n    var nbj\n    var bp = new Uint16Array(3)\n    var positout = 0\n\n    if (positin === 0) {\n      return positout\n    }\n\n    var tnvix = -1\n    var tnviy = -1\n    var tnviz = -1\n\n    var pWH = pWidth * pHeight\n\n    for (i = 0, n = positin; i < n; i += 3) {\n      tx = inarray[ i ]\n      ty = inarray[ i + 1 ]\n      tz = inarray[ i + 2 ]\n      boundPoint.toArray(tx, ty, tz, bp)\n\n      for (j = 0; j < 6; ++j) {\n        nbj = nb[ j ]\n        tnvix = tx + nbj[ 0 ]\n        tnviy = ty + nbj[ 1 ]\n        tnviz = tz + nbj[ 2 ]\n\n        if (tnvix < pLength && tnvix > -1 &&\n          tnviy < pWidth && tnviy > -1 &&\n          tnviz < pHeight && tnviz > -1\n        ) {\n          index = tnvix * pWH + pHeight * tnviy + tnviz\n\n          if ((vpBits[ index ] & INOUT) && !(vpBits[ index ] & ISDONE)) {\n            boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            vpDistance[ index ] = square\n            vpBits[ index ] |= ISDONE\n            vpBits[ index ] |= ISBOUND\n\n            outarray[ positout ] = tnvix\n            outarray[ positout + 1 ] = tnviy\n            outarray[ positout + 2 ] = tnviz\n            positout += 3\n          } else if ((vpBits[ index ] & INOUT) && (vpBits[ index ] & ISDONE)) {\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            if (square < vpDistance[ index ]) {\n              boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n              vpDistance[ index ] = square\n\n              if (!(vpBits[ index ] & ISBOUND)) {\n                vpBits[ index ] |= ISBOUND\n\n                outarray[ positout ] = tnvix\n                outarray[ positout + 1 ] = tnviy\n                outarray[ positout + 2 ] = tnviz\n                positout += 3\n              }\n            }\n          }\n        }\n      }\n    }\n\n    for (i = 0, n = positin; i < n; i += 3) {\n      tx = inarray[ i ]\n      ty = inarray[ i + 1 ]\n      tz = inarray[ i + 2 ]\n      boundPoint.toArray(tx, ty, tz, bp)\n\n      for (j = 6; j < 18; j++) {\n        nbj = nb[ j ]\n        tnvix = tx + nbj[ 0 ]\n        tnviy = ty + nbj[ 1 ]\n        tnviz = tz + nbj[ 2 ]\n\n        if (tnvix < pLength && tnvix > -1 &&\n          tnviy < pWidth && tnviy > -1 &&\n          tnviz < pHeight && tnviz > -1\n        ) {\n          index = tnvix * pWH + pHeight * tnviy + tnviz\n\n          if ((vpBits[index] & INOUT) && !(vpBits[index] & ISDONE)) {\n            boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            vpDistance[index] = square\n            vpBits[index] |= ISDONE\n            vpBits[index] |= ISBOUND\n\n            outarray[ positout ] = tnvix\n            outarray[ positout + 1 ] = tnviy\n            outarray[ positout + 2 ] = tnviz\n            positout += 3\n          } else if ((vpBits[index] & INOUT) && (vpBits[index] & ISDONE)) {\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            if (square < vpDistance[index]) {\n              boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n              vpDistance[index] = square\n\n              if (!(vpBits[index] & ISBOUND)) {\n                vpBits[index] |= ISBOUND\n\n                outarray[ positout ] = tnvix\n                outarray[ positout + 1 ] = tnviy\n                outarray[ positout + 2 ] = tnviz\n                positout += 3\n              }\n            }\n          }\n        }\n      }\n    }\n\n    for (i = 0, n = positin; i < n; i += 3) {\n      tx = inarray[ i ]\n      ty = inarray[ i + 1 ]\n      tz = inarray[ i + 2 ]\n      boundPoint.toArray(tx, ty, tz, bp)\n\n      for (j = 18; j < 26; j++) {\n        nbj = nb[ j ]\n        tnvix = tx + nbj[ 0 ]\n        tnviy = ty + nbj[ 1 ]\n        tnviz = tz + nbj[ 2 ]\n\n        if (tnvix < pLength && tnvix > -1 &&\n          tnviy < pWidth && tnviy > -1 &&\n          tnviz < pHeight && tnviz > -1\n        ) {\n          index = tnvix * pWH + pHeight * tnviy + tnviz\n\n          if ((vpBits[index] & INOUT) && !(vpBits[index] & ISDONE)) {\n            boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            vpDistance[index] = square\n            vpBits[index] |= ISDONE\n            vpBits[index] |= ISBOUND\n\n            outarray[ positout ] = tnvix\n            outarray[ positout + 1 ] = tnviy\n            outarray[ positout + 2 ] = tnviz\n            positout += 3\n          } else if ((vpBits[index] & INOUT) && (vpBits[index] & ISDONE)) {\n            dx = tnvix - bp[ 0 ]\n            dy = tnviy - bp[ 1 ]\n            dz = tnviz - bp[ 2 ]\n            square = dx * dx + dy * dy + dz * dz\n            // square = Math.sqrt( square );\n\n            if (square < vpDistance[index]) {\n              boundPoint.fromArray(tnvix, tnviy, tnviz, bp)\n              vpDistance[index] = square\n\n              if (!(vpBits[index] & ISBOUND)) {\n                vpBits[index] |= ISBOUND\n\n                outarray[ positout ] = tnvix\n                outarray[ positout + 1 ] = tnviy\n                outarray[ positout + 2 ] = tnviz\n                positout += 3\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return positout\n  }\n\n  function marchingcubeinit (stype: string) {\n    var i\n    var n = vpBits.length\n\n    if (stype === 'vws') {\n      for (i = 0; i < n; ++i) {\n        vpBits[ i ] &= ~ISBOUND\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    } else if (stype === 'ms') { // ses without vdw => ms\n      for (i = 0; i < n; ++i) {\n        vpBits[ i ] &= ~ISDONE\n        if (vpBits[ i ] & ISBOUND) {\n          vpBits[ i ] |= ISDONE\n        }\n        vpBits[ i ] &= ~ISBOUND\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    } else if (stype === 'ses') {\n      for (i = 0; i < n; ++i) {\n        if ((vpBits[ i ] & ISBOUND) && (vpBits[ i ] & ISDONE)) {\n          vpBits[ i ] &= ~ISBOUND\n        } else if ((vpBits[ i ] & ISBOUND) && !(vpBits[ i ] & ISDONE)) {\n          vpBits[ i ] |= ISDONE\n        }\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    } else if (stype === 'sas') {\n      for (i = 0; i < n; ++i) {\n        vpBits[ i ] &= ~ISBOUND\n        vpBits[ i ] = (vpBits[ i ] & ISDONE) ? 1 : 0\n      }\n    }\n  }\n}\nObject.assign(EDTSurface, {__deps: [\n  getSurfaceGrid, getRadiusDict, VolumeSurface, computeBoundingBox, makeGrid\n]})\n\nexport default EDTSurface\n","/**\n * @file AV Surface\n * @author Fred Ludlow <fred.ludlow@gmail.com>\n * @private\n */\n\nimport { getSurfaceGrid } from './surface-utils'\nimport { VolumeSurface } from './volume'\nimport { uniformArray } from '../math/array-utils'\nimport {\n  computeBoundingBox, v3multiplyScalar, v3cross, v3normalize\n} from '../math/vector-utils'\nimport { defaults } from '../utils'\nimport { NumberArray } from '../types';\n\n\n/**\n * Modifed from SpatialHash\n *\n * Main differences are:\n * - Optimized grid size to ensure we only ever need to look +/-1 cell\n * - Aware of atomic radii and will only output atoms within rAtom + rExtra\n *   (see withinRadii method)\n *\n * (Uses rounding rather than bitshifting as consequence of arbitrary grid size)\n * @class\n * @param {Float32Array} atomsX - x coordinates\n * @param {Float32Array} atomsY - y coordinates\n * @param {Float32Array} atomsZ - z coordinates\n * @param {Float32Array} atomsR - atom radii\n * @param {Float32Array} min - xyz min coordinates\n * @param {Float32Array} max - xyz max coordinates\n * @param {Float} maxDistance - max distance\n */\nexport interface iAVHash {\n  neighbourListLength: number\n  withinRadii: (x: number, y: number, z: number, rExtra: number, out: Int32Array) => void\n}\n\n\nfunction makeAVHash (atomsX: Float32Array, atomsY: Float32Array, atomsZ: Float32Array, atomsR: Float32Array, min: Float32Array, max: Float32Array, maxDistance: number): iAVHash {\n  maxDistance = Math.max(0.1, maxDistance) // Avoid maxDistance of zero, see #802\n  var nAtoms = atomsX.length\n\n  var minX = min[ 0 ]\n  var minY = min[ 1 ]\n  var minZ = min[ 2 ]\n\n  var maxX = max[ 0 ]\n  var maxY = max[ 1 ]\n  var maxZ = max[ 2 ]\n\n  function hashFunc (w: number, minW: number) {\n    return Math.floor((w - minW) / maxDistance)\n  }\n\n  var iDim = hashFunc(maxX, minX) + 1\n  var jDim = hashFunc(maxY, minY) + 1\n  var kDim = hashFunc(maxZ, minZ) + 1\n\n  var nCells = iDim * jDim * kDim\n\n  var jkDim = jDim * kDim\n\n  /* Get cellID for cartesian x,y,z */\n  var cellID = function (x: number, y: number, z: number) {\n    return (((hashFunc(x, minX) * jDim) + hashFunc(y, minY)) * kDim) + hashFunc(z, minZ)\n  }\n\n  /* Initial building, could probably be optimized further */\n  var preHash = [] // preHash[ cellID ] = [ atomId1, atomId2 ];\n\n  for (var i = 0; i < nAtoms; i++) {\n    var cid = cellID(atomsX[ i ], atomsY[ i ], atomsZ[ i ])\n\n    if (preHash[ cid ] === undefined) {\n      preHash[ cid ] = [ i ]\n    } else {\n      preHash[ cid ].push(i)\n    }\n  }\n\n  var cellOffsets = new Uint32Array(nCells)\n  var cellLengths = new Uint16Array(nCells)\n  var data = new Uint32Array(nAtoms)\n\n  var offset = 0\n  var maxCellLength = 0\n\n  for (i = 0; i < nCells; i++) {\n    var start = cellOffsets[ i ] = offset\n\n    var subArray = preHash[ i ]\n\n    if (subArray !== undefined) {\n      for (var j = 0; j < subArray.length; j++) {\n        data[ offset ] = subArray[ j ]\n        offset++\n      }\n    }\n\n    var cellLength = offset - start\n    cellLengths[ i ] = cellLength\n\n    if (cellLength > maxCellLength) { maxCellLength = cellLength }\n  }\n\n  // Maximum number of neighbours we could ever produce (27 adjacent cells of equal population)\n  const neighbourListLength = (27 * maxCellLength) + 1\n\n  /**\n   * Populate the supplied out array with atom indices that are within rAtom + rExtra\n   * of x,y,z\n   *\n   * -1 in out array indicates the end of the list\n   *\n   * @param  {Float} x - x coordinate\n   * @param  {Float} y - y coordinate\n   * @param  {Float} z - z coordinate\n   * @param  {Float} rExtra - additional radius\n   * @param  {Float32Array} out - pre-allocated output array\n   * @return {undefined}\n   */\n  const withinRadii = function (x: number, y: number, z: number, rExtra: number, out: Int32Array) {\n    var outIdx = 0\n\n    var nearI = hashFunc(x, minX)\n    var nearJ = hashFunc(y, minY)\n    var nearK = hashFunc(z, minZ)\n\n    var loI = Math.max(0, nearI - 1)\n    var loJ = Math.max(0, nearJ - 1)\n    var loK = Math.max(0, nearK - 1)\n\n    var hiI = Math.min(iDim, nearI + 2)\n    var hiJ = Math.min(jDim, nearJ + 2)\n    var hiK = Math.min(kDim, nearK + 2)\n\n    for (var i = loI; i < hiI; ++i) {\n      var iOffset = i * jkDim\n\n      for (var j = loJ; j < hiJ; ++j) {\n        var jOffset = j * kDim\n\n        for (var k = loK; k < hiK; ++k) {\n          var cid = iOffset + jOffset + k\n\n          var cellStart = cellOffsets[ cid ]\n          var cellEnd = cellStart + cellLengths[ cid ]\n\n          for (var dataIndex = cellStart; dataIndex < cellEnd; dataIndex++) {\n            var atomIndex = data[ dataIndex ]\n            var dx = atomsX[ atomIndex ] - x\n            var dy = atomsY[ atomIndex ] - y\n            var dz = atomsZ[ atomIndex ] - z\n            var rSum = atomsR[ atomIndex ] + rExtra\n\n            if ((dx * dx + dy * dy + dz * dz) <= (rSum * rSum)) {\n              out[ outIdx++ ] = data[ dataIndex ]\n            }\n          }\n        }\n      }\n    }\n    // Add terminator\n    out[ outIdx ] = -1\n  }\n  return {\n    neighbourListLength: neighbourListLength,\n    withinRadii: withinRadii\n  }\n}\n\ninterface AVSurface {\n  getSurface: (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) => any\n}\nfunction AVSurface (this: AVSurface, coordList: Float32Array, radiusList: Float32Array, indexList: Uint16Array|Uint32Array) {\n  // Field generation method adapted from AstexViewer (Mike Hartshorn)\n  // by Fred Ludlow.\n  // Other parts based heavily on NGL (Alexander Rose) EDT Surface class\n  //\n  // Should work as a drop-in alternative to EDTSurface (though some of\n  // the EDT paramters are not relevant in this method).\n\n  const nAtoms = radiusList.length\n\n  const x = new Float32Array(nAtoms)\n  const y = new Float32Array(nAtoms)\n  const z = new Float32Array(nAtoms)\n\n  for (let i = 0; i < nAtoms; i++) {\n    const ci = 3 * i\n    x[ i ] = coordList[ ci ]\n    y[ i ] = coordList[ ci + 1 ]\n    z[ i ] = coordList[ ci + 2 ]\n  }\n\n  let bbox = computeBoundingBox(coordList)\n  if (coordList.length === 0) {\n    bbox[ 0 ].set([ 0, 0, 0 ])\n    bbox[ 1 ].set([ 0, 0, 0 ])\n  }\n  const min = bbox[0]\n  const max = bbox[1]\n\n  let r: Float32Array, r2: Float32Array // Atom positions, expanded radii (squared)\n  let maxRadius: number\n\n  // Parameters\n  let probeRadius: number, scaleFactor: number, setAtomID: boolean, probePositions: number\n\n  // Cache last value for obscured test\n  let lastClip = -1\n\n  // Grid params\n  let dim: Float32Array, matrix: Float32Array, grid: NumberArray, atomIndex: Int32Array\n\n  // grid indices -> xyz coords\n  let gridx: Float32Array, gridy: Float32Array, gridz: Float32Array\n\n  // Lookup tables:\n  let sinTable: Float32Array, cosTable: Float32Array\n\n  // Spatial Hash\n  let hash: iAVHash\n\n  // Neighbour array to be filled by hash\n  let neighbours: Int32Array\n\n  // Vectors for Torus Projection\n  const atob = new Float32Array([ 0.0, 0.0, 0.0 ])\n  const mid = new Float32Array([ 0.0, 0.0, 0.0 ])\n  const n1 = new Float32Array([ 0.0, 0.0, 0.0 ])\n  const n2 = new Float32Array([ 0.0, 0.0, 0.0 ])\n\n  let ngTorus: number\n\n  function init (_probeRadius?: number, _scaleFactor?: number, _setAtomID?: boolean, _probePositions?: number) {\n    probeRadius = defaults(_probeRadius, 1.4)\n    scaleFactor = defaults(_scaleFactor, 2.0)\n    setAtomID = defaults(_setAtomID, true)\n    probePositions = defaults(_probePositions, 30)\n\n    r = new Float32Array(nAtoms)\n    r2 = new Float32Array(nAtoms)\n\n    for (let i = 0; i < r.length; ++i) {\n      var rExt = radiusList[ i ] + probeRadius\n      r[ i ] = rExt\n      r2[ i ] = rExt * rExt\n    }\n\n    maxRadius = 0\n    for (let j = 0; j < r.length; ++j) {\n      if (r[ j ] > maxRadius) maxRadius = r[ j ]\n    }\n\n    initializeGrid()\n    initializeAngleTables()\n    initializeHash()\n\n    lastClip = -1\n  }\n\n  function fillGridDim (a: Float32Array, start: number, step: number) {\n    for (let i = 0; i < a.length; i++) {\n      a[i] = start + (step * i)\n    }\n  }\n\n  function initializeGrid () {\n    const surfGrid = getSurfaceGrid(\n      min, max, maxRadius, scaleFactor, 0.0\n    )\n\n    scaleFactor = surfGrid.scaleFactor\n    dim = surfGrid.dim\n    matrix = surfGrid.matrix\n\n    ngTorus = Math.max(5, 2 + Math.floor(probeRadius * scaleFactor))\n\n    grid = uniformArray(dim[0] * dim[1] * dim[2], -1001.0)\n\n    atomIndex = new Int32Array(grid.length)\n\n    gridx = new Float32Array(dim[0])\n    gridy = new Float32Array(dim[1])\n    gridz = new Float32Array(dim[2])\n\n    fillGridDim(gridx, min[0], 1 / scaleFactor)\n    fillGridDim(gridy, min[1], 1 / scaleFactor)\n    fillGridDim(gridz, min[2], 1 / scaleFactor)\n  }\n\n  function initializeAngleTables () {\n    var theta = 0.0\n    var step = 2 * Math.PI / probePositions\n\n    cosTable = new Float32Array(probePositions)\n    sinTable = new Float32Array(probePositions)\n    for (var i = 0; i < probePositions; i++) {\n      cosTable[ i ] = Math.cos(theta)\n      sinTable[ i ] = Math.sin(theta)\n      theta += step\n    }\n  }\n\n  function initializeHash () {\n    hash = makeAVHash(x, y, z, r, min, max, 2.01 * maxRadius)\n    neighbours = new Int32Array(hash.neighbourListLength)\n  }\n\n  function obscured (x: number, y: number, z: number, a: number, b: number) {\n    // Is the point at x,y,z obscured by any of the atoms\n    // specifeid by indices in neighbours. Ignore indices\n    // a and b (these are the relevant atoms in projectPoints/Torii)\n\n    // Cache the last clipped atom (as very often the same one in\n    // subsequent calls)\n    let ai: number\n\n    if (lastClip !== -1) {\n      ai = lastClip\n      if (ai !== a && ai !== b && singleAtomObscures(ai, x, y, z)) {\n        return ai\n      } else {\n        lastClip = -1\n      }\n    }\n\n    var ni = 0\n    ai = neighbours[ ni ]\n    while (ai >= 0) {\n      if (ai !== a && ai !== b && singleAtomObscures(ai, x, y, z)) {\n        lastClip = ai\n        return ai\n      }\n      ai = neighbours[ ++ni ]\n    }\n\n    lastClip = -1\n\n    return -1\n  }\n\n  function singleAtomObscures (ai: number, x: number, y: number, z: number) {\n    var ci = 3 * ai\n    var ra2 = r2[ ai ]\n    var dx = coordList[ ci ] - x\n    var dy = coordList[ ci + 1 ] - y\n    var dz = coordList[ ci + 2 ] - z\n    var d2 = dx * dx + dy * dy + dz * dz\n\n    return d2 < ra2\n  }\n\n  function projectPoints () {\n    // For each atom:\n    //     Iterate over a subsection of the grid, for each point:\n    //         If current value < 0.0, unvisited, set positive\n    //\n    //         In any case: Project this point onto surface of the atomic sphere\n    //         If this projected point is not obscured by any other atom\n    //             Calcualte delta distance and set grid value to minimum of\n    //             itself and delta\n\n    // Should we alias frequently accessed closure variables??\n    // Assume JS engine capable of optimizing this\n    // anyway...\n\n    for (var i = 0; i < nAtoms; i++) {\n      var ax = x[ i ]\n      var ay = y[ i ]\n      var az = z[ i ]\n      var ar = r[ i ]\n      var ar2 = r2[ i ]\n\n      hash.withinRadii(ax, ay, az, ar, neighbours)\n\n      // Number of grid points, round this up...\n      var ng = Math.ceil(ar * scaleFactor)\n\n      // Center of the atom, mapped to grid points (take floor)\n      var iax = Math.floor(scaleFactor * (ax - min[ 0 ]))\n      var iay = Math.floor(scaleFactor * (ay - min[ 1 ]))\n      var iaz = Math.floor(scaleFactor * (az - min[ 2 ]))\n\n      // Extents of grid to consider for this atom\n      var minx = Math.max(0, iax - ng)\n      var miny = Math.max(0, iay - ng)\n      var minz = Math.max(0, iaz - ng)\n\n      // Add two to these points:\n      // - iax are floor'd values so this ensures coverage\n      // - these are loop limits (exclusive)\n      var maxx = Math.min(dim[ 0 ], iax + ng + 2)\n      var maxy = Math.min(dim[ 1 ], iay + ng + 2)\n      var maxz = Math.min(dim[ 2 ], iaz + ng + 2)\n\n      for (var ix = minx; ix < maxx; ix++) {\n        var dx = gridx[ ix ] - ax\n        var xoffset = dim[ 1 ] * dim[ 2 ] * ix\n\n        for (var iy = miny; iy < maxy; iy++) {\n          var dy = gridy[ iy ] - ay\n          var dxy2 = dx * dx + dy * dy\n          var xyoffset = xoffset + dim[ 2 ] * iy\n\n          for (var iz = minz; iz < maxz; iz++) {\n            var dz = gridz[ iz ] - az\n            var d2 = dxy2 + dz * dz\n\n            if (d2 < ar2) {\n              var idx = iz + xyoffset\n\n              if (grid[idx] < 0.0) {\n                // Unvisited, make positive\n                grid[ idx ] = -grid[ idx ]\n              }\n              // Project on to the surface of the sphere\n              // sp is the projected point ( dx, dy, dz ) * ( ra / d )\n              var d = Math.sqrt(d2)\n              var ap = ar / d\n              var spx = dx * ap\n              var spy = dy * ap\n              var spz = dz * ap\n\n              spx += ax\n              spy += ay\n              spz += az\n\n              if (obscured(spx, spy, spz, i, -1) === -1) {\n                var dd = ar - d\n                if (dd < grid[ idx ]) {\n                  grid[ idx ] = dd\n                  if (setAtomID) atomIndex[ idx ] = i\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  function projectTorii () {\n    for (var i = 0; i < nAtoms; i++) {\n      hash.withinRadii(x[ i ], y[ i ], z[ i ], r[ i ], neighbours)\n      var ia = 0\n      var ni = neighbours[ ia ]\n      while (ni >= 0) {\n        if (i < ni) {\n          projectTorus(i, ni)\n        }\n        ni = neighbours[ ++ia ]\n      }\n    }\n  }\n\n  function projectTorus (a: number, b: number) {\n    var r1 = r[ a ]\n    var r2 = r[ b ]\n    var dx = atob[ 0 ] = x[ b ] - x[ a ]\n    var dy = atob[ 1 ] = y[ b ] - y[ a ]\n    var dz = atob[ 2 ] = z[ b ] - z[ a ]\n    var d2 = dx * dx + dy * dy + dz * dz\n\n    // This check now redundant as already done in AVHash.withinRadii\n    // if( d2 > (( r1 + r2 ) * ( r1 + r2 )) ){ return; }\n\n    var d = Math.sqrt(d2)\n\n    // Find angle between a->b vector and the circle\n    // of their intersection by cosine rule\n    var cosA = (r1 * r1 + d * d - r2 * r2) / (2.0 * r1 * d)\n\n    // distance along a->b at intersection\n    var dmp = r1 * cosA\n\n    v3normalize(atob, atob)\n\n    // Create normal to line\n    normalToLine(n1 as any, atob)\n    v3normalize(n1, n1)\n\n    // Cross together for second normal vector\n    v3cross(n2, atob, n1)\n    v3normalize(n2, n2)\n\n    // r is radius of circle of intersection\n    var rInt = Math.sqrt(r1 * r1 - dmp * dmp)\n\n    v3multiplyScalar(n1, n1, rInt)\n    v3multiplyScalar(n2, n2, rInt)\n    v3multiplyScalar(atob, atob, dmp)\n\n    mid[ 0 ] = atob[ 0 ] + x[ a ]\n    mid[ 1 ] = atob[ 1 ] + y[ a ]\n    mid[ 2 ] = atob[ 2 ] + z[ a ]\n\n    lastClip = -1\n\n    var ng = ngTorus\n\n    for (var i = 0; i < probePositions; i++) {\n      var cost = cosTable[ i ]\n      var sint = sinTable[ i ]\n\n      var px = mid[ 0 ] + cost * n1[ 0 ] + sint * n2[ 0 ]\n      var py = mid[ 1 ] + cost * n1[ 1 ] + sint * n2[ 1 ]\n      var pz = mid[ 2 ] + cost * n1[ 2 ] + sint * n2[ 2 ]\n\n      if (obscured(px, py, pz, a, b) === -1) {\n        // As above, iterate over our grid...\n        // px, py, pz in grid coords\n        var iax = Math.floor(scaleFactor * (px - min[ 0 ]))\n        var iay = Math.floor(scaleFactor * (py - min[ 1 ]))\n        var iaz = Math.floor(scaleFactor * (pz - min[ 2 ]))\n\n        var minx = Math.max(0, iax - ng)\n        var miny = Math.max(0, iay - ng)\n        var minz = Math.max(0, iaz - ng)\n\n        var maxx = Math.min(dim[ 0 ], iax + ng + 2)\n        var maxy = Math.min(dim[ 1 ], iay + ng + 2)\n        var maxz = Math.min(dim[ 2 ], iaz + ng + 2)\n\n        for (var ix = minx; ix < maxx; ix++) {\n          dx = px - gridx[ ix ]\n          var xoffset = dim[ 1 ] * dim[ 2 ] * ix\n\n          for (var iy = miny; iy < maxy; iy++) {\n            dy = py - gridy[ iy ]\n            var dxy2 = dx * dx + dy * dy\n            var xyoffset = xoffset + dim[ 2 ] * iy\n\n            for (var iz = minz; iz < maxz; iz++) {\n              dz = pz - gridz[ iz ]\n              d2 = dxy2 + dz * dz\n              var idx = iz + xyoffset\n              var current = grid[ idx ]\n\n              if (current > 0.0 && d2 < (current * current)) {\n                grid[ idx ] = Math.sqrt(d2)\n                if (setAtomID) {\n                  // Is this grid point closer to a or b?\n                  // Take dot product of atob and gridpoint->p (dx, dy, dz)\n                  const dp = dx * atob[ 0 ] + dy * atob [ 1 ] + dz * atob[ 2 ]\n                  atomIndex[ idx ] = dp < 0.0 ? b : a\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  function normalToLine (out: Int32Array, p: Float32Array) {\n    out[ 0 ] = out[ 1 ] = out[ 2 ] = 1.0\n    if (p[ 0 ] !== 0) {\n      out[ 0 ] = (p[ 1 ] + p[ 2 ]) / -p[ 0 ]\n    } else if (p[ 1 ] !== 0) {\n      out[ 1 ] = (p[ 0 ] + p[ 2 ]) / -p[ 1 ]\n    } else if (p[ 2 ] !== 0) {\n      out[ 2 ] = (p[ 0 ] + p[ 1 ]) / -p[ 2 ]\n    }\n    return out\n  }\n\n  function fixNegatives () {\n    for (var i = 0; i < grid.length; i++) {\n      if (grid[ i ] < 0) grid[ i ] = 0\n    }\n  }\n\n  function fixAtomIDs () {\n    for (var i = 0; i < atomIndex.length; i++) {\n      atomIndex[ i ] = indexList[ atomIndex[ i ] ]\n    }\n  }\n\n  function getVolume (probeRadius: number, scaleFactor: number, setAtomID: boolean) {\n    // Basic steps are:\n    // 1) Initialize\n    // 2) Project points\n    // 3) Project torii\n\n    console.time('AVSurface.getVolume')\n\n    console.time('AVSurface.init')\n    init(probeRadius, scaleFactor, setAtomID)\n    console.timeEnd('AVSurface.init')\n\n    console.time('AVSurface.projectPoints')\n    projectPoints()\n    console.timeEnd('AVSurface.projectPoints')\n\n    console.time('AVSurface.projectTorii')\n    projectTorii()\n    console.timeEnd('AVSurface.projectTorii')\n    fixNegatives()\n    fixAtomIDs()\n\n    console.timeEnd('AVSurface.getVolume')\n  }\n\n  this.getSurface = function (type: string, probeRadius: number, scaleFactor: number, cutoff: number, setAtomID: boolean, smooth: number, contour: boolean) {\n    // type and cutoff left in for compatibility with EDTSurface.getSurface\n    // function signature\n\n    getVolume(probeRadius, scaleFactor, setAtomID)\n\n    var volsurf = new (VolumeSurface as any)(\n      grid, dim[ 2 ], dim[ 1 ], dim[ 0 ], atomIndex\n    ) as VolumeSurface\n\n    return volsurf.getSurface!(probeRadius, false, undefined, matrix, contour)\n  }\n}\nObject.assign(AVSurface, {__deps: [\n  getSurfaceGrid, VolumeSurface, uniformArray, computeBoundingBox,\n  v3multiplyScalar, v3cross, v3normalize,\n  makeAVHash,\n  defaults\n]})\n\nexport { AVSurface, makeAVHash }\n","/**\n * @file Molecular Surface\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { WorkerRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Worker from '../worker/worker'\nimport EDTSurface from './edt-surface'\nimport { AVSurface } from './av-surface'\nimport Surface, { SurfaceData } from './surface'\nimport { Structure } from '../ngl';\nimport { AtomData, RadiusParams } from '../structure/structure-data';\n\nWorkerRegistry.add('molsurf', function func (e: any, callback: (data: any, buffers: any[])=> void) {\n  const a = e.data.args\n  const p = e.data.params\n  if (a && p) {\n    const SurfClass = (p.type === 'av') ? AVSurface : EDTSurface\n    const surf = new (SurfClass as any)(a.coordList, a.radiusList, a.indexList) as AVSurface|EDTSurface\n    const sd = surf.getSurface(\n      p.type, p.probeRadius, p.scaleFactor, p.cutoff, true, p.smooth, p.contour\n    ) as SurfaceData\n    const transferList = [ sd.position.buffer, sd.index!.buffer ]\n    if (sd.normal) transferList.push(sd.normal.buffer)\n    if (sd.atomindex) transferList.push(sd.atomindex.buffer)\n    const data = {\n      sd: sd,\n      p: p\n    }\n    callback(data, transferList)\n  }\n}, [ EDTSurface, AVSurface ])\n\n/**\n * Molecular surface parameter object.\n * @typedef {Object} MolecularSurfaceParameters - stage parameters\n * @property {String} type - \"av\" or \"edt\"\n * @property {Number} probeRadius - probe radius\n * @property {Number} scaleFactor - higher for better quality\n * @property {Integer} smooth - number of smoothing cycles to apply\n * @property {String} name - name for created surface\n */\nexport interface MolecularSurfaceParameters {\n  type: 'av'|'edt'\n  probeRadius: number\n  scaleFactor: number\n  smooth: number\n  name: string\n  cutoff: number\n  contour: boolean,\n  radiusParams: RadiusParams\n}\n/**\n * Create Molecular surfaces\n */\nclass MolecularSurface {\n  structure: Structure\n  worker: Worker|undefined\n\n  constructor (structure: Structure) {\n    this.structure = structure\n  }\n\n  _getAtomData (params: Partial<MolecularSurfaceParameters>): AtomData {\n    return this.structure.getAtomData({\n      what: { position: true, radius: true, index: true },\n      radiusParams: defaults(params.radiusParams, {\n        type: 'vdw', scale: 1.0\n      })\n    })\n  }\n\n  _makeSurface (sd: SurfaceData, p: Partial<MolecularSurfaceParameters>) {\n    var surface = new Surface(p.name!, '', sd)\n\n    surface.info.type = p.type\n    surface.info.probeRadius = p.probeRadius\n    surface.info.scaleFactor = p.scaleFactor\n    surface.info.smooth = p.smooth\n    surface.info.cutoff = p.cutoff\n\n    return surface\n  }\n\n  /**\n   * Get molecular surface\n   * @param {MolecularSurfaceParameters} params - parameters for surface creation\n   * @return {Surface} the surface\n   */\n  getSurface (params: Partial<MolecularSurfaceParameters>) {\n    const p = params || {}\n\n    const atomData = this._getAtomData(params)\n    const coordList = atomData.position\n    const radiusList = atomData.radius\n    const indexList = atomData.index\n\n    const SurfClass = (p.type === 'av') ? AVSurface : EDTSurface\n    const surf = new (SurfClass as any)(coordList, radiusList, indexList) as AVSurface|EDTSurface\n    const sd = surf.getSurface(\n      p.type!, p.probeRadius!, p.scaleFactor!, p.cutoff!, true, p.smooth!, p.contour!\n    )\n\n    return this._makeSurface(sd, p)\n  }\n\n  /**\n   * Get molecular surface asynchronous\n   * @param {MolecularSurfaceParameters} params - parameters for surface creation\n   * @param {function(surface: Surface)} callback - function to be called after surface is created\n   * @return {undefined}\n   */\n  getSurfaceWorker (params: MolecularSurfaceParameters, callback: (s: Surface) => void) {\n    const p = Object.assign({}, params)\n\n    if (window.hasOwnProperty('Worker')) {\n      if (this.worker === undefined) {\n        this.worker = new Worker('molsurf')\n      }\n\n      const atomData = this._getAtomData(params)\n      const coordList = atomData.position\n      const radiusList = atomData.radius\n      const indexList = atomData.index\n\n      const msg = {\n        args: {\n          coordList: coordList,\n          radiusList: radiusList,\n          indexList: indexList\n        },\n        params: p\n      }\n\n      const transferList = [\n        coordList!.buffer, radiusList!.buffer, indexList!.buffer\n      ]\n\n      this.worker.post(msg, transferList,\n\n        (e: any) => {\n          callback(this._makeSurface(e.data.sd, p))\n        },\n\n        (e: string) => {\n          console.warn(\n            'MolecularSurface.getSurfaceWorker error - trying without worker', e\n          )\n          this.worker!.terminate()\n          this.worker = undefined\n          const surface = this.getSurface(p)\n          callback(surface)\n        }\n\n      )\n    } else {\n      const surface = this.getSurface(p)\n      callback(surface)\n    }\n  }\n\n  /**\n   * Cleanup\n   * @return {undefined}\n   */\n  dispose () {\n    if (this.worker) this.worker.terminate()\n  }\n}\n\nexport default MolecularSurface\n","/**\n * @file Molecular Surface Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport MolecularSurface, { MolecularSurfaceParameters } from '../surface/molecular-surface'\nimport SurfaceBuffer from '../buffer/surface-buffer'\nimport ContourBuffer from '../buffer/contour-buffer'\nimport DoubleSidedBuffer from '../buffer/doublesided-buffer'\nimport Selection from '../selection/selection'\nimport Viewer from '../viewer/viewer';\n// @ts-ignore: unused import Volume required for declaration only\nimport { Structure, Vector3, Volume } from '../ngl';\nimport StructureView from '../structure/structure-view';\nimport { SurfaceDataFields } from './surface-representation';\nimport Surface, {SurfaceData} from '../surface/surface';\n\nexport interface MolecularSurfaceRepresentationParameters extends StructureRepresentationParameters {\n  surfaceType: 'vws'|'sas'|'ms'|'ses'|'av'\n  probeRadius: number\n  smooth: number\n  scaleFactor: number\n  cutoff: number\n  contour: boolean\n  background: boolean\n  opaqueBack: boolean\n  filterSele: string\n  colorVolume: any\n  useWorker: boolean\n}\n\nexport interface MolecularSurfaceInfo {\n  molsurf?: MolecularSurface\n  sele?: string\n  surface?: Surface\n}\n\n/**\n * Molecular Surface Representation\n */\nclass MolecularSurfaceRepresentation extends StructureRepresentation {\n  protected surfaceType: 'vws'|'sas'|'ms'|'ses'|'av'\n  protected probeRadius: number\n  protected smooth: number\n  protected scaleFactor: number\n  protected cutoff: number\n  protected contour: boolean\n  protected background: boolean\n  protected opaqueBack: boolean\n  protected filterSele: string\n  protected colorVolume: any\n  protected useWorker: boolean\n\n  protected __infoList: MolecularSurfaceInfo[]\n  protected __forceNewMolsurf: boolean\n  protected __sele: string\n  protected __surfaceParams: string\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<MolecularSurfaceRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'surface'\n\n    this.parameters = Object.assign({\n\n      surfaceType: {\n        type: 'select',\n        rebuild: true,\n        options: {\n          'vws': 'vws',\n          'sas': 'sas',\n          'ms': 'ms',\n          'ses': 'ses',\n          'av': 'av'\n        }\n      },\n      probeRadius: {\n        type: 'number',\n        precision: 1,\n        max: 20,\n        min: 0,\n        rebuild: true\n      },\n      smooth: {\n        type: 'integer',\n        precision: 1,\n        max: 10,\n        min: 0,\n        rebuild: true\n      },\n      scaleFactor: {\n        type: 'number',\n        precision: 1,\n        max: 5,\n        min: 0,\n        rebuild: true\n      },\n      cutoff: {\n        type: 'number',\n        precision: 2,\n        max: 50,\n        min: 0,\n        rebuild: true\n      },\n      contour: {\n        type: 'boolean', rebuild: true\n      },\n      background: {\n        type: 'boolean', rebuild: true // FIXME\n      },\n      opaqueBack: {\n        type: 'boolean', buffer: true\n      },\n      filterSele: {\n        type: 'text', rebuild: true\n      },\n      colorVolume: {\n        type: 'hidden'\n      },\n      useWorker: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      radius: null,\n      scale: null\n\n    })\n\n    this.__infoList = []\n\n    // TODO find a more direct way\n    this.structure.signals.refreshed.add(() => {\n      this.__forceNewMolsurf = true\n    })\n\n    this.toBePrepared = true\n\n    this.init(params)\n  }\n\n  init (params: Partial<MolecularSurfaceRepresentationParameters>) {\n    const p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'uniform')\n    p.colorValue = defaults(p.colorValue, 0xDDDDDD)\n    p.disablePicking = defaults(p.disablePicking, true)\n\n    this.surfaceType = defaults(p.surfaceType, 'ms')\n    this.probeRadius = defaults(p.probeRadius, 1.4)\n    this.smooth = defaults(p.smooth, 2)\n    this.scaleFactor = defaults(p.scaleFactor, 2.0)\n    this.cutoff = defaults(p.cutoff, 0.0)\n    this.contour = defaults(p.contour, false)\n    this.background = defaults(p.background, false)\n    this.opaqueBack = defaults(p.opaqueBack, true)\n    this.filterSele = defaults(p.filterSele, '')\n    this.colorVolume = defaults(p.colorVolume, undefined)\n    this.useWorker = defaults(p.useWorker, true)\n\n    super.init(params)\n  }\n\n  prepareData (sview: StructureView, i: number, callback: (i: number) => void) {\n    let info: MolecularSurfaceInfo = this.__infoList[ i ]\n    if (!info) {\n      info = {}\n      this.__infoList[ i ] = info\n    }\n\n    if (!info.molsurf || info.sele !== sview.selection.string) {\n      if (this.filterSele) {\n        const sviewFilter = sview.structure.getView(new Selection(this.filterSele))\n        const bbSize = sviewFilter.boundingBox.getSize(new Vector3())\n        const maxDim = Math.max(bbSize.x, bbSize.y, bbSize.z)\n        const asWithin = sview.getAtomSetWithinPoint(sviewFilter.center, (maxDim / 2) + 6.0)\n        sview = sview.getView(\n          new Selection(sview.getAtomSetWithinSelection(asWithin, 3).toSeleString())\n        )\n        if (sview.atomCount === 0) {\n          callback(i)\n          return\n        }\n      }\n\n      info.sele = sview.selection.string\n      info.molsurf = new MolecularSurface(sview)\n\n      const p = this.getSurfaceParams()\n      const onSurfaceFinish = (surface: Surface) => {\n        info.surface = surface\n        callback(i)\n      }\n\n      if (this.useWorker) {\n        info.molsurf.getSurfaceWorker(p as MolecularSurfaceParameters, onSurfaceFinish)\n      } else {\n        onSurfaceFinish(info.molsurf.getSurface(p as {name: string, type: 'av'|'edt' } & MolecularSurfaceRepresentationParameters))\n      }\n    } else {\n      callback(i)\n    }\n  }\n\n  prepare (callback: () => void) {\n    if (this.__forceNewMolsurf || this.__sele !== this.selection.string ||\n          this.__surfaceParams !== JSON.stringify(this.getSurfaceParams())) {\n      this.__infoList.forEach((info: MolecularSurfaceInfo) => {\n        if (info && info.molsurf) {\n          info.molsurf.dispose()\n        }\n      })\n      this.__infoList.length = 0\n    }\n\n    if (this.structureView.atomCount === 0) {\n      callback()\n      return\n    }\n\n    const after = () => {\n      this.__sele = this.selection.string\n      this.__surfaceParams = JSON.stringify(this.getSurfaceParams())\n      this.__forceNewMolsurf = false\n      callback()\n    }\n\n    const name = this.assembly === 'default' ? this.defaultAssembly : this.assembly\n    const assembly = this.structure.biomolDict[ name ]\n\n    if (assembly) {\n      assembly.partList.forEach((part, i) => {\n        const sview = part.getView(this.structureView)\n        this.prepareData(sview as StructureView, i, (_i) => {\n          if (_i === assembly.partList.length - 1) after()\n        })\n      })\n    } else {\n      this.prepareData(this.structureView, 0, after)\n    }\n  }\n\n  createData (sview: StructureView, i: number) {\n    const info = this.__infoList[ i ]\n    const surface = info.surface\n\n    if (!surface) {\n      // Surface creation bailed (no surface generated for this sview)\n      return\n    }\n\n    const surfaceData = {\n      position: surface!.getPosition(),\n      color: surface!.getColor(this.getColorParams()),\n      index: surface!.getFilteredIndex(this.filterSele, sview)\n    }\n\n    const bufferList = []\n\n    if (surface.contour) {\n      const contourBuffer = new ContourBuffer(\n        surfaceData,\n        this.getBufferParams({\n          wireframe: false\n        })\n      )\n\n      bufferList.push(contourBuffer)\n    } else {\n      Object.assign(surfaceData, {\n        normal: surface.getNormal(),\n        picking: surface.getPicking(sview.getStructure())\n      })\n\n      const surfaceBuffer = new SurfaceBuffer(\n        surfaceData,\n        this.getBufferParams({\n          background: this.background,\n          opaqueBack: this.opaqueBack,\n          dullInterior: false\n        })\n      )\n\n      if (this.getBufferParams().side == 'double') {\n        const doubleSidedBuffer = new DoubleSidedBuffer(surfaceBuffer)\n        bufferList.push(doubleSidedBuffer)\n      }\n      else {\n        bufferList.push(surfaceBuffer)\n      }\n    }\n\n    return { bufferList, info } as StructureRepresentationData\n  }\n\n  updateData (what: SurfaceDataFields, data: StructureRepresentationData) {\n    const surfaceData: Partial<SurfaceData> = {}\n\n    if (what.position || what.radius) {\n      this.__forceNewMolsurf = true\n      this.build()\n      return\n    }\n\n    if (what.color) {\n      surfaceData.color = data.info.surface.getColor(this.getColorParams())\n    }\n\n    if (what.index) {\n      surfaceData.index = data.info.surface.getFilteredIndex(this.filterSele, data.sview)\n    }\n\n    data.bufferList[ 0 ].setAttributes(surfaceData)\n  }\n\n  setParameters (params: Partial<MolecularSurfaceRepresentationParameters>, what: Partial<SurfaceDataFields> = {}, rebuild?: boolean) {\n    if (params && params.filterSele) {\n      what.index = true\n    }\n\n    if (params && params.colorVolume !== undefined) {\n      what.color = true\n    }\n\n    // forbid setting wireframe to true when contour is true\n    if (params && params.wireframe && (\n      params.contour || (params.contour === undefined && this.contour)\n    )\n    ) {\n      params.wireframe = false\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n\n  getSurfaceParams (params: Partial<MolecularSurfaceRepresentationParameters> = {}) {\n    const p = Object.assign({\n      type: this.surfaceType as string,\n      probeRadius: this.probeRadius as number,\n      scaleFactor: this.scaleFactor as number,\n      smooth: this.smooth && !this.contour,\n      cutoff: this.cutoff as number,\n      contour: this.contour as boolean,\n      useWorker: this.useWorker as boolean,\n      radiusParams: this.getRadiusParams()\n    }, params)\n\n    return p\n  }\n\n  getColorParams () {\n    const p = super.getColorParams()\n\n    p.volume = this.colorVolume\n\n    return p\n  }\n\n  getAtomRadius () {\n    return 0\n  }\n\n  clear () {\n    super.clear()\n  }\n\n  dispose () {\n    this.__infoList.forEach((info: MolecularSurfaceInfo) => {\n      if (info && info.molsurf) {\n        info.molsurf.dispose()\n      }\n    })\n    this.__infoList.length = 0\n\n    super.dispose()\n  }\n}\n\nRepresentationRegistry.add('surface', MolecularSurfaceRepresentation)\n\nexport default MolecularSurfaceRepresentation\n","/**\n * @file Point Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport PointBuffer from '../buffer/point-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport { AtomDataFields } from '../structure/structure-data';\n\nexport interface PointRepresentationParameters extends StructureRepresentationParameters {\n  pointSize: number\n  sizeAttenuation: boolean\n  sortParticles: boolean\n  useTexture: boolean\n  alphaTest: number\n  forceTransparent: boolean\n  edgeBleach: number\n}\n\n/**\n * Point Representation\n */\nclass PointRepresentation extends StructureRepresentation {\n  protected pointSize: number\n  protected sizeAttenuation: boolean\n  protected sortParticles: boolean\n  protected useTexture: boolean\n  protected alphaTest: number\n  protected forceTransparent: boolean\n  protected edgeBleach: number\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<PointRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'point'\n\n    this.parameters = Object.assign({\n\n      pointSize: {\n        type: 'number', precision: 1, max: 100, min: 0, buffer: true\n      },\n      sizeAttenuation: {\n        type: 'boolean', buffer: true\n      },\n      sortParticles: {\n        type: 'boolean', rebuild: true\n      },\n      useTexture: {\n        type: 'boolean', buffer: true\n      },\n      alphaTest: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      },\n      forceTransparent: {\n        type: 'boolean', buffer: true\n      },\n      edgeBleach: {\n        type: 'range', step: 0.001, max: 1, min: 0, buffer: true\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      wireframe: null,\n      linewidth: null,\n      side: null,\n\n      roughness: null,\n      metalness: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<PointRepresentationParameters>) {\n    var p = params || {}\n\n    this.pointSize = defaults(p.pointSize, 1)\n    this.sizeAttenuation = defaults(p.sizeAttenuation, true)\n    this.sortParticles = defaults(p.sortParticles, false)\n    this.useTexture = defaults(p.useTexture, false)\n    this.alphaTest = defaults(p.alphaTest, 0.5)\n    this.forceTransparent = defaults(p.forceTransparent, false)\n    this.edgeBleach = defaults(p.edgeBleach, 0.0)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    var what = { position: true, color: true, picking: true }\n    var atomData = sview.getAtomData(this.getAtomParams(what))\n\n    var pointBuffer = new PointBuffer(\n      atomData,\n      this.getBufferParams({\n        pointSize: this.pointSize,\n        sizeAttenuation: this.sizeAttenuation,\n        sortParticles: this.sortParticles,\n        useTexture: this.useTexture,\n        alphaTest: this.alphaTest,\n        forceTransparent: this.forceTransparent,\n        edgeBleach: this.edgeBleach\n      })\n    )\n\n    return {\n      bufferList: [ pointBuffer ]\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    var atomData = data.sview!.getAtomData(this.getAtomParams(what))\n    var pointData = {}\n\n    if (!what || what.position) {\n      Object.assign(pointData, {position: atomData.position})\n    }\n\n    if (!what || what.color) {\n      Object.assign(pointData, {color: atomData.color})\n    }\n\n    data.bufferList[ 0 ].setAttributes(pointData)\n  }\n\n  getAtomRadius () {\n    return 0.1\n  }\n}\n\nRepresentationRegistry.add('point', PointRepresentation)\n\nexport default PointRepresentation\n","/**\n * @file Ribbon Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport '../shader/Ribbon.vert'\n\nimport { getUintArray } from '../utils'\nimport { serialArray } from '../math/array-utils'\nimport MeshBuffer from './mesh-buffer'\nimport { BufferParameters, BufferData } from './buffer'\nimport {Log} from \"../globals\";\n\nconst quadIndices = new Uint16Array([\n  0, 1, 2,\n  1, 3, 2\n])\n\nexport interface RibbonBufferData extends BufferData {\n  normal: Float32Array\n  dir: Float32Array\n  size: Float32Array\n}\n\nfunction getSize(data: RibbonBufferData){\n  const n = (data.position!.length / 3) - 1\n  const n4 = n * 4\n  const x = n4 * 3\n  return x\n}\n\n/**\n * Ribbon buffer. Draws a thin ribbon.\n */\nclass RibbonBuffer extends MeshBuffer {\n  vertexShader = 'Ribbon.vert'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.normal - normals\n   * @param  {Float32Array} data.dir - binormals\n   * @param  {Float32Array} data.color - colors\n   * @param  {Float32Array} data.size - sizes\n   * @param  {Picker} data.picking - picking ids\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: RibbonBufferData, params: Partial<BufferParameters> = {}) {\n    super({\n      position: new Float32Array(getSize(data)),\n      color: new Float32Array(getSize(data)),\n      index: getUintArray(getSize(data), getSize(data) / 3),\n      normal: new Float32Array(getSize(data)),\n      picking: data.picking\n    }, params)\n\n    const n = (data.position!.length / 3) - 1\n    const n4 = n * 4\n    const x = n4 * 3\n\n    this.addAttributes({\n      'dir': { type: 'v3', value: new Float32Array(x) }\n    })\n    this.addAttributes({\n      'size': { type: 'f', value: new Float32Array(n4) }\n    })\n\n    data.primitiveId = serialArray(n)\n    this.setAttributes(data)\n\n    this.makeIndex()\n  }\n\n  setAttributes (data: Partial<RibbonBufferData> = {}) {\n    const n4 = this.size\n    const n = n4 / 4\n\n    const attributes = this.geometry.attributes as any  // TODO\n\n    let position, normal, size, dir, color, primitiveId\n    let aPosition, aNormal, aSize, aDir, aColor, aPrimitiveId\n\n    if (data.position) {\n      position = data.position\n      aPosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    if (data.normal) {\n      normal = data.normal\n      aNormal = attributes.normal.array\n      attributes.normal.needsUpdate = true\n    }\n\n    if (data.size) {\n      size = data.size\n      aSize = attributes.size.array\n      attributes.size.needsUpdate = true\n    }\n\n    if (data.dir) {\n      dir = data.dir\n      aDir = attributes.dir.array\n      attributes.dir.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      aColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    if (data.primitiveId) {\n      primitiveId = data.primitiveId\n      aPrimitiveId = attributes.primitiveId.array\n      attributes.primitiveId.needsUpdate = true\n    }\n\n    let v, i, k, p, l, v3\n    let currSize\n    let prevSize = size ? size[ 0 ] : null\n\n    for (v = 0; v < n; ++v) {\n      v3 = v * 3\n      k = v * 3 * 4\n      l = v * 4\n\n      if (position) {\n        aPosition[ k ] = aPosition[ k + 3 ] = position[ v3 ]\n        aPosition[ k + 1 ] = aPosition[ k + 4 ] = position[ v3 + 1 ]\n        aPosition[ k + 2 ] = aPosition[ k + 5 ] = position[ v3 + 2 ]\n\n        aPosition[ k + 6 ] = aPosition[ k + 9 ] = position[ v3 + 3 ]\n        aPosition[ k + 7 ] = aPosition[ k + 10 ] = position[ v3 + 4 ]\n        aPosition[ k + 8 ] = aPosition[ k + 11 ] = position[ v3 + 5 ]\n      }\n\n      if (normal) {\n        aNormal[ k ] = aNormal[ k + 3 ] = -normal[ v3 ]\n        aNormal[ k + 1 ] = aNormal[ k + 4 ] = -normal[ v3 + 1 ]\n        aNormal[ k + 2 ] = aNormal[ k + 5 ] = -normal[ v3 + 2 ]\n\n        aNormal[ k + 6 ] = aNormal[ k + 9 ] = -normal[ v3 + 3 ]\n        aNormal[ k + 7 ] = aNormal[ k + 10 ] = -normal[ v3 + 4 ]\n        aNormal[ k + 8 ] = aNormal[ k + 11 ] = -normal[ v3 + 5 ]\n      }\n\n      for (i = 0; i < 4; ++i) {\n        p = k + 3 * i\n\n        if (color) {\n          aColor[ p ] = color[ v3 ]\n          aColor[ p + 1 ] = color[ v3 + 1 ]\n          aColor[ p + 2 ] = color[ v3 + 2 ]\n        }\n\n        if (primitiveId) {\n          aPrimitiveId[ l + i ] = primitiveId[ v ]\n        }\n      }\n\n      if (size) {\n        currSize = size[ v ]\n\n        if (prevSize !== size[ v ]) {\n          aSize[ l ] = prevSize\n          aSize[ l + 1 ] = prevSize\n          aSize[ l + 2 ] = currSize\n          aSize[ l + 3 ] = currSize\n        } else {\n          aSize[ l ] = currSize\n          aSize[ l + 1 ] = currSize\n          aSize[ l + 2 ] = currSize\n          aSize[ l + 3 ] = currSize\n        }\n\n        prevSize = currSize\n      }\n\n      if (dir) {\n        aDir[ k ] = dir[ v3 ]\n        aDir[ k + 1 ] = dir[ v3 + 1 ]\n        aDir[ k + 2 ] = dir[ v3 + 2 ]\n\n        aDir[ k + 3 ] = -dir[ v3 ]\n        aDir[ k + 4 ] = -dir[ v3 + 1 ]\n        aDir[ k + 5 ] = -dir[ v3 + 2 ]\n\n        aDir[ k + 6 ] = dir[ v3 + 3 ]\n        aDir[ k + 7 ] = dir[ v3 + 4 ]\n        aDir[ k + 8 ] = dir[ v3 + 5 ]\n\n        aDir[ k + 9 ] = -dir[ v3 + 3 ]\n        aDir[ k + 10 ] = -dir[ v3 + 4 ]\n        aDir[ k + 11 ] = -dir[ v3 + 5 ]\n      }\n    }\n  }\n\n  makeIndex () {\n    const index = this.geometry.getIndex()\n    if (!index) { Log.error('Index is null'); return; }\n    const meshIndex = index.array as Uint32Array|Uint16Array\n    const n = meshIndex.length / 4 / 3\n\n    for (let v = 0; v < n; ++v) {\n      const ix = v * 6\n      const it = v * 4\n\n      meshIndex.set(quadIndices, ix)\n      for (let s = 0; s < 6; ++s) {\n        meshIndex[ ix + s ] += it\n      }\n    }\n  }\n}\n\nexport default RibbonBuffer\n","/**\n * @file Ribbon Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Spline, { SplineParameters } from '../geometry/spline'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport RibbonBuffer from '../buffer/ribbon-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport Polymer from '../proxy/polymer';\n\nexport interface RibbonRepresentationParameters extends StructureRepresentationParameters {\n  subdiv: number\n  tension: number\n  smoothSheet: boolean\n}\n\n/**\n * Ribbon Representation\n */\nclass RibbonRepresentation extends StructureRepresentation {\n  protected subdiv: number\n  protected tension: number\n  protected smoothSheet: boolean\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<RibbonRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'ribbon'\n\n    this.parameters = Object.assign({\n\n      subdiv: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      tension: {\n        type: 'number', precision: 1, max: 1.0, min: 0.1\n      },\n      smoothSheet: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      side: null,\n      wireframe: null,\n      linewidth: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<RibbonRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'chainname')\n    p.colorScale = defaults(p.colorScale, 'RdYlBu')\n    p.radiusType = defaults(p.radiusType, 'sstruc')\n    p.radiusScale = defaults(p.radiusScale, 4.0)\n\n    if (p.quality === 'low') {\n      this.subdiv = 3\n    } else if (p.quality === 'medium') {\n      this.subdiv = 6\n    } else if (p.quality === 'high') {\n      this.subdiv = 12\n    } else {\n      this.subdiv = defaults(p.subdiv, 6)\n    }\n\n    this.tension = defaults(p.tension, NaN)\n    this.smoothSheet = defaults(p.smoothSheet, false)\n\n    super.init(p)\n  }\n\n  getSplineParams (params?: Partial<SplineParameters>) {\n    return Object.assign({\n      subdiv: this.subdiv,\n      tension: this.tension,\n      directional: true,\n      smoothSheet: this.smoothSheet\n    }, params)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return atom.isTrace() ? super.getAtomRadius(atom) : 0\n  }\n\n  createData (sview: StructureView) {\n    var bufferList: RibbonBuffer[] = []\n    var polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      var spline = new Spline(polymer, this.getSplineParams())\n      var subPos = spline.getSubdividedPosition()\n      var subOri = spline.getSubdividedOrientation()\n      var subCol = spline.getSubdividedColor(this.getColorParams())\n      var subPick = spline.getSubdividedPicking()\n      var subSize = spline.getSubdividedSize(this.getRadiusParams())\n\n      bufferList.push(\n        new RibbonBuffer(\n          ({\n            position: subPos.position,\n            normal: subOri.binormal,\n            dir: subOri.normal,\n            color: subCol.color,\n            size: subSize.size,\n            picking: subPick.picking\n          }),\n          this.getBufferParams()\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList,\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: {position?: boolean, radius?: boolean, scale?: boolean, color?: boolean}, data: {polymerList: Polymer[], bufferList: RibbonBuffer[]}) {\n    what = what || {}\n\n    var i = 0\n    var n = data.polymerList.length\n\n    for (i = 0; i < n; ++i) {\n      var bufferData = {}\n      var spline = new Spline(data.polymerList[ i ], this.getSplineParams())\n\n      if (what.position) {\n        var subPos = spline.getSubdividedPosition()\n        var subOri = spline.getSubdividedOrientation()\n        Object.assign(bufferData, {\n          position: subPos.position,\n          normal: subOri.binormal,\n          dir: subOri.normal\n        })\n      }\n\n      if (what.radius || what.scale) {\n        var subSize = spline.getSubdividedSize(this.getRadiusParams())\n        Object.assign(bufferData, {size: subSize.size})\n      }\n\n      if (what.color) {\n        var subCol = spline.getSubdividedColor(this.getColorParams())\n        Object.assign(bufferData, {color: subCol.color})\n      }\n\n      data.bufferList[ i ].setAttributes(bufferData)\n    }\n  }\n\n  setParameters (params: Partial<RibbonRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    if (params && params.tension) {\n      Object.assign(what, {position: true})\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('ribbon', RibbonRepresentation)\n\nexport default RibbonRepresentation\n","/**\n * @file Rocket Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { AtomPicker } from '../utils/picker'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport Helixbundle, { Axis } from '../geometry/helixbundle'\nimport CylinderBuffer from '../buffer/cylinder-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport CylinderImpostorBuffer from '../buffer/cylinderimpostor-buffer';\n\nexport interface RocketRepresentationParameters extends StructureRepresentationParameters {\n  localAngle: number\n  centerDist: number\n  ssBorder: boolean\n  radialSegments: number\n  openEnded: boolean\n  disableImpostor: boolean\n}\n\nexport interface AxisData {\n  begin: Float32Array\n  end: Float32Array\n  size: Float32Array\n  color: Float32Array\n  picking: AtomPicker\n}\n\n/**\n * Rocket Representation\n */\nclass RocketRepresentation extends StructureRepresentation {\n\n  protected localAngle: number\n  protected centerDist: number\n  protected ssBorder: boolean\n  protected radialSegments: number\n  protected openEnded: boolean\n  protected disableImpostor: boolean\n  // protected helixbundleList: Helixbundle[]\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<RocketRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'rocket'\n\n    this.parameters = Object.assign({\n\n      localAngle: {\n        type: 'integer', max: 180, min: 0, rebuild: true\n      },\n      centerDist: {\n        type: 'number', precision: 1, max: 10, min: 0, rebuild: true\n      },\n      ssBorder: {\n        type: 'boolean', rebuild: true\n      },\n      radialSegments: true,\n      openEnded: true,\n      disableImpostor: true\n\n    }, this.parameters)\n\n    // this.helixbundleList = []\n\n    this.init(params)\n  }\n\n  init (params: Partial<RocketRepresentationParameters>) {\n    let p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'sstruc')\n    p.radiusSize = defaults(p.radiusSize, 1.5)\n    p.radiusScale = defaults(p.radiusScale, 1.0)\n    p.openEnded = defaults(p.openEnded, false)\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    this.localAngle = defaults(p.localAngle, 30)\n    this.centerDist = defaults(p.centerDist, 2.5)\n    this.ssBorder = defaults(p.ssBorder, false)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    let length = 0\n    const axisList:Axis[] = []\n    const helixbundleList:Helixbundle[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4 || polymer.isNucleic()) return\n\n      const helixbundle = new Helixbundle(polymer)\n      const axis = helixbundle.getAxis(\n        this.localAngle, this.centerDist, this.ssBorder,\n        this.getColorParams(), this.getRadiusParams()\n      )\n\n      length += axis.size.length\n      axisList.push(axis)\n      helixbundleList.push(helixbundle)\n    }, sview.getSelection())\n\n    const axisData = {\n      begin: new Float32Array(length * 3),\n      end: new Float32Array(length * 3),\n      size: new Float32Array(length),\n      color: new Float32Array(length * 3),\n      picking: <AtomPicker>{}\n    }\n\n    let picking = new Float32Array(length)\n\n    let offset = 0\n\n    axisList.forEach(function (axis) {\n      axisData.begin.set(axis.begin, offset * 3)\n      axisData.end.set(axis.end, offset * 3)\n      axisData.size.set(axis.size, offset)\n      axisData.color.set(axis.color, offset * 3)\n      picking.set(axis.picking.array!, offset)\n      offset += axis.size.length\n    })\n\n    if (length) {\n      axisData.picking = new AtomPicker(\n        picking, sview.getStructure()\n      )\n    }\n\n    const cylinderBuffer = new CylinderBuffer(\n      {\n        position1: axisData.begin,\n        position2: axisData.end,\n        color: axisData.color,\n        color2: axisData.color,\n        radius: axisData.size,\n        picking: axisData.picking\n      },\n      this.getBufferParams({\n        openEnded: this.openEnded,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    return {\n      bufferList: [ cylinderBuffer as CylinderGeometryBuffer|CylinderImpostorBuffer ],\n      axisList: axisList,\n      helixbundleList: helixbundleList,\n      axisData: axisData\n    }\n  }\n\n  \n  updateData (what: any, data: {bufferList: CylinderBuffer[], helixbundleList: Helixbundle[], axisList: Axis[], axisData: AxisData}) {\n    what = what || {}\n\n    if (what.position) {\n      this.build()\n      return\n    }\n\n    var cylinderData = {}\n\n    if (what.color || what.radius) {\n      var offset = 0\n\n      data.helixbundleList.forEach((helixbundle) => {\n        var axis = helixbundle.getAxis(\n          this.localAngle, this.centerDist, this.ssBorder,\n          this.getColorParams(), this.getRadiusParams()\n        )\n        if (what.color) {\n          data.axisData.color.set(axis.color, offset * 3)\n        }\n        if (what.radius || what.scale) {\n          data.axisData.size.set(axis.size, offset)\n        }\n        offset += axis.size.length\n      })\n\n      if (what.color) {\n        Object.assign(cylinderData, {\n          color: data.axisData.color,\n          color2: data.axisData.color\n        })\n      }\n\n      if (what.radius || what.scale) {\n        Object.assign(cylinderData, {\n          radius: data.axisData.size\n        })\n      }\n    }\n\n    (data.bufferList[ 0 ] as CylinderGeometryBuffer).setAttributes(cylinderData)\n  }\n}\n\nRepresentationRegistry.add('rocket', RocketRepresentation)\n\nexport default RocketRepresentation\n","/**\n * @file Rope Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport CartoonRepresentation, { CartoonRepresentationParameters } from './cartoon-representation'\nimport Helixorient from '../geometry/helixorient'\nimport Spline from '../geometry/spline'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport Polymer from '../proxy/polymer';\n\n/**\n * Rope Representation\n */\nclass RopeRepresentation extends CartoonRepresentation {\n  protected smooth: number\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<CartoonRepresentationParameters>&{smooth: number}) {\n    super(structure, viewer, params)\n\n    this.type = 'rope'\n\n    this.parameters = Object.assign({\n\n      smooth: {\n        type: 'integer', max: 15, min: 0, rebuild: true\n      }\n\n    }, this.parameters, {\n      aspectRatio: null,\n      smoothSheet: null\n    })\n  }\n\n  init (params: Partial<CartoonRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = 1.0\n    p.tension = defaults(p.tension, 0.5)\n    p.radiusScale = defaults(p.radiusScale, 5.0)\n    p.smoothSheet = false\n\n    this.smooth = defaults(p.smooth, 2)\n\n    super.init(p)\n  }\n\n  getSpline (polymer: Polymer) {\n    var helixorient = new Helixorient(polymer)\n\n    return new Spline(polymer, this.getSplineParams({\n      directional: false,\n      positionIterator: helixorient.getCenterIterator(this.smooth)\n    }))\n  }\n}\n\nRepresentationRegistry.add('rope', RopeRepresentation)\n\nexport default RopeRepresentation\n","/**\n * @file Spacefill Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { RepresentationRegistry } from '../globals'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport { AtomDataFields } from '../structure/structure-data';\nimport SphereImpostorBuffer from '../buffer/sphereimpostor-buffer';\n\n/**\n * Spacefill Representation\n */\nclass SpacefillRepresentation extends StructureRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'spacefill'\n\n    this.parameters = Object.assign({\n      sphereDetail: true,\n      disableImpostor: true\n    }, this.parameters)\n\n    this.init(params)\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    var p = params || {}\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    var sphereBuffer = new SphereBuffer(\n      (sview.getAtomData(this.getAtomParams()) as SphereBufferData),\n      (this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        dullInterior: true,\n        disableImpostor: this.disableImpostor\n      }) as SphereBufferParameters)\n    )\n\n    return {\n      bufferList: [ sphereBuffer as SphereGeometryBuffer|SphereImpostorBuffer ]\n    }\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    var atomData = data.sview!.getAtomData(this.getAtomParams(what))\n    var sphereData: Partial<SphereBufferData> = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {position: atomData.position})\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {color: atomData.color})\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {radius: atomData.radius})\n    }\n\n    data.bufferList[ 0 ].setAttributes(sphereData)\n  }\n}\n\nRepresentationRegistry.add('spacefill', SpacefillRepresentation)\n\nexport default SpacefillRepresentation\n","/**\n * @file Trace Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport '../shader/Line.vert'\nimport '../shader/Line.frag'\n\nimport { Log } from '../globals'\nimport Buffer, { BufferParameters, BufferData } from './buffer'\n\nfunction getSize(data: BufferData){\n  const n = data.position!.length / 3\n  const n1 = n - 1\n  return n1 * 3 * 2\n}\n\n/**\n * Trace buffer. Draws a series of lines.\n */\nclass TraceBuffer extends Buffer {\n  isLine = true\n  vertexShader = 'Line.vert'\n  fragmentShader = 'Line.frag'\n\n  /**\n   * @param  {Object} data - attribute object\n   * @param  {Float32Array} data.position - positions\n   * @param  {Float32Array} data.color - colors\n   * @param  {BufferParameters} params - parameter object\n   */\n  constructor (data: BufferData, params: Partial<BufferParameters> = {}) {\n    super({\n      position: new Float32Array(getSize(data)),\n      color: new Float32Array(getSize(data))\n    }, params)\n\n    this.setAttributes(data)\n  }\n\n  setAttributes (data: Partial<BufferData>) {\n    let position, color\n    let linePosition, lineColor\n\n    const attributes = this.geometry.attributes as any  // TODO\n\n    if (data.position) {\n      position = data.position\n      linePosition = attributes.position.array\n      attributes.position.needsUpdate = true\n    }\n\n    if (data.color) {\n      color = data.color\n      lineColor = attributes.color.array\n      attributes.color.needsUpdate = true\n    }\n\n    if (!position && !color) {\n      Log.warn('TraceBuffer.prototype.setAttributes no data')\n      return\n    }\n\n    let v, v2\n    const n = this.size\n    const n1 = n - 1\n\n    for (let i = 0; i < n1; ++i) {\n      v = 3 * i\n      v2 = 3 * i * 2\n\n      if (position) {\n        linePosition[ v2 ] = position[ v ]\n        linePosition[ v2 + 1 ] = position[ v + 1 ]\n        linePosition[ v2 + 2 ] = position[ v + 2 ]\n\n        linePosition[ v2 + 3 ] = position[ v + 3 ]\n        linePosition[ v2 + 4 ] = position[ v + 4 ]\n        linePosition[ v2 + 5 ] = position[ v + 5 ]\n      }\n\n      if (color) {\n        lineColor[ v2 ] = color[ v ]\n        lineColor[ v2 + 1 ] = color[ v + 1 ]\n        lineColor[ v2 + 2 ] = color[ v + 2 ]\n\n        lineColor[ v2 + 3 ] = color[ v + 3 ]\n        lineColor[ v2 + 4 ] = color[ v + 4 ]\n        lineColor[ v2 + 5 ] = color[ v + 5 ]\n      }\n    }\n  }\n}\n\nexport default TraceBuffer\n","/**\n * @file Trace Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Spline from '../geometry/spline'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport TraceBuffer from '../buffer/trace-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport AtomProxy from '../proxy/atom-proxy';\nimport StructureView from '../structure/structure-view';\nimport Polymer from '../proxy/polymer';\n\nexport interface TraceRepresentationParameters extends StructureRepresentationParameters {\n  subdiv: number\n  tension: number\n  smoothSheet: boolean\n}\n/**\n * Trace Representation\n */\nclass TraceRepresentation extends StructureRepresentation {\n  protected subdiv: number\n  protected tension: number\n  protected smoothSheet: boolean\n  \n  constructor (structure: Structure, viewer: Viewer, params: Partial<TraceRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'trace'\n\n    this.parameters = Object.assign({\n\n      subdiv: {\n        type: 'integer', max: 50, min: 1, rebuild: true\n      },\n      tension: {\n        type: 'number', precision: 1, max: 1.0, min: 0.1\n      },\n      smoothSheet: {\n        type: 'boolean', rebuild: true\n      }\n\n    }, this.parameters, {\n\n      flatShaded: null,\n      side: null,\n      wireframe: null\n\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<TraceRepresentationParameters>) {\n    var p = params || {}\n    p.colorScheme = defaults(p.colorScheme, 'chainname')\n    p.colorScale = defaults(p.colorScale, 'RdYlBu')\n\n    if (p.quality === 'low') {\n      this.subdiv = 3\n    } else if (p.quality === 'medium') {\n      this.subdiv = 6\n    } else if (p.quality === 'high') {\n      this.subdiv = 12\n    } else {\n      this.subdiv = defaults(p.subdiv, 6)\n    }\n\n    this.tension = defaults(p.tension, NaN)\n    this.smoothSheet = defaults(p.smoothSheet, false)\n\n    super.init(p)\n  }\n\n  getSplineParams (params?: {[k:string]: any}) {\n    return Object.assign({\n      subdiv: this.subdiv,\n      tension: this.tension,\n      directional: false,\n      smoothSheet: this.smoothSheet\n    }, params)\n  }\n\n  getAtomRadius (atom: AtomProxy) {\n    return atom.isTrace() ? 0.1 : 0\n  }\n\n  createData (sview: StructureView) {\n    var bufferList: TraceBuffer[] = []\n    var polymerList: Polymer[] = []\n\n    this.structure.eachPolymer(polymer => {\n      if (polymer.residueCount < 4) return\n      polymerList.push(polymer)\n\n      var spline = new Spline(polymer, this.getSplineParams())\n      var subPos = spline.getSubdividedPosition()\n      var subCol = spline.getSubdividedColor(this.getColorParams())\n\n      bufferList.push(\n        new TraceBuffer(\n          Object.assign({}, subPos, subCol),\n          this.getBufferParams()\n        )\n      )\n    }, sview.getSelection())\n\n    return {\n      bufferList: bufferList,\n      polymerList: polymerList\n    }\n  }\n\n  updateData (what: any, data: StructureRepresentationData) {\n    what = what || {}\n\n    var i = 0\n    var n = data.polymerList!.length\n\n    for (i = 0; i < n; ++i) {\n      var bufferData = {}\n      var spline = new Spline(data.polymerList![ i ], this.getSplineParams())\n\n      if (what.position) {\n        var subPos = spline.getSubdividedPosition()\n        Object.assign(bufferData, { position: subPos.position })\n      }\n\n      if (what.color) {\n        var subCol = spline.getSubdividedColor(this.getColorParams())\n        Object.assign(bufferData, { color: subCol.color })\n      }\n\n      data.bufferList[ i ].setAttributes(bufferData)\n    }\n  }\n\n  setParameters (params: Partial<TraceRepresentationParameters>) {\n    var rebuild = false\n    var what = {}\n\n    if (params && params.tension) {\n      Object.assign(what, {position: true})\n    }\n\n    super.setParameters(params, what, rebuild)\n\n    return this\n  }\n}\n\nRepresentationRegistry.add('trace', TraceRepresentation)\n\nexport default TraceRepresentation\n","/**\n * @file Tube Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport CartoonRepresentation, {CartoonRepresentationParameters} from './cartoon-representation'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\n\n/**\n * Tube Representation\n */\nclass TubeRepresentation extends CartoonRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<CartoonRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'tube'\n\n    this.parameters = Object.assign(\n      {}, this.parameters, { aspectRatio: null }\n    )\n  }\n\n  init (params: Partial<CartoonRepresentationParameters>) {\n    var p = params || {}\n    p.aspectRatio = 1.0\n    p.radiusScale = defaults(p.radiusScale, 2.0)\n\n    if (p.quality === 'low') {\n      this.radialSegments = 5\n    }\n\n    super.init(p)\n  }\n\n  getSplineParams (/* params */) {\n    return super.getSplineParams({\n      directional: false\n    })\n  }\n}\n\nRepresentationRegistry.add('tube', TubeRepresentation)\n\nexport default TubeRepresentation\n","/**\n * @file Unitcell Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters, StructureRepresentationData } from './structure-representation'\nimport SphereBuffer, { SphereBufferData, SphereBufferParameters } from '../buffer/sphere-buffer'\nimport CylinderBuffer, { CylinderBufferData } from '../buffer/cylinder-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport { AtomDataFields } from '../structure/structure-data';\nimport StructureView from '../structure/structure-view';\nimport SphereGeometryBuffer from '../buffer/spheregeometry-buffer';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\n// @ts-ignore: unused import UnitcellPicker required for declaration only\nimport { UnitcellPicker } from '../utils/picker';\n\nexport interface UnitcellRepresentationParameters extends StructureRepresentationParameters {\n  radiusSize: number\n  sphereDetail: number\n  radialSegments: number\n  disableImpostor: boolean\n}\n\n/**\n * Unitcell Representation\n */\nclass UnitcellRepresentation extends StructureRepresentation {\n  sphereBuffer: SphereBuffer\n  cylinderBuffer: CylinderBuffer\n\n  constructor (structure: Structure, viewer: Viewer, params: Partial<UnitcellRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'unitcell'\n\n    this.parameters = Object.assign({\n\n      radiusSize: {\n        type: 'number', precision: 3, max: 10.0, min: 0.001\n      },\n      sphereDetail: true,\n      radialSegments: true,\n      disableImpostor: true\n\n    }, this.parameters, {\n      assembly: null\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<UnitcellRepresentationParameters>) {\n    const p = params || {}\n\n    let defaultRadius = 0.5\n    if (this.structure.unitcell) {\n      defaultRadius = Math.cbrt(this.structure.unitcell.volume) / 200\n    }\n\n    p.radiusSize = defaults(p.radiusSize, defaultRadius)\n    p.colorValue = defaults(p.colorValue, 'orange')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  getUnitcellData (structure: Structure) {\n    return structure.unitcell!.getData(structure)\n  }\n\n  create () {\n    const structure = this.structureView.getStructure()\n    if (!structure.unitcell) return\n    const unitcellData = this.getUnitcellData(structure)\n\n    this.sphereBuffer = new SphereBuffer(\n      unitcellData.vertex as SphereBufferData,\n      this.getBufferParams({\n        sphereDetail: this.sphereDetail,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      }) as SphereBufferParameters\n    )\n\n    this.cylinderBuffer = new CylinderBuffer(\n      unitcellData.edge as CylinderBufferData,\n      this.getBufferParams({\n        openEnded: true,\n        radialSegments: this.radialSegments,\n        disableImpostor: this.disableImpostor,\n        dullInterior: true\n      })\n    )\n\n    this.dataList.push({\n      sview: this.structureView,\n      bufferList: [ this.sphereBuffer as SphereGeometryBuffer, this.cylinderBuffer as CylinderGeometryBuffer ]\n    })\n  }\n\n  createData (sview: StructureView): undefined {\n    return\n  }\n\n  updateData (what: AtomDataFields, data: StructureRepresentationData) {\n    const structure = data.sview!.getStructure()\n    if (!structure.unitcell) return\n    const unitcellData = this.getUnitcellData(structure)\n    const sphereData: Partial<SphereBufferData> = {}\n    const cylinderData: Partial<CylinderBufferData> = {}\n\n    if (!what || what.position) {\n      Object.assign(sphereData, {position: unitcellData.vertex.position})\n      Object.assign(cylinderData, {\n        position1: unitcellData.edge.position1,\n        position2: unitcellData.edge.position2\n      })\n    }\n\n    if (!what || what.color) {\n      Object.assign(sphereData, {color: unitcellData.vertex.color})\n      Object.assign(cylinderData, {\n        color: unitcellData.edge.color,\n        color2: unitcellData.edge.color2\n      })\n    }\n\n    if (!what || what.radius) {\n      Object.assign(sphereData, {radius: unitcellData.vertex.radius})\n      Object.assign(cylinderData, {radius: unitcellData.edge.radius})\n    }\n\n    (this.sphereBuffer as SphereGeometryBuffer).setAttributes(sphereData);\n    (this.cylinderBuffer as CylinderGeometryBuffer).setAttributes(cylinderData)\n  }\n}\n\nRepresentationRegistry.add('unitcell', UnitcellRepresentation)\n\nexport default UnitcellRepresentation\n","/**\n * @file Validation Representation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { RepresentationRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureRepresentation, { StructureRepresentationParameters } from './structure-representation'\nimport CylinderBuffer from '../buffer/cylinder-buffer'\nimport { Structure } from '../ngl';\nimport Viewer from '../viewer/viewer';\nimport StructureView from '../structure/structure-view';\nimport CylinderGeometryBuffer from '../buffer/cylindergeometry-buffer';\nimport CylinderImpostorBuffer from '../buffer/cylinderimpostor-buffer';\n\n/**\n * Validation representation\n */\nclass ValidationRepresentation extends StructureRepresentation {\n  constructor (structure: Structure, viewer: Viewer, params: Partial<StructureRepresentationParameters>) {\n    super(structure, viewer, params)\n\n    this.type = 'validation'\n\n    this.parameters = Object.assign({\n\n    }, this.parameters, {\n      radiusType: null,\n      radiusSize: null,\n      radiusScale: null\n    })\n\n    this.init(params)\n  }\n\n  init (params: Partial<StructureRepresentationParameters>) {\n    const p = params || {}\n    p.colorValue = defaults(p.colorValue, '#f0027f')\n    p.useInteriorColor = defaults(p.useInteriorColor, true)\n\n    super.init(p)\n  }\n\n  createData (sview: StructureView) {\n    if (!sview.validation) return\n\n    const clashData = sview.validation.getClashData({\n      structure: sview,\n      color: this.colorValue\n    })\n\n    const cylinderBuffer = new CylinderBuffer(\n      clashData, this.getBufferParams({ openEnded: false })\n    )\n\n    return {\n      bufferList: [ cylinderBuffer as CylinderGeometryBuffer|CylinderImpostorBuffer ]\n    }\n  }\n}\n\nRepresentationRegistry.add('validation', ValidationRepresentation)\n\nexport default ValidationRepresentation\n","/**\n * @file Cone Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, ConeBufferGeometry } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport { calculateCenterArray } from '../math/array-utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferDefaultParameters } from './buffer'\n\nconst scale = new Vector3()\nconst eye = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3(0, 1, 0)\n\nfunction getGeo (params: Partial<ConeBufferParameters> = {}) {\n  const geo = new ConeBufferGeometry(\n    1,  // radius\n    1,  // height\n    defaults(params.radialSegments, 60),  // radialSegments\n    1,  // heightSegments\n    defaults(params.openEnded, false)  // openEnded\n  )\n  geo.applyMatrix4(new Matrix4().makeRotationX(-Math.PI / 2))\n\n  return geo\n}\n\nexport interface ConeBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  radius: Float32Array\n}\n\nexport const ConeBufferDefaultParameters = Object.assign({\n  radialSegments: 60,\n  openEnded: false\n}, BufferDefaultParameters)\nexport type ConeBufferParameters = typeof ConeBufferDefaultParameters\n\n\n/**\n * Cone geometry buffer.\n *\n * @example\n * var coneBuffer = new ConeBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 1, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   color2: new Float32Array([ 0, 1, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass ConeBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return ConeBufferDefaultParameters }\n  parameters: ConeBufferParameters\n\n  _position: Float32Array\n  _position1: Float32Array\n  _position2: Float32Array\n  _radius: Float32Array\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position1 - from positions\n   * @param {Float32Array} data.position2 - to positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: ConeBufferData, params: Partial<ConeBufferParameters> = {}) {\n    super({\n      position: new Float32Array(data.position1.length),\n      color: data.color,\n      picking: data.picking\n    }, params, getGeo(params))\n\n    this._position = new Float32Array(data.position1.length)\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    eye.fromArray(this._position1 as any, i3)\n    target.fromArray(this._position2 as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    const r = this._radius[ i ]\n    scale.set(r, r, eye.distanceTo(target))\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<ConeBufferData> = {}, initNormals?: boolean) {\n    if (data.position1 && data.position2) {\n      calculateCenterArray(data.position1, data.position2, this._position)\n      this._position1 = data.position1\n      this._position2 = data.position2\n      data.position = this._position\n    }\n    if (data.radius) this._radius = data.radius\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('cone', ConeBuffer)\n\nexport default ConeBuffer\n","/**\n * @file Geometry Group\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Box3, BufferGeometry } from 'three'\n\nclass GeometryGroup {\n  geometryList: BufferGeometry[]\n  boundingBox: Box3\n\n  constructor (geometryList: BufferGeometry[] = []) {\n    this.geometryList = geometryList\n  }\n\n  computeBoundingBox () {\n    if (!this.boundingBox) {\n      this.boundingBox = new Box3()\n    } else {\n      this.boundingBox.empty()\n    }\n\n    this.geometryList.forEach(geo => {\n      if (!geo.boundingBox) geo.computeBoundingBox()\n      this.boundingBox.union(geo.boundingBox as Box3)\n    })\n  }\n}\n\nexport default GeometryGroup\n","/**\n * @file Arrow Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3, Group } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { createParams, defaults } from '../utils'\nimport { Picker } from '../utils/picker'\nimport Buffer from './buffer'\nimport CylinderBuffer, { CylinderBufferData } from './cylinder-buffer'\nimport CylinderGeometryBuffer from './cylindergeometry-buffer'\nimport ConeBuffer, { ConeBufferData } from './cone-buffer'\nimport GeometryGroup from '../viewer/geometry-group'\nimport { BufferData, BufferDefaultParameters } from './buffer'\n\nexport interface ArrowBufferData extends BufferData {\n  position1: Float32Array\n  position2: Float32Array\n  radius: Float32Array\n}\n\nexport const ArrowBufferDefaultParameters = Object.assign({\n  aspectRatio: 1.5,\n  radialSegments: 50,\n  openEnded: false,\n  disableImpostor: false\n}, BufferDefaultParameters)\nexport type ArrowBufferParameters = typeof ArrowBufferDefaultParameters\n\n/**\n * Arrow buffer. Draws arrows made from a cylinder and a cone.\n * @implements {Buffer}\n *\n * @example\n * var arrowBuffer = new ArrowBuffer({\n *   position1: new Float32Array([ 0, 0, 0 ]),\n *   position2: new Float32Array([ 10, 1, 1 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ])\n * });\n */\nclass ArrowBuffer {\n  parameters: ArrowBufferParameters\n  get defaultParameters() { return ArrowBufferDefaultParameters }\n\n  cylinderBuffer: CylinderGeometryBuffer\n  coneBuffer: ConeBuffer\n\n  splitPosition: Float32Array\n  cylinderRadius: Float32Array\n\n  geometry: GeometryGroup\n  picking?: Picker\n\n  group = new Group()\n  wireframeGroup = new Group()\n  pickingGroup = new Group()\n\n  visible = true\n\n  /**\n   * @param {Object} data - buffer data\n   * @param {Float32Array} data.position1 - from positions\n   * @param {Float32Array} data.position2 - to positions\n   * @param {Float32Array} data.color - colors\n   * @param {Float32Array} data.radius - radii\n   * @param {Picker} [data.picking] - picking ids\n   * @param {BufferParameters} [params] - parameters object\n   */\n  constructor (data: ArrowBufferData, params: Partial<ArrowBufferParameters> = {}) {\n    this.parameters = createParams(params, this.defaultParameters)\n\n    this.splitPosition = new Float32Array(data.position1.length)\n    this.cylinderRadius = new Float32Array(data.radius.length)\n\n    const attr = this.makeAttributes(data)\n    const bufferParams = {\n      radialSegments: this.parameters.radialSegments,\n      openEnded: this.parameters.openEnded,\n      disableImpostor: this.parameters.disableImpostor\n    }\n\n    this.cylinderBuffer = new CylinderBuffer(\n      attr.cylinder as CylinderBufferData, bufferParams\n    ) as CylinderGeometryBuffer\n    this.coneBuffer = new ConeBuffer(\n      attr.cone as ConeBufferData, bufferParams\n    )\n\n    this.geometry = new GeometryGroup([\n      this.cylinderBuffer.geometry,\n      this.coneBuffer.geometry\n    ])\n\n    // requires Group objects to be present\n    this.matrix = defaults(params.matrix, new Matrix4())\n\n    this.picking = data.picking\n  }\n\n  set matrix (m) {\n    Buffer.prototype.setMatrix.call(this, m)\n  }\n  get matrix () {\n    return this.group.matrix.clone()\n  }\n\n  get pickable () {\n    return !!this.picking\n  }\n\n  makeAttributes (data: Partial<ArrowBufferData> = {}) {\n    const splitPosition = this.splitPosition\n    const cylinderRadius = this.cylinderRadius\n\n    const aspectRatio = this.parameters.aspectRatio\n\n    let i, il\n    const cylinder: Partial<CylinderBufferData> = {}\n    const cone: Partial<ConeBufferData> = {}\n\n    if (data.radius) {\n      for (i = 0, il = cylinderRadius.length; i < il; ++i) {\n        cylinderRadius[ i ] = data.radius[ i ] / aspectRatio\n      }\n      cylinder.radius = cylinderRadius\n      cone.radius = data.radius\n    }\n\n    if (data.position1 && data.position2) {\n      const vFrom = new Vector3()\n      const vTo = new Vector3()\n      const vDir = new Vector3()\n      const vSplit = new Vector3()\n      for (i = 0, il = splitPosition.length; i < il; i += 3) {\n        vFrom.fromArray(data.position1 as any, i)\n        vTo.fromArray(data.position2 as any, i)\n        vDir.subVectors(vFrom, vTo)\n        const fullLength = vDir.length()\n        const coneLength = cylinderRadius[ i / 3 ] * aspectRatio * 2\n        const length = Math.min(fullLength, coneLength)\n        vDir.setLength(length)\n        vSplit.copy(vTo).add(vDir)\n        vSplit.toArray(splitPosition as any, i)\n      }\n      cylinder.position1 = data.position1\n      cylinder.position2 = splitPosition\n      cone.position1 = splitPosition\n      cone.position2 = data.position2\n    }\n\n    if (data.color) {\n      cylinder.color = data.color\n      cylinder.color2 = data.color\n      cone.color = data.color\n    }\n\n    return {\n      cylinder: cylinder,\n      cone: cone\n    }\n  }\n\n  getMesh () {\n    return new Group().add(\n      this.cylinderBuffer.getMesh(),\n      this.coneBuffer.getMesh()\n    )\n  }\n\n  getWireframeMesh () {\n    return new Group().add(\n      this.cylinderBuffer.getWireframeMesh(),\n      this.coneBuffer.getWireframeMesh()\n    )\n  }\n\n  getPickingMesh () {\n    return new Group().add(\n      this.cylinderBuffer.getPickingMesh(),\n      this.coneBuffer.getPickingMesh()\n    )\n  }\n\n  setAttributes (data: Partial<ArrowBufferData> = {}) {\n    const attr = this.makeAttributes(data)\n\n    this.cylinderBuffer.setAttributes(attr.cylinder)\n    this.coneBuffer.setAttributes(attr.cone)\n  }\n\n  /**\n   * Set buffer parameters\n   * @param {BufferParameters} params - buffer parameters object\n   * @return {undefined}\n   */\n  setParameters (params: Partial<ArrowBufferParameters> = {}) {\n    params = Object.assign({}, params)\n\n    if (params && params.matrix !== undefined) {\n      this.matrix = params.matrix\n    }\n    delete params.matrix\n\n    if (params && params.wireframe !== undefined) {\n      this.parameters.wireframe = params.wireframe\n      this.setVisibility(this.visible)\n    }\n\n    this.cylinderBuffer.setParameters(params)\n    this.coneBuffer.setParameters(params)\n  }\n\n  setVisibility (value: boolean) {\n    Buffer.prototype.setVisibility.call(this, value)\n  }\n\n  dispose () {\n    this.cylinderBuffer.dispose()\n    this.coneBuffer.dispose()\n  }\n}\n\nBufferRegistry.add('arrow', ArrowBuffer)\n\nexport default ArrowBuffer\n","/**\n * @file Box Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BoxBufferGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface BoxBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Box buffer. Draws boxes.\n *\n * @example\n * var boxBuffer = new BoxBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass BoxBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: BoxBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new BoxBufferGeometry(1, 1, 1))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<BoxBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('box', BoxBuffer)\n\nexport default BoxBuffer\n","/**\n * @file Ellipsoid Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { IcosahedronBufferGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferDefaultParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface EllipsoidBufferData extends BufferData {\n  majorAxis: Float32Array\n  minorAxis: Float32Array\n  radius: Float32Array\n}\n\nexport const EllipsoidBufferDefaultParameters = Object.assign({\n  sphereDetail: 2,\n}, BufferDefaultParameters)\nexport type EllipsoidBufferParameters = typeof EllipsoidBufferDefaultParameters\n\n/**\n * Ellipsoid buffer. Draws ellipsoids.\n *\n * @example\n * var ellipsoidBuffer = new EllipsoidBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   majorAxis: new Float32Array([ 1, 1, 0 ]),\n *   minorAxis: new Float32Array([ 0.5, 0, 0.5 ]),\n * });\n */\nclass EllipsoidBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return EllipsoidBufferDefaultParameters }\n  parameters: EllipsoidBufferParameters\n\n  _majorAxis: Float32Array\n  _minorAxis: Float32Array\n  _radius: Float32Array\n\n  constructor (data: EllipsoidBufferData, params: Partial<EllipsoidBufferParameters> = {}) {\n    super(data, params, new IcosahedronBufferGeometry(1, defaults(params.sphereDetail, 2)))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._majorAxis as any, i3)\n    up.fromArray(this._minorAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._radius[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<EllipsoidBufferData> = {}, initNormals?: boolean) {\n    if (data.radius) this._radius = data.radius\n    if (data.majorAxis) this._majorAxis = data.majorAxis\n    if (data.minorAxis) this._minorAxis = data.minorAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('ellipsoid', EllipsoidBuffer)\n\nexport default EllipsoidBuffer\n","/**\n * @file Octahedron Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { OctahedronBufferGeometry, Vector3, Matrix4 } from 'three'\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface OctahedronBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Octahedron buffer. Draws octahedrons.\n *\n * @example\n * var octahedronBuffer = new OctahedronBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass OctahedronBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: OctahedronBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new OctahedronBufferGeometry(1, 0))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<OctahedronBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('octahedron', OctahedronBuffer)\n\nexport default OctahedronBuffer\n","/**\n * @file Tetrahedron Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { TetrahedronBufferGeometry, Vector3, Matrix4 } from 'three'\nimport { BufferRegistry } from '../globals'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferData, BufferParameters } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface TetrahedronBufferData extends BufferData {\n  heightAxis: Float32Array\n  depthAxis: Float32Array\n  size: Float32Array\n}\n\n/**\n * Tetrahedron buffer. Draws tetrahedrons.\n *\n * @example\n * var tetrahedronBuffer = new TetrahedronBuffer({\n *   position: new Float32Array([ 0, 3, 0, -2, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 1, 0, 1, 0 ]),\n *   size: new Float32Array([ 2, 1.5 ]),\n *   heightAxis: new Float32Array([ 0, 1, 1, 0, 2, 0 ]),\n *   depthAxis: new Float32Array([ 1, 0, 1, 0, 0, 2 ])\n * })\n */\nclass TetrahedronBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  _heightAxis: Float32Array\n  _depthAxis: Float32Array\n  _size: Float32Array\n\n  constructor (data: TetrahedronBufferData, params: Partial<BufferParameters> = {}) {\n    super(data, params, new TetrahedronBufferGeometry(1, 0))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._heightAxis as any, i3)\n    up.fromArray(this._depthAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    scale.set(this._size[ i ], up.length(), target.length())\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<TetrahedronBufferData> = {}, initNormals?: boolean) {\n    if (data.size) this._size = data.size\n    if (data.heightAxis) this._heightAxis = data.heightAxis\n    if (data.depthAxis) this._depthAxis = data.depthAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('tetrahedron', TetrahedronBuffer)\n\nexport default TetrahedronBuffer\n","/**\n * @file Tetrahedron Geometry Buffer\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { TorusBufferGeometry, Vector3, Matrix4 } from 'three'\n\nimport { BufferRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport GeometryBuffer from './geometry-buffer'\nimport { BufferDefaultParameters, BufferData } from './buffer'\n\nconst scale = new Vector3()\nconst target = new Vector3()\nconst up = new Vector3()\nconst eye = new Vector3(0, 0, 0)\n\nexport interface TorusBufferData extends BufferData {\n  majorAxis: Float32Array\n  minorAxis: Float32Array\n  radius: Float32Array\n}\n\nexport const TorusBufferDefaultParameters = Object.assign({\n  radiusRatio: 0.2,\n  radialSegments: 16,\n  tubularSegments: 32\n}, BufferDefaultParameters)\nexport type TorusBufferParameters = typeof TorusBufferDefaultParameters\n\n/**\n * Torus geometry buffer. Draws torii.\n *\n * @example\n * var torusBuffer = new TorusBuffer({\n *   position: new Float32Array([ 0, 0, 0 ]),\n *   color: new Float32Array([ 1, 0, 0 ]),\n *   radius: new Float32Array([ 1 ]),\n *   majorAxis: new Float32Array([ 1, 1, 0 ]),\n *   minorAxis: new Float32Array([ 0.5, 0, 0.5 ]),\n * });\n */\nclass TorusBuffer extends GeometryBuffer {\n  updateNormals = true\n\n  get defaultParameters() { return TorusBufferDefaultParameters }\n  parameters: TorusBufferParameters\n\n  _majorAxis: Float32Array\n  _minorAxis: Float32Array\n  _radius: Float32Array\n\n  constructor (data: TorusBufferData, params: Partial<TorusBufferParameters> = {}) {\n    super(data, params, new TorusBufferGeometry(\n      1,\n      defaults(params.radiusRatio, 0.2),\n      defaults(params.radialSegments, 16),\n      defaults(params.tubularSegments, 32)\n    ))\n\n    this.setAttributes(data, true)\n  }\n\n  applyPositionTransform (matrix: Matrix4, i: number, i3: number) {\n    target.fromArray(this._majorAxis as any, i3)\n    up.fromArray(this._minorAxis as any, i3)\n    matrix.lookAt(eye, target, up)\n\n    const r = this._radius[ i ]\n    scale.set(r, r, r)\n    matrix.scale(scale)\n  }\n\n  setAttributes (data: Partial<TorusBufferData> = {}, initNormals?: boolean) {\n    if (data.radius) this._radius = data.radius\n    if (data.majorAxis) this._majorAxis = data.majorAxis\n    if (data.minorAxis) this._minorAxis = data.minorAxis\n\n    super.setAttributes(data, initNormals)\n  }\n}\n\nBufferRegistry.add('torus', TorusBuffer)\n\nexport default TorusBuffer\n","/**\n * @file Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log } from '../globals'\nimport { defaults } from '../utils'\nimport Streamer from '../streamer/streamer';\n\nexport interface ParserParameters {\n  name: string\n  path: string\n}\n\nclass Parser {\n  streamer: Streamer\n  name: string\n  path: string\n  [k: string]: any\n  \n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    var p = params || {}\n\n    this.streamer = streamer\n\n    this.name = defaults(p.name, '')\n    this.path = defaults(p.path, '')\n  }\n\n  get type () { return '' }\n  get __objName () { return '' }\n  get isBinary () { return false }\n  get isJson () { return false }\n  get isXml () { return false }\n\n  parse () {\n    return this.streamer.read().then(() => {\n      this._beforeParse()\n      this._parse()\n      this._afterParse()\n      return this[ this.__objName ]\n    })\n  }\n\n  _parse () {}\n\n  _beforeParse () {}\n\n  _afterParse () {\n    if (Debug) Log.log(this[ this.__objName ])\n  }\n}\n\nexport default Parser\n","/**\n * @file Structure Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport Parser, { ParserParameters } from './parser'\nimport Structure from '../structure/structure'\nimport StructureBuilder from '../structure/structure-builder'\nimport Streamer from '../streamer/streamer';\n\nexport interface StructureParserParameters extends ParserParameters {\n  firstModelOnly: boolean\n  asTrajectory: boolean\n  cAlphaOnly: boolean\n}\nclass StructureParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<StructureParserParameters>) {\n    var p = params || {}\n\n    super(streamer, p)\n\n    this.firstModelOnly = defaults(p.firstModelOnly, false)\n    this.asTrajectory = defaults(p.asTrajectory, false)\n    this.cAlphaOnly = defaults(p.cAlphaOnly, false)\n\n    this.structure = new Structure(this.name, this.path)\n    this.structureBuilder = new StructureBuilder(this.structure)\n  }\n\n  get type () { return 'structure' }\n  get __objName () { return 'structure' }\n}\n\nexport default StructureParser\n","/**\n * @file Entity\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Structure from './structure'\nimport {\n    UnknownEntity, PolymerEntity, NonPolymerEntity, MacrolideEntity, WaterEntity\n} from './structure-constants'\nimport ChainProxy from '../proxy/chain-proxy'\n\nfunction entityTypeFromString (string: string) {\n  string = string.toLowerCase()\n  switch (string) {\n    case 'polymer':\n      return PolymerEntity\n    case 'non-polymer':\n      return NonPolymerEntity\n    case 'macrolide':\n      return MacrolideEntity\n    case 'water':\n      return WaterEntity\n    default:\n      return UnknownEntity\n  }\n}\n\nfunction entityFromType (type: number) {\n  switch (type) {\n    case PolymerEntity:\n      return 'polymer'\n    case NonPolymerEntity:\n      return 'non-polymer'\n    case MacrolideEntity:\n      return 'macrolide'\n    case WaterEntity:\n      return 'water'\n    default:\n      return undefined\n  }\n}\n\nexport const EntityTypeString = {\n  'polymer': PolymerEntity,\n  'non-polymer': NonPolymerEntity,\n  'macrolide': MacrolideEntity,\n  'water': WaterEntity,\n}\nexport type EntityTypeString = keyof typeof EntityTypeString\n\n/**\n * Entity of a {@link Structure}\n */\nexport default class Entity {\n  structure: Structure\n  index: number\n  description: string\n  entityType: number\n  chainIndexList: number[]\n\n  /**\n   * @param {Structure} structure - structure the entity belongs to\n   * @param {Integer} index - index within structure.entityList\n   * @param {String} description - entity description\n   * @param {String} type - entity type\n   * @param {Array} chainIndexList - entity chainIndexList\n   */\n  constructor (structure: Structure, index: number, description = '', type?: EntityTypeString, chainIndexList: number[] = []) {\n    this.structure = structure\n    this.index = index\n    this.description = description\n    this.entityType = entityTypeFromString(type || '')\n    this.chainIndexList = chainIndexList\n\n    chainIndexList.forEach(function (ci: number) {\n      structure.chainStore.entityIndex[ ci ] = index\n    })\n  }\n\n  get type () { return entityFromType(this.entityType) }\n\n  getEntityType () {\n    return this.entityType\n  }\n\n  isPolymer () {\n    return this.entityType === PolymerEntity\n  }\n\n  isNonPolymer () {\n    return this.entityType === NonPolymerEntity\n  }\n\n  isMacrolide () {\n    return this.entityType === MacrolideEntity\n  }\n\n  isWater () {\n    return this.entityType === WaterEntity\n  }\n\n  eachChain (callback: (cp: ChainProxy) => any) {\n    const cp = this.structure.getChainProxy()\n\n    this.chainIndexList.forEach(function (index) {\n      cp.index = index\n      callback(cp)\n    })\n  }\n}","/**\n * @file Unitcell\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Color, Vector3, Matrix4 } from 'three'\n\nimport { defaults } from '../utils'\nimport { degToRad } from '../math/math-utils'\nimport {\n  uniformArray, uniformArray3, centerArray3\n} from '../math/array-utils'\nimport { UnitcellPicker } from '../utils/picker'\nimport Structure from '../structure/structure'\n\nexport interface UnitcellParams {\n  a: number\n  b: number\n  c: number\n  alpha: number\n  beta: number\n  gamma: number\n  spacegroup: string\n  cartToFrac?: Matrix4\n}\n\nconst DefaultBoxParams = {\n  a: 1,\n  b: 1,\n  c: 1,\n  alpha: 90,\n  beta: 90,\n  gamma: 90,\n  spacegroup: 'P 1'\n}\n\nexport interface UnitcellDataParams {\n  colorValue?: string|number,\n  radius?: number\n}\n\n/**\n * Unitcell class\n */\nclass Unitcell {\n  a: number\n  b: number\n  c: number\n  alpha: number\n  beta: number\n  gamma: number\n\n  spacegroup: string\n\n  cartToFrac = new Matrix4()\n  fracToCart = new Matrix4()\n\n  volume: number\n\n  /**\n   * @param  {Object} params - unitcell parameters\n   * @param  {Number} params.a - length a\n   * @param  {Number} params.b - length b\n   * @param  {Number} params.c - length c\n   * @param  {Number} params.alpha - angle alpha\n   * @param  {Number} params.beta - angle beta\n   * @param  {Number} params.gamma - angle gamma\n   * @param  {String} params.spacegroup - spacegroup\n   * @param  {Matrix4} [params.cartToFrac] - transformation matrix from\n   *                                         cartesian to fractional coordinates\n   * @param  {Matrix4} [params.scale] - alias for `params.cartToFrac`\n   */\n  constructor (params: UnitcellParams = DefaultBoxParams) {\n    this.a = params.a\n    this.b = params.b\n    this.c = params.c\n    this.alpha = params.alpha\n    this.beta = params.beta\n    this.gamma = params.gamma\n    this.spacegroup = params.spacegroup\n\n    const alphaRad = degToRad(this.alpha)\n    const betaRad = degToRad(this.beta)\n    const gammaRad = degToRad(this.gamma)\n    const cosAlpha = Math.cos(alphaRad)\n    const cosBeta = Math.cos(betaRad)\n    const cosGamma = Math.cos(gammaRad)\n    const sinBeta = Math.sin(betaRad)\n    const sinGamma = Math.sin(gammaRad)\n\n    this.volume = (\n      this.a * this.b * this.c *\n      Math.sqrt(\n        1 - cosAlpha * cosAlpha - cosBeta * cosBeta - cosGamma * cosGamma +\n        2.0 * cosAlpha * cosBeta * cosGamma\n      )\n    )\n\n    if (params.cartToFrac === undefined) {\n      // https://github.com/biojava/biojava/blob/master/biojava-structure/src/main/java/org/biojava/nbio/structure/xtal/CrystalCell.java\n\n      const cStar = (this.a * this.b * sinGamma) / this.volume\n      const cosAlphaStar = (\n        (cosBeta * cosGamma - cosAlpha) / (sinBeta * sinGamma)\n      )\n\n      this.fracToCart.set(\n        this.a, 0, 0, 0,\n        this.b * cosGamma, this.b * sinGamma, 0, 0,\n        this.c * cosBeta, -this.c * sinBeta * cosAlphaStar, 1.0 / cStar, 0,\n        0, 0, 0, 1\n      ).transpose()\n      this.cartToFrac.getInverse(this.fracToCart)\n    } else {\n      this.cartToFrac.copy(params.cartToFrac)\n      this.fracToCart.getInverse(this.cartToFrac)\n    }\n  }\n\n  getPosition (structure: Structure): Float32Array {\n    const vertexPosition = new Float32Array(3 * 8)\n\n    if (structure.unitcell) {\n      const uc = structure.unitcell\n      const centerFrac = structure.center.clone().applyMatrix4(uc.cartToFrac).floor()\n      const v = new Vector3()\n\n      let cornerOffset = 0\n      const addCorner = function (x: number, y: number, z: number) {\n        v.set(x, y, z)\n          .add(centerFrac)\n          .applyMatrix4(uc.fracToCart)\n          .toArray(vertexPosition as any, cornerOffset)\n        cornerOffset += 3\n      }\n      addCorner(0, 0, 0)\n      addCorner(1, 0, 0)\n      addCorner(0, 1, 0)\n      addCorner(0, 0, 1)\n      addCorner(1, 1, 0)\n      addCorner(1, 0, 1)\n      addCorner(0, 1, 1)\n      addCorner(1, 1, 1)\n    }\n\n    return vertexPosition\n  }\n\n  getCenter (structure: Structure) {\n    return centerArray3(this.getPosition(structure))\n  }\n\n  getData (structure: Structure, params: UnitcellDataParams = {}) {\n    const colorValue = defaults(params.colorValue, 'orange')\n    const radius = defaults(params.radius, Math.cbrt(this.volume) / 200)\n\n    const c = new Color(colorValue)\n    const v = new Vector3()\n\n    const vertexPosition = this.getPosition(structure)\n    const vertexColor = uniformArray3(8, c.r, c.g, c.b)\n    const vertexRadius = uniformArray(8, radius)\n\n    const edgePosition1 = new Float32Array(3 * 12)\n    const edgePosition2 = new Float32Array(3 * 12)\n    const edgeColor = uniformArray3(12, c.r, c.g, c.b)\n    const edgeRadius = uniformArray(12, radius)\n\n    let edgeOffset = 0\n    function addEdge (a: number, b: number) {\n      v.fromArray(vertexPosition as any, a * 3)\n        .toArray(edgePosition1 as any, edgeOffset)\n      v.fromArray(vertexPosition as any, b * 3)\n        .toArray(edgePosition2 as any, edgeOffset)\n      edgeOffset += 3\n    }\n    addEdge(0, 1)\n    addEdge(0, 2)\n    addEdge(0, 3)\n    addEdge(1, 4)\n    addEdge(1, 5)\n    addEdge(2, 6)\n    addEdge(3, 5)\n    addEdge(4, 7)\n    addEdge(5, 7)\n    addEdge(2, 4)\n    addEdge(7, 6)\n    addEdge(3, 6)\n\n    const picker = new UnitcellPicker(this, structure)\n\n    return {\n      vertex: {\n        position: vertexPosition,\n        color: vertexColor,\n        radius: vertexRadius,\n        picking: picker\n      },\n      edge: {\n        position1: edgePosition1,\n        position2: edgePosition2,\n        color: edgeColor,\n        color2: edgeColor,\n        radius: edgeRadius,\n        picking: picker\n      }\n    }\n  }\n}\n\nexport default Unitcell\n","/**\n * @file Pdb Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport StructureParser from './structure-parser'\nimport Entity, { EntityTypeString } from '../structure/entity'\nimport Unitcell, { UnitcellParams } from '../symmetry/unitcell'\nimport Assembly, { AssemblyPart } from '../symmetry/assembly'\nimport { WaterNames } from '../structure/structure-constants'\nimport {\n  assignSecondaryStructure, buildUnitcellAssembly,\n  calculateBonds, calculateChainnames, calculateSecondaryStructure\n} from '../structure/structure-utils'\nimport Streamer from '../streamer/streamer';\nimport { ParserParameters } from './parser';\nimport { NumberArray } from '../types';\nimport { Structure } from '../ngl';\n\n// PDB helix record encoding\nconst HelixTypes: {[k: number]: string} = {\n  1: 'h', // Right-handed alpha (default)\n  2: 'h', // Right-handed omega\n  3: 'i', // Right-handed pi\n  4: 'h', // Right-handed gamma\n  5: 'g', // Right-handed 310\n  6: 'h', // Left-handed alpha\n  7: 'h', // Left-handed omega\n  8: 'h', // Left-handed gamma\n  9: 'h', // 27 ribbon/helix\n  10: 'h', // Polyproline\n  0: 'h' //Used to be ''\n}\n\nconst dAminoAcids = [\n  'DAL', // D-ALANINE\n  'DAR', // D-ARGININE\n  'DSG', // D-ASPARAGINE\n  'DAS', // D-ASPARTIC ACID\n  'DCY', // D-CYSTEINE\n  'DGL', // D-GLUTAMIC ACID\n  'DGN', // D-GLUTAMINE\n  'DHI', // D-HISTIDINE\n  'DIL', // D-ISOLEUCINE\n  'DLE', // D-LEUCINE\n  'DLY', // D-LYSINE\n  'MED', // D-METHIONINE\n  'DPN', // D-PHENYLALANINE\n  'DPR', // D-PROLINE\n  'DSN', // D-SERINE\n  'DTH', // D-THREONINE\n  'DTR', // D-TRYPTOPHAN\n  'DTY', // D-TYROSINE\n  'DVA', // D-VALINE\n\n  'DNE' // D-NORLEUCINE\n\n  // ???  // D-SELENOCYSTEINE\n]\n\nconst entityKeyList = [\n  'MOL_ID', 'MOLECULE', 'CHAIN', 'FRAGMENT', 'SYNONYM',\n  'EC', 'ENGINEERED', 'MUTATION', 'OTHER_DETAILS'\n]\n\nconst reWhitespace = /\\s+/\n\nfunction getModresId (resno: number, chainname?: string, inscode?: string) {\n  let id = `${resno}`\n  if (chainname) id += `:${chainname}`\n  if (inscode) id += `^${inscode}`\n  return id\n}\nexport interface PdbParserParameters extends ParserParameters {\n  hex: boolean\n}\n\nclass PdbParser extends StructureParser {\n  /**\n   * Create a pdb parser\n   * @param  {Streamer} streamer - streamer object\n   * @param  {Object} params - params object\n   * @param  {Boolean} params.hex - hexadecimal parsing of\n   *                                atom numbers >99.999 and\n   *                                residue numbers >9.999\n   * @return {undefined}\n   */\n  constructor (streamer: Streamer, params?: Partial<PdbParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.hex = defaults(p.hex, false)\n  }\n\n  get type () { return 'pdb' }\n\n  _parse () {\n    // http://www.wwpdb.org/documentation/file-format.php\n\n    if (Debug) Log.time('PdbParser._parse ' + this.name)\n\n    let isLegacy = false\n    const headerLine = this.streamer.peekLines(1)[ 0 ]\n    const headerId = headerLine.substr(62, 4)\n    const legacyId = headerLine.substr(72, 4)\n    if (headerId === legacyId && legacyId.trim()) {\n      isLegacy = true\n    }\n\n    const isPqr = this.type === 'pqr'\n    const isPdbqt = this.type === 'pdbqt'\n\n    const s: Structure = this.structure\n    const sb = this.structureBuilder\n\n    const hex = this.hex\n    let serialRadix = 10\n    let resnoRadix = 10\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n    const cAlphaOnly = this.cAlphaOnly\n\n    const frames = s.frames\n    const boxes = s.boxes\n    let doFrames = false\n    let currentFrame: NumberArray, currentCoord: number\n\n    const biomolDict = s.biomolDict\n    let currentBiomol: Assembly\n    let currentPart: AssemblyPart\n    let currentMatrix: Matrix4\n\n    let line, recordName\n    let serial, chainname: string, resno: number, resname: string, occupancy: number\n    let inscode: string, atomname, hetero: number, bfactor: number, altloc\n    let formalCharge: number\n\n    let startChain, startResi, startIcode\n    let endChain, endResi, endIcode\n\n    let serialDict: {[k: number]: number} = {}\n    const unitcellDict: Partial<{\n      origx: Matrix4\n      scale: Matrix4\n      a: number\n      b: number\n      c: number\n      alpha: number\n      beta: number\n      gamma: number\n      spacegroup: string\n    }> = {}\n    const bondDict: {[k: string]: boolean} = {}\n\n    const entityDataList: {chainList: string[], name: string}[] = []\n    let currentEntityData: {chainList: string[], name: string}\n    let currentEntityKey: 'MOL_ID'|'MOLECULE'|'CHAIN'|'FRAGMENT'|'SYNONYM'|'EC'|'ENGINEERED'|'MUTATION'|'OTHER_DETAILS'\n    // MOL_ID                 Numbers each component; also used in  SOURCE to associate\n    //                        the information.\n    // MOLECULE               Name of the macromolecule.\n    // CHAIN                  Comma-separated list of chain  identifier(s).\n    // FRAGMENT               Specifies a domain or region of the  molecule.\n    // SYNONYM                Comma-separated list of synonyms for  the MOLECULE.\n    // EC                     The Enzyme Commission number associated  with the molecule.\n    //                        If there is more than one EC number,  they are presented\n    //                        as a comma-separated list.\n    // ENGINEERED             Indicates that the molecule was  produced using\n    //                        recombinant technology or by purely  chemical synthesis.\n    // MUTATION               Indicates if there is a mutation.\n    // OTHER_DETAILS          Additional comments.\n\n    const hetnameDict: {[k: string]: string} = {}\n    const modresDict: {[k: string]: any} = {}\n\n    const chainDict: {[k: string]: number} = {}\n    let chainIdx: number, chainid: string, newChain: boolean\n    let currentChainname: string, currentResno: number, currentResname: string, currentInscode: string\n\n    const seqresDict: {[k: string]: string[]} = {}\n    let currentSeqresChainname: string\n\n    const secStruct = {\n      helices: [] as any[],\n      sheets: [] as any[]\n    }\n    const helices = secStruct.helices\n    const sheets = secStruct.sheets\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.resize(Math.round(this.streamer.data.length / 80))\n    if (isPqr || isPdbqt) atomStore.addField('partialCharge', 1, 'float32')\n    if (isPqr) atomStore.addField('radius', 1, 'float32')\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n\n    let idx = 0\n    let modelIdx = 0\n    let pendingStart = true\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        line = lines[ i ]\n        recordName = line.substr(0, 6)\n\n        if (recordName === 'ATOM  ' || recordName === 'HETATM') {\n          // http://www.wwpdb.org/documentation/file-format-content/format33/sect9.html#ATOM\n          // PQR: Field_name Atom_number Atom_name Residue_name Chain_ID Residue_number X Y Z Charge Radius\n\n          if (pendingStart) {\n            if (asTrajectory) {\n              if (doFrames) {\n                currentFrame = new Float32Array(atomStore.count * 3)\n                frames.push(currentFrame)\n              } else {\n                currentFrame = []\n              }\n              currentCoord = 0\n            } else {\n              if (!firstModelOnly) serialDict = {}\n            }\n\n            chainIdx = 1\n            chainid = chainIdx.toString()\n            newChain = true\n\n            pendingStart = false\n          }\n\n          if (firstModelOnly && modelIdx > 0) continue\n\n          let x, y, z, ls: string[], dd = 0\n\n          if (isPqr) {\n            ls = line.split(reWhitespace)\n            dd = ls.length === 10 ? 1 : 0\n\n            atomname = ls[ 2 ]\n            if (cAlphaOnly && atomname !== 'CA') continue\n\n            x = parseFloat(ls[ 6 - dd ])\n            y = parseFloat(ls[ 7 - dd ])\n            z = parseFloat(ls[ 8 - dd ])\n          } else {\n            atomname = line.substr(12, 4).trim()\n            if (cAlphaOnly && atomname !== 'CA') continue\n\n            x = parseFloat(line.substr(30, 8))\n            y = parseFloat(line.substr(38, 8))\n            z = parseFloat(line.substr(46, 8))\n          }\n\n          if (asTrajectory) {\n            const j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (doFrames) continue\n          }\n\n          let element\n\n          if (isPqr) {\n            serial = parseInt(ls![ 1 ])\n            element = ''\n            hetero = (line[ 0 ] === 'H') ? 1 : 0\n            chainname = dd ? '' : ls![ 4 ]\n            resno = parseInt(ls![ 5 - dd! ])\n            inscode = ''\n            resname = ls![ 3 ]\n            altloc = ''\n            occupancy = 1.0\n          } else {\n            serial = parseInt(line.substr(6, 5), serialRadix)\n            if (hex && serial === 99999) {\n              serialRadix = 16\n            }\n            hetero = (line[ 0 ] === 'H') ? 1 : 0\n            chainname = line[ 21 ].trim()\n            resno = parseInt(line.substr(22, 4), resnoRadix)\n            if (hex && resno === 9999) {\n              resnoRadix = 16\n            }\n            inscode = line[ 26 ].trim()\n            resname = line.substr(17, 4).trim() || 'MOL'\n            bfactor = parseFloat(line.substr(60, 6))\n            altloc = line[ 16 ].trim()\n            occupancy = parseFloat(line.substr(54, 6))\n\n            if (!isLegacy) {\n              if (isPdbqt) {\n                element = line.substr(12, 2).trim()\n              } else {\n                element = line.substr(76, 2).trim()\n                if (!chainname) {\n                  chainname = line.substr(72, 4).trim() // segid\n                }\n              }\n              // Where specified, formalCharge is of form \"2-\" or \"1+\"\n              formalCharge = parseInt((line.substr(79,1) + line.substr(78, 1)).trim())\n            }\n          }\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = serial\n          atomStore.altloc[ idx ] = altloc.charCodeAt(0)\n          atomStore.occupancy[ idx ] = isNaN(occupancy) ? 0 : occupancy\n\n          if (isPqr) {\n            atomStore.partialCharge![ idx ] = parseFloat(ls![ 9 - dd! ])\n            atomStore.radius[ idx ] = parseFloat(ls![ 10 - dd! ])\n          } else {\n            atomStore.bfactor[ idx ] = isNaN(bfactor) ? 0 : bfactor\n            if (isPdbqt) {\n              atomStore.partialCharge![ idx ] = parseFloat(line.substr(70, 6))\n            }\n            // isFinite check will reject undefined (in legacy case) and NaN values\n            if (isFinite(formalCharge)) {\n              if (!atomStore.formalCharge) {\n                atomStore.addField('formalCharge', 1, 'int8')\n              }\n              atomStore.formalCharge![ idx ] = formalCharge\n            }\n          }\n\n          const modresId = getModresId(resno, chainname, inscode)\n\n          // TODO instead of looking at MODRES look at SEQRES and\n          //      missing residues in REMARK 465\n          if (hetero && !modresDict[modresId] && !dAminoAcids.includes(resname)) {\n            if (currentChainname !== chainname || currentResname !== resname ||\n                (!WaterNames.includes(resname) &&\n                  (currentResno !== resno || currentInscode !== inscode))\n            ) {\n              chainIdx += 1\n              chainid = chainIdx.toString()\n\n              currentResno = resno\n              currentResname = resname\n              currentInscode = inscode\n            }\n          } else if (!newChain && currentChainname !== chainname) {\n            chainIdx += 1\n            chainid = chainIdx.toString()\n          }\n\n          sb.addAtom(modelIdx, chainname, chainid, resname, resno, hetero, undefined, inscode)\n\n          serialDict[ serial ] = idx\n          idx += 1\n          newChain = false\n          currentChainname = chainname\n        } else if (recordName === 'CONECT') {\n          const fromIdx = serialDict[ parseInt(line.substr(6, 5)) ]\n          const pos = [ 11, 16, 21, 26 ]\n          const bondIndex: {[k: number]: number} = {}\n\n          if (fromIdx === undefined) {\n            // Log.log( \"missing CONNECT serial\" );\n            continue\n          }\n\n          for (let j = 0; j < 4; ++j) {\n            let toIdx = parseInt(line.substr(pos[ j ], 5))\n            if (Number.isNaN(toIdx)) continue\n            toIdx = serialDict[ toIdx ]\n            if (toIdx === undefined) {\n              // Log.log( \"missing CONNECT serial\" );\n              continue\n            }/* else if( toIdx < fromIdx ){\n                // likely a duplicate in standard PDB format\n                // but not necessarily, so better remove duplicates\n                // in a pass after parsing (and auto bonding)\n                continue;\n            } */\n\n            if (fromIdx < toIdx) {\n              ap1.index = fromIdx\n              ap2.index = toIdx\n            } else {\n              ap1.index = toIdx\n              ap2.index = fromIdx\n            }\n\n            // interpret records where a 'toIdx' atom is given multiple times\n            // as double/triple bonds, e.g. CONECT 1529 1528 1528 is a double bond\n            if (bondIndex[ toIdx ] !== undefined) {\n              s.bondStore.bondOrder[ bondIndex[ toIdx ] ] += 1\n            } else {\n              const hash = ap1.index + '|' + ap2.index\n              if (bondDict[ hash ] === undefined) {\n                bondDict[ hash ] = true\n                bondIndex[ toIdx ] = s.bondStore.count\n                s.bondStore.addBond(ap1, ap2, 1) // start/assume with single bond\n              }\n            }\n          }\n        } else if (recordName === 'HELIX ') {\n          startChain = line[ 19 ].trim()\n          startResi = parseInt(line.substr(21, 4))\n          startIcode = line[ 25 ].trim()\n          endChain = line[ 31 ].trim()\n          endResi = parseInt(line.substr(33, 4))\n          endIcode = line[ 37 ].trim()\n          let helixType = parseInt(line.substr(39, 1))\n          helixType = (HelixTypes[ helixType ] || HelixTypes[0]).charCodeAt(0)\n          helices.push([\n            startChain, startResi, startIcode,\n            endChain, endResi, endIcode,\n            helixType\n          ])\n        } else if (recordName === 'SHEET ') {\n          startChain = line[ 21 ].trim()\n          startResi = parseInt(line.substr(22, 4))\n          startIcode = line[ 26 ].trim()\n          endChain = line[ 32 ].trim()\n          endResi = parseInt(line.substr(33, 4))\n          endIcode = line[ 37 ].trim()\n          sheets.push([\n            startChain, startResi, startIcode,\n            endChain, endResi, endIcode\n          ])\n        } else if (recordName === 'HETNAM') {\n          hetnameDict[ line.substr(11, 3) ] = line.substr(15).trim()\n        } else if (recordName === 'SEQRES') {\n          const seqresChainname = line[11].trim()\n          if (seqresChainname !== currentSeqresChainname) {\n            seqresDict[ seqresChainname ] = []\n            currentSeqresChainname = seqresChainname\n          }\n          seqresDict[ seqresChainname ].push(\n            ...line.substr(19).trim().split(reWhitespace)\n          )\n        } else if (recordName === 'MODRES') {\n          // MODRES 2SRC PTR A  527  TYR  O-PHOSPHOTYROSINE\n          const resname = line.substr(12, 3).trim()\n          const chainname = line[16].trim()\n          const inscode = line[22].trim()\n          const resno = parseInt(line.substr(18, 4).trim())\n          const id = getModresId(resno, chainname, inscode)\n          modresDict[ id ] = { resname, chainname, inscode, resno }\n        } else if (recordName === 'COMPND') {\n          const comp = line.substr(10, 70).trim()\n          const keyEnd = comp.indexOf(':')\n          const key = comp.substring(0, keyEnd)\n          let value\n\n          if (entityKeyList.includes(key)) {\n            currentEntityKey = key as 'MOL_ID'|'MOLECULE'|'CHAIN'|'FRAGMENT'|'SYNONYM'|'EC'|'ENGINEERED'|'MUTATION'|'OTHER_DETAILS'\n            value = comp.substring(keyEnd + 2)\n          } else {\n            value = comp\n          }\n          value = value.replace(/;$/, '')\n\n          if (currentEntityKey === 'MOL_ID') {\n            currentEntityData = {\n              chainList: [],\n              name: ''\n            }\n            entityDataList.push(currentEntityData)\n          } else if (currentEntityKey === 'MOLECULE') {\n            if (currentEntityData.name) currentEntityData.name += ' '\n            currentEntityData.name += value\n          } else if (currentEntityKey === 'CHAIN') {\n            Array.prototype.push.apply(\n              currentEntityData.chainList,\n              value.split(/\\s*,\\s*/)\n            )\n          }\n        } else if (line.startsWith('TER')) {\n          const cp = s.getChainProxy(s.chainStore.count - 1)\n          chainDict[ cp.chainname ] = cp.index\n          chainIdx += 1\n          chainid = chainIdx.toString()\n          newChain = true\n        } else if (recordName === 'REMARK' && line.substr(7, 3) === '350') {\n          if (line.substr(11, 12) === 'BIOMOLECULE:') {\n            let name = line.substr(23).trim()\n            if (/^(0|[1-9][0-9]*)$/.test(name)) name = 'BU' + name\n\n            currentBiomol = new Assembly(name)\n            biomolDict[ name ] = currentBiomol\n          } else if (line.substr(13, 5) === 'BIOMT') {\n            const biomt = line.split(/\\s+/)\n            const row = parseInt(line[ 18 ]) - 1\n\n            if (row === 0) {\n              currentMatrix = new Matrix4()\n              currentPart.matrixList.push(currentMatrix)\n            }\n\n            const biomtElms = currentMatrix.elements\n\n            biomtElms[ 4 * 0 + row ] = parseFloat(biomt[ 4 ])\n            biomtElms[ 4 * 1 + row ] = parseFloat(biomt[ 5 ])\n            biomtElms[ 4 * 2 + row ] = parseFloat(biomt[ 6 ])\n            biomtElms[ 4 * 3 + row ] = parseFloat(biomt[ 7 ])\n          } else if (\n            line.substr(11, 30) === 'APPLY THE FOLLOWING TO CHAINS:' ||\n            line.substr(11, 30) === '                   AND CHAINS:'\n          ) {\n            if (line.substr(11, 5) === 'APPLY') {\n              currentPart = currentBiomol.addPart()\n            }\n\n            const chainList = line.substr(41, 30).split(',')\n            for (let j = 0, jl = chainList.length; j < jl; ++j) {\n              const c = chainList[ j ].trim()\n              if (c) currentPart.chainList.push(c)\n            }\n          }\n        } else if (recordName === 'HEADER') {\n          s.id = line.substr(62, 4)\n        } else if (recordName === 'TITLE ') {\n          s.title += (s.title ? ' ' : '') + line.substr(10, 70).trim()\n        } else if (recordName === 'MODEL ') {\n          pendingStart = true\n        } else if (recordName === 'ENDMDL' || line.trim() === 'END') {\n          if (pendingStart) continue\n\n          if (asTrajectory && !doFrames) {\n            frames.push(new Float32Array(currentFrame))\n            doFrames = true\n          }\n\n          modelIdx += 1\n          pendingStart = true\n        } else if (line.substr(0, 5) === 'MTRIX') {\n          // ignore 'given' operators\n          if (line[ 59 ] === '1') continue\n\n          if (!currentBiomol || currentBiomol.name !== 'NCS') {\n            const ncsName = 'NCS'\n            currentBiomol = new Assembly(ncsName)\n            biomolDict[ ncsName ] = currentBiomol\n            currentPart = currentBiomol.addPart()\n          }\n\n          const ncs = line.split(/\\s+/)\n          const ncsRow = parseInt(line[ 5 ]) - 1\n\n          if (ncsRow === 0) {\n            currentMatrix = new Matrix4()\n            currentPart.matrixList.push(currentMatrix)\n          }\n\n          const ncsElms = currentMatrix.elements\n\n          ncsElms[ 4 * 0 + ncsRow ] = parseFloat(ncs[ 2 ])\n          ncsElms[ 4 * 1 + ncsRow ] = parseFloat(ncs[ 3 ])\n          ncsElms[ 4 * 2 + ncsRow ] = parseFloat(ncs[ 4 ])\n          ncsElms[ 4 * 3 + ncsRow ] = parseFloat(ncs[ 5 ])\n        } else if (line.substr(0, 5) === 'ORIGX') {\n          if (!unitcellDict.origx) {\n            unitcellDict.origx = new Matrix4()\n          }\n\n          const orgix = line.split(/\\s+/)\n          const origxRow = parseInt(line[ 5 ]) - 1\n          const origxElms = unitcellDict.origx.elements\n\n          origxElms[ 4 * 0 + origxRow ] = parseFloat(orgix[ 1 ])\n          origxElms[ 4 * 1 + origxRow ] = parseFloat(orgix[ 2 ])\n          origxElms[ 4 * 2 + origxRow ] = parseFloat(orgix[ 3 ])\n          origxElms[ 4 * 3 + origxRow ] = parseFloat(orgix[ 4 ])\n        } else if (line.substr(0, 5) === 'SCALE') {\n          if (!unitcellDict.scale) {\n            unitcellDict.scale = new Matrix4()\n          }\n\n          const scale = line.split(/\\s+/)\n          const scaleRow = parseInt(line[ 5 ]) - 1\n          const scaleElms = unitcellDict.scale.elements\n\n          scaleElms[ 4 * 0 + scaleRow ] = parseFloat(scale[ 1 ])\n          scaleElms[ 4 * 1 + scaleRow ] = parseFloat(scale[ 2 ])\n          scaleElms[ 4 * 2 + scaleRow ] = parseFloat(scale[ 3 ])\n          scaleElms[ 4 * 3 + scaleRow ] = parseFloat(scale[ 4 ])\n        } else if (recordName === 'CRYST1') {\n          // CRYST1   55.989   55.989   55.989  90.00  90.00  90.00 P 1           1\n          //  7 - 15       Real(9.3)      a (Angstroms)\n          // 16 - 24       Real(9.3)      b (Angstroms)\n          // 25 - 33       Real(9.3)      c (Angstroms)\n          // 34 - 40       Real(7.2)      alpha         alpha (degrees).\n          // 41 - 47       Real(7.2)      beta          beta (degrees).\n          // 48 - 54       Real(7.2)      gamma         gamma (degrees).\n          // 56 - 66       LString        sGroup        Space group.\n          // 67 - 70       Integer        z             Z value.\n\n          const aLength = parseFloat(line.substr(6, 9))\n          const bLength = parseFloat(line.substr(15, 9))\n          const cLength = parseFloat(line.substr(24, 9))\n\n          const alpha = parseFloat(line.substr(33, 7))\n          const beta = parseFloat(line.substr(40, 7))\n          const gamma = parseFloat(line.substr(47, 7))\n\n          const sGroup = line.substr(55, 11).trim()\n          // const zValue = parseInt( line.substr( 66, 4 ) );\n\n          const box = new Float32Array(9)\n          box[ 0 ] = aLength\n          box[ 4 ] = bLength\n          box[ 8 ] = cLength\n          boxes.push(box)\n\n          if (modelIdx === 0) {\n            unitcellDict.a = aLength\n            unitcellDict.b = bLength\n            unitcellDict.c = cLength\n            unitcellDict.alpha = alpha\n            unitcellDict.beta = beta\n            unitcellDict.gamma = gamma\n            unitcellDict.spacegroup = sGroup\n          }\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n\n    // finalize ensures resname will be defined for all rp.resname\n    // (required in entity handling below)\n    sb.finalize()\n\n    //\n\n    const en = entityDataList.length\n\n    if (en) {\n      s.eachChain(function (cp) {\n        cp.entityIndex = en\n      })\n\n      entityDataList.forEach(function (e, i) {\n        const chainIndexList = e.chainList.map(function (chainname) {\n          return chainDict[ chainname ]\n        })\n        s.entityList.push(new Entity(\n          s, i, e.name, 'polymer', chainIndexList\n        ))\n      })\n\n      let ei = entityDataList.length\n      const rp = s.getResidueProxy()\n      const residueDict: {[k: string]: number[]} = {}\n\n      s.eachChain(function (cp) {\n        if (cp.entityIndex === en) {\n          rp.index = cp.residueOffset\n          if (!residueDict[ rp.resname ]) {\n            residueDict[ rp.resname ] = []\n          }\n          residueDict[ rp.resname ].push(cp.index)\n        }\n      })\n\n      Object.keys(residueDict).forEach(function (resname) {\n        const chainList = residueDict[ resname ]\n        let type: EntityTypeString = 'non-polymer'\n        let name = hetnameDict[ resname ] || resname\n        if (WaterNames.includes(resname)) {\n          name = 'water'\n          type = 'water'\n        }\n        s.entityList.push(new Entity(\n          s, ei, name, type, chainList\n        ))\n        ei += 1\n      })\n    }\n\n    //\n\n    if (unitcellDict.a !== undefined) {\n      s.unitcell = new Unitcell(unitcellDict as UnitcellParams)\n    } else {\n      s.unitcell = undefined\n    }\n\n    if (helices.length || sheets.length) {\n      assignSecondaryStructure(s, secStruct)\n    }\n\n    s.finalizeAtoms()\n    if (!isLegacy) calculateChainnames(s)\n    calculateBonds(s)\n    s.finalizeBonds()\n\n    if (!helices.length && !sheets.length) {\n      calculateSecondaryStructure(s)\n    }\n    buildUnitcellAssembly(s)\n\n    if (Debug) Log.timeEnd('PdbParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('pdb', PdbParser)\nParserRegistry.add('pdb1', PdbParser)\nParserRegistry.add('ent', PdbParser)\n\nexport default PdbParser\n\nexport {\n  HelixTypes\n}\n","/**\n * @file Cif Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport { HelixTypes } from './pdb-parser'\nimport Entity from '../structure/entity'\nimport Unitcell, { UnitcellParams } from '../symmetry/unitcell'\nimport Assembly from '../symmetry/assembly'\nimport Selection from '../selection/selection'\nimport {\n  assignResidueTypeBonds, assignSecondaryStructure, buildUnitcellAssembly,\n  calculateBonds, calculateSecondaryStructure\n} from '../structure/structure-utils'\nimport { Structure } from '../ngl';\nimport StructureBuilder from '../structure/structure-builder';\nimport { NumberArray } from '../types';\n\nconst reWhitespace = /\\s+/\nconst reQuotedWhitespace = /'((?:(?!'\\s).)*)'|\"((?:(?!\"\\s).)*)\"|(\\S+)/g\nconst reDoubleQuote = /\"/g\nconst reTrimQuotes = /^['\"]+|['\"]+$/g\n\ninterface Cif {[k: string]: any}\n\nfunction trimQuotes (str: string) {\n  if (str && str[0] === str[ str.length - 1 ] && (str[0] === \"'\" || str[0] === '\"')) {\n    return str.substring(1, str.length - 1)\n  } else {\n    return str\n  }\n}\n\nfunction ensureArray (dict: {[k: string]: any[]}, field: string) {\n  if (!Array.isArray(dict[ field ])) {\n    Object.keys(dict).forEach(function (key) {\n      dict[ key ] = [ dict[ key ] ]\n    })\n  }\n}\n\nfunction hasValue (d: string) {\n  return d !== '?'\n}\n\nfunction cifDefaults (value: string, defaultValue: string) {\n  return hasValue(value) ? value : defaultValue\n}\n\nfunction getBondOrder (valueOrder: string) {\n  switch (valueOrder.toLowerCase()) {\n    case '?': // assume single bond\n    case 'sing':\n      return 1\n    case 'doub':\n      return 2\n    case 'trip':\n      return 3\n    case 'quad':\n      return 4\n  }\n  return 0\n}\n\nfunction parseChemComp (cif: Cif, structure: Structure, structureBuilder: StructureBuilder) {\n  const atomStore = structure.atomStore\n  const atomMap = structure.atomMap\n\n  let i, n\n  const cc = cif.chem_comp\n  const cca = cif.chem_comp_atom\n  const ccb = cif.chem_comp_bond\n\n  if (cc) {\n    if (cc.name) {\n      structure.title = cc.name.trim().replace(reTrimQuotes, '')\n    }\n    if (cc.id) {\n      structure.id = cc.id.trim().replace(reTrimQuotes, '')\n    }\n  }\n\n  var atomnameDict: {[k: string]: number} = {}\n\n  if (cca) {\n    ensureArray(cca, 'comp_id')\n\n    var atomname, element, resname, resno\n    n = cca.comp_id.length\n\n    for (i = 0; i < n; ++i) {\n      atomStore.growIfFull()\n\n      atomname = cca.atom_id[ i ].replace(reDoubleQuote, '')\n      element = cca.type_symbol[ i ]\n\n      atomnameDict[ atomname ] = i\n      atomStore.atomTypeId[ i ] = atomMap.add(atomname, element)\n\n      atomStore.x[ i ] = cca.model_Cartn_x[ i ]\n      atomStore.y[ i ] = cca.model_Cartn_y[ i ]\n      atomStore.z[ i ] = cca.model_Cartn_z[ i ]\n      atomStore.serial[ i ] = i\n\n      resname = cca.pdbx_component_comp_id[ i ]\n      resno = cca.pdbx_residue_numbering ? cca.pdbx_residue_numbering[ i ] : 1\n\n      structureBuilder.addAtom(0, '', '', resname, resno, true)\n    }\n\n    for (i = 0; i < n; ++i) {\n      var j = i + n\n\n      atomStore.growIfFull()\n\n      atomname = cca.atom_id[ i ].replace(reDoubleQuote, '')\n      element = cca.type_symbol[ i ]\n\n      atomStore.atomTypeId[ j ] = atomMap.add(atomname, element)\n\n      atomStore.x[ j ] = cca.pdbx_model_Cartn_x_ideal[ i ]\n      atomStore.y[ j ] = cca.pdbx_model_Cartn_y_ideal[ i ]\n      atomStore.z[ j ] = cca.pdbx_model_Cartn_z_ideal[ i ]\n      atomStore.serial[ j ] = j\n\n      resname = cca.pdbx_component_comp_id[ i ]\n      resno = cca.pdbx_residue_numbering ? cca.pdbx_residue_numbering[ i ] : 1\n\n      structureBuilder.addAtom(1, '', '', resname, resno, true)\n    }\n  }\n\n  if (cca && ccb) {\n    ensureArray(ccb, 'comp_id')\n\n    var atomname1, atomname2, bondOrder\n    n = ccb.comp_id.length\n    var na = cca.comp_id.length\n\n    var ap1 = structure.getAtomProxy()\n    var ap2 = structure.getAtomProxy()\n\n    for (i = 0; i < n; ++i) {\n      atomname1 = ccb.atom_id_1[ i ].replace(reDoubleQuote, '')\n      atomname2 = ccb.atom_id_2[ i ].replace(reDoubleQuote, '')\n      bondOrder = getBondOrder(ccb.value_order[ i ])\n\n      ap1.index = atomnameDict[ atomname1 ]\n      ap2.index = atomnameDict[ atomname2 ]\n      structure.bondStore.growIfFull()\n      structure.bondStore.addBond(ap1, ap2, bondOrder)\n\n      ap1.index += na\n      ap2.index += na\n      structure.bondStore.growIfFull()\n      structure.bondStore.addBond(ap1, ap2, bondOrder)\n    }\n  }\n}\n\nfunction parseCore (cif: Cif, structure: Structure, structureBuilder: StructureBuilder) {\n  var atomStore = structure.atomStore\n  var atomMap = structure.atomMap\n\n  if (cif.data) {\n    structure.id = cif.data\n    structure.name = cif.data\n  }\n\n  structure.unitcell = new Unitcell({\n    a: parseFloat(cif.cell_length_a),\n    b: parseFloat(cif.cell_length_b),\n    c: parseFloat(cif.cell_length_c),\n    alpha: parseFloat(cif.cell_angle_alpha),\n    beta: parseFloat(cif.cell_angle_beta),\n    gamma: parseFloat(cif.cell_angle_gamma),\n    spacegroup: trimQuotes(cif['symmetry_space_group_name_H-M'])\n  })\n\n  const v = new Vector3()\n  const c = new Vector3()\n  const n = cif.atom_site_type_symbol.length\n\n  for (let i = 0; i < n; ++i) {\n    atomStore.growIfFull()\n\n    const atomname = cif.atom_site_label[ i ]\n    const element = cif.atom_site_type_symbol[ i ]\n\n    atomStore.atomTypeId[ i ] = atomMap.add(atomname, element)\n\n    v.set(\n      cif.atom_site_fract_x[ i ],\n      cif.atom_site_fract_y[ i ],\n      cif.atom_site_fract_z[ i ]\n    )\n    v.applyMatrix4(structure.unitcell.fracToCart)\n    c.add(v)\n\n    atomStore.x[ i ] = v.x\n    atomStore.y[ i ] = v.y\n    atomStore.z[ i ] = v.z\n    if (cif.atom_site_occupancy) {\n      atomStore.occupancy[ i ] = parseFloat(cif.atom_site_occupancy[ i ])\n    }\n    atomStore.serial[ i ] = i\n\n    structureBuilder.addAtom(0, '', '', 'HET', 1, true)\n  }\n\n  c.divideScalar(n)\n  structure.center = c\n  buildUnitcellAssembly(structure)\n\n  const v2 = new Vector3()\n  const v3 = new Vector3()\n  const ml = structure.biomolDict.SUPERCELL.partList[ 0 ].matrixList\n\n  let k = n\n\n  function covalent (idx: number) {\n    return atomMap.get(atomStore.atomTypeId[ idx ]).covalent\n  }\n  const identityMatrix = new Matrix4()\n\n  for (let i = 0; i < n; ++i) {\n    const covalentI = covalent(i)\n\n    v.set(\n      atomStore.x[ i ],\n      atomStore.y[ i ],\n      atomStore.z[ i ]\n    )\n\n    ml.forEach(function (m) {\n      if (identityMatrix.equals(m)) return\n\n      v2.copy(v)\n      v2.applyMatrix4(m)\n\n      for (let j = 0; j < n; ++j) {\n        v3.set(\n          atomStore.x[ j ],\n          atomStore.y[ j ],\n          atomStore.z[ j ]\n        )\n\n        const distSquared = v2.distanceToSquared(v3)\n        const d = covalent(j) + covalentI\n        const d1 = d + 0.3\n        const d2 = d - 0.5\n\n        if (distSquared < (d1 * d1) && distSquared > (d2 * d2)) {\n          atomStore.growIfFull()\n\n          atomStore.atomTypeId[ k ] = atomStore.atomTypeId[ i ]\n          atomStore.x[ k ] = v2.x\n          atomStore.y[ k ] = v2.y\n          atomStore.z[ k ] = v2.z\n          atomStore.occupancy[ k ] = atomStore.occupancy[ i ]\n          atomStore.serial[ k ] = k\n          atomStore.altloc[ k ] = 'A'.charCodeAt(0)\n\n          structureBuilder.addAtom(0, '', '', 'HET', 1, true)\n\n          k += 1\n          return\n        }\n      }\n    })\n  }\n}\n\nfunction processSecondaryStructure (cif: Cif, structure: Structure, asymIdDict: {[k: string]: string}) {\n  var helices: [string, number, string, string, number, string, number][] = []\n  var sheets: [string, number, string, string, number, string][] = []\n\n  var i, il, begIcode, endIcode\n\n  // get helices\n  var sc = cif.struct_conf\n\n  if (sc) {\n    ensureArray(sc, 'id')\n\n    for (i = 0, il = sc.beg_auth_seq_id.length; i < il; ++i) {\n      var helixType = parseInt(sc.pdbx_PDB_helix_class[ i ])\n      if (!Number.isNaN(helixType)) {\n        begIcode = sc.pdbx_beg_PDB_ins_code[ i ]\n        endIcode = sc.pdbx_end_PDB_ins_code[ i ]\n        helices.push([\n          asymIdDict[ sc.beg_label_asym_id[ i ] ],\n          parseInt(sc.beg_auth_seq_id[ i ]),\n          cifDefaults(begIcode, ''),\n          asymIdDict[ sc.end_label_asym_id[ i ] ],\n          parseInt(sc.end_auth_seq_id[ i ]),\n          cifDefaults(endIcode, ''),\n          (HelixTypes[ helixType ] || HelixTypes[0]).charCodeAt(0)\n        ])\n      }\n    }\n  }\n\n  // get sheets\n  var ssr = cif.struct_sheet_range\n\n  if (ssr) {\n    ensureArray(ssr, 'id')\n\n    for (i = 0, il = ssr.beg_auth_seq_id.length; i < il; ++i) {\n      begIcode = ssr.pdbx_beg_PDB_ins_code[ i ]\n      endIcode = ssr.pdbx_end_PDB_ins_code[ i ]\n      sheets.push([\n        asymIdDict[ ssr.beg_label_asym_id[ i ] ],\n        parseInt(ssr.beg_auth_seq_id[ i ]),\n        cifDefaults(begIcode, ''),\n        asymIdDict[ ssr.end_label_asym_id[ i ] ],\n        parseInt(ssr.end_auth_seq_id[ i ]),\n        cifDefaults(endIcode, '')\n      ])\n    }\n  }\n\n  if (sc || ssr) {\n    return {\n      helices: helices,\n      sheets: sheets\n    }\n  } else {\n    return false\n  }\n}\n\nfunction processSymmetry (cif: Cif, structure: Structure, asymIdDict: {[k: string]: string}) {\n  // biomol & ncs processing\n  var operDict: {[k: string]: Matrix4} = {}\n  var biomolDict = structure.biomolDict\n\n  if (cif.pdbx_struct_oper_list) {\n    var biomolOp = cif.pdbx_struct_oper_list\n    ensureArray(biomolOp, 'id')\n\n    biomolOp.id.forEach(function (id: number, i: number) {\n      var m = new Matrix4()\n      var elms = m.elements\n\n      elms[ 0 ] = parseFloat(biomolOp[ 'matrix[1][1]' ][ i ])\n      elms[ 1 ] = parseFloat(biomolOp[ 'matrix[1][2]' ][ i ])\n      elms[ 2 ] = parseFloat(biomolOp[ 'matrix[1][3]' ][ i ])\n\n      elms[ 4 ] = parseFloat(biomolOp[ 'matrix[2][1]' ][ i ])\n      elms[ 5 ] = parseFloat(biomolOp[ 'matrix[2][2]' ][ i ])\n      elms[ 6 ] = parseFloat(biomolOp[ 'matrix[2][3]' ][ i ])\n\n      elms[ 8 ] = parseFloat(biomolOp[ 'matrix[3][1]' ][ i ])\n      elms[ 9 ] = parseFloat(biomolOp[ 'matrix[3][2]' ][ i ])\n      elms[ 10 ] = parseFloat(biomolOp[ 'matrix[3][3]' ][ i ])\n\n      elms[ 3 ] = parseFloat(biomolOp[ 'vector[1]' ][ i ])\n      elms[ 7 ] = parseFloat(biomolOp[ 'vector[2]' ][ i ])\n      elms[ 11 ] = parseFloat(biomolOp[ 'vector[3]' ][ i ])\n\n      m.transpose()\n\n      operDict[ id ] = m\n    })\n  }\n\n  if (cif.pdbx_struct_assembly_gen) {\n    var gen = cif.pdbx_struct_assembly_gen\n    ensureArray(gen, 'assembly_id')\n\n    var getMatrixDict = function (expr: string) {\n      var matDict: {[k: string]: Matrix4} = {}\n\n      var l = expr.replace(/[()']/g, '').split(',')\n\n      l.forEach(function (e) {\n        if (e.includes('-')) {\n          var es = e.split('-')\n\n          var j = parseInt(es[ 0 ])\n          var m = parseInt(es[ 1 ])\n\n          for (; j <= m; ++j) {\n            matDict[ j ] = operDict[ j ]\n          }\n        } else {\n          matDict[ e ] = operDict[ e ]\n        }\n      })\n\n      return matDict\n    }\n\n    gen.assembly_id.forEach(function (id: string, i: number) {\n      var md:{[k: string]: Matrix4} = {}\n      var oe = gen.oper_expression[ i ].replace(/['\"]\\(|['\"]/g, '')\n\n      if (oe.includes(')(') || oe.indexOf('(') > 0) {\n        oe = oe.split('(')\n\n        var md1 = getMatrixDict(oe[ 0 ])\n        var md2 = getMatrixDict(oe[ 1 ])\n\n        Object.keys(md1).forEach(function (k1) {\n          Object.keys(md2).forEach(function (k2) {\n            var mat = new Matrix4()\n\n            mat.multiplyMatrices(md1[ k1 ], md2[ k2 ])\n            md[ k1 + 'x' + k2 ] = mat\n          })\n        })\n      } else {\n        md = getMatrixDict(oe)\n      }\n\n      var matrixList = []\n      for (var k in md) {\n        matrixList.push(md[ k ])\n      }\n\n      var name = id\n      if (/^(0|[1-9][0-9]*)$/.test(name)) name = 'BU' + name\n\n      var chainList = gen.asym_id_list[ i ].split(',')\n      for (var j = 0, jl = chainList.length; j < jl; ++j) {\n        chainList[ j ] = asymIdDict[ chainList[ j ] ]\n      }\n\n      if (biomolDict[ name ] === undefined) {\n        biomolDict[ name ] = new Assembly(name)\n      }\n      biomolDict[ name ].addPart(matrixList, chainList)\n    })\n  }\n\n  // non-crystallographic symmetry operations\n  if (cif.struct_ncs_oper) {\n    var ncsOp = cif.struct_ncs_oper\n    ensureArray(ncsOp, 'id')\n\n    var ncsName = 'NCS'\n    biomolDict[ ncsName ] = new Assembly(ncsName)\n    var ncsPart = biomolDict[ ncsName ].addPart()\n\n    ncsOp.id.forEach(function (id: string, i: number) {\n      // ignore 'given' operators\n      if (ncsOp.code[ i ] === 'given') return\n\n      var m = new Matrix4()\n      var elms = m.elements\n\n      elms[ 0 ] = parseFloat(ncsOp[ 'matrix[1][1]' ][ i ])\n      elms[ 1 ] = parseFloat(ncsOp[ 'matrix[1][2]' ][ i ])\n      elms[ 2 ] = parseFloat(ncsOp[ 'matrix[1][3]' ][ i ])\n\n      elms[ 4 ] = parseFloat(ncsOp[ 'matrix[2][1]' ][ i ])\n      elms[ 5 ] = parseFloat(ncsOp[ 'matrix[2][2]' ][ i ])\n      elms[ 6 ] = parseFloat(ncsOp[ 'matrix[2][3]' ][ i ])\n\n      elms[ 8 ] = parseFloat(ncsOp[ 'matrix[3][1]' ][ i ])\n      elms[ 9 ] = parseFloat(ncsOp[ 'matrix[3][2]' ][ i ])\n      elms[ 10 ] = parseFloat(ncsOp[ 'matrix[3][3]' ][ i ])\n\n      elms[ 3 ] = parseFloat(ncsOp[ 'vector[1]' ][ i ])\n      elms[ 7 ] = parseFloat(ncsOp[ 'vector[2]' ][ i ])\n      elms[ 11 ] = parseFloat(ncsOp[ 'vector[3]' ][ i ])\n\n      m.transpose()\n\n      ncsPart.matrixList.push(m)\n    })\n\n    if (ncsPart.matrixList.length === 0) {\n      delete biomolDict[ ncsName ]\n    }\n  }\n\n  // cell & symmetry\n  const unitcellDict: {\n    a?: number\n    b?: number\n    c?: number\n    alpha?: number\n    beta?: number\n    gamma?: number\n    spacegroup?: string\n    origx?: Matrix4\n    scale?: Matrix4\n  } = {}\n\n  if (cif.cell) {\n    const cell = cif.cell\n\n    const a = parseFloat(cell.length_a)\n    const b = parseFloat(cell.length_b)\n    const c = parseFloat(cell.length_c)\n\n    const box = new Float32Array(9)\n    box[ 0 ] = a\n    box[ 4 ] = b\n    box[ 8 ] = c\n    structure.boxes.push(box)\n\n    unitcellDict.a = a\n    unitcellDict.b = b\n    unitcellDict.c = c\n    unitcellDict.alpha = parseFloat(cell.angle_alpha)\n    unitcellDict.beta = parseFloat(cell.angle_beta)\n    unitcellDict.gamma = parseFloat(cell.angle_gamma)\n  }\n\n  if (cif.symmetry) {\n    unitcellDict.spacegroup = trimQuotes(\n      cif.symmetry[ 'space_group_name_H-M' ]\n    )\n  }\n\n  // origx\n  var origx = new Matrix4()\n\n  if (cif.database_PDB_matrix) {\n    var origxMat = cif.database_PDB_matrix\n    var origxElms = origx.elements\n\n    origxElms[ 0 ] = parseFloat(origxMat[ 'origx[1][1]' ])\n    origxElms[ 1 ] = parseFloat(origxMat[ 'origx[1][2]' ])\n    origxElms[ 2 ] = parseFloat(origxMat[ 'origx[1][3]' ])\n\n    origxElms[ 4 ] = parseFloat(origxMat[ 'origx[2][1]' ])\n    origxElms[ 5 ] = parseFloat(origxMat[ 'origx[2][2]' ])\n    origxElms[ 6 ] = parseFloat(origxMat[ 'origx[2][3]' ])\n\n    origxElms[ 8 ] = parseFloat(origxMat[ 'origx[3][1]' ])\n    origxElms[ 9 ] = parseFloat(origxMat[ 'origx[3][2]' ])\n    origxElms[ 10 ] = parseFloat(origxMat[ 'origx[3][3]' ])\n\n    origxElms[ 3 ] = parseFloat(origxMat[ 'origx_vector[1]' ])\n    origxElms[ 7 ] = parseFloat(origxMat[ 'origx_vector[2]' ])\n    origxElms[ 11 ] = parseFloat(origxMat[ 'origx_vector[3]' ])\n\n    origx.transpose()\n\n    unitcellDict.origx = origx\n  }\n\n  // scale\n  var scale = new Matrix4()\n\n  if (cif.atom_sites) {\n    var scaleMat = cif.atom_sites\n    var scaleElms = scale.elements\n\n    scaleElms[ 0 ] = parseFloat(scaleMat[ 'fract_transf_matrix[1][1]' ])\n    scaleElms[ 1 ] = parseFloat(scaleMat[ 'fract_transf_matrix[1][2]' ])\n    scaleElms[ 2 ] = parseFloat(scaleMat[ 'fract_transf_matrix[1][3]' ])\n\n    scaleElms[ 4 ] = parseFloat(scaleMat[ 'fract_transf_matrix[2][1]' ])\n    scaleElms[ 5 ] = parseFloat(scaleMat[ 'fract_transf_matrix[2][2]' ])\n    scaleElms[ 6 ] = parseFloat(scaleMat[ 'fract_transf_matrix[2][3]' ])\n\n    scaleElms[ 8 ] = parseFloat(scaleMat[ 'fract_transf_matrix[3][1]' ])\n    scaleElms[ 9 ] = parseFloat(scaleMat[ 'fract_transf_matrix[3][2]' ])\n    scaleElms[ 10 ] = parseFloat(scaleMat[ 'fract_transf_matrix[3][3]' ])\n\n    scaleElms[ 3 ] = parseFloat(scaleMat[ 'fract_transf_vector[1]' ])\n    scaleElms[ 7 ] = parseFloat(scaleMat[ 'fract_transf_vector[2]' ])\n    scaleElms[ 11 ] = parseFloat(scaleMat[ 'fract_transf_vector[3]' ])\n\n    scale.transpose()\n\n    unitcellDict.scale = scale\n  }\n\n  if (unitcellDict.a !== undefined) {\n    structure.unitcell = new Unitcell(unitcellDict as UnitcellParams)\n  } else {\n    structure.unitcell = undefined\n  }\n}\n\nfunction processConnections (cif: Cif, structure: Structure, asymIdDict: {[k: string]: string}) {\n  // add connections\n  var sc = cif.struct_conn\n\n  if (sc) {\n    ensureArray(sc, 'id')\n\n    var reDoubleQuote = /\"/g\n    var ap1 = structure.getAtomProxy()\n    var ap2 = structure.getAtomProxy()\n    var atomIndicesCache: {[k: string]: Uint32Array|undefined} = {}\n\n    for (var i = 0, il = sc.id.length; i < il; ++i) {\n      // ignore:\n      // hydrog - hydrogen bond\n      // mismat - mismatched base pairs\n      // saltbr - ionic interaction\n\n      var connTypeId = sc.conn_type_id[ i ]\n      if (connTypeId === 'hydrog' ||\n          connTypeId === 'mismat' ||\n          connTypeId === 'saltbr') continue\n\n      // ignore bonds between symmetry mates\n      if (sc.ptnr1_symmetry[ i ] !== '1_555' ||\n          sc.ptnr2_symmetry[ i ] !== '1_555') continue\n\n      // process:\n      // covale - covalent bond\n      // covale_base -\n      //      covalent modification of a nucleotide base\n      // covale_phosphate -\n      //      covalent modification of a nucleotide phosphate\n      // covale_sugar -\n      //      covalent modification of a nucleotide sugar\n      // disulf - disulfide bridge\n      // metalc - metal coordination\n      // modres - covalent residue modification\n\n      var inscode1 = sc.pdbx_ptnr1_PDB_ins_code[ i ]\n      var altloc1 = sc.pdbx_ptnr1_label_alt_id[ i ]\n      var sele1 = (\n        sc.ptnr1_auth_seq_id[ i ] +\n        (hasValue(inscode1) ? ('^' + inscode1) : '') +\n        ':' + asymIdDict[ sc.ptnr1_label_asym_id[ i ] ] +\n        '.' + sc.ptnr1_label_atom_id[ i ].replace(reDoubleQuote, '') +\n        (hasValue(altloc1) ? ('%' + altloc1) : '')\n      )\n      var atomIndices1 = atomIndicesCache[ sele1 ]\n      if (!atomIndices1) {\n        var selection1 = new Selection(sele1)\n        if (selection1.selection.error) {\n          if (Debug) Log.warn('invalid selection for connection', sele1)\n          continue\n        }\n        atomIndices1 = structure.getAtomIndices(selection1)\n        atomIndicesCache[ sele1 ] = atomIndices1\n      }\n\n      var inscode2 = sc.pdbx_ptnr2_PDB_ins_code[ i ]\n      var altloc2 = sc.pdbx_ptnr2_label_alt_id[ i ]\n      var sele2 = (\n        sc.ptnr2_auth_seq_id[ i ] +\n        (hasValue(inscode2) ? ('^' + inscode2) : '') +\n        ':' + asymIdDict[ sc.ptnr2_label_asym_id[ i ] ] +\n        '.' + sc.ptnr2_label_atom_id[ i ].replace(reDoubleQuote, '') +\n        (hasValue(altloc2) ? ('%' + altloc2) : '')\n      )\n      var atomIndices2 = atomIndicesCache[ sele2 ]\n      if (!atomIndices2) {\n        var selection2 = new Selection(sele2)\n        if (selection2.selection.error) {\n          if (Debug) Log.warn('invalid selection for connection', sele2)\n          continue\n        }\n        atomIndices2 = structure.getAtomIndices(selection2)\n        atomIndicesCache[ sele2 ] = atomIndices2\n      }\n\n      // cases with more than one atom per selection\n      // - #altloc1 to #altloc2\n      // - #model to #model\n      // - #altloc1 * #model to #altloc2 * #model\n\n      var k = atomIndices1!.length\n      var l = atomIndices2!.length\n\n      if (k > l) {\n        var tmpA = k\n        k = l\n        l = tmpA\n        var tmpB = atomIndices1\n        atomIndices1 = atomIndices2\n        atomIndices2 = tmpB\n      }\n\n      // console.log( k, l );\n\n      if (k === 0 || l === 0) {\n        if (Debug) Log.warn('no atoms found for', sele1, sele2)\n        continue\n      }\n\n      for (var j = 0; j < l; ++j) {\n        ap1.index = atomIndices1![ j % k ]\n        ap2.index = atomIndices2![ j ]\n\n        if (ap1 && ap2) {\n          structure.bondStore.addBond(\n            ap1, ap2, getBondOrder(sc.pdbx_value_order[ i ])\n          )\n        } else {\n          Log.log('atoms for connection not found')\n        }\n      }\n    }\n  }\n}\n\nfunction processEntities (cif: Cif, structure: Structure, chainIndexDict: {[k: string]: Set<number>}) {\n  if (cif.entity) {\n    ensureArray(cif.entity, 'id')\n    var e = cif.entity\n    var n = e.id.length\n    for (var i = 0; i < n; ++i) {\n      var description = e.pdbx_description[ i ]\n      var type = e.type[ i ]\n      var chainIndexList: number[] = Array.from(chainIndexDict[ e.id[ i ] ])\n      structure.entityList[ i ] = new Entity(\n        structure, i, description, type, chainIndexList\n      )\n    }\n  }\n}\n\n//\n\nclass CifParser extends StructureParser {\n  get type () { return 'cif' }\n\n  _parse () {\n    // http://mmcif.wwpdb.org/\n\n    Log.time('CifParser._parse ' + this.name)\n\n    var s = this.structure\n    var sb = this.structureBuilder\n\n    var firstModelOnly = this.firstModelOnly\n    var asTrajectory = this.asTrajectory\n    var cAlphaOnly = this.cAlphaOnly\n\n    var frames = s.frames\n    var currentFrame: NumberArray, currentCoord: number\n\n    var rawline, line\n\n    //\n\n    var cif: Cif = {}\n    var asymIdDict: {[k: string]: string} = {}\n    var chainIndexDict:{[k: string]: Set<number>} = {}\n\n    var pendingString = false\n    var currentString: string|null = null\n    var pendingValue = false\n    var pendingLoop = false\n    var pendingName = false\n    var loopPointers: string[][] = []\n    var currentLoopIndex: number|null = null\n    var currentCategory: string|null = null\n    var currentName: string|boolean|null = null\n    var first: boolean|null = null\n    var pointerNames: string[] = []\n\n    var authAsymId: number, authSeqId: number, labelSeqId: number,\n      labelAtomId: number, labelCompId: number, labelAsymId: number, labelEntityId: number, labelAltId: number,\n      groupPDB: number, id: number, typeSymbol: number, pdbxPDBmodelNum: number, pdbxPDBinsCode: number,\n      CartnX: number, CartnY: number, CartnZ: number, bIsoOrEquiv: number, occupancy: number\n\n    //\n\n    var atomMap = s.atomMap\n    var atomStore = s.atomStore\n    atomStore.resize(this.streamer.data.length / 100)\n\n    var idx = 0\n    var modelIdx = 0\n    var modelNum: number\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (var i = _i; i < _n; ++i) {\n        rawline = lines[i]\n        line = rawline.trim()\n\n        if ((!line && !pendingString && !pendingLoop) || line[0] === '#') {\n          // Log.log( \"NEW BLOCK\" );\n\n          pendingString = false\n          pendingLoop = false\n          pendingValue = false\n          loopPointers.length = 0\n          currentLoopIndex = null\n          currentCategory = null\n          currentName = null\n          first = null\n          pointerNames.length = 0\n        } else if (line.substring(0, 5) === 'data_') {\n          cif.data = line.substring(5).trim()\n\n          // Log.log( \"DATA\", data );\n        } else if (line[0] === ';') {\n          if (pendingString) {\n            // Log.log( \"STRING END\", currentString );\n\n            if (pendingLoop) {\n              if (currentLoopIndex === loopPointers.length) {\n                currentLoopIndex = 0\n              }\n              loopPointers[ currentLoopIndex as number ].push(currentString as string);\n              (currentLoopIndex as number) += 1\n            } else {\n              if (currentName === false) {\n                cif[ currentCategory as string ] = currentString\n              } else {\n                cif[ currentCategory as string ][ currentName as string ] = currentString //TODO currentname can equals null\n              }\n            }\n\n            pendingString = false\n            currentString = null\n          } else {\n            // Log.log( \"STRING START\" );\n\n            pendingString = true\n            currentString = line.substring(1)\n          }\n        } else if (line === 'loop_') {\n          // Log.log( \"LOOP START\" );\n\n          pendingLoop = true\n          pendingName = true\n          loopPointers.length = 0\n          pointerNames.length = 0\n          currentLoopIndex = 0\n        } else if (line[0] === '_') {\n          var keyParts, category, name\n\n          if (pendingLoop && !pendingName) {\n            pendingLoop = false\n          }\n\n          if (pendingLoop) {\n            // Log.log( \"LOOP KEY\", line );\n\n            keyParts = line.split('.')\n            category = keyParts[ 0 ].substring(1)\n            name = keyParts[ 1 ]\n\n            if (keyParts.length === 1) {\n              name = false\n              if (!cif[ category ]) cif[ category ] = []\n              loopPointers.push(cif[ category ])\n            } else {\n              if (!cif[ category ]) cif[ category ] = {}\n              if (cif[ category ][ name ]) {\n                if (Debug) Log.warn(category, name, 'already exists')\n              } else {\n                cif[ category ][ name ] = []\n                loopPointers.push(cif[ category ][ name ])\n                pointerNames.push(name)\n              }\n            }\n\n            currentCategory = category\n            currentName = name\n            first = true\n          } else {\n            var keyValuePair = line.match(reQuotedWhitespace)\n            var key = keyValuePair![ 0 ]\n            var value = keyValuePair![ 1 ]\n            keyParts = key.split('.')\n            category = keyParts[ 0 ].substring(1)\n            name = keyParts[ 1 ]\n\n            if (keyParts.length === 1) {\n              name = false\n              cif[ category ] = value\n            } else {\n              if (!cif[ category ]) cif[ category ] = {}\n\n              if (cif[ category ][ name ]) {\n                if (Debug) Log.warn(category, name, 'already exists')\n              } else {\n                cif[ category ][ name ] = value\n              }\n            }\n\n            if (!value) pendingValue = true\n\n            currentCategory = category\n            currentName = name\n          }\n        } else {\n          if (pendingString) {\n            // Log.log( \"STRING VALUE\", line );\n\n            currentString += rawline\n          } else if (pendingLoop) {\n            // Log.log( \"LOOP VALUE\", line );\n\n            if (!line) {\n              continue\n            } else if (currentCategory === 'atom_site') {\n              const ls = line.split(reWhitespace)\n\n              if (first) {\n                authAsymId = pointerNames.indexOf('auth_asym_id')\n                authSeqId = pointerNames.indexOf('auth_seq_id')\n                labelSeqId = pointerNames.indexOf('label_seq_id')\n                labelAtomId = pointerNames.indexOf('label_atom_id')\n                labelCompId = pointerNames.indexOf('label_comp_id')\n                labelAsymId = pointerNames.indexOf('label_asym_id')\n                labelEntityId = pointerNames.indexOf('label_entity_id')\n                labelAltId = pointerNames.indexOf('label_alt_id')\n                CartnX = pointerNames.indexOf('Cartn_x')\n                CartnY = pointerNames.indexOf('Cartn_y')\n                CartnZ = pointerNames.indexOf('Cartn_z')\n                id = pointerNames.indexOf('id')\n                typeSymbol = pointerNames.indexOf('type_symbol')\n                groupPDB = pointerNames.indexOf('group_PDB')\n                bIsoOrEquiv = pointerNames.indexOf('B_iso_or_equiv')\n                pdbxPDBmodelNum = pointerNames.indexOf('pdbx_PDB_model_num')\n\n                pdbxPDBinsCode = pointerNames.indexOf('pdbx_PDB_ins_code')\n                occupancy = pointerNames.indexOf('occupancy')\n\n                first = false\n\n                modelNum = parseInt(ls[ pdbxPDBmodelNum ])\n\n                if (asTrajectory) {\n                  currentFrame = []\n                  currentCoord = 0\n                }\n              }\n\n              //\n\n              const _modelNum = parseInt(ls[ pdbxPDBmodelNum ])\n\n              if (modelNum !== _modelNum) {\n                if (asTrajectory) {\n                  if (modelIdx === 0) {\n                    frames.push(new Float32Array(currentFrame))\n                  }\n\n                  currentFrame = new Float32Array(atomStore.count * 3)\n                  frames.push(currentFrame)\n                  currentCoord = 0\n                }\n\n                modelIdx += 1\n              }\n\n              modelNum = _modelNum\n\n              if (firstModelOnly && modelIdx > 0) continue\n\n              //\n\n              const atomname = ls[ labelAtomId ].replace(reDoubleQuote, '')\n              if (cAlphaOnly && atomname !== 'CA') continue\n\n              const x = parseFloat(ls[ CartnX ])\n              const y = parseFloat(ls[ CartnY ])\n              const z = parseFloat(ls[ CartnZ ])\n\n              if (asTrajectory) {\n                const frameOffset = currentCoord * 3\n\n                currentFrame[ frameOffset + 0 ] = x\n                currentFrame[ frameOffset + 1 ] = y\n                currentFrame[ frameOffset + 2 ] = z\n\n                currentCoord += 1\n\n                if (modelIdx > 0) continue\n              }\n\n              //\n\n              const resname = ls[ labelCompId ]\n              const resno = parseInt(ls[ authSeqId !== -1 ? authSeqId : labelSeqId ])\n              let inscode = ls[ pdbxPDBinsCode ]\n              inscode = (inscode === '?') ? '' : inscode\n              const chainname = ls[ authAsymId ]\n              const chainid = ls[ labelAsymId ]\n              const hetero = (ls[ groupPDB ][ 0 ] === 'H') ? 1 : 0\n\n              //\n\n              const element = ls[ typeSymbol ]\n              const bfactor = parseFloat(ls[ bIsoOrEquiv ])\n              const occ = parseFloat(ls[ occupancy ])\n              let altloc = ls[ labelAltId ]\n              altloc = (altloc === '.') ? '' : altloc\n\n              atomStore.growIfFull()\n              atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n              atomStore.x[ idx ] = x\n              atomStore.y[ idx ] = y\n              atomStore.z[ idx ] = z\n              atomStore.serial[ idx ] = parseInt(ls[ id ])\n              atomStore.bfactor[ idx ] = isNaN(bfactor) ? 0 : bfactor\n              atomStore.occupancy[ idx ] = isNaN(occ) ? 0 : occ\n              atomStore.altloc[ idx ] = altloc.charCodeAt(0)\n\n              sb.addAtom(modelIdx, chainname, chainid, resname, resno, hetero, undefined, inscode)\n\n              if (Debug) {\n                // check if one-to-many (chainname-asymId) relationship is\n                // actually a many-to-many mapping\n                const assignedChainname = asymIdDict[ chainid ]\n                if (assignedChainname !== undefined && assignedChainname !== chainname) {\n                  if (Debug) Log.warn(assignedChainname, chainname)\n                }\n              }\n              // chainname mapping: label_asym_id -> auth_asym_id\n              asymIdDict[ chainid ] = chainname\n\n              // entity mapping: chainIndex -> label_entity_id\n              const entityId = ls[ labelEntityId ]\n              if (!chainIndexDict[ entityId ]) {\n                chainIndexDict[ entityId ] = new Set()\n              }\n              chainIndexDict[ entityId ].add(s.chainStore.count - 1)\n\n              idx += 1\n            } else {\n              const ls = line.match(reQuotedWhitespace)\n              const nn = ls!.length\n\n              if (currentLoopIndex === loopPointers.length) {\n                currentLoopIndex = 0\n              }/* else if( currentLoopIndex + nn > loopPointers.length ){\n                Log.warn( \"cif parsing error, wrong number of loop data entries\", nn, loopPointers.length );\n              } */\n\n              for (let j = 0; j < nn; ++j) {\n                loopPointers[ <number>currentLoopIndex + j ].push(ls![ j ])\n              }\n\n              (<number>currentLoopIndex) += nn\n            }\n\n            pendingName = false\n          } else if (line[0] === \"'\" && line[line.length - 1] === \"'\") {\n            // Log.log( \"NEWLINE STRING\", line );\n\n            const str = line.substring(1, line.length - 1)\n\n            if (currentName === false) {\n              cif[ currentCategory as string ] = str\n            } else {\n              cif[ currentCategory as string ][ currentName as string ] = str\n            }\n          } else if (pendingValue) {\n            // Log.log( \"NEWLINE VALUE\", line );\n\n            if (currentName === false) {\n              cif[ currentCategory as string ] = line\n            } else {\n              cif[ currentCategory as string ][ currentName as string ] = line\n            }\n          } else {\n            if (Debug) Log.log('CifParser._parse: unknown state', line)\n          }\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    if (cif.chem_comp && cif.chem_comp_atom) {\n      parseChemComp(cif, s, sb)\n      sb.finalize()\n      s.finalizeAtoms()\n      s.finalizeBonds()\n      assignResidueTypeBonds(s)\n    } else if (cif.atom_site_type_symbol && cif.atom_site_label && cif.atom_site_fract_x) {\n      parseCore(cif, s, sb)\n      sb.finalize()\n      s.finalizeAtoms()\n      calculateBonds(s)\n      s.finalizeBonds()\n      // assignResidueTypeBonds( s );\n    } else {\n      var secStruct = processSecondaryStructure(cif, s, asymIdDict)\n      processSymmetry(cif, s, asymIdDict)\n      processConnections(cif, s, asymIdDict)\n      processEntities(cif, s, chainIndexDict)\n\n      if (cif.struct && cif.struct.title) {\n        s.title = cif.struct.title.trim().replace(reTrimQuotes, '')\n      }\n      if (cif.entry && cif.entry.id) {\n        s.id = cif.entry.id.trim().replace(reTrimQuotes, '')\n      }\n\n      // structure header (mimicking biojava)\n      if (cif.pdbx_audit_revision_history) {\n        if (cif.pdbx_audit_revision_history.revision_date) {\n          ensureArray(cif.pdbx_audit_revision_history, 'revision_date')\n          const dates = cif.pdbx_audit_revision_history.revision_date.filter(hasValue)\n          if (dates.length) {\n            s.header.releaseDate = dates[ 0 ]\n          }\n        }\n        if (cif.pdbx_database_status.recvd_initial_deposition_date) {\n          ensureArray(cif.pdbx_database_status, 'recvd_initial_deposition_date')\n          const depDates = cif.pdbx_database_status.recvd_initial_deposition_date.filter(hasValue)\n          if (depDates.length) {\n            s.header.depositionDate = depDates[ 0 ]\n          }\n        }\n      } else if (cif.database_PDB_rev) {\n        if (cif.database_PDB_rev.date) {\n          ensureArray(cif.database_PDB_rev, 'date')\n          const dates = cif.database_PDB_rev.date.filter(hasValue)\n          if (dates.length) {\n            s.header.releaseDate = dates[ 0 ]\n          }\n        }\n        if (cif.database_PDB_rev.date_original) {\n          ensureArray(cif.database_PDB_rev, 'date_original')\n          const depDates = cif.database_PDB_rev.date_original.filter(hasValue)\n          if (depDates.length) {\n            s.header.depositionDate = depDates[ 0 ]\n          }\n        }\n      }\n      if (cif.reflns && cif.reflns.d_resolution_high) {\n        if (hasValue(cif.reflns.d_resolution_high)) {\n          s.header.resolution = parseFloat(cif.reflns.d_resolution_high)\n        }\n      } else if (cif.refine && cif.refine.ls_d_res_high) {\n        if (hasValue(cif.refine.ls_d_res_high)) {\n          s.header.resolution = parseFloat(cif.refine.ls_d_res_high)\n        }\n      }\n      if (cif.refine && cif.refine.ls_R_factor_R_free) {\n        if (hasValue(cif.refine.ls_R_factor_R_free)) {\n          s.header.rFree = parseFloat(cif.refine.ls_R_factor_R_free)\n        }\n      }\n      if (cif.refine && cif.refine.ls_R_factor_R_work) {\n        if (hasValue(cif.refine.ls_R_factor_R_work)) {\n          s.header.rWork = parseFloat(cif.refine.ls_R_factor_R_work)\n        }\n      }\n      if (cif.exptl && cif.exptl.method) {\n        ensureArray(cif.exptl, 'method')\n        s.header.experimentalMethods = cif.exptl.method.map(function (m: string) {\n          return m.replace(reTrimQuotes, '')\n        })\n      }\n\n      sb.finalize()\n      s.finalizeAtoms()\n      calculateBonds(s)\n      s.finalizeBonds()\n\n      if (!secStruct) {\n        calculateSecondaryStructure(s)\n      } else {\n        assignSecondaryStructure(s, secStruct)\n      }\n      buildUnitcellAssembly(s)\n\n      s.extraData.cif = cif\n    }\n\n    if (Debug) Log.timeEnd('CifParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('cif', CifParser)\nParserRegistry.add('mcif', CifParser)\nParserRegistry.add('mmcif', CifParser)\n\nexport default CifParser\n","/**\n * @file Gro Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  calculateBonds, calculateChainnames, calculateSecondaryStructure\n} from '../structure/structure-utils'\n\nclass GroParser extends StructureParser {\n  get type () { return 'gro' }\n\n  _parse () {\n    // http://manual.gromacs.org/current/online/gro.html\n\n    if (Debug) Log.time('GroParser._parse ' + this.name)\n\n    var s = this.structure\n    var sb = this.structureBuilder\n\n    var firstModelOnly = this.firstModelOnly\n    var asTrajectory = this.asTrajectory\n    var cAlphaOnly = this.cAlphaOnly\n\n    var frames = s.frames\n    var boxes = s.boxes\n    var currentFrame: Float32Array, currentCoord: number\n\n    var firstLines = this.streamer.peekLines(3)\n\n    s.title = firstLines[ 0 ].trim()\n\n    // determine number of decimal places\n    var ndec = firstLines[ 2 ].length - firstLines[ 2 ].lastIndexOf('.') - 1\n    var lpos = 5 + ndec\n    var xpos = 20\n    var ypos = 20 + lpos\n    var zpos = 20 + 2 * lpos\n\n    //\n\n    var atomname, resname, resno, serial\n\n    var atomCount = parseInt(firstLines[ 1 ])\n    var modelLineCount = atomCount + 3\n\n    var atomMap = s.atomMap\n    var atomStore = s.atomStore\n    atomStore.resize(atomCount)\n\n    var idx = 0\n    var modelIdx = 0\n    var lineNo = 0\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (var i = _i; i < _n; ++i) {\n        ++lineNo\n        var l = lineNo - 1\n\n        var line = lines[ i ]\n\n        if (!line) continue\n\n        if (l % modelLineCount === 0) {\n          // Log.log( \"title\", line )\n\n          if (asTrajectory) {\n            currentFrame = new Float32Array(atomCount * 3)\n            frames.push(currentFrame)\n            currentCoord = 0\n          }\n        } else if (l % modelLineCount === 1) {\n\n          // Log.log( \"atomCount\", line )\n\n        } else if (l % modelLineCount === modelLineCount - 1) {\n          var str = line.trim().split(/\\s+/)\n          var box = new Float32Array(9)\n          box[ 0 ] = parseFloat(str[ 0 ]) * 10\n          box[ 4 ] = parseFloat(str[ 1 ]) * 10\n          box[ 8 ] = parseFloat(str[ 2 ]) * 10\n          boxes.push(box)\n\n          if (firstModelOnly) {\n            return true\n          }\n\n          modelIdx += 1\n        } else {\n          atomname = line.substr(10, 5).trim()\n          if (cAlphaOnly && atomname !== 'CA') continue\n\n          var x = parseFloat(line.substr(xpos, lpos)) * 10\n          var y = parseFloat(line.substr(ypos, lpos)) * 10\n          var z = parseFloat(line.substr(zpos, lpos)) * 10\n\n          if (asTrajectory) {\n            var j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (l > modelLineCount) continue\n          }\n\n          resname = line.substr(5, 5).trim()\n          resno = parseInt(line.substr(0, 5))\n          serial = parseInt(line.substr(15, 5))\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = serial\n\n          sb.addAtom(modelIdx, '', '', resname, resno, 0, 'l')\n\n          idx += 1\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    sb.finalize()\n    s.finalizeAtoms()\n    calculateChainnames(s)\n    calculateBonds(s)\n    s.finalizeBonds()\n\n    calculateSecondaryStructure(s)\n\n    if (Debug) Log.timeEnd('GroParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('gro', GroParser)\n\nexport default GroParser\n","/**\n * @file utf8-utils\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * mostly copied from https://github.com/creationix/msgpack-js-browser\n * by Tim Caswell <tim@creationix.com>, MIT License, Copyright (c) 2013\n */\n\n\n// Encode string as utf8 into dataview at offset\nfunction utf8Write(view, offset, string) {\n  var byteLength = view.byteLength;\n  for(var i = 0, l = string.length; i < l; i++) {\n    var codePoint = string.charCodeAt(i);\n\n    // One byte of UTF-8\n    if (codePoint < 0x80) {\n      view.setUint8(offset++, codePoint >>> 0 & 0x7f | 0x00);\n      continue;\n    }\n\n    // Two bytes of UTF-8\n    if (codePoint < 0x800) {\n      view.setUint8(offset++, codePoint >>> 6 & 0x1f | 0xc0);\n      view.setUint8(offset++, codePoint >>> 0 & 0x3f | 0x80);\n      continue;\n    }\n\n    // Three bytes of UTF-8.\n    if (codePoint < 0x10000) {\n      view.setUint8(offset++, codePoint >>> 12 & 0x0f | 0xe0);\n      view.setUint8(offset++, codePoint >>> 6  & 0x3f | 0x80);\n      view.setUint8(offset++, codePoint >>> 0  & 0x3f | 0x80);\n      continue;\n    }\n\n    // Four bytes of UTF-8\n    if (codePoint < 0x110000) {\n      view.setUint8(offset++, codePoint >>> 18 & 0x07 | 0xf0);\n      view.setUint8(offset++, codePoint >>> 12 & 0x3f | 0x80);\n      view.setUint8(offset++, codePoint >>> 6  & 0x3f | 0x80);\n      view.setUint8(offset++, codePoint >>> 0  & 0x3f | 0x80);\n      continue;\n    }\n    throw new Error(\"bad codepoint \" + codePoint);\n  }\n}\n\nfunction utf8ByteCount(string) {\n  var count = 0;\n  for(var i = 0, l = string.length; i < l; i++) {\n    var codePoint = string.charCodeAt(i);\n    if (codePoint < 0x80) {\n      count += 1;\n      continue;\n    }\n    if (codePoint < 0x800) {\n      count += 2;\n      continue;\n    }\n    if (codePoint < 0x10000) {\n      count += 3;\n      continue;\n    }\n    if (codePoint < 0x110000) {\n      count += 4;\n      continue;\n    }\n    throw new Error(\"bad codepoint \" + codePoint);\n  }\n  return count;\n}\n\n/**\n * encode data value (recursively) into binary encoded MessagePack v5 (http://msgpack.org/)\n * @param  {Object|Array|String|Number|Boolean|null} value  [description]\n * @param  {DataView} view   [description]\n * @param  {Integer} offset [description]\n * @return {Integer} number of bytes written into view\n */\nfunction encode$1(value, view, offset) {\n  var type = typeof value;\n\n  // Strings Bytes\n  if (type === \"string\") {\n    var length = utf8ByteCount(value);\n    // fix str\n    if (length < 0x20) {\n      view.setUint8(offset, length | 0xa0);\n      utf8Write(view, offset + 1, value);\n      return 1 + length;\n    }\n    // str 8\n    if (length < 0x100) {\n      view.setUint8(offset, 0xd9);\n      view.setUint8(offset + 1, length);\n      utf8Write(view, offset + 2, value);\n      return 2 + length;\n    }\n    // str 16\n    if (length < 0x10000) {\n      view.setUint8(offset, 0xda);\n      view.setUint16(offset + 1, length);\n      utf8Write(view, offset + 3, value);\n      return 3 + length;\n    }\n    // str 32\n    if (length < 0x100000000) {\n      view.setUint8(offset, 0xdb);\n      view.setUint32(offset + 1, length);\n      utf8Write(view, offset + 5, value);\n      return 5 + length;\n    }\n  }\n\n  if (value instanceof Uint8Array) {\n    var length = value.byteLength;\n    var bytes = new Uint8Array(view.buffer);\n    // bin 8\n    if (length < 0x100) {\n      view.setUint8(offset, 0xc4);\n      view.setUint8(offset + 1, length);\n      bytes.set(value, offset + 2);\n      return 2 + length;\n    }\n    // bin 16\n    if (length < 0x10000) {\n      view.setUint8(offset, 0xc5);\n      view.setUint16(offset + 1, length);\n      bytes.set(value, offset + 3);\n      return 3 + length;\n    }\n    // bin 32\n    if (length < 0x100000000) {\n      view.setUint8(offset, 0xc6);\n      view.setUint32(offset + 1, length);\n      bytes.set(value, offset + 5);\n      return 5 + length;\n    }\n  }\n\n  if (type === \"number\") {\n    if (!isFinite(value)) {\n        throw new Error(\"Number not finite: \" + value);\n    }\n\n    // Floating point\n    if (Math.floor(value) !== value) {\n      view.setUint8(offset, 0xcb);\n      view.setFloat64(offset + 1, value);\n      return 9;\n    }\n\n    // Integers\n    if (value >=0) {\n      // positive fixnum\n      if (value < 0x80) {\n        view.setUint8(offset, value);\n        return 1;\n      }\n      // uint 8\n      if (value < 0x100) {\n        view.setUint8(offset, 0xcc);\n        view.setUint8(offset + 1, value);\n        return 2;\n      }\n      // uint 16\n      if (value < 0x10000) {\n        view.setUint8(offset, 0xcd);\n        view.setUint16(offset + 1, value);\n        return 3;\n      }\n      // uint 32\n      if (value < 0x100000000) {\n        view.setUint8(offset, 0xce);\n        view.setUint32(offset + 1, value);\n        return 5;\n      }\n      throw new Error(\"Number too big 0x\" + value.toString(16));\n    }\n    // negative fixnum\n    if (value >= -0x20) {\n      view.setInt8(offset, value);\n      return 1;\n    }\n    // int 8\n    if (value >= -0x80) {\n      view.setUint8(offset, 0xd0);\n      view.setInt8(offset + 1, value);\n      return 2;\n    }\n    // int 16\n    if (value >= -0x8000) {\n      view.setUint8(offset, 0xd1);\n      view.setInt16(offset + 1, value);\n      return 3;\n    }\n    // int 32\n    if (value >= -0x80000000) {\n      view.setUint8(offset, 0xd2);\n      view.setInt32(offset + 1, value);\n      return 5;\n    }\n    throw new Error(\"Number too small -0x\" + (-value).toString(16).substr(1));\n  }\n\n  // null\n  if (value === null) {\n    view.setUint8(offset, 0xc0);\n    return 1;\n  }\n\n  // Boolean\n  if (type === \"boolean\") {\n    view.setUint8(offset, value ? 0xc3 : 0xc2);\n    return 1;\n  }\n\n  // Container Types\n  if (type === \"object\") {\n    var length, size = 0;\n    var isArray = Array.isArray(value);\n\n    if (isArray) {\n      length = value.length;\n    }\n    else {\n      var keys = Object.keys(value);\n      length = keys.length;\n    }\n\n    var size;\n    if (length < 0x10) {\n      view.setUint8(offset, length | (isArray ? 0x90 : 0x80));\n      size = 1;\n    }\n    else if (length < 0x10000) {\n      view.setUint8(offset, isArray ? 0xdc : 0xde);\n      view.setUint16(offset + 1, length);\n      size = 3;\n    }\n    else if (length < 0x100000000) {\n      view.setUint8(offset, isArray ? 0xdd : 0xdf);\n      view.setUint32(offset + 1, length);\n      size = 5;\n    }\n\n    if (isArray) {\n      for (var i = 0; i < length; i++) {\n        size += encode$1(value[i], view, offset + size);\n      }\n    }\n    else {\n      for (var i = 0; i < length; i++) {\n        var key = keys[i];\n        size += encode$1(key, view, offset + size);\n        size += encode$1(value[key], view, offset + size);\n      }\n    }\n\n    return size;\n  }\n  throw new Error(\"Unknown type \" + type);\n}\n\nfunction encodedSize(value) {\n  var type = typeof value;\n\n  // Raw Bytes\n  if (type === \"string\") {\n    var length = utf8ByteCount(value);\n    if (length < 0x20) {\n      return 1 + length;\n    }\n    if (length < 0x100) {\n      return 2 + length;\n    }\n    if (length < 0x10000) {\n      return 3 + length;\n    }\n    if (length < 0x100000000) {\n      return 5 + length;\n    }\n  }\n\n  if (value instanceof Uint8Array) {\n    var length = value.byteLength;\n    if (length < 0x100) {\n      return 2 + length;\n    }\n    if (length < 0x10000) {\n      return 3 + length;\n    }\n    if (length < 0x100000000) {\n      return 5 + length;\n    }\n  }\n\n  if (type === \"number\") {\n    // Floating Point\n    // double\n    if (Math.floor(value) !== value) return 9;\n\n    // Integers\n    if (value >=0) {\n      // positive fixnum\n      if (value < 0x80) return 1;\n      // uint 8\n      if (value < 0x100) return 2;\n      // uint 16\n      if (value < 0x10000) return 3;\n      // uint 32\n      if (value < 0x100000000) return 5;\n      throw new Error(\"Number too big 0x\" + value.toString(16));\n    }\n    // negative fixnum\n    if (value >= -0x20) return 1;\n    // int 8\n    if (value >= -0x80) return 2;\n    // int 16\n    if (value >= -0x8000) return 3;\n    // int 32\n    if (value >= -0x80000000) return 5;\n    throw new Error(\"Number too small -0x\" + value.toString(16).substr(1));\n  }\n\n  // Boolean, null\n  if (type === \"boolean\" || value === null) return 1;\n\n  // Container Types\n  if (type === \"object\") {\n    var length, size = 0;\n    if (Array.isArray(value)) {\n      length = value.length;\n      for (var i = 0; i < length; i++) {\n        size += encodedSize(value[i]);\n      }\n    }\n    else {\n      var keys = Object.keys(value);\n      length = keys.length;\n      for (var i = 0; i < length; i++) {\n        var key = keys[i];\n        size += encodedSize(key) + encodedSize(value[key]);\n      }\n    }\n    if (length < 0x10) {\n      return 1 + size;\n    }\n    if (length < 0x10000) {\n      return 3 + size;\n    }\n    if (length < 0x100000000) {\n      return 5 + size;\n    }\n    throw new Error(\"Array or object too long 0x\" + length.toString(16));\n  }\n  throw new Error(\"Unknown type \" + type);\n}\n\nfunction encodeMsgpack(value) {\n  var buffer = new ArrayBuffer(encodedSize(value));\n  var view = new DataView(buffer);\n  encode$1(value, view, 0);\n  return new Uint8Array(buffer);\n}\n\n/**\n * @file mmtf-constants\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n\nvar PassThroughFields = [\n    \"mmtfVersion\", \"mmtfProducer\",\n    \"unitCell\", \"spaceGroup\", \"structureId\", \"title\",\n    \"depositionDate\", \"releaseDate\",\n    \"experimentalMethods\", \"resolution\", \"rFree\", \"rWork\",\n    \"bioAssemblyList\", \"ncsOperatorList\", \"entityList\", \"groupList\",\n    \"numBonds\", \"numAtoms\", \"numGroups\", \"numChains\", \"numModels\",\n    \"groupsPerChain\", \"chainsPerModel\",\n];\n\nvar EncodedFields = [\n\t// required\n    \"xCoordList\", \"yCoordList\", \"zCoordList\",\n    \"groupIdList\", \"groupTypeList\",\n    \"chainIdList\",\n    // optional\n    \"bFactorList\", \"atomIdList\", \"altLocList\", \"occupancyList\",\n    \"secStructList\", \"insCodeList\", \"sequenceIndexList\",\n    \"chainNameList\",\n    \"bondAtomList\", \"bondOrderList\"\n];\n\nvar AllFields = PassThroughFields.concat( EncodedFields );\n\n/**\n * @file mmtf-utils\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * mmtf utils module.\n * @module MmtfUtils\n */\n\n\nfunction getView( ctor, typedArray, elemSize ){\n    return typedArray ? new ctor(\n        typedArray.buffer,\n        typedArray.byteOffset,\n        typedArray.byteLength / ( elemSize || 1 )\n    ) : undefined;\n}\n\nfunction getDataView( typedArray ){\n    return getView( DataView, typedArray );\n}\n\n/**\n * get an Uint8Array view on the input array memory\n * @static\n * @param  {TypedArray} dataArray - input array\n * @return {Uint8Array} new view on the input array memory\n */\nfunction getUint8View( typedArray ){\n    return getView( Uint8Array, typedArray );\n}\n\n/**\n * get an Int8Array view on the input array memory\n * @static\n * @param  {TypedArray} dataArray - input array\n * @return {Int8Array} new view on the input array memory\n */\nfunction getInt8View( typedArray ){\n    return getView( Int8Array, typedArray );\n}\n\n/**\n * get an Int32Array view on the input array memory\n * @static\n * @param  {TypedArray} dataArray - input array\n * @return {Int32Array} new view on the input array memory\n */\nfunction getInt32View( typedArray ){\n    return getView( Int32Array, typedArray, 4 );\n}\n\nfunction getFloat32View( typedArray ){\n    return getView( Float32Array, typedArray, 4 );\n}\n\n\n/**\n * get an Int16Array copy of the the input array data\n * @static\n * @param  {TypedArray} view - input data in big endian format\n * @param  {Int16Array} [dataArray] - pre-allocated output array\n * @return {Int16Array} copy of the input array data\n */\nfunction decodeInt16( bytes, output ){\n    var n = bytes.length / 2;\n    if( !output ) output = new Int16Array( n );\n    for( var i = 0, i2 = 0; i < n; ++i, i2 += 2 ){\n        output[ i ] = bytes[ i2 ] << 8 ^ bytes[ i2 + 1 ] << 0;\n    }\n    return output;\n}\n\n/**\n * make big endian buffer of an int16 array\n * @static\n * @param  {Array|TypedArray} array - array of int16 values\n * @return {ArrayBuffer} big endian buffer\n */\nfunction encodeInt16( array, output ){\n    var n = array.length;\n    if( !output ) output = new Uint8Array( 2 * n );\n    var dv = getDataView( output );\n    for( var i = 0; i < n; ++i ){\n        dv.setInt16( 2 * i, array[ i ] );\n    }\n    return getUint8View( output );\n}\n\n/**\n * get an Int32Array copy of the the input array data\n * @static\n * @param  {TypedArray} view - input data in big endian format\n * @param  {Int32Array} [dataArray] - pre-allocated output array\n * @return {Int32Array} copy of the input array data\n */\nfunction decodeInt32( bytes, output ){\n    var n = bytes.length / 4;\n    if( !output ) output = new Int32Array( n );\n    for( var i = 0, i4 = 0; i < n; ++i, i4 += 4 ){\n        output[ i ] = (\n            bytes[ i4     ] << 24 ^ bytes[ i4 + 1 ] << 16 ^\n            bytes[ i4 + 2 ] <<  8 ^ bytes[ i4 + 3 ] <<  0\n        );\n    }\n    return output;\n}\n\n/**\n * make big endian buffer of an int32 array\n * @static\n * @param  {Array|TypedArray} array - array of int32 values\n * @return {ArrayBuffer} big endian buffer\n */\nfunction encodeInt32( array, output ){\n    var n = array.length;\n    if( !output ) output = new Uint8Array( 4 * n );\n    var dv = getDataView( output );\n    for( var i = 0; i < n; ++i ){\n        dv.setInt32( 4 * i, array[ i ] );\n    }\n    return getUint8View( output );\n}\n\nfunction decodeFloat32( bytes, output ){\n    var n = bytes.length;\n    if( !output ) output = new Float32Array( n / 4 );\n    var dvOut = getDataView( output );\n    var dvIn = getDataView( bytes );\n    for( var i = 0, i4 = 0, il = n / 4; i < il; ++i, i4 += 4 ){\n        dvOut.setFloat32( i4, dvIn.getFloat32( i4 ), true );\n    }\n    return output;\n}\n\n/**\n * decode integers into floats using given divisor\n * example:\n *     intArray: [ 12, 34, 543, 687, 2, 0, 4689 ]\n *     divisor: 100\n *     return: [ 0.12, 0.34, 5.43, 6.87, 0.02, 0.00, 46.89 ]\n * @static\n * @param  {TypedArray|Array} intArray - input array containing integers\n * @param  {Number} divisor - number to devide the integers to obtain floats\n * @param  {Float32Array} [dataArray] - pre-allocated output array\n * @return {Float32Array} decoded array\n */\nfunction decodeInteger( intArray, divisor, output ){\n    var n = intArray.length;\n    var invDiv = 1/divisor;\n    if( !output ) output = new Float32Array( n );\n    for( var i = 0; i < n; ++i ){\n        // multiply by inverse of the divisor which is faster then division\n        output[ i ] = intArray[ i ] * invDiv;\n    }\n    return output;\n}\n\nfunction encodeInteger( floatArray, factor, output ){\n    var n = floatArray.length;\n    if( !output ) output = new Int32Array( n );\n    for( var i = 0; i < n; ++i ){\n        output[ i ] = Math.round( floatArray[ i ] * factor );\n    }\n    return output;\n}\n\n\n\n/**\n * perform run-length decoding of input array\n * example:\n *     array: [ 0, 2, 3, 5 ]  // pairs of values and length of a run\n *     return: [ 0, 0, 3, 3, 3, 3, 3 ]\n * @static\n * @param  {TypedArray|Array} array - run-length encoded input array\n * @param  {TypedArray|Array} [dataArray] - pre-allocated output array\n * @return {TypedArray|Array} decoded array\n */\nfunction decodeRun( array, output ){\n    var i, il;\n    if( !output ){\n        // calculate the length the decoded array will have\n        var fullLength = 0;\n        for( i = 0, il = array.length; i < il; i+=2 ){\n            fullLength += array[ i + 1 ];\n        }\n        // create a new array of the same type of the input array\n        output = new array.constructor( fullLength );\n    }\n    var dataOffset = 0;\n    for( i = 0, il = array.length; i < il; i+=2 ){\n        var value = array[ i ];  // value to be repeated\n        var length = array[ i + 1 ];  // number of repeats\n        for( var j = 0; j < length; ++j ){\n            output[ dataOffset ] = value;\n            ++dataOffset;\n        }\n    }\n    return output;\n}\n\nfunction encodeRun( array ){\n    if( array.length === 0 ) return new Int32Array();\n    var i, il;\n    // calculate output size\n    var fullLength = 2;\n    for( i = 1, il = array.length; i < il; ++i ){\n        if( array[ i - 1 ] !== array[ i ] ){\n            fullLength += 2;\n        }\n    }\n    var output = new Int32Array( fullLength );\n    var offset = 0;\n    var runLength = 1;\n    for( i = 1, il = array.length; i < il; ++i ){\n        if( array[ i - 1 ] !== array[ i ] ){\n            output[ offset ] = array[ i - 1 ];\n            output[ offset + 1 ] = runLength;\n            runLength = 1;\n            offset += 2;\n        }else{\n            ++runLength;\n        }\n    }\n    output[ offset ] = array[ array.length - 1 ];\n    output[ offset + 1 ] = runLength;\n    return output;\n}\n\n\n\n/**\n * perform delta decoding of the input array\n * by iterativly adding the ith element's value to the i+1th\n * example:\n *     dataArray: [ 0, 2, 1, 2, 1, 1, -4, -2, 9 ]\n *     return: [ 0, 2, 3, 5, 6, 7, 3, 1, 10 ]\n * @static\n * @param  {TypedArray|Array} dataArray - delta encoded input array\n * @return {TypedArray|Array} decoded array\n */\nfunction decodeDelta( array, output ){\n    var n = array.length;\n    if( !output ) output = new array.constructor( n );\n    if( n ) output[ 0 ] = array[ 0 ];\n    for( var i = 1; i < n; ++i ){\n        output[ i ] = array[ i ] + output[ i - 1 ];\n    }\n    return output;\n}\n\nfunction encodeDelta( array, output ){\n    var n = array.length;\n    if( !output ) output = new array.constructor( n );\n    output[ 0 ] = array[ 0 ];\n    for( var i = 1; i < n; ++i ){\n        output[ i ] = array[ i ] - array[ i - 1 ];\n    }\n    return output;\n}\n\n\n\n/**\n * [decodePacking description]\n * @param  {Int16Array|Int8Array} int16or8 [description]\n * @param  {Int32Array} output   [description]\n * @return {Int32Array}          [description]\n */\nfunction decodePacking( int16or8, output ){\n    var upperLimit = int16or8 instanceof Int8Array ? 0x7F : 0x7FFF;\n    var lowerLimit = -upperLimit - 1;\n    var n = int16or8.length;\n    var i, j;\n    if( !output ){\n        var fullLength = 0;\n        for( i = 0; i < n; ++i ){\n            if( int16or8[ i ] < upperLimit && int16or8[ i ] > lowerLimit ){\n                ++fullLength;\n            }\n        }\n        output = new Int32Array( fullLength );\n    }\n    i = 0;\n    j = 0;\n    while( i < n ){\n        var value = 0;\n        while( int16or8[ i ] === upperLimit || int16or8[ i ] === lowerLimit ){\n            value += int16or8[ i ];\n            ++i;\n        }\n        value += int16or8[ i ];\n        ++i;\n        output[ j ] = value;\n        ++j;\n    }\n    return output;\n}\n\n/**\n * integer packing using recursive indexing\n * @param  {Array|TyepedArray} intArray [description]\n * @param  {Boolean} useInt8  [description]\n * @return {Int16Array|Int8Array}          [description]\n */\nfunction encodePacking( intArray, useInt8 ){\n    var upperLimit = useInt8 ? 0x7F : 0x7FFF;\n    var lowerLimit = -upperLimit - 1;\n    var i;\n    var n = intArray.length;\n    var size = 0;\n    for( i = 0; i < n; ++i ){\n        var value = intArray[ i ];\n        if( value === 0 ){\n            ++size;\n        }else if( value === upperLimit || value === lowerLimit ){\n            size += 2;\n        }else if( value > 0) {\n            size += Math.ceil( value / upperLimit );\n        }else {\n            size += Math.ceil( value / lowerLimit );\n        }\n    }\n    var output = useInt8 ? new Int8Array( size ) : new Int16Array( size );\n    var j = 0;\n    for( i = 0; i < n; ++i ){\n        var value = intArray[ i ];\n        if( value >= 0) {\n            while( value >= upperLimit ){\n                output[ j ] = upperLimit;\n                ++j;\n                value -= upperLimit;\n            }\n        }else{\n            while( value <= lowerLimit ){\n                output[ j ] = lowerLimit;\n                ++j;\n                value -= lowerLimit;\n            }\n        }\n        output[ j ] = value;\n        ++j;\n    }\n    return output;\n}\n\n\n\nfunction decodeDeltaRun( array, output ){\n    return decodeDelta( decodeRun( array ), output );\n}\n\nfunction encodeDeltaRun( array ){\n    return encodeRun( encodeDelta( array ) );\n}\n\n\n\n/**\n * perform run-length decoding followed (@see decodeRunLength)\n * by decoding integers into floats using given divisor (@see decodeIntegerToFloat)\n * example:\n *     array: [ 320, 3, 100, 2 ]\n *     divisor: 100\n *     return: [ 3.20, 3.20, 3.20, 1.00, 1.00 ]\n * @static\n * @param  {Uint8Array} array - run-length encoded int32 array as bytes in big endian format\n * @param  {Integer} divisor - number to devide the integers to obtain floats\n * @param  {Float32Array} dataArray - pre-allocated output array\n * @return {Float32Array} decoded array\n */\nfunction decodeIntegerRun( intArray, divisor, output ){\n    return decodeInteger(\n        decodeRun( intArray, getInt32View( output ) ), divisor, output\n    );\n}\n\nfunction encodeIntegerRun( floatArray, factor ){\n    return encodeRun( encodeInteger( floatArray, factor ) );\n}\n\n\n\nfunction decodeIntegerDelta( intArray, divisor, output ){\n    return decodeInteger(\n        decodeDelta( intArray, getInt32View( output ) ), divisor, output\n    );\n}\n\nfunction encodeIntegerDelta( floatArray, factor, output ){\n    return encodeDelta( encodeInteger( floatArray, factor ), output );\n}\n\n\n\nfunction decodeIntegerPacking( int16or8, divisor, output ){\n    return decodeInteger(\n        decodePacking( int16or8, getInt32View( output ) ), divisor, output\n    );\n}\n\nfunction decodeIntegerDeltaPacking( int16or8, divisor, output ){\n    var unpacked = decodePacking( int16or8, getInt32View( output ) );\n    return decodeIntegerDelta( unpacked, divisor, getFloat32View( unpacked ) );\n}\n\nfunction encodeIntegerDeltaPacking( floatArray, factor, useInt8 ){\n    return encodePacking( encodeIntegerDelta( floatArray, factor ), useInt8 );\n}\n\n\n\nfunction decodeBytes( bytes ){\n    var dv = getDataView( bytes );\n    var type = dv.getInt32( 0 );\n    var size = dv.getInt32( 4 );\n    var param = bytes.subarray( 8, 12 );\n    var bytes = bytes.subarray( 12 );\n    return [ type, bytes, size, param ];\n}\n\nfunction encodeBytes( type, size, param, bytes ){\n    var buffer = new ArrayBuffer( 12 + bytes.byteLength );\n    var out = new Uint8Array( buffer );\n    var dv = new DataView( buffer );\n    dv.setInt32( 0, type );\n    dv.setInt32( 4, size );\n    if( param ) out.set( param, 8 );\n    out.set( bytes, 12 );\n    return out;\n}\n\nfunction passInt8( int8 ){\n    var size = int8.length;\n    var bytes = getUint8View( int8 );\n    return encodeBytes( 2, size, undefined, bytes );\n}\n\nfunction passInt32( int32 ){\n    var size = int32.length;\n    var bytes = encodeInt32( int32 );\n    return encodeBytes( 4, size, undefined, bytes );\n}\n\nfunction passString( stringBytes, length ){\n    var size = stringBytes.length / length;\n    var param = encodeInt32([ length ]);\n    var bytes = getUint8View( stringBytes );\n    return encodeBytes( 5, size, param, bytes );\n}\n\nfunction runChar( charBytes ){\n    var size = charBytes.length;\n    var bytes = encodeInt32( encodeRun( charBytes ) );\n    return encodeBytes( 6, size, undefined, bytes );\n}\n\nfunction deltaRun( int32 ){\n    var size = int32.length;\n    var bytes = encodeInt32( encodeDeltaRun( int32 ) );\n    return encodeBytes( 8, size, undefined, bytes );\n}\n\nfunction integerRun( float32, factor ){\n    var size = float32.length;\n    var param = encodeInt32([ factor ]);\n    var bytes = encodeInt32( encodeIntegerRun( float32, factor ) );\n    return encodeBytes( 9, size, param, bytes );\n}\n\nfunction integerDeltaPacking16( float32, factor ){\n    var size = float32.length;\n    var param = encodeInt32([ factor ]);\n    var bytes = encodeInt16( encodeIntegerDeltaPacking( float32, factor ) );\n    return encodeBytes( 10, size, param, bytes );\n}\n\nfunction encodeMmtf( inputDict ){\n\n    var outputDict = {};\n\n    // copy some fields over from the input dict\n    PassThroughFields.forEach( function( name ){\n        if( inputDict[ name ] !== undefined ){\n            outputDict[ name ] = inputDict[ name ];\n        }\n    } );\n\n    //////////////\n    // bond data\n\n    // encode inter group bond atom indices, i.e. get bytes in big endian order\n    if( inputDict.bondAtomList ){\n        outputDict.bondAtomList = passInt32( inputDict.bondAtomList );\n    }\n\n    // encode inter group bond orders, i.e. get bytes\n    if( inputDict.bondOrderList ){\n        outputDict.bondOrderList = passInt8( inputDict.bondOrderList );\n    }\n\n    //////////////\n    // atom data\n\n    // split-list delta & integer encode x, y, z atom coords\n    outputDict.xCoordList = integerDeltaPacking16( inputDict.xCoordList, 1000 );\n    outputDict.yCoordList = integerDeltaPacking16( inputDict.yCoordList, 1000 );\n    outputDict.zCoordList = integerDeltaPacking16( inputDict.zCoordList, 1000 );\n\n    // split-list delta & integer encode b-factors\n    if( inputDict.bFactorList ){\n        outputDict.bFactorList = integerDeltaPacking16( inputDict.bFactorList, 100 );\n    }\n\n    // delta & run-length encode atom ids\n    if( inputDict.atomIdList ){\n        outputDict.atomIdList = deltaRun( inputDict.atomIdList );\n    }\n\n    // run-length encode alternate labels\n    if( inputDict.altLocList ){\n        outputDict.altLocList = runChar( inputDict.altLocList );\n    }\n\n    // run-length & integer encode occupancies\n    if( inputDict.occupancyList ){\n        outputDict.occupancyList = integerRun( inputDict.occupancyList, 100 );\n    }\n\n    ///////////////\n    // group data\n\n    // run-length & delta encode group numbers\n    outputDict.groupIdList = deltaRun( inputDict.groupIdList );\n\n    // encode group types, i.e. get int32 array\n    outputDict.groupTypeList = passInt32( inputDict.groupTypeList );\n\n    // encode secondary structure, i.e. get bytes\n    if( inputDict.secStructList ){\n        outputDict.secStructList = passInt8( inputDict.secStructList, 1 );\n    }\n\n    // run-length encode insertion codes\n    if( inputDict.insCodeList ){\n        outputDict.insCodeList = runChar( inputDict.insCodeList );\n    }\n\n    // run-length & delta encode sequence indices\n    if( inputDict.sequenceIndexList ){\n        outputDict.sequenceIndexList = deltaRun( inputDict.sequenceIndexList );\n    }\n\n    ///////////////\n    // chain data\n\n    // encode chain ids, i.e. get bytes\n    outputDict.chainIdList = passString( inputDict.chainIdList, 4 );\n\n    // encode chain names, i.e. get bytes\n    if( inputDict.chainNameList ){\n        outputDict.chainNameList = passString( inputDict.chainNameList, 4 );\n    }\n\n    return outputDict;\n\n}\n\n/**\n * @file msgpack-decode\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * msgpack decode module.\n * @module MsgpackDecode\n */\n\n/**\n * decode binary encoded MessagePack v5 (http://msgpack.org/) data\n * @static\n * @param  {Uint8Array} buffer - binary encoded MessagePack data\n * @return {Object|Array|String|Number|Boolean|null} decoded Messagepack data\n */\nfunction decodeMsgpack(buffer) {\n  // Loosely based on\n  // The MIT License (MIT)\n  // Copyright (c) 2013 Tim Caswell <tim@creationix.com>\n  // https://github.com/creationix/msgpack-js\n  var offset = 0;\n  var dataView = new DataView(buffer.buffer);\n\n  /**\n   * decode all key-value pairs of a map into an object\n   * @param  {Integer} length - number of key-value pairs\n   * @return {Object} decoded map\n   */\n  function map(length) {\n    var value = {};\n    for (var i = 0; i < length; i++) {\n      var key = parse();\n      value[key] = parse();\n    }\n    return value;\n  }\n\n  /**\n   * decode binary array\n   * @param  {Integer} length - number of elements in the array\n   * @return {Uint8Array} decoded array\n   */\n  function bin(length) {\n    var value = buffer.subarray(offset, offset + length);\n    offset += length;\n    return value;\n  }\n\n  /**\n   * decode string\n   * @param  {Integer} length - number string characters\n   * @return {String} decoded string\n   */\n  function str(length) {\n    var array = buffer.subarray(offset, offset + length);\n    offset += length;\n    // limit number of arguments to String.fromCharCode to something\n    // browsers can handle, see http://stackoverflow.com/a/22747272\n    var chunkSize = 0xffff;\n    if(length > chunkSize){\n      var c = [];\n      for(var i = 0; i < array.length; i += chunkSize) {\n        c.push(String.fromCharCode.apply(\n          null, array.subarray(i, i + chunkSize)\n        ));\n      }\n      return c.join(\"\");\n    }else{\n      return String.fromCharCode.apply(null, array);\n    }\n  }\n\n  /**\n   * decode array\n   * @param  {Integer} length - number of array elements\n   * @return {Array} decoded array\n   */\n  function array(length) {\n    var value = new Array(length);\n    for (var i = 0; i < length; i++) {\n      value[i] = parse();\n    }\n    return value;\n  }\n\n  /**\n   * recursively parse the MessagePack data\n   * @return {Object|Array|String|Number|Boolean|null} decoded MessagePack data\n   */\n  function parse() {\n    var type = buffer[offset];\n    var value, length, extType;\n    // Positive FixInt\n    if ((type & 0x80) === 0x00) {\n      offset++;\n      return type;\n    }\n    // FixMap\n    if ((type & 0xf0) === 0x80) {\n      length = type & 0x0f;\n      offset++;\n      return map(length);\n    }\n    // FixArray\n    if ((type & 0xf0) === 0x90) {\n      length = type & 0x0f;\n      offset++;\n      return array(length);\n    }\n    // FixStr\n    if ((type & 0xe0) === 0xa0) {\n      length = type & 0x1f;\n      offset++;\n      return str(length);\n    }\n    // Negative FixInt\n    if ((type & 0xe0) === 0xe0) {\n      value = dataView.getInt8(offset);\n      offset++;\n      return value;\n    }\n    switch (type) {\n    // nil\n    case 0xc0:\n      offset++;\n      return null;\n    // 0xc1: (never used, could be employed for padding)\n    // false\n    case 0xc2:\n      offset++;\n      return false;\n    // true\n    case 0xc3:\n      offset++;\n      return true;\n    // bin 8\n    case 0xc4:\n      length = dataView.getUint8(offset + 1);\n      offset += 2;\n      return bin(length);\n    // bin 16\n    case 0xc5:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return bin(length);\n    // bin 32\n    case 0xc6:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return bin(length);\n    // // ext 8\n    // case 0xc7:\n    //   length = dataView.getUint8(offset + 1);\n    //   extType = dataView.getUint8(offset + 2);\n    //   offset += 3;\n    //   return [extType, bin(length)];\n    // // ext 16\n    // case 0xc8:\n    //   length = dataView.getUint16(offset + 1);\n    //   extType = dataView.getUint8(offset + 3);\n    //   offset += 4;\n    //   return [extType, bin(length)];\n    // // ext 32\n    // case 0xc9:\n    //   length = dataView.getUint32(offset + 1);\n    //   extType = dataView.getUint8(offset + 5);\n    //   offset += 6;\n    //   return [extType, bin(length)];\n    // float 32\n    case 0xca:\n      value = dataView.getFloat32(offset + 1);\n      offset += 5;\n      return value;\n    // float 64\n    case 0xcb:\n      value = dataView.getFloat64(offset + 1);\n      offset += 9;\n      return value;\n    // uint8\n    case 0xcc:\n      value = buffer[offset + 1];\n      offset += 2;\n      return value;\n    // uint 16\n    case 0xcd:\n      value = dataView.getUint16(offset + 1);\n      offset += 3;\n      return value;\n    // uint 32\n    case 0xce:\n      value = dataView.getUint32(offset + 1);\n      offset += 5;\n      return value;\n    // // uint64\n    // case 0xcf:\n    //   // FIXME not available/representable in JS\n    //   // largest possible int in JS is 2^53\n    //   // value = dataView.getUint64(offset + 1);\n    //   offset += 9;\n    //   return 0;\n    // int 8\n    case 0xd0:\n      value = dataView.getInt8(offset + 1);\n      offset += 2;\n      return value;\n    // int 16\n    case 0xd1:\n      value = dataView.getInt16(offset + 1);\n      offset += 3;\n      return value;\n    // int 32\n    case 0xd2:\n      value = dataView.getInt32(offset + 1);\n      offset += 5;\n      return value;\n    // // int 64\n    // case 0xd3:\n    //   // FIXME not available/representable in JS\n    //   // largest possible int in JS is 2^53\n    //   // value = dataView.getInt64(offset + 1);\n    //   offset += 9;\n    //   return 0;\n\n    // // fixext 1\n    // case 0xd4:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(1)];\n    // // fixext 2\n    // case 0xd5:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(2)];\n    // // fixext 4\n    // case 0xd6:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(4)];\n    // // fixext 8\n    // case 0xd7:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(8)];\n    // // fixext 16\n    // case 0xd8:\n    //   extType = dataView.getUint8(offset + 1);\n    //   offset += 2;\n    //   return [extType, bin(16)];\n    // str 8\n    case 0xd9:\n      length = dataView.getUint8(offset + 1);\n      offset += 2;\n      return str(length);\n    // str 16\n    case 0xda:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return str(length);\n    // str 32\n    case 0xdb:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return str(length);\n    // array 16\n    case 0xdc:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return array(length);\n    // array 32\n    case 0xdd:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return array(length);\n    // map 16:\n    case 0xde:\n      length = dataView.getUint16(offset + 1);\n      offset += 3;\n      return map(length);\n    // map 32\n    case 0xdf:\n      length = dataView.getUint32(offset + 1);\n      offset += 5;\n      return map(length);\n    }\n\n    throw new Error(\"Unknown type 0x\" + type.toString(16));\n  }\n\n  // start the recursive parsing\n  return parse();\n}\n\n/**\n * Fields shared in encoded and decoded mmtf data objects.\n * @typedef {Object} module:MmtfDecode.SharedMmtfData\n * @property {String} mmtfVersion - MMTF specification version\n * @property {String} mmtfProducer - Program that created the file\n * @property {Float[]} [unitCell] - Crystallographic unit cell\n * @property {Float} unitCell.0 - x length\n * @property {Float} unitCell.1 - y length\n * @property {Float} unitCell.2 - z length\n * @property {Float} unitCell.3 - alpha angle\n * @property {Float} unitCell.4 - beta angle\n * @property {Float} unitCell.5 - gamma angle\n * @property {String} [spaceGroup] - Hermann-Mauguin symbol\n * @property {String} [structureId] - Some reference, e.g. a PDB ID\n * @property {String} [title] - Short description\n * @property {String} [depositionDate] - Deposition date in YYYY-MM-DD format\n * @property {String} [releaseDate] - Release date in YYYY-MM-DD format\n * @property {String[]} [experimentalMethods] - Structure determination methods\n * @property {Float} [resolution] - Resolution in Å\n * @property {Float} [rFree] - R-free value\n * @property {Float} [rWork] - R-work value\n * @property {Integer} numBonds - Number of bonds\n * @property {Integer} numAtoms - Number of atoms\n * @property {Integer} numGroups - Number of groups (residues)\n * @property {Integer} numChains - Number of chains\n * @property {Integer} numModels - Number of models\n * @property {Integer[]} chainsPerModel - List of number of chains in each model\n * @property {Integer[]} groupsPerChain - List of number of groups in each chain\n * @property {Entity[]} [entityList] - List of entity objects\n * @property {Integer[]} entityList.chainIndexList - Pointers into chain data fields\n * @property {String} entityList.description - Description of the entity\n * @property {String} entityList.type - Name of the entity type\n * @property {String} entityList.sequence - One letter code sequence\n * @property {Assembly[]} [bioAssemblyList] - List of assembly objects\n * @property {Transform[]} bioAssemblyList.transformList - List of transform objects\n * @property {Integer[]} bioAssemblyList.transformList.chainIndexList - Pointers into chain data fields\n * @property {Float[]} bioAssemblyList.transformList.matrix - 4x4 transformation matrix\n * @property {Array[]} [ncsOperatorList] - List of ncs operator matrices\n * @property {Float[]} ncsOperatorList. - 4x4 transformation matrix\n * @property {GroupType[]} groupList - List of groupType objects\n * @property {Integer[]} groupList.formalChargeList - List of atom formal charges\n * @property {String[]} groupList.elementList - List of elements\n * @property {String[]} groupList.atomNameList - List of atom names\n * @property {Integer[]} groupList.bondAtomList - List of bonded atom indices\n * @property {Integer[]} groupList.bondOrderList - List of bond orders\n * @property {String} groupList.groupName - The name of the group\n * @property {String} groupList.singleLetterCode - The single letter code\n * @property {String} groupList.chemCompType -  The chemical component type\n */\n\n/**\n * Encoded mmtf data object. Also includes the fields from {@link module:MmtfDecode.SharedMmtfData}. See MMTF specification on how they are encoded.\n * @typedef {Object} module:MmtfDecode.EncodedMmtfData\n * @mixes module:MmtfDecode.SharedMmtfData\n * @property {Uint8Array} [bondAtomList] - Encoded bonded atom indices\n * @property {Uint8Array} [bondOrderList] - Encoded bond orders\n * @property {Uint8Array} xCoordBig - Encoded x coordinates in Å, part 1\n * @property {Uint8Array} xCoordSmall - Encoded x coordinates in Å, part 2\n * @property {Uint8Array} yCoordBig - Encoded y coordinates in Å, part 1\n * @property {Uint8Array} yCoordSmall - Encoded y coordinates in Å, part 2\n * @property {Uint8Array} yCoordBig - Encoded y coordinates in Å, part 1\n * @property {Uint8Array} yCoordSmall - Encoded y coordinates in Å, part 2\n * @property {Uint8Array} [bFactorBig] - Encoded B-factors in Å^2, part 1\n * @property {Uint8Array} [bFactorSmall] - Encoded B-factors in Å^2, part 2\n * @property {Uint8Array} [atomIdList] - Encoded  atom ids\n * @property {Uint8Array} [altLocList] - Encoded alternate location labels\n * @property {Uint8Array} [occupancyList] - Encoded occupancies\n * @property {Uint8Array} groupIdList - Encoded group ids\n * @property {Uint8Array} groupTypeList - Encoded group types\n * @property {Uint8Array} [secStructList] - Encoded secondary structure codes\n * @property {Uint8Array} [insCodeList] - Encoded insertion codes\n * @property {Uint8Array} [seuenceIdList] - Encoded sequence ids\n * @property {Uint8Array} chainIdList - Encoded chain ids\n * @property {Uint8Array} [chainNameList] - Encoded chain names\n */\n\n/**\n * Decoded mmtf data object. Also includes fields the from {@link module:MmtfDecode.SharedMmtfData}.\n * @typedef {Object} module:MmtfDecode.MmtfData\n * @mixes module:MmtfDecode.SharedMmtfData\n * @property {Int32Array} [bondAtomList] - List of bonded atom indices\n * @property {Uint8Array} [bondOrderList] - List of bond orders\n * @property {Float32Array} xCoordList - List of x coordinates in Å\n * @property {Float32Array} yCoordList - List of y coordinates in Å\n * @property {Float32Array} zCoordList - List of z coordinates in Å\n * @property {Float32Array} [bFactorList] - List of B-factors in Å^2\n * @property {Int32Array} [atomIdList] - List of atom ids\n * @property {Uint8Array} [altLocList] - List of alternate location labels\n * @property {Float32Array} [occupancyList] - List of occupancies\n * @property {Int32Array} groupIdList - List of group ids\n * @property {Int32Array} groupTypeList - List of group types\n * @property {Int8Array} [secStructList] - List of secondary structure codes, encoding\n *    0: pi helix, 1: bend, 2: alpha helix, 3: extended,\n *    4: 3-10 helix, 5: bridge, 6: turn, 7: coil, -1: undefined\n * @property {Uint8Array} [insCodeList] - List of insertion codes\n * @property {Int32Array} [seuenceIdList] - List of sequence ids\n * @property {Uint8Array} chainIdList - List of chain ids\n * @property {Uint8Array} [chainNameList] - List of chain names\n */\n\n\n/**\n * [performDecoding description]\n * @param  {Integer} bytes [description]\n * @param  {Integer} size  [description]\n * @param  {Uint8Array} param [description]\n * @return {TypedArray}       [description]\n */\nfunction performDecoding( type, bytes, size, param ){\n\n    switch( type ){\n        case 1:\n            return decodeFloat32( bytes );\n        case 2:\n            return getInt8View( bytes );\n        case 3:\n            return decodeInt16( bytes );\n        case 4:\n            return decodeInt32( bytes );\n        case 5:\n            // var length = decodeInt32( param )[ 0 ];\n            return getUint8View( bytes );  // interpret as string array\n        case 6:\n            // interpret as char array\n            return decodeRun( decodeInt32( bytes ), new Uint8Array( size ) );\n        case 7:\n            return decodeRun( decodeInt32( bytes ) )\n        case 8:\n            return decodeDeltaRun( decodeInt32( bytes ) );\n        case 9:\n            return decodeIntegerRun( decodeInt32( bytes ), decodeInt32( param )[ 0 ] );\n        case 10:\n            return decodeIntegerDeltaPacking( decodeInt16( bytes ), decodeInt32( param )[ 0 ] );\n        case 11:\n            return decodeInteger( decodeInt16( bytes ), decodeInt32( param )[ 0 ] );\n        case 12:\n            return decodeIntegerPacking( decodeInt16( bytes ), decodeInt32( param )[ 0 ] );\n        case 13:\n            return decodeIntegerPacking( getInt8View( bytes ), decodeInt32( param )[ 0 ] );\n        case 14:\n            return decodePacking( decodeInt16( bytes ) );\n        case 15:\n            return decodePacking( getInt8View( bytes ) );\n    }\n\n};\n\n\n/**\n * Decode MMTF fields\n * @static\n * @param  {Object} inputDict - encoded MMTF data\n * @param  {Object} [params] - decoding parameters\n * @param  {String[]} params.ignoreFields - names of optional fields not to decode\n * @return {module:MmtfDecode.MmtfData} mmtfData\n */\nfunction decodeMmtf( inputDict, params ){\n\n    params = params || {};\n    var ignoreFields = params.ignoreFields;\n    var outputDict = {};\n\n    AllFields.forEach( function( name ){\n        var ignore = ignoreFields ? ignoreFields.indexOf( name ) !== -1 : false;\n        var data = inputDict[ name ];\n        if( !ignore && data !== undefined ){\n            if( data instanceof Uint8Array ){\n                outputDict[ name ] = performDecoding.apply( null, decodeBytes( data ) );\n            }else{\n                outputDict[ name ] = data;\n            }\n        }\n    } );\n\n    return outputDict;\n\n}\n\n/**\n * @file mmtf-traverse\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\n/**\n * mmtf traverse module.\n * @module MmtfTraverse\n */\n\n/**\n * Converts an array of ASCII codes trimming '\\0' bytes\n * @private\n * @param  {Array} charCodeArray - array of ASCII char codes\n * @return {String} '\\0' trimmed string\n */\nfunction fromCharCode( charCodeArray ){\n    return String.fromCharCode.apply( null, charCodeArray ).replace(/\\0/g, '');\n}\n\n\n/**\n * @callback module:MmtfTraverse.onModel\n * @param {Object} modelData\n * @param {Integer} modelData.chainCount - number of chains in the model\n * @param {Integer} modelData.modelIndex - index of the model\n */\n\n/**\n * @callback module:MmtfTraverse.onChain\n * @param {Object} chainData\n * @param {Integer} chainData.groupCount - number of groups in the chain\n * @param {Integer} chainData.chainIndex - index of the chain\n * @param {Integer} chainData.modelIndex - index of the parent model\n * @param {String} chainData.chainId - chain id\n * @param {?String} chainData.chainName - additional chain name\n */\n\n/**\n * @callback module:MmtfTraverse.onGroup\n * @param {Object} groupData\n * @param {Integer} groupData.atomCount - number of atoms in the group\n * @param {Integer} groupData.groupIndex - index of the group\n * @param {Integer} groupData.chainIndex - index of the parent chain\n * @param {Integer} groupData.modelIndex - index of the parent model\n * @param {Integer} groupData.groupId - group id (residue number)\n * @param {Integer} groupData.groupType - index to an entry in {@link module:MmtfDecode.MmtfData}#groupList\n * @param {String} groupData.groupName - name of the group, 0 to 5 characters\n * @param {Char} groupData.singleLetterCode - IUPAC single letter code, otherwise 'X', 1 character\n * @param {String} groupData.chemCompType - chemical component type from the mmCIF dictionary\n * @param {?Integer} groupData.secStruct - sencoded secondary structure |\n *    0: pi helix, 1: bend, 2: alpha helix, 3: extended,\n *    4: 3-10 helix, 5: bridge, 6: turn, 7: coil, -1: undefined\n * @param {?Char} groupData.insCode - insertion code\n * @param {?Integer} groupData.sequenceIndex - index to the `sequence` property of\n *    the corresponding entity, -1 when the entity has no sequence\n */\n\n/**\n * @callback module:MmtfTraverse.onAtom\n * @param {Object} atomData\n * @param {Integer} atomData.atomIndex - index of the atom\n * @param {Integer} atomData.groupIndex - index of the parent group\n * @param {Integer} atomData.chainIndex - index of the parent chain\n * @param {Integer} atomData.modelIndex - index of the parent model\n * @param {?Integer} atomData.atomId - atom id\n * @param {String} atomData.element - IUPAC element name, 0 to 3 characters\n * @param {String} atomData.atomName - name of the atom, 0 to 5 characters\n * @param {Integer} atomData.formalCharge - formal charge of the atom\n * @param {Float} atomData.xCoord - x coordinate in Å\n * @param {Float} atomData.yCoord - y coordinate in Å\n * @param {Float} atomData.zCoord - z coordinate in Å\n * @param {?Float} atomData.bFactor - B-factor in in Å^2\n * @param {?Char} atomData.altLoc - alternate location identifier\n * @param {?Float} atomData.occupancy - occupancy of the atom\n */\n\n/**\n * @callback module:MmtfTraverse.onBond\n * @param {Object} bondData\n * @param {Integer} bondData.atomIndex1 - index of the first atom\n * @param {Integer} bondData.atomIndex2 - index of the secound atom\n * @param {Integer} bondData.bondOrder - bond order, allowed values are 1 to 3\n */\n\n\n/**\n * Traverse the MMTF structure data.\n * @static\n * @param {module:MmtfDecode.MmtfData} mmtfData - decoded mmtf data\n * @param {Object} eventCallbacks\n * @param {module:MmtfTraverse.onModel} [eventCallbacks.onModel] - called for each model\n * @param {module:MmtfTraverse.onChain} [eventCallbacks.onChain] - called for each chain\n * @param {module:MmtfTraverse.onGroup} [eventCallbacks.onGroup] - called for each group\n * @param {module:MmtfTraverse.onAtom} [eventCallbacks.onAtom] - called for each atom\n * @param {module:MmtfTraverse.onBond} [eventCallbacks.onBond] - called for each bond\n * @param {Object} [params] - traversal parameters\n * @param {Boolean} [params.firstModelOnly] - traverse only the first model\n */\nfunction traverseMmtf( mmtfData, eventCallbacks, params ){\n\n    params = params || {};\n\n    var firstModelOnly = params.firstModelOnly;\n\n    // setup callbacks\n    var onModel = eventCallbacks.onModel;\n    var onChain = eventCallbacks.onChain;\n    var onGroup = eventCallbacks.onGroup;\n    var onAtom = eventCallbacks.onAtom;\n    var onBond = eventCallbacks.onBond;\n\n    // setup index counters\n    var modelIndex = 0;\n    var chainIndex = 0;\n    var groupIndex = 0;\n    var atomIndex = 0;\n\n    var modelFirstAtomIndex = 0;\n    var modelLastAtomIndex = -1;\n\n    // setup optional fields\n    var chainNameList = mmtfData.chainNameList;\n    var secStructList = mmtfData.secStructList;\n    var insCodeList = mmtfData.insCodeList;\n    var sequenceIndexList = mmtfData.sequenceIndexList;\n    var atomIdList = mmtfData.atomIdList;\n    var bFactorList = mmtfData.bFactorList;\n    var altLocList = mmtfData.altLocList;\n    var occupancyList = mmtfData.occupancyList;\n    var bondAtomList = mmtfData.bondAtomList;\n    var bondOrderList = mmtfData.bondOrderList;\n\n    // hoisted loop variables\n    var o, ol, i, j, k, kl;\n\n    // loop over all models\n    for( o = 0, ol = mmtfData.chainsPerModel.length; o < ol; ++o ){\n\n        if( firstModelOnly && modelIndex > 0 ) break;\n\n        var modelChainCount = mmtfData.chainsPerModel[ modelIndex ];\n\n        if( onModel ){\n            onModel({\n                chainCount: modelChainCount,\n                modelIndex: modelIndex\n            });\n        }\n\n        for( i = 0; i < modelChainCount; ++i ){\n\n            var chainGroupCount = mmtfData.groupsPerChain[ chainIndex ];\n            if( onChain ){\n                var chainId = fromCharCode(\n                    mmtfData.chainIdList.subarray( chainIndex * 4, chainIndex * 4 + 4 )\n                );\n                var chainName = null;\n                if( chainNameList ){\n                    chainName = fromCharCode(\n                        chainNameList.subarray( chainIndex * 4, chainIndex * 4 + 4 )\n                    );\n                }\n                onChain({\n                    groupCount: chainGroupCount,\n                    chainIndex: chainIndex,\n                    modelIndex: modelIndex,\n                    chainId: chainId,\n                    chainName: chainName\n                });\n            }\n\n            for( j = 0; j < chainGroupCount; ++j ){\n\n                var groupData = mmtfData.groupList[ mmtfData.groupTypeList[ groupIndex ] ];\n                var groupAtomCount = groupData.atomNameList.length;\n                if( onGroup ){\n                    var secStruct = null;\n                    if( secStructList ){\n                        secStruct = secStructList[ groupIndex ];\n                    }\n                    var insCode = null;\n                    if( mmtfData.insCodeList ){\n                        insCode = String.fromCharCode( insCodeList[ groupIndex ] );\n                    }\n                    var sequenceIndex = null;\n                    if( sequenceIndexList ){\n                        sequenceIndex = sequenceIndexList[ groupIndex ];\n                    }\n                    onGroup({\n                        atomCount: groupAtomCount,\n                        groupIndex: groupIndex,\n                        chainIndex: chainIndex,\n                        modelIndex: modelIndex,\n                        groupId: mmtfData.groupIdList[ groupIndex ],\n                        groupType: mmtfData.groupTypeList[ groupIndex ],\n                        groupName: groupData.groupName,\n                        singleLetterCode: groupData.singleLetterCode,\n                        chemCompType: groupData.chemCompType,\n                        secStruct: secStruct,\n                        insCode: insCode,\n                        sequenceIndex: sequenceIndex\n                    });\n                }\n\n                for( k = 0; k < groupAtomCount; ++k ){\n\n                    if( onAtom ){\n                        var atomId = null;\n                        if( atomIdList ){\n                            atomId = atomIdList[ atomIndex ];\n                        }\n                        var bFactor = null;\n                        if( bFactorList ){\n                            bFactor = bFactorList[ atomIndex ];\n                        }\n                        var altLoc = null;\n                        if( altLocList ){\n                            altLoc = String.fromCharCode( altLocList[ atomIndex ] );\n                        }\n                        var occupancy = null;\n                        if( occupancyList ){\n                            occupancy = occupancyList[ atomIndex ];\n                        }\n                        onAtom({\n                            atomIndex: atomIndex,\n                            groupIndex: groupIndex,\n                            chainIndex: chainIndex,\n                            modelIndex: modelIndex,\n                            atomId: atomId,\n                            element: groupData.elementList[ k ],\n                            atomName: groupData.atomNameList[ k ],\n                            formalCharge: groupData.formalChargeList[ k ],\n                            xCoord: mmtfData.xCoordList[ atomIndex ],\n                            yCoord: mmtfData.yCoordList[ atomIndex ],\n                            zCoord: mmtfData.zCoordList[ atomIndex ],\n                            bFactor: bFactor,\n                            altLoc: altLoc,\n                            occupancy: occupancy\n                        });\n                    }\n\n                    atomIndex += 1;\n                }\n\n                if( onBond ){\n                    // intra group bonds\n                    var groupBondAtomList = groupData.bondAtomList;\n                    for( k = 0, kl = groupData.bondOrderList.length; k < kl; ++k ){\n                        onBond({\n                            atomIndex1: atomIndex - groupAtomCount + groupBondAtomList[ k * 2 ],\n                            atomIndex2: atomIndex - groupAtomCount + groupBondAtomList[ k * 2 + 1 ],\n                            bondOrder: groupData.bondOrderList[ k ]\n                        });\n                    }\n                }\n\n                groupIndex += 1;\n            }\n\n            chainIndex += 1;\n        }\n\n        modelFirstAtomIndex = modelLastAtomIndex + 1;\n        modelLastAtomIndex = atomIndex - 1;  // subtract one as it already has been incremented\n\n        if( onBond ){\n            // inter group bonds\n            if( bondAtomList ){\n                for( k = 0, kl = bondAtomList.length; k < kl; k += 2 ){\n                    var atomIndex1 = bondAtomList[ k ];\n                    var atomIndex2 = bondAtomList[ k + 1 ];\n                    if( ( atomIndex1 >= modelFirstAtomIndex && atomIndex1 <= modelLastAtomIndex ) ||\n                        ( atomIndex2 >= modelFirstAtomIndex && atomIndex2 <= modelLastAtomIndex )\n                    ){\n                        onBond({\n                            atomIndex1: atomIndex1,\n                            atomIndex2: atomIndex2,\n                            bondOrder: bondOrderList ? bondOrderList[ k / 2 ] : null\n                        });\n                    }\n                }\n            }\n        }\n\n        modelIndex += 1;\n    }\n\n}\n\n/**\n * Version name\n * @static\n * @type {String}\n */\nvar version = \"v1.1.0dev\";\n\n/**\n * Version name\n * @private\n * @type {String}\n */\nvar baseUrl = \"//mmtf.rcsb.org/v1.0/\";\n\n/**\n * URL of the RCSB webservice to obtain MMTF files\n * @static\n * @type {String}\n */\nvar fetchUrl = baseUrl + \"full/\";\n\n/**\n * URL of the RCSB webservice to obtain reduced MMTF files\n * @static\n * @type {String}\n */\nvar fetchReducedUrl = baseUrl + \"reduced/\";\n\n/**\n * Encode MMTF fields\n * @static\n * @param  {module:MmtfDecode.MmtfData} mmtfData - mmtf data\n * @return {Uint8Array} encoded MMTF fields\n */\nfunction encode( mmtfData ){\n    return encodeMsgpack( encodeMmtf( mmtfData ) );\n}\n\n/**\n * Decode MMTF fields\n * @static\n * @example\n * // bin is Uint8Array containing the mmtf msgpack\n * var mmtfData = MMTF.decode( bin );\n * console.log( mmtfData.numAtoms );\n *\n * @param  {Uint8Array|ArrayBuffer|module:MmtfDecode.EncodedMmtfData} binOrDict - binary MessagePack or encoded MMTF data\n * @param  {Object} [params] - decoding parameters\n * @param {String[]} params.ignoreFields - names of optional fields not to decode\n * @return {module:MmtfDecode.MmtfData} mmtfData\n */\nfunction decode( binOrDict, params ){\n\t// make sure binOrDict is not a plain Arraybuffer\n    if( binOrDict instanceof ArrayBuffer ){\n        binOrDict = new Uint8Array( binOrDict );\n    }\n\n    var inputDict;\n    if( binOrDict instanceof Uint8Array ){\n        // get dict from msgpack\n        inputDict = decodeMsgpack( binOrDict );\n    }else{\n        // already a dict\n        inputDict = binOrDict;\n    }\n\n    return decodeMmtf( inputDict, params );\n}\n\n/**\n * @callback module:MMTF.onLoad\n * @param {module:MmtfDecode.MmtfData} mmtfData - decoded mmtf data object\n */\n\n/**\n * helper method to fetch binary files from an URL\n * @private\n * @param  {String} pdbid - PDB ID to fetch\n * @param  {String} baseUrl - URL to fetch from\n * @param  {module:MMTF.onLoad} onLoad - callback( mmtfData )\n * @param  {Function} onError - callback( error )\n * @return {undefined}\n */\nfunction _fetch( pdbid, baseUrl, onLoad, onError ){\n    var xhr = new XMLHttpRequest();\n    function _onLoad(){\n        try{\n            var mmtfData = decode( xhr.response );\n            onLoad( mmtfData );\n        }catch( error ){\n            onError( error );\n        }\n    }\n    xhr.addEventListener( \"load\", _onLoad, true );\n    xhr.addEventListener( \"error\", onError, true );\n    xhr.responseType = \"arraybuffer\";\n    xhr.open( \"GET\", baseUrl + pdbid.toUpperCase() );\n    xhr.send();\n}\n\n/**\n * Fetch MMTF file from RCSB webservice which contains\n * @static\n * @example\n * MMTF.fetch(\n *     \"3PQR\",\n *     // onLoad callback\n *     function( mmtfData ){ console.log( mmtfData ) },\n *     // onError callback\n *     function( error ){ console.error( error ) }\n * );\n *\n * @param  {String} pdbid - PDB ID to fetch\n * @param  {module:MMTF.onLoad} onLoad - callback( mmtfData )\n * @param  {Function} onError - callback( error )\n * @return {undefined}\n */\nfunction fetch( pdbid, onLoad, onError ){\n    _fetch( pdbid, fetchUrl, onLoad, onError );\n}\n\n/**\n * Fetch reduced MMTF file from RCSB webservice which contains\n * protein C-alpha, nucleotide phosphate and ligand atoms\n * @static\n * @example\n * MMTF.fetchReduced(\n *     \"3PQR\",\n *     // onLoad callback\n *     function( mmtfData ){ console.log( mmtfData ) },\n *     // onError callback\n *     function( error ){ console.error( error ) }\n * );\n *\n * @param  {String} pdbid - PDB ID to fetch\n * @param  {module:MMTF.onLoad} onLoad - callback( mmtfData )\n * @param  {Function} onError - callback( error )\n * @return {undefined}\n */\nfunction fetchReduced( pdbid, onLoad, onError ){\n    _fetch( pdbid, fetchReducedUrl, onLoad, onError );\n}\n\nexport { encode, decode, traverseMmtf as traverse, fetch, fetchReduced, version, fetchUrl, fetchReducedUrl, encodeMsgpack, encodeMmtf, decodeMsgpack, decodeMmtf };","/**\n * @file Mmtf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  buildUnitcellAssembly, calculateBondsBetween, calculateBondsWithin\n} from '../structure/structure-utils'\nimport { ChemCompHetero } from '../structure/structure-constants'\nimport Entity from '../structure/entity'\nimport Unitcell from '../symmetry/unitcell'\nimport Assembly, { AssemblyPart } from '../symmetry/assembly'\n\nimport { decodeMsgpack, decodeMmtf } from '../../lib/mmtf.es6'\n\nconst SstrucMap: {[k: string]: number} = {\n  '0': 'i'.charCodeAt(0), // pi helix\n  '1': 's'.charCodeAt(0), // bend\n  '2': 'h'.charCodeAt(0), // alpha helix\n  '3': 'e'.charCodeAt(0), // extended\n  '4': 'g'.charCodeAt(0), // 3-10 helix\n  '5': 'b'.charCodeAt(0), // bridge\n  '6': 't'.charCodeAt(0), // turn\n  '7': 'l'.charCodeAt(0), // coil\n  '-1': ''.charCodeAt(0) // NA\n}\n\nclass MmtfParser extends StructureParser {\n  get type () { return 'mmtf' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/rcsb/mmtf\n\n    if (Debug) Log.time('MmtfParser._parse ' + this.name)\n\n    let i, il, j, jl, groupData\n\n    const s = this.structure\n    const sd: {[k: string]: any} = decodeMmtf(decodeMsgpack(this.streamer.data))\n\n    // structure header\n    const headerFields = [\n      'depositionDate', 'releaseDate', 'resolution',\n      'rFree', 'rWork', 'experimentalMethods'\n    ]\n    headerFields.forEach(function (name) {\n      if (sd[ name ] !== undefined) {\n        s.header[ name ] = sd[ name ]\n      }\n    })\n\n    let numBonds, numAtoms, numGroups, numChains, numModels\n    let chainsPerModel\n\n    s.id = sd.structureId\n    s.title = sd.title\n\n    s.atomStore.addField('formalCharge', 1, 'int8')\n\n    if (this.firstModelOnly || this.asTrajectory) {\n      numModels = 1\n      numChains = sd.chainsPerModel[ 0 ]\n\n      numGroups = 0\n      for (i = 0, il = numChains; i < il; ++i) {\n        numGroups += sd.groupsPerChain[ i ]\n      }\n\n      numAtoms = 0\n      for (i = 0, il = numGroups; i < il; ++i) {\n        groupData = sd.groupList[ sd.groupTypeList[ i ] ]\n        numAtoms += groupData.atomNameList.length\n      }\n\n      numBonds = sd.numBonds\n\n      chainsPerModel = [ numChains ]\n    } else {\n      numBonds = sd.numBonds\n      numAtoms = sd.numAtoms\n      numGroups = sd.numGroups\n      numChains = sd.numChains\n      numModels = sd.numModels\n\n      chainsPerModel = sd.chainsPerModel\n    }\n\n    numBonds += numGroups // add numGroups to have space for polymer bonds\n\n    //\n\n    if (this.asTrajectory) {\n      for (i = 0, il = sd.numModels; i < il; ++i) {\n        const frame = new Float32Array(numAtoms * 3)\n        const frameAtomOffset = numAtoms * i\n\n        for (j = 0; j < numAtoms; ++j) {\n          const j3 = j * 3\n          const offset = j + frameAtomOffset\n          frame[ j3 ] = sd.xCoordList[ offset ]\n          frame[ j3 + 1 ] = sd.yCoordList[ offset ]\n          frame[ j3 + 2 ] = sd.zCoordList[ offset ]\n        }\n\n        s.frames.push(frame)\n      }\n    }\n\n    // bondStore\n    const bAtomIndex1 = new Uint32Array(numBonds)\n    const bAtomIndex2 = new Uint32Array(numBonds)\n    const bBondOrder = new Uint8Array(numBonds)\n\n    const aGroupIndex = new Uint32Array(numAtoms)\n    const aFormalCharge = new Int8Array(numAtoms)\n\n    const gChainIndex = new Uint32Array(numGroups)\n    const gAtomOffset = new Uint32Array(numGroups)\n    const gAtomCount = new Uint16Array(numGroups)\n\n    const cModelIndex = new Uint16Array(numChains)\n    const cGroupOffset = new Uint32Array(numChains)\n    const cGroupCount = new Uint32Array(numChains)\n\n    const mChainOffset = new Uint32Array(numModels)\n    const mChainCount = new Uint32Array(numModels)\n\n    // set-up model-chain relations\n    let chainOffset = 0\n    for (i = 0, il = numModels; i < il; ++i) {\n      const modelChainCount = chainsPerModel[ i ]\n      mChainOffset[ i ] = chainOffset\n      mChainCount[ i ] = modelChainCount\n      for (j = 0; j < modelChainCount; ++j) {\n        cModelIndex[ j + chainOffset ] = i\n      }\n      chainOffset += modelChainCount\n    }\n\n    // set-up chain-residue relations\n    const groupsPerChain = sd.groupsPerChain\n    let groupOffset = 0\n    for (i = 0, il = numChains; i < il; ++i) {\n      const chainGroupCount = groupsPerChain[ i ]\n      cGroupOffset[ i ] = groupOffset\n      cGroupCount[ i ] = chainGroupCount\n      for (j = 0; j < chainGroupCount; ++j) {\n        gChainIndex[ j + groupOffset ] = i\n      }\n      groupOffset += chainGroupCount\n    }\n\n    /// ///\n    // get data from group map\n\n    let atomOffset = 0\n    let bondOffset = 0\n\n    for (i = 0, il = numGroups; i < il; ++i) {\n      groupData = sd.groupList[ sd.groupTypeList[ i ] ]\n      const groupAtomCount = groupData.atomNameList.length\n      const groupFormalChargeList = groupData.formalChargeList\n\n      const groupBondAtomList = groupData.bondAtomList\n      const groupBondOrderList = groupData.bondOrderList\n\n      for (j = 0, jl = groupBondOrderList.length; j < jl; ++j) {\n        bAtomIndex1[ bondOffset ] = atomOffset + groupBondAtomList[ j * 2 ]\n        bAtomIndex2[ bondOffset ] = atomOffset + groupBondAtomList[ j * 2 + 1 ]\n        bBondOrder[ bondOffset ] = groupBondOrderList[ j ]\n        bondOffset += 1\n      }\n\n      //\n\n      gAtomOffset[ i ] = atomOffset\n      gAtomCount[ i ] = groupAtomCount\n\n      for (j = 0; j < groupAtomCount; ++j) {\n        aGroupIndex[ atomOffset ] = i\n        aFormalCharge[ atomOffset ] = groupFormalChargeList[ j ]\n        atomOffset += 1\n      }\n    }\n\n    // extra bonds\n\n    const bondAtomList = sd.bondAtomList\n    if (bondAtomList) {\n      if (sd.bondOrderList) {\n        bBondOrder.set(sd.bondOrderList, bondOffset)\n      }\n\n      for (i = 0, il = bondAtomList.length; i < il; i += 2) {\n        const atomIndex1 = bondAtomList[ i ]\n        const atomIndex2 = bondAtomList[ i + 1 ]\n        if (atomIndex1 < numAtoms && atomIndex2 < numAtoms) {\n          bAtomIndex1[ bondOffset ] = atomIndex1\n          bAtomIndex2[ bondOffset ] = atomIndex2\n          bondOffset += 1\n        }\n      }\n    }\n\n    //\n\n    s.bondStore.length = bBondOrder.length\n    s.bondStore.count = bondOffset\n    s.bondStore.atomIndex1 = bAtomIndex1\n    s.bondStore.atomIndex2 = bAtomIndex2\n    s.bondStore.bondOrder = bBondOrder\n\n    s.atomStore.length = numAtoms\n    s.atomStore.count = numAtoms\n    s.atomStore.residueIndex = aGroupIndex\n    s.atomStore.atomTypeId = new Uint16Array(numAtoms)\n    s.atomStore.x = sd.xCoordList.subarray(0, numAtoms)\n    s.atomStore.y = sd.yCoordList.subarray(0, numAtoms)\n    s.atomStore.z = sd.zCoordList.subarray(0, numAtoms)\n    s.atomStore.serial = sd.atomIdList.subarray(0, numAtoms)\n    s.atomStore.bfactor = sd.bFactorList.subarray(0, numAtoms)\n    s.atomStore.altloc = sd.altLocList.subarray(0, numAtoms)\n    s.atomStore.occupancy = sd.occupancyList.subarray(0, numAtoms)\n    s.atomStore.formalCharge = aFormalCharge\n\n    s.residueStore.length = numGroups\n    s.residueStore.count = numGroups\n    s.residueStore.chainIndex = gChainIndex\n    s.residueStore.residueTypeId = sd.groupTypeList\n    s.residueStore.atomOffset = gAtomOffset\n    s.residueStore.atomCount = gAtomCount\n    s.residueStore.resno = sd.groupIdList.subarray(0, numGroups)\n    s.residueStore.sstruc = sd.secStructList.subarray(0, numGroups)\n    s.residueStore.inscode = sd.insCodeList.subarray(0, numGroups)\n\n    s.chainStore.length = numChains\n    s.chainStore.count = numChains\n    s.chainStore.entityIndex = new Uint16Array(numChains)\n    s.chainStore.modelIndex = cModelIndex\n    s.chainStore.residueOffset = cGroupOffset\n    s.chainStore.residueCount = cGroupCount\n    s.chainStore.chainname = sd.chainNameList.subarray(0, numChains * 4)\n    s.chainStore.chainid = sd.chainIdList.subarray(0, numChains * 4)\n\n    s.modelStore.length = numModels\n    s.modelStore.count = numModels\n    s.modelStore.chainOffset = mChainOffset\n    s.modelStore.chainCount = mChainCount\n\n    //\n\n    let groupTypeDict: {[k: number]: any} = {}\n    for (i = 0, il = sd.groupList.length; i < il; ++i) {\n      const groupType = sd.groupList[ i ]\n      const atomTypeIdList: number[] = []\n      for (j = 0, jl = groupType.atomNameList.length; j < jl; ++j) {\n        const element = groupType.elementList[ j ].toUpperCase()\n        const atomname = groupType.atomNameList[ j ]\n        atomTypeIdList.push(s.atomMap.add(atomname, element))\n      }\n      const chemCompType = groupType.chemCompType.toUpperCase()\n      const hetFlag = ChemCompHetero.includes(chemCompType)\n\n      const numGroupBonds = groupType.bondOrderList.length\n      const atomIndices1 = new Array(numGroupBonds)\n      const atomIndices2 = new Array(numGroupBonds)\n      for (j = 0; j < numGroupBonds; ++j) {\n        atomIndices1[ j ] = groupType.bondAtomList[ j * 2 ]\n        atomIndices2[ j ] = groupType.bondAtomList[ j * 2 + 1 ]\n      }\n      const bonds = {\n        atomIndices1: atomIndices1,\n        atomIndices2: atomIndices2,\n        bondOrders: groupType.bondOrderList\n      }\n\n      groupTypeDict[ i ] = s.residueMap.add(\n        groupType.groupName, atomTypeIdList, hetFlag, chemCompType, bonds\n      )\n    }\n\n    for (i = 0, il = numGroups; i < il; ++i) {\n      s.residueStore.residueTypeId[ i ] = groupTypeDict[ s.residueStore.residueTypeId[ i ] ]\n    }\n\n    for (i = 0, il = s.atomStore.count; i < il; ++i) {\n      const residueIndex = s.atomStore.residueIndex[ i ]\n      const residueType = s.residueMap.list[ s.residueStore.residueTypeId[ residueIndex ] ]\n      const resAtomOffset = s.residueStore.atomOffset[ residueIndex ]\n      s.atomStore.atomTypeId[ i ] = residueType.atomTypeIdList[ i - resAtomOffset ]\n    }\n\n    if (sd.secStructList) {\n      const secStructLength: number = sd.secStructList.length\n      for (i = 0, il = s.residueStore.count; i < il; ++i) {\n        // with ( i % secStructLength ) secStruct entries are reused\n        const sstruc = SstrucMap[ s.residueStore.sstruc[ i % secStructLength ] ]\n        if (sstruc !== undefined) s.residueStore.sstruc[ i ] = sstruc\n      }\n    }\n\n    //\n\n    if (sd.entityList) {\n      sd.entityList.forEach(function (e: Entity, i: number) {\n        s.entityList[ i ] = new Entity(\n          s, i, e.description, e.type, e.chainIndexList\n        )\n      })\n    }\n\n    if (sd.bioAssemblyList) {\n      sd.bioAssemblyList.forEach(function (_assembly: any, k: number) {\n        const id = k + 1\n        const assembly = new Assembly('' + id)\n        s.biomolDict[ 'BU' + id ] = assembly\n        let chainToPart: {[k: string]: AssemblyPart} = {}\n        _assembly.transformList.forEach(function (_transform: any) {\n          const matrix = new Matrix4().fromArray(_transform.matrix).transpose()\n          const chainList: string[] = _transform.chainIndexList.map(function (chainIndex: number) {\n            let chainname = ''\n            for (let k = 0; k < 4; ++k) {\n              const code = sd.chainNameList[ chainIndex * 4 + k ]\n              if (code) {\n                chainname += String.fromCharCode(code)\n              } else {\n                break\n              }\n            }\n            return chainname\n          })\n          const part = chainToPart[ chainList.toString() ]\n          if (part) {\n            part.matrixList.push(matrix)\n          } else {\n            chainToPart[ chainList.toString() ] = assembly.addPart([ matrix ], chainList)\n          }\n        })\n      })\n    }\n\n    if (sd.ncsOperatorList) {\n      const ncsName = 'NCS'\n      const ncsAssembly = new Assembly(ncsName)\n      const ncsPart = ncsAssembly.addPart()\n      sd.ncsOperatorList.forEach(function (_operator: number[]) {\n        const matrix = new Matrix4().fromArray(_operator).transpose()\n        ncsPart.matrixList.push(matrix)\n      })\n      if (ncsPart.matrixList.length > 0) {\n        s.biomolDict[ ncsName ] = ncsAssembly\n      }\n    }\n\n    const uc = sd.unitCell\n    if (uc && Array.isArray(uc) && uc[ 0 ]) {\n      s.unitcell = new Unitcell({\n        a: uc[ 0 ],\n        b: uc[ 1 ],\n        c: uc[ 2 ],\n        alpha: uc[ 3 ],\n        beta: uc[ 4 ],\n        gamma: uc[ 5 ],\n        spacegroup: sd.spaceGroup\n      })\n    } else {\n      s.unitcell = undefined\n    }\n\n    // calculate backbone bonds\n    calculateBondsBetween(s, true)\n\n    // calculate rung bonds\n    calculateBondsWithin(s, true)\n\n    s.finalizeAtoms()\n    s.finalizeBonds()\n\n    buildUnitcellAssembly(s)\n\n    if (Debug) Log.timeEnd('MmtfParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('mmtf', MmtfParser)\n\nexport default MmtfParser\n","/**\n * @file Mol2 Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport {\n  assignResidueTypeBonds,\n  calculateChainnames, calculateSecondaryStructure,\n  calculateBondsBetween, calculateBondsWithin\n} from '../structure/structure-utils'\nimport StructureParser from './structure-parser'\n\nconst reWhitespace = /\\s+/\nconst bondTypes: {[k: string]: number} = {\n  '1': 1,\n  '2': 2,\n  '3': 3,\n  'am': 1, // amide\n  'ar': 1, // aromatic\n  'du': 1, // dummy\n  'un': 1, // unknown\n  'nc': 0 // not connected\n}\n\nclass Mol2Parser extends StructureParser {\n  get type () { return 'mol2' }\n\n  _parse () {\n    // http://paulbourke.net/dataformats/mol2/\n\n    if (Debug) Log.time('Mol2Parser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n\n    const frames = s.frames\n    let doFrames = false\n    let currentFrame: Float32Array, currentCoord: number\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.resize(Math.round(this.streamer.data.length / 60))\n    atomStore.addField('partialCharge', 1, 'float32')\n\n    let idx = 0\n    let moleculeLineNo = 0\n    let modelAtomIdxStart = 0\n    let modelIdx = -1\n    let numAtoms = 0\n\n    let currentRecordType = 0\n    let moleculeRecordType = 1\n    let atomRecordType = 2\n    let bondRecordType = 3\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ].trim()\n\n        if (line === '' || line[ 0 ] === '#') continue\n\n        if (line[ 0 ] === '@') {\n          if (line === '@<TRIPOS>MOLECULE') {\n            currentRecordType = moleculeRecordType\n            moleculeLineNo = 0\n\n            ++modelIdx\n          } else if (line === '@<TRIPOS>ATOM') {\n            currentRecordType = atomRecordType\n            modelAtomIdxStart = atomStore.count\n\n            if (asTrajectory) {\n              currentCoord = 0\n              currentFrame = new Float32Array(numAtoms * 3)\n              frames.push(currentFrame)\n\n              if (modelIdx > 0) doFrames = true\n            }\n          } else if (line === '@<TRIPOS>BOND') {\n            currentRecordType = bondRecordType\n          } else {\n            currentRecordType = 0\n          }\n        } else if (currentRecordType === moleculeRecordType) {\n          if (moleculeLineNo === 0) {\n            s.title = line\n            s.id = line\n          } else if (moleculeLineNo === 1) {\n            const ls = line.split(reWhitespace)\n            numAtoms = parseInt(ls[ 0 ])\n            // num_atoms [num_bonds [num_subst [num_feat [num_sets]]]]\n          } else if (moleculeLineNo === 2) {\n\n            // const molType = line;\n            // SMALL, BIOPOLYMER, PROTEIN, NUCLEIC_ACID, SACCHARIDE\n\n          } else if (moleculeLineNo === 3) {\n\n            // const chargeType = line;\n            // NO_CHARGES, DEL_RE, GASTEIGER, GAST_HUCK, HUCKEL,\n            // PULLMAN, GAUSS80_CHARGES, AMPAC_CHARGES,\n            // MULLIKEN_CHARGES, DICT_ CHARGES, MMFF94_CHARGES,\n            // USER_CHARGES\n\n          } else if (moleculeLineNo === 4) {\n\n            // const statusBits = line;\n\n          } else if (moleculeLineNo === 5) {\n\n            // const molComment = line;\n\n          }\n\n          ++moleculeLineNo\n        } else if (currentRecordType === atomRecordType) {\n          const ls = line.split(reWhitespace)\n\n          if (firstModelOnly && modelIdx > 0) continue\n\n          const x = parseFloat(ls[ 2 ])\n          const y = parseFloat(ls[ 3 ])\n          const z = parseFloat(ls[ 4 ])\n\n          if (asTrajectory) {\n            const j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (doFrames) continue\n          }\n\n          const serial = ls[ 0 ]\n          const atomname = ls[ 1 ]\n          const element = ls[ 5 ].split('.')[ 0 ]\n          const resno = ls[ 6 ] ? parseInt(ls[ 6 ]) : 1\n          const resname = ls[ 7 ] ? ls[ 7 ] : ''\n          const partialCharge = ls[ 8 ] ? parseFloat(ls[ 8 ]) : 0.0\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = serial\n          atomStore.partialCharge[ idx ] = partialCharge\n\n          sb.addAtom(modelIdx, '', '', resname, resno, 1)\n\n          idx += 1\n        } else if (currentRecordType === bondRecordType) {\n          if (firstModelOnly && modelIdx > 0) continue\n          if (asTrajectory && modelIdx > 0) continue\n\n          const ls = line.split(reWhitespace)\n\n          // ls[ 0 ] is bond id\n          ap1.index = parseInt(ls[ 1 ]) - 1 + modelAtomIdxStart\n          ap2.index = parseInt(ls[ 2 ]) - 1 + modelAtomIdxStart\n          const order = bondTypes[ ls[ 3 ] ]\n\n          s.bondStore.addBond(ap1, ap2, order)\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    sb.finalize()\n    s.finalizeAtoms()\n    calculateChainnames(s)\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true)\n    s.finalizeBonds()\n    assignResidueTypeBonds(s)\n    calculateSecondaryStructure(s)\n\n    if (Debug) Log.timeEnd('Mol2Parser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('mol2', Mol2Parser)\n\nexport default Mol2Parser\n","/**\n * @file Pdbqt Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport PdbParser from './pdb-parser'\n\n// autodock variant of PDB format with\n// - atom partial charges (empty column in pdb format)\n// - atom types (bfactor column in pdb format)\n// http://autodock.scripps.edu/faqs-help/faq/what-is-the-format-of-a-pdbqt-file\n\nclass PdbqtParser extends PdbParser {\n  get type () { return 'pdbqt' }\n}\n\nParserRegistry.add('pdbqt', PdbqtParser)\n\nexport default PdbqtParser\n","/**\n * @file Pqr Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport PdbParser from './pdb-parser'\n\n// http://www.poissonboltzmann.org/docs/file-format-info/\n\nclass PqrParser extends PdbParser {\n  get type () { return 'pqr' }\n}\n\nParserRegistry.add('pqr', PqrParser)\n\nexport default PqrParser\n","/**\n * @file Sdf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { assignResidueTypeBonds } from '../structure/structure-utils'\nimport StructureParser from './structure-parser'\n\nconst reItem = /> +<(.+)>/\n\nclass SdfParser extends StructureParser {\n  get type () { return 'sdf' }\n\n  _parse () {\n    // https://en.wikipedia.org/wiki/Chemical_table_file#SDF\n    // http://download.accelrys.com/freeware/ctfile-formats/ctfile-formats.zip\n\n    if (Debug) Log.time('SdfParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    const firstModelOnly = this.firstModelOnly\n    const asTrajectory = this.asTrajectory\n\n    const headerLines = this.streamer.peekLines(2)\n\n    s.id = headerLines[ 0 ].trim()\n    s.title = headerLines[ 1 ].trim()\n\n    const frames = s.frames\n    let doFrames = false\n    let currentFrame: Float32Array, currentCoord: number\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.resize(Math.round(this.streamer.data.length / 50))\n    atomStore.addField('formalCharge', 1, 'int8')\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n\n    let idx = 0\n    let lineNo = 0\n    let modelIdx = 0\n    let modelAtomIdxStart = 0\n\n    const sdfData: {[k: string]: string[]}[] = []\n    let currentItem: string|boolean = false\n    let currentData: {[k: string]: string[]} = {}\n    let mItem\n    s.extraData.sdf = sdfData\n\n    let atomCount, bondCount, atomStart: number, atomEnd: number, bondStart: number, bondEnd: number\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n\n        if (line.substr(0, 4) === '$$$$') {\n          lineNo = -1\n          ++modelIdx\n          modelAtomIdxStart = atomStore.count\n          sdfData.push(currentData)\n          currentData = {}\n          currentItem = false\n        } else if (lineNo === 3) {\n          atomCount = parseInt(line.substr(0, 3))\n          bondCount = parseInt(line.substr(3, 3))\n\n          atomStart = 4\n          atomEnd = atomStart + atomCount\n          bondStart = atomEnd\n          bondEnd = bondStart + bondCount\n\n          if (asTrajectory) {\n            currentCoord = 0\n            currentFrame = new Float32Array(atomCount * 3)\n            frames.push(currentFrame)\n\n            if (modelIdx > 0) doFrames = true\n          }\n        } else if (lineNo >= atomStart && lineNo < atomEnd) {\n          if (firstModelOnly && modelIdx > 0) continue\n\n          const x = parseFloat(line.substr(0, 10))\n          const y = parseFloat(line.substr(10, 10))\n          const z = parseFloat(line.substr(20, 10))\n\n          if (asTrajectory) {\n            const j = currentCoord * 3\n\n            currentFrame[ j + 0 ] = x\n            currentFrame[ j + 1 ] = y\n            currentFrame[ j + 2 ] = z\n\n            currentCoord += 1\n\n            if (doFrames) continue\n          }\n\n          const element = line.substr(31, 3).trim()\n          const atomname = element + (idx + 1)\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname, element)\n\n          atomStore.x[ idx ] = x\n          atomStore.y[ idx ] = y\n          atomStore.z[ idx ] = z\n          atomStore.serial[ idx ] = idx\n          atomStore.formalCharge[ idx ] = 0\n\n          sb.addAtom(modelIdx, '', '', 'HET', 1, 1)\n\n          idx += 1\n        } else if (lineNo >= bondStart && lineNo < bondEnd) {\n          if (firstModelOnly && modelIdx > 0) continue\n          if (asTrajectory && modelIdx > 0) continue\n\n          ap1.index = parseInt(line.substr(0, 3)) - 1 + modelAtomIdxStart\n          ap2.index = parseInt(line.substr(3, 3)) - 1 + modelAtomIdxStart\n          const order = parseInt(line.substr(6, 3))\n\n          s.bondStore.addBond(ap1, ap2, order)\n        } else if (line.match(/M {2}CHG/)) {\n          const chargeCount = parseInt(line.substr(6, 3))\n          for (let ci = 0, coffset = 10; ci < chargeCount; ++ci, coffset += 8) {\n            const aToken = parseInt(line.substr(coffset, 3))\n            const atomIdx = aToken - 1 + modelAtomIdxStart\n            const cToken = parseInt(line.substr(coffset + 4, 3))\n            atomStore.formalCharge[ atomIdx ] = cToken\n          }\n        // eslint-disable-next-line no-cond-assign\n        } else if (mItem = line.match(reItem)) {\n          currentItem = mItem[ 1 ]\n          currentData[ currentItem ] = []\n        } else if (currentItem !== false && line) {\n          currentData[ <string>currentItem ].push(line)\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('SdfParser._parse ' + this.name)\n  }\n\n  _postProcess () {\n    assignResidueTypeBonds(this.structure)\n  }\n}\n\nParserRegistry.add('sdf', SdfParser)\nParserRegistry.add('sd', SdfParser)\nParserRegistry.add('mol', SdfParser)\n\nexport default SdfParser\n","/**\n * @file Prmtop Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  assignResidueTypeBonds, calculateBondsBetween,\n  calculateBondsWithin, calculateChainnames\n} from '../structure/structure-utils'\n\nconst amberChargeUnitFactor = 18.2223\n\nconst enum Mode {\n  Title,\n  Pointers,\n  AtomName,\n  Charge,\n  Mass,\n  ResidueLabel,\n  ResiduePointer,\n  BondsIncHydrogen,\n  BondsWithoutHydrogen,\n  Radii\n}\n\nfunction parseIntSubstr (line: string, start: number, length: number) {\n  return parseInt(line.substr(start, length).trim())\n}\n\nclass PrmtopParser extends StructureParser {\n  get type () { return 'prmtop' }\n\n  _parse () {\n    // http://ambermd.org/prmtop.pdf\n    // http://ambermd.org/formats.html#topology\n\n    if (Debug) Log.time('PrmtopParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    //\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.addField('partialCharge', 1, 'float32')\n    atomStore.addField('radius', 1, 'float32')\n\n    const title: string[] = []\n    const pointersDict: {[k: string]: number} = {}\n    const pointers = [\n      'NATOM', 'NTYPES', 'NBONH', 'MBONA', 'NTHETH', 'MTHETA',\n      'NPHIH', 'MPHIA', 'NHPARM', 'NPARM', 'NNB', 'NRES',\n      'NBONA', 'NTHETA', 'NPHIA', 'NUMBND', 'NUMANG', 'NPTRA',\n      'NATYP', 'NPHB', 'IFPERT', 'NBPER', 'NGPER', 'NDPER',\n      'MBPER', 'MGPER', 'MDPER', 'IFBOX', 'NMXRS', 'IFCAP',\n      'NUMEXTRA', 'NCOPY'\n    ]\n    pointers.forEach(name => { pointersDict[ name ] = 0 })\n\n    let atomNames: string[]\n    let charges: Float32Array\n    let radii: Float32Array\n    let bAtomIndex1: Uint32Array\n    let bAtomIndex2: Uint32Array\n    let bBondOrder: Uint8Array = new Uint8Array(0)\n    let residueLabels: string[]\n    let residuePointers: Uint32Array\n\n    let mode: number|undefined\n    // let currentFormat\n    let curIdx: number\n    let bondIdx: number\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n        const lt = line.trim()\n\n        if (!lt) {\n          continue\n        } else if (line.startsWith('%FORMAT')) {\n          // currentFormat = lt.substring(8, lt.length - 1)\n        } else if (line.startsWith('%FLAG')) {\n          const flag = line.substr(5).trim()\n          curIdx = 0\n\n          if (flag === 'TITLE') {\n            mode = Mode.Title\n          } else if (flag === 'POINTERS') {\n            mode = Mode.Pointers\n          } else if (flag === 'ATOM_NAME') {\n            mode = Mode.AtomName\n          } else if (flag === 'CHARGE') {\n            mode = Mode.Charge\n          } else if (flag === 'MASS') {\n            mode = Mode.Mass\n          } else if (flag === 'RESIDUE_LABEL') {\n            mode = Mode.ResidueLabel\n          } else if (flag === 'RESIDUE_POINTER') {\n            mode = Mode.ResiduePointer\n          } else if (flag === 'BONDS_INC_HYDROGEN') {\n            bondIdx = 0\n            mode = Mode.BondsIncHydrogen\n          } else if (flag === 'BONDS_WITHOUT_HYDROGEN') {\n            bondIdx = pointersDict['NBONH']\n            mode = Mode.BondsWithoutHydrogen\n          } else if (flag === 'RADII') {\n            mode = Mode.Radii\n          } else {\n            mode = undefined\n          }\n        } else if (mode === Mode.Title) {\n          title.push(lt)\n        } else if (mode === Mode.Pointers) {\n          const n = Math.min(curIdx + 10, 32)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            pointersDict[pointers[curIdx]] = parseInt(\n              line.substr(i * 8, 8).trim()\n            )\n          }\n          atomNames = new Array(pointersDict.NATOM)\n          charges = new Float32Array(pointersDict.NATOM)\n          radii = new Float32Array(pointersDict.NATOM)\n          atomStore.resize(pointersDict.NATOM)\n          const bondCount = pointersDict.NBONH + pointersDict.MBONA\n          bAtomIndex1 = new Uint32Array(bondCount)\n          bAtomIndex2 = new Uint32Array(bondCount)\n          bBondOrder = new Uint8Array(bondCount)\n          residueLabels = new Array(pointersDict.NRES)\n          residuePointers = new Uint32Array(pointersDict.NRES)\n        } else if (mode === Mode.AtomName) {\n          const n = Math.min(curIdx + 20, pointersDict.NATOM)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            atomNames[curIdx] = line.substr(i * 4, 4).trim()\n          }\n        } else if (mode === Mode.Charge) {\n          const n = Math.min(curIdx + 5, pointersDict.NATOM)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            charges[curIdx] = parseFloat(line.substr(i * 16, 16)) / amberChargeUnitFactor\n          }\n        } else if (mode === Mode.Mass) {\n\n          // not currently used\n\n        } else if (mode === Mode.ResidueLabel) {\n          const n = Math.min(curIdx + 20, pointersDict.NRES)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            residueLabels[curIdx] = line.substr(i * 4, 4).trim()\n          }\n        } else if (mode === Mode.ResiduePointer) {\n          const n = Math.min(curIdx + 10, pointersDict.NRES)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            residuePointers[curIdx] = parseIntSubstr(line, i * 8, 8)\n          }\n        } else if (mode === Mode.BondsIncHydrogen) {\n          const n = Math.min(curIdx + 10, pointersDict.NBONH * 3)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            const r = curIdx % 3\n            if (r === 0) {\n              bAtomIndex1[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n            } if (r === 1) {\n              bAtomIndex2[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n              bBondOrder[bondIdx] = 1\n              ++bondIdx\n            }\n          }\n        } else if (mode === Mode.BondsWithoutHydrogen) {\n          const n = Math.min(curIdx + 10, pointersDict.MBONA * 3)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            const r = curIdx % 3\n            if (r === 0) {\n              bAtomIndex1[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n            } if (r === 1) {\n              bAtomIndex2[bondIdx] = parseIntSubstr(line, i * 8, 8) / 3\n              bBondOrder[bondIdx] = 1\n              ++bondIdx\n            }\n          }\n        } else if (mode === Mode.Radii) {\n          const n = Math.min(curIdx + 5, pointersDict.NATOM)\n          for (let i = 0; curIdx < n; ++i, ++curIdx) {\n            radii[curIdx] = parseFloat(line.substr(i * 16, 16))\n          }\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    s.title = title.join(' ')\n\n    const atomCount = pointersDict.NATOM\n    let curResIdx = 0\n    let curResname = residueLabels![0]\n    let curResno = 1\n    for (let i = 0; i < atomCount; ++i) {\n      if (i + 1 === residuePointers![curResIdx + 1]) {\n        ++curResIdx\n        curResname = residueLabels![curResIdx]\n        curResno = curResIdx + 1\n      }\n      atomStore.atomTypeId[i] = atomMap.add(atomNames![i])\n      atomStore.serial[i] = i + 1\n      sb.addAtom(0, '', '', curResname, curResno)\n    }\n\n    atomStore.partialCharge.set(charges!)\n    atomStore.radius.set(radii!)\n\n    s.bondStore.length = bBondOrder!.length\n    s.bondStore.count = bBondOrder!.length\n    s.bondStore.atomIndex1 = bAtomIndex1!\n    s.bondStore.atomIndex2 = bAtomIndex2!\n    s.bondStore.bondOrder = bBondOrder\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true, true)\n    calculateChainnames(s, true)\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('PrmtopParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('prmtop', PrmtopParser)\nParserRegistry.add('parm7', PrmtopParser)\n\nexport default PrmtopParser\n","/**\n * @file Psf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport {\n  assignResidueTypeBonds, calculateBondsBetween,\n  calculateBondsWithin, getChainname\n} from '../structure/structure-utils'\n\nconst TitleMode = 1\nconst AtomMode = 2\nconst BondMode = 3\nconst AngleMode = 4\nconst DihedralMode = 5\nconst ImproperMode = 6\n\nconst reWhitespace = /\\s+/\nconst reTitle = /(^\\*|REMARK)*/\n\nclass PsfParser extends StructureParser {\n  get type () { return 'psf' }\n\n  _parse () {\n    // http://www.ks.uiuc.edu/Training/Tutorials/namd/namd-tutorial-unix-html/node23.html\n\n    if (Debug) Log.time('PsfParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    //\n\n    const atomMap = s.atomMap\n    const atomStore = s.atomStore\n    atomStore.addField('partialCharge', 1, 'float32')\n\n    const title: string[] = []\n\n    let mode: number|undefined\n    let chainid: string\n    let lastSegid: string\n    let idx = 0\n    let chainIdx = 0\n    let bondIdx = 0\n    let bAtomIndex1: Uint32Array, bAtomIndex2: Uint32Array, bBondOrder: Uint8Array\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ].trim()\n\n        if (!line) {\n          mode = undefined\n          continue\n        }\n\n        if (mode === AtomMode) {\n          const ls = line.split(reWhitespace)\n\n          const serial = parseInt(ls[ 0 ])\n          const segid = ls[ 1 ]\n          const resno = parseInt(ls[ 2 ])\n          const resname = ls[ 3 ]\n          const atomname = ls[ 4 ]\n          const charge = parseFloat(ls[ 6 ])\n\n          if (segid !== lastSegid) {\n            chainid = getChainname(chainIdx)\n            ++chainIdx\n          }\n\n          atomStore.growIfFull()\n          atomStore.atomTypeId[ idx ] = atomMap.add(atomname)\n\n          atomStore.serial[ idx ] = serial\n          atomStore.partialCharge[ idx ] = charge\n\n          sb.addAtom(0, chainid, chainid, resname, resno)\n\n          idx += 1\n          lastSegid = segid\n        } else if (mode === BondMode) {\n          const ls = line.split(reWhitespace)\n\n          for (let j = 0, m = ls.length; j < m; j += 2) {\n            bAtomIndex1[ bondIdx ] = parseInt(ls[ j ]) - 1\n            bAtomIndex2[ bondIdx ] = parseInt(ls[ j + 1 ]) - 1\n            bBondOrder[ bondIdx ] = 1\n            bondIdx += 1\n          }\n        } else if (mode === TitleMode) {\n          title.push(line.replace(reTitle, '').trim())\n        } else if (mode === AngleMode) {\n\n          // currently not used\n\n        } else if (mode === DihedralMode) {\n\n          // currently not used\n\n        } else if (mode === ImproperMode) {\n\n          // currently not used\n\n        } else if (line.includes('!NATOM')) {\n          mode = AtomMode\n\n          const numAtoms = parseInt(line.split(reWhitespace)[ 0 ])\n          atomStore.resize(numAtoms)\n        } else if (line.includes('!NBOND')) {\n          mode = BondMode\n\n          const numBonds = parseInt(line.split(reWhitespace)[ 0 ])\n          bAtomIndex1 = new Uint32Array(numBonds)\n          bAtomIndex2 = new Uint32Array(numBonds)\n          bBondOrder = new Uint8Array(numBonds)\n        } else if (line.includes('!NTITLE')) {\n          mode = TitleMode\n        } else if (line.includes('!NTHETA')) {\n          mode = AngleMode\n        } else if (line.includes('!NPHI')) {\n          mode = DihedralMode\n        } else if (line.includes('!NIMPHI')) {\n          mode = ImproperMode\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    s.title = title.join(' ')\n\n    s.bondStore.length = bBondOrder!.length\n    s.bondStore.count = bondIdx\n    s.bondStore.atomIndex1 = bAtomIndex1!\n    s.bondStore.atomIndex2 = bAtomIndex2!\n    s.bondStore.bondOrder = bBondOrder!\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true, true)\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('PsfParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('psf', PsfParser)\n\nexport default PsfParser\n","/**\n * @file Top Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport StructureParser from './structure-parser'\nimport { WaterNames } from '../structure/structure-constants'\nimport {\n  assignResidueTypeBonds, calculateBondsBetween,\n  calculateBondsWithin, getChainname\n} from '../structure/structure-utils'\n\nconst enum Mode {\n  System,\n  Molecules,\n  Moleculetype,\n  Atoms,\n  Bonds\n}\n\nconst reField = /\\[ (.+) \\]/\nconst reWhitespace = /\\s+/\n\nclass TopParser extends StructureParser {\n  get type () { return 'top' }\n\n  _parse () {\n    // http://manual.gromacs.org/online/top.html\n\n    if (Debug) Log.time('TopParser._parse ' + this.name)\n\n    const s = this.structure\n    const sb = this.structureBuilder\n\n    //\n\n    const atomMap = s.atomMap\n    const bondStore = s.bondStore\n\n    const atomStore = s.atomStore\n    atomStore.addField('partialCharge', 1, 'float32')\n\n    const molecules: [string, number][] = []\n    const moleculetypeDict: {[k: string]: {atoms: any[], bonds: any[] }} = {}\n\n    let currentMoleculetype: {\n      atoms: [number, string, string, number][],\n      bonds: [number, number][]\n    }\n    let mode: number|undefined\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n        let lt = line.trim()\n\n        if (!lt || lt[0] === '*' || lt[0] === ';') {\n          continue\n        }\n\n        if (lt.startsWith('#include')) {\n          throw new Error('TopParser: #include statements not allowed')\n        }\n\n        const fieldMatch = line.match(reField)\n        if (fieldMatch !== null) {\n          const name = fieldMatch[1]\n          if (name === 'moleculetype') {\n            mode = Mode.Moleculetype\n            currentMoleculetype = {\n              atoms: [],\n              bonds: []\n            }\n          } else if (name === 'atoms') {\n            mode = Mode.Atoms\n          } else if (name === 'bonds') {\n            mode = Mode.Bonds\n          } else if (name === 'system') {\n            mode = Mode.System\n          } else if (name === 'molecules') {\n            mode = Mode.Molecules\n          } else {\n            mode = undefined\n          }\n          continue\n        }\n\n        const cIdx = lt.indexOf(';')\n        if (cIdx !== -1) {\n          lt = lt.substring(0, cIdx).trim()\n        }\n        if (mode === Mode.Moleculetype) {\n          const molName = lt.split(reWhitespace)[0]\n          moleculetypeDict[molName] = currentMoleculetype\n        } else if (mode === Mode.Atoms) {\n          const ls = lt.split(reWhitespace)\n          currentMoleculetype.atoms.push([\n            parseInt(ls[2]), // resnr\n            ls[3], // residue\n            ls[4], // atom\n            parseFloat(ls[6]) // charge\n          ])\n        } else if (mode === Mode.Bonds) {\n          const ls = lt.split(reWhitespace)\n          currentMoleculetype.bonds.push([\n            parseInt(ls[0]), // ai\n            parseInt(ls[1]) // aj\n          ])\n        } else if (mode === Mode.System) {\n          s.title = lt\n        } else if (mode === Mode.Molecules) {\n          const ls = lt.split(reWhitespace)\n          molecules.push([\n            ls[0], // name\n            parseInt(ls[1]) // count\n          ])\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    let atomCount = 0\n    let bondCount = 0\n    molecules.forEach(function (val) {\n      const [name, molCount] = val\n      const molType = moleculetypeDict[name]\n      atomCount += molCount * molType.atoms.length\n      bondCount += molCount * molType.bonds.length\n    })\n\n    atomStore.resize(atomCount)\n    bondStore.resize(bondCount)\n\n    let atomIdx = 0\n    let resIdx = 0\n    let chainidIdx = 0\n    let chainnameIdx = 0\n    let bondIdx = 0\n    let atomOffset = 0\n    let lastResno: number\n\n    molecules.forEach(function (val) {\n      const [name, molCount] = val\n      const molType = moleculetypeDict[name]\n      const chainname = getChainname(chainnameIdx)\n      for (let i = 0; i < molCount; ++i) {\n        lastResno = -1\n        const chainid = WaterNames.includes(name) ? chainname : getChainname(chainidIdx)\n        molType.atoms.forEach(function (atomData) {\n          const [resno, resname, atomname, charge] = atomData\n          if (resno !== lastResno) {\n            ++resIdx\n          }\n          atomStore.atomTypeId[atomIdx] = atomMap.add(atomname)\n          atomStore.serial[atomIdx] = atomIdx + 1\n          atomStore.partialCharge[atomIdx] = charge\n          sb.addAtom(0, chainname, chainid, resname, resIdx + 1)\n          ++atomIdx\n          lastResno = resno\n        })\n        molType.bonds.forEach(function (bondData) {\n          bondStore.atomIndex1[bondIdx] = atomOffset + bondData[0] - 1\n          bondStore.atomIndex2[bondIdx] = atomOffset + bondData[1] - 1\n          ++bondIdx\n        })\n        ++chainidIdx\n        atomOffset += molType.atoms.length\n      }\n      ++chainnameIdx\n    })\n\n    bondStore.count = bondCount\n\n    sb.finalize()\n    s.finalizeAtoms()\n    s.finalizeBonds()\n    calculateBondsWithin(s, true)\n    calculateBondsBetween(s, true, true)\n    assignResidueTypeBonds(s)\n\n    if (Debug) Log.timeEnd('TopParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('top', TopParser)\n\nexport default TopParser\n","/**\n * @file Trajectory Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Parser, { ParserParameters } from './parser'\nimport Frames from '../trajectory/frames'\nimport Streamer from '../streamer/streamer';\n\nclass TrajectoryParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    super(streamer, params)\n\n    this.frames = new Frames(this.name, this.path)\n  }\n\n  get type () { return 'trajectory' }\n  get __objName () { return 'frames' }\n}\n\nexport default TrajectoryParser\n","/**\n * @file Dcd Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { uint8ToString, ensureBuffer } from '../utils'\nimport TrajectoryParser from './trajectory-parser'\n\nconst charmmTimeUnitFactor = 20.45482949774598\n\ninterface DcdHeader {\n  NSET: number,\n  ISTART: number,\n  NSAVC: number,\n  NAMNF: number,\n  DELTA: number,\n  TITLE: string,\n  NATOM: number\n}\n\nclass DcdParser extends TrajectoryParser {\n  get type () { return 'dcd' }\n  get isBinary () { return true }\n\n  _parse () {\n    // http://www.ks.uiuc.edu/Research/vmd/plugins/molfile/dcdplugin.html\n\n    // The DCD format is structured as follows\n    //   (FORTRAN UNFORMATTED, with Fortran data type descriptions):\n    // HDR     NSET    ISTRT   NSAVC   5-ZEROS NATOM-NFREAT    DELTA   9-ZEROS\n    // `CORD'  #files  step 1  step    zeroes  (zero)          timestep  (zeroes)\n    //                         interval\n    // C*4     INT     INT     INT     5INT    INT             DOUBLE  9INT\n    // ==========================================================================\n    // NTITLE          TITLE\n    // INT (=2)        C*MAXTITL\n    //                 (=32)\n    // ==========================================================================\n    // NATOM\n    // #atoms\n    // INT\n    // ==========================================================================\n    // X(I), I=1,NATOM         (DOUBLE)\n    // Y(I), I=1,NATOM\n    // Z(I), I=1,NATOM\n    // ==========================================================================\n\n    if (Debug) Log.time('DcdParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const dv = new DataView(bin)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const header: Partial<DcdHeader> = {}\n\n    let nextPos = 0\n\n    // header block\n\n    const intView = new Int32Array(bin, 0, 23)\n    const ef = intView[ 0 ] !== dv.getInt32(0) // endianess flag\n    // swap byte order when big endian (84 indicates little endian)\n    if (intView[ 0 ] !== 84) {\n      const n = bin.byteLength\n      for (let i = 0; i < n; i += 4) {\n        dv.setFloat32(i, dv.getFloat32(i), true)\n      }\n    }\n    if (intView[ 0 ] !== 84) {\n      Log.error('dcd bad format, header block start')\n    }\n    // format indicator, should read 'CORD'\n    const formatString = String.fromCharCode(\n      dv.getUint8(4), dv.getUint8(5),\n      dv.getUint8(6), dv.getUint8(7)\n    )\n    if (formatString !== 'CORD') {\n      Log.error('dcd bad format, format string')\n    }\n    let isCharmm = false\n    let extraBlock = false\n    let fourDims = false\n    // version field in charmm, unused in X-PLOR\n    if (intView[ 22 ] !== 0) {\n      isCharmm = true\n      if (intView[ 12 ] !== 0) extraBlock = true\n      if (intView[ 13 ] === 1) fourDims = true\n    }\n    header.NSET = intView[ 2 ]\n    header.ISTART = intView[ 3 ]\n    header.NSAVC = intView[ 4 ]\n    header.NAMNF = intView[ 10 ]\n    if (isCharmm) {\n      header.DELTA = dv.getFloat32(44, ef)\n    } else {\n      header.DELTA = dv.getFloat64(44, ef)\n    }\n    if (intView[ 22 ] !== 84) {\n      Log.error('dcd bad format, header block end')\n    }\n    nextPos = nextPos + 21 * 4 + 8\n\n    // title block\n\n    const titleLength = dv.getInt32(nextPos, ef)\n    const titlePos = nextPos + 1\n    if ((titleLength - 4) % 80 !== 0) {\n      Log.error('dcd bad format, title block start')\n    }\n    header.TITLE = uint8ToString(\n      new Uint8Array(bin, titlePos, titleLength)\n    )\n    if (dv.getInt32(titlePos + titleLength + 4 - 1, ef) !== titleLength) {\n      Log.error('dcd bad format, title block end')\n    }\n    nextPos = nextPos + titleLength + 8\n\n    // natom block\n\n    if (dv.getInt32(nextPos, ef) !== 4) {\n      Log.error('dcd bad format, natom block start')\n    }\n    header.NATOM = dv.getInt32(nextPos + 4, ef)\n    if (dv.getInt32(nextPos + 8, ef) !== 4) {\n      Log.error('dcd bad format, natom block end')\n    }\n    nextPos = nextPos + 4 + 8\n\n    // fixed atoms block\n\n    if (header.NAMNF > 0) {\n      // TODO read coordinates and indices of fixed atoms\n      Log.error('dcd format with fixed atoms unsupported, aborting')\n      return\n    }\n\n    // frames\n\n    const natom = header.NATOM\n    const natom4 = natom * 4\n\n    for (let i = 0, n = header.NSET; i < n; ++i) {\n      if (extraBlock) {\n        nextPos += 4 // block start\n        // unitcell: A, alpha, B, beta, gamma, C (doubles)\n        const box = new Float32Array(9)\n        box[ 0 ] = dv.getFloat64(nextPos, ef)\n        box[ 4 ] = dv.getFloat64(nextPos + 2 * 8, ef)\n        box[ 8 ] = dv.getFloat64(nextPos + 5 * 8, ef)\n        boxes.push(box)\n        nextPos += 48\n        nextPos += 4 // block end\n      }\n\n      // xyz coordinates\n      const coord = new Float32Array(natom * 3)\n      for (let j = 0; j < 3; ++j) {\n        if (dv.getInt32(nextPos, ef) !== natom4) {\n          Log.error('dcd bad format, coord block start', i, j)\n        }\n        nextPos += 4 // block start\n        const c = new Float32Array(bin, nextPos, natom)\n        for (let k = 0; k < natom; ++k) {\n          coord[ 3 * k + j ] = c[ k ]\n        }\n        nextPos += natom4\n        if (dv.getInt32(nextPos, ef) !== natom4) {\n          Log.error('dcd bad format, coord block end', i, j)\n        }\n        nextPos += 4 // block end\n      }\n      coordinates.push(coord)\n\n      if (fourDims) {\n        const bytes = dv.getInt32(nextPos, ef)\n        nextPos += 4 + bytes + 4 // block start + skip + block end\n      }\n    }\n\n    if (header.DELTA) {\n      f.deltaTime = header.DELTA * charmmTimeUnitFactor\n    }\n    if (header.ISTART >= 1) {\n      f.timeOffset = (header.ISTART - 1) * f.deltaTime\n    }\n\n    // console.log(header)\n    // console.log(header.TITLE)\n    // console.log('isCharmm', isCharmm, 'extraBlock', extraBlock, 'fourDims, fourDims)\n\n    if (Debug) Log.timeEnd('DcdParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('dcd', DcdParser)\n\nexport default DcdParser\n","/**\n * @file Netcdf Reader\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n *\n * Adapted from https://github.com/cheminfo-js/netcdfjs\n * MIT License, Copyright (c) 2016 cheminfo\n */\n\nimport IOBuffer from './io-buffer'\n\nexport interface NetCDFRecordDimension {\n  length: number,\n  id?: number,\n  name?: string,\n  recordStep?: number\n}\n\nexport interface NetCDFHeader {\n  recordDimension: NetCDFRecordDimension,\n  version: number,\n  dimensions: any[],\n  globalAttributes: any[],\n  variables: any[]\n}\n\nexport interface NetCDFDimension {\n  name: string,\n  size: number\n}\n\n/**\n * Throws a non-valid NetCDF exception if the statement it's true\n * @ignore\n * @param {boolean} statement - Throws if true\n * @param {string} reason - Reason to throw\n */\nfunction notNetcdf (statement: boolean, reason: string) {\n  if (statement) {\n    throw new TypeError('Not a valid NetCDF v3.x file: ' + reason)\n  }\n}\n\n/**\n * Moves 1, 2, or 3 bytes to next 4-byte boundary\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n */\nfunction padding (buffer: IOBuffer) {\n  if ((buffer.offset % 4) !== 0) {\n    buffer.skip(4 - (buffer.offset % 4))\n  }\n}\n\n/**\n * Reads the name\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @return {string} - Name\n */\nfunction readName (buffer: IOBuffer) {\n  // Read name\n  const nameLength = buffer.readUint32()\n  const name = buffer.readChars(nameLength)\n\n  // validate name\n  // TODO\n\n  // Apply padding\n  padding(buffer)\n  return name\n}\n\nconst types = {\n  BYTE: 1,\n  CHAR: 2,\n  SHORT: 3,\n  INT: 4,\n  FLOAT: 5,\n  DOUBLE: 6\n}\n\n/**\n * Parse a number into their respective type\n * @ignore\n * @param {number} type - integer that represents the type\n * @return {string} - parsed value of the type\n */\nfunction num2str (type: number) {\n  switch (Number(type)) {\n    case types.BYTE:\n      return 'byte'\n    case types.CHAR:\n      return 'char'\n    case types.SHORT:\n      return 'short'\n    case types.INT:\n      return 'int'\n    case types.FLOAT:\n      return 'float'\n    case types.DOUBLE:\n      return 'double'\n    default:\n      return 'undefined'\n  }\n}\n\n/**\n * Parse a number type identifier to his size in bytes\n * @ignore\n * @param {number} type - integer that represents the type\n * @return {number} -size of the type\n */\nfunction num2bytes (type: number) {\n  switch (Number(type)) {\n    case types.BYTE:\n      return 1\n    case types.CHAR:\n      return 1\n    case types.SHORT:\n      return 2\n    case types.INT:\n      return 4\n    case types.FLOAT:\n      return 4\n    case types.DOUBLE:\n      return 8\n    default:\n      return -1\n  }\n}\n\n/**\n * Reverse search of num2str\n * @ignore\n * @param {string} type - string that represents the type\n * @return {number} - parsed value of the type\n */\nfunction str2num (type: string) {\n  switch (String(type)) {\n    case 'byte':\n      return types.BYTE\n    case 'char':\n      return types.CHAR\n    case 'short':\n      return types.SHORT\n    case 'int':\n      return types.INT\n    case 'float':\n      return types.FLOAT\n    case 'double':\n      return types.DOUBLE\n    default:\n      return -1\n  }\n}\n\n/**\n * Auxiliary function to read numeric data\n * @ignore\n * @param {number} size - Size of the element to read\n * @param {function} bufferReader - Function to read next value\n * @return {Array<number>|number}\n */\nfunction readNumber (size: number, bufferReader: Function) {\n  if (size !== 1) {\n    const numbers = new Array(size)\n    for (let i = 0; i < size; i++) {\n      numbers[i] = bufferReader()\n    }\n    return numbers\n  } else {\n    return bufferReader()\n  }\n}\n\n/**\n * Given a type and a size reads the next element\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {number} type - Type of the data to read\n * @param {number} size - Size of the element to read\n * @return {string|Array<number>|number}\n */\nfunction readType (buffer: IOBuffer, type: number, size: number) {\n  switch (type) {\n    case types.BYTE:\n      return buffer.readBytes(size)\n    case types.CHAR:\n      return trimNull(buffer.readChars(size))\n    case types.SHORT:\n      return readNumber(size, buffer.readInt16.bind(buffer))\n    case types.INT:\n      return readNumber(size, buffer.readInt32.bind(buffer))\n    case types.FLOAT:\n      return readNumber(size, buffer.readFloat32.bind(buffer))\n    case types.DOUBLE:\n      return readNumber(size, buffer.readFloat64.bind(buffer))\n    default:\n      notNetcdf(true, 'non valid type ' + type)\n      return undefined\n  }\n}\n\n/**\n * Removes null terminate value\n * @ignore\n * @param {string} value - String to trim\n * @return {string} - Trimmed string\n */\nfunction trimNull (value: string) {\n  if (value.charCodeAt(value.length - 1) === 0) {\n    return value.substring(0, value.length - 1)\n  }\n  return value\n}\n\n// const STREAMING = 4294967295;\n\n/**\n * Read data for the given non-record variable\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {object} variable - Variable metadata\n * @return {Array} - Data of the element\n */\nfunction nonRecord (buffer: IOBuffer, variable: {type: string, size: number}) {\n  // variable type\n  const type = str2num(variable.type)\n\n  // size of the data\n  const size = variable.size / num2bytes(type)\n\n  // iterates over the data\n  const data = new Array(size)\n  for (let i = 0; i < size; i++) {\n    data[i] = readType(buffer, type, 1)\n  }\n\n  return data\n}\n\n/**\n * Read data for the given record variable\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {object} variable - Variable metadata\n * @param {object} recordDimension - Record dimension metadata\n * @return {Array} - Data of the element\n */\nfunction record (buffer:IOBuffer, variable: {type: string, size: number}, recordDimension: NetCDFRecordDimension) {\n  // variable type\n  const type = str2num(variable.type)\n  const width = variable.size ? variable.size / num2bytes(type) : 1\n\n  // size of the data\n  // TODO streaming data\n  const size = recordDimension.length\n\n  // iterates over the data\n  const data = new Array(size)\n  const step = recordDimension.recordStep\n\n  for (let i = 0; i < size; i++) {\n    const currentOffset = buffer.offset\n    data[i] = readType(buffer, type, width)\n    buffer.seek(currentOffset + step!)\n  }\n\n  return data\n}\n\n// Grammar constants\nconst ZERO = 0\nconst NC_DIMENSION = 10\nconst NC_VARIABLE = 11\nconst NC_ATTRIBUTE = 12\n\n/**\n * Read the header of the file\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {number} version - Version of the file\n * @return {object} - Object with the fields:\n *  * `recordDimension`: Number with the length of record dimension\n *  * `dimensions`: List of dimensions\n *  * `globalAttributes`: List of global attributes\n *  * `variables`: List of variables\n */\nfunction header (buffer: IOBuffer, version: number) {\n  // Length of record dimension\n  // sum of the varSize's of all the record variables.\n  const header: Partial<NetCDFHeader> = {recordDimension: {length: buffer.readUint32()}}\n\n  // Version\n  header.version = version\n\n  // List of dimensions\n  const dimList = dimensionsList(buffer) as {dimensions: NetCDFDimension[], recordId: number, recordName: string}\n  header.recordDimension!.id = dimList.recordId\n  header.recordDimension!.name = dimList.recordName\n  header.dimensions = dimList.dimensions\n\n  // List of global attributes\n  header.globalAttributes = attributesList(buffer)\n\n  // List of variables\n  const variables = variablesList(buffer, dimList.recordId, version) as {variables: any[], recordStep: number}\n  header.variables = variables.variables\n  header.recordDimension!.recordStep = variables.recordStep\n\n  return header\n}\n\n/**\n * List of dimensions\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @return {object} - List of dimensions and record dimension with:\n *  * `name`: String with the name of the dimension\n *  * `size`: Number with the size of the dimension\n */\nfunction dimensionsList (buffer: IOBuffer) {\n  let dimensions: NetCDFDimension[], recordId, recordName\n  const dimList = buffer.readUint32()\n  if (dimList === ZERO) {\n    notNetcdf((buffer.readUint32() !== ZERO), 'wrong empty tag for list of dimensions')\n    return []\n  } else {\n    notNetcdf((dimList !== NC_DIMENSION), 'wrong tag for list of dimensions')\n\n    // Length of dimensions\n    const dimensionSize = buffer.readUint32()\n    dimensions = new Array(dimensionSize)\n    for (let dim = 0; dim < dimensionSize; dim++) {\n      // Read name\n      const name = readName(buffer)\n\n      // Read dimension size\n      const size = buffer.readUint32()\n      if (size === 0) {\n        recordId = dim\n        recordName = name\n      }\n\n      dimensions[dim] = {\n        name: name,\n        size: size\n      }\n    }\n    return {\n      dimensions: dimensions,\n      recordId: recordId,\n      recordName: recordName\n    }\n  }\n}\n\n/**\n * List of attributes\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @return {Array<object>} - List of attributes with:\n *  * `name`: String with the name of the attribute\n *  * `type`: String with the type of the attribute\n *  * `value`: A number or string with the value of the attribute\n */\nfunction attributesList (buffer: IOBuffer) {\n  let attributes\n  const gAttList = buffer.readUint32()\n  if (gAttList === ZERO) {\n    notNetcdf((buffer.readUint32() !== ZERO), 'wrong empty tag for list of attributes')\n    return []\n  } else {\n    notNetcdf((gAttList !== NC_ATTRIBUTE), 'wrong tag for list of attributes')\n\n    // Length of attributes\n    const attributeSize = buffer.readUint32()\n    attributes = new Array(attributeSize)\n    for (let gAtt = 0; gAtt < attributeSize; gAtt++) {\n      // Read name\n      const name = readName(buffer)\n\n      // Read type\n      const type = buffer.readUint32()\n      notNetcdf(((type < 1) || (type > 6)), 'non valid type ' + type)\n\n      // Read attribute\n      const size = buffer.readUint32()\n      const value = readType(buffer, type, size)\n\n      // Apply padding\n      padding(buffer)\n\n      attributes[gAtt] = {\n        name: name,\n        type: num2str(type),\n        value: value\n      }\n    }\n  }\n  return attributes\n}\n\n/**\n * List of variables\n * @ignore\n * @param {IOBuffer} buffer - Buffer for the file data\n * @param {number} recordId - Id if the record dimension\n * @param {number} version - Version of the file\n * @return {object} - Number of recordStep and list of variables with:\n *  * `name`: String with the name of the variable\n *  * `dimensions`: Array with the dimension IDs of the variable\n *  * `attributes`: Array with the attributes of the variable\n *  * `type`: String with the type of the variable\n *  * `size`: Number with the size of the variable\n *  * `offset`: Number with the offset where of the variable begins\n *  * `record`: True if is a record variable, false otherwise\n */\nfunction variablesList (buffer: IOBuffer, recordId: number, version: number) {\n  const varList = buffer.readUint32()\n  let recordStep = 0\n  let variables\n  if (varList === ZERO) {\n    notNetcdf(\n      (buffer.readUint32() !== ZERO),\n      'wrong empty tag for list of variables'\n    )\n    return []\n  } else {\n    notNetcdf((varList !== NC_VARIABLE), 'wrong tag for list of variables')\n\n    // Length of variables\n    const variableSize = buffer.readUint32()\n    variables = new Array(variableSize)\n    for (let v = 0; v < variableSize; v++) {\n      // Read name\n      const name = readName(buffer)\n\n      // Read dimensionality of the variable\n      const dimensionality = buffer.readUint32()\n\n      // Index into the list of dimensions\n      const dimensionsIds = new Array(dimensionality)\n      for (let dim = 0; dim < dimensionality; dim++) {\n        dimensionsIds[dim] = buffer.readUint32()\n      }\n\n      // Read variables size\n      const attributes = attributesList(buffer)\n\n      // Read type\n      const type = buffer.readUint32()\n      notNetcdf(((type < 1) && (type > 6)), 'non valid type ' + type)\n\n      // Read variable size\n      // The 32-bit varSize field is not large enough to contain the\n      // size of variables that require more than 2^32 - 4 bytes,\n      // so 2^32 - 1 is used in the varSize field for such variables.\n      const varSize = buffer.readUint32()\n\n      // Read offset\n      let offset = buffer.readUint32()\n      if (version === 2) {\n        notNetcdf((offset > 0), 'offsets larger than 4GB not supported')\n        offset = buffer.readUint32()\n      }\n\n      // Count amount of record variables\n      if (dimensionsIds[0] === recordId) {\n        recordStep += varSize\n      }\n\n      variables[v] = {\n        name: name,\n        dimensions: dimensionsIds,\n        attributes: attributes,\n        type: num2str(type),\n        size: varSize,\n        offset: offset,\n        record: (dimensionsIds[0] === recordId)\n      }\n    }\n  }\n\n  return {\n    variables: variables,\n    recordStep: recordStep\n  }\n}\n\n/**\n * Reads a NetCDF v3.x file\n * https://www.unidata.ucar.edu/software/netcdf/docs/file_format_specifications.html\n */\nclass NetcdfReader {\n  header: Partial<NetCDFHeader>\n  buffer: IOBuffer\n  /**\n   * @param {ArrayBuffer} data - ArrayBuffer or any Typed Array with the data\n   */\n  constructor (data: ArrayBuffer) {\n    const buffer = new IOBuffer(data)\n    buffer.setBigEndian()\n\n    // Validate that it's a NetCDF file\n    notNetcdf((buffer.readChars(3) !== 'CDF'), 'should start with CDF')\n\n    // Check the NetCDF format\n    const version = buffer.readByte()\n    notNetcdf((version > 2), 'unknown version')\n\n    // Read the header\n    this.header = header(buffer, version)\n    this.buffer = buffer\n  }\n\n  /**\n   * @return {string} - Version for the NetCDF format\n   */\n  get version () {\n    if (this.header.version === 1) {\n      return 'classic format'\n    } else {\n      return '64-bit offset format'\n    }\n  }\n\n  /**\n   * @return {object} - Metadata for the record dimension\n   *  * `length`: Number of elements in the record dimension\n   *  * `id`: Id number in the list of dimensions for the record dimension\n   *  * `name`: String with the name of the record dimension\n   *  * `recordStep`: Number with the record variables step size\n   */\n  get recordDimension () {\n    return this.header.recordDimension\n  }\n\n  /**\n   * @return {Array<object>} - List of dimensions with:\n   *  * `name`: String with the name of the dimension\n   *  * `size`: Number with the size of the dimension\n   */\n  get dimensions () {\n    return this.header.dimensions\n  }\n\n  /**\n   * @return {Array<object>} - List of global attributes with:\n   *  * `name`: String with the name of the attribute\n   *  * `type`: String with the type of the attribute\n   *  * `value`: A number or string with the value of the attribute\n   */\n  get globalAttributes () {\n    return this.header.globalAttributes\n  }\n\n  /**\n   * @return {Array<object>} - List of variables with:\n   *  * `name`: String with the name of the variable\n   *  * `dimensions`: Array with the dimension IDs of the variable\n   *  * `attributes`: Array with the attributes of the variable\n   *  * `type`: String with the type of the variable\n   *  * `size`: Number with the size of the variable\n   *  * `offset`: Number with the offset where of the variable begins\n   *  * `record`: True if is a record variable, false otherwise\n   */\n  get variables () {\n    return this.header.variables\n  }\n\n  /**\n   * Checks if a variable is available\n   * @param {string|object} variableName - Name of the variable to check\n   * @return {Boolean} - Variable existence\n   */\n  hasDataVariable (variableName: string) {\n    return this.header.variables!.findIndex(function (val) {\n      return val.name === variableName\n    }) !== -1\n  }\n\n  /**\n   * Retrieves the data for a given variable\n   * @param {string|object} variableName - Name of the variable to search or variable object\n   * @return {Array} - List with the variable values\n   */\n  getDataVariable (variableName: string|{}) {\n    let variable\n    if (typeof variableName === 'string') {\n      // search the variable\n      variable = this.header.variables!.find(function (val) {\n        return val.name === variableName\n      })\n    } else {\n      variable = variableName\n    }\n\n    // throws if variable not found\n    notNetcdf((variable === undefined), 'variable not found')\n\n    // go to the offset position\n    this.buffer.seek(variable.offset)\n\n    if (variable.record) {\n      // record variable case\n      return record(this.buffer, variable, this.header.recordDimension!)\n    } else {\n      // non-record variable case\n      return nonRecord(this.buffer, variable)\n    }\n  }\n}\n\nexport default NetcdfReader\n","/**\n * @file Nctraj Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport TrajectoryParser from './trajectory-parser'\nimport NetcdfReader from '../utils/netcdf-reader'\n\nclass NctrajParser extends TrajectoryParser {\n  get type () { return 'nctraj' }\n  get isBinary () { return true }\n\n  _parse () {\n    // http://ambermd.org/netcdf/nctraj.xhtml\n\n    if (Debug) Log.time('NctrajParser._parse ' + this.name)\n\n    const netcdfReader = new NetcdfReader(this.streamer.data)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const times = f.times\n\n    netcdfReader.getDataVariable('coordinates').forEach(function (c) {\n      coordinates.push(new Float32Array(c))\n    })\n\n    if (netcdfReader.hasDataVariable('cell_lengths')) {\n      netcdfReader.getDataVariable('cell_lengths').forEach(function (b) {\n        boxes.push(new Float32Array(b))\n      })\n    }\n\n    if (netcdfReader.hasDataVariable('time')) {\n      netcdfReader.getDataVariable('time').forEach(function (t) {\n        times.push(t)\n      })\n    }\n\n    if (times.length >= 1) {\n      f.timeOffset = times[0]\n    }\n    if (times.length >= 2) {\n      f.deltaTime = times[1] - times[0]\n    }\n\n    if (Debug) Log.timeEnd('NctrajParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('nctraj', NctrajParser)\nParserRegistry.add('ncdf', NctrajParser)\nParserRegistry.add('nc', NctrajParser)\n\nexport default NctrajParser\n","/**\n * @file Trr Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport TrajectoryParser from './trajectory-parser'\n\nclass TrrParser extends TrajectoryParser {\n  get type () { return 'trr' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/gromacs/gromacs/blob/master/src/gromacs/fileio/trrio.cpp\n\n    if (Debug) Log.time('TrrParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const dv = new DataView(bin)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const times = f.times\n\n    let offset = 0\n\n    while (true) {\n      // const magicnum = dv.getInt32(offset)\n      // const i1 = dv.getFloat32(offset + 4)\n      offset += 8\n\n      const versionSize = dv.getInt32(offset)\n      offset += 4\n      offset += versionSize\n\n      // const irSize = dv.getInt32(offset)\n      // const eSize = dv.getInt32(offset + 4)\n      const boxSize = dv.getInt32(offset + 8)\n      const virSize = dv.getInt32(offset + 12)\n      const presSize = dv.getInt32(offset + 16)\n      // const topSize = dv.getInt32(offset + 20)\n      // const symSize = dv.getInt32(offset + 24)\n      const coordSize = dv.getInt32(offset + 28)\n      const velocitySize = dv.getInt32(offset + 32)\n      const forceSize = dv.getInt32(offset + 36)\n      const natoms = dv.getInt32(offset + 40)\n      // const step = dv.getInt32(offset + 44)\n      // const nre = dv.getInt32(offset + 48)\n      offset += 52\n\n      const floatSize = boxSize / 9\n      const natoms3 = natoms * 3\n\n      // let lambda\n      if (floatSize === 8) {\n        times.push(dv.getFloat64(offset))\n        // lambda = dv.getFloat64(offset + 8)\n      } else {\n        times.push(dv.getFloat32(offset))\n        // lambda = dv.getFloat32(offset + 4)\n      }\n      offset += 2 * floatSize\n\n      if (boxSize) {\n        const box = new Float32Array(9)\n        if (floatSize === 8) {\n          for (let i = 0; i < 9; ++i) {\n            box[i] = dv.getFloat64(offset) * 10\n            offset += 8\n          }\n        } else {\n          for (let i = 0; i < 9; ++i) {\n            box[i] = dv.getFloat32(offset) * 10\n            offset += 4\n          }\n        }\n        boxes.push(box)\n      }\n\n      // ignore, unused\n      offset += virSize\n\n      // ignore, unused\n      offset += presSize\n\n      if (coordSize) {\n        let frameCoords\n        if (floatSize === 8) {\n          frameCoords = new Float32Array(natoms3)\n          for (let i = 0; i < natoms3; ++i) {\n            frameCoords[i] = dv.getFloat64(offset) * 10\n            offset += 8\n          }\n        } else {\n          const tmp = new Uint32Array(bin, offset, natoms3)\n          for (let i = 0; i < natoms3; ++i) {\n            const value = tmp[i]\n            tmp[i] = (\n              ((value & 0xFF) << 24) | ((value & 0xFF00) << 8) |\n              ((value >> 8) & 0xFF00) | ((value >> 24) & 0xFF)\n            )\n          }\n          frameCoords = new Float32Array(bin, offset, natoms3)\n          for (let i = 0; i < natoms3; ++i) {\n            frameCoords[i] *= 10\n            offset += 4\n          }\n        }\n        coordinates.push(frameCoords)\n      }\n\n      // ignore, unused\n      offset += velocitySize\n\n      // ignore, unused\n      offset += forceSize\n\n      if (offset >= bin.byteLength) break\n    }\n\n    if (times.length >= 1) {\n      f.timeOffset = times[0]\n    }\n    if (times.length >= 2) {\n      f.deltaTime = times[1] - times[0]\n    }\n\n    if (Debug) Log.timeEnd('TrrParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('trr', TrrParser)\n\nexport default TrrParser\n","/**\n * @file Xtc Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport TrajectoryParser from './trajectory-parser'\nimport { NumberArray } from '../types';\n\nconst MagicInts = new Uint32Array([\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 10, 12, 16, 20, 25, 32, 40, 50, 64,\n  80, 101, 128, 161, 203, 256, 322, 406, 512, 645, 812, 1024, 1290,\n  1625, 2048, 2580, 3250, 4096, 5060, 6501, 8192, 10321, 13003,\n  16384, 20642, 26007, 32768, 41285, 52015, 65536, 82570, 104031,\n  131072, 165140, 208063, 262144, 330280, 416127, 524287, 660561,\n  832255, 1048576, 1321122, 1664510, 2097152, 2642245, 3329021,\n  4194304, 5284491, 6658042, 8388607, 10568983, 13316085, 16777216\n])\nconst FirstIdx = 9\n// const LastIdx = MagicInts.length\n\nfunction sizeOfInt (size: number) {\n  let num = 1\n  let numOfBits = 0\n  while (size >= num && numOfBits < 32) {\n    numOfBits++\n    num <<= 1\n  }\n  return numOfBits\n}\n\nconst _tmpBytes = new Uint8Array(32)\n\nfunction sizeOfInts (numOfInts: number, sizes: Int32Array) {\n  let numOfBytes = 1\n  let numOfBits = 0\n  _tmpBytes[0] = 1\n  for (let i = 0; i < numOfInts; i++) {\n    let bytecnt\n    let tmp = 0\n    for (bytecnt = 0; bytecnt < numOfBytes; bytecnt++) {\n      tmp += _tmpBytes[bytecnt] * sizes[i]\n      _tmpBytes[bytecnt] = tmp & 0xff\n      tmp >>= 8\n    }\n    while (tmp !== 0) {\n      _tmpBytes[bytecnt++] = tmp & 0xff\n      tmp >>= 8\n    }\n    numOfBytes = bytecnt\n  }\n  let num = 1\n  numOfBytes--\n  while (_tmpBytes[numOfBytes] >= num) {\n    numOfBits++\n    num *= 2\n  }\n  return numOfBits + numOfBytes * 8\n}\n\nfunction decodeBits (buf: Int32Array, cbuf: Uint8Array, numOfBits: number, buf2: Uint32Array) {\n  const mask = (1 << numOfBits) - 1\n  let lastBB0 = buf2[1]\n  let lastBB1 = buf2[2]\n  let cnt = buf[0]\n  let num = 0\n\n  while (numOfBits >= 8) {\n    lastBB1 = (lastBB1 << 8) | cbuf[cnt++]\n    num |= (lastBB1 >> lastBB0) << (numOfBits - 8)\n    numOfBits -= 8\n  }\n\n  if (numOfBits > 0) {\n    if (lastBB0 < numOfBits) {\n      lastBB0 += 8\n      lastBB1 = (lastBB1 << 8) | cbuf[cnt++]\n    }\n    lastBB0 -= numOfBits\n    num |= (lastBB1 >> lastBB0) & ((1 << numOfBits) - 1)\n  }\n\n  num &= mask\n  buf[0] = cnt\n  buf[1] = lastBB0\n  buf[2] = lastBB1\n\n  return num\n}\n\nconst _tmpIntBytes = new Int32Array(32)\n\nfunction decodeInts (buf: Int32Array, cbuf: Uint8Array, numOfInts: number, numOfBits: number, sizes: NumberArray, nums: Float32Array, buf2: Uint32Array) {\n  let numOfBytes = 0\n  _tmpIntBytes[1] = 0\n  _tmpIntBytes[2] = 0\n  _tmpIntBytes[3] = 0\n\n  while (numOfBits > 8) {\n    // this is inversed??? why??? because of the endiannness???\n    _tmpIntBytes[numOfBytes++] = decodeBits(buf, cbuf, 8, buf2)\n    numOfBits -= 8\n  }\n\n  if (numOfBits > 0) {\n    _tmpIntBytes[numOfBytes++] = decodeBits(buf, cbuf, numOfBits, buf2)\n  }\n\n  for (let i = numOfInts - 1; i > 0; i--) {\n    let num = 0\n    for (let j = numOfBytes - 1; j >= 0; j--) {\n      num = (num << 8) | _tmpIntBytes[j]\n      const p = (num / sizes[i]) | 0\n      _tmpIntBytes[j] = p\n      num = num - p * sizes[i]\n    }\n    nums[i] = num\n  }\n  nums[0] = (\n    _tmpIntBytes[0] |\n    (_tmpIntBytes[1] << 8) |\n    (_tmpIntBytes[2] << 16) |\n    (_tmpIntBytes[3] << 24)\n  )\n}\n\nclass XtcParser extends TrajectoryParser {\n  get type () { return 'xtc' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/gromacs/gromacs/blob/master/src/gromacs/fileio/xtcio.cpp\n    // https://github.com/gromacs/gromacs/blob/master/src/gromacs/fileio/libxdrf.cpp\n\n    if (Debug) Log.time('XtcParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const dv = new DataView(bin)\n\n    const f = this.frames\n    const coordinates = f.coordinates\n    const boxes = f.boxes\n    const times = f.times\n\n    const minMaxInt = new Int32Array(6)\n    const sizeint = new Int32Array(3)\n    const bitsizeint = new Int32Array(3)\n    const sizesmall = new Uint32Array(3)\n    const thiscoord = new Float32Array(3)\n    const prevcoord = new Float32Array(3)\n\n    let offset = 0\n    const buf = new Int32Array(3)\n    const buf2 = new Uint32Array(buf.buffer)\n\n    while (true) {\n      let frameCoords: NumberArray\n\n      // const magicnum = dv.getInt32(offset)\n      const natoms = dv.getInt32(offset + 4)\n      // const step = dv.getInt32(offset + 8)\n      offset += 12\n\n      const natoms3 = natoms * 3\n\n      times.push(dv.getFloat32(offset))\n      offset += 4\n\n      const box = new Float32Array(9)\n      for (let i = 0; i < 9; ++i) {\n        box[i] = dv.getFloat32(offset) * 10\n        offset += 4\n      }\n      boxes.push(box)\n\n      if (natoms <= 9) { // no compression\n        frameCoords = new Float32Array(natoms)\n        for (let i = 0; i < natoms; ++i) {\n          frameCoords[i] = dv.getFloat32(offset)\n          offset += 4\n        }\n      } else {\n        buf[0] = buf[1] = buf[2] = 0.0\n        sizeint[0] = sizeint[1] = sizeint[2] = 0\n        sizesmall[0] = sizesmall[1] = sizesmall[2] = 0\n        bitsizeint[0] = bitsizeint[1] = bitsizeint[2] = 0\n        thiscoord[0] = thiscoord[1] = thiscoord[2] = 0\n        prevcoord[0] = prevcoord[1] = prevcoord[2] = 0\n\n        frameCoords = new Float32Array(natoms3)\n        let lfp = 0\n\n        const lsize = dv.getInt32(offset)\n        offset += 4\n        const precision = dv.getFloat32(offset)\n        offset += 4\n\n        minMaxInt[0] = dv.getInt32(offset)\n        minMaxInt[1] = dv.getInt32(offset + 4)\n        minMaxInt[2] = dv.getInt32(offset + 8)\n        minMaxInt[3] = dv.getInt32(offset + 12)\n        minMaxInt[4] = dv.getInt32(offset + 16)\n        minMaxInt[5] = dv.getInt32(offset + 20)\n        sizeint[0] = minMaxInt[3] - minMaxInt[0] + 1\n        sizeint[1] = minMaxInt[4] - minMaxInt[1] + 1\n        sizeint[2] = minMaxInt[5] - minMaxInt[2] + 1\n        offset += 24\n\n        let bitsize\n        if ((sizeint[0] | sizeint[1] | sizeint[2]) > 0xffffff) {\n          bitsizeint[0] = sizeOfInt(sizeint[0])\n          bitsizeint[1] = sizeOfInt(sizeint[1])\n          bitsizeint[2] = sizeOfInt(sizeint[2])\n          bitsize = 0 // flag the use of large sizes\n        } else {\n          bitsize = sizeOfInts(3, sizeint)\n        }\n\n        let smallidx = dv.getInt32(offset)\n        offset += 4\n        // if (smallidx == 0) {alert(\"Undocumented error 1\"); return;}\n\n        // let tmpIdx = smallidx + 8\n        // const maxidx = (LastIdx < tmpIdx) ? LastIdx : tmpIdx\n        // const minidx = maxidx - 8  // often this equal smallidx\n        let tmpIdx = smallidx - 1\n        tmpIdx = (FirstIdx > tmpIdx) ? FirstIdx : tmpIdx\n        let smaller = (MagicInts[tmpIdx] / 2) | 0\n        let smallnum = (MagicInts[smallidx] / 2) | 0\n\n        sizesmall[0] = sizesmall[1] = sizesmall[2] = MagicInts[smallidx]\n        // larger = MagicInts[maxidx]\n\n        let adz = Math.ceil(dv.getInt32(offset) / 4) * 4\n        offset += 4\n        // if (tmpIdx == 0) {alert(\"Undocumented error 2\"); return;}\n\n        // buf = new Int32Array(bin, offset);\n        // buf8 = new Uint8Array(bin, offset);\n\n        // tmpIdx += 3; rndup = tmpIdx%4;\n        // for (i=tmpIdx+rndup-1; i>=tmpIdx; i--) buf8[i] = 0;\n\n        // now unpack buf2...\n\n        const invPrecision = 1.0 / precision\n        let run = 0\n        let i = 0\n\n        const buf8 = new Uint8Array(bin, offset) // 229...\n\n        thiscoord[0] = thiscoord[1] = thiscoord[2] = 0\n\n        while (i < lsize) {\n          if (bitsize === 0) {\n            thiscoord[0] = decodeBits(buf, buf8, bitsizeint[0], buf2)\n            thiscoord[1] = decodeBits(buf, buf8, bitsizeint[1], buf2)\n            thiscoord[2] = decodeBits(buf, buf8, bitsizeint[2], buf2)\n          } else {\n            decodeInts(buf, buf8, 3, bitsize, sizeint, thiscoord, buf2)\n          }\n\n          i++\n\n          thiscoord[0] += minMaxInt[0]\n          thiscoord[1] += minMaxInt[1]\n          thiscoord[2] += minMaxInt[2]\n\n          prevcoord[0] = thiscoord[0]\n          prevcoord[1] = thiscoord[1]\n          prevcoord[2] = thiscoord[2]\n\n          const flag = decodeBits(buf, buf8, 1, buf2)\n          let isSmaller = 0\n\n          if (flag === 1) {\n            run = decodeBits(buf, buf8, 5, buf2)\n            isSmaller = run % 3\n            run -= isSmaller\n            isSmaller--\n          }\n\n          // if ((lfp-ptrstart)+run > size3){\n          //   fprintf(stderr, \"(xdrfile error) Buffer overrun during decompression.\\n\");\n          //   return 0;\n          // }\n\n          if (run > 0) {\n            thiscoord[0] = thiscoord[1] = thiscoord[2] = 0\n\n            for (let k = 0; k < run; k += 3) {\n              decodeInts(buf, buf8, 3, smallidx, sizesmall, thiscoord, buf2)\n              i++\n\n              thiscoord[0] += prevcoord[0] - smallnum\n              thiscoord[1] += prevcoord[1] - smallnum\n              thiscoord[2] += prevcoord[2] - smallnum\n\n              if (k === 0) {\n                // interchange first with second atom for\n                // better compression of water molecules\n                let tmpSwap = thiscoord[0]\n                thiscoord[0] = prevcoord[0]\n                prevcoord[0] = tmpSwap\n\n                tmpSwap = thiscoord[1]\n                thiscoord[1] = prevcoord[1]\n                prevcoord[1] = tmpSwap\n\n                tmpSwap = thiscoord[2]\n                thiscoord[2] = prevcoord[2]\n                prevcoord[2] = tmpSwap\n\n                frameCoords[lfp++] = prevcoord[0] * invPrecision\n                frameCoords[lfp++] = prevcoord[1] * invPrecision\n                frameCoords[lfp++] = prevcoord[2] * invPrecision\n              } else {\n                prevcoord[0] = thiscoord[0]\n                prevcoord[1] = thiscoord[1]\n                prevcoord[2] = thiscoord[2]\n              }\n              frameCoords[lfp++] = thiscoord[0] * invPrecision\n              frameCoords[lfp++] = thiscoord[1] * invPrecision\n              frameCoords[lfp++] = thiscoord[2] * invPrecision\n            }\n          } else {\n            frameCoords[lfp++] = thiscoord[0] * invPrecision\n            frameCoords[lfp++] = thiscoord[1] * invPrecision\n            frameCoords[lfp++] = thiscoord[2] * invPrecision\n          }\n\n          smallidx += isSmaller\n\n          if (isSmaller < 0) {\n            smallnum = smaller\n            if (smallidx > FirstIdx) {\n              smaller = (MagicInts[smallidx - 1] / 2) | 0\n            } else {\n              smaller = 0\n            }\n          } else if (isSmaller > 0) {\n            smaller = smallnum\n            smallnum = (MagicInts[smallidx] / 2) | 0\n          }\n          sizesmall[0] = sizesmall[1] = sizesmall[2] = MagicInts[smallidx]\n\n          if (sizesmall[0] === 0 || sizesmall[1] === 0 || sizesmall[2] === 0) {\n            console.error('(xdrfile error) Undefined error.')\n            return\n          }\n        }\n        offset += adz\n      }\n\n      for (let c = 0; c < natoms3; c++) {\n        frameCoords[c] *= 10\n      }\n\n      coordinates.push(frameCoords)\n\n      if (offset >= bin.byteLength) break\n    }\n\n    if (times.length >= 1) {\n      f.timeOffset = times[0]\n    }\n    if (times.length >= 2) {\n      f.deltaTime = times[1] - times[0]\n    }\n\n    if (Debug) Log.timeEnd('XtcParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('xtc', XtcParser)\n\nexport default XtcParser\n","/**\n * @file Volume Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { defaults } from '../utils'\nimport Parser, { ParserParameters } from './parser'\nimport Volume from '../surface/volume'\nimport Streamer from '../streamer/streamer';\n\nexport interface VolumeParserParameters extends ParserParameters {\n  voxelSize: number\n}\n\nclass VolumeParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<VolumeParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.volume = new Volume(this.name, this.path)\n    this.voxelSize = defaults(p.voxelSize, 1)\n  }\n\n  get type () { return 'volume' }\n  get __objName () { return 'volume' }\n\n  _afterParse () {\n    this.volume.setMatrix(this.getMatrix())\n    super._afterParse()\n  }\n\n  getMatrix () {\n    return new Matrix4()\n  }\n}\n\nexport default VolumeParser\n","/**\n * @file Cube Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4, Vector3 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport VolumeParser from './volume-parser'\n\n// @author Johanna Tiemann <johanna.tiemann@googlemail.com>\n// @author Alexander Rose <alexander.rose@weirdbyte.de>\n\nconst reWhitespace = /\\s+/\nconst reScientificNotation = /-?\\d+(?:\\.\\d*)?(?:[eE][+-]?\\d+)?/g\nconst bohrToAngstromFactor = 0.529177210859\ninterface Header {\n  atomCount: number,\n  originX: number,\n  originY: number,\n  originZ: number,\n  NVX: number,\n  NVY: number,\n  NVZ: number,\n  basisX: Vector3,\n  basisY: Vector3,\n  basisZ: Vector3\n}\n\nclass CubeParser extends VolumeParser {\n  get type () { return 'cube' }\n\n  _parse () {\n    // http://paulbourke.net/dataformats/cube/\n\n    if (Debug) Log.time('CubeParser._parse ' + this.name)\n\n    const v = this.volume\n    const headerLines = this.streamer.peekLines(6)\n    const header: Partial<Header> = {}\n\n    const scaleFactor = bohrToAngstromFactor * this.voxelSize\n\n    function h (k: number, l: number) {\n      var field = headerLines[ k ].trim().split(reWhitespace)[ l ]\n      return parseFloat(field)\n    }\n\n    header.atomCount = Math.abs(h(2, 0)) // Number of atoms\n    header.originX = h(2, 1) * bohrToAngstromFactor // Position of origin of volumetric data\n    header.originY = h(2, 2) * bohrToAngstromFactor\n    header.originZ = h(2, 3) * bohrToAngstromFactor\n    header.NVX = h(3, 0) // Number of voxels\n    header.NVY = h(4, 0)\n    header.NVZ = h(5, 0)\n\n    header.basisX = new Vector3(h(3, 1), h(3, 2), h(3, 3))\n      .multiplyScalar(scaleFactor)\n    header.basisY = new Vector3(h(4, 1), h(4, 2), h(4, 3))\n      .multiplyScalar(scaleFactor)\n    header.basisZ = new Vector3(h(5, 1), h(5, 2), h(5, 3))\n      .multiplyScalar(scaleFactor)\n\n    const data = new Float32Array(header.NVX * header.NVY * header.NVZ)\n    let count = 0\n    let lineNo = 0\n    const oribitalFlag = h(2, 0) > 0 ? 0 : 1\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ].trim()\n\n        if (line !== '' && lineNo >= header.atomCount! + 6 + oribitalFlag) {\n          const m = line.match(reScientificNotation) as RegExpMatchArray\n          for (let j = 0, lj = m.length; j < lj; ++j) {\n            data[ count ] = parseFloat(m[ j ])\n            ++count\n          }\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    v.header = header\n    v.setData(data, header.NVZ, header.NVY, header.NVX)\n\n    if (Debug) Log.timeEnd('CubeParser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n    const matrix = new Matrix4()\n\n    matrix.multiply(\n      new Matrix4().makeTranslation(\n        h.originX, h.originY, h.originZ\n      )\n    )\n\n    matrix.multiply(\n      new Matrix4().makeBasis(\n        h.basisZ, h.basisY, h.basisX\n      )\n    )\n\n    return matrix\n  }\n}\n\nParserRegistry.add('cub', CubeParser)\nParserRegistry.add('cube', CubeParser)\n\nexport default CubeParser\n","/**\n * @file Dsn6 Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport { degToRad } from '../math/math-utils'\nimport VolumeParser from './volume-parser'\n\ninterface Dsn6Header {\n  xStart: number,\n  yStart: number,\n  zStart: number,\n  xExtent: number,\n  yExtent: number,\n  zExtent: number,\n  xRate: number,\n  yRate: number,\n  zRate: number,\n  xlen: number,\n  ylen: number,\n  zlen: number,\n  alpha: number,\n  beta: number,\n  gamma: number,\n  sigma: number\n}\n\nclass Dsn6Parser extends VolumeParser {\n  get type () { return 'dsn6' }\n  get isBinary () { return true }\n\n  _parse () {\n    // DSN6 http://www.uoxray.uoregon.edu/tnt/manual/node104.html\n    // BRIX http://svn.cgl.ucsf.edu/svn/chimera/trunk/libs/VolumeData/dsn6/brix-1.html\n\n    if (Debug) Log.time('Dsn6Parser._parse ' + this.name)\n\n    const v = this.volume\n    const header: Partial<Dsn6Header> = {}\n    let divisor, summand\n\n    const bin = ensureBuffer(this.streamer.data)\n    const intView = new Int16Array(bin)\n    const byteView = new Uint8Array(bin)\n    const brixStr = String.fromCharCode.apply(null, byteView.subarray(0, 512))\n\n    if (brixStr.startsWith(':-)')) {\n      header.xStart = parseInt(brixStr.substr(10, 5)) // NXSTART\n      header.yStart = parseInt(brixStr.substr(15, 5))\n      header.zStart = parseInt(brixStr.substr(20, 5))\n\n      header.xExtent = parseInt(brixStr.substr(32, 5)) // NX\n      header.yExtent = parseInt(brixStr.substr(38, 5))\n      header.zExtent = parseInt(brixStr.substr(42, 5))\n\n      header.xRate = parseInt(brixStr.substr(52, 5)) // MX\n      header.yRate = parseInt(brixStr.substr(58, 5))\n      header.zRate = parseInt(brixStr.substr(62, 5))\n\n      header.xlen = parseFloat(brixStr.substr(73, 10)) * this.voxelSize\n      header.ylen = parseFloat(brixStr.substr(83, 10)) * this.voxelSize\n      header.zlen = parseFloat(brixStr.substr(93, 10)) * this.voxelSize\n\n      header.alpha = parseFloat(brixStr.substr(103, 10))\n      header.beta = parseFloat(brixStr.substr(113, 10))\n      header.gamma = parseFloat(brixStr.substr(123, 10))\n\n      divisor = parseFloat(brixStr.substr(138, 12)) / 100\n      summand = parseInt(brixStr.substr(155, 8))\n\n      header.sigma = parseFloat(brixStr.substr(170, 12)) * 100\n    } else {\n      // swap byte order when big endian\n      if (intView[ 18 ] !== 100) {\n        for (let i = 0, n = intView.length; i < n; ++i) {\n          const val = intView[ i ]\n          intView[ i ] = ((val & 0xff) << 8) | ((val >> 8) & 0xff)\n        }\n      }\n\n      header.xStart = intView[ 0 ] // NXSTART\n      header.yStart = intView[ 1 ]\n      header.zStart = intView[ 2 ]\n\n      header.xExtent = intView[ 3 ] // NX\n      header.yExtent = intView[ 4 ]\n      header.zExtent = intView[ 5 ]\n\n      header.xRate = intView[ 6 ] // MX\n      header.yRate = intView[ 7 ]\n      header.zRate = intView[ 8 ]\n\n      const factor = 1 / intView[ 17 ]\n      const scalingFactor = factor * this.voxelSize\n\n      header.xlen = intView[ 9 ] * scalingFactor\n      header.ylen = intView[ 10 ] * scalingFactor\n      header.zlen = intView[ 11 ] * scalingFactor\n\n      header.alpha = intView[ 12 ] * factor\n      header.beta = intView[ 13 ] * factor\n      header.gamma = intView[ 14 ] * factor\n\n      divisor = intView[ 15 ] / 100\n      summand = intView[ 16 ]\n      header.gamma = intView[ 14 ] * factor\n    }\n\n    v.header = header\n\n    if (Debug) Log.log(header, divisor, summand)\n\n    const data = new Float32Array(\n      header.xExtent * header.yExtent * header.zExtent\n    )\n\n    let offset = 512\n    const xBlocks = Math.ceil(header.xExtent / 8)\n    const yBlocks = Math.ceil(header.yExtent / 8)\n    const zBlocks = Math.ceil(header.zExtent / 8)\n\n    // loop over blocks\n    for (var zz = 0; zz < zBlocks; ++zz) {\n      for (var yy = 0; yy < yBlocks; ++yy) {\n        for (var xx = 0; xx < xBlocks; ++xx) {\n          // loop inside block\n          for (var k = 0; k < 8; ++k) {\n            var z = 8 * zz + k\n            for (var j = 0; j < 8; ++j) {\n              var y = 8 * yy + j\n              for (var i = 0; i < 8; ++i) {\n                var x = 8 * xx + i\n\n                // check if remaining slice-part contains data\n                if (x < header.xExtent && y < header.yExtent && z < header.zExtent) {\n                  var idx = ((((x * header.yExtent) + y) * header.zExtent) + z)\n                  data[ idx ] = (byteView[ offset ] - summand) / divisor\n                  ++offset\n                } else {\n                  offset += 8 - i\n                  break\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    v.setData(data, header.zExtent, header.yExtent, header.xExtent)\n    if (header.sigma) {\n      v.setStats(undefined, undefined, undefined, header.sigma)\n    }\n\n    if (Debug) Log.timeEnd('Dsn6Parser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h: Dsn6Header = this.volume.header\n\n    const basisX = [\n      h.xlen as number,\n      0,\n      0\n    ]\n\n    const basisY = [\n      h.ylen * Math.cos(Math.PI / 180.0 * h.gamma),\n      h.ylen * Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n\n    const basisZ = [\n      h.zlen * Math.cos(Math.PI / 180.0 * h.beta),\n      h.zlen * (\n        Math.cos(Math.PI / 180.0 * h.alpha) -\n        Math.cos(Math.PI / 180.0 * h.gamma) *\n        Math.cos(Math.PI / 180.0 * h.beta)\n      ) / Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n    basisZ[ 2 ] = Math.sqrt(\n      h.zlen * h.zlen * Math.sin(Math.PI / 180.0 * h.beta) *\n      Math.sin(Math.PI / 180.0 * h.beta) - basisZ[ 1 ] * basisZ[ 1 ]\n    )\n\n    const basis = [ [], basisX, basisY, basisZ ]\n    const nxyz = [ 0, h.xRate, h.yRate, h.zRate ]\n    const mapcrs = [ 0, 1, 2, 3 ]\n\n    const matrix = new Matrix4()\n\n    matrix.set(\n      basis[ mapcrs[1] ][0] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][0] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][0] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][1] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][1] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][1] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][2] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][2] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][2] / nxyz[ mapcrs[3] ],\n      0,\n      0, 0, 0, 1\n    )\n\n    matrix.multiply(\n      new Matrix4().makeRotationY(degToRad(90))\n    )\n\n    matrix.multiply(new Matrix4().makeTranslation(\n      -h.zStart, h.yStart, h.xStart\n    ))\n\n    matrix.multiply(new Matrix4().makeScale(\n      -1, 1, 1\n    ))\n\n    return matrix\n  }\n}\n\nParserRegistry.add('dsn6', Dsn6Parser)\nParserRegistry.add('brix', Dsn6Parser)\n\nexport default Dsn6Parser\n","/**\n * @file Dx Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { degToRad } from '../math/math-utils'\nimport VolumeParser from './volume-parser'\n\nconst reWhitespace = /\\s+/\n\ninterface DxHeader {\n  nx: number,\n  ny: number,\n  nz: number,\n  xmin: number,\n  ymin: number,\n  zmin: number,\n  hx: number,\n  hy: number,\n  hz: number\n}\n\nclass DxParser extends VolumeParser {\n  get type () { return 'dx' }\n\n  _parse () {\n    // http://apbs.readthedocs.io/en/latest/formats/opendx.html\n\n    if (Debug) Log.time('DxParser._parse ' + this.name)\n\n    const v = this.volume\n    const headerLines = this.streamer.peekLines(30)\n    const headerInfo = this.parseHeaderLines(headerLines)\n    const header = this.volume.header\n    const dataLineStart = headerInfo.dataLineStart\n\n    const size = header.nx * header.ny * header.nz\n    const data = new Float32Array(size)\n    let count = 0\n    let lineNo = 0\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string []) {\n      for (let i = _i; i < _n; ++i) {\n        if (count < size && lineNo > dataLineStart) {\n          const line = lines[ i ].trim()\n\n          if (line !== '') {\n            const ls = line.split(reWhitespace)\n\n            for (let j = 0, lj = ls.length; j < lj; ++j) {\n              data[ count ] = parseFloat(ls[ j ])\n              ++count\n            }\n          }\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    v.setData(data, header.nz, header.ny, header.nx)\n\n    if (Debug) Log.timeEnd('DxParser._parse ' + this.name)\n  }\n\n  parseHeaderLines (headerLines: string []) {\n    const header: Partial<DxHeader> = {}\n    const n = headerLines.length\n\n    let dataLineStart = 0\n    let headerByteCount = 0\n    let deltaLineCount = 0\n\n    for (let i = 0; i < n; ++i) {\n      let ls\n      const line = headerLines[ i ]\n\n      if (line.startsWith('object 1')) {\n        ls = line.split(reWhitespace)\n\n        header.nx = parseInt(ls[ 5 ])\n        header.ny = parseInt(ls[ 6 ])\n        header.nz = parseInt(ls[ 7 ])\n      } else if (line.startsWith('origin')) {\n        ls = line.split(reWhitespace)\n\n        header.xmin = parseFloat(ls[ 1 ])\n        header.ymin = parseFloat(ls[ 2 ])\n        header.zmin = parseFloat(ls[ 3 ])\n      } else if (line.startsWith('delta')) {\n        ls = line.split(reWhitespace)\n\n        if (deltaLineCount === 0) {\n          header.hx = parseFloat(ls[ 1 ]) * this.voxelSize\n        } else if (deltaLineCount === 1) {\n          header.hy = parseFloat(ls[ 2 ]) * this.voxelSize\n        } else if (deltaLineCount === 2) {\n          header.hz = parseFloat(ls[ 3 ]) * this.voxelSize\n        }\n\n        deltaLineCount += 1\n      } else if (line.startsWith('object 3')) {\n        dataLineStart = i\n        headerByteCount += line.length + 1\n        break\n      }\n\n      headerByteCount += line.length + 1\n    }\n\n    this.volume.header = header\n\n    return {\n      dataLineStart: dataLineStart,\n      headerByteCount: headerByteCount\n    }\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n    const matrix = new Matrix4()\n\n    matrix.multiply(\n      new Matrix4().makeRotationY(degToRad(90))\n    )\n\n    matrix.multiply(\n      new Matrix4().makeTranslation(\n        -h.zmin, h.ymin, h.xmin\n      )\n    )\n\n    matrix.multiply(\n      new Matrix4().makeScale(\n        -h.hz, h.hy, h.hx\n      )\n    )\n\n    return matrix\n  }\n}\n\nParserRegistry.add('dx', DxParser)\n\nexport default DxParser\n","/**\n * @file Dxbin Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { uint8ToLines, ensureBuffer } from '../utils'\nimport DxParser from './dx-parser'\n\nclass DxbinParser extends DxParser {\n  get type () { return 'dxbin' }\n  get isBinary () { return true }\n\n  _parse () {\n    // https://github.com/Electrostatics/apbs-pdb2pqr/issues/216\n\n    if (Debug) Log.time('DxbinParser._parse ' + this.name)\n\n    const bin = ensureBuffer(this.streamer.data)\n    const headerLines = uint8ToLines(new Uint8Array(bin, 0, 1000))\n    const headerInfo = this.parseHeaderLines(headerLines)\n    const header = this.volume.header\n    const headerByteCount = headerInfo.headerByteCount\n\n    const size = header.nx * header.ny * header.nz\n    const dv = new DataView(bin)\n    const data = new Float32Array(size)\n\n    for (let i = 0; i < size; ++i) {\n      data[ i ] = dv.getFloat64(i * 8 + headerByteCount, true)\n    }\n\n    this.volume.setData(data, header.nz, header.ny, header.nx)\n\n    if (Debug) Log.timeEnd('DxbinParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('dxbin', DxbinParser)\n\nexport default DxbinParser\n","/**\n * @file Mrc Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { ensureBuffer } from '../utils'\nimport VolumeParser from './volume-parser'\n\ninterface MrcHeader {\n  MAP: string,\n  MACHST: number [],\n  NX: number,\n  NY: number,\n  NZ: number,\n  MODE: number,\n  NXSTART: number,\n  NYSTART: number,\n  NZSTART: number,\n  MX: number,\n  MY: number,\n  MZ: number,\n  xlen: number,\n  ylen: number,\n  zlen: number,\n  alpha: number,\n  beta: number,\n  gamma: number,\n  MAPC: number,\n  MAPR: number,\n  MAPS: number,\n  DMIN: number,\n  DMAX: number,\n  DMEAN: number,\n  ISPG: number,\n  NSYMBT: number,\n  LSKFLG: number,\n  originX: number,\n  originY: number,\n  originZ: number,\n  ARMS: number\n}\n\nclass MrcParser extends VolumeParser {\n  get type () { return 'mrc' }\n  get isBinary () { return true }\n\n  _parse () {\n    // MRC\n    // http://ami.scripps.edu/software/mrctools/mrc_specification.php\n    // http://www2.mrc-lmb.cam.ac.uk/research/locally-developed-software/image-processing-software/#image\n    // http://bio3d.colorado.edu/imod/doc/mrc_format.txt\n\n    // CCP4 (MAP)\n    // http://www.ccp4.ac.uk/html/maplib.html\n\n    // MRC format does not use the skew transformation header records (words 25-37)\n    // CCP4 format does not use the ORIGIN header records (words 50-52)\n\n    if (Debug) Log.time('MrcParser._parse ' + this.name)\n\n    const v = this.volume\n    const header: Partial<MrcHeader> = {}\n\n    const bin = ensureBuffer(this.streamer.data)\n    const intView = new Int32Array(bin, 0, 56)\n    const floatView = new Float32Array(bin, 0, 56)\n    const dv = new DataView(bin)\n\n    // 53  MAP         Character string 'MAP ' to identify file type\n    header.MAP = String.fromCharCode(\n      dv.getUint8(52 * 4), dv.getUint8(52 * 4 + 1),\n      dv.getUint8(52 * 4 + 2), dv.getUint8(52 * 4 + 3)\n    )\n\n    // 54  MACHST      Machine stamp indicating machine type which wrote file\n    //                 17 and 17 for big-endian or 68 and 65 for little-endian\n    header.MACHST = [ dv.getUint8(53 * 4), dv.getUint8(53 * 4 + 1) ]\n\n    // swap byte order when big endian\n    if (header.MACHST[ 0 ] === 17 && header.MACHST[ 1 ] === 17) {\n      const n = bin.byteLength\n      for (let i = 0; i < n; i += 4) {\n        dv.setFloat32(i, dv.getFloat32(i), true)\n      }\n    }\n\n    header.NX = intView[ 0 ] // NC - columns (fastest changing)\n    header.NY = intView[ 1 ] // NR - rows\n    header.NZ = intView[ 2 ] // NS - sections (slowest changing)\n\n    // mode\n    //  0 image : signed 8-bit bytes range -128 to 127\n    //  1 image : 16-bit halfwords\n    //  2 image : 32-bit reals\n    //  3 transform : complex 16-bit integers\n    //  4 transform : complex 32-bit reals\n    //  6 image : unsigned 16-bit range 0 to 65535\n    // 16 image: unsigned char * 3 (for rgb data, non-standard)\n    //\n    // Note: Mode 2 is the normal mode used in the CCP4 programs.\n    //       Other modes than 2 and 0 may NOT WORK\n    header.MODE = intView[ 3 ]\n\n    // start\n    header.NXSTART = intView[ 4 ] // NCSTART - first column\n    header.NYSTART = intView[ 5 ] // NRSTART - first row\n    header.NZSTART = intView[ 6 ] // NSSTART - first section\n\n    // intervals\n    header.MX = intView[ 7 ] // intervals along x\n    header.MY = intView[ 8 ] // intervals along y\n    header.MZ = intView[ 9 ] // intervals along z\n\n    // cell length (Angstroms in CCP4)\n    header.xlen = floatView[ 10 ] * this.voxelSize\n    header.ylen = floatView[ 11 ] * this.voxelSize\n    header.zlen = floatView[ 12 ] * this.voxelSize\n\n    // cell angle (Degrees)\n    header.alpha = floatView[ 13 ]\n    header.beta = floatView[ 14 ]\n    header.gamma = floatView[ 15 ]\n\n    // axis correspondence (1,2,3 for X,Y,Z)\n    header.MAPC = intView[ 16 ] // column\n    header.MAPR = intView[ 17 ] // row\n    header.MAPS = intView[ 18 ] // section\n\n    // density statistics\n    header.DMIN = floatView[ 19 ]\n    header.DMAX = floatView[ 20 ]\n    header.DMEAN = floatView[ 21 ]\n\n    // space group number 0 or 1 (default=0)\n    header.ISPG = intView[ 22 ]\n\n    // number of bytes used for symmetry data (0 or 80)\n    header.NSYMBT = intView[ 23 ]\n\n    // Flag for skew transformation, =0 none, =1 if foll\n    header.LSKFLG = intView[ 24 ]\n\n    // 26-34  SKWMAT  Skew matrix S (in order S11, S12, S13, S21 etc) if\n    //                LSKFLG .ne. 0.\n    // 35-37  SKWTRN  Skew translation t if LSKFLG != 0.\n    //                Skew transformation is from standard orthogonal\n    //                coordinate frame (as used for atoms) to orthogonal\n    //                map frame, as Xo(map) = S * (Xo(atoms) - t)\n\n    // 38      future use       (some of these are used by the MSUBSX routines\n    //  .          \"              in MAPBRICK, MAPCONT and FRODO)\n    //  .          \"   (all set to zero by default)\n    //  .          \"\n    // 52          \"\n\n    // 50-52 origin in X,Y,Z used for transforms\n    header.originX = floatView[ 49 ]\n    header.originY = floatView[ 50 ]\n    header.originZ = floatView[ 51 ]\n\n    // 53  MAP         Character string 'MAP ' to identify file type\n    // => see top of this parser\n\n    // 54  MACHST      Machine stamp indicating machine type which wrote file\n    // => see top of this parser\n\n    // Rms deviation of map from mean density\n    header.ARMS = floatView[ 54 ]\n\n    // 56      NLABL           Number of labels being used\n    // 57-256  LABEL(20,10)    10  80 character text labels (ie. A4 format)\n\n    v.header = header\n\n    // Log.log( header );\n\n    let data\n    if (header.MODE === 2) {\n      data = new Float32Array(\n        bin, 256 * 4 + header.NSYMBT,\n        header.NX * header.NY * header.NZ\n      )\n    } else if (header.MODE === 0) {\n      data = new Float32Array(new Int8Array(\n        bin, 256 * 4 + header.NSYMBT,\n        header.NX * header.NY * header.NZ\n      ))\n\n      // based on uglymol (https://github.com/uglymol/uglymol) by Marcin Wojdyr (wojdyr)\n      // if the file was converted by mapmode2to0 - scale the data\n      if (intView[ 39 ] === -128 && intView[ 40 ] === 127) {\n        // scaling f(x)=b1*x+b0 such that f(-128)=min and f(127)=max\n        const b1 = (header.DMAX - header.DMIN) / 255.0\n        const b0 = 0.5 * (header.DMIN + header.DMAX + b1)\n        for (let j = 0, jl = data.length; j < jl; ++j) {\n          data[ j ] = b1 * data[ j ] + b0\n        }\n      }\n    } else {\n      Log.error('MrcParser unknown mode', header.MODE)\n    }\n\n    v.setData(data, header.NX, header.NY, header.NZ)\n    if (header.ARMS !== 0) {\n      v.setStats(header.DMIN, header.DMAX, header.DMEAN, header.ARMS)\n    }\n\n    if (Debug) Log.timeEnd('MrcParser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n\n    const basisX = [\n      h.xlen,\n      0,\n      0\n    ]\n\n    const basisY = [\n      h.ylen * Math.cos(Math.PI / 180.0 * h.gamma),\n      h.ylen * Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n\n    const basisZ = [\n      h.zlen * Math.cos(Math.PI / 180.0 * h.beta),\n      h.zlen * (\n        Math.cos(Math.PI / 180.0 * h.alpha) -\n        Math.cos(Math.PI / 180.0 * h.gamma) *\n        Math.cos(Math.PI / 180.0 * h.beta)\n      ) / Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n    basisZ[ 2 ] = Math.sqrt(\n      h.zlen * h.zlen * Math.sin(Math.PI / 180.0 * h.beta) *\n      Math.sin(Math.PI / 180.0 * h.beta) - basisZ[ 1 ] * basisZ[ 1 ]\n    )\n\n    const basis = [ [], basisX, basisY, basisZ ]\n    const nxyz = [ 0, h.MX, h.MY, h.MZ ]\n    const mapcrs = [ 0, h.MAPC, h.MAPR, h.MAPS ]\n\n    const matrix = new Matrix4()\n\n    matrix.set(\n      basis[ mapcrs[1] ][0] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][0] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][0] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][1] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][1] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][1] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][2] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][2] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][2] / nxyz[ mapcrs[3] ],\n      0,\n      0, 0, 0, 1\n    )\n\n    matrix.setPosition(new Vector3(\n      h.originX, h.originY, h.originZ\n    ))\n\n    matrix.multiply(new Matrix4().makeTranslation(\n      h.NXSTART, h.NYSTART, h.NZSTART\n    ))\n\n    return matrix\n  }\n}\n\nParserRegistry.add('mrc', MrcParser)\nParserRegistry.add('ccp4', MrcParser)\nParserRegistry.add('map', MrcParser)\n\nexport default MrcParser\n","/**\n * @file Xplor Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Matrix4 } from 'three'\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport VolumeParser from './volume-parser'\n\nconst reWhitespace = /\\s+/\n\nfunction parseNumberLine (line: string) {\n  return line.trim().split(reWhitespace).map(parseFloat)\n}\n\ninterface XplorHeader {\n  NA: number,\n  AMIN: number,\n  AMAX: number,\n  NB: number,\n  BMIN: number,\n  BMAX: number,\n  NC: number,\n  CMIN: number,\n  CMAX: number,\n  a: number,\n  b: number,\n  c: number,\n  alpha: number,\n  beta: number,\n  gamma: number,\n  RAVE: number,\n  RSIGMA: number\n}\n\nclass XplorParser extends VolumeParser {\n  get type () { return 'xplor' }\n\n  _parse () {\n    // http://hincklab.uthscsa.edu/html/soft_packs/msi_docs/insight980/xplor/formats.html\n    // http://www.mrc-lmb.cam.ac.uk/public/xtal/doc/cns/cns_1.3/tutorial/formats/maps/text.html\n\n    if (Debug) Log.time('XplorParser._parse ' + this.name)\n\n    const v = this.volume\n    const headerLines = this.streamer.peekLines(8)\n    const header: Partial<XplorHeader> = {}\n\n    let infoStart\n    if (headerLines[ 2 ].startsWith('REMARKS')) {\n      infoStart = parseInt(headerLines[ 1 ].substring(0, 8)) + 2\n    } else {\n      infoStart = 5\n    }\n    const dataStart = infoStart + 3\n\n    const gridInfo = parseNumberLine(headerLines[ infoStart ])\n    header.NA = gridInfo[ 0 ]\n    header.AMIN = gridInfo[ 1 ]\n    header.AMAX = gridInfo[ 2 ]\n    header.NB = gridInfo[ 3 ]\n    header.BMIN = gridInfo[ 4 ]\n    header.BMAX = gridInfo[ 5 ]\n    header.NC = gridInfo[ 6 ]\n    header.CMIN = gridInfo[ 7 ]\n    header.CMAX = gridInfo[ 8 ]\n\n    const cellInfo = parseNumberLine(headerLines[ infoStart + 1 ])\n    header.a = cellInfo[ 0 ] * this.voxelSize\n    header.b = cellInfo[ 1 ] * this.voxelSize\n    header.c = cellInfo[ 2 ] * this.voxelSize\n    header.alpha = cellInfo[ 3 ]\n    header.beta = cellInfo[ 4 ]\n    header.gamma = cellInfo[ 5 ]\n\n    const na = header.AMAX - header.AMIN + 1\n    const nb = header.BMAX - header.BMIN + 1\n    const nc = header.CMAX - header.CMIN + 1\n    const n = na * nb * nc\n\n    const data = new Float32Array(n)\n    const lineSection = Math.ceil(1 + (na * nb) / 6)\n    let count = 0\n    let lineNo = 0\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n\n        if (lineNo >= dataStart && (lineNo - dataStart) % lineSection !== 0 && count < n) {\n          for (let j = 0, lj = 6; j < lj; ++j) {\n            const value = parseFloat(line.substr(12 * j, 12))\n            if (isNaN(value)) { break } // Last line of map section\n            data[count++] = value\n          }\n        } else if (count === n) {\n          const lt = line.trim()\n          if (lt && lt !== '-9999') {\n            const ls = parseNumberLine(line)\n            header.RAVE = ls[0]\n            header.RSIGMA = ls[1]\n          }\n        }\n\n        ++lineNo\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    v.header = header\n    v.setData(data, na, nb, nc)\n    if (header.RAVE !== 0 && header.RSIGMA !== 1) {\n      v.setStats(undefined, undefined, header.RAVE, header.RSIGMA)\n    }\n\n    if (Debug) Log.timeEnd('XplorParser._parse ' + this.name)\n  }\n\n  getMatrix () {\n    const h = this.volume.header\n\n    const basisX = [\n      h.a,\n      0,\n      0\n    ]\n\n    const basisY = [\n      h.b * Math.cos(Math.PI / 180.0 * h.gamma),\n      h.b * Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n\n    const basisZ = [\n      h.c * Math.cos(Math.PI / 180.0 * h.beta),\n      h.c * (\n        Math.cos(Math.PI / 180.0 * h.alpha) -\n        Math.cos(Math.PI / 180.0 * h.gamma) *\n        Math.cos(Math.PI / 180.0 * h.beta)\n      ) / Math.sin(Math.PI / 180.0 * h.gamma),\n      0\n    ]\n    basisZ[ 2 ] = Math.sqrt(\n      h.c * h.c * Math.sin(Math.PI / 180.0 * h.beta) *\n      Math.sin(Math.PI / 180.0 * h.beta) - basisZ[ 1 ] * basisZ[ 1 ]\n    )\n\n    const basis = [ [], basisX, basisY, basisZ ]\n    const nxyz = [ 0, h.NA, h.NB, h.NC ]\n    const mapcrs = [ 0, 1, 2, 3 ]\n\n    const matrix = new Matrix4()\n\n    matrix.set(\n      basis[ mapcrs[1] ][0] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][0] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][0] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][1] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][1] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][1] / nxyz[ mapcrs[3] ],\n      0,\n      basis[ mapcrs[1] ][2] / nxyz[ mapcrs[1] ],\n      basis[ mapcrs[2] ][2] / nxyz[ mapcrs[2] ],\n      basis[ mapcrs[3] ][2] / nxyz[ mapcrs[3] ],\n      0,\n      0, 0, 0, 1\n    )\n\n    matrix.multiply(new Matrix4().makeTranslation(\n      h.AMIN, h.BMIN, h.CMIN\n    ))\n\n    return matrix\n  }\n}\n\nParserRegistry.add('xplor', XplorParser)\nParserRegistry.add('cns', XplorParser)\n\nexport default XplorParser\n","/**\n * @file Kin Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { Vector3 } from 'three'\nimport Parser from './parser'\n\nfunction hsvToRgb (h: number, s: number, v: number) {\n  h /= 360\n  s /= 100\n  v /= 100\n  let r, g, b\n  const i = Math.floor(h * 6)\n  const f = h * 6 - i\n  const p = v * (1 - s)\n  const q = v * (1 - f * s)\n  const t = v * (1 - (1 - f) * s)\n  switch (i % 6) {\n    case 0: r = v; g = t; b = p; break\n    case 1: r = q; g = v; b = p; break\n    case 2: r = p; g = v; b = t; break\n    case 3: r = p; g = q; b = v; break\n    case 4: r = t; g = p; b = v; break\n    case 5: r = v; g = p; b = q; break\n  }\n  return [ r, g, b ] as number []\n}\n\nconst ColorDict: {[k: string]: number[]} = {\n  red: hsvToRgb(0, 100, 100),\n  orange: hsvToRgb(20, 100, 100),\n  gold: hsvToRgb(40, 100, 100),\n  yellow: hsvToRgb(60, 100, 100),\n  lime: hsvToRgb(80, 100, 100),\n  green: hsvToRgb(120, 80, 100),\n  sea: hsvToRgb(150, 100, 100),\n  cyan: hsvToRgb(180, 100, 85),\n  sky: hsvToRgb(210, 75, 95),\n  blue: hsvToRgb(240, 70, 100),\n  purple: hsvToRgb(275, 75, 100),\n  magenta: hsvToRgb(300, 95, 100),\n  hotpink: hsvToRgb(335, 100, 100),\n  pink: hsvToRgb(350, 55, 100),\n  peach: hsvToRgb(25, 75, 100),\n  lilac: hsvToRgb(275, 55, 100),\n  pinktint: hsvToRgb(340, 30, 100),\n  peachtint: hsvToRgb(25, 50, 100),\n  yellowtint: hsvToRgb(60, 50, 100),\n  greentint: hsvToRgb(135, 40, 100),\n  bluetint: hsvToRgb(220, 40, 100),\n  lilactint: hsvToRgb(275, 35, 100),\n  white: hsvToRgb(0, 0, 100),\n  gray: hsvToRgb(0, 0, 50),\n  brown: hsvToRgb(20, 45, 75),\n  deadwhite: [ 1, 1, 1 ],\n  deadblack: [ 0, 0, 0 ],\n  invisible: [ 0, 0, 0 ]\n}\n\nconst reWhitespaceComma = /[\\s,]+/\nconst reCurlyWhitespace = /[^{}\\s]*{[^{}]+}|[^{}\\s]+/g\nconst reTrimCurly = /^{+|}+$/g\nconst reTrimQuotes = /^['\"]+|['\"]+$/g\nconst reCollapseEqual = /\\s*=\\s*/g\n\nfunction parseListDef (line: string) {\n  let name\n  let defaultColor\n  let master = []\n  let width\n\n  line = line.replace(reCollapseEqual, '=')\n\n  const lm = line.match(reCurlyWhitespace) as RegExpMatchArray\n  for (let j = 1; j < lm.length; ++j) {\n    const e = lm[ j ]\n    if (e[ 0 ] === '{') {\n      name = e.substring(1, e.length - 1)\n    } else {\n      const es = e.split('=')\n      if (es.length === 2) {\n        if (es[ 0 ] === 'color') {\n          defaultColor = ColorDict[ es[ 1 ] ]\n        } else if (es[ 0 ] === 'width') {\n          width = parseInt(es[ 1 ])\n        } else if (es[ 0 ] === 'master') {\n          master.push(es[ 1 ].replace(reTrimCurly, ''))\n        }\n      }\n    }\n  }\n\n  return {\n    listName: name,\n    listColor: defaultColor,\n    listMasters: master,\n    listWidth: width\n  }\n}\n\nfunction parseListElm (line: string) {\n  line = line.trim()\n\n  const idx1 = line.indexOf('{')\n  const idx2 = line.indexOf('}')\n  const ls = line.substr(idx2 + 1).split(reWhitespaceComma)\n\n  const label = line.substr(idx1 + 1, idx2 - 1)\n  const position = [\n    parseFloat(ls[ ls.length - 3 ]),\n    parseFloat(ls[ ls.length - 2 ]),\n    parseFloat(ls[ ls.length - 1 ])\n  ]\n  let color, width, radius\n  let lineBreak = false\n  let triangleBreak = false\n  for (let lsindex = 4; lsindex <= ls.length; lsindex++) {\n    const literal = ls[ ls.length - lsindex ]\n    if (literal in ColorDict) {\n      color = ColorDict[ ls[ ls.length - lsindex ] ]\n    }\n    if (literal.startsWith('width')) {\n      width = parseInt(literal.substring(5))\n    }\n    if (literal.startsWith('r=')) {\n      radius = parseFloat(literal.split('=')[1])\n    }\n    if (literal.startsWith('P')) {\n      lineBreak = true\n    }\n    if (literal.startsWith('X')) {\n      triangleBreak = true\n    }\n  }\n  // const color = line[ idx2 + 1 ] === ' ' ? undefined : ColorDict[ ls[ 0 ] ]\n\n  return {\n    label: label,\n    position: position,\n    color: color,\n    radius: radius,\n    width: width,\n    isLineBreak: lineBreak,\n    isTriangleBreak: triangleBreak\n  }\n}\n\nfunction parseStr (line: string) {\n  const start = line.indexOf('{')\n  const end = line.indexOf('}')\n  return line.substring(\n    start !== -1 ? start + 1 : 0,\n    end !== -1 ? end : undefined\n  ).trim()\n}\n\nfunction parseFlag (line: string) {\n  const end = line.indexOf('}')\n  return end === -1 ? undefined : line.substr(end + 1).trim()\n}\n\nfunction parseGroup (line: string) {\n  let name:string = ''\n  let master:string[] = []\n  let flags: {[k: string]: string|boolean} = {}\n\n  line = line.replace(reCollapseEqual, '=')\n\n  const lm = line.match(reCurlyWhitespace)  as RegExpMatchArray\n  for (let j = 1; j < lm.length; ++j) {\n    const e = lm[ j ]\n    if (e[ 0 ] === '{') {\n      name = e.substring(1, e.length - 1)\n    } else {\n      const es = e.split('=')\n      if (es.length === 2) {\n        if (es[ 0 ] === 'master') {\n          master.push(es[ 1 ].replace(reTrimCurly, ''))\n        } else {\n          flags[ es[ 0 ] ] = es[ 1 ].replace(reTrimCurly, '')\n        }\n      } else {\n        flags[ es[ 0 ] ] = true\n      }\n    }\n  }\n\n  return { groupName: name,\n           groupFlags: flags,\n           groupMasters: master\n  }\n}\ninterface RibbonObject {\n  labelArray: string[],\n  positionArray: number[],\n  breakArray: boolean[],\n  colorArray: number[],\n  name?: string,\n  masterArray: any[]\n}\nfunction convertKinTriangleArrays (ribbonObject: RibbonObject) {\n  // have to convert ribbons/triangle lists from stripdrawmode to normal drawmode\n  // index                    [ 0 1 2 3 4 5 6 7 8 91011 ]\n  // label [ 0 1 2 3 4 5 ] to [ 0 1 2 1 2 3 2 3 4 3 4 5 ]\n  // convertedindex                                      [ 0 1 2 3 4 5 6 7 8 91011121314151617181920212223242526 ]\n  // index          [ 0 1 2 3 4 5 6 7 8 91011121314 ]    [ 0 1 2 3 4 5 6 7 8 3 4 5 6 7 8 91011 6 7 8 91011121314 ]\n  // position/color [ 0 0 0 1 1 1 2 2 2 3 3 3 4 4 4 ] to [ 0 0 0 1 1 1 2 2 2 1 1 1 2 2 2 3 3 3 2 2 2 3 3 3 4 4 4 ]\n  let { labelArray, positionArray, colorArray, breakArray } = ribbonObject\n  let convertedLabels = []\n  for (let i = 0; i < (labelArray.length - 2) * 3; ++i) {\n    convertedLabels[i] = labelArray[i - Math.floor(i / 3) * 2]\n  }\n  let convertedBreaks = []\n  for (let i = 0; i < (breakArray.length - 2) * 3; ++i) {\n    convertedBreaks[i] = breakArray[i - Math.floor(i / 3) * 2]\n  }\n  let convertedPositions = []\n  for (let i = 0; i < (positionArray.length / 3 - 2) * 9; ++i) {\n    convertedPositions[i] = positionArray[i - Math.floor(i / 9) * 6]\n  }\n  let convertedColors = []\n  for (let i = 0; i < (colorArray.length / 3 - 2) * 9; ++i) {\n    convertedColors[i] = colorArray[i - Math.floor(i / 9) * 6]\n  }\n  let vector3Positions = []\n  for (let i = 0; i < (convertedPositions.length) / 3; ++i) {\n    vector3Positions.push(new Vector3(convertedPositions[i * 3], convertedPositions[i * 3] + 1, convertedPositions[i * 3] + 2))\n  }\n  //let normals = []\n  //for (let i = 0; i < vector3Positions.length - 1; ++i) {\n  //  let normalVec3 = vector3Positions[i].cross(vector3Positions[i + 1])\n  //  normals.push(normalVec3.x)\n  //  normals.push(normalVec3.y)\n  //  normals.push(normalVec3.z)\n  //}\n  return {\n    name: ribbonObject.name,\n    masterArray: ribbonObject.masterArray,\n    labelArray: convertedLabels,\n    positionArray: convertedPositions,\n    breakArray: convertedBreaks,\n    colorArray: convertedColors\n  }\n}\n\nfunction removePointBreaksTriangleArrays (convertedRibbonObject: RibbonObject) {\n  // after converting ribbon/triangle arrys to drawmode, removed point break triangles\n  // label [ 0 1 2 3 4 5 ] to [ 0 1 2 1 2 3 2 3 4 3 4 5 ]\n  // position/color [ 0 0 0 1 1 1 2 2 2 3 3 3 4 4 4 ] to [ 0 0 0 1 1 1 2 2 2 1 1 1 2 2 2 3 3 3 2 2 2 3 3 3 4 4 4 ]\n  let { labelArray, positionArray, colorArray, breakArray } = convertedRibbonObject\n  let editedLabels = []\n  let editedPositions = []\n  let editedColors = []\n  let editedBreaks = []\n  for (let i = 0; i < breakArray.length / 3; i++) {\n    let breakPointer = i * 3\n    let positionPointer = i * 9\n    if (!breakArray[breakPointer+1]&&!breakArray[breakPointer+2]) {\n      editedLabels.push(labelArray[breakPointer])\n      editedLabels.push(labelArray[breakPointer+1])\n      editedLabels.push(labelArray[breakPointer+2])\n      editedBreaks.push(breakArray[breakPointer])\n      editedBreaks.push(breakArray[breakPointer+1])\n      editedBreaks.push(breakArray[breakPointer+2])\n      editedPositions.push(positionArray[positionPointer])\n      editedPositions.push(positionArray[positionPointer+1])\n      editedPositions.push(positionArray[positionPointer+2])\n      editedPositions.push(positionArray[positionPointer+3])\n      editedPositions.push(positionArray[positionPointer+4])\n      editedPositions.push(positionArray[positionPointer+5])\n      editedPositions.push(positionArray[positionPointer+6])\n      editedPositions.push(positionArray[positionPointer+7])\n      editedPositions.push(positionArray[positionPointer+8])\n      editedColors.push(colorArray[positionPointer])\n      editedColors.push(colorArray[positionPointer+1])\n      editedColors.push(colorArray[positionPointer+2])\n      editedColors.push(colorArray[positionPointer+3])\n      editedColors.push(colorArray[positionPointer+4])\n      editedColors.push(colorArray[positionPointer+5])\n      editedColors.push(colorArray[positionPointer+6])\n      editedColors.push(colorArray[positionPointer+7])\n      editedColors.push(colorArray[positionPointer+8])\n    } else {\n      //console.log('X triangle break found')\n      //console.log('skipping: '+positionArray[positionPointer]+','+positionArray[positionPointer+1]+','+positionArray[positionPointer+2]+','\n      //                        +positionArray[positionPointer+3]+','+positionArray[positionPointer+4]+','+positionArray[positionPointer+5]+','\n      //                        +positionArray[positionPointer+6]+','+positionArray[positionPointer+7]+','+positionArray[positionPointer+8])\n    }\n  }\n  return {\n    name: convertedRibbonObject.name,\n    masterArray: convertedRibbonObject.masterArray,\n    labelArray: editedLabels,\n    positionArray: editedPositions,\n    breakArray: editedBreaks,\n    colorArray: editedColors\n  }\n}\n\ninterface Kinemage {\n  kinemage?: number,\n  onewidth?: any,\n  '1viewid'?: string,\n  pdbfile?: string,\n  text: string,\n  texts: string[],\n  captions: string[],\n  caption: string,\n  groupDict: {[k:string]: {[k:string]: boolean}},\n  subgroupDict: {[k: string]: any},\n  masterDict: {[k:string]: {indent: boolean, visible: boolean}},\n  pointmasterDict: {[k: string]: any},\n  dotLists: DotList[],\n  vectorLists: VectorList[],\n  ballLists: any[],\n  ribbonLists: RibbonObject[]\n}\n\ninterface DotList {\n  name?: string,\n  masterArray: any[],\n  labelArray: any[],\n  positionArray: any[],\n  colorArray: any[]\n}\n\ninterface VectorList {\n  name?: string,\n  masterArray: any[],\n  label1Array: string[],\n  label2Array: string[],\n  position1Array: number[],\n  position2Array: number[],\n  color1Array: number[],\n  color2Array: number[],\n  width: number[]\n}\n\nclass KinParser extends Parser {\n  kinemage: Kinemage\n  get type () { return 'kin' }\n  get __objName () { return 'kinemage' }\n\n  _parse () {\n    // http://kinemage.biochem.duke.edu/software/king.php\n\n    if (Debug) Log.time(`KinParser._parse ${this.name}`)\n\n    const kinemage: Kinemage = {\n      kinemage: undefined,\n      onewidth: undefined,\n      '1viewid': undefined,\n      pdbfile: undefined,\n      texts: [],\n      text: '',\n      captions: [],\n      caption: '',\n      groupDict: {},\n      subgroupDict: {},\n      masterDict: {},\n      pointmasterDict: {},\n      dotLists: [],\n      vectorLists: [],\n      ballLists: [],\n      ribbonLists: []\n    }\n    this.kinemage = kinemage\n\n    let currentGroupMasters: string[]\n    let currentSubgroupMasters: string[]\n\n    let isDotList = false\n    let prevDotLabel = ''\n    let dotDefaultColor: number[]\n    let dotLabel: string[], dotPosition: number[], dotColor: number[]\n\n    let isVectorList = false\n    let prevVecLabel = ''\n    let prevVecPosition: number[]|null = null\n    let prevVecColor: number[]|null = null\n    let vecDefaultColor: number[], vecDefaultWidth: number[]\n    let vecLabel1: string[], vecLabel2: string[], vecPosition1: number[], vecPosition2: number[], vecColor1: number[], vecColor2: number[]\n\n    let isBallList = false\n    let prevBallLabel = ''\n    let ballRadius: number[], ballDefaultColor: number[]\n    let ballLabel: string[], ballPosition: number[], ballColor: number[]\n\n    let isRibbonList = false\n    let prevRibbonPointLabel = ''\n\n    let ribbonListDefaultColor: number[]\n    let ribbonPointLabelArray: string[], ribbonPointPositionArray: number[], ribbonPointBreakArray: boolean[], ribbonPointColorArray: number[]\n\n    let isText = false\n    let isCaption = false\n\n    // @vectorlist {mc} color= white  master= {mainchain}\n    // { n   thr A   1  B13.79 1crnFH} P 17.047, 14.099, 3.625 { n   thr A   1  B13.79 1crnFH} L 17.047, 14.099, 3.625\n\n    // @dotlist {x} color=white master={vdw contact} master={dots}\n    // { CB  THR   1  A}sky  'P' 18.915,14.199,5.024\n\n    function _parseChunkOfLines (_i: number, _n: number, lines: string[]) {\n      for (let i = _i; i < _n; ++i) {\n        const line = lines[ i ]\n\n        if (line[ 0 ] === '@') {\n          isDotList = false\n          isVectorList = false\n          isBallList = false\n          isRibbonList = false\n          isText = false\n          isCaption = false\n        }\n\n        if (!line) {\n          isDotList = false\n          isVectorList = false\n          isBallList = false\n          isRibbonList = false\n        } else if (line.startsWith('@dotlist')) {\n          // @dotlist {x} color=white master={vdw contact} master={dots}\n\n          let { listColor, listName, listMasters } = parseListDef(line)\n\n          isDotList = true\n          prevDotLabel = ''\n          dotLabel = []\n          dotPosition = []\n          dotColor = []\n          dotDefaultColor = listColor as number[]\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.dotLists.push({\n            name: listName,\n            masterArray: listMasters,\n            labelArray: dotLabel,\n            positionArray: dotPosition,\n            colorArray: dotColor\n          })\n        } else if (line.startsWith('@vectorlist')) {\n          // @vectorlist {x} color=white master={small overlap} master={dots}\n\n          let { listMasters, listName, listWidth, listColor } = parseListDef(line)\n\n          if (listMasters) {\n            listMasters.forEach(function (name: string) {\n              if (!kinemage.masterDict[ name ]) {\n                kinemage.masterDict[ name ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          isVectorList = true\n          prevVecLabel = ''\n          prevVecPosition = null\n          prevVecColor = null\n          vecLabel1 = []\n          vecLabel2 = []\n          vecPosition1 = []\n          vecPosition2 = []\n          vecColor1 = []\n          vecColor2 = []\n          vecDefaultColor = listColor as number[]\n          vecDefaultWidth = []\n          if (listWidth) {\n            vecDefaultWidth.push(listWidth)\n          }\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.vectorLists.push({\n            name: listName,\n            masterArray: listMasters,\n            label1Array: vecLabel1,\n            label2Array: vecLabel2,\n            position1Array: vecPosition1,\n            position2Array: vecPosition2,\n            color1Array: vecColor1,\n            color2Array: vecColor2,\n            width: vecDefaultWidth\n          })\n        } else if (line.startsWith('@balllist')) {\n          let { listName, listColor, listMasters } = parseListDef(line)\n\n          if (listMasters) {\n            listMasters.forEach(function (name: string) {\n              if (!kinemage.masterDict[ name ]) {\n                kinemage.masterDict[ name ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          isBallList = true\n\n          prevBallLabel = ''\n          ballLabel = []\n          ballRadius = []\n          ballPosition = []\n          ballColor = []\n          ballDefaultColor = listColor as number[]\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.ballLists.push({\n            name: listName,\n            masterArray: listMasters,\n            labelArray: ballLabel,\n            radiusArray: ballRadius,\n            positionArray: ballPosition,\n            colorArray: ballColor\n          })\n        } else if (line.startsWith('@ribbonlist')||line.startsWith('@trianglelist')) {\n          let { listMasters, listName, listColor } = parseListDef(line)\n\n          if (listMasters) {\n            listMasters.forEach(function (name: string) {\n              if (!kinemage.masterDict[ name ]) {\n                kinemage.masterDict[ name ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n          isRibbonList = true\n          prevRibbonPointLabel = ''\n          ribbonPointLabelArray = []\n          ribbonPointPositionArray = []\n          ribbonPointBreakArray = []\n          ribbonPointColorArray = []\n          ribbonListDefaultColor = listColor as number[]\n\n          if (currentGroupMasters) {\n            listMasters = listMasters.concat(currentGroupMasters)\n          }\n          if (currentSubgroupMasters) {\n            listMasters = listMasters.concat(currentSubgroupMasters)\n          }\n\n          kinemage.ribbonLists.push({\n            name: listName,\n            masterArray: listMasters,\n            labelArray: ribbonPointLabelArray,\n            positionArray: ribbonPointPositionArray,\n            breakArray: ribbonPointBreakArray,\n            colorArray: ribbonPointColorArray\n          })\n        } else if (line.startsWith('@text')) {\n          isText = true\n          kinemage.texts.push(line.substr(5))\n        } else if (line.startsWith('@caption')) {\n          isCaption = true\n          kinemage.captions.push(line.substr(8))\n        } else if (isDotList) {\n          // { CB  THR   1  A}sky  'P' 18.915,14.199,5.024\n\n          let { label, color, position } = parseListElm(line)\n\n          if (label === '\"') {\n            label = prevDotLabel\n          } else {\n            prevDotLabel = label\n          }\n\n          if (color === undefined) {\n            color = dotDefaultColor\n          }\n\n          dotLabel.push(label)\n          dotPosition.push(...position)\n          dotColor.push(...color)\n        } else if (isVectorList) {\n          // { n   thr A   1  B13.79 1crnFH} P 17.047, 14.099, 3.625 { n   thr A   1  B13.79 1crnFH} L 17.047, 14.099, 3.625\n\n          let doubleLine = line.replace(/(?!^){/g, '\\n{')\n          let splitLine = doubleLine.split(/\\n/)\n\n          for (var i2 = 0; i2 < splitLine.length; i2++) {\n            let singlePointLine = splitLine[i2]\n            let { label, color, width, position, isLineBreak } = parseListElm(singlePointLine)\n\n            if (label === '\"') {\n              label = prevVecLabel\n            } else {\n              prevVecLabel = label\n            }\n\n            if (color === undefined) {\n              color = vecDefaultColor\n            }\n\n            if (!isLineBreak) {\n              if (prevVecPosition !== null) {\n                if (width) {\n                  vecDefaultWidth.push(width)\n                }\n\n                vecLabel1.push(prevVecLabel)\n                vecPosition1.push(...prevVecPosition)\n                vecColor1.push(...prevVecColor as number[])\n\n                vecLabel2.push(label)\n                vecPosition2.push(...position)\n                vecColor2.push(...color)\n\n              }\n            }\n\n            prevVecLabel = label\n            prevVecPosition = position\n            prevVecColor = color\n          }\n        } else if (isBallList) {\n          // {cb arg A   1   1.431 -106.80} r=1.431  39.085, 8.083, 22.182\n\n          let { label, radius, color, position } = parseListElm(line)\n\n          if (label === '\"') {\n            label = prevBallLabel\n          } else {\n            prevBallLabel = label\n          }\n\n          if (radius === undefined) {\n            radius = 1 // temporary default radius\n          }\n\n          if (color === undefined) {\n            color = ballDefaultColor\n          }\n\n          ballLabel.push(label)\n          ballRadius.push(radius)\n          ballPosition.push(...position)\n          ballColor.push(...color)\n        } else if (isRibbonList) {\n          let { label, color, position, isTriangleBreak } = parseListElm(line)\n\n          if (label === '\"') {\n            label = prevRibbonPointLabel\n          } else {\n            prevRibbonPointLabel = label\n          }\n\n          if (color === undefined) {\n            color = ribbonListDefaultColor\n          }\n\n          ribbonPointLabelArray.push(label)\n          ribbonPointPositionArray.push(...position)\n          ribbonPointBreakArray.push(isTriangleBreak)\n          ribbonPointColorArray.push(...color)\n        } else if (isText) {\n          kinemage.texts.push(line)\n        } else if (isCaption) {\n          kinemage.captions.push(line)\n        } else if (line.startsWith('@kinemage')) {\n          kinemage.kinemage = parseInt(line.substr(9).trim())\n        } else if (line.startsWith('@onewidth')) {\n          kinemage.onewidth = true\n        } else if (line.startsWith('@1viewid')) {\n          kinemage[ '1viewid' ] = parseStr(line)\n        } else if (line.startsWith('@pdbfile')) {\n          kinemage.pdbfile = parseStr(line)\n        } else if (line.startsWith('@group')) {\n          let { groupName, groupFlags, groupMasters } = parseGroup(line)\n          if (!kinemage.groupDict[ groupName as string ]) {\n            kinemage.groupDict[ groupName as string ] = {\n              dominant: false,\n              animate: false\n            }\n            currentGroupMasters = groupMasters\n          }\n\n          if (currentGroupMasters) {\n            currentGroupMasters.forEach(function (master) {\n              if (!kinemage.masterDict[ master ]) {\n                kinemage.masterDict[ master ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          for (let key in groupFlags as {[k: string]: boolean}) {\n            kinemage.groupDict[ groupName as string ][ key ] = (groupFlags as {[k: string]: boolean})[ key ]\n          }\n        } else if (line.startsWith('@subgroup')) {\n          const { groupName, groupFlags, groupMasters } = parseGroup(line)\n\n          if (!kinemage.subgroupDict[ groupName as string ]) {\n            kinemage.subgroupDict[ groupName as string ] = {\n              dominant: false,\n              animate: false\n            }\n            currentSubgroupMasters = groupMasters\n          }\n\n          if (currentSubgroupMasters) {\n            currentSubgroupMasters.forEach(function (master) {\n              if (!kinemage.masterDict[ master ]) {\n                kinemage.masterDict[ master ] = {\n                  indent: false,\n                  visible: false\n                }\n              }\n            })\n          }\n\n          for (let key in groupFlags as {[k: string]: boolean}) {\n            kinemage.subgroupDict[ groupName as string ][ key ] = (groupFlags as {[k: string]: boolean})[ key ]\n          }\n        } else if (line.startsWith('@master')) {\n          const name = parseStr(line)\n          const flag = parseFlag(line)\n\n          if (!kinemage.masterDict[ name ]) {\n            kinemage.masterDict[ name ] = {\n              indent: false,\n              visible: false\n            }\n          }\n\n          if (flag === 'on') {\n            kinemage.masterDict[ name ].visible = true\n          } else if (flag === 'off') {\n            kinemage.masterDict[ name ].visible = false\n          } else if (flag === 'indent') {\n            kinemage.masterDict[ name ].indent = true\n          } else if (!flag) {\n            // nothing to do\n          }\n        } else if (line.startsWith('@pointmaster')) {\n          const { groupName, groupFlags } = parseGroup(line)\n\n          kinemage.pointmasterDict[ groupName as string] = {\n            id: Object.keys(groupFlags as {[k: string]: boolean})[ 0 ].replace(reTrimQuotes, '')\n          }\n        } else {\n          console.log(line)\n        }\n      }\n    }\n\n    this.streamer.eachChunkOfLines(function (lines/*, chunkNo, chunkCount */) {\n      _parseChunkOfLines(0, lines.length, lines)\n    })\n\n    kinemage.text = kinemage.texts.join('\\n').trim()\n    kinemage.caption = kinemage.captions.join('\\n').trim()\n    if (kinemage.ribbonLists) {\n      let convertedLists: RibbonObject[] = []\n      kinemage.ribbonLists.forEach(function (listObject) {\n        convertedLists.push(removePointBreaksTriangleArrays(convertKinTriangleArrays(listObject)))\n      })\n      kinemage.ribbonLists = convertedLists\n    }\n\n    if (Debug) Log.timeEnd(`KinParser._parse ${this.name}`)\n  }\n}\n\nParserRegistry.add('kin', KinParser)\n\nexport default KinParser\n","/**\n * @file Surface Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport Parser, { ParserParameters } from './parser'\nimport Surface from '../surface/surface'\nimport Streamer from '../streamer/streamer';\n\nclass SurfaceParser extends Parser {\n  constructor (streamer: Streamer, params?:Partial<ParserParameters>) {\n    super(streamer, params)\n\n    this.loader = this.getLoader()\n    this.surface = new Surface(this.name, this.path)\n  }\n\n  get type () { return 'surface' }\n  get __objName () { return 'surface' }\n\n  _parse () {\n    var geometry = this.loader.parse(this.streamer.asText())\n\n    this.surface.fromGeometry(geometry)\n  }\n}\n\nexport default SurfaceParser\n","/**\n * @file Obj Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { BufferGeometry, BufferAttribute } from 'three'\n\nimport { ParserRegistry } from '../globals'\nimport SurfaceParser from './surface-parser'\n\nexport interface _OBJLoader {\n  regexp: {[k: string]: RegExp}\n}\n\ninterface _OBJLoaderConstructor {\n  (this: _OBJLoader): void\n  new(): _OBJLoader\n}\n\ninterface ObjectType {\n  name: string,\n  fromDeclaration: boolean,\n  geometry: {\n    vertices: number[],\n    normals: number[],\n    type?: string\n  }\n}\n/**\n * OBJLoader\n * @class\n * @private\n * @author mrdoob / http://mrdoob.com/\n */\nconst OBJLoader = (function OBJLoader (this: _OBJLoader) {\n  this.regexp = {\n    // v float float float\n    vertex_pattern: /^v\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)/,\n    // vn float float float\n    normal_pattern: /^vn\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)/,\n    // vt float float\n    uv_pattern: /^vt\\s+([\\d.+\\-eE]+)\\s+([\\d.+\\-eE]+)/,\n    // f vertex vertex vertex\n    face_vertex: /^f\\s+(-?\\d+)\\s+(-?\\d+)\\s+(-?\\d+)(?:\\s+(-?\\d+))?/,\n    // f vertex/uv vertex/uv vertex/uv\n    face_vertex_uv: /^f\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+))?/,\n    // f vertex/uv/normal vertex/uv/normal vertex/uv/normal\n    face_vertex_uv_normal: /^f\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+)(?:\\s+(-?\\d+)\\/(-?\\d+)\\/(-?\\d+))?/,\n    // f vertex//normal vertex//normal vertex//normal\n    face_vertex_normal: /^f\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)\\s+(-?\\d+)\\/\\/(-?\\d+)(?:\\s+(-?\\d+)\\/\\/(-?\\d+))?/,\n    // o object_name | g group_name\n    object_pattern: /^[og]\\s*(.+)?/,\n    // s boolean\n    smoothing_pattern: /^s\\s+(\\d+|on|off)/,\n    // mtllib file_reference\n    material_library_pattern: /^mtllib /,\n    // usemtl material_name\n    material_use_pattern: /^usemtl /\n  }\n}) as _OBJLoaderConstructor\n\nOBJLoader.prototype = {\n\n  constructor: OBJLoader,\n\n  setPath: function (value: string) {\n    this.path = value\n  },\n\n  _createParserState: function () {\n    var state = {\n      objects: [] as ObjectType[],\n      object: {} as ObjectType,\n\n      vertices: [],\n      normals: [],\n\n      startObject: function (name: string, fromDeclaration: boolean) {\n        // If the current object (initial from reset) is not from a g/o declaration in the parsed\n        // file. We need to use it for the first parsed g/o to keep things in sync.\n        if (this.object && this.object.fromDeclaration === false) {\n          this.object.name = name\n          this.object.fromDeclaration = (fromDeclaration !== false)\n          return\n        }\n\n        this.object = {\n          name: name || '',\n          geometry: {\n            vertices: [],\n            normals: []\n          },\n          fromDeclaration: (fromDeclaration !== false)\n        }\n\n        this.objects.push(this.object)\n      },\n\n      parseVertexIndex: function (value: string, len: number) {\n        var index = parseInt(value, 10)\n        return (index >= 0 ? index - 1 : index + len / 3) * 3\n      },\n\n      parseNormalIndex: function (value: string, len: number) {\n        var index = parseInt(value, 10)\n        return (index >= 0 ? index - 1 : index + len / 3) * 3\n      },\n\n      addVertex: function (a: number, b: number, c: number) {\n        var src = this.vertices\n        var dst = this.object.geometry.vertices\n\n        dst.push(src[ a + 0 ])\n        dst.push(src[ a + 1 ])\n        dst.push(src[ a + 2 ])\n        dst.push(src[ b + 0 ])\n        dst.push(src[ b + 1 ])\n        dst.push(src[ b + 2 ])\n        dst.push(src[ c + 0 ])\n        dst.push(src[ c + 1 ])\n        dst.push(src[ c + 2 ])\n      },\n\n      addVertexLine: function (a: number) {\n        var src = this.vertices\n        var dst = this.object.geometry.vertices\n\n        dst.push(src[ a + 0 ])\n        dst.push(src[ a + 1 ])\n        dst.push(src[ a + 2 ])\n      },\n\n      addNormal: function (a: number, b: number, c: number) {\n        var src = this.normals\n        var dst = this.object.geometry.normals\n\n        dst.push(src[ a + 0 ])\n        dst.push(src[ a + 1 ])\n        dst.push(src[ a + 2 ])\n        dst.push(src[ b + 0 ])\n        dst.push(src[ b + 1 ])\n        dst.push(src[ b + 2 ])\n        dst.push(src[ c + 0 ])\n        dst.push(src[ c + 1 ])\n        dst.push(src[ c + 2 ])\n      },\n\n      addFace: function (a: string, b: string, c: string, d?: string, na?: string, nb?: string, nc?: string, nd?: string) {\n        var vLen = this.vertices.length\n\n        var ia = this.parseVertexIndex(a, vLen)\n        var ib = this.parseVertexIndex(b, vLen)\n        var ic = this.parseVertexIndex(c, vLen)\n        var id\n\n        if (d === undefined) {\n          this.addVertex(ia, ib, ic)\n        } else {\n          id = this.parseVertexIndex(d, vLen)\n\n          this.addVertex(ia, ib, id)\n          this.addVertex(ib, ic, id)\n        }\n\n        if (na !== undefined) {\n          // Normals are many times the same. If so, skip function call and parseInt.\n          var nLen = this.normals.length\n          ia = this.parseNormalIndex(na, nLen)\n\n          ib = na === nb ? ia : this.parseNormalIndex(nb!, nLen)\n          ic = na === nc ? ia : this.parseNormalIndex(nc!, nLen)\n\n          if (d === undefined) {\n            this.addNormal(ia, ib, ic)\n          } else {\n            id = this.parseNormalIndex(nd!, nLen)\n\n            this.addNormal(ia, ib, id)\n            this.addNormal(ib, ic, id)\n          }\n        }\n      },\n\n      addLineGeometry: function (vertices: string[]) {\n        this.object.geometry.type = 'Line'\n\n        var vLen = this.vertices.length\n\n        for (var vi = 0, l = vertices.length; vi < l; vi++) {\n          this.addVertexLine(this.parseVertexIndex(vertices[ vi ], vLen))\n        }\n      }\n\n    }\n\n    state.startObject('', false)\n\n    return state\n  },\n\n  parse: function (text: string) {\n    var state = this._createParserState()\n\n    if (text.indexOf('\\r\\n') !== -1) {\n      // This is faster than String.split with regex that splits on both\n      text = text.replace(/\\r\\n/g, '\\n')\n    }\n\n    if (text.indexOf('\\\\\\n') !== -1) {\n      // join lines separated by a line continuation character (\\)\n      text = text.replace(/\\\\\\n/g, '')\n    }\n\n    var i, l\n    var lines = text.split('\\n')\n    var line = ''\n    var lineFirstChar = ''\n    var lineSecondChar = ''\n    var lineLength = 0\n    var result = []\n\n    // Faster to just trim left side of the line. Use if available.\n    var trimLeft = (typeof ''.trimLeft === 'function')\n\n    for (i = 0, l = lines.length; i < l; i++) {\n      line = lines[ i ]\n\n      line = trimLeft ? line.trimLeft() : line.trim()\n\n      lineLength = line.length\n\n      if (lineLength === 0) continue\n\n      lineFirstChar = line.charAt(0)\n\n      // @todo invoke passed in handler if any\n      if (lineFirstChar === '#') continue\n\n      if (lineFirstChar === 'v') {\n        lineSecondChar = line.charAt(1)\n\n        if (lineSecondChar === ' ' && (result = this.regexp.vertex_pattern.exec(line)) !== null) {\n          // 0                  1      2      3\n          // [\"v 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\n\n          state.vertices.push(\n            parseFloat(result[ 1 ]),\n            parseFloat(result[ 2 ]),\n            parseFloat(result[ 3 ])\n          )\n        } else if (lineSecondChar === 'n' && (result = this.regexp.normal_pattern.exec(line)) !== null) {\n          // 0                   1      2      3\n          // [\"vn 1.0 2.0 3.0\", \"1.0\", \"2.0\", \"3.0\"]\n\n          state.normals.push(\n            parseFloat(result[ 1 ]),\n            parseFloat(result[ 2 ]),\n            parseFloat(result[ 3 ])\n          )\n        } else if (lineSecondChar === 't' && this.regexp.uv_pattern.exec(line) !== null) {\n\n          // ignore uv line\n\n        } else {\n          throw new Error(\"Unexpected vertex/normal/uv line: '\" + line + \"'\")\n        }\n      } else if (lineFirstChar === 'f') {\n        if ((result = this.regexp.face_vertex_uv_normal.exec(line)) !== null) {\n          // f vertex/uv/normal vertex/uv/normal vertex/uv/normal\n          // 0                        1    2    3    4    5    6    7    8    9   10         11         12\n          // [\"f 1/1/1 2/2/2 3/3/3\", \"1\", \"1\", \"1\", \"2\", \"2\", \"2\", \"3\", \"3\", \"3\", undefined, undefined, undefined]\n\n          state.addFace(\n            result[ 1 ], result[ 4 ], result[ 7 ], result[ 10 ],\n            // result[ 2 ], result[ 5 ], result[ 8 ], result[ 11 ],  // ignore uv part\n            result[ 3 ], result[ 6 ], result[ 9 ], result[ 12 ]\n          )\n        } else if (this.regexp.face_vertex_uv.exec(line) !== null) {\n\n          // ignore uv line\n\n        } else if ((result = this.regexp.face_vertex_normal.exec(line)) !== null) {\n          // f vertex//normal vertex//normal vertex//normal\n          // 0                     1    2    3    4    5    6   7          8\n          // [\"f 1//1 2//2 3//3\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", undefined, undefined]\n\n          state.addFace(\n            result[ 1 ], result[ 3 ], result[ 5 ], result[ 7 ],\n            result[ 2 ], result[ 4 ], result[ 6 ], result[ 8 ]\n          )\n        } else if ((result = this.regexp.face_vertex.exec(line)) !== null) {\n          // f vertex vertex vertex\n          // 0            1    2    3   4\n          // [\"f 1 2 3\", \"1\", \"2\", \"3\", undefined]\n\n          state.addFace(\n            result[ 1 ], result[ 2 ], result[ 3 ], result[ 4 ]\n          )\n        } else {\n          throw new Error(\"Unexpected face line: '\" + line + \"'\")\n        }\n      } else if (lineFirstChar === 'l') {\n        var lineParts = line.substring(1).trim().split(' ')\n        var lineVertices = []\n        var lineUVs = []\n\n        if (line.indexOf('/') === -1) {\n          lineVertices = lineParts\n        } else {\n          for (var li = 0, llen = lineParts.length; li < llen; li++) {\n            var parts = lineParts[ li ].split('/')\n\n            if (parts[ 0 ] !== '') lineVertices.push(parts[ 0 ])\n            if (parts[ 1 ] !== '') lineUVs.push(parts[ 1 ])\n          }\n        }\n        state.addLineGeometry(lineVertices, lineUVs)\n      } else if ((result = this.regexp.object_pattern.exec(line)) !== null) {\n        // o object_name\n        // or\n        // g group_name\n\n        var name = result[ 0 ].substr(1).trim()\n        state.startObject(name)\n\n        // ignore material related lines\n        // eslint-disable-next-line no-empty\n      } else if (this.regexp.material_use_pattern.test(line)) {\n        // eslint-disable-next-line no-empty\n      } else if (this.regexp.material_library_pattern.test(line)) {\n        // eslint-disable-next-line no-empty\n      } else if (this.regexp.smoothing_pattern.exec(line) !== null) {\n      } else {\n        // Handle null terminated files without exception\n        if (line === '\\0') continue\n\n        throw new Error(\"Unexpected line: '\" + line + \"'\")\n      }\n    }\n\n    var container = []\n\n    for (i = 0, l = state.objects.length; i < l; i++) {\n      var object = state.objects[ i ]\n      var geometry = object.geometry\n\n      // Skip o/g line declarations that did not follow with any faces\n      if (geometry.vertices.length === 0) continue\n\n      var buffergeometry = new BufferGeometry()\n\n      buffergeometry.setAttribute('position', new BufferAttribute(new Float32Array(geometry.vertices), 3))\n\n      if (geometry.normals.length > 0) {\n        buffergeometry.setAttribute('normal', new BufferAttribute(new Float32Array(geometry.normals), 3))\n      } else {\n        buffergeometry.computeVertexNormals()\n      }\n\n      container.push(buffergeometry)\n    }\n\n    return container\n  }\n\n}\n\nclass ObjParser extends SurfaceParser {\n  get type () { return 'obj' }\n\n  getLoader () {\n    return new OBJLoader()\n  }\n}\n\nParserRegistry.add('obj', ObjParser)\n\nexport default ObjParser\n","/**\n * @file Ply Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Geometry, Vector3, Face3, Color } from 'three'\n\nimport { ParserRegistry } from '../globals'\nimport SurfaceParser from './surface-parser'\n\n/**\n * PLYLoader\n * @class\n * @private\n * @author Wei Meng / http://about.me/menway\n *\n * @description\n * A THREE loader for PLY ASCII files (known as the Polygon File Format or the Stanford Triangle Format).\n *\n * Limitations: ASCII decoding assumes file is UTF-8.\n *\n * @example\n * var loader = new THREE.PLYLoader();\n * loader.load('./models/ply/ascii/dolphins.ply', function (geometry) {\n *     scene.add( new THREE.Mesh( geometry ) );\n * } );\n *\n * // If the PLY file uses non standard property names, they can be mapped while\n * // loading. For example, the following maps the properties\n * // “diffuse_(red|green|blue)” in the file to standard color names.\n *\n * loader.setPropertyNameMapping( {\n *     diffuse_red: 'red',\n *     diffuse_green: 'green',\n *     diffuse_blue: 'blue'\n * } );\n *\n */\n\nexport interface _PLYLoader {\n  propertyNameMapping: {[k: string]: string}\n}\n\ninterface _PLYLoaderConstructor {\n  (this: _PLYLoader): void\n  new(): _PLYLoader\n}\n\ninterface PLYProperty {\n  type: string,\n  name: string,\n  countType: string,\n  itemType: string\n}\n\ninterface PLYElement {\n  name: string,\n  count: number,\n  properties: PLYProperty[],\n  x: number,\n  y: number,\n  z: number,\n  red: number,\n  green: number,\n  blue: number,\n  [k:string]: any\n}\n\ninterface PLYHeader {\n  format: string,\n  version: string,\n  comments: string[],\n  elements: PLYElement[],\n  headerLength: number\n}\n\ninterface GeometryPLY extends Geometry {\n  useColor: boolean\n}\n\nconst PLYLoader = (function PLYLoader (this: _PLYLoader) {\n  this.propertyNameMapping = {}\n}) as _PLYLoaderConstructor\n\nPLYLoader.prototype = {\n\n  constructor: PLYLoader,\n\n  setPropertyNameMapping: function (mapping: {[k: string]: string}) {\n    this.propertyNameMapping = mapping\n  },\n\n  bin2str: function (buf: ArrayBuffer) {\n    var arrayBuffer = new Uint8Array(buf)\n    var str = ''\n    for (var i = 0; i < buf.byteLength; i++) {\n      str += String.fromCharCode(arrayBuffer[ i ]) // implicitly assumes little-endian\n    }\n\n    return str\n  },\n\n  isASCII: function (data: ArrayBuffer) {\n    var header = this.parseHeader(this.bin2str(data))\n\n    return header.format === 'ascii'\n  },\n\n  parse: function (data: string|ArrayBuffer) {\n    if (data instanceof ArrayBuffer) {\n      return (\n        this.isASCII(data)\n          ? this.parseASCII(this.bin2str(data))\n          : this.parseBinary(data)\n      )\n    } else {\n      return this.parseASCII(data)\n    }\n  },\n\n  parseHeader: function (data: string) {\n    var patternHeader = /ply([\\s\\S]*)end_header\\s/\n    var headerText = ''\n    var headerLength = 0\n    var result = patternHeader.exec(data)\n    if (result !== null) {\n      headerText = result[ 1 ]\n      headerLength = result[ 0 ].length\n    }\n\n    var header: Partial<PLYHeader> = {\n      comments: [],\n      elements: [],\n      headerLength: headerLength\n    }\n\n    var lines = headerText.split('\\n')\n    var currentElement: PLYElement|undefined, lineType, lineValues\n\n    function makePlyElementProperty (propertValues: string[], propertyNameMapping: {[k: string]: string}) {\n      var property = {\n        type: propertValues[ 0 ]\n      } as PLYProperty\n\n      if (property.type === 'list') {\n        property.name = propertValues[ 3 ]\n        property.countType = propertValues[ 1 ]\n        property.itemType = propertValues[ 2 ]\n      } else {\n        property.name = propertValues[ 1 ]\n      }\n\n      if (property.name in propertyNameMapping) {\n        property.name = propertyNameMapping[ property.name ]\n      }\n\n      return property\n    }\n\n    for (var i = 0; i < lines.length; i++) {\n      var line = lines[ i ]\n      line = line.trim()\n      if (line === '') {\n        continue\n      }\n      lineValues = line.split(/\\s+/)\n      lineType = lineValues.shift()\n      line = lineValues.join(' ')\n\n      switch (lineType) {\n        case 'format':\n\n          header.format = lineValues[ 0 ]\n          header.version = lineValues[ 1 ]\n\n          break\n\n        case 'comment':\n\n          header.comments!.push(line)\n\n          break\n\n        case 'element':\n\n          if (currentElement !== undefined) {\n            header.elements!.push(currentElement as PLYElement)\n          }\n\n          currentElement = {} as PLYElement\n          currentElement.name = lineValues[ 0 ]\n          currentElement.count = parseInt(lineValues[ 1 ])\n          currentElement.properties = []\n\n          break\n\n        case 'property':\n\n          currentElement!.properties.push(makePlyElementProperty(lineValues, this.propertyNameMapping))\n\n          break\n\n        default:\n\n          console.log('unhandled', lineType, lineValues)\n      }\n    }\n\n    if (currentElement !== undefined) {\n      header.elements!.push(currentElement)\n    }\n\n    return header\n  },\n\n  parseASCIINumber: function (n: string, type: string) {\n    switch (type) {\n      case 'char': case 'uchar': case 'short': case 'ushort': case 'int': case 'uint':\n      case 'int8': case 'uint8': case 'int16': case 'uint16': case 'int32': case 'uint32':\n\n        return parseInt(n)\n\n      case 'float': case 'double': case 'float32': case 'float64':\n\n        return parseFloat(n)\n    }\n  },\n\n  parseASCIIElement: function (properties: PLYProperty[], line: string) {\n    var values = line.split(/\\s+/)\n\n    var element = {} as PLYElement\n\n    for (var i = 0; i < properties.length; i++) {\n      if (properties[ i ].type === 'list') {\n        var list = []\n        var n = this.parseASCIINumber(values.shift(), properties[ i ].countType)\n\n        for (var j = 0; j < n; j++) {\n          list.push(this.parseASCIINumber(values.shift(), properties[ i ].itemType))\n        }\n\n        element[ properties[ i ].name ] = list\n      } else {\n        element[ properties[ i ].name ] = this.parseASCIINumber(values.shift(), properties[ i ].type)\n      }\n    }\n\n    return element\n  },\n\n  parseASCII: function (data: string) {\n    // PLY ascii format specification, as per http://en.wikipedia.org/wiki/PLY_(file_format)\n\n    var geometry = new Geometry() as GeometryPLY\n\n    var result\n\n    var header = this.parseHeader(data)\n\n    var patternBody = /end_header\\s([\\s\\S]*)$/\n    var body = ''\n    if ((result = patternBody.exec(data)) !== null) {\n      body = result[ 1 ]\n    }\n\n    var lines = body.split('\\n')\n    var currentElement = 0\n    var currentElementCount = 0\n    geometry.useColor = false\n\n    for (var i = 0; i < lines.length; i++) {\n      var line = lines[ i ]\n      line = line.trim()\n      if (line === '') {\n        continue\n      }\n\n      if (currentElementCount >= header.elements[ currentElement ].count) {\n        currentElement++\n        currentElementCount = 0\n      }\n\n      var element = this.parseASCIIElement(header.elements[ currentElement ].properties, line)\n\n      this.handleElement(geometry, header.elements[ currentElement ].name, element)\n\n      currentElementCount++\n    }\n\n    return this.postProcess(geometry)\n  },\n\n  postProcess: function (geometry: GeometryPLY) {\n    if (geometry.useColor) {\n      for (var i = 0; i < geometry.faces.length; i++) {\n        geometry.faces[ i ].vertexColors = [\n          geometry.colors[ geometry.faces[ i ].a ],\n          geometry.colors[ geometry.faces[ i ].b ],\n          geometry.colors[ geometry.faces[ i ].c ]\n        ]\n      }\n\n      geometry.elementsNeedUpdate = true\n    }\n\n    geometry.computeBoundingSphere()\n\n    return geometry\n  },\n\n  handleElement: function (geometry: GeometryPLY, elementName: string, element: PLYElement) {\n    if (elementName === 'vertex') {\n      geometry.vertices.push(\n        new Vector3(element.x, element.y, element.z)\n      )\n\n      if ('red' in element && 'green' in element && 'blue' in element) {\n        geometry.useColor = true\n\n        var color = new Color()\n        color.setRGB(element.red / 255.0, element.green / 255.0, element.blue / 255.0)\n        geometry.colors.push(color)\n      }\n    } else if (elementName === 'face') {\n      var vertexIndices = element.vertex_indices\n\n      if (vertexIndices.length === 3) {\n        geometry.faces.push(\n          new Face3(vertexIndices[ 0 ], vertexIndices[ 1 ], vertexIndices[ 2 ])\n        )\n      } else if (vertexIndices.length === 4) {\n        geometry.faces.push(\n          new Face3(vertexIndices[ 0 ], vertexIndices[ 1 ], vertexIndices[ 3 ]),\n          new Face3(vertexIndices[ 1 ], vertexIndices[ 2 ], vertexIndices[ 3 ])\n        )\n      }\n    }\n  },\n\n  binaryRead: function (dataview: DataView, at: number, type: string, littleEndian: boolean) {\n    switch (type) {\n      // corespondences for non-specific length types here match rply:\n      case 'int8': case 'char': return [ dataview.getInt8(at), 1 ]\n\n      case 'uint8': case 'uchar': return [ dataview.getUint8(at), 1 ]\n\n      case 'int16': case 'short': return [ dataview.getInt16(at, littleEndian), 2 ]\n\n      case 'uint16': case 'ushort': return [ dataview.getUint16(at, littleEndian), 2 ]\n\n      case 'int32': case 'int': return [ dataview.getInt32(at, littleEndian), 4 ]\n\n      case 'uint32': case 'uint': return [ dataview.getUint32(at, littleEndian), 4 ]\n\n      case 'float32': case 'float': return [ dataview.getFloat32(at, littleEndian), 4 ]\n\n      case 'float64': case 'double': return [ dataview.getFloat64(at, littleEndian), 8 ]\n    }\n  },\n\n  binaryReadElement: function (dataview: DataView, at: number, properties: PLYProperty[], littleEndian: boolean) {\n    var element = {} as PLYElement\n    var result\n    var read = 0\n\n    for (var i = 0; i < properties.length; i++) {\n      if (properties[ i ].type === 'list') {\n        var list = []\n\n        result = this.binaryRead(dataview, at + read, properties[ i ].countType, littleEndian)\n        var n = result[ 0 ]\n        read += result[ 1 ]\n\n        for (var j = 0; j < n; j++) {\n          result = this.binaryRead(dataview, at + read, properties[ i ].itemType, littleEndian)\n          list.push(result[ 0 ])\n          read += result[ 1 ]\n        }\n\n        element[ properties[ i ].name ] = list\n      } else {\n        result = this.binaryRead(dataview, at + read, properties[ i ].type, littleEndian)\n        element[ properties[ i ].name ] = result[ 0 ]\n        read += result[ 1 ]\n      }\n    }\n\n    return [ element, read ]\n  },\n\n  parseBinary: function (data: ArrayBuffer) {\n    var geometry = new Geometry()\n\n    var header = this.parseHeader(this.bin2str(data))\n    var littleEndian = (header.format === 'binary_little_endian')\n    var body = new DataView(data, header.headerLength)\n    var result\n    var loc = 0\n\n    for (var currentElement = 0; currentElement < header.elements.length; currentElement++) {\n      for (var currentElementCount = 0; currentElementCount < header.elements[ currentElement ].count; currentElementCount++) {\n        result = this.binaryReadElement(body, loc, header.elements[ currentElement ].properties, littleEndian)\n        loc += result[ 1 ]\n        var element = result[ 0 ]\n\n        this.handleElement(geometry, header.elements[ currentElement ].name, element)\n      }\n    }\n\n    return this.postProcess(geometry)\n  }\n\n}\n\nclass PlyParser extends SurfaceParser {\n  get type () { return 'ply' }\n\n  getLoader () {\n    return new PLYLoader()\n  }\n}\n\nParserRegistry.add('ply', PlyParser)\n\nexport default PlyParser\n","/**\n * @file Csv Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { defaults } from '../utils'\nimport { ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nexport interface CsvParserParameters extends ParserParameters {\n  delimiter: string\n  comment: string\n  columnNames: boolean\n}\n/**\n * CSV parser\n */\nclass CsvParser extends Parser {\n  /**\n     * [constructor description]\n     * @param  {Streamer} streamer - the streamer object\n     * @param  {Object} params - parameter object\n     * @param  {Char} params.delimiter - delimiter character\n     * @param  {Char} params.comment - comment character\n     * @param  {Boolean} params.columnNames - use first data line as column names\n     */\n  constructor (streamer: Streamer, params?: Partial<CsvParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.delimiter = defaults(p.delimiter, ',')\n    this.comment = defaults(p.comment, '#')\n    this.columnNames = defaults(p.columnNames, false)\n\n    this.table = {\n      name: this.name,\n      path: this.path,\n      columnNames: [],\n      data: []\n    }\n  }\n\n  get type () { return 'csv' }\n  get __objName () { return 'table' }\n\n  _parse () {\n    const data = this.table.data\n    const reDelimiter = new RegExp('\\\\s*' + this.delimiter + '\\\\s*')\n\n    let j = 0\n\n    this.streamer.eachChunkOfLines(chunk => {\n      const n = chunk.length\n\n      for (let i = 0; i < n; ++i) {\n        const line = chunk[ i ].trim()\n        if (line.startsWith(this.comment)) continue\n        const values = line.split(reDelimiter)\n\n        if (j === 0) {\n          this.table.columnNames = values\n        } else if (line) {\n          data.push(values)\n        }\n        ++j\n      }\n    })\n  }\n}\n\nParserRegistry.add('csv', CsvParser)\n\nexport default CsvParser\n","/**\n * @file Json Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport { defaults } from '../utils'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nexport interface JsonParserParameters extends ParserParameters {\n  string: boolean\n}\n\nclass JsonParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<JsonParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.string = defaults(p.string, false)\n\n    this.json = {\n      name: this.name,\n      path: this.path,\n      data: {}\n    }\n  }\n\n  get type () { return 'json' }\n  get __objName () { return 'json' }\n  get isJson () { return true }\n\n  _parse () {\n    if (this.streamer.isBinary() || this.string) {\n      this.json.data = JSON.parse(this.streamer.asText())\n    } else {\n      this.json.data = this.streamer.data\n    }\n  }\n}\n\nParserRegistry.add('json', JsonParser)\n\nexport default JsonParser\n","/**\n * @file Msgpack Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\n\nimport { decodeMsgpack } from '../../lib/mmtf.es6'\nimport Streamer from '../streamer/streamer';\n\nclass MsgpackParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.msgpack = {\n      name: this.name,\n      path: this.path,\n      data: undefined\n    }\n  }\n\n  get type () { return 'msgpack' }\n  get __objName () { return 'msgpack' }\n  get isBinary () { return true }\n\n  _parse () {\n    if (Debug) Log.time('MsgpackParser._parse ' + this.name)\n\n    this.msgpack.data = decodeMsgpack(this.streamer.data)\n\n    if (Debug) Log.timeEnd('MsgpackParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('msgpack', MsgpackParser)\n\nexport default MsgpackParser\n","/**\n * @file Netcdf Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\nimport NetcdfReader from '../utils/netcdf-reader'\nimport Streamer from '../streamer/streamer';\n\nclass NetcdfParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.netcdf = {\n      name: this.name,\n      path: this.path,\n      data: undefined\n    }\n  }\n\n  get type () { return 'netcdf' }\n  get __objName () { return 'netcdf' }\n  get isBinary () { return true }\n\n  _parse () {\n    if (Debug) Log.time('NetcdfParser._parse ' + this.name)\n\n    this.netcdf.data = new NetcdfReader(this.streamer.data)\n\n    if (Debug) Log.timeEnd('NetcdfParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('netcdf', NetcdfParser)\n\nexport default NetcdfParser\n","/**\n * @file Text Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ParserRegistry } from '../globals'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nclass TextParser extends Parser {\n  constructor (streamer: Streamer, params?: Partial<ParserParameters>) {\n    super(streamer, params)\n\n    this.text = {\n\n      name: this.name,\n      path: this.path,\n      data: ''\n\n    }\n  }\n\n  get type () { return 'text' }\n  get __objName () { return 'text' }\n\n  _parse () {\n    this.text.data = this.streamer.asText()\n  }\n}\n\nParserRegistry.add('txt', TextParser)\nParserRegistry.add('text', TextParser)\n\nexport default TextParser\n","/**\n * @file Parse Xml\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n// https://github.com/segmentio/xml-parser\n// MIT license\n\nexport type XMLNodeAttributes = { [k: string]: any }\nexport interface XMLNode {\n  name?: string\n  content?: string\n  attributes: XMLNodeAttributes\n  children?: XMLNode[]\n}\n\nconst reStrip = /^['\"]|['\"]$/g\nconst reTag = /^<([\\w-:.]+)\\s*/\nconst reContent = /^([^<]*)/\nconst reAttr = /([\\w:-]+)\\s*=\\s*(\"[^\"]*\"|'[^']*'|\\w+)\\s*/\n\nfunction strip (val: string) {\n  return val.replace(reStrip, '')\n}\n\nexport function parseXml (xml: string) {\n  // trim and strip comments\n  xml = xml.trim().replace(/<!--[\\s\\S]*?-->/g, '')\n\n  return document()\n\n  function document () {\n    return {\n      declaration: declaration(),\n      root: tag()\n    }\n  }\n\n  function declaration () {\n    const m = match(/^<\\?xml\\s*/)\n    if (!m) return\n\n    // tag\n    const node: XMLNode = {\n      attributes: {}\n    }\n\n    // attributes\n    while (!(eos() || is('?>'))) {\n      const attr = attribute()\n      if (!attr) return node\n      node.attributes[attr.name] = attr.value\n    }\n    match(/\\?>\\s*/)\n    return node\n  }\n\n  function tag () {\n    const m = match(reTag)\n    if (!m) return\n\n    // name\n    const node: XMLNode = {\n      name: m[1],\n      attributes: {},\n      children: []\n    }\n\n    // attributes\n    while (!(eos() || is('>') || is('?>') || is('/>'))) {\n      const attr = attribute()\n      if (!attr) return node\n      node.attributes[attr.name] = attr.value\n    }\n\n    // self closing tag\n    if (match(/^\\s*\\/>\\s*/)) {\n      return node\n    }\n    match(/\\??>\\s*/)\n\n    // content\n    node.content = content()\n\n    // children\n    let child\n    while ((child = tag())) {\n      node.children!.push(child)\n    }\n\n    // closing\n    match(/^<\\/[\\w-:.]+>\\s*/)\n    return node\n  }\n\n  function content () {\n    const m = match(reContent)\n    if (m) return m[1]\n    return ''\n  }\n\n  function attribute () {\n    const m = match(reAttr)\n    if (!m) return\n    return { name: m[1], value: strip(m[2]) }\n  }\n\n  function match (re: RegExp) {\n    const m = xml.match(re)\n    if (!m) return\n    xml = xml.slice(m[0].length)\n    return m\n  }\n\n  function eos () {\n    return xml.length === 0\n  }\n\n  function is (prefix: string) {\n    return xml.indexOf(prefix) === 0\n  }\n}\n","/**\n * @file Xml Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport { defaults } from '../utils'\n// @ts-ignore: unused import XMLNode required for declaration only\nimport { parseXml, XMLNode } from '../utils/parse-xml'\nimport Parser, { ParserParameters } from './parser'\nimport Streamer from '../streamer/streamer';\n\nexport interface XmlParserParameters extends ParserParameters {\n  useDomParser: boolean\n}\n\nclass XmlParser extends Parser {\n  xml: {\n    name: string\n    path: string\n    data: any\n  }\n  constructor (streamer: Streamer, params?: Partial<XmlParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.useDomParser = defaults(p.useDomParser, false)\n\n    this.xml = {\n      name: this.name,\n      path: this.path,\n      data: {}\n    }\n  }\n\n  get type () { return 'xml' }\n  get __objName () { return 'xml' }\n  get isXml () { return true }\n\n  __xmlParser (xml: string) {\n    return parseXml(xml)\n  }\n\n  __domParser (xml: string) {\n    const domParser = new (window as any).DOMParser() as DOMParser\n    return domParser.parseFromString(xml, 'text/xml')\n  }\n\n  _parse () {\n    if (Debug) Log.time('XmlParser._parse ' + this.name)\n\n    if (this.useDomParser) {\n      if (this.streamer.data instanceof Document) { //TS conversion: stripped the window prefix from window.Document\n        this.xml.data = this.streamer.data\n      } else {\n        this.xml.data = this.__domParser(this.streamer.asText())\n      }\n    } else {\n      this.xml.data = this.__xmlParser(this.streamer.asText())\n    }\n\n    if (Debug) Log.timeEnd('XmlParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('xml', XmlParser)\n\nexport default XmlParser\n","/**\n * @file Validation\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Vector3, Color } from 'three'\n\nimport { Debug, Log } from '../globals'\nimport { defaults } from '../utils'\nimport { ClashPicker } from '../utils/picker'\nimport { uniformArray3 } from '../math/array-utils'\nimport { guessElement } from '../structure/structure-utils'\nimport AtomProxy from '../proxy/atom-proxy'\nimport Structure from '../structure/structure'\n\nfunction getNamedItem(a: NamedNodeMap, name: string) {\n  const item = a.getNamedItem(name)\n  return item !== null ? item.value : ''\n}\n\nfunction getSele (a: NamedNodeMap, atomname?: string, useAltcode = false) {\n  const icode = getNamedItem(a, 'icode').trim()\n  const chain = getNamedItem(a, 'chain').trim()\n  const altcode = getNamedItem(a, 'altcode')\n  let sele = getNamedItem(a, 'resnum')\n  if (icode) sele += '^' + icode\n  if (chain) sele += ':' + chain\n  if (atomname) sele += '.' + atomname\n  if (useAltcode && altcode.trim()) sele += '%' + altcode\n  sele += '/' + (parseInt(getNamedItem(a, 'model')) - 1)\n  return sele\n}\n\nfunction getResSele (a: NamedNodeMap) {\n  const chain = getNamedItem(a, 'chain').trim()\n  const rescode = getNamedItem(a, 'rescode')\n  const resnum = getNamedItem(a, 'resnum')\n  let sele = `[${rescode}]${resnum}`\n  if (chain) sele += `:${chain}`\n  return sele\n}\n\nfunction setBitDict (dict: { [k: string]: number }, key: string, bit: number) {\n  if (dict[ key ] === undefined) {\n    dict[ key ] = bit\n  } else {\n    dict[ key ] |= bit\n  }\n}\n\nfunction hasAttrValue (attr: Attr|null, value: string) {\n  return attr !== null && attr.value === value\n}\n\nfunction getAtomSele (ap: AtomProxy) {\n  const icode = ap.inscode\n  const chain = ap.chainname\n  const atomname = ap.atomname\n  const altcode = ap.altloc\n  let sele = ap.resno + ''\n  if (icode) sele += '^' + icode\n  if (chain) sele += ':' + chain\n  if (atomname) sele += '.' + atomname\n  if (altcode) sele += '%' + altcode\n  sele += '/' + ap.modelIndex\n  return sele\n}\n\nfunction getProblemCount (clashDict: { [k: string]: { [k: string]: string } }, g: Element, ga: NamedNodeMap) {\n  let geoProblemCount = 0\n\n  const clashes = g.getElementsByTagName('clash')\n  for (let j = 0, jl = clashes.length; j < jl; ++j) {\n    if (clashDict[ getNamedItem(clashes[ j ].attributes, 'cid') ]) {\n      geoProblemCount += 1\n      break\n    }\n  }\n\n  const angleOutliers = g.getElementsByTagName('angle-outlier')\n  if (angleOutliers.length > 0) {\n    geoProblemCount += 1\n  }\n\n  const bondOutliers = g.getElementsByTagName('bond-outlier')\n  if (bondOutliers.length > 0) {\n    geoProblemCount += 1\n  }\n\n  const planeOutliers = g.getElementsByTagName('plane-outlier')\n  if (planeOutliers.length > 0) {\n    geoProblemCount += 1\n  }\n\n  if (hasAttrValue(ga.getNamedItem('rota'), 'OUTLIER')) {\n    geoProblemCount += 1\n  }\n\n  if (hasAttrValue(ga.getNamedItem('rama'), 'OUTLIER')) {\n    geoProblemCount += 1\n  }\n\n  if (hasAttrValue(ga.getNamedItem('RNApucker'), 'outlier')) {\n    geoProblemCount += 1\n  }\n\n  return geoProblemCount\n}\n\nclass Validation {\n  rsrzDict: { [k: string]: number } = {}\n  rsccDict: { [k: string]: number } = {}\n  /**\n   * Random Coil Index (RCI) - evaluates the proximity of residue structural\n   * and dynamic properties to the properties of flexible random coil regions\n   * from NMR chemical shifts.\n   *\n   * Mark V. Berjanskii and David S. Wishart (2005)\n   * A Simple Method To Predict Protein Flexibility Using Secondary Chemical Shifts\n   * J. Am. Chem. Soc., 2005, 127 (43), pp 14970–14971\n   * http://pubs.acs.org/doi/abs/10.1021/ja054842f\n   *\n   * Mark V. Berjanskii and David S. Wishart (2008)\n   * Application of the random coil index to studying protein flexibility.\n   * J Biomol NMR. 2008 Jan;40(1):31-48. Epub 2007 Nov 6.\n   * http://www.springerlink.com/content/2966482w10306126/\n   */\n  rciDict: { [k: string]: number } = {}\n  clashDict: { [k: string]: { [k: string]: string } } = {}\n  clashArray: { [k: string]: string }[] = []\n  geoDict: { [k: string]: number } = {}\n  geoAtomDict: { [k: string]: { [k: string]: number } } = {}\n  atomDict: { [k: string]: boolean|number } = {}\n  clashSele = 'NONE'\n\n  constructor (readonly name: string, readonly path: string) {}\n\n  get type () { return 'validation' }\n\n  fromXml (xml: XMLDocument) {\n    if (Debug) Log.time('Validation.fromXml')\n\n    const rsrzDict = this.rsrzDict\n    const rsccDict = this.rsccDict\n    const rciDict = this.rciDict\n    const clashDict = this.clashDict\n    const clashArray = this.clashArray\n    const geoDict = this.geoDict\n    const geoAtomDict = this.geoAtomDict\n    const atomDict = this.atomDict\n\n    const entries = xml.getElementsByTagName('Entry')\n    if (entries.length === 1) {\n      const chemicalShiftLists = entries[0].getElementsByTagName('chemical_shift_list')\n      if (chemicalShiftLists.length === 1) {\n        const randomCoilIndices = chemicalShiftLists[0].getElementsByTagName('random_coil_index')\n        for (let j = 0, jl = randomCoilIndices.length; j < jl; ++j) {\n          const rcia = randomCoilIndices[ j ].attributes\n          const sele = getResSele(rcia)\n          rciDict[ sele ] = parseFloat(getNamedItem(rcia, 'value'))\n        }\n      }\n    }\n\n    const groups = xml.getElementsByTagName('ModelledSubgroup')\n\n    const _clashDict: { [k: string]: { [k: string]: string } } = {}\n    const clashList: string[] = []\n\n    if (Debug) Log.time('Validation.fromXml#clashDict')\n\n    for (let i = 0, il = groups.length; i < il; ++i) {\n      const g = groups[ i ]\n      const ga = g.attributes\n\n      const sele = getSele(ga)\n      if (ga.getNamedItem('rsrz') !== null) {\n        rsrzDict[ sele ] = parseFloat(getNamedItem(ga, 'rsrz'))\n      }\n      if (ga.getNamedItem('rscc') !== null) {\n        rsccDict[ sele ] = parseFloat(getNamedItem(ga, 'rscc'))\n      }\n      const seleAttr = xml.createAttribute('sele')\n      seleAttr.value = sele\n      ga.setNamedItem(seleAttr)\n\n      const clashes = g.getElementsByTagName('clash')\n\n      for (let j = 0, jl = clashes.length; j < jl; ++j) {\n        const ca = clashes[ j ].attributes\n        const atom = getNamedItem(ca, 'atom')\n\n        if (guessElement(atom) !== 'H') {\n          const cid = getNamedItem(ca, 'cid')\n          const atomSele = getSele(ga, atom, true)\n          atomDict[ atomSele ] = true\n\n          if (_clashDict[ cid ] === undefined) {\n            _clashDict[ cid ] = {\n              sele1: atomSele,\n              res1: sele\n            }\n          } else {\n            const c = _clashDict[ cid ]\n            if (c.res1 !== sele) {\n              c.sele2 = atomSele\n              c.res2 = sele\n              clashList.push(c.res1, sele)\n              clashDict[ cid ] = c\n              clashArray.push(c)\n            }\n          }\n        }\n      }\n    }\n\n    if (Debug) Log.timeEnd('Validation.fromXml#clashDict')\n\n    for (let i = 0, il = groups.length; i < il; ++i) {\n      const g = groups[ i ]\n      const ga = g.attributes\n\n      const sele = getNamedItem(ga, 'sele')\n      const isPolymer = getNamedItem(ga, 'seq') !== '.'\n\n      if (isPolymer) {\n        const geoProblemCount = getProblemCount(clashDict, g, ga)\n        if (geoProblemCount > 0) {\n          geoDict[ sele ] = geoProblemCount\n        }\n      } else {\n        const clashes = g.getElementsByTagName('clash')\n        const mogBondOutliers = g.getElementsByTagName('mog-bond-outlier')\n        const mogAngleOutliers = g.getElementsByTagName('mog-angle-outlier')\n\n        if (mogBondOutliers.length > 0 || mogAngleOutliers.length > 0 || clashes.length > 0) {\n          const atomDict = {}\n          geoAtomDict[ sele ] = atomDict\n\n          for (let j = 0, jl = clashes.length; j < jl; ++j) {\n            const ca = clashes[ j ].attributes\n            if (clashDict[ getNamedItem(ca, 'cid') ]) {\n              setBitDict(atomDict, getNamedItem(ca, 'atom'), 1)\n            }\n          }\n\n          for (let j = 0, jl = mogBondOutliers.length; j < jl; ++j) {\n            const mbo = mogBondOutliers[ j ].attributes\n            getNamedItem(mbo, 'atoms').split(',').forEach(function (atomname) {\n              setBitDict(atomDict, atomname, 2)\n            })\n          }\n\n          for (let j = 0, jl = mogAngleOutliers.length; j < jl; ++j) {\n            const mao = mogAngleOutliers[ j ].attributes\n            getNamedItem(mao, 'atoms').split(',').forEach(function (atomname) {\n              setBitDict(atomDict, atomname, 4)\n            })\n          }\n        }\n      }\n    }\n\n    this.clashSele = clashList.length ? clashList.join(' OR ') : 'NONE'\n\n    if (Debug) Log.timeEnd('Validation.fromXml')\n  }\n\n  getClashData (params: { color: number|string|Color, structure: Structure }) {\n    if (Debug) Log.time('Validation.getClashData')\n\n    const p = params || {}\n\n    const s = p.structure\n    const atomSet = s.atomSet!  // TODO\n    const c = new Color(defaults(p.color, '#f0027f'))\n\n    const ap1 = s.getAtomProxy()\n    const ap2 = s.getAtomProxy()\n    const vDir = new Vector3()\n    const vPos1 = new Vector3()\n    const vPos2 = new Vector3()\n\n    const clashArray = this.clashArray\n    const n = clashArray.length\n\n    const position1 = new Float32Array(n * 3)\n    const position2 = new Float32Array(n * 3)\n    const color = uniformArray3(n, c.r, c.g, c.b) as Float32Array\n    const radius = new Float32Array(n)\n    const picking = new Float32Array(n)\n\n    if (Debug) Log.time('Validation.getClashData#atomDict')\n\n    const atomDict = this.atomDict\n\n    s.eachAtom(function (ap) {\n      const sele = getAtomSele(ap)\n      if (atomDict[ sele ] === true) {\n        atomDict[ sele ] = ap.index\n      }\n    })\n\n    if (Debug) Log.timeEnd('Validation.getClashData#atomDict')\n\n    let i = 0\n\n    clashArray.forEach(function (c, idx) {\n      ap1.index = atomDict[ c.sele1 ] as number  // TODO\n      ap2.index = atomDict[ c.sele2 ] as number  // TODO\n\n      if (ap1.index === undefined || ap2.index === undefined ||\n          !atomSet.isSet(ap1.index, ap2.index)) return\n\n      vDir.subVectors(ap2 as any, ap1 as any).setLength(ap1.vdw)  // TODO\n      vPos1.copy(ap1 as any).add(vDir)  // TODO\n\n      vDir.subVectors(ap1 as any, ap2 as any).setLength(ap2.vdw)  // TODO\n      vPos2.copy(ap2 as any).add(vDir)  // TODO\n\n      const dHalf = ap1.distanceTo(ap2) / 2\n      const r1 = Math.sqrt(ap1.vdw * ap1.vdw - dHalf * dHalf)\n      const r2 = Math.sqrt(ap2.vdw * ap2.vdw - dHalf * dHalf)\n\n      vPos1.toArray(position1 as any, i * 3)  // TODO\n      vPos2.toArray(position2 as any, i * 3)\n      radius[ i ] = (r1 + r2) / 2\n      picking[ i ] = idx\n\n      ++i\n    })\n\n    if (Debug) Log.timeEnd('Validation.getClashData')\n\n    return {\n      position1: position1.subarray(0, i * 3),\n      position2: position2.subarray(0, i * 3),\n      color: color.subarray(0, i * 3),\n      color2: color.subarray(0, i * 3),\n      radius: radius.subarray(0, i),\n      picking: new ClashPicker(picking.subarray(0, i), this, s)\n    }\n  }\n}\n\nexport default Validation\n","/**\n * @file Validation Parser\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Debug, Log, ParserRegistry } from '../globals'\nimport XmlParser, { XmlParserParameters } from './xml-parser'\nimport Validation from '../structure/validation'\nimport Streamer from '../streamer/streamer';\n\nclass ValidationParser extends XmlParser {\n  constructor (streamer: Streamer, params?: Partial<XmlParserParameters>) {\n    const p = params || {}\n\n    super(streamer, p)\n\n    this.useDomParser = true\n    this.validation = new Validation(this.name, this.path)\n  }\n\n  get __objName () { return 'validation' }\n  get isXml () { return true }\n\n  _parse () {\n    super._parse()\n\n    if (Debug) Log.time('ValidationParser._parse ' + this.name)\n\n    this.validation.fromXml(this.xml.data)\n\n    if (Debug) Log.timeEnd('ValidationParser._parse ' + this.name)\n  }\n}\n\nParserRegistry.add('validation', ValidationParser)\n\nexport default ValidationParser\n","\n// https://github.com/nodeca/pako\n// MIT License, Copyright (c) 2014 by Vitaly Puzrin\n\n\n// 'use strict';\n\n\n// var TYPED_OK =  (typeof Uint8Array !== 'undefined') &&\n//                 (typeof Uint16Array !== 'undefined') &&\n//                 (typeof Int32Array !== 'undefined');\n\n\nfunction assign(obj /*from1, from2, from3, ...*/) {\n  var sources = Array.prototype.slice.call(arguments, 1);\n  while (sources.length) {\n    var source = sources.shift();\n    if (!source) { continue; }\n\n    if (typeof source !== 'object') {\n      throw new TypeError(source + 'must be non-object');\n    }\n\n    for (var p in source) {\n      if (source.hasOwnProperty(p)) {\n        obj[p] = source[p];\n      }\n    }\n  }\n\n  return obj;\n}\n\n\n// reduce buffer size, avoiding mem copy\nfunction shrinkBuf(buf, size) {\n  if (buf.length === size) { return buf; }\n  if (buf.subarray) { return buf.subarray(0, size); }\n  buf.length = size;\n  return buf;\n}\n\n\nfunction arraySet(dest, src, src_offs, len, dest_offs) {\n  if (src.subarray && dest.subarray) {\n    dest.set(src.subarray(src_offs, src_offs + len), dest_offs);\n    return;\n  }\n  // Fallback to ordinary array\n  for (var i = 0; i < len; i++) {\n    dest[dest_offs + i] = src[src_offs + i];\n  }\n}\n\n// Join array of chunks to single array.\nfunction flattenChunks(chunks) {\n  var i, l, len, pos, chunk, result;\n\n  // calculate data length\n  len = 0;\n  for (i = 0, l = chunks.length; i < l; i++) {\n    len += chunks[i].length;\n  }\n\n  // join chunks\n  result = new Uint8Array(len);\n  pos = 0;\n  for (i = 0, l = chunks.length; i < l; i++) {\n    chunk = chunks[i];\n    result.set(chunk, pos);\n    pos += chunk.length;\n  }\n\n  return result;\n}\n\n// 'use strict';\n\n// Note: adler32 takes 12% for level 0 and 2% for level 6.\n// It doesn't worth to make additional optimizationa as in original.\n// Small size is preferable.\n\nfunction adler32(adler, buf, len, pos) {\n  var s1 = (adler & 0xffff) |0,\n      s2 = ((adler >>> 16) & 0xffff) |0,\n      n = 0;\n\n  while (len !== 0) {\n    // Set limit ~ twice less than 5552, to keep\n    // s2 in 31-bits, because we force signed ints.\n    // in other case %= will fail.\n    n = len > 2000 ? 2000 : len;\n    len -= n;\n\n    do {\n      s1 = (s1 + buf[pos++]) |0;\n      s2 = (s2 + s1) |0;\n    } while (--n);\n\n    s1 %= 65521;\n    s2 %= 65521;\n  }\n\n  return (s1 | (s2 << 16)) |0;\n}\n\n// 'use strict';\n\n// Note: we can't get significant speed boost here.\n// So write code to minimize size - no pregenerated tables\n// and array tools dependencies.\n\n\n// Use ordinary array, since untyped makes no boost here\nfunction makeTable() {\n  var c, table = [];\n\n  for (var n = 0; n < 256; n++) {\n    c = n;\n    for (var k = 0; k < 8; k++) {\n      c = ((c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1));\n    }\n    table[n] = c;\n  }\n\n  return table;\n}\n\n// Create table on load. Just 255 signed longs. Not a problem.\nvar crcTable = makeTable();\n\n\nfunction crc32(crc, buf, len, pos) {\n  var t = crcTable,\n      end = pos + len;\n\n  crc ^= -1;\n\n  for (var i = pos; i < end; i++) {\n    crc = (crc >>> 8) ^ t[(crc ^ buf[i]) & 0xFF];\n  }\n\n  return (crc ^ (-1)); // >>> 0;\n}\n\n// 'use strict';\n\n// See state defs from inflate.js\nvar BAD$1 = 30;       /* got a data error -- remain here until reset */\nvar TYPE$1 = 12;      /* i: waiting for type bits, including last-flag bit */\n\n/*\n   Decode literal, length, and distance codes and write out the resulting\n   literal and match bytes until either not enough input or output is\n   available, an end-of-block is encountered, or a data error is encountered.\n   When large enough input and output buffers are supplied to inflate(), for\n   example, a 16K input buffer and a 64K output buffer, more than 95% of the\n   inflate execution time is spent in this routine.\n\n   Entry assumptions:\n\n        state.mode === LEN\n        strm.avail_in >= 6\n        strm.avail_out >= 258\n        start >= strm.avail_out\n        state.bits < 8\n\n   On return, state.mode is one of:\n\n        LEN -- ran out of enough output space or enough available input\n        TYPE -- reached end of block code, inflate() to interpret next block\n        BAD -- error in block data\n\n   Notes:\n\n    - The maximum input bits used by a length/distance pair is 15 bits for the\n      length code, 5 bits for the length extra, 15 bits for the distance code,\n      and 13 bits for the distance extra.  This totals 48 bits, or six bytes.\n      Therefore if strm.avail_in >= 6, then there is enough input to avoid\n      checking for available input while decoding.\n\n    - The maximum bytes that a single length/distance pair can output is 258\n      bytes, which is the maximum length that can be coded.  inflate_fast()\n      requires strm.avail_out >= 258 for each loop to avoid checking for\n      output space.\n */\n// module.exports =\nfunction inflate_fast(strm, start) {\n  var state;\n  var _in;                    /* local strm.input */\n  var last;                   /* have enough input while in < last */\n  var _out;                   /* local strm.output */\n  var beg;                    /* inflate()'s initial strm.output */\n  var end;                    /* while out < end, enough space available */\n//#ifdef INFLATE_STRICT\n  var dmax;                   /* maximum distance from zlib header */\n//#endif\n  var wsize;                  /* window size or zero if not using window */\n  var whave;                  /* valid bytes in the window */\n  var wnext;                  /* window write index */\n  // Use `s_window` instead `window`, avoid conflict with instrumentation tools\n  var s_window;               /* allocated sliding window, if wsize != 0 */\n  var hold;                   /* local strm.hold */\n  var bits;                   /* local strm.bits */\n  var lcode;                  /* local strm.lencode */\n  var dcode;                  /* local strm.distcode */\n  var lmask;                  /* mask for first level of length codes */\n  var dmask;                  /* mask for first level of distance codes */\n  var here;                   /* retrieved table entry */\n  var op;                     /* code bits, operation, extra bits, or */\n                              /*  window position, window bytes to copy */\n  var len;                    /* match length, unused bytes */\n  var dist;                   /* match distance */\n  var from;                   /* where to copy match from */\n  var from_source;\n\n\n  var input, output; // JS specific, because we have no pointers\n\n  /* copy state to local variables */\n  state = strm.state;\n  //here = state.here;\n  _in = strm.next_in;\n  input = strm.input;\n  last = _in + (strm.avail_in - 5);\n  _out = strm.next_out;\n  output = strm.output;\n  beg = _out - (start - strm.avail_out);\n  end = _out + (strm.avail_out - 257);\n//#ifdef INFLATE_STRICT\n  dmax = state.dmax;\n//#endif\n  wsize = state.wsize;\n  whave = state.whave;\n  wnext = state.wnext;\n  s_window = state.window;\n  hold = state.hold;\n  bits = state.bits;\n  lcode = state.lencode;\n  dcode = state.distcode;\n  lmask = (1 << state.lenbits) - 1;\n  dmask = (1 << state.distbits) - 1;\n\n\n  /* decode literals and length/distances until end-of-block or not enough\n     input data or output space */\n\n  top:\n  do {\n    if (bits < 15) {\n      hold += input[_in++] << bits;\n      bits += 8;\n      hold += input[_in++] << bits;\n      bits += 8;\n    }\n\n    here = lcode[hold & lmask];\n\n    dolen:\n    for (;;) { // Goto emulation\n      op = here >>> 24/*here.bits*/;\n      hold >>>= op;\n      bits -= op;\n      op = (here >>> 16) & 0xff/*here.op*/;\n      if (op === 0) {                          /* literal */\n        //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?\n        //        \"inflate:         literal '%c'\\n\" :\n        //        \"inflate:         literal 0x%02x\\n\", here.val));\n        output[_out++] = here & 0xffff/*here.val*/;\n      }\n      else if (op & 16) {                     /* length base */\n        len = here & 0xffff/*here.val*/;\n        op &= 15;                           /* number of extra bits */\n        if (op) {\n          if (bits < op) {\n            hold += input[_in++] << bits;\n            bits += 8;\n          }\n          len += hold & ((1 << op) - 1);\n          hold >>>= op;\n          bits -= op;\n        }\n        //Tracevv((stderr, \"inflate:         length %u\\n\", len));\n        if (bits < 15) {\n          hold += input[_in++] << bits;\n          bits += 8;\n          hold += input[_in++] << bits;\n          bits += 8;\n        }\n        here = dcode[hold & dmask];\n\n        dodist:\n        for (;;) { // goto emulation\n          op = here >>> 24/*here.bits*/;\n          hold >>>= op;\n          bits -= op;\n          op = (here >>> 16) & 0xff/*here.op*/;\n\n          if (op & 16) {                      /* distance base */\n            dist = here & 0xffff/*here.val*/;\n            op &= 15;                       /* number of extra bits */\n            if (bits < op) {\n              hold += input[_in++] << bits;\n              bits += 8;\n              if (bits < op) {\n                hold += input[_in++] << bits;\n                bits += 8;\n              }\n            }\n            dist += hold & ((1 << op) - 1);\n//#ifdef INFLATE_STRICT\n            if (dist > dmax) {\n              strm.msg = 'invalid distance too far back';\n              state.mode = BAD$1;\n              break top;\n            }\n//#endif\n            hold >>>= op;\n            bits -= op;\n            //Tracevv((stderr, \"inflate:         distance %u\\n\", dist));\n            op = _out - beg;                /* max distance in output */\n            if (dist > op) {                /* see if copy from window */\n              op = dist - op;               /* distance back in window */\n              if (op > whave) {\n                if (state.sane) {\n                  strm.msg = 'invalid distance too far back';\n                  state.mode = BAD$1;\n                  break top;\n                }\n\n// (!) This block is disabled in zlib defailts,\n// don't enable it for binary compatibility\n//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR\n//                if (len <= op - whave) {\n//                  do {\n//                    output[_out++] = 0;\n//                  } while (--len);\n//                  continue top;\n//                }\n//                len -= op - whave;\n//                do {\n//                  output[_out++] = 0;\n//                } while (--op > whave);\n//                if (op === 0) {\n//                  from = _out - dist;\n//                  do {\n//                    output[_out++] = output[from++];\n//                  } while (--len);\n//                  continue top;\n//                }\n//#endif\n              }\n              from = 0; // window index\n              from_source = s_window;\n              if (wnext === 0) {           /* very common case */\n                from += wsize - op;\n                if (op < len) {         /* some from window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = _out - dist;  /* rest from output */\n                  from_source = output;\n                }\n              }\n              else if (wnext < op) {      /* wrap around window */\n                from += wsize + wnext - op;\n                op -= wnext;\n                if (op < len) {         /* some from end of window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = 0;\n                  if (wnext < len) {  /* some from start of window */\n                    op = wnext;\n                    len -= op;\n                    do {\n                      output[_out++] = s_window[from++];\n                    } while (--op);\n                    from = _out - dist;      /* rest from output */\n                    from_source = output;\n                  }\n                }\n              }\n              else {                      /* contiguous in window */\n                from += wnext - op;\n                if (op < len) {         /* some from window */\n                  len -= op;\n                  do {\n                    output[_out++] = s_window[from++];\n                  } while (--op);\n                  from = _out - dist;  /* rest from output */\n                  from_source = output;\n                }\n              }\n              while (len > 2) {\n                output[_out++] = from_source[from++];\n                output[_out++] = from_source[from++];\n                output[_out++] = from_source[from++];\n                len -= 3;\n              }\n              if (len) {\n                output[_out++] = from_source[from++];\n                if (len > 1) {\n                  output[_out++] = from_source[from++];\n                }\n              }\n            }\n            else {\n              from = _out - dist;          /* copy direct from output */\n              do {                        /* minimum length is three */\n                output[_out++] = output[from++];\n                output[_out++] = output[from++];\n                output[_out++] = output[from++];\n                len -= 3;\n              } while (len > 2);\n              if (len) {\n                output[_out++] = output[from++];\n                if (len > 1) {\n                  output[_out++] = output[from++];\n                }\n              }\n            }\n          }\n          else if ((op & 64) === 0) {          /* 2nd level distance code */\n            here = dcode[(here & 0xffff)/*here.val*/ + (hold & ((1 << op) - 1))];\n            continue dodist;\n          }\n          else {\n            strm.msg = 'invalid distance code';\n            state.mode = BAD$1;\n            break top;\n          }\n\n          break; // need to emulate goto via \"continue\"\n        }\n      }\n      else if ((op & 64) === 0) {              /* 2nd level length code */\n        here = lcode[(here & 0xffff)/*here.val*/ + (hold & ((1 << op) - 1))];\n        continue dolen;\n      }\n      else if (op & 32) {                     /* end-of-block */\n        //Tracevv((stderr, \"inflate:         end of block\\n\"));\n        state.mode = TYPE$1;\n        break top;\n      }\n      else {\n        strm.msg = 'invalid literal/length code';\n        state.mode = BAD$1;\n        break top;\n      }\n\n      break; // need to emulate goto via \"continue\"\n    }\n  } while (_in < last && _out < end);\n\n  /* return unused bytes (on entry, bits < 8, so in won't go too far back) */\n  len = bits >> 3;\n  _in -= len;\n  bits -= len << 3;\n  hold &= (1 << bits) - 1;\n\n  /* update state and return */\n  strm.next_in = _in;\n  strm.next_out = _out;\n  strm.avail_in = (_in < last ? 5 + (last - _in) : 5 - (_in - last));\n  strm.avail_out = (_out < end ? 257 + (end - _out) : 257 - (_out - end));\n  state.hold = hold;\n  state.bits = bits;\n  return;\n};\n\n// 'use strict';\n\n\n// var utils = require('../utils/common');\n\nvar MAXBITS = 15;\nvar ENOUGH_LENS$1 = 852;\nvar ENOUGH_DISTS$1 = 592;\n//var ENOUGH = (ENOUGH_LENS+ENOUGH_DISTS);\n\nvar CODES$1 = 0;\nvar LENS$1 = 1;\nvar DISTS$1 = 2;\n\nvar lbase = [ /* Length codes 257..285 base */\n  3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31,\n  35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0\n];\n\nvar lext = [ /* Length codes 257..285 extra */\n  16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 18, 18, 18, 18,\n  19, 19, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 16, 72, 78\n];\n\nvar dbase = [ /* Distance codes 0..29 base */\n  1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193,\n  257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145,\n  8193, 12289, 16385, 24577, 0, 0\n];\n\nvar dext = [ /* Distance codes 0..29 extra */\n  16, 16, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22,\n  23, 23, 24, 24, 25, 25, 26, 26, 27, 27,\n  28, 28, 29, 29, 64, 64\n];\n\n// module.exports =\nfunction inflate_table(type, lens, lens_index, codes, table, table_index, work, opts)\n{\n  var bits = opts.bits;\n      //here = opts.here; /* table entry for duplication */\n\n  var len = 0;               /* a code's length in bits */\n  var sym = 0;               /* index of code symbols */\n  var min = 0, max = 0;          /* minimum and maximum code lengths */\n  var root = 0;              /* number of index bits for root table */\n  var curr = 0;              /* number of index bits for current table */\n  var drop = 0;              /* code bits to drop for sub-table */\n  var left = 0;                   /* number of prefix codes available */\n  var used = 0;              /* code entries in table used */\n  var huff = 0;              /* Huffman code */\n  var incr;              /* for incrementing code, index */\n  var fill;              /* index for replicating entries */\n  var low;               /* low bits for current root entry */\n  var mask;              /* mask for low root bits */\n  var next;             /* next available space in table */\n  var base = null;     /* base value table to use */\n  var base_index = 0;\n//  var shoextra;    /* extra bits table to use */\n  var end;                    /* use base and extra for symbol > end */\n  var count = new Uint16Array(MAXBITS + 1); //[MAXBITS+1];    /* number of codes of each length */\n  var offs = new Uint16Array(MAXBITS + 1); //[MAXBITS+1];     /* offsets in table for each length */\n  var extra = null;\n  var extra_index = 0;\n\n  var here_bits, here_op, here_val;\n\n  /*\n   Process a set of code lengths to create a canonical Huffman code.  The\n   code lengths are lens[0..codes-1].  Each length corresponds to the\n   symbols 0..codes-1.  The Huffman code is generated by first sorting the\n   symbols by length from short to long, and retaining the symbol order\n   for codes with equal lengths.  Then the code starts with all zero bits\n   for the first code of the shortest length, and the codes are integer\n   increments for the same length, and zeros are appended as the length\n   increases.  For the deflate format, these bits are stored backwards\n   from their more natural integer increment ordering, and so when the\n   decoding tables are built in the large loop below, the integer codes\n   are incremented backwards.\n\n   This routine assumes, but does not check, that all of the entries in\n   lens[] are in the range 0..MAXBITS.  The caller must assure this.\n   1..MAXBITS is interpreted as that code length.  zero means that that\n   symbol does not occur in this code.\n\n   The codes are sorted by computing a count of codes for each length,\n   creating from that a table of starting indices for each length in the\n   sorted table, and then entering the symbols in order in the sorted\n   table.  The sorted table is work[], with that space being provided by\n   the caller.\n\n   The length counts are used for other purposes as well, i.e. finding\n   the minimum and maximum length codes, determining if there are any\n   codes at all, checking for a valid set of lengths, and looking ahead\n   at length counts to determine sub-table sizes when building the\n   decoding tables.\n   */\n\n  /* accumulate lengths for codes (assumes lens[] all in 0..MAXBITS) */\n  for (len = 0; len <= MAXBITS; len++) {\n    count[len] = 0;\n  }\n  for (sym = 0; sym < codes; sym++) {\n    count[lens[lens_index + sym]]++;\n  }\n\n  /* bound code lengths, force root to be within code lengths */\n  root = bits;\n  for (max = MAXBITS; max >= 1; max--) {\n    if (count[max] !== 0) { break; }\n  }\n  if (root > max) {\n    root = max;\n  }\n  if (max === 0) {                     /* no symbols to code at all */\n    //table.op[opts.table_index] = 64;  //here.op = (var char)64;    /* invalid code marker */\n    //table.bits[opts.table_index] = 1;   //here.bits = (var char)1;\n    //table.val[opts.table_index++] = 0;   //here.val = (var short)0;\n    table[table_index++] = (1 << 24) | (64 << 16) | 0;\n\n\n    //table.op[opts.table_index] = 64;\n    //table.bits[opts.table_index] = 1;\n    //table.val[opts.table_index++] = 0;\n    table[table_index++] = (1 << 24) | (64 << 16) | 0;\n\n    opts.bits = 1;\n    return 0;     /* no symbols, but wait for decoding to report error */\n  }\n  for (min = 1; min < max; min++) {\n    if (count[min] !== 0) { break; }\n  }\n  if (root < min) {\n    root = min;\n  }\n\n  /* check for an over-subscribed or incomplete set of lengths */\n  left = 1;\n  for (len = 1; len <= MAXBITS; len++) {\n    left <<= 1;\n    left -= count[len];\n    if (left < 0) {\n      return -1;\n    }        /* over-subscribed */\n  }\n  if (left > 0 && (type === CODES$1 || max !== 1)) {\n    return -1;                      /* incomplete set */\n  }\n\n  /* generate offsets into symbol table for each length for sorting */\n  offs[1] = 0;\n  for (len = 1; len < MAXBITS; len++) {\n    offs[len + 1] = offs[len] + count[len];\n  }\n\n  /* sort symbols by length, by symbol order within each length */\n  for (sym = 0; sym < codes; sym++) {\n    if (lens[lens_index + sym] !== 0) {\n      work[offs[lens[lens_index + sym]]++] = sym;\n    }\n  }\n\n  /*\n   Create and fill in decoding tables.  In this loop, the table being\n   filled is at next and has curr index bits.  The code being used is huff\n   with length len.  That code is converted to an index by dropping drop\n   bits off of the bottom.  For codes where len is less than drop + curr,\n   those top drop + curr - len bits are incremented through all values to\n   fill the table with replicated entries.\n\n   root is the number of index bits for the root table.  When len exceeds\n   root, sub-tables are created pointed to by the root entry with an index\n   of the low root bits of huff.  This is saved in low to check for when a\n   new sub-table should be started.  drop is zero when the root table is\n   being filled, and drop is root when sub-tables are being filled.\n\n   When a new sub-table is needed, it is necessary to look ahead in the\n   code lengths to determine what size sub-table is needed.  The length\n   counts are used for this, and so count[] is decremented as codes are\n   entered in the tables.\n\n   used keeps track of how many table entries have been allocated from the\n   provided *table space.  It is checked for LENS and DIST tables against\n   the constants ENOUGH_LENS and ENOUGH_DISTS to guard against changes in\n   the initial root table size constants.  See the comments in inftrees.h\n   for more information.\n\n   sym increments through all symbols, and the loop terminates when\n   all codes of length max, i.e. all codes, have been processed.  This\n   routine permits incomplete codes, so another loop after this one fills\n   in the rest of the decoding tables with invalid code markers.\n   */\n\n  /* set up for code type */\n  // poor man optimization - use if-else instead of switch,\n  // to avoid deopts in old v8\n  if (type === CODES$1) {\n    base = extra = work;    /* dummy value--not used */\n    end = 19;\n\n  } else if (type === LENS$1) {\n    base = lbase;\n    base_index -= 257;\n    extra = lext;\n    extra_index -= 257;\n    end = 256;\n\n  } else {                    /* DISTS */\n    base = dbase;\n    extra = dext;\n    end = -1;\n  }\n\n  /* initialize opts for loop */\n  huff = 0;                   /* starting code */\n  sym = 0;                    /* starting code symbol */\n  len = min;                  /* starting code length */\n  next = table_index;              /* current table to fill in */\n  curr = root;                /* current table index bits */\n  drop = 0;                   /* current bits to drop from code for index */\n  low = -1;                   /* trigger new sub-table when len > root */\n  used = 1 << root;          /* use root table entries */\n  mask = used - 1;            /* mask for comparing low */\n\n  /* check available table space */\n  if ((type === LENS$1 && used > ENOUGH_LENS$1) ||\n    (type === DISTS$1 && used > ENOUGH_DISTS$1)) {\n    return 1;\n  }\n\n  var i = 0;\n  /* process all codes and make table entries */\n  for (;;) {\n    i++;\n    /* create table entry */\n    here_bits = len - drop;\n    if (work[sym] < end) {\n      here_op = 0;\n      here_val = work[sym];\n    }\n    else if (work[sym] > end) {\n      here_op = extra[extra_index + work[sym]];\n      here_val = base[base_index + work[sym]];\n    }\n    else {\n      here_op = 32 + 64;         /* end of block */\n      here_val = 0;\n    }\n\n    /* replicate for those indices with low len bits equal to huff */\n    incr = 1 << (len - drop);\n    fill = 1 << curr;\n    min = fill;                 /* save offset to next table */\n    do {\n      fill -= incr;\n      table[next + (huff >> drop) + fill] = (here_bits << 24) | (here_op << 16) | here_val |0;\n    } while (fill !== 0);\n\n    /* backwards increment the len-bit code huff */\n    incr = 1 << (len - 1);\n    while (huff & incr) {\n      incr >>= 1;\n    }\n    if (incr !== 0) {\n      huff &= incr - 1;\n      huff += incr;\n    } else {\n      huff = 0;\n    }\n\n    /* go to next symbol, update count, len */\n    sym++;\n    if (--count[len] === 0) {\n      if (len === max) { break; }\n      len = lens[lens_index + work[sym]];\n    }\n\n    /* create new sub-table if needed */\n    if (len > root && (huff & mask) !== low) {\n      /* if first time, transition to sub-tables */\n      if (drop === 0) {\n        drop = root;\n      }\n\n      /* increment past last table */\n      next += min;            /* here min is 1 << curr */\n\n      /* determine length of next table */\n      curr = len - drop;\n      left = 1 << curr;\n      while (curr + drop < max) {\n        left -= count[curr + drop];\n        if (left <= 0) { break; }\n        curr++;\n        left <<= 1;\n      }\n\n      /* check for enough space */\n      used += 1 << curr;\n      if ((type === LENS$1 && used > ENOUGH_LENS$1) ||\n        (type === DISTS$1 && used > ENOUGH_DISTS$1)) {\n        return 1;\n      }\n\n      /* point entry in root table to sub-table */\n      low = huff & mask;\n      /*table.op[low] = curr;\n      table.bits[low] = root;\n      table.val[low] = next - opts.table_index;*/\n      table[low] = (root << 24) | (curr << 16) | (next - table_index) |0;\n    }\n  }\n\n  /* fill in remaining table entry if code is incomplete (guaranteed to have\n   at most one remaining entry, since if the code is incomplete, the\n   maximum code length that was allowed to get this far is one bit) */\n  if (huff !== 0) {\n    //table.op[next + huff] = 64;            /* invalid code marker */\n    //table.bits[next + huff] = len - drop;\n    //table.val[next + huff] = 0;\n    table[next + huff] = ((len - drop) << 24) | (64 << 16) |0;\n  }\n\n  /* set return parameters */\n  //opts.table_index += used;\n  opts.bits = root;\n  return 0;\n};\n\n// 'use strict';\n\n\n// var utils         = require('../utils/common');\n// var adler32       = require('./adler32');\n// var crc32         = require('./crc32');\n// var inflate_fast  = require('./inffast');\n// var inflate_table = require('./inftrees');\n\nvar CODES = 0;\nvar LENS = 1;\nvar DISTS = 2;\n\n/* Public constants ==========================================================*/\n/* ===========================================================================*/\n\n\n/* Allowed flush values; see deflate() and inflate() below for details */\n//var Z_NO_FLUSH      = 0;\n//var Z_PARTIAL_FLUSH = 1;\n//var Z_SYNC_FLUSH    = 2;\n//var Z_FULL_FLUSH    = 3;\nvar Z_FINISH        = 4;\nvar Z_BLOCK         = 5;\nvar Z_TREES         = 6;\n\n\n/* Return codes for the compression/decompression functions. Negative values\n * are errors, positive values are used for special but normal events.\n */\nvar Z_OK            = 0;\nvar Z_STREAM_END    = 1;\nvar Z_NEED_DICT     = 2;\n//var Z_ERRNO         = -1;\nvar Z_STREAM_ERROR  = -2;\nvar Z_DATA_ERROR    = -3;\nvar Z_MEM_ERROR     = -4;\nvar Z_BUF_ERROR     = -5;\n//var Z_VERSION_ERROR = -6;\n\n/* The deflate compression method */\nvar Z_DEFLATED  = 8;\n\n\n/* STATES ====================================================================*/\n/* ===========================================================================*/\n\n\nvar    HEAD = 1;       /* i: waiting for magic header */\nvar    FLAGS = 2;      /* i: waiting for method and flags (gzip) */\nvar    TIME = 3;       /* i: waiting for modification time (gzip) */\nvar    OS = 4;         /* i: waiting for extra flags and operating system (gzip) */\nvar    EXLEN = 5;      /* i: waiting for extra length (gzip) */\nvar    EXTRA = 6;      /* i: waiting for extra bytes (gzip) */\nvar    NAME = 7;       /* i: waiting for end of file name (gzip) */\nvar    COMMENT = 8;    /* i: waiting for end of comment (gzip) */\nvar    HCRC = 9;       /* i: waiting for header crc (gzip) */\nvar    DICTID = 10;    /* i: waiting for dictionary check value */\nvar    DICT = 11;      /* waiting for inflateSetDictionary() call */\nvar        TYPE = 12;      /* i: waiting for type bits, including last-flag bit */\nvar        TYPEDO = 13;    /* i: same, but skip check to exit inflate on new block */\nvar        STORED = 14;    /* i: waiting for stored size (length and complement) */\nvar        COPY_ = 15;     /* i/o: same as COPY below, but only first time in */\nvar        COPY = 16;      /* i/o: waiting for input or output to copy stored block */\nvar        TABLE = 17;     /* i: waiting for dynamic block table lengths */\nvar        LENLENS = 18;   /* i: waiting for code length code lengths */\nvar        CODELENS = 19;  /* i: waiting for length/lit and distance code lengths */\nvar            LEN_ = 20;      /* i: same as LEN below, but only first time in */\nvar            LEN = 21;       /* i: waiting for length/lit/eob code */\nvar            LENEXT = 22;    /* i: waiting for length extra bits */\nvar            DIST = 23;      /* i: waiting for distance code */\nvar            DISTEXT = 24;   /* i: waiting for distance extra bits */\nvar            MATCH = 25;     /* o: waiting for output space to copy string */\nvar            LIT = 26;       /* o: waiting for output space to write literal */\nvar    CHECK = 27;     /* i: waiting for 32-bit check value */\nvar    LENGTH = 28;    /* i: waiting for 32-bit length (gzip) */\nvar    DONE = 29;      /* finished check, done -- remain here until reset */\nvar    BAD = 30;       /* got a data error -- remain here until reset */\nvar    MEM = 31;       /* got an inflate() memory error -- remain here until reset */\nvar    SYNC = 32;      /* looking for synchronization bytes to restart inflate() */\n\n/* ===========================================================================*/\n\n\n\nvar ENOUGH_LENS = 852;\nvar ENOUGH_DISTS = 592;\nfunction zswap32(q) {\n  return  (((q >>> 24) & 0xff) +\n          ((q >>> 8) & 0xff00) +\n          ((q & 0xff00) << 8) +\n          ((q & 0xff) << 24));\n}\n\n\nfunction InflateState() {\n  this.mode = 0;             /* current inflate mode */\n  this.last = false;          /* true if processing last block */\n  this.wrap = 0;              /* bit 0 true for zlib, bit 1 true for gzip */\n  this.havedict = false;      /* true if dictionary provided */\n  this.flags = 0;             /* gzip header method and flags (0 if zlib) */\n  this.dmax = 0;              /* zlib header max distance (INFLATE_STRICT) */\n  this.check = 0;             /* protected copy of check value */\n  this.total = 0;             /* protected copy of output count */\n  // TODO: may be {}\n  this.head = null;           /* where to save gzip header information */\n\n  /* sliding window */\n  this.wbits = 0;             /* log base 2 of requested window size */\n  this.wsize = 0;             /* window size or zero if not using window */\n  this.whave = 0;             /* valid bytes in the window */\n  this.wnext = 0;             /* window write index */\n  this.window = null;         /* allocated sliding window, if needed */\n\n  /* bit accumulator */\n  this.hold = 0;              /* input bit accumulator */\n  this.bits = 0;              /* number of bits in \"in\" */\n\n  /* for string and stored block copying */\n  this.length = 0;            /* literal or length of data to copy */\n  this.offset = 0;            /* distance back to copy string from */\n\n  /* for table and code decoding */\n  this.extra = 0;             /* extra bits needed */\n\n  /* fixed and dynamic code tables */\n  this.lencode = null;          /* starting table for length/literal codes */\n  this.distcode = null;         /* starting table for distance codes */\n  this.lenbits = 0;           /* index bits for lencode */\n  this.distbits = 0;          /* index bits for distcode */\n\n  /* dynamic table building */\n  this.ncode = 0;             /* number of code length code lengths */\n  this.nlen = 0;              /* number of length code lengths */\n  this.ndist = 0;             /* number of distance code lengths */\n  this.have = 0;              /* number of code lengths in lens[] */\n  this.next = null;              /* next available space in codes[] */\n\n  this.lens = new Uint16Array(320); /* temporary storage for code lengths */\n  this.work = new Uint16Array(288); /* work area for code table building */\n\n  /*\n   because we don't have pointers in js, we use lencode and distcode directly\n   as buffers so we don't need codes\n  */\n  //this.codes = new Buf32(ENOUGH);       /* space for code tables */\n  this.lendyn = null;              /* dynamic table for length/literal codes (JS specific) */\n  this.distdyn = null;             /* dynamic table for distance codes (JS specific) */\n  this.sane = 0;                   /* if false, allow invalid distance too far */\n  this.back = 0;                   /* bits back of last unprocessed length/lit */\n  this.was = 0;                    /* initial length of match */\n}\n\nfunction inflateResetKeep(strm) {\n  var state;\n\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  strm.total_in = strm.total_out = state.total = 0;\n  strm.msg = ''; /*Z_NULL*/\n  if (state.wrap) {       /* to support ill-conceived Java test suite */\n    strm.adler = state.wrap & 1;\n  }\n  state.mode = HEAD;\n  state.last = 0;\n  state.havedict = 0;\n  state.dmax = 32768;\n  state.head = null/*Z_NULL*/;\n  state.hold = 0;\n  state.bits = 0;\n  //state.lencode = state.distcode = state.next = state.codes;\n  state.lencode = state.lendyn = new Int32Array(ENOUGH_LENS);\n  state.distcode = state.distdyn = new Int32Array(ENOUGH_DISTS);\n\n  state.sane = 1;\n  state.back = -1;\n  //Tracev((stderr, \"inflate: reset\\n\"));\n  return Z_OK;\n}\n\nfunction inflateReset(strm) {\n  var state;\n\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  state.wsize = 0;\n  state.whave = 0;\n  state.wnext = 0;\n  return inflateResetKeep(strm);\n\n}\n\nfunction inflateReset2(strm, windowBits) {\n  var wrap;\n  var state;\n\n  /* get the state */\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n\n  /* extract wrap request from windowBits parameter */\n  if (windowBits < 0) {\n    wrap = 0;\n    windowBits = -windowBits;\n  }\n  else {\n    wrap = (windowBits >> 4) + 1;\n    if (windowBits < 48) {\n      windowBits &= 15;\n    }\n  }\n\n  /* set number of window bits, free window if different */\n  if (windowBits && (windowBits < 8 || windowBits > 15)) {\n    return Z_STREAM_ERROR;\n  }\n  if (state.window !== null && state.wbits !== windowBits) {\n    state.window = null;\n  }\n\n  /* update state and reset the rest of it */\n  state.wrap = wrap;\n  state.wbits = windowBits;\n  return inflateReset(strm);\n}\n\nfunction inflateInit2(strm, windowBits) {\n  var ret;\n  var state;\n\n  if (!strm) { return Z_STREAM_ERROR; }\n  //strm.msg = Z_NULL;                 /* in case we return an error */\n\n  state = new InflateState();\n\n  //if (state === Z_NULL) return Z_MEM_ERROR;\n  //Tracev((stderr, \"inflate: allocated\\n\"));\n  strm.state = state;\n  state.window = null/*Z_NULL*/;\n  ret = inflateReset2(strm, windowBits);\n  if (ret !== Z_OK) {\n    strm.state = null/*Z_NULL*/;\n  }\n  return ret;\n}\n\n/*\n Return state with length and distance decoding tables and index sizes set to\n fixed code decoding.  Normally this returns fixed tables from inffixed.h.\n If BUILDFIXED is defined, then instead this routine builds the tables the\n first time it's called, and returns those tables the first time and\n thereafter.  This reduces the size of the code by about 2K bytes, in\n exchange for a little execution time.  However, BUILDFIXED should not be\n used for threaded applications, since the rewriting of the tables and virgin\n may not be thread-safe.\n */\nvar virgin = true;\n\nvar lenfix;\nvar distfix;\n// We have no pointers in JS, so keep tables separate\n\nfunction fixedtables(state) {\n  /* build fixed huffman tables if first call (may not be thread safe) */\n  if (virgin) {\n    var sym;\n\n    lenfix = new Int32Array(512);\n    distfix = new Int32Array(32);\n\n    /* literal/length table */\n    sym = 0;\n    while (sym < 144) { state.lens[sym++] = 8; }\n    while (sym < 256) { state.lens[sym++] = 9; }\n    while (sym < 280) { state.lens[sym++] = 7; }\n    while (sym < 288) { state.lens[sym++] = 8; }\n\n    inflate_table(LENS,  state.lens, 0, 288, lenfix,   0, state.work, { bits: 9 });\n\n    /* distance table */\n    sym = 0;\n    while (sym < 32) { state.lens[sym++] = 5; }\n\n    inflate_table(DISTS, state.lens, 0, 32,   distfix, 0, state.work, { bits: 5 });\n\n    /* do this just once */\n    virgin = false;\n  }\n\n  state.lencode = lenfix;\n  state.lenbits = 9;\n  state.distcode = distfix;\n  state.distbits = 5;\n}\n\n\n/*\n Update the window with the last wsize (normally 32K) bytes written before\n returning.  If window does not exist yet, create it.  This is only called\n when a window is already in use, or when output has been written during this\n inflate call, but the end of the deflate stream has not been reached yet.\n It is also called to create a window for dictionary data when a dictionary\n is loaded.\n\n Providing output buffers larger than 32K to inflate() should provide a speed\n advantage, since only the last 32K of output is copied to the sliding window\n upon return from inflate(), and since all distances after the first 32K of\n output will fall in the output data, making match copies simpler and faster.\n The advantage may be dependent on the size of the processor's data caches.\n */\nfunction updatewindow(strm, src, end, copy) {\n  var dist;\n  var state = strm.state;\n\n  /* if it hasn't been done already, allocate space for the window */\n  if (state.window === null) {\n    state.wsize = 1 << state.wbits;\n    state.wnext = 0;\n    state.whave = 0;\n\n    state.window = new Uint8Array(state.wsize);\n  }\n\n  /* copy state->wsize or less output bytes into the circular window */\n  if (copy >= state.wsize) {\n    arraySet(state.window, src, end - state.wsize, state.wsize, 0);\n    state.wnext = 0;\n    state.whave = state.wsize;\n  }\n  else {\n    dist = state.wsize - state.wnext;\n    if (dist > copy) {\n      dist = copy;\n    }\n    //zmemcpy(state->window + state->wnext, end - copy, dist);\n    arraySet(state.window, src, end - copy, dist, state.wnext);\n    copy -= dist;\n    if (copy) {\n      //zmemcpy(state->window, end - copy, copy);\n      arraySet(state.window, src, end - copy, copy, 0);\n      state.wnext = copy;\n      state.whave = state.wsize;\n    }\n    else {\n      state.wnext += dist;\n      if (state.wnext === state.wsize) { state.wnext = 0; }\n      if (state.whave < state.wsize) { state.whave += dist; }\n    }\n  }\n  return 0;\n}\n\nfunction inflate(strm, flush) {\n  var state;\n  var input, output;          // input/output buffers\n  var next;                   /* next input INDEX */\n  var put;                    /* next output INDEX */\n  var have, left;             /* available input and output */\n  var hold;                   /* bit buffer */\n  var bits;                   /* bits in bit buffer */\n  var _in, _out;              /* save starting available input and output */\n  var copy;                   /* number of stored or match bytes to copy */\n  var from;                   /* where to copy match bytes from */\n  var from_source;\n  var here = 0;               /* current decoding table entry */\n  var here_bits, here_op, here_val; // paked \"here\" denormalized (JS specific)\n  //var last;                   /* parent table entry */\n  var last_bits, last_op, last_val; // paked \"last\" denormalized (JS specific)\n  var len;                    /* length to copy for repeats, bits to drop */\n  var ret;                    /* return code */\n  var hbuf = new Uint8Array(4);    /* buffer for gzip header crc calculation */\n  var opts;\n\n  var n; // temporary var for NEED_BITS\n\n  var order = /* permutation of code lengths */\n    [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ];\n\n\n  if (!strm || !strm.state || !strm.output ||\n      (!strm.input && strm.avail_in !== 0)) {\n    return Z_STREAM_ERROR;\n  }\n\n  state = strm.state;\n  if (state.mode === TYPE) { state.mode = TYPEDO; }    /* skip check */\n\n\n  //--- LOAD() ---\n  put = strm.next_out;\n  output = strm.output;\n  left = strm.avail_out;\n  next = strm.next_in;\n  input = strm.input;\n  have = strm.avail_in;\n  hold = state.hold;\n  bits = state.bits;\n  //---\n\n  _in = have;\n  _out = left;\n  ret = Z_OK;\n\n  inf_leave: // goto emulation\n  for (;;) {\n    switch (state.mode) {\n    case HEAD:\n      if (state.wrap === 0) {\n        state.mode = TYPEDO;\n        break;\n      }\n      //=== NEEDBITS(16);\n      while (bits < 16) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if ((state.wrap & 2) && hold === 0x8b1f) {  /* gzip header */\n        state.check = 0/*crc32(0L, Z_NULL, 0)*/;\n        //=== CRC2(state.check, hold);\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        state.check = crc32(state.check, hbuf, 2, 0);\n        //===//\n\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        state.mode = FLAGS;\n        break;\n      }\n      state.flags = 0;           /* expect zlib header */\n      if (state.head) {\n        state.head.done = false;\n      }\n      if (!(state.wrap & 1) ||   /* check if zlib header allowed */\n        (((hold & 0xff)/*BITS(8)*/ << 8) + (hold >> 8)) % 31) {\n        strm.msg = 'incorrect header check';\n        state.mode = BAD;\n        break;\n      }\n      if ((hold & 0x0f)/*BITS(4)*/ !== Z_DEFLATED) {\n        strm.msg = 'unknown compression method';\n        state.mode = BAD;\n        break;\n      }\n      //--- DROPBITS(4) ---//\n      hold >>>= 4;\n      bits -= 4;\n      //---//\n      len = (hold & 0x0f)/*BITS(4)*/ + 8;\n      if (state.wbits === 0) {\n        state.wbits = len;\n      }\n      else if (len > state.wbits) {\n        strm.msg = 'invalid window size';\n        state.mode = BAD;\n        break;\n      }\n      state.dmax = 1 << len;\n      //Tracev((stderr, \"inflate:   zlib header ok\\n\"));\n      strm.adler = state.check = 1/*adler32(0L, Z_NULL, 0)*/;\n      state.mode = hold & 0x200 ? DICTID : TYPE;\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      break;\n    case FLAGS:\n      //=== NEEDBITS(16); */\n      while (bits < 16) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      state.flags = hold;\n      if ((state.flags & 0xff) !== Z_DEFLATED) {\n        strm.msg = 'unknown compression method';\n        state.mode = BAD;\n        break;\n      }\n      if (state.flags & 0xe000) {\n        strm.msg = 'unknown header flags set';\n        state.mode = BAD;\n        break;\n      }\n      if (state.head) {\n        state.head.text = ((hold >> 8) & 1);\n      }\n      if (state.flags & 0x0200) {\n        //=== CRC2(state.check, hold);\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        state.check = crc32(state.check, hbuf, 2, 0);\n        //===//\n      }\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = TIME;\n      /* falls through */\n    case TIME:\n      //=== NEEDBITS(32); */\n      while (bits < 32) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if (state.head) {\n        state.head.time = hold;\n      }\n      if (state.flags & 0x0200) {\n        //=== CRC4(state.check, hold)\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        hbuf[2] = (hold >>> 16) & 0xff;\n        hbuf[3] = (hold >>> 24) & 0xff;\n        state.check = crc32(state.check, hbuf, 4, 0);\n        //===\n      }\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = OS;\n      /* falls through */\n    case OS:\n      //=== NEEDBITS(16); */\n      while (bits < 16) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if (state.head) {\n        state.head.xflags = (hold & 0xff);\n        state.head.os = (hold >> 8);\n      }\n      if (state.flags & 0x0200) {\n        //=== CRC2(state.check, hold);\n        hbuf[0] = hold & 0xff;\n        hbuf[1] = (hold >>> 8) & 0xff;\n        state.check = crc32(state.check, hbuf, 2, 0);\n        //===//\n      }\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = EXLEN;\n      /* falls through */\n    case EXLEN:\n      if (state.flags & 0x0400) {\n        //=== NEEDBITS(16); */\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.length = hold;\n        if (state.head) {\n          state.head.extra_len = hold;\n        }\n        if (state.flags & 0x0200) {\n          //=== CRC2(state.check, hold);\n          hbuf[0] = hold & 0xff;\n          hbuf[1] = (hold >>> 8) & 0xff;\n          state.check = crc32(state.check, hbuf, 2, 0);\n          //===//\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n      }\n      else if (state.head) {\n        state.head.extra = null/*Z_NULL*/;\n      }\n      state.mode = EXTRA;\n      /* falls through */\n    case EXTRA:\n      if (state.flags & 0x0400) {\n        copy = state.length;\n        if (copy > have) { copy = have; }\n        if (copy) {\n          if (state.head) {\n            len = state.head.extra_len - state.length;\n            if (!state.head.extra) {\n              // Use untyped array for more conveniend processing later\n              state.head.extra = new Array(state.head.extra_len);\n            }\n            arraySet(\n              state.head.extra,\n              input,\n              next,\n              // extra field is limited to 65536 bytes\n              // - no need for additional size check\n              copy,\n              /*len + copy > state.head.extra_max - len ? state.head.extra_max : copy,*/\n              len\n            );\n            //zmemcpy(state.head.extra + len, next,\n            //        len + copy > state.head.extra_max ?\n            //        state.head.extra_max - len : copy);\n          }\n          if (state.flags & 0x0200) {\n            state.check = crc32(state.check, input, copy, next);\n          }\n          have -= copy;\n          next += copy;\n          state.length -= copy;\n        }\n        if (state.length) { break inf_leave; }\n      }\n      state.length = 0;\n      state.mode = NAME;\n      /* falls through */\n    case NAME:\n      if (state.flags & 0x0800) {\n        if (have === 0) { break inf_leave; }\n        copy = 0;\n        do {\n          // TODO: 2 or 1 bytes?\n          len = input[next + copy++];\n          /* use constant limit because in js we should not preallocate memory */\n          if (state.head && len &&\n              (state.length < 65536 /*state.head.name_max*/)) {\n            state.head.name += String.fromCharCode(len);\n          }\n        } while (len && copy < have);\n\n        if (state.flags & 0x0200) {\n          state.check = crc32(state.check, input, copy, next);\n        }\n        have -= copy;\n        next += copy;\n        if (len) { break inf_leave; }\n      }\n      else if (state.head) {\n        state.head.name = null;\n      }\n      state.length = 0;\n      state.mode = COMMENT;\n      /* falls through */\n    case COMMENT:\n      if (state.flags & 0x1000) {\n        if (have === 0) { break inf_leave; }\n        copy = 0;\n        do {\n          len = input[next + copy++];\n          /* use constant limit because in js we should not preallocate memory */\n          if (state.head && len &&\n              (state.length < 65536 /*state.head.comm_max*/)) {\n            state.head.comment += String.fromCharCode(len);\n          }\n        } while (len && copy < have);\n        if (state.flags & 0x0200) {\n          state.check = crc32(state.check, input, copy, next);\n        }\n        have -= copy;\n        next += copy;\n        if (len) { break inf_leave; }\n      }\n      else if (state.head) {\n        state.head.comment = null;\n      }\n      state.mode = HCRC;\n      /* falls through */\n    case HCRC:\n      if (state.flags & 0x0200) {\n        //=== NEEDBITS(16); */\n        while (bits < 16) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if (hold !== (state.check & 0xffff)) {\n          strm.msg = 'header crc mismatch';\n          state.mode = BAD;\n          break;\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n      }\n      if (state.head) {\n        state.head.hcrc = ((state.flags >> 9) & 1);\n        state.head.done = true;\n      }\n      strm.adler = state.check = 0;\n      state.mode = TYPE;\n      break;\n    case DICTID:\n      //=== NEEDBITS(32); */\n      while (bits < 32) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      strm.adler = state.check = zswap32(hold);\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = DICT;\n      /* falls through */\n    case DICT:\n      if (state.havedict === 0) {\n        //--- RESTORE() ---\n        strm.next_out = put;\n        strm.avail_out = left;\n        strm.next_in = next;\n        strm.avail_in = have;\n        state.hold = hold;\n        state.bits = bits;\n        //---\n        return Z_NEED_DICT;\n      }\n      strm.adler = state.check = 1/*adler32(0L, Z_NULL, 0)*/;\n      state.mode = TYPE;\n      /* falls through */\n    case TYPE:\n      if (flush === Z_BLOCK || flush === Z_TREES) { break inf_leave; }\n      /* falls through */\n    case TYPEDO:\n      if (state.last) {\n        //--- BYTEBITS() ---//\n        hold >>>= bits & 7;\n        bits -= bits & 7;\n        //---//\n        state.mode = CHECK;\n        break;\n      }\n      //=== NEEDBITS(3); */\n      while (bits < 3) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      state.last = (hold & 0x01)/*BITS(1)*/;\n      //--- DROPBITS(1) ---//\n      hold >>>= 1;\n      bits -= 1;\n      //---//\n\n      switch ((hold & 0x03)/*BITS(2)*/) {\n      case 0:                             /* stored block */\n        //Tracev((stderr, \"inflate:     stored block%s\\n\",\n        //        state.last ? \" (last)\" : \"\"));\n        state.mode = STORED;\n        break;\n      case 1:                             /* fixed block */\n        fixedtables(state);\n        //Tracev((stderr, \"inflate:     fixed codes block%s\\n\",\n        //        state.last ? \" (last)\" : \"\"));\n        state.mode = LEN_;             /* decode codes */\n        if (flush === Z_TREES) {\n          //--- DROPBITS(2) ---//\n          hold >>>= 2;\n          bits -= 2;\n          //---//\n          break inf_leave;\n        }\n        break;\n      case 2:                             /* dynamic block */\n        //Tracev((stderr, \"inflate:     dynamic codes block%s\\n\",\n        //        state.last ? \" (last)\" : \"\"));\n        state.mode = TABLE;\n        break;\n      case 3:\n        strm.msg = 'invalid block type';\n        state.mode = BAD;\n      }\n      //--- DROPBITS(2) ---//\n      hold >>>= 2;\n      bits -= 2;\n      //---//\n      break;\n    case STORED:\n      //--- BYTEBITS() ---// /* go to byte boundary */\n      hold >>>= bits & 7;\n      bits -= bits & 7;\n      //---//\n      //=== NEEDBITS(32); */\n      while (bits < 32) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      if ((hold & 0xffff) !== ((hold >>> 16) ^ 0xffff)) {\n        strm.msg = 'invalid stored block lengths';\n        state.mode = BAD;\n        break;\n      }\n      state.length = hold & 0xffff;\n      //Tracev((stderr, \"inflate:       stored length %u\\n\",\n      //        state.length));\n      //=== INITBITS();\n      hold = 0;\n      bits = 0;\n      //===//\n      state.mode = COPY_;\n      if (flush === Z_TREES) { break inf_leave; }\n      /* falls through */\n    case COPY_:\n      state.mode = COPY;\n      /* falls through */\n    case COPY:\n      copy = state.length;\n      if (copy) {\n        if (copy > have) { copy = have; }\n        if (copy > left) { copy = left; }\n        if (copy === 0) { break inf_leave; }\n        //--- zmemcpy(put, next, copy); ---\n        arraySet(output, input, next, copy, put);\n        //---//\n        have -= copy;\n        next += copy;\n        left -= copy;\n        put += copy;\n        state.length -= copy;\n        break;\n      }\n      //Tracev((stderr, \"inflate:       stored end\\n\"));\n      state.mode = TYPE;\n      break;\n    case TABLE:\n      //=== NEEDBITS(14); */\n      while (bits < 14) {\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n      }\n      //===//\n      state.nlen = (hold & 0x1f)/*BITS(5)*/ + 257;\n      //--- DROPBITS(5) ---//\n      hold >>>= 5;\n      bits -= 5;\n      //---//\n      state.ndist = (hold & 0x1f)/*BITS(5)*/ + 1;\n      //--- DROPBITS(5) ---//\n      hold >>>= 5;\n      bits -= 5;\n      //---//\n      state.ncode = (hold & 0x0f)/*BITS(4)*/ + 4;\n      //--- DROPBITS(4) ---//\n      hold >>>= 4;\n      bits -= 4;\n      //---//\n//#ifndef PKZIP_BUG_WORKAROUND\n      if (state.nlen > 286 || state.ndist > 30) {\n        strm.msg = 'too many length or distance symbols';\n        state.mode = BAD;\n        break;\n      }\n//#endif\n      //Tracev((stderr, \"inflate:       table sizes ok\\n\"));\n      state.have = 0;\n      state.mode = LENLENS;\n      /* falls through */\n    case LENLENS:\n      while (state.have < state.ncode) {\n        //=== NEEDBITS(3);\n        while (bits < 3) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.lens[order[state.have++]] = (hold & 0x07);//BITS(3);\n        //--- DROPBITS(3) ---//\n        hold >>>= 3;\n        bits -= 3;\n        //---//\n      }\n      while (state.have < 19) {\n        state.lens[order[state.have++]] = 0;\n      }\n      // We have separate tables & no pointers. 2 commented lines below not needed.\n      //state.next = state.codes;\n      //state.lencode = state.next;\n      // Switch to use dynamic table\n      state.lencode = state.lendyn;\n      state.lenbits = 7;\n\n      opts = { bits: state.lenbits };\n      ret = inflate_table(CODES, state.lens, 0, 19, state.lencode, 0, state.work, opts);\n      state.lenbits = opts.bits;\n\n      if (ret) {\n        strm.msg = 'invalid code lengths set';\n        state.mode = BAD;\n        break;\n      }\n      //Tracev((stderr, \"inflate:       code lengths ok\\n\"));\n      state.have = 0;\n      state.mode = CODELENS;\n      /* falls through */\n    case CODELENS:\n      while (state.have < state.nlen + state.ndist) {\n        for (;;) {\n          here = state.lencode[hold & ((1 << state.lenbits) - 1)];/*BITS(state.lenbits)*/\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        if (here_val < 16) {\n          //--- DROPBITS(here.bits) ---//\n          hold >>>= here_bits;\n          bits -= here_bits;\n          //---//\n          state.lens[state.have++] = here_val;\n        }\n        else {\n          if (here_val === 16) {\n            //=== NEEDBITS(here.bits + 2);\n            n = here_bits + 2;\n            while (bits < n) {\n              if (have === 0) { break inf_leave; }\n              have--;\n              hold += input[next++] << bits;\n              bits += 8;\n            }\n            //===//\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            if (state.have === 0) {\n              strm.msg = 'invalid bit length repeat';\n              state.mode = BAD;\n              break;\n            }\n            len = state.lens[state.have - 1];\n            copy = 3 + (hold & 0x03);//BITS(2);\n            //--- DROPBITS(2) ---//\n            hold >>>= 2;\n            bits -= 2;\n            //---//\n          }\n          else if (here_val === 17) {\n            //=== NEEDBITS(here.bits + 3);\n            n = here_bits + 3;\n            while (bits < n) {\n              if (have === 0) { break inf_leave; }\n              have--;\n              hold += input[next++] << bits;\n              bits += 8;\n            }\n            //===//\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            len = 0;\n            copy = 3 + (hold & 0x07);//BITS(3);\n            //--- DROPBITS(3) ---//\n            hold >>>= 3;\n            bits -= 3;\n            //---//\n          }\n          else {\n            //=== NEEDBITS(here.bits + 7);\n            n = here_bits + 7;\n            while (bits < n) {\n              if (have === 0) { break inf_leave; }\n              have--;\n              hold += input[next++] << bits;\n              bits += 8;\n            }\n            //===//\n            //--- DROPBITS(here.bits) ---//\n            hold >>>= here_bits;\n            bits -= here_bits;\n            //---//\n            len = 0;\n            copy = 11 + (hold & 0x7f);//BITS(7);\n            //--- DROPBITS(7) ---//\n            hold >>>= 7;\n            bits -= 7;\n            //---//\n          }\n          if (state.have + copy > state.nlen + state.ndist) {\n            strm.msg = 'invalid bit length repeat';\n            state.mode = BAD;\n            break;\n          }\n          while (copy--) {\n            state.lens[state.have++] = len;\n          }\n        }\n      }\n\n      /* handle error breaks in while */\n      if (state.mode === BAD) { break; }\n\n      /* check for end-of-block code (better have one) */\n      if (state.lens[256] === 0) {\n        strm.msg = 'invalid code -- missing end-of-block';\n        state.mode = BAD;\n        break;\n      }\n\n      /* build code tables -- note: do not change the lenbits or distbits\n         values here (9 and 6) without reading the comments in inftrees.h\n         concerning the ENOUGH constants, which depend on those values */\n      state.lenbits = 9;\n\n      opts = { bits: state.lenbits };\n      ret = inflate_table(LENS, state.lens, 0, state.nlen, state.lencode, 0, state.work, opts);\n      // We have separate tables & no pointers. 2 commented lines below not needed.\n      // state.next_index = opts.table_index;\n      state.lenbits = opts.bits;\n      // state.lencode = state.next;\n\n      if (ret) {\n        strm.msg = 'invalid literal/lengths set';\n        state.mode = BAD;\n        break;\n      }\n\n      state.distbits = 6;\n      //state.distcode.copy(state.codes);\n      // Switch to use dynamic table\n      state.distcode = state.distdyn;\n      opts = { bits: state.distbits };\n      ret = inflate_table(DISTS, state.lens, state.nlen, state.ndist, state.distcode, 0, state.work, opts);\n      // We have separate tables & no pointers. 2 commented lines below not needed.\n      // state.next_index = opts.table_index;\n      state.distbits = opts.bits;\n      // state.distcode = state.next;\n\n      if (ret) {\n        strm.msg = 'invalid distances set';\n        state.mode = BAD;\n        break;\n      }\n      //Tracev((stderr, 'inflate:       codes ok\\n'));\n      state.mode = LEN_;\n      if (flush === Z_TREES) { break inf_leave; }\n      /* falls through */\n    case LEN_:\n      state.mode = LEN;\n      /* falls through */\n    case LEN:\n      if (have >= 6 && left >= 258) {\n        //--- RESTORE() ---\n        strm.next_out = put;\n        strm.avail_out = left;\n        strm.next_in = next;\n        strm.avail_in = have;\n        state.hold = hold;\n        state.bits = bits;\n        //---\n        inflate_fast(strm, _out);\n        //--- LOAD() ---\n        put = strm.next_out;\n        output = strm.output;\n        left = strm.avail_out;\n        next = strm.next_in;\n        input = strm.input;\n        have = strm.avail_in;\n        hold = state.hold;\n        bits = state.bits;\n        //---\n\n        if (state.mode === TYPE) {\n          state.back = -1;\n        }\n        break;\n      }\n      state.back = 0;\n      for (;;) {\n        here = state.lencode[hold & ((1 << state.lenbits) - 1)];  /*BITS(state.lenbits)*/\n        here_bits = here >>> 24;\n        here_op = (here >>> 16) & 0xff;\n        here_val = here & 0xffff;\n\n        if (here_bits <= bits) { break; }\n        //--- PULLBYTE() ---//\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n        //---//\n      }\n      if (here_op && (here_op & 0xf0) === 0) {\n        last_bits = here_bits;\n        last_op = here_op;\n        last_val = here_val;\n        for (;;) {\n          here = state.lencode[last_val +\n                  ((hold & ((1 << (last_bits + last_op)) - 1))/*BITS(last.bits + last.op)*/ >> last_bits)];\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((last_bits + here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        //--- DROPBITS(last.bits) ---//\n        hold >>>= last_bits;\n        bits -= last_bits;\n        //---//\n        state.back += last_bits;\n      }\n      //--- DROPBITS(here.bits) ---//\n      hold >>>= here_bits;\n      bits -= here_bits;\n      //---//\n      state.back += here_bits;\n      state.length = here_val;\n      if (here_op === 0) {\n        //Tracevv((stderr, here.val >= 0x20 && here.val < 0x7f ?\n        //        \"inflate:         literal '%c'\\n\" :\n        //        \"inflate:         literal 0x%02x\\n\", here.val));\n        state.mode = LIT;\n        break;\n      }\n      if (here_op & 32) {\n        //Tracevv((stderr, \"inflate:         end of block\\n\"));\n        state.back = -1;\n        state.mode = TYPE;\n        break;\n      }\n      if (here_op & 64) {\n        strm.msg = 'invalid literal/length code';\n        state.mode = BAD;\n        break;\n      }\n      state.extra = here_op & 15;\n      state.mode = LENEXT;\n      /* falls through */\n    case LENEXT:\n      if (state.extra) {\n        //=== NEEDBITS(state.extra);\n        n = state.extra;\n        while (bits < n) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.length += hold & ((1 << state.extra) - 1)/*BITS(state.extra)*/;\n        //--- DROPBITS(state.extra) ---//\n        hold >>>= state.extra;\n        bits -= state.extra;\n        //---//\n        state.back += state.extra;\n      }\n      //Tracevv((stderr, \"inflate:         length %u\\n\", state.length));\n      state.was = state.length;\n      state.mode = DIST;\n      /* falls through */\n    case DIST:\n      for (;;) {\n        here = state.distcode[hold & ((1 << state.distbits) - 1)];/*BITS(state.distbits)*/\n        here_bits = here >>> 24;\n        here_op = (here >>> 16) & 0xff;\n        here_val = here & 0xffff;\n\n        if ((here_bits) <= bits) { break; }\n        //--- PULLBYTE() ---//\n        if (have === 0) { break inf_leave; }\n        have--;\n        hold += input[next++] << bits;\n        bits += 8;\n        //---//\n      }\n      if ((here_op & 0xf0) === 0) {\n        last_bits = here_bits;\n        last_op = here_op;\n        last_val = here_val;\n        for (;;) {\n          here = state.distcode[last_val +\n                  ((hold & ((1 << (last_bits + last_op)) - 1))/*BITS(last.bits + last.op)*/ >> last_bits)];\n          here_bits = here >>> 24;\n          here_op = (here >>> 16) & 0xff;\n          here_val = here & 0xffff;\n\n          if ((last_bits + here_bits) <= bits) { break; }\n          //--- PULLBYTE() ---//\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n          //---//\n        }\n        //--- DROPBITS(last.bits) ---//\n        hold >>>= last_bits;\n        bits -= last_bits;\n        //---//\n        state.back += last_bits;\n      }\n      //--- DROPBITS(here.bits) ---//\n      hold >>>= here_bits;\n      bits -= here_bits;\n      //---//\n      state.back += here_bits;\n      if (here_op & 64) {\n        strm.msg = 'invalid distance code';\n        state.mode = BAD;\n        break;\n      }\n      state.offset = here_val;\n      state.extra = (here_op) & 15;\n      state.mode = DISTEXT;\n      /* falls through */\n    case DISTEXT:\n      if (state.extra) {\n        //=== NEEDBITS(state.extra);\n        n = state.extra;\n        while (bits < n) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        state.offset += hold & ((1 << state.extra) - 1)/*BITS(state.extra)*/;\n        //--- DROPBITS(state.extra) ---//\n        hold >>>= state.extra;\n        bits -= state.extra;\n        //---//\n        state.back += state.extra;\n      }\n//#ifdef INFLATE_STRICT\n      if (state.offset > state.dmax) {\n        strm.msg = 'invalid distance too far back';\n        state.mode = BAD;\n        break;\n      }\n//#endif\n      //Tracevv((stderr, \"inflate:         distance %u\\n\", state.offset));\n      state.mode = MATCH;\n      /* falls through */\n    case MATCH:\n      if (left === 0) { break inf_leave; }\n      copy = _out - left;\n      if (state.offset > copy) {         /* copy from window */\n        copy = state.offset - copy;\n        if (copy > state.whave) {\n          if (state.sane) {\n            strm.msg = 'invalid distance too far back';\n            state.mode = BAD;\n            break;\n          }\n// (!) This block is disabled in zlib defailts,\n// don't enable it for binary compatibility\n//#ifdef INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR\n//          Trace((stderr, \"inflate.c too far\\n\"));\n//          copy -= state.whave;\n//          if (copy > state.length) { copy = state.length; }\n//          if (copy > left) { copy = left; }\n//          left -= copy;\n//          state.length -= copy;\n//          do {\n//            output[put++] = 0;\n//          } while (--copy);\n//          if (state.length === 0) { state.mode = LEN; }\n//          break;\n//#endif\n        }\n        if (copy > state.wnext) {\n          copy -= state.wnext;\n          from = state.wsize - copy;\n        }\n        else {\n          from = state.wnext - copy;\n        }\n        if (copy > state.length) { copy = state.length; }\n        from_source = state.window;\n      }\n      else {                              /* copy from output */\n        from_source = output;\n        from = put - state.offset;\n        copy = state.length;\n      }\n      if (copy > left) { copy = left; }\n      left -= copy;\n      state.length -= copy;\n      do {\n        output[put++] = from_source[from++];\n      } while (--copy);\n      if (state.length === 0) { state.mode = LEN; }\n      break;\n    case LIT:\n      if (left === 0) { break inf_leave; }\n      output[put++] = state.length;\n      left--;\n      state.mode = LEN;\n      break;\n    case CHECK:\n      if (state.wrap) {\n        //=== NEEDBITS(32);\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          // Use '|' insdead of '+' to make sure that result is signed\n          hold |= input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        _out -= left;\n        strm.total_out += _out;\n        state.total += _out;\n        if (_out) {\n          strm.adler = state.check =\n              /*UPDATE(state.check, put - _out, _out);*/\n              (state.flags ? crc32(state.check, output, _out, put - _out) : adler32(state.check, output, _out, put - _out));\n\n        }\n        _out = left;\n        // NB: crc32 stored as signed 32-bit int, zswap32 returns signed too\n        if ((state.flags ? hold : zswap32(hold)) !== state.check) {\n          strm.msg = 'incorrect data check';\n          state.mode = BAD;\n          break;\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        //Tracev((stderr, \"inflate:   check matches trailer\\n\"));\n      }\n      state.mode = LENGTH;\n      /* falls through */\n    case LENGTH:\n      if (state.wrap && state.flags) {\n        //=== NEEDBITS(32);\n        while (bits < 32) {\n          if (have === 0) { break inf_leave; }\n          have--;\n          hold += input[next++] << bits;\n          bits += 8;\n        }\n        //===//\n        if (hold !== (state.total & 0xffffffff)) {\n          strm.msg = 'incorrect length check';\n          state.mode = BAD;\n          break;\n        }\n        //=== INITBITS();\n        hold = 0;\n        bits = 0;\n        //===//\n        //Tracev((stderr, \"inflate:   length matches trailer\\n\"));\n      }\n      state.mode = DONE;\n      /* falls through */\n    case DONE:\n      ret = Z_STREAM_END;\n      break inf_leave;\n    case BAD:\n      ret = Z_DATA_ERROR;\n      break inf_leave;\n    case MEM:\n      return Z_MEM_ERROR;\n    case SYNC:\n      /* falls through */\n    default:\n      return Z_STREAM_ERROR;\n    }\n  }\n\n  // inf_leave <- here is real place for \"goto inf_leave\", emulated via \"break inf_leave\"\n\n  /*\n     Return from inflate(), updating the total counts and the check value.\n     If there was no progress during the inflate() call, return a buffer\n     error.  Call updatewindow() to create and/or update the window state.\n     Note: a memory error from inflate() is non-recoverable.\n   */\n\n  //--- RESTORE() ---\n  strm.next_out = put;\n  strm.avail_out = left;\n  strm.next_in = next;\n  strm.avail_in = have;\n  state.hold = hold;\n  state.bits = bits;\n  //---\n\n  if (state.wsize || (_out !== strm.avail_out && state.mode < BAD &&\n                      (state.mode < CHECK || flush !== Z_FINISH))) {\n    if (updatewindow(strm, strm.output, strm.next_out, _out - strm.avail_out)) {\n      state.mode = MEM;\n      return Z_MEM_ERROR;\n    }\n  }\n  _in -= strm.avail_in;\n  _out -= strm.avail_out;\n  strm.total_in += _in;\n  strm.total_out += _out;\n  state.total += _out;\n  if (state.wrap && _out) {\n    strm.adler = state.check = /*UPDATE(state.check, strm.next_out - _out, _out);*/\n      (state.flags ? crc32(state.check, output, _out, strm.next_out - _out) : adler32(state.check, output, _out, strm.next_out - _out));\n  }\n  strm.data_type = state.bits + (state.last ? 64 : 0) +\n                    (state.mode === TYPE ? 128 : 0) +\n                    (state.mode === LEN_ || state.mode === COPY_ ? 256 : 0);\n  if (((_in === 0 && _out === 0) || flush === Z_FINISH) && ret === Z_OK) {\n    ret = Z_BUF_ERROR;\n  }\n  return ret;\n}\n\nfunction inflateEnd(strm) {\n\n  if (!strm || !strm.state /*|| strm->zfree == (free_func)0*/) {\n    return Z_STREAM_ERROR;\n  }\n\n  var state = strm.state;\n  if (state.window) {\n    state.window = null;\n  }\n  strm.state = null;\n  return Z_OK;\n}\n\nfunction inflateGetHeader(strm, head) {\n  var state;\n\n  /* check state */\n  if (!strm || !strm.state) { return Z_STREAM_ERROR; }\n  state = strm.state;\n  if ((state.wrap & 2) === 0) { return Z_STREAM_ERROR; }\n\n  /* save header structure */\n  state.head = head;\n  head.done = false;\n  return Z_OK;\n}\n\nfunction inflateSetDictionary(strm, dictionary) {\n  var dictLength = dictionary.length;\n\n  var state;\n  var dictid;\n  var ret;\n\n  /* check state */\n  if (!strm /* == Z_NULL */ || !strm.state /* == Z_NULL */) { return Z_STREAM_ERROR; }\n  state = strm.state;\n\n  if (state.wrap !== 0 && state.mode !== DICT) {\n    return Z_STREAM_ERROR;\n  }\n\n  /* check for correct dictionary identifier */\n  if (state.mode === DICT) {\n    dictid = 1; /* adler32(0, null, 0)*/\n    /* dictid = adler32(dictid, dictionary, dictLength); */\n    dictid = adler32(dictid, dictionary, dictLength, 0);\n    if (dictid !== state.check) {\n      return Z_DATA_ERROR;\n    }\n  }\n  /* copy dictionary to window using updatewindow(), which will amend the\n   existing dictionary if appropriate */\n  ret = updatewindow(strm, dictionary, dictLength, dictLength);\n  if (ret) {\n    state.mode = MEM;\n    return Z_MEM_ERROR;\n  }\n  state.havedict = 1;\n  // Tracev((stderr, \"inflate:   dictionary set\\n\"));\n  return Z_OK;\n}\n\n// String encode/decode helpers\n// 'use strict';\n\n\n// var utils = require('./common');\n\n\n// Quick check if we can use fast array to bin string conversion\n//\n// - apply(Array) can fail on Android 2.2\n// - apply(Uint8Array) can fail on iOS 5.1 Safary\n//\nvar STR_APPLY_OK = true;\nvar STR_APPLY_UIA_OK = true;\n\ntry { String.fromCharCode.apply(null, [ 0 ]); } catch (__) { STR_APPLY_OK = false; }\ntry { String.fromCharCode.apply(null, new Uint8Array(1)); } catch (__) { STR_APPLY_UIA_OK = false; }\n\n\n// Table with utf8 lengths (calculated by first byte of sequence)\n// Note, that 5 & 6-byte values and some 4-byte values can not be represented in JS,\n// because max possible codepoint is 0x10ffff\nvar _utf8len = new Uint8Array(256);\nfor (var q = 0; q < 256; q++) {\n  _utf8len[q] = (q >= 252 ? 6 : q >= 248 ? 5 : q >= 240 ? 4 : q >= 224 ? 3 : q >= 192 ? 2 : 1);\n}\n_utf8len[254] = _utf8len[254] = 1; // Invalid sequence start\n\n\n// convert string to array (typed, when possible)\nfunction string2buf(str) {\n  var buf, c, c2, m_pos, i, str_len = str.length, buf_len = 0;\n\n  // count binary size\n  for (m_pos = 0; m_pos < str_len; m_pos++) {\n    c = str.charCodeAt(m_pos);\n    if ((c & 0xfc00) === 0xd800 && (m_pos + 1 < str_len)) {\n      c2 = str.charCodeAt(m_pos + 1);\n      if ((c2 & 0xfc00) === 0xdc00) {\n        c = 0x10000 + ((c - 0xd800) << 10) + (c2 - 0xdc00);\n        m_pos++;\n      }\n    }\n    buf_len += c < 0x80 ? 1 : c < 0x800 ? 2 : c < 0x10000 ? 3 : 4;\n  }\n\n  // allocate buffer\n  buf = new Uint8Array(buf_len);\n\n  // convert\n  for (i = 0, m_pos = 0; i < buf_len; m_pos++) {\n    c = str.charCodeAt(m_pos);\n    if ((c & 0xfc00) === 0xd800 && (m_pos + 1 < str_len)) {\n      c2 = str.charCodeAt(m_pos + 1);\n      if ((c2 & 0xfc00) === 0xdc00) {\n        c = 0x10000 + ((c - 0xd800) << 10) + (c2 - 0xdc00);\n        m_pos++;\n      }\n    }\n    if (c < 0x80) {\n      /* one byte */\n      buf[i++] = c;\n    } else if (c < 0x800) {\n      /* two bytes */\n      buf[i++] = 0xC0 | (c >>> 6);\n      buf[i++] = 0x80 | (c & 0x3f);\n    } else if (c < 0x10000) {\n      /* three bytes */\n      buf[i++] = 0xE0 | (c >>> 12);\n      buf[i++] = 0x80 | (c >>> 6 & 0x3f);\n      buf[i++] = 0x80 | (c & 0x3f);\n    } else {\n      /* four bytes */\n      buf[i++] = 0xf0 | (c >>> 18);\n      buf[i++] = 0x80 | (c >>> 12 & 0x3f);\n      buf[i++] = 0x80 | (c >>> 6 & 0x3f);\n      buf[i++] = 0x80 | (c & 0x3f);\n    }\n  }\n\n  return buf;\n}\n\n// Helper (used in 2 places)\nfunction _buf2binstring(buf, len) {\n  // use fallback for big arrays to avoid stack overflow\n  if (len < 65537) {\n    if ((buf.subarray && STR_APPLY_UIA_OK) || (!buf.subarray && STR_APPLY_OK)) {\n      return String.fromCharCode.apply(null, shrinkBuf(buf, len));\n    }\n  }\n\n  var result = '';\n  for (var i = 0; i < len; i++) {\n    result += String.fromCharCode(buf[i]);\n  }\n  return result;\n}\n\n\n// Convert binary string (typed, when possible)\nfunction binstring2buf(str) {\n  var buf = new Uint8Array(str.length);\n  for (var i = 0, len = buf.length; i < len; i++) {\n    buf[i] = str.charCodeAt(i);\n  }\n  return buf;\n}\n\n\n// convert array to string\nfunction buf2string(buf, max) {\n  var i, out, c, c_len;\n  var len = max || buf.length;\n\n  // Reserve max possible length (2 words per char)\n  // NB: by unknown reasons, Array is significantly faster for\n  //     String.fromCharCode.apply than Uint16Array.\n  var utf16buf = new Array(len * 2);\n\n  for (out = 0, i = 0; i < len;) {\n    c = buf[i++];\n    // quick process ascii\n    if (c < 0x80) { utf16buf[out++] = c; continue; }\n\n    c_len = _utf8len[c];\n    // skip 5 & 6 byte codes\n    if (c_len > 4) { utf16buf[out++] = 0xfffd; i += c_len - 1; continue; }\n\n    // apply mask on first byte\n    c &= c_len === 2 ? 0x1f : c_len === 3 ? 0x0f : 0x07;\n    // join the rest\n    while (c_len > 1 && i < len) {\n      c = (c << 6) | (buf[i++] & 0x3f);\n      c_len--;\n    }\n\n    // terminated by end of string?\n    if (c_len > 1) { utf16buf[out++] = 0xfffd; continue; }\n\n    if (c < 0x10000) {\n      utf16buf[out++] = c;\n    } else {\n      c -= 0x10000;\n      utf16buf[out++] = 0xd800 | ((c >> 10) & 0x3ff);\n      utf16buf[out++] = 0xdc00 | (c & 0x3ff);\n    }\n  }\n\n  return _buf2binstring(utf16buf, out);\n}\n\n\n// Calculate max possible position in utf8 buffer,\n// that will not break sequence. If that's not possible\n// - (very small limits) return max size as is.\n//\n// buf[] - utf8 bytes array\n// max   - length limit (mandatory);\nfunction utf8border(buf, max) {\n  var pos;\n\n  max = max || buf.length;\n  if (max > buf.length) { max = buf.length; }\n\n  // go back from last position, until start of sequence found\n  pos = max - 1;\n  while (pos >= 0 && (buf[pos] & 0xC0) === 0x80) { pos--; }\n\n  // Fuckup - very small and broken sequence,\n  // return max, because we should return something anyway.\n  if (pos < 0) { return max; }\n\n  // If we came to start of buffer - that means vuffer is too small,\n  // return max too.\n  if (pos === 0) { return max; }\n\n  return (pos + _utf8len[buf[pos]] > max) ? pos : max;\n}\n\n/* Allowed flush values; see deflate() and inflate() below for details */\nvar Z_NO_FLUSH        = 0;\nvar Z_SYNC_FLUSH      = 2;\nvar Z_FINISH$1          = 4;\n/* Return codes for the compression/decompression functions. Negative values\n  * are errors, positive values are used for special but normal events.\n  */\nvar Z_OK$1              =  0;\nvar Z_STREAM_END$1      =  1;\nvar Z_NEED_DICT$1       =  2;\n//export var Z_MEM_ERROR     = -4;\nvar Z_BUF_ERROR$1       = -5;\n\n// 'use strict';\n\nvar messages = {\n  2:      'need dictionary',     /* Z_NEED_DICT       2  */\n  1:      'stream end',          /* Z_STREAM_END      1  */\n  0:      '',                    /* Z_OK              0  */\n  '-1':   'file error',          /* Z_ERRNO         (-1) */\n  '-2':   'stream error',        /* Z_STREAM_ERROR  (-2) */\n  '-3':   'data error',          /* Z_DATA_ERROR    (-3) */\n  '-4':   'insufficient memory', /* Z_MEM_ERROR     (-4) */\n  '-5':   'buffer error',        /* Z_BUF_ERROR     (-5) */\n  '-6':   'incompatible version' /* Z_VERSION_ERROR (-6) */\n};\n\n// 'use strict';\n\n\nfunction ZStream() {\n  /* next input byte */\n  this.input = null; // JS specific, because we have no pointers\n  this.next_in = 0;\n  /* number of bytes available at input */\n  this.avail_in = 0;\n  /* total number of input bytes read so far */\n  this.total_in = 0;\n  /* next output byte should be put there */\n  this.output = null; // JS specific, because we have no pointers\n  this.next_out = 0;\n  /* remaining free space at output */\n  this.avail_out = 0;\n  /* total number of bytes output so far */\n  this.total_out = 0;\n  /* last error message, NULL if no error */\n  this.msg = ''/*Z_NULL*/;\n  /* not visible by applications */\n  this.state = null;\n  /* best guess about the data type: binary or text */\n  this.data_type = 2/*Z_UNKNOWN*/;\n  /* adler32 value of the uncompressed data */\n  this.adler = 0;\n}\n\n// 'use strict';\n\n\nfunction GZheader() {\n  /* true if compressed data believed to be text */\n  this.text       = 0;\n  /* modification time */\n  this.time       = 0;\n  /* extra flags (not used when writing a gzip file) */\n  this.xflags     = 0;\n  /* operating system */\n  this.os         = 0;\n  /* pointer to extra field or Z_NULL if none */\n  this.extra      = null;\n  /* extra field length (valid if extra != Z_NULL) */\n  this.extra_len  = 0; // Actually, we don't need it in JS,\n                       // but leave for few code modifications\n\n  //\n  // Setup limits is not necessary because in js we should not preallocate memory\n  // for inflate use constant limit in 65536 bytes\n  //\n\n  /* space at extra (only when reading header) */\n  // this.extra_max  = 0;\n  /* pointer to zero-terminated file name or Z_NULL */\n  this.name       = '';\n  /* space at name (only when reading header) */\n  // this.name_max   = 0;\n  /* pointer to zero-terminated comment or Z_NULL */\n  this.comment    = '';\n  /* space at comment (only when reading header) */\n  // this.comm_max   = 0;\n  /* true if there was or will be a header crc */\n  this.hcrc       = 0;\n  /* true when done reading gzip header (not used when writing a gzip file) */\n  this.done       = false;\n}\n\n// 'use strict';\n\n\n// var zlib_inflate = require('./zlib/inflate');\n// var utils        = require('./utils/common');\n// var strings      = require('./utils/strings');\n// var c            = require('./zlib/constants');\n// var msg          = require('./zlib/messages');\n// var ZStream      = require('./zlib/zstream');\n// var GZheader     = require('./zlib/gzheader');\n\nvar toString = Object.prototype.toString;\n\n/**\n * class Inflate\n *\n * Generic JS-style wrapper for zlib calls. If you don't need\n * streaming behaviour - use more simple functions: [[inflate]]\n * and [[inflateRaw]].\n **/\n\n/* internal\n * inflate.chunks -> Array\n *\n * Chunks of output data, if [[Inflate#onData]] not overriden.\n **/\n\n/**\n * Inflate.result -> Uint8Array|Array|String\n *\n * Uncompressed result, generated by default [[Inflate#onData]]\n * and [[Inflate#onEnd]] handlers. Filled after you push last chunk\n * (call [[Inflate#push]] with `Z_FINISH` / `true` param) or if you\n * push a chunk with explicit flush (call [[Inflate#push]] with\n * `Z_SYNC_FLUSH` param).\n **/\n\n/**\n * Inflate.err -> Number\n *\n * Error code after inflate finished. 0 (Z_OK) on success.\n * Should be checked if broken data possible.\n **/\n\n/**\n * Inflate.msg -> String\n *\n * Error message, if [[Inflate.err]] != 0\n **/\n\n\n/**\n * new Inflate(options)\n * - options (Object): zlib inflate options.\n *\n * Creates new inflator instance with specified params. Throws exception\n * on bad params. Supported options:\n *\n * - `windowBits`\n * - `dictionary`\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information on these.\n *\n * Additional options, for internal needs:\n *\n * - `chunkSize` - size of generated data chunks (16K by default)\n * - `raw` (Boolean) - do raw inflate\n * - `to` (String) - if equal to 'string', then result will be converted\n *   from utf8 to utf16 (javascript) string. When string output requested,\n *   chunk length can differ from `chunkSize`, depending on content.\n *\n * By default, when no options set, autodetect deflate/gzip data format via\n * wrapper header.\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , chunk1 = Uint8Array([1,2,3,4,5,6,7,8,9])\n *   , chunk2 = Uint8Array([10,11,12,13,14,15,16,17,18,19]);\n *\n * var inflate = new pako.Inflate({ level: 3});\n *\n * inflate.push(chunk1, false);\n * inflate.push(chunk2, true);  // true -> last chunk\n *\n * if (inflate.err) { throw new Error(inflate.err); }\n *\n * console.log(inflate.result);\n * ```\n **/\nfunction Inflate(options) {\n  if (!(this instanceof Inflate)) return new Inflate(options);\n\n  this.options = assign({\n    chunkSize: 16384,\n    windowBits: 0,\n    to: ''\n  }, options || {});\n\n  var opt = this.options;\n\n  // Force window size for `raw` data, if not set directly,\n  // because we have no header for autodetect.\n  if (opt.raw && (opt.windowBits >= 0) && (opt.windowBits < 16)) {\n    opt.windowBits = -opt.windowBits;\n    if (opt.windowBits === 0) { opt.windowBits = -15; }\n  }\n\n  // If `windowBits` not defined (and mode not raw) - set autodetect flag for gzip/deflate\n  if ((opt.windowBits >= 0) && (opt.windowBits < 16) &&\n      !(options && options.windowBits)) {\n    opt.windowBits += 32;\n  }\n\n  // Gzip header has no info about windows size, we can do autodetect only\n  // for deflate. So, if window size not set, force it to max when gzip possible\n  if ((opt.windowBits > 15) && (opt.windowBits < 48)) {\n    // bit 3 (16) -> gzipped data\n    // bit 4 (32) -> autodetect gzip/deflate\n    if ((opt.windowBits & 15) === 0) {\n      opt.windowBits |= 15;\n    }\n  }\n\n  this.err    = 0;      // error code, if happens (0 = Z_OK)\n  this.msg    = '';     // error message\n  this.ended  = false;  // used to avoid multiple onEnd() calls\n  this.chunks = [];     // chunks of compressed data\n\n  this.strm   = new ZStream();\n  this.strm.avail_out = 0;\n\n  var status  = inflateInit2(\n    this.strm,\n    opt.windowBits\n  );\n\n  if (status !== Z_OK$1) {\n    throw new Error(messages[status]);\n  }\n\n  this.header = new GZheader();\n\n  inflateGetHeader(this.strm, this.header);\n}\n\n/**\n * Inflate#push(data[, mode]) -> Boolean\n * - data (Uint8Array|Array|ArrayBuffer|String): input data\n * - mode (Number|Boolean): 0..6 for corresponding Z_NO_FLUSH..Z_TREE modes.\n *   See constants. Skipped or `false` means Z_NO_FLUSH, `true` meansh Z_FINISH.\n *\n * Sends input data to inflate pipe, generating [[Inflate#onData]] calls with\n * new output chunks. Returns `true` on success. The last data block must have\n * mode Z_FINISH (or `true`). That will flush internal pending buffers and call\n * [[Inflate#onEnd]]. For interim explicit flushes (without ending the stream) you\n * can use mode Z_SYNC_FLUSH, keeping the decompression context.\n *\n * On fail call [[Inflate#onEnd]] with error code and return false.\n *\n * We strongly recommend to use `Uint8Array` on input for best speed (output\n * format is detected automatically). Also, don't skip last param and always\n * use the same type in your code (boolean or number). That will improve JS speed.\n *\n * For regular `Array`-s make sure all elements are [0..255].\n *\n * ##### Example\n *\n * ```javascript\n * push(chunk, false); // push one of data chunks\n * ...\n * push(chunk, true);  // push last chunk\n * ```\n **/\nInflate.prototype.push = function (data, mode) {\n  var strm = this.strm;\n  var chunkSize = this.options.chunkSize;\n  var dictionary = this.options.dictionary;\n  var status, _mode;\n  var next_out_utf8, tail, utf8str;\n  var dict;\n\n  // Flag to properly process Z_BUF_ERROR on testing inflate call\n  // when we check that all output data was flushed.\n  var allowBufError = false;\n\n  if (this.ended) { return false; }\n  _mode = (mode === ~~mode) ? mode : ((mode === true) ? Z_FINISH$1 : Z_NO_FLUSH);\n\n  // Convert data if needed\n  if (typeof data === 'string') {\n    // Only binary strings can be decompressed on practice\n    strm.input = binstring2buf(data);\n  } else if (toString.call(data) === '[object ArrayBuffer]') {\n    strm.input = new Uint8Array(data);\n  } else {\n    strm.input = data;\n  }\n\n  strm.next_in = 0;\n  strm.avail_in = strm.input.length;\n\n  do {\n    if (strm.avail_out === 0) {\n      strm.output = new Uint8Array(chunkSize);\n      strm.next_out = 0;\n      strm.avail_out = chunkSize;\n    }\n\n    status = inflate(strm, Z_NO_FLUSH);    /* no bad return value */\n\n    if (status === Z_NEED_DICT$1 && dictionary) {\n      // Convert data if needed\n      if (typeof dictionary === 'string') {\n        dict = string2buf(dictionary);\n      } else if (toString.call(dictionary) === '[object ArrayBuffer]') {\n        dict = new Uint8Array(dictionary);\n      } else {\n        dict = dictionary;\n      }\n\n      status = inflateSetDictionary(this.strm, dict);\n\n    }\n\n    if (status === Z_BUF_ERROR$1 && allowBufError === true) {\n      status = Z_OK$1;\n      allowBufError = false;\n    }\n\n    if (status !== Z_STREAM_END$1 && status !== Z_OK$1) {\n      this.onEnd(status);\n      this.ended = true;\n      return false;\n    }\n\n    if (strm.next_out) {\n      if (strm.avail_out === 0 || status === Z_STREAM_END$1 || (strm.avail_in === 0 && (_mode === Z_FINISH$1 || _mode === Z_SYNC_FLUSH))) {\n\n        if (this.options.to === 'string') {\n\n          next_out_utf8 = utf8border(strm.output, strm.next_out);\n\n          tail = strm.next_out - next_out_utf8;\n          utf8str = buf2string(strm.output, next_out_utf8);\n\n          // move tail\n          strm.next_out = tail;\n          strm.avail_out = chunkSize - tail;\n          if (tail) { arraySet(strm.output, strm.output, next_out_utf8, tail, 0); }\n\n          this.onData(utf8str);\n\n        } else {\n          this.onData(shrinkBuf(strm.output, strm.next_out));\n        }\n      }\n    }\n\n    // When no more input data, we should check that internal inflate buffers\n    // are flushed. The only way to do it when avail_out = 0 - run one more\n    // inflate pass. But if output data not exists, inflate return Z_BUF_ERROR.\n    // Here we set flag to process this error properly.\n    //\n    // NOTE. Deflate does not return error in this case and does not needs such\n    // logic.\n    if (strm.avail_in === 0 && strm.avail_out === 0) {\n      allowBufError = true;\n    }\n\n  } while ((strm.avail_in > 0 || strm.avail_out === 0) && status !== Z_STREAM_END$1);\n\n  if (status === Z_STREAM_END$1) {\n    _mode = Z_FINISH$1;\n  }\n\n  // Finalize on the last chunk.\n  if (_mode === Z_FINISH$1) {\n    status = inflateEnd(this.strm);\n    this.onEnd(status);\n    this.ended = true;\n    return status === Z_OK$1;\n  }\n\n  // callback interim results if Z_SYNC_FLUSH.\n  if (_mode === Z_SYNC_FLUSH) {\n    this.onEnd(Z_OK$1);\n    strm.avail_out = 0;\n    return true;\n  }\n\n  return true;\n};\n\n\n/**\n * Inflate#onData(chunk) -> Void\n * - chunk (Uint8Array|Array|String): ouput data. Type of array depends\n *   on js engine support. When string output requested, each chunk\n *   will be string.\n *\n * By default, stores data blocks in `chunks[]` property and glue\n * those in `onEnd`. Override this handler, if you need another behaviour.\n **/\nInflate.prototype.onData = function (chunk) {\n  this.chunks.push(chunk);\n};\n\n\n/**\n * Inflate#onEnd(status) -> Void\n * - status (Number): inflate status. 0 (Z_OK) on success,\n *   other if not.\n *\n * Called either after you tell inflate that the input stream is\n * complete (Z_FINISH) or should be flushed (Z_SYNC_FLUSH)\n * or if an error happened. By default - join collected chunks,\n * free memory and fill `results` / `err` properties.\n **/\nInflate.prototype.onEnd = function (status) {\n  // On success - join\n  if (status === Z_OK$1) {\n    if (this.options.to === 'string') {\n      // Glue & convert here, until we teach pako to send\n      // utf8 alligned strings to onData\n      this.result = this.chunks.join('');\n    } else {\n      this.result = flattenChunks(this.chunks);\n    }\n  }\n  this.chunks = [];\n  this.err = status;\n  this.msg = this.strm.msg;\n};\n\n\n/**\n * inflate(data[, options]) -> Uint8Array|Array|String\n * - data (Uint8Array|Array|String): input data to decompress.\n * - options (Object): zlib inflate options.\n *\n * Decompress `data` with inflate/ungzip and `options`. Autodetect\n * format via wrapper header by default. That's why we don't provide\n * separate `ungzip` method.\n *\n * Supported options are:\n *\n * - windowBits\n *\n * [http://zlib.net/manual.html#Advanced](http://zlib.net/manual.html#Advanced)\n * for more information.\n *\n * Sugar (options):\n *\n * - `raw` (Boolean) - say that we work with raw stream, if you don't wish to specify\n *   negative windowBits implicitly.\n * - `to` (String) - if equal to 'string', then result will be converted\n *   from utf8 to utf16 (javascript) string. When string output requested,\n *   chunk length can differ from `chunkSize`, depending on content.\n *\n *\n * ##### Example:\n *\n * ```javascript\n * var pako = require('pako')\n *   , input = pako.deflate([1,2,3,4,5,6,7,8,9])\n *   , output;\n *\n * try {\n *   output = pako.inflate(input);\n * } catch (err)\n *   console.log(err);\n * }\n * ```\n **/\nfunction doInflate(input, options) {\n  var inflator = new Inflate(options);\n\n  inflator.push(input, true);\n\n  // That will never happens, if you don't cheat with options :)\n  if (inflator.err) { throw inflator.msg; }\n\n  return inflator.result;\n}\n\nexport { doInflate as ungzip };","/**\n * @file Gzip Decompressor\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { ungzip } from '../../lib/pako_inflate.es6'\n\nimport { DecompressorRegistry } from '../globals'\n\nfunction gzipDecompress (data: ArrayBuffer|Uint8Array) {\n  let decompressedData\n\n  if (data instanceof ArrayBuffer) {\n    data = new Uint8Array(data)\n  }\n\n  try {\n    decompressedData = ungzip(data as Uint8Array)\n  } catch (e) {\n    decompressedData = data  // assume it is already uncompressed\n  }\n\n  return decompressedData\n}\n\nDecompressorRegistry.add('gz', gzipDecompress)\n","/**\n * @file Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\n/**\n * Datasource base class\n * @interface\n */\nabstract class Datasource {\n  /**\n   * Get full url\n   * @abstract\n   * @param  {String} path - datasource string\n   * @return {String} - url\n   */\n  abstract getUrl (path: string): string\n\n  /**\n   * Get file extension\n   * @abstract\n   * @param  {String} path - datasource string\n   * @return {String} - extension\n   */\n  abstract getExt (path: string): string\n}\n\nexport default Datasource\n","/**\n * @file RCSB Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, DatasourceRegistry } from '../globals'\nimport { getProtocol } from '../utils'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst baseUrl = '//files.rcsb.org/download/'\nconst mmtfBaseUrl = '//mmtf.rcsb.org/v1.0/'\nconst mmtfFullUrl = mmtfBaseUrl + 'full/'\nconst mmtfReducedUrl = mmtfBaseUrl + 'reduced/'\n\nclass RcsbDatasource extends Datasource {\n  getUrl (src: string) {\n    // valid path are\n    // XXXX.pdb, XXXX.pdb.gz, XXXX.cif, XXXX.cif.gz, XXXX.mmtf, XXXX.bb.mmtf\n    // XXXX defaults to XXXX.cif\n    const info = getFileInfo(src)\n    const pdbid = info.name.substr(0, 4)\n    let url\n    if ([ 'pdb', 'cif' ].includes(info.ext) &&\n        (info.compressed === false || info.compressed === 'gz')\n    ) {\n      url = baseUrl + info.path\n    } else if (info.ext === 'mmtf') {\n      if (info.base.endsWith('.bb')) {\n        url = mmtfReducedUrl + pdbid\n      } else {\n        url = mmtfFullUrl + pdbid\n      }\n    } else if (!info.ext) {\n      url = mmtfFullUrl + pdbid\n    } else {\n      Log.warn('unsupported ext', info.ext)\n      url = mmtfFullUrl + pdbid\n    }\n    return getProtocol() + url\n  }\n\n  getExt (src: string) {\n    const ext = getFileInfo(src).ext\n    return ext ? ext : 'mmtf'\n  }\n}\n\nDatasourceRegistry.add('rcsb', new RcsbDatasource())\n\nexport default RcsbDatasource\n","/**\n * @file PubChem Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { Log, DatasourceRegistry } from '../globals'\nimport { getProtocol } from '../utils'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst baseUrl = '//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/'\nconst suffixUrl = '/SDF?record_type=3d'\n\nclass PubchemDatasource extends Datasource {\n  getUrl (src: string) {\n    const info = getFileInfo(src)\n    const cid = info.name\n    let url\n    if (!info.ext || info.ext === 'sdf') {\n      url = baseUrl + cid + suffixUrl\n    } else {\n      Log.warn('unsupported ext', info.ext)\n      url = baseUrl + cid + suffixUrl\n    }\n    return getProtocol() + url\n  }\n\n  getExt (src: string) {\n    const ext = getFileInfo(src).ext\n    return ext ? ext : 'sdf'\n  }\n}\n\nDatasourceRegistry.add('pubchem', new PubchemDatasource())\n\nexport default PubchemDatasource\n","/**\n * @file Pass Through Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { DatasourceRegistry } from '../globals'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nclass PassThroughDatasource extends Datasource {\n  getUrl (path: string) {\n    return path\n  }\n\n  getExt (path: string) {\n    return getFileInfo(path).ext\n  }\n}\n\nDatasourceRegistry.add('ftp', new PassThroughDatasource())\nDatasourceRegistry.add('http', new PassThroughDatasource())\nDatasourceRegistry.add('https', new PassThroughDatasource())\n\nexport default PassThroughDatasource\n","/**\r\n * @file Alphafold Datasource\r\n * @author Fredric Johansson <fredric@fredricj.se>\r\n * @private\r\n */\r\n\r\nimport { Log, DatasourceRegistry } from '../globals'\r\nimport { getProtocol } from '../utils'\r\nimport { getFileInfo } from '../loader/loader-utils'\r\nimport Datasource from './datasource'\r\n\r\nconst baseUrl = '//alphafold.ebi.ac.uk/files/AF-'\r\nconst suffixURL = '-F1-model_v2.pdb'\r\n\r\nclass AlphafoldDatasource extends Datasource {\r\n    getUrl (src: string) {\r\n        const info = getFileInfo(src)\r\n        const uniprotid = info.name\r\n        let url\r\n        if (!info.ext || info.ext === 'pdb') {\r\n            url = baseUrl + uniprotid + suffixURL\r\n        } else {\r\n            Log.warn('unsupported AF ext', info.ext)\r\n            url = baseUrl + uniprotid + suffixURL\r\n        }\r\n        return getProtocol() + url\r\n    }\r\n\r\n    getExt (src: string) {\r\n        const ext = getFileInfo(src).ext\r\n        return ext ? ext : 'pdb'\r\n    }\r\n}\r\n\r\nDatasourceRegistry.add('alphafold', new AlphafoldDatasource())\r\n\r\nexport default AlphafoldDatasource\r\n","/**\n * @file Static Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { getAbsolutePath } from '../utils'\nimport { getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nconst reProtocol = /^((http|https|ftp):)*\\/\\//\n\nclass StaticDatasource extends Datasource {\n  baseUrl: string\n\n  constructor (baseUrl: string = '') {\n    super()\n    this.baseUrl = baseUrl\n  }\n\n  getUrl (src: string) {\n    const info = getFileInfo(src)\n    let url = this.baseUrl + info.path\n    if (!reProtocol.test(this.baseUrl)) {\n      url = getAbsolutePath(url)\n    }\n    return url\n  }\n\n  getExt (src: string) {\n    return getFileInfo(src).ext\n  }\n}\n\nexport default StaticDatasource\n","/**\n * @file MDsrv Datasource\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n * @private\n */\n\nimport { autoLoad, getFileInfo } from '../loader/loader-utils'\nimport Datasource from './datasource'\n\nclass MdsrvDatasource extends Datasource {\n  baseUrl: string\n\n  constructor (baseUrl: string = '') {\n    super()\n    this.baseUrl = baseUrl\n  }\n\n  getListing (path: string = '') {\n    let url = `${this.baseUrl}dir/${path}`\n    if (url[url.length - 1] !== '/') url += '/'\n    return autoLoad(url, {\n      ext: 'json'\n    }).then((jsonData: any) => ({\n      path: path,\n      data: jsonData.data\n    }))\n  }\n\n  getUrl (src: string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}file/${info.path}${info.query}`\n  }\n\n  getCountUrl (src: string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}traj/numframes/${info.path}${info.query}`\n  }\n\n  getFrameUrl (src: string, frameIndex: number|string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}traj/frame/${frameIndex}/${info.path}${info.query}`\n  }\n\n  getFrameParams (src: string, atomIndices: (number|string)[]) {\n    return `atomIndices=${atomIndices.join(';')}`\n  }\n\n  getPathUrl (src: string, atomIndex: number|string) {\n    const info = getFileInfo(src)\n    return `${this.baseUrl}traj/path/${atomIndex}/${info.path}${info.query}`\n  }\n\n  getExt (src: string) {\n    return getFileInfo(src).ext\n  }\n}\n\nexport default MdsrvDatasource\n","/**\n * @file UI Parameters\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport { StageParameters } from '../stage/stage'\nimport { MouseActionPresets } from '../controls/mouse-actions'\n\nexport type BooleanParam = { type: 'boolean' }\nfunction BooleanParam () { return { type: 'boolean' } as BooleanParam }\n\nexport type ColorParam = { type: 'color' }\nfunction ColorParam () { return { type: 'color' } as ColorParam }\n\nexport type IntegerParam = { type: 'integer', max: number, min: number }\nfunction IntegerParam (max: number, min: number) {\n  return { type: 'integer', max, min } as IntegerParam\n}\n\nexport type NumberParam = { type: 'number', precision: number, max: number, min: number }\nfunction NumberParam (precision: number, max: number, min: number) {\n  return { type: 'number', precision, max, min } as NumberParam\n}\n\nexport type RangeParam = { type: 'range', step: number, max: number, min: number }\nfunction RangeParam (step: number, max: number, min: number) {\n  return { type: 'range', step, max, min } as RangeParam\n}\n\nexport type SelectParam = { type: 'select', options: { [k: string]: string } }\nfunction SelectParam (...options: string[]) {\n  return { type: 'select', options: options.reduce((o, k) => ({ ...o, [k]: k}), {}) } as SelectParam\n}\n\nexport type ParamType = BooleanParam|ColorParam|IntegerParam|NumberParam|RangeParam|SelectParam\n\nexport const UIStageParameters: { [k in keyof StageParameters]: ParamType } = {\n  backgroundColor: ColorParam(),\n  quality: SelectParam('auto', 'low', 'medium', 'high'),\n  sampleLevel: RangeParam(1, 5, -1),\n  impostor: BooleanParam(),\n  workerDefault: BooleanParam(),\n  rotateSpeed: NumberParam(1, 10, 0),\n  zoomSpeed: NumberParam(1, 10, 0),\n  panSpeed: NumberParam(1, 10, 0),\n  clipNear: RangeParam(1, 100, 0),\n  clipFar: RangeParam(1, 100, 0),\n  clipDist: IntegerParam(200, 0),\n  clipMode: SelectParam('scene', 'camera'),\n  clipScale: SelectParam('relative', 'absolute'),\n  fogNear: RangeParam(1, 100, 0),\n  fogFar: RangeParam(1, 100, 0),\n  cameraType: SelectParam('perspective', 'orthographic', 'stereo'),\n  cameraEyeSep: NumberParam(3, 1.0, 0.01),\n  cameraFov: RangeParam(1, 120, 15),\n  lightColor: ColorParam(),\n  lightIntensity: NumberParam(2, 10, 0),\n  ambientColor: ColorParam(),\n  ambientIntensity: NumberParam(2, 10, 0),\n  hoverTimeout: IntegerParam(10000, -1),\n  tooltip: BooleanParam(),\n  mousePreset: SelectParam(...Object.keys(MouseActionPresets))\n}\n","/**\n * @file ngl\n * @private\n * @author Alexander Rose <alexander.rose@weirdbyte.de>\n */\n\nimport './polyfills'\nimport _Promise from 'promise-polyfill'\n\n/**\n * The NGL module. These members are available in the `NGL` namespace when using the {@link https://github.com/umdjs/umd|UMD} build in the `ngl.js` file.\n * @module NGL\n */\n\nexport {\n  Debug, setDebug,\n  MeasurementDefaultParams, setMeasurementDefaultParams,\n  ScriptExtensions, ColormakerRegistry,\n  DatasourceRegistry, DecompressorRegistry,\n  ParserRegistry, RepresentationRegistry,\n  setListingDatasource, setTrajectoryDatasource,\n  ListingDatasource, TrajectoryDatasource\n} from './globals'\nexport { autoLoad, getDataInfo, getFileInfo } from './loader/loader-utils'\nimport Selection from './selection/selection'\nimport PdbWriter from './writer/pdb-writer'\nimport SdfWriter from './writer/sdf-writer'\nimport StlWriter from './writer/stl-writer'\nimport Stage from './stage/stage'\nimport Viewer from './viewer/viewer'\nimport Collection from './component/collection'\nimport ComponentCollection from './component/component-collection'\nimport Component from './component/component'\nimport ShapeComponent from './component/shape-component'\nimport StructureComponent, {StructureRepresentationType} from './component/structure-component'\nimport SurfaceComponent from './component/surface-component'\nimport VolumeComponent, {VolumeRepresentationType} from './component/volume-component'\nimport RepresentationCollection from './component/representation-collection'\nimport RepresentationElement from './component/representation-element'\nimport Assembly from './symmetry/assembly'\nimport TrajectoryPlayer from './trajectory/trajectory-player'\nimport Superposition from './align/superposition'\nexport { superpose } from './align/align-utils'\nexport { guessElement, concatStructures } from './structure/structure-utils'\n\nexport { flatten, throttle, download, getQuery, uniqueArray } from './utils'\nimport Queue from './utils/queue'\nimport Counter from './utils/counter'\nimport Frames from './trajectory/frames'\n\n//\n\nimport Colormaker from './color/colormaker'\n\nimport './color/atomindex-colormaker'\nimport './color/bfactor-colormaker'\nimport './color/chainid-colormaker'\nimport './color/chainindex-colormaker'\nimport './color/chainname-colormaker'\nimport './color/densityfit-colormaker'\nimport './color/electrostatic-colormaker'\nimport './color/element-colormaker'\nimport './color/entityindex-colormaker'\nimport './color/entitytype-colormaker'\nimport './color/geoquality-colormaker'\nimport './color/hydrophobicity-colormaker'\nimport './color/modelindex-colormaker'\nimport './color/moleculetype-colormaker'\nimport './color/occupancy-colormaker'\nimport './color/partialcharge-colormaker'\nimport './color/random-colormaker'\nimport './color/randomcoilindex-colormaker'\nimport './color/residueindex-colormaker'\nimport './color/resname-colormaker'\nimport './color/sstruc-colormaker'\nimport './color/structuredata-colormaker'\nimport './color/uniform-colormaker'\nimport './color/value-colormaker'\nimport './color/volume-colormaker'\n\n//\n\nimport './component/shape-component'\nimport './component/structure-component'\nimport './component/surface-component'\nimport './component/volume-component'\n\n//\n\nimport AngleRepresentation, {AngleRepresentationParameters} from './representation/angle-representation'\nimport AxesRepresentation, {AxesRepresentationParameters} from './representation/axes-representation'\nimport BackboneRepresentation from './representation/backbone-representation'\nimport BallAndStickRepresentation, {BallAndStickRepresentationParameters} from './representation/ballandstick-representation'\nimport BaseRepresentation from './representation/base-representation'\nimport CartoonRepresentation, {CartoonRepresentationParameters} from './representation/cartoon-representation'\nimport ContactRepresentation, {ContactRepresentationParameters} from './representation/contact-representation'\nimport DihedralRepresentation, {DihedralRepresentationParameters} from './representation/dihedral-representation'\nimport DihedralHistogramRepresentation, {DihedralHistogramRepresentationParameters} from './representation/dihedral-histogram-representation'\nimport DistanceRepresentation, {DistanceRepresentationParameters} from './representation/distance-representation'\nimport HelixorientRepresentation from './representation/helixorient-representation'\nimport HyperballRepresentation, {HyperballRepresentationParameters} from './representation/hyperball-representation'\nimport LabelRepresentation, {LabelRepresentationParameters} from './representation/label-representation'\nimport LicoriceRepresentation from './representation/licorice-representation'\nimport LineRepresentation, {LineRepresentationParameters} from './representation/line-representation'\nimport MolecularSurfaceRepresentation, {MolecularSurfaceRepresentationParameters} from './representation/molecularsurface-representation'\nimport PointRepresentation, {PointRepresentationParameters} from './representation/point-representation'\nimport RibbonRepresentation, {RibbonRepresentationParameters} from './representation/ribbon-representation'\nimport RocketRepresentation, {RocketRepresentationParameters} from './representation/rocket-representation'\nimport RopeRepresentation from './representation/rope-representation'\nimport SpacefillRepresentation from './representation/spacefill-representation'\nimport StructureRepresentation, {StructureRepresentationParameters} from './representation/structure-representation'\nimport TraceRepresentation, {TraceRepresentationParameters} from './representation/trace-representation'\nimport TubeRepresentation from './representation/tube-representation'\nimport UnitcellRepresentation, {UnitcellRepresentationParameters} from './representation/unitcell-representation'\nimport ValidationRepresentation from './representation/validation-representation'\n\nimport BufferRepresentation from './representation/buffer-representation'\nimport ArrowBuffer from './buffer/arrow-buffer'\nimport BoxBuffer from './buffer/box-buffer'\nimport ConeBuffer from './buffer/cone-buffer'\nimport CylinderBuffer from './buffer/cylinder-buffer'\nimport EllipsoidBuffer from './buffer/ellipsoid-buffer'\nimport MeshBuffer from './buffer/mesh-buffer'\nimport OctahedronBuffer from './buffer/octahedron-buffer'\nimport PointBuffer from './buffer/point-buffer'\nimport SphereBuffer from './buffer/sphere-buffer'\nimport TetrahedronBuffer from './buffer/tetrahedron-buffer'\nimport TextBuffer from './buffer/text-buffer'\nimport TorusBuffer from './buffer/torus-buffer'\nimport WidelineBuffer from './buffer/wideline-buffer'\n\n//\n\nimport './parser/cif-parser'\nimport './parser/gro-parser'\nimport './parser/mmtf-parser'\nimport './parser/mol2-parser'\nimport './parser/pdb-parser'\nimport './parser/pdbqt-parser'\nimport './parser/pqr-parser'\nimport './parser/sdf-parser'\n\nimport './parser/prmtop-parser'\nimport './parser/psf-parser'\nimport './parser/top-parser'\n\nimport './parser/dcd-parser'\nimport './parser/nctraj-parser'\nimport './parser/trr-parser'\nimport './parser/xtc-parser'\n\nimport './parser/cube-parser'\nimport './parser/dsn6-parser'\nimport './parser/dx-parser'\nimport './parser/dxbin-parser'\nimport './parser/mrc-parser'\nimport './parser/xplor-parser'\n\nimport './parser/kin-parser'\nimport './parser/obj-parser'\nimport './parser/ply-parser'\n\nimport './parser/csv-parser'\nimport './parser/json-parser'\nimport './parser/msgpack-parser'\nimport './parser/netcdf-parser'\nimport './parser/text-parser'\nimport './parser/xml-parser'\n\nimport './parser/validation-parser'\n\n//\n\nimport Shape from './geometry/shape'\nimport Kdtree from './geometry/kdtree'\nimport SpatialHash from './geometry/spatial-hash'\nimport Structure from './structure/structure'\nimport MolecularSurface from './surface/molecular-surface'\nimport Volume from './surface/volume'\n\n//\n\nimport './utils/gzip-decompressor'\n\n//\n\nimport './datasource/rcsb-datasource'\nimport './datasource/pubchem-datasource'\nimport './datasource/passthrough-datasource'\nimport './datasource/alphafold-datasource'\nimport StaticDatasource from './datasource/static-datasource'\nimport MdsrvDatasource from './datasource/mdsrv-datasource'\n\n//\n\nexport {\n  LeftMouseButton, MiddleMouseButton, RightMouseButton\n} from './constants'\nexport {MouseActionCallback} from './controls/mouse-actions'\nimport MouseActions from './controls/mouse-actions'\nimport KeyActions from './controls/key-actions'\nimport PickingProxy from './controls/picking-proxy'\n\n//\n\nexport { Signal } from 'signals'\nexport {\n  Matrix3, Matrix4, Vector2, Vector3, Box3, Quaternion, Euler, Plane, Color\n} from 'three'\n\n//\n\nexport { UIStageParameters } from './ui/parameters'\nexport { StageParameters } from './stage/stage'\nexport { StructureComponentDefaultParameters } from './component/structure-component'\n\n//\n\nimport Version from './version'\n\nif (!(window as any).Promise) {\n  (window as any).Promise = _Promise\n}\n\nexport {\n  Version,\n  StaticDatasource,\n  MdsrvDatasource,\n  Colormaker,\n  Selection,\n  PdbWriter,\n  SdfWriter,\n  StlWriter,\n  Stage,\n  Viewer,\n  Collection,\n  ComponentCollection,\n  RepresentationCollection,\n  RepresentationElement,\n  Component,\n  ShapeComponent,\n  StructureComponent,\n  SurfaceComponent,\n  VolumeComponent,\n  StructureRepresentationType,\n  VolumeRepresentationType,\n\n  Assembly,\n  TrajectoryPlayer,\n  Superposition,\n  Frames,\n\n  Queue,\n  Counter,\n\n  AngleRepresentation,\n  AngleRepresentationParameters,\n  AxesRepresentation,\n  AxesRepresentationParameters,\n  BackboneRepresentation,\n  BallAndStickRepresentation,\n  BallAndStickRepresentationParameters,\n  BaseRepresentation,\n  CartoonRepresentation,\n  CartoonRepresentationParameters,\n  ContactRepresentation,\n  ContactRepresentationParameters,\n  DihedralRepresentation,\n  DihedralRepresentationParameters,\n  DihedralHistogramRepresentation,\n  DihedralHistogramRepresentationParameters,\n  DistanceRepresentation,\n  DistanceRepresentationParameters,\n  HelixorientRepresentation,\n  HyperballRepresentation,\n  HyperballRepresentationParameters,\n  LabelRepresentation,\n  LabelRepresentationParameters,\n  LicoriceRepresentation,\n  LineRepresentation,\n  LineRepresentationParameters,\n  MolecularSurfaceRepresentation,\n  MolecularSurfaceRepresentationParameters,\n  PointRepresentation,\n  PointRepresentationParameters,\n  RibbonRepresentation,\n  RibbonRepresentationParameters,\n  RocketRepresentation,\n  RocketRepresentationParameters,\n  RopeRepresentation,\n  SpacefillRepresentation,\n  StructureRepresentation,\n  StructureRepresentationParameters,\n  TraceRepresentation,\n  TraceRepresentationParameters,\n  TubeRepresentation,\n  UnitcellRepresentation,\n  UnitcellRepresentationParameters,\n  ValidationRepresentation,\n\n  BufferRepresentation,\n  ArrowBuffer,\n  BoxBuffer,\n  ConeBuffer,\n  CylinderBuffer,\n  EllipsoidBuffer,\n  MeshBuffer,\n  OctahedronBuffer,\n  PointBuffer,\n  SphereBuffer,\n  TetrahedronBuffer,\n  TextBuffer,\n  TorusBuffer,\n  WidelineBuffer,\n\n  Shape,\n\n  Structure,\n  Kdtree,\n  SpatialHash,\n  MolecularSurface,\n  Volume,\n\n  MouseActions,\n  KeyActions,\n  PickingProxy\n}\n"],"names":["toStr","isCallable","maxSafeInteger","toLength","start","window","console","properties","split","methods","pop","HTMLCanvasElement","prototype","toBlob","Object","defineProperty","value","callback","type","quality","bin","atob","this","toDataURL","len","length","len32","a8","Uint8Array","a32","Uint32Array","buffer","i","j","charCodeAt","tailLength","Blob","Math","cbrt","x","y","pow","abs","sign","isNaN","Number","isInteger","nVal","isFinite","floor","assign","enumerable","configurable","writable","target","TypeError","pendingException","to","hasPendingException","arguments","nextSource","keysArray","keys","nextIndex","nextKey","desc","getOwnPropertyDescriptor","undefined","e","String","startsWith","result","object","$defineProperty","error","toString","search","string","call","stringLength","searchString","searchLength","position","pos","min","max","index","endsWith","subjectString","lastIndex","indexOf","repeat","count","str","RangeError","Infinity","rpt","includes","Array","searchElement","O","parseInt","k","currentElement","n","from","fn","number","toInteger","arrayLike","C","items","T","mapFn","kValue","A","lastTime","vendors","requestAnimationFrame","cancelAnimationFrame","currTime","Date","getTime","timeToCall","id","setTimeout","clearTimeout","Function","name","get","match","performance","self","now","MAX_SAFE_INTEGER","MIN_SAFE_INTEGER","setTimeoutFunc","isArray","Boolean","noop","Promise","_state","_handled","_value","_deferreds","doResolve","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","ret","reject","promise","resolve","push","newValue","then","finale","thisArg","apply","_unhandledRejectionFn","Handler","done","reason","ex","prom","constructor","all","arr","args","slice","remaining","res","val","allSettled","status","race","setImmediate","err","warn","const","Texture","WebGLRenderTarget","Euler","let","Object3D","Scene","Color","Material","MeshBasicMaterial","Int8BufferAttribute","Uint8BufferAttribute","Uint8ClampedBufferAttribute","Int16BufferAttribute","Uint16BufferAttribute","Int32BufferAttribute","Uint32BufferAttribute","Float32BufferAttribute","Float64BufferAttribute","BufferGeometry","Mesh","Geometry","ShaderMaterial","Camera","PerspectiveCamera","DataTexture","PlaneGeometry","PlaneBufferGeometry","ShaderLib","CubeTexture","DataTexture2DArray","DataTexture3D","PureArrayUniform","StructuredUniform","WebGLUniforms","MeshDepthMaterial","MeshDistanceMaterial","ArrayCamera","Group","LineBasicMaterial","Line","LineSegments","PointsMaterial","Points","CanvasTexture","PolyhedronGeometry","PolyhedronBufferGeometry","TetrahedronGeometry","TetrahedronBufferGeometry","OctahedronGeometry","OctahedronBufferGeometry","IcosahedronGeometry","IcosahedronBufferGeometry","TorusGeometry","TorusBufferGeometry","CylinderGeometry","CylinderBufferGeometry","ConeGeometry","ConeBufferGeometry","Light","SpotLightShadow","SpotLight","OrthographicCamera","AmbientLight","getQuery","m","RegExp","exec","location","decodeURIComponent","defaults","defaultValue","createParams","params","defaultParams","o","updateParams","newParams","getProtocol","protocol","getBrowser","ua","navigator","userAgent","test","openUrl","url","open","href","download","data","downloadName","isSafari","isChromeIos","a","document","createElement","msSaveOrOpenBlob","FileReader","reader","onloadend","readAsDataURL","objectUrlCreated","URL","createObjectURL","style","display","body","appendChild","click","removeChild","revokeObjectURL","replace","lexicographicCompare","elm1","elm2","binarySearchIndexOf","array","element","compareFunction","low","high","mid","cmp","rangeInSortedArray","indexLeft","leftRange","binarySearchForLeftRange","indexRight","rightRange","binarySearchForRightRange","uniqueArray","sort","filter","sorted","uint8ToString","u8a","chunkSize","c","fromCharCode","subarray","join","getTypedArray","arrayType","arraySize","Int8Array","Int16Array","Int32Array","Uint16Array","Float32Array","Error","getUintArray","sizeOrArray","maxUint","ensureBuffer","ArrayBuffer","_ensureClassFromArray","fromArray","ensureVector3","v","Vector3","ensureMatrix4","Matrix4","ensureQuaternion","q","Quaternion","ensureFloat32Array","arg","toLowerCaseString","toLowerCase","Uniform","Registry","_dict","degToRad","deg","add","key","names","chars","uuid","generateUUID","r","rnd","random","clamp","lerp","stop","alpha","spline","p0","p1","p2","p3","t","tension","v0","v1","t2","smoothstep","normalize","DEG2RAD","LAB_CONSTANTS","PI","PITHIRD","RAD2DEG","TWOPI","_average_lrgb","_guess_formats","_guess_formats_sorted","_input","_interpolators","atan2","bezier","blend","blend_f","brewer","burn","chroma","clip_rgb","cmyk2rgb","cos","css2rgb","darken","dodge","each","hcg2rgb","hex2rgb","hsi2rgb","hsl2css","hsl2rgb","hsv2rgb","interpolate","interpolate_hsx","interpolate_lab","interpolate_lrgb","interpolate_num","interpolate_rgb","lab2lch","lab2rgb","lab_xyz","lch2lab","lch2rgb","lighten","limit","log","luminance_x","multiply","num2rgb","overlay","rgb2cmyk","rgb2css","rgb2hcg","rgb2hex","rgb2hsi","rgb2hsl","rgb2hsv","rgb2lab","rgb2lch","rgb2luminance","rgb2num","rgb2temperature","rgb2xyz","rgb_xyz","round","screen","sin","sqrt","temperature2rgb","unpack","w3cx11","xyz_lab","xyz_rgb","classToType","ref","obj","strType","rgb","_clipped","_unclipped","func","ctor","child","module","exports","version","chk","len1","me","mode","w","_rgb","b","p","hex","OrRd","PuBu","BuPu","Oranges","BuGn","YlOrBr","YlGn","Reds","RdPu","Greens","YlGnBu","Purples","GnBu","Greys","YlOrRd","PuRd","Blues","PuBuGn","Viridis","Spectral","RdYlGn","RdBu","PiYG","PRGn","RdYlBu","BrBG","RdGy","PuOr","Set2","Accent","Set1","Set3","Dark2","Paired","Pastel2","Pastel1","results","colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflower","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","laserlemon","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrod","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","maroon2","maroon3","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","purple2","purple3","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","l","z","Yn","Xn","Zn","t1","t0","Kn","t3","g","ref1","lab","concat","I","I0","I1","lab0","lab1","lab2","lab3","ref2","f","scale","cubehelix","rotations","hue","gamma","lightness","dh","dl","fract","amp","cos_a","sin_a","s","h","code","charAt","col1","col2","interpol","mix","map","rgba","lrgb","xyz0","xyz1","xyz","average","cnt","dx","dy","first","xyz2","splice","u","substr","css","channels","hxa","NaN","hsl","ref3","ref4","ref5","delta","hsv","num","_c","_g","hcg","aa","ab","named","L","lch","hcl","reverse","cmyk","gl","luminance","lum","cur_lum","eps","max_iter","lm","kelvin","temp","maxTemp","minTemp","temperature","K","contrast","l1","l2","distance","d","sum_sq","deltaE","L1","L2","a1","a2","b1","b2","c1","c2","c4","delA","delB","delC","h1","sc","sl","v2","v3","modechan","channel","src","set","clipped","amount","brighten","darker","brighter","saturate","desaturate","premultiply","c0","out","bottom","top","normal","analyze","MAX_VALUE","sum","values","domain","limits","positions","_classes","_colorCache","_colors","_correctLightness","_domain","_gamma","_max","_min","_mode","_nacol","_out","_padding","_pos","_spread","_useCache","getClass","getColor","resetCache","setColors","tmap","col","bypassMap","classes","_m","range","_o","spread","correctLightness","L0","L_actual","L_diff","L_ideal","pol","padding","numColors","dd","dm","samples","cache","nodata","scales","cool","hot","visit","ac","ad","ae","af","ag","ah","ai","aj","ak","al","am","assignments","best","centroids","cluster","clusterSizes","dist","kClusters","max_log","min_log","mindist","nb_iters","newCentroids","pb","pr","ref10","ref11","ref12","ref13","ref14","ref6","ref7","ref8","ref9","tmpKMeansBreaks","LOG10E","acos","hsi","hue0","hue1","lbv0","lbv1","sat","sat0","sat1","n1","n2","colorSpace","ScaleDefaultParameters","tmpColor","manageColor","_target","_name","descriptor","originalMethod","fromTo","bind","convertSRGBToLinear","getHex","Colormaker","parameters","structure","atomProxy","getAtomProxy","getScale","chroma\n        .scale","colorToArray","color","offset","atomColorToArray","atom","atomColor","bondColor","bond","atomIndex1","atomIndex2","bondColorToArray","volumeColorToArray","volumeColor","positionColorToArray","coords","positionColor","kwd","global","SignalBinding","signal","listener","isOnce","listenerContext","priority","_listener","_isOnce","context","_signal","_priority","validateListener","fnName","Signal","_bindings","_prevParams","dispatch","active","execute","paramsArr","handlerReturn","detach","isBound","remove","getListener","getSignal","_destroy","VERSION","memorize","_shouldPropagate","_registerListener","binding","prevIndex","_indexOfListener","_addBinding","cur","has","addOnce","removeAll","getNumListeners","halt","bindings","forget","dispose","signals","SelectAllKeyword","SelectNoneKeyword","AtomOnlyKeywords","BACKBONE","SIDECHAIN","BONDED","RING","AROMATICRING","METAL","POLARH","ChainKeywords","POLYMER","WATER","SmallResname","NucleophilicResname","HydrophobicResname","AromaticResname","AmideResname","AcidicResname","BasicResname","ChargedResname","PolarResname","NonpolarResname","CyclicResname","AliphaticResname","atomTestFn","atomname","altloc","atomindex","keyword","inscode","resname","sstruc","resno","chainname","model","isBackbone","isSidechain","isBonded","isRing","isAromatic","HETERO","isHetero","PROTEIN","isProtein","NUCLEIC","isNucleic","RNA","isRna","DNA","isDna","isPolymer","isWater","HELIX","isHelix","SHEET","isSheet","TURN","isTurn","ION","isIon","SACCHARIDE","isSaccharide","isMetal","isPolarHydrogen","modelIndex","residueTestFn","atomOffset","atomEnd","chainTestFn","entity","modelTestFn","makeTest","selection","rules","negate","subTests","hasOwnProperty","and","operator","na","ALL","NONE","filtered","fs","makeAtomTest","atomOnly","filteredSelection","makeResidueTest","residueOnly","makeChainTest","chainOnly","makeModelTest","modelOnly","Selection","stringChanged","setString","silent","retSelection","newSelection","oldSelection","selectionStack","trim","chunks","createNewContext","getPrevContext","pushRule","rule","not","cu","toUpperCase","sele","substring","chain","negate2","resi","resiSingle","resiRange","resnameList","indexList","lastRule","parseSele","message","residueTest","chainTest","modelTest","atomOnlyTest","residueOnlyTest","chainOnlyTest","modelOnlyTest","isAllSelection","isNoneSelection","SelectionColormaker","super","dataList","forEach","ColormakerRegistry","hasScheme","scheme","colormakerList","getScheme","selectionList","ColormakerScales","rainbow","rwb","ColormakerModes","schemes","userSchemes","getSchemes","types","getScales","getModes","addScheme","label","_createScheme","_addUserScheme","removeScheme","_Colormaker","addSelectionScheme","MySelectionColormaker","ParserRegistry","__hasObjName","objName","parser","__objName","isTrajectory","isStructure","isVolume","isSurface","isBinary","isXml","isJson","getTrajectoryExtensions","getStructureExtensions","getVolumeExtensions","getSurfaceExtensions","getWorkerDeps","vars","deps","sym","__deps","makeWorkerString","onmessage","__name","postId","__postId","aMessage","transferList","postMessage","makeWorkerBlob","WorkerRegistry","_funcDict","_depsDict","_blobDict","Browser","SupportsPassiveEventHandler","opts","addEventListener","Mobile","orientation","SupportsReadPixelsFloat","setSupportsReadPixelsFloat","ExtensionFragDepth","setExtensionFragDepth","Log","info","time","timeEnd","MeasurementDefaultParams","labelColor","labelAttachment","labelSize","labelZOffset","labelYOffset","labelBorder","labelBorderColor","labelBorderWidth","lineOpacity","linewidth","opacity","labelUnit","arcVisible","planeVisible","ScriptExtensions","_WorkerRegistry","_ColormakerRegistry","DatasourceRegistry","RepresentationRegistry","_ParserRegistry","ShaderRegistry","DecompressorRegistry","ComponentRegistry","BufferRegistry","PickerRegistry","Streamer","compressed","binary","json","xml","read","_read","decompressFn","_chunk","end","chunk","peekLines","newline","chunkToLines","lines","chunkCount","asText","partialLine","isLast","idx","lastIndexOf","str2","nextChunk","__pointer","nextChunkOfLines","__partialLine","eachChunk","eachChunkOfLines","chunkNo","FileStreamer","file","onload","event","onerror","readAsArrayBuffer","readAsText","NetworkStreamer","xhr","XMLHttpRequest","response","statusText","responseType","send","Loader","ext","dir","path","streamerParams","File","streamer","ParserLoader","parserParams","voxelSize","firstModelOnly","asTrajectory","cAlphaOnly","delimiter","comment","columnNames","load","parse","Script","functionBody","elementAdded","elementRemoved","nameChanged","run","stage","ScriptLoader","getFileInfo","compressedExtList","queryIndex","query","base","nameSplit","protocolMatch","getDataInfo","datasource","getUrl","getExt","autoLoad","loader","re","not_string","not_bool","not_type","not_primitive","numeric_arg","not_json","text","modulo","placeholder","key_access","index_access","sprintf","sprintf_format","sprintf_parse","vsprintf","fmt","argv","parse_tree","ph","pad","pad_character","pad_length","is_positive","cursor","tree_length","output","param_no","JSON","stringify","width","precision","parseFloat","toExponential","toFixed","toPrecision","valueOf","pad_char","align","sprintf_cache","create","_fmt","arg_names","SyntaxError","field_list","replacement_field","field_match","Writer","getBlob","getData","mimeType","defaultName","defaultExt","PdbWriter","renumberSerial","remarks","ensureArray","_records","_writeRecords","_writeTitle","_writeRemarks","_writeAtoms","trajectory","ia","im","charge","chargeSign","eachModel","eachAtom","formatString","hetero","serial","formalCharge","occupancy","bfactor","getSelection","getString","SdfWriter","prototypeAccessors","idString","titleString","title","countsString","atomCount","bondCount","chargeLines","pairs","ap","nCharges","formatAtom","line","formatBond","bp","bondOrder","_writeHeader","_writeCTab","_writeFooter","eachBond","charArray","IOBuffer","dataIsGiven","byteLength","dvOffset","byteOffset","_lastWrittenByte","_data","DataView","available","isLittleEndian","littleEndian","setLittleEndian","isBigEndian","setBigEndian","skip","seek","mark","_mark","reset","pushMark","_marks","popMark","rewind","ensureAvailable","newLength","newArray","readBoolean","readUint8","readInt8","getInt8","getUint8","readByte","readBytes","bytes","readInt16","getInt16","readUint16","getUint16","readInt32","getInt32","readUint32","getUint32","readFloat32","getFloat32","readFloat64","getFloat64","readChar","readChars","writeBoolean","writeUint8","writeInt8","setInt8","_updateLastWrittenByte","setUint8","writeByte","writeBytes","writeInt16","setInt16","writeUint16","setUint16","writeInt32","setInt32","writeUint32","setUint32","writeFloat32","setFloat32","writeFloat64","setFloat64","writeChar","writeChars","toArray","StlWriter","surface","triangles","vector","vectorNorm1","vectorNorm2","vectorNorm3","indices","addVectors","Counter","countChanged","signalsWrapper.Signal","clear","change","increment","decrement","listen","counter","unlisten","onZeroOnce","Stats","updated","begin","update","startTime","currentTime","lastFrames","frames","lastDuration","minDuration","maxDuration","avgDuration","prevFpsTime","lastFps","reInclude","shaderCache","getShader","defines","hash","definesText","getDefines","shaderText","ShaderChunk","WebGLRenderingContext","wrcp","_getShaderParameter","getShaderParameter","Debug","_getShaderInfoLog","getShaderInfoLog","_getProgramParameter","getProgramParameter","program","pname","LINK_STATUS","_getProgramInfoLog","getProgramInfoLog","JitterVectors","offsetList","TiledRenderer","renderer","camera","viewer","_viewer","_factor","factor","_antialias","antialias","_onProgress","onProgress","_onFinish","onFinish","_n","_width","_height","height","canvas","_ctx","getContext","_viewerSampleLevel","sampleLevel","setSampling","_renderTile","offsetX","offsetY","setViewOffset","render","drawImage","domElement","ceil","_finalize","view","renderAsync","TwoPI","circularMean","stride","cosMean","sinMean","angle","calculateCenterArray","array1","array2","center","calculateDirectionArray","direction","uniformArray","optionalTarget","uniformArray3","serialArray","serialBlockArray","replicateArrayEntries","repArr","copyArray","dst","srcOffset","dstOffset","copyWithin","arrayMax","il","arrayMin","arraySum","arrayMean","ImageDefaultParameters","transparent","makeImage","originalClearAlpha","getClearAlpha","backgroundColor","getClearColor","setLineWidthAndPixelSize","invert","scene","traverse","material","uniforms","size","__seen","trimCanvas","bg","doBreak","off","canvasHeight","canvasWidth","pixels","getImageData","topY","topX","bottomY","bottomX","trimedCanvas","_trimCanvas","finished","tiledRenderer","blob","setClearAlpha","requestRender","vertex","matrix","modelViewProjectionMatrix","resolution","Vector2","projectionMatrixInverse","projectionMatrixTranspose","updateCameraUniforms","group","getInverse","projectionMatrix","copy","transpose","loadShader","shaderSource","shaderType","shader","createShader","compileShader","COMPILE_STATUS","deleteShader","getExtension","TextureTestTexCoords","testTextureSupport","vertShader","VERTEX_SHADER","fragShader","FRAGMENT_SHADER","shaders","attribs","locations","createProgram","attachShader","attrib","bindAttribLocation","linkProgram","deleteProgram","useProgram","positionLocation","getAttribLocation","colorLoc","getUniformLocation","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","whiteTex","createTexture","whiteData","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","tex","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","uniform4fv","drawArrays","TRIANGLES","clearColor","COLOR_BUFFER_BIT","pixel","readPixels","floatPixel","getError","NO_ERROR","INVALID_ENUM","INVALID_VALUE","INVALID_OPERATION","INVALID_FRAMEBUFFER_OPERATION","OUT_OF_MEMORY","CONTEXT_LOST_WEBGL","pixelBufferFloat","pixelBufferUint","pixelOrder","tmpMatrix","onBeforeRender","geometry","updateList","objectId","modelViewMatrixInverse","modelViewMatrixInverseTranspose","modelViewProjectionMatrixInverse","modelViewMatrix","multiplyMatrices","matrixWorldInverse","matrixWorld","materialProperties","pu","getUniforms","setValue","Viewer","idOrElement","Box3","memory","programs","geometries","textures","calls","vertices","faces","points","ticked","rendered","elm","getElementById","container","HTMLElement","innerWidth","innerHeight","box","getBoundingClientRect","overflow","wrapper","_initParams","_initStats","_initCamera","_initScene","_initRenderer","_initHelper","setBackground","setFog","animate","fogColor","fogNear","fogFar","cameraType","cameraFov","cameraEyeSep","cameraZ","clipNear","clipFar","clipDist","clipMode","clipScale","lightColor","lightIntensity","ambientColor","ambientIntensity","rendererEncoding","LinearEncoding","lookAt","perspectiveCamera","orthographicCamera","stereoCamera","StereoCamera","aspect","eyeSep","updateProjectionMatrix","stats","rotationGroup","translationGroup","modelGroup","pickingGroup","backgroundGroup","helperGroup","fog","Fog","spotLight","ambientLight","dpr","devicePixelRatio","WebGLRenderer","preserveDrawingBuffer","innerHTML","setPixelRatio","setSize","autoClear","sortObjects","outputEncoding","capabilities","isWebGL2","extensions","supportsHalfFloat","dprWidth","dprHeight","OES_texture_float","OES_texture_half_float","WEBGL_color_buffer_float","pickingTarget","minFilter","NearestFilter","magFilter","stencilBuffer","format","RGBAFormat","FloatType","UnsignedByteType","texture","generateMipmaps","encoding","setRenderTarget","sampleTarget","LinearFilter","holdTarget","compositeUniforms","tForeground","compositeMaterial","vertexShader","fragmentShader","premultipliedAlpha","blending","depthTest","depthWrite","compositeCamera","compositeScene","bbGeometry","setIndex","BufferAttribute","setAttribute","bbMaterial","uColor","boundingBoxMesh","updateHelper","attributes","boundingBox","needsUpdate","isEmpty","computeBoundingSphere","cameraDistance","instanceList","instance","addBuffer","wireframeGroup","background","pickable","setUserData","children","userData","mesh","getMesh","applyMatrix4","wireframeMesh","getWireframeMesh","quaternion","pickingMesh","getPickingMesh","_updateBoundingBox","updateBoundingBox","instanceMatrix","updateGeometry","computeBoundingBox","geoBoundingBox","clone","equals","expandByScalar","union","updateNode","node","makeEmpty","getSize","boundingBoxSize","boundingBoxLength","getPickingPixels","imgBuffer","readRenderTargetPixels","getImage","picking","imgBuffer2","ctx","imgData","putImageData","setLight","intensity","near","far","setClearColor","getStyle","level","setOutputEncoding","setColorWorkflow","setCamera","fov","up","updateZoom","setClip","left","right","handleResize","updateInfo","rInfo","rMemory","rRender","isStill","currentSampleLevel","renderPending","frameRequest","pick","pid","picker","pixelBuffer","oid","getObjectById","zoom","absoluteToRelative","bRadius","relativeToAbsolute","__updateClipping","getWorldPosition","distVector","cDist","nearFactor","farFactor","fogNearFactor","fogFarFactor","__updateCamera","updateMatrix","updateMatrixWorld","pixelRatio","getPixelRatio","ortho","nearClip","updateMaterialUniforms","traverseVisible","sortParticles","sortData","sortArray","zArray","cmpFn","indexSrc","tmpTab","__zArray","__sortArray","__cmpFn","bi","tmp","stack","sp","swap","tmp2","quicksortCmp","attr","itemSize","sortProjectedPosition","__setVisibility","helper","visible","__updateLights","setLength","__renderPickingGroup","__renderModelGroup","renderTarget","__renderSuperSample","baseSampleWeight","sampleWeight","clearViewOffset","__renderStereo","_renderTarget","setScissorTest","setScissor","setViewport","cameraL","__render","cameraR","lastRenderedPicking","rendering","getTouchDistance","touches","pageX","pageY","MouseObserver","moved","scrolled","dragged","dropped","clicked","hovered","doubleClicked","touchAction","hoverTimeout","handleScroll","doubleClickSpeed","_listen","_onMousewheel","_onMousemove","_onMousedown","_onMouseup","_onContextmenu","_onTouchstart","_onTouchend","_onTouchmove","opt","passive","altKey","ctrlKey","metaKey","shiftKey","setParameters","cp","canvasPosition","doubleClickPending","lastClicked","lastMoved","moving","hovering","overElement","preventDefault","_setKeys","deltaY","deltaMode","WheelEvent","DOM_DELTA_PIXEL","DOM_DELTA_LINE","wheelDelta","wheelDeltaY","detail","prevPosition","clientX","clientY","_setCanvasPosition","pressed","down","which","buttons","button","getMouseButtons","_distance","prevClickCP","distanceTo","lastTouchDistance","touchDistance","removeEventListener","tmpRotateXMatrix","tmpRotateYMatrix","tmpRotateZMatrix","tmpRotateMatrix","tmpRotateCameraMatrix","tmpRotateVector","tmpRotateQuaternion","tmpRotateQuaternion2","tmpPanMatrix","tmpPanVector","tmpAtomVector","TrackballControls","rotateSpeed","zoomSpeed","panSpeed","mouse","mouseObserver","controls","viewerControls","component","transformComponent","transformAtom","_setPanVector","scaleFactor","getCanvasScaleFactor","multiplyScalar","_getRotateXY","_getCameraRotation","extractRotation","makeRotationY","_transformPanVector","transform","pan","translate","panComponent","panAtom","positionToVector3","positionAdd","updateRepresentations","rotate","setFromAxisAngle","makeRotationFromQuaternion","applyMatrix","zRotate","dz","makeRotationZ","rotateComponent","makeRotationAxis","setFromRotationMatrix","tmpVec","PickingProxy","pickingData","getComponentsByObject","list","getObject","getPosition","closestBondAtom","atom1","atom2","acp1","getPositionOnCanvas","acp2","closeAtom","ca","acp","radius","getMaxRepresentationRadius","arrow","_objectIfType","axes","cone","clash","contact","cylinder","ellipsoid","octahedron","point","sphere","tetrahedron","torus","unitcell","unknown","volume","wideline","getLabel","msg","qualifiedName","shape","PickingControls","pickerArray","tmpQ","tmpP","tmpS","tmpCanvasVector","tmpScaleVector","tmpAlignMatrix","ViewerControls","changed","rotation","project","getCameraDistance","getOrientation","setPosition","orient","decompose","setRotationFromQuaternion","spin","axis","rotateOnAxis","basis","setRotationFromMatrix","Animation","duration","_init","paused","_paused","tick","elapsedDuration","pausedDuration","_tick","_resolveList","pause","hold","_hold","pausedTime","resume","releaseHold","toggle","SpinAnimation","RockAnimation","angleStep","angleEnd","angleSum","MoveAnimation","moveFrom","moveTo","lerpVectors","ZoomAnimation","zoomFrom","zoomTo","RotateAnimation","rotateFrom","rotateTo","_currentRotation","slerp","ValueAnimation","valueFrom","valueTo","TimeoutAnimation","AnimationList","_list","every","animation","AnimationControls","animationList","finishedList","rock","move","zoomMove","orientTo","timeout","spinComponent","rockComponent","moveComponent","Queue","argList","next","queue","shift","pending","kill","Representation","lazy","step","clipRadius","clipCenter","flatShaded","side","options","front","back","double","wireframe","colorData","colorScheme","colorScale","colorReverse","colorValue","colorDomain","colorMode","roughness","metalness","diffuse","diffuseInterior","useInteriorColor","interiorColor","interiorDarkening","disablePicking","rebuild","tasks","make","bufferList","toBePrepared","init","setColor","lazyProps","build","bufferParams","what","tp","sphereDetail","radialSegments","openEnded","disableImpostor","getColorParams","getBufferParams","prepare","updateWhat","_make","manualAttach","disposed","attach","setVisibility","noRenderRequest","updateParameters","int","float","getParameters","_Worker","blobUrl","worker","Worker","activeWorkerCount","onmessageDict","onerrorDict","post","postCount","__debug","terminate","WorkerPool","maxCount","calculateMeanVector3","projectPointOnVector","origin","sub","projectOnVector","minX","minY","minZ","maxX","maxY","maxZ","v3new","applyMatrix4toVector3array","applyMatrix3toVector3array","normalizeVector3array","len2","v3cross","ax","ay","az","bx","by","bz","v3dot","v3sub","v3add","v3fromArray","v3toArray","input","v3length2","v3length","v3divideScalar","v3multiplyScalar","v3normalize","length2","v3subScalar","v3addScalar","v3floor","v3ceil","v3negate","getFixedCountDashData","segmentCount","position1","sn3","position2","i3","j3","f1","f2","replicateArray3Entries","primitiveId","getFixedLengthDashData","segmentLength","pos1","pos2","rad","getFixedLengthWrappedDashData","drawing","k3","kprev","vl","inv","getNextWorker","pool","nextWorker","minPending","Primitive","staticAccessors","Picker","Buffer","getShapeKey","expandBoundingBox","valueToShape","_primitiveData","fields","objectToShape","valueFromShape","objectFromShape","arrayFromShape","dataFromShape","bufferFromShape","SpherePrimitive","positionFromShape","expandByPoint","BoxPrimitive","heightAxis","depthAxis","OctahedronPrimitive","TetrahedronPrimitive","CylinderPrimitive","dashedCylinder","ArrowPrimitive","ConePrimitive","EllipsoidPrimitive","majorAxis","minorAxis","TorusPrimitive","TextPrimitive","PointPrimitive","WidelinePrimitive","SpatialHash","bb","createBoundingBox","boundX","exp","boundY","boundZ","an","xArray","yArray","grid","bucketIndex","bucketCount","bucketOffset","bucketFill","bucketArray","bucketIdx","within","eachWithin","atomIndex","rSq","loX","loY","loZ","hiX","hiY","hiZ","ix","iy","iz","dSq","Store","_fields","_defaultFields","_initField","addField","resize","tmpArray","growIfFull","copyFrom","other","thisOffset","otherOffset","thisField","otherField","thisIndex","otherIndex","offsetTarget","offsetSource","targetIndex","sourceIndex","thisStore","tmpStore","quicksort","pivot","leftNew","rightNew","index1","index2","ContactStore","addContact","hammingWeight","BitArray","setAll","_words","createAdjacencyList","edges","countArray","nodeCount","offsetArray","edgeCount","nodeArray1","nodeArray2","bondCount2","indexArray","idx1","idx2","j1","j2","createFeatureState","atomSet","addAtom","state","addFeature","features","groups","centers","atomSets","flip","_assignRange","words","wordValue","wordStart","wordEnd","startWord","endWord","setRange","clearRange","setBits","clearBits","clearAll","flipAll","bs","_isRangeValue","isRangeSet","isRangeClear","isAllSet","isAllClear","isSet","isClear","isEqualTo","otherBitarray","words1","words2","difference","intersection","intersects","getIntersectionSize","makeIntersection","wordsA","answer","toSeleString","ChemCompProtein","ChemCompRna","ChemCompDna","ChemCompSaccharide","ChemCompHetero","SecStrucHelix","SecStrucSheet","SecStrucTurn","AtomicNumbers","H","D","HE","LI","BE","B","N","F","NE","NA","MG","AL","SI","P","S","CL","AR","CA","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","GA","GE","AS","SE","BR","KR","RB","SR","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","IN","SN","SB","TE","XE","CS","BA","LA","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","HF","TA","W","RE","OS","IR","PT","AU","HG","TL","PB","BI","PO","AT","RN","FR","RA","AC","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR","RF","DB","SG","BH","HS","MT","DS","RG","CN","NH","FL","MC","LV","TS","OG","VdwRadii","CovalentRadii","Valences","OuterShellElectronCounts","ResidueHydrophobicity","ALA","ARG","ASN","ASP","ASH","CYS","GLN","GLU","GLH","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","DefaultResidueHydrophobicity","AA1","SEC","PYL","AA3","RnaBases","DnaBases","PurinBases","Bases","WaterNames","IonNames","SaccharideNames","ProteinBackboneAtoms","NucleicBackboneAtoms","ResidueTypeAtoms","assignGeometry","totalCoordination","trace","direction1","direction2","backboneStart","backboneEnd","Angles","Map","calcAngles","ap1","ap2","angles","d1","d2","subVectors","eachBondedAtom","angleTo","calcPlaneAngle","x1","v12","neighbours","ni","cross","ValenceModel","implicitH","totalH","idealGeometry","hydrogenCount","bondToElementCount","assignCharge","assignH","degree","valence","explicitValence","conjugated","_bp","getBondProxy","atomicNumber","flag","getOtherAtom","atomicNumber2","isConjugated","multiBond","implicitHCount","geom","ba","oa","calculateHydrogensCharge","chg","implH","totH","valenceModel","isPhosphate","PositvelyCharged","NegativelyCharged","addChargedContacts","contacts","maxIonicDist","ContactDefaultParams","maxPiStackingDist","maxPiStackingOffset","maxPiStackingAngle","maxCationPiDist","maxCationPiOffset","masterIdx","masterModelIndex","maxDistance","maxPiStackingDistSq","maxCationPiDistSq","atomStore","getNormal","atoms","crossVectors","getOffset","projectOnPlane","ct","featureSet","contactStore","spatialHash","invalidAtomContact","ti","tj","isIonicInteraction","atomSet1","atomSet2","maxDist","sn","sm","si","sj","areAtomSetsWithinDist","isPiStacking","isCationPi","isHistidineNitrogen","IonicTypeMetals","halBondElements","X","OptimalHalogenAngle","OptimalAcceptorAngle","isMasterContact","maxHydrophobicDist","maxHbondDist","maxHbondSulfurDist","maxHbondAccAngle","maxHbondDonAngle","maxHbondAccPlaneAngle","maxHbondDonPlaneAngle","maxHalogenBondDist","maxHalogenBondAngle","maxMetalDist","refineSaltBridges","lineOfSightDistFactor","residueIndex","calculateFeatures","atomInGroupDict","eachResidue","addGroup","terminalNitrogenCount","isGuanidine","isAcetamidine","addPositiveCharges","isSulfonicAcid","isSulfate","terminalOxygenCount","isCarboxylate","addNegativeCharges","rings","getAromaticRings","ring","addAromaticRings","totalBonds","ig","addHydrogenAcceptors","addHydrogenDonors","ringData","residueType","getRings","hasElement","some","residueAtomOffset","atomTypeId","atomTypeIdList","atomMap","inAromaticRingWithElectronNegativeElement","addWeakHydrogenDonors","dative","ionic","isStandardAminoacid","isStandardBase","isHalogen","addMetalBinding","isTransitionMetal","addMetals","addHydrophobic","addHalogenAcceptors","addHalogenDonors","calculateContacts","createContacts","maxHbondDistSq","donor","acceptor","isWeak","isWeakHydrogenBond","isHydrogenBond","connectedTo","donorAngles","idealDonorAngle","donorAngle","outOfPlane","acceptorAngles","idealAcceptorAngle","acceptorAngle","bondType","isWaterHydrogenBond","isBackboneHydrogenBond","addHydrogenBonds","m1","m2","addMetalComplexation","addHydrophobicContacts","halogenAngles","halogen","addHalogenBonds","frozenContacts","adjacencyList","contactSet","createFrozenContacts","ac1","ac2","aw","lineOfSightDist","lineOfSightDistFactorSq","cx","cy","cz","as1","as2","vdw","distanceToSquared","refineLineOfSight","residueContactDict","handleResidueContact","minDist","minIndex","refineHydrophobicContacts","ionicInteractionDict","isHydrogenBondType","iil1","iil2","piStackingDict","pil1","pil2","refinePiStacking","refineMetalCoordination","contactTypeName","ContactDataDefaultParams","hydrogenBond","hydrophobic","halogenBond","ionicInteraction","metalCoordination","cationPi","piStacking","weakHydrogenBond","waterHydrogenBond","backboneHydrogenBond","filterSele","getContactData","filterSet","getAtomSet","setHex","contactColor","color2","ContactPicker","getIndex","_applyTransformations","_getPosition","ShapePicker","prototypeAccessors$1","primitive","CylinderPicker","prototypeAccessors$2","ArrowPicker","prototypeAccessors$3","AtomPicker","prototypeAccessors$4","AxesPicker","prototypeAccessors$5","BondPicker","bondStore","prototypeAccessors$6","prototypeAccessors$7","center1","center2","ConePicker","prototypeAccessors$8","ClashPicker","validation","prototypeAccessors$9","clashArray","_getAtomProxyFromSele","getAtomIndices","sele1","sele2","DistancePicker","prototypeAccessors$10","EllipsoidPicker","prototypeAccessors$11","OctahedronPicker","prototypeAccessors$12","BoxPicker","prototypeAccessors$13","IgnorePicker","prototypeAccessors$14","MeshPicker","prototypeAccessors$15","__position","SpherePicker","prototypeAccessors$16","SurfacePicker","prototypeAccessors$17","TetrahedronPicker","prototypeAccessors$18","TorusPicker","prototypeAccessors$19","UnitcellPicker","prototypeAccessors$20","getCenter","VolumePicker","prototypeAccessors$22","vol","dp","SlicePicker","prototypeAccessors$23","PointPicker","prototypeAccessors$24","WidelinePicker","prototypeAccessors$25","getEdgeTable","getTriTable","getAllowedContours","MarchingCubes","field","nx","ny","nz","normalCache","vertexIndex","icount","mx","my","mz","isolevel","noNormals","contour","wrap","isNegativeIso","normalFactor","yd","zd","ilist","positionArray","normalArray","atomindexArray","edgeTable","triTable","allowedContours","VIntX","valp1","valp2","_q","mu","nc","q3","VIntY","q6","VIntZ","compNorm","polygonize","fx","fy","fz","edgeFilter","q1","qy","qz","q1y","q1z","qyz","q1yz","cubeindex","field0","field1","field2","field3","field4","field5","field6","field7","bits","fx2","fy2","fz2","e1","e2","e3","triIndex","triangulate","xBeg","yBeg","zBeg","xEnd","yEnd","zEnd","yOffset","zOffset","xBeg2","yBeg2","zBeg2","xEnd2","yEnd2","zEnd2","__break","__xBeg","__yBeg","__zBeg","__xEnd","__yEnd","__zEnd","_isolevel","_noNormals","_box","_contour","_wrap","vIndexLength","Matrix","cols","rows","At","nrows","ncols","Ai","Ati","pAt","atd","multiplyABt","Ap","pA","pB","Cp","mrows","bd","cd","multiply3x3","Cd","Ad","Bd","m10","m11","m12","m13","m14","m15","m16","m17","m18","m20","m21","m22","m23","m24","m25","m26","m27","m28","meanRows","mean","subRows","row","i0","i1","hypot","copyTo","svd","at","amt","wmt","vmt","astep","_W","Vt","vstep","iter","maxIter","Aj","Vi","Vj","sd","beta","seed","val0","asum","Float64Array","EPSILON","JacobiSVDImpl","m4new","m4set","n11","n12","n13","n14","n21","n22","n23","n24","n31","n32","n33","n34","n41","n42","n43","n44","m4multiply","a11","a12","a13","a14","a21","a22","a23","a24","a31","a33","a34","a41","a42","a43","a44","b11","b12","b13","b14","b21","b22","b23","b24","b31","b32","b33","b34","b41","b42","b43","b44","m4makeScale","m4makeTranslation","m4makeRotationY","theta","m3new","m3makeNormal","m4","r0","r1","r2","laplacianSmooth","verts","numiter","inflate","nv","nf","norms","jl","flagvert","tps","vertdeg","ao","bo","co","vi3","vdi","wtvi","wt2vi","wt2","outwt","computeVertexNormals","nv3","ci","getRadiusDict","radiusList","radiusDict","getSurfaceGrid","maxRadius","extraMargin","margin","dim","maxSize","tmpSize","tran","mroty","mscale","mtrans","Surface","fromGeometry","setFromArray","VolumeSurface","mc","getSurface","smooth","normalMatrix","geo","colormaker","tc","getPicking","getFilteredIndex","filteredIndex","elementSize","include","getAtomindex","volsurf","Volume","Matrix3","inverseMatrix","setData","getThreeSide","setAtomindex","_position","_mean","_rms","setStats","rms","setMatrix","elements","ne","getBox","_getBox","__box","_makeSurface","getValueForSigma","getSurfaceWorker","workerPool","sigma","getSigmaForValue","getDataAtomindex","getDataPosition","getDataColor","getDataPicking","getDataSize","_sum","sumSq","di","arrayRms","header","setObjectMatrix","matrixWorldNeedsUpdate","BufferDefaultParameters","opaqueBack","forceTransparent","BufferParameterTypes","updateShader","property","uniform","updateVisibility","defaultParameters","UniformsUtils","merge","UniformsLib","common","emissive","lights","pickingUniforms","_positionDataSize","addAttributes","initIndex","makeWireframeGeometry","attributeSize","nindex","setUsage","dynamic","DYNAMIC_DRAW","makeMaterial","vertexColors","derivatives","fragDepth","isImpostor","wm","pm","wireframeMaterial","pickingMaterial","makeWireframeIndex","wireframeIndex","wireframeGeometry","setDrawRange","wireframeIndexCount","checkEdge","drawRange","wireframeIndexVersion","indexVersion","updateWireframeIndex","updateRange","getRenderOrder","renderOrder","isText","_getMesh","materialName","isLine","isPoint","frustumCulled","getVertexShader","getFragmentShader","NEAR_CLIP","RADIUS_CLIP","PICKING","NOLIGHT","FLAT_SHADED","OPAQUE_BACK","DIFFUSE_INTERIOR","USE_INTERIOR_COLOR","addUniforms","buf","updateRenderOrder","setRenderOrder","pt","parameterTypes","pv","propertyData","uniformData","doShaderUpdate","doVisibilityUpdate","setProperties","setUniforms","setAttributes","attribute","wu","isVector3","toJSON","MeshBuffer","SurfaceBuffer","setVisibilityTrue","setVisibilityFalse","DoubleSidedBuffer","frontBuffer","backBuffer","frontMeshes","backMeshes","ContourBuffer","SurfaceRepresentation","isolevelType","negateIsolevel","isolevelScroll","boxSize","colorVolume","useWorker","boxCenter","__boxCenter","setBox","__isolevel","__smooth","__contour","__wrap","__boxSize","onSurfaceFinish","surfaceBuffer","dullInterior","surfaceData","MouseActions","zoomScroll","trackballControls","clipNearScroll","focusScroll","focus","getFocus","almostIdentity","setFocus","zoomFocusScroll","eachRepresentation","reprElem","comp","repr","panDrag","rotateDrag","zRotateDrag","zoomDrag","zoomFocusDrag","panComponentDrag","panAtomDrag","rotateComponentDrag","movePick","pickingProxy","animationControls","tooltipPick","tt","tooltip","mp","innerText","MouseActionPresets","default","measurePick","measureClear","pymol","coot","astexviewer","triggerFromString","tokens","MouseControls","disabled","preset","actionList","triggerStr","wildcard","action","KeyActions","autoView","toggleAnimations","toggleRock","KeyActionPresets","toggleSpin","toggleAntialiasing","KeyControls","char","PickingBehavior","mouseControls","_onClick","_onHover","pickingControls","MouseBehavior","_onMove","_onScroll","_onDrag","_onDblclick","AnimationBehavior","_onTick","KeyBehavior","keyControls","outline","_focusDomElement","_onKeydown","_onKeyup","_onKeypress","pressedKey","KeyboardEvent","keyCode","Annotation","content","_viewerPosition","_updateViewerPosition","_canvasPosition","_cameraPosition","pointerEvents","whiteSpace","setContent","_update","matrixChanged","displayValue","fontFamily","_clientRect","getVisibility","vp","cr","depth","zIndex","ComponentControls","RadiusFactoryTypes","covalent","explicit","RadiusFactory","atomRadius","negateVector","PrincipalAxes","n3","pointsT","vm","van","vbn","vcn","va","vb","vc","begA","endA","begB","endB","begC","endC","vecA","vecB","vecC","normVecA","normVecB","normVecC","getBasisMatrix","makeBasis","determinant","getRotationQuaternion","inverse","getProjectedScaleForAtoms","d1a","d1b","d2a","d2b","d3a","d3b","ax1","ax2","ax3","dp1","dot","dt1","dp2","dt2","dp3","dt3","FilteredVolume","minValue","maxValue","outside","setFilter","_getFilterHash","DMEAN","ARMS","filterHash","_filterHash","_dataBuffer","_positionBuffer","_atomindexBuffer","filteredAtomindex","filteredData","filteredPosition","BondHash","BondStore","addBond","ai1","ai2","addBondIfConnected","AtomStore","setAltloc","getAltloc","ResidueStore","setSstruc","getSstruc","setInscode","getInscode","ChainStore","setChainname","getChainname","setChainid","chainid","getChainid","ModelStore","Helixorient","polymer","residueCount","getCenterIterator","idx3","residueIndexStart","rp","getResidueProxy","traceAtomIndex","radiusFactory","diff","rise","twist","resdir","r12","r23","r34","diff13","diff24","vt","_axis","_prevAxis","_resdir","_center","getAtomIndexByType","a3","a4","diff13Length","diff24Length","resRadius","resTwist","resRise","resBending","resAxis","bending","Helixbundle","helixorient","getAxis","localAngle","centerDist","ssBorder","colorParams","radiusParams","beg","residueOffset","tmpAxis","tmpCenter","_beg","_end","rp1","rp2","BinaryHeap","scoreFunction","bubbleUp","sinkDown","peek","parentN","parent","elemScore","child1Score","child2N","child1N","child1","child2","Kdtree","metric","nodes","rootIndex","buildTree","arrBegin","arrEnd","maxDepth","plength","nodeIndex","currentNode","pivotIndex","pivotValue","storeIndex","arrMedian","currentDim","getNodeDepth","parentIndex","nearest","maxNodes","bestNodes","nearestSearch","bestChild","otherChild","dimension","pointIndex","ownPoint","ownDistance","saveNode","leftIndex","rightIndex","linearPoint","linearDistance","verify","AtomProxy","chainStore","residueStore","residueMap","euclideanDistSq","euclideanDist","bondHash","entityList","entityIndex","chainIndex","residue","residueTypeId","atomType","partialCharge","aromatic","_ap","hasBondTo","bap","hasBondToElement","backboneIndexList","moleculeType","isCg","backboneType","isTrace","atomRings","isNonmetal","isMetalloid","isDiatomicNonmetal","isPolyatomicNonmetal","isAlkaliMetal","isAlkalineEarthMetal","isNobleGas","isPostTransitionMetal","isLanthanide","isActinide","getDefaultValence","getValenceList","getOuterShellElectronCount","taa","aaa","distSquared","ta","positionFromArray","positionToArray","positionFromVector3","positionSub","getResidueBonds","firstOnly","connectedAtomIndex","connectedAtomIndices","relativeIndex","bonds","getBonds","atomIndices1","atomIndices2","noResname","modelStore","toObject","pointArray","useSquaredDist","atomIndices","kdtree","_Kdtree","nodeList","resultList","SymOpCode","$","E","G","J","M","Q","R","Z","_","EncodedSymOp","reInteger","selectionFromChains","chainList","Assembly","addPart","matrixList","part","AssemblyPart","partList","getAtomCount","reduce","getResidueCount","getInstanceCount","instanceCount","isIdentity","structureChainList","eachChain","getBoundingBox","partBox","_getCount","propertyName","instanceBox","structureBox","getView","getInstanceList","StructureBuilder","assignSecondaryStructure","secStruct","chainnames","chainnamesSorted","chainnamesIndex","helices","h2","helix","helixRun","chainChange","sheets","s1","s2","strandCharCode","sheet","sheetRun","addResidueType","ri","previousResname","previousHetero","modelindex","addModel","addChain","addResidue","currentModelindex","mi","currentChainid","currentResno","currentResname","currentInscode","chainOffset","chainCount","currentHetero","finalize","zhangSkolnickSS","isHelical","calculateSecondaryStructure","distances","eachPolymer","cgPolymer","proteinPolymer","prevSstruc","sstrucCount","ChainnameAlphabet","calculateChainnames","useExistingBonds","doAutoChainName","rStart","rEnd","chainData","mIndex","rCount","eachResidueN","newChain","bbType1","bbType2","backboneEndAtomIndex","backboneStartAtomIndex","rOffset","calculateBonds","calculateBondsWithin","calculateBondsBetween","BondOrderTable","getBondOrderFromTable","atomname1","atomname2","onlyAddRung","rungBondStore","rungAtomSet","atomBondMap","calculateAtomBondMap","bondOrders","nn","rai1","rai2","getBondIndex","rungEndAtomIndex","atomSetDict","rung","onlyAddBackbone","backboneBondStore","backboneAtomSet","backbone","buildUnitcellAssembly","uc","structureCenterFrac","cartToFrac","centerFrac","symopDict","spacegroup","encodedSymopList","matrixDict","symopList","symop","denominator","integer","getSymmetryOperations","centerFracSymop","positionFracSymop","unitcellAssembly","unitcellMatrixList","getMatrixList","ncsMatrixList","biomolDict","NCS","ncsUnitcellMatrixList","nm","vec","supercellAssembly","supercellMatrixList","ncsSupercellMatrixList","UNITCELL","SUPERCELL","setFromMatrixPosition","fracToCart","guessElement","atomName","assignResidueTypeBonds","bondDict","nextAtomOffset","AlkaliMetals","AlkalineEarthMetals","PolyatomicNonmetals","DiatomicNonmetals","NobleGases","PostTransitionMetals","Metalloids","Halogens","AtomType","no","AtomMap","getHash","dict","ResidueType","chemCompType","getMoleculeType","getBackboneType","backboneEndType","backboneStartType","getBackboneIndexList","atomnames","atomnamesStart","atomnamesEnd","traceIndex","getAtomIndexByName","dir1Index","direction1AtomIndex","dir2Index","direction2AtomIndex","bbStartIndex","rungEndIndex","bbEndIndex","atomnameList","hasProteinBackbone","hasRnaBackbone","hasDnaBackbone","hasCgProteinBackbone","hasCgRnaBackbone","hasCgDnaBackbone","hasAtomWithName","hasBackboneAtoms","hasBackbone","end1","maxd","nearestAtoms","calculateResidueBonds","calculateRings","getBondGraph","bondGraph","calculateBondGraph","getAromatic","aromaticAtoms","calculateAromatic","aromaticRings","nb","capacity","visited","pred","RingFinderMaxDepth","currentColor","RingFinderState","findRings","aromaticRingFlags","AromaticRingElements","isRingAromatic","assignBondReferenceAtomIndices","bondReferenceAtomIndices","refRing","rings1","rings2","ri1","ai3","_idx2","getBondReferenceAtomIndex","bondIndex","addRing","current","leftOffset","rightOffset","found","rn","ringOffset","head","ResidueMap","BondProxy","_v12","_v13","_ap1","_ap2","_ap3","getOtherAtomIndex","getReferenceAtomIndex","typeAtomIndex1","typeAtomIndex2","calculateShiftDir","ap3","v13","ResidueProxy","getChainProxy","getAtomType","getResname1","getAtomnameList","rNext","bbAtomEnd","bbAtomStart","getNextConnectedResidue","rpNext","rpFirst","getPreviousConnectedResidue","residueProxy","rpPrev","rpLast","Polymer","residueIndexEnd","rpStart","rpEnd","isPrevConnected","isNextConnected","isNextNextConnected","isCyclic","__residueProxy","aIndex","eachAtomN","rStartIndex","ChainProxy","getModelProxy","residueEnd","_rp","rNextIndex","ModelProxy","chainEnd","_cp","Structure","refreshed","extraData","atomSetCache","boxes","bondSet","finalizeAtoms","finalizeBonds","getBondSet","getBackboneBondSet","backboneBondSet","__backbone","getRungBondSet","rungBondSet","__rung","seleString","getAtomSetWithinSelection","getAtomSetWithinPoint","getAtomSetWithinVolume","fv","getMaxScaleOnAxis","getAtomSetWithinGroup","atomResidueIndex","getStructure","eachEntity","getEntityType","mn","cn","getAtomData","atomData","getBondData","multipleBond","isMulti","isOffset","bondScale","bondSpacing","bondData","storeBondOrder","radius2","absOffset","multiRadius","vShortening","vShift","getBackboneAtomData","getBackboneBondData","getRungAtomData","getRungBondData","getPrincipalAxes","atomCenter","hasCoords","_hasCoords","getSequence","seq","getChainnameCount","Set","updatePosition","refreshPosition","tmpBox","Primitives","ShapeDefaultParameters","aspectRatio","labelParams","pointSize","sizeAttenuation","useTexture","Shape","addMesh","meshCount","meshBuffer","addSphere","addEllipsoid","addTorus","addCylinder","addCone","addArrow","addBox","addOctahedron","addTetrahedron","addText","addPoint","addWideline","addLabel","getBufferList","buffers","BufferRepresentation","GeometryBuffer","meshIndex","geoPosition","geoIndex","meshPosition","meshNormal","meshColor","geoNormal","positionCount","geoPositionCount","transformedGeoPosition","transformedGeoNormal","makeIndex","initNormals","updateNormals","makeTranslation","applyPositionTransform","getNormalMatrix","o3","SphereGeometryBufferDefaultParameters","SphereGeometryBuffer","_radius","MappedBuffer","mappingType","indexSize","mapping","mappingSize","mappingIndicesSize","nullValueAttributes","getAttributeIndex","dataIndex","makeMapping","mappingItemSize","aMapping","mappingIndices","it","MappedQuadBuffer","SphereImpostorBuffer","SphereBuffer","PointBufferDefaultParameters","alphaTest","edgeBleach","PointBufferParameterTypes","PointBuffer","makeTexture","makePointTexture","USE_SIZEATTENUATION","USE_MAP","ALPHATEST","DotRepresentation","thresholdType","thresholdMin","thresholdMax","thresholdOut","dotType","radiusType","deviation","dotData","dotBuffer","quadIndices","quadUvs","ImageBufferDefaultParameters","ImageBufferParameterTypes","ImageBuffer","imageData","flipY","pickingTex","pickingMap","mapSize","CUBIC_INTERPOLATION","BSPLINE_FILTER","CATMULROM_FILTER","MITCHELL_FILTER","updateTexture","VolumeSlice","positionType","getPositionFromCoordinate","coord","vn","ms","setFromMatrixScale","dimLen","x0","y0","z0","setVec","tMin","tMax","pickingArray","SliceRepresentation","linear","percent","coordinate","volumeSlice","sliceBuffer","logReprUnknown","ElementDefaultParameters","Element","statusChanged","setStatus","setName","RepresentationElementDefaultParameters","RepresentationElement","visibilityChanged","parametersChanged","setRepresentation","getType","_disposeRepresentation","hasRepresentation","removeRepresentation","toggleVisibility","setSelection","_v","ComponentDefaultParameters","Component","representationAdded","representationRemoved","setRotation","setFromEuler","setScale","setTransform","getCenterUntransformed","makeScale","updateRepresentationMatrices","reprList","addAnnotation","annotation","annotationList","eachAnnotation","removeAnnotation","removeAllAnnotations","_addRepresentation","hidden","impostor","workerDefault","ReprClass","makeRepresentation","addBufferRepresentation","removeAllRepresentations","getBoxUntransformed","getZoom","getZoomForBox","Collection","_remove","RepresentationCollection","TrajectoryElementDefaultParameters","defaultStep","defaultTimeout","defaultInterpolateType","defaultInterpolateStep","defaultMode","defaultDirection","initialFrame","TrajectoryElement","frameChanged","playerChanged","player","setFrame","Frames","Superposition","atoms1","atoms2","coords1","coords2","coords1t","coords2t","transformationMatrix","prepCoords","_superpose","invA","t4","t5","t8","t9","t11","t13","t14","t15","t17","t18","t20","t21","t23","t26","md","mean1","mean2","VH","transformMat_","tmp_1","tmp_2","mult","M1","M2","is4X4","tCoords","det","_pB","mcols","invertTrasform","mat","n4","TrajectoryPlayerDefaultParameters","interpolateType","interpolateStep","TrajectoryPlayer","traj","startedRunning","haltedRunning","frameCount","_currentFrame","_direction","_animate","isRunning","_run","_currentTime","dt","_previousTime","inProgress","_currentStep","_nextInterpolated","hasFrame","setFrameInterpolated","ip","ipp","ippp","loadFrame","_next","currentFrame","play","setPlayer","frame","Trajectory","trajPath","deltaTime","timeOffset","centerPbc","removePbc","removePeriodicity","superpose","selectionIndices","_resetCache","_saveInitialCoords","_frameCount","setStructure","_loadFrameCount","backboneIndices","_getIndices","_makeAtomIndices","_saveStructureCoords","initialCoords","structureCoords","_makeSuperposeCoords","frameCache","loadQueue","boxCache","pathCache","frameCacheSize","_updateStructure","_interpolate","fc","cpp","cppp","j0","interpolateSpline","interpolateLerp","iList","_loadFrame","_disposed","_doSuperpose","_process","_setFrameCount","box2","circMean","circularMean3","arrayMean3","getFrameTime","FramesTrajectory","coordinates","StructureTrajectory","RemoteTrajectory","request","TrajectoryDatasource","getFrameUrl","getFrameParams","setRequestHeader","arrayBuffer","getCountUrl","CallbackTrajectory","requestCallback","StructureView","refresh","seleList","parentSelection","ignoreView","blosum62x","prepareMatrix","cellNames","matDict","rowDict","SubstitutionMatrices","blosum62","Alignment","seq1","seq2","gapPenalty","gapExtensionPenalty","substMatrix","_s1","_s2","_i","_j","ali","calc","ali1","aliIdx1","aliIdx2","ali2","_atoms1","_atoms2","initMatrices","score","gap","makeScoreFn","Vi1","Si1","Hi","Si","gap0","scoreFn","StructureComponentDefaultParameters","defaultAssembly","StructureComponent","pointer","trajectoryAdded","trajectoryRemoved","defaultAssemblyChanged","initSelection","pickBuffer","item","pickDict","del","spacefillRepresentation","addRepresentation","distanceRepresentation","angleRepresentation","dihedralRepresentation","measureRepresentations","setDefaultAssembly","structureView","rebuildRepresentations","rebuildTrajectories","reprParams","trajList","trajComp","reprComp","measureUpdate","addTrajectory","trajSrc","makeTrajectory","removeTrajectory","getAtomRadius","pickCount","lastPick","atomList","atomListSorted","atomPair","atomTriple","atomQuad","measureBuild","measureData","dihedral","pickData","radiusData","removeAllMeasurements","pd","removeMeasurement","addMeasurement","SurfaceComponent","VolumeComponent","ComponentCollection","matchName","tmpZoomVector","StageDefaultParameters","mousePreset","Stage","fullscreenChanged","componentAdded","componentRemoved","pickingBehavior","mouseBehavior","animationBehavior","keyBehavior","spinAnimation","rockAnimation","setQuality","setImpostor","logList","defaultFileRepresentation","BU1","assembly","sizeScore","backboneOnly","radiusScale","surfaceType","probeRadius","lineOnly","loadFile","defaultFileParams","addComponentFromObject","defaultRepresentation","errorMsg","loadScript","script","addComponent","compList","CompClass","removeComponent","removeAllComponents","toggleFullscreen","fullscreenEnabled","mozFullScreenEnabled","webkitFullscreenEnabled","msFullscreenEnabled","lastFullscreenElement","getFullscreenElement","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","dataset","normalWidth","normalHeight","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","resizeElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","setSpin","setRock","pclamp","bbSize","minSize","aspectFactor","catch","impostorTypes","eachComponent","getComponentsByName","getRepresentationsByName","ShapeComponent","__decorate","decorators","Reflect","decorate","AtomindexColormaker","scalePerModel","BfactorColormaker","bfactorScale","ChainidColormaker","chainidDict","chainidDictPerModel","ChainindexColormaker","ChainnameColormaker","chainnameDict","chainnameDictPerModel","DensityfitColormaker","rsrzScale","rsccScale","rsrzDict","rsccDict","rsrz","rscc","partialCharges","CZ","CG","OD1","CB","OD2","OE1","OE2","CD2","CE1","ND1","NE2","NZ","SD","PTR","O1P","O2P","O3P","OG1","SEP","TPO","CD1","CE2","CE3","NE1","OH","ElectrostaticColormaker","charges","hPositions","hPos","backboneNHPosition","hCharges","bbox","hStore","buildStoreLike","hHash","ElementColors","UUT","UUP","UUH","ElementColormaker","EntityindexColormaker","entityindexScale","EntitytypeColormaker","entityType","GeoqualityColormaker","geoAtomDict","geoDict","geoProblemCount","geoAtom","countSetBits","HydrophobicityColormaker","resHF","defaultResidueHydrophobicity","hfScale","ModelindexColormaker","modelindexScale","MoleculetypeColormaker","OccupancyColormaker","occupancyScale","PartialchargeColormaker","partialchargeScale","randomColor","RandomColormaker","RandomcoilindexColormaker","rciScale","rciDict","rci","ResidueindexColormaker","scalePerChain","ResidueColors","ASX","GLX","DA","DG","DI","DX","DC","DT","DU","DD","ResnameColormaker","StructureColors","SstrucColormaker","StructuredataColormaker","UniformColormaker","valueColor","ValueColormaker","valueScale","VolumeColormaker","nxy","i1y","i1z","iyz","i1yz","vy","vz","v1y","v1z","vyz","v1yz","xd","c00","c01","c10","c11","StructureRepresentation","radiusSize","biomolOptions","defaultScale","setRadius","getQuality","getAssembly","needsBuild","sview","createData","updateData","getRadiusParams","param","getAtomParams","getBondParams","MeasurementRepresentation","labelVisible","labelFontFamily","monospace","serif","labelFontStyle","italic","labelFontWeight","bold","labelsdf","labelXOffset","labelBackground","labelBackgroundColor","labelBackgroundMargin","labelBackgroundOpacity","labelFixedSize","labelFontstyle","textData","textBuffer","getLabelBufferParams","fontStyle","fontWeight","sdf","xOffset","attachment","showBorder","borderColor","borderWidth","showBackground","backgroundMargin","backgroundOpacity","fixedSize","parseNestedAtoms","nSets","order","selected","_break","calcArcPoint","edt","edt1d","TextAtlasCache","TextAtlasDefaultParams","font","variant","weight","TextAtlas","lineHeight","maxWidth","fillStyle","textAlign","textBaseline","lineJoin","gridOuter","gridInner","canvas2","context2","mapped","draw","currentX","scratchW","currentY","scratchH","measureText","clearRect","fillText","cutoff","TextBufferDefaultParameters","fontSize","TextBufferParameterTypes","getCharCount","charCount","TextBuffer","fontTexture","inputTexCoord","inputSize","aPosition","aColor","iChar","nChar","iCharAll","textAtlas","txt","xadvance","xShift","yShift","inputMapping","texWidth","texHeight","texCoords","FIXED_SIZE","WideLineBufferDefaultParameters","WideLineBufferParameterTypes","WideLineBuffer","AngleRepresentation","vectorVisible","sectorVisible","atomPosition","okay","outPosition","outIdx","validatePositions","atomTriplePositions","angleData","labelPosition","labelText","vectorPosition1","vectorPosition2","arcPositionTmp1","arcPositionTmp2","sectorPositionTmp","totalSegments","v21","v23","cross2","labelTmp","arcPoint","crossLength","nSegments","sectorVertices","arcVertices1","arcVertices2","appendArcSection","arcSize","sectorSize","arcPosition1","arcPosition2","sectorPosition","sectorOffset","arcOffset","getAngleData","vectorBuffer","arcLength","arcBuffer","sectorLength","sectorBuffer","vectorData","arcData","sectorData","eye","CylinderGeometryBufferDefaultParameters","getGeo","makeRotationX","CylinderGeometryBuffer","geoLength","__center","_color","_from","_to","meshData","MappedAlignedBoxBuffer","CylinderImpostorBufferDefaultParameters","CylinderImpostorBufferParameterTypes","CylinderImpostorBuffer","CAP","CylinderBuffer","AxesRepresentation","showAxes","showBox","getAxesData","pa","en","vertexPosition","vertexColor","vertexRadius","edgePosition1","edgePosition2","edgeColor","edgeRadius","addAxis","offset2","addCorner","d3","addScaledVector","edgeOffset","addEdge","edge","axesData","sphereBuffer","cylinderBuffer","sphereData","cylinderData","BallAndStickRepresentation","cylinderOnly","symmetric","lineBuffer","lineData","BackboneRepresentation","BaseRepresentation","Interpolator","vec1","vec2","vDir","vTan","vNorm","vBin","interpolateToArr","interpolateToVec","interpolatePosition","interpolateTangent","vectorSubdivide","interpolationFn","iterator","getTangent","interpolateNormalDir","u0","u1","u2","u3","norm","interpolateNormal","getNormalDir","iterDir1","iterDir2","vSub1","vSub2","vSub3","vSub4","d1v1","d1v2","d1v3","d1v4","d2v1","d2v2","d2v3","d2v4","interpolateColor","item1","item2","colFn","interpolatePicking","pickFn","interpolateSize","sizeFn","Spline","directional","positionIterator","subdiv","smoothSheet","interpolator","getAtomIterator","cache2","apPrev","apNext","getSubdividedColor","nCol","getSubdividedPicking","getSubdividedPosition","getSubdividedOrientation","normals","getNormals","tangent","binormal","getSubdividedSize","nSize","nPos","nTan","nNorm","vTangent","vMeshNormal","TubeMeshBufferDefaultParameters","capped","TubeMeshBuffer","capVertices","capTriangles","xi","size2","meshPrimitiveId","normX","normY","normZ","biX","biY","biZ","posX","posY","posZ","cxArr","cyArr","cx1Arr","cy1Arr","cx2Arr","cy2Arr","cx1","cy1","cx2","cy2","radialSegments1","irs","irs1","strip","CartoonRepresentation","getSplineParams","getSpline","getAspectRatio","polymerList","subPos","subOri","subCol","subPick","subSize","ContactRepresentation","angstrom","dataParams","contactData","unit","getLabelData","DihedralRepresentation","extendLine","lineVisible","dihedralData","lineTmp1","lineTmp2","sectorTmp","planeTmp","totalLines","totalPlanes","p4","v34","inPlane1","inPlane2","improperStart","improperEnd","v3angle","nLines","nPlanes","line1","line2","sector","plane","li","nSuccess","linePosition1","linePosition2","planePosition","lineOffset","planeOffset","lp1","lp2","pp","getDihedralData","lineLength","lineColor","planeLength","planeBuffer","planeData","createUpdatedObject","updateSource","hasKey","createColorArray","arrayLength","targetArray","DihedralHistogramRepresentation","histogramsData","histogramBinBorderVisible","scaleBinToSectorArea","histogramBinBorderColor","adjacentBondArrowColor","distantBondArrowColor","frontHistogramColor","backHistogramColor","opaqueMiddleDiscColor","histogramOpacity","opaqueMiddleDiscVisible","opaqueMiddleDiscOpacity","histogramBinBorderWidth","histogramBinBorderOpacity","bondArrowVisible","bondArrowWidth","bondArrowOpacity","specificColorData","getHistogramBinBorderBufferParameters","getBondArrowsBufferParameters","getOpaqueMiddleDiscBufferParameters","getHistogramBufferParameters","atomPositions","scaleData","histogram360Scaled","histogram360","dihedralDataArray","currentHistogramData","calculateDihedralHistogram","frontHistogramBinBordersBuffer","createWideLineBuffer","frontHistogramBinBorders","backHistogramBinBordersBuffer","backHistogramBinBorders","adjacentBondArrowsBuffer","adjacentBondArrows","distantBondArrowsBuffer","distantBondArrows","opaqueMiddleDiscBuffer","createMeshBuffer","opaqueMiddleDisc","frontHistogramBuffer","frontHistogram","backHistogramBuffer","backHistogram","Float32Concat","arrays","lengths","accumulatedOffset","linesList","startPoints","endPoints","startColors","endColors","triangleColors","histogramData","positionOfDihedralAtoms","histogram","totalSectorTrianglesInOpaqueMiddleDisc","frontAndBack","v32","cross1","dihedralAtomVectors","absAngle","maxHist","histBinAngleStep","opaqueCircleSectorAngleStep","sectionIndex","startOffset","setOneSideHistogram","setHistogramBinCoordinates","ind","zeroDegreeVector","crossVector","scalingFactor","discHistogram","binBorders","DistanceRepresentation","useCylinder","getDistanceData","pair","distanceData","bondParams","distanceBuffer","VectorBufferDefaultParameters","VectorBuffer","HelixorientRepresentation","LicoriceRepresentation","MappedBoxBuffer","HyperballStickImpostorBufferDefaultParameters","shrink","HyperballStickImpostorBufferParameterTypes","HyperballStickImpostorBuffer","HyperballStickBuffer","calculateMinArray","HyperballRepresentation","stickData","LabelFactory","atomLabel","aa1","errorLogged","qualified","LabelRepresentation","labelType","labelFormat","labelGrouping","getTextData","positionN","sizeN","colorN","labelFactory","LineRepresentation","crosses","lone","crossSize","_crossData","crossData","attrSize","cPosition1","cPosition2","cColor","cColor2","cOffset","cimax","crossBuffer","bufferIdx","lineAttributes","crossAttributes","makeGrid","DataCtor","elemSize","EDTSurface","coordList","pLength","pWidth","pHeight","ptran","depty","widxz","cutRadius","setAtomID","vpBits","vpDistance","vpAtomID","btype","_probeRadius","_scaleFactor","_cutoff","_setAtomID","boundingatom","txz","tdept","sradius","tradius","widxzR","deptyName","indx","fillatom","ox","oy","oz","mj","mk","sk","ii","jj","kk","deptyAtNind","deptyAt","nind","pWH","ci2","fillvoxels","fillAtomWaals","fastdistancemap","boundPoint","cutRSq","totalsurfacevox","inarray","positin","outarray","positout","fastoneshell","cutoffSq","tx","ty","tz","square","nbj","tnvix","tnviy","tnviz","getVolume","tk","buildboundary","fillvoxelswaals","stype","marchingcubeinit","vd","makeAVHash","atomsX","atomsY","atomsZ","atomsR","nAtoms","hashFunc","minW","iDim","jDim","kDim","nCells","jkDim","preHash","cid","cellOffsets","cellLengths","maxCellLength","subArray","cellLength","neighbourListLength","withinRadii","rExtra","nearI","nearJ","nearK","loI","loJ","loK","hiI","hiJ","hiK","iOffset","jOffset","cellStart","cellEnd","rSum","AVSurface","probePositions","gridx","gridy","gridz","sinTable","cosTable","ngTorus","lastClip","_probePositions","rExt","surfGrid","fillGridDim","initializeAngleTables","obscured","singleAtomObscures","ra2","projectPoints","ar","ar2","ng","iax","iay","iaz","minx","miny","minz","maxx","maxy","maxz","xoffset","dxy2","xyoffset","spx","spy","spz","projectTorus","dmp","normalToLine","rInt","cost","sint","px","py","pz","projectTorii","fixNegatives","fixAtomIDs","MolecularSurface","_getAtomData","MolecularSurfaceRepresentation","vws","sas","ses","av","__infoList","__forceNewMolsurf","prepareData","molsurf","sviewFilter","maxDim","asWithin","getSurfaceParams","__sele","__surfaceParams","after","contourBuffer","doubleSidedBuffer","PointRepresentation","pointData","RibbonBuffer","aNormal","aSize","aDir","aPrimitiveId","currSize","prevSize","RibbonRepresentation","RocketRepresentation","axisList","helixbundleList","helixbundle","axisData","RopeRepresentation","SpacefillRepresentation","TraceBuffer","linePosition","TraceRepresentation","TubeRepresentation","UnitcellRepresentation","defaultRadius","getUnitcellData","unitcellData","ValidationRepresentation","clashData","getClashData","ConeBufferDefaultParameters","ConeBuffer","_position1","_position2","GeometryGroup","geometryList","empty","ArrowBufferDefaultParameters","ArrowBuffer","splitPosition","cylinderRadius","makeAttributes","coneBuffer","vFrom","vTo","vSplit","fullLength","coneLength","BoxBuffer","BoxBufferGeometry","_heightAxis","_depthAxis","_size","EllipsoidBufferDefaultParameters","EllipsoidBuffer","_majorAxis","_minorAxis","OctahedronBuffer","TetrahedronBuffer","TorusBufferDefaultParameters","radiusRatio","tubularSegments","TorusBuffer","Parser","_beforeParse","_parse","_afterParse","StructureParser","structureBuilder","Entity","description","chainIndexList","entityTypeFromString","entityFromType","isNonPolymer","isMacrolide","DefaultBoxParams","Unitcell","alphaRad","betaRad","gammaRad","cosAlpha","cosBeta","cosGamma","sinBeta","sinGamma","cStar","cosAlphaStar","cornerOffset","divideScalar","centerArray3","HelixTypes","dAminoAcids","entityKeyList","reWhitespace","getModresId","PdbParser","isLegacy","headerLine","headerId","legacyId","currentCoord","currentBiomol","currentPart","currentMatrix","recordName","startChain","startResi","startIcode","endChain","endResi","endIcode","currentEntityData","currentEntityKey","chainIdx","currentChainname","currentSeqresChainname","isPqr","isPdbqt","sb","serialRadix","resnoRadix","doFrames","serialDict","unitcellDict","entityDataList","hetnameDict","modresDict","chainDict","seqresDict","modelIdx","pendingStart","ls","modresId","fromIdx","toIdx","helixType","seqresChainname","keyEnd","biomt","biomtElms","ncs","ncsRow","ncsElms","origx","orgix","origxRow","origxElms","scaleRow","scaleElms","aLength","bLength","cLength","sGroup","_parseChunkOfLines","ei","residueDict","reQuotedWhitespace","reDoubleQuote","reTrimQuotes","trimQuotes","hasValue","cifDefaults","getBondOrder","valueOrder","CifParser","rawline","authAsymId","authSeqId","labelSeqId","labelAtomId","labelCompId","labelAsymId","labelEntityId","labelAltId","groupPDB","typeSymbol","pdbxPDBmodelNum","pdbxPDBinsCode","CartnX","CartnY","CartnZ","bIsoOrEquiv","cif","asymIdDict","chainIndexDict","pendingString","currentString","pendingValue","pendingLoop","pendingName","loopPointers","currentLoopIndex","currentCategory","currentName","pointerNames","modelNum","keyParts","category","keyValuePair","_modelNum","frameOffset","occ","assignedChainname","entityId","chem_comp","chem_comp_atom","cc","cca","ccb","chem_comp_bond","atomnameDict","comp_id","atom_id","type_symbol","model_Cartn_x","model_Cartn_y","model_Cartn_z","pdbx_component_comp_id","pdbx_residue_numbering","pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal","atom_id_1","atom_id_2","value_order","parseChemComp","atom_site_type_symbol","atom_site_label","atom_site_fract_x","cell_length_a","cell_length_b","cell_length_c","cell_angle_alpha","cell_angle_beta","cell_angle_gamma","atom_site_fract_y","atom_site_fract_z","atom_site_occupancy","ml","identityMatrix","covalentI","parseCore","begIcode","struct_conf","beg_auth_seq_id","pdbx_PDB_helix_class","pdbx_beg_PDB_ins_code","pdbx_end_PDB_ins_code","beg_label_asym_id","end_label_asym_id","end_auth_seq_id","ssr","struct_sheet_range","processSecondaryStructure","operDict","pdbx_struct_oper_list","biomolOp","elms","pdbx_struct_assembly_gen","gen","getMatrixDict","expr","es","assembly_id","oe","oper_expression","md1","md2","k1","k2","asym_id_list","struct_ncs_oper","ncsOp","ncsName","ncsPart","cell","length_a","length_b","length_c","angle_alpha","angle_beta","angle_gamma","symmetry","database_PDB_matrix","origxMat","atom_sites","scaleMat","processSymmetry","struct_conn","atomIndicesCache","connTypeId","conn_type_id","ptnr1_symmetry","ptnr2_symmetry","inscode1","pdbx_ptnr1_PDB_ins_code","altloc1","pdbx_ptnr1_label_alt_id","ptnr1_auth_seq_id","ptnr1_label_asym_id","ptnr1_label_atom_id","selection1","inscode2","pdbx_ptnr2_PDB_ins_code","altloc2","pdbx_ptnr2_label_alt_id","ptnr2_auth_seq_id","ptnr2_label_asym_id","ptnr2_label_atom_id","selection2","tmpA","tmpB","pdbx_value_order","processConnections","pdbx_description","processEntities","struct","entry","pdbx_audit_revision_history","revision_date","dates","releaseDate","pdbx_database_status","recvd_initial_deposition_date","depDates","depositionDate","database_PDB_rev","date","date_original","reflns","d_resolution_high","refine","ls_d_res_high","ls_R_factor_R_free","rFree","ls_R_factor_R_work","rWork","exptl","method","experimentalMethods","GroParser","firstLines","lpos","ypos","zpos","modelLineCount","lineNo","AllFields","typedArray","getDataView","getInt8View","getInt32View","decodeInt16","i2","decodeInt32","i4","decodeInteger","intArray","divisor","invDiv","decodeRun","dataOffset","decodeDelta","decodePacking","int16or8","upperLimit","lowerLimit","decodeIntegerPacking","decodeIntegerDeltaPacking","unpacked","decodeIntegerDelta","decodeMsgpack","dataView","performDecoding","dvOut","dvIn","decodeFloat32","decodeIntegerRun","decodeMmtf","inputDict","ignoreFields","outputDict","dv","ignore","SstrucMap","MmtfParser","groupData","numBonds","numAtoms","numGroups","numChains","numModels","chainsPerModel","structureId","groupsPerChain","groupList","groupTypeList","atomNameList","frameAtomOffset","xCoordList","yCoordList","zCoordList","bAtomIndex1","bAtomIndex2","bBondOrder","aGroupIndex","aFormalCharge","gChainIndex","gAtomOffset","gAtomCount","cModelIndex","cGroupOffset","cGroupCount","mChainOffset","mChainCount","modelChainCount","groupOffset","chainGroupCount","bondOffset","groupAtomCount","groupFormalChargeList","formalChargeList","groupBondAtomList","bondAtomList","groupBondOrderList","bondOrderList","atomIdList","bFactorList","altLocList","occupancyList","groupIdList","secStructList","insCodeList","chainNameList","chainIdList","groupTypeDict","groupType","elementList","hetFlag","numGroupBonds","groupName","resAtomOffset","secStructLength","bioAssemblyList","_assembly","chainToPart","transformList","_transform","ncsOperatorList","ncsAssembly","_operator","unitCell","spaceGroup","bondTypes","du","un","Mol2Parser","moleculeLineNo","modelAtomIdxStart","currentRecordType","PdbqtParser","PqrParser","reItem","SdfParser","headerLines","mItem","atomStart","bondStart","bondEnd","sdfData","currentItem","currentData","chargeCount","coffset","atomIdx","cToken","_postProcess","parseIntSubstr","PrmtopParser","atomNames","radii","pointersDict","pointers","residueLabels","residuePointers","curIdx","bondIdx","lt","NATOM","NBONH","MBONA","NRES","curResIdx","curResname","curResno","reTitle","PsfParser","lastSegid","segid","reField","TopParser","currentMoleculetype","molecules","moleculetypeDict","fieldMatch","cIdx","molName","molType","molCount","lastResno","resIdx","chainidIdx","chainnameIdx","TrajectoryParser","DcdParser","nextPos","intView","ef","isCharmm","extraBlock","fourDims","NSET","ISTART","NSAVC","NAMNF","DELTA","titleLength","titlePos","TITLE","natom","natom4","notNetcdf","statement","readName","nameLength","num2str","num2bytes","str2num","readNumber","bufferReader","numbers","readType","trimNull","recordDimension","dimList","dimensions","recordId","dimensionSize","dimensionsList","globalAttributes","attributesList","variables","varList","recordStep","variableSize","dimensionality","dimensionsIds","varSize","record","variablesList","gAttList","gAtt","NetcdfReader","hasDataVariable","variableName","findIndex","getDataVariable","variable","find","currentOffset","nonRecord","NctrajParser","netcdfReader","times","TrrParser","versionSize","virSize","presSize","coordSize","velocitySize","forceSize","natoms","floatSize","natoms3","frameCoords","MagicInts","sizeOfInt","numOfBits","_tmpBytes","sizeOfInts","numOfInts","sizes","numOfBytes","bytecnt","decodeBits","cbuf","buf2","mask","lastBB0","lastBB1","_tmpIntBytes","decodeInts","nums","XtcParser","minMaxInt","sizeint","bitsizeint","sizesmall","thiscoord","prevcoord","lfp","lsize","bitsize","smallidx","tmpIdx","smaller","smallnum","adz","invPrecision","buf8","isSmaller","tmpSwap","VolumeParser","getMatrix","reScientificNotation","bohrToAngstromFactor","CubeParser","originX","originY","originZ","NVX","NVY","NVZ","basisX","basisY","basisZ","oribitalFlag","lj","Dsn6Parser","summand","byteView","brixStr","xStart","yStart","zStart","xExtent","yExtent","zExtent","xRate","yRate","zRate","xlen","ylen","zlen","xBlocks","yBlocks","zBlocks","zz","yy","xx","nxyz","mapcrs","DxParser","headerInfo","parseHeaderLines","dataLineStart","headerByteCount","deltaLineCount","xmin","ymin","zmin","hx","hy","hz","DxbinParser","uint8ToLines","MrcParser","floatView","MAP","MACHST","NX","NY","MODE","NXSTART","NYSTART","NZSTART","MX","MY","MZ","MAPC","MAPR","MAPS","DMIN","DMAX","ISPG","NSYMBT","LSKFLG","b0","parseNumberLine","XplorParser","infoStart","dataStart","gridInfo","AMIN","AMAX","BMIN","BMAX","NC","CMIN","CMAX","cellInfo","lineSection","RAVE","RSIGMA","hsvToRgb","ColorDict","sea","sky","peach","lilac","pinktint","peachtint","yellowtint","greentint","bluetint","lilactint","deadwhite","deadblack","invisible","reWhitespaceComma","reCurlyWhitespace","reTrimCurly","reCollapseEqual","parseListDef","defaultColor","master","listName","listColor","listMasters","listWidth","parseListElm","lineBreak","triangleBreak","lsindex","literal","isLineBreak","isTriangleBreak","parseStr","parseFlag","parseGroup","flags","groupFlags","groupMasters","KinParser","currentGroupMasters","currentSubgroupMasters","kinemage","onewidth","pdbfile","texts","captions","caption","groupDict","subgroupDict","masterDict","pointmasterDict","dotLists","vectorLists","ballLists","ribbonLists","dotDefaultColor","dotLabel","dotPosition","dotColor","vecDefaultColor","vecDefaultWidth","vecLabel1","vecLabel2","vecPosition1","vecPosition2","vecColor1","vecColor2","ballRadius","ballDefaultColor","ballLabel","ballPosition","ballColor","ribbonListDefaultColor","ribbonPointLabelArray","ribbonPointPositionArray","ribbonPointBreakArray","ribbonPointColorArray","isDotList","prevDotLabel","isVectorList","prevVecLabel","prevVecPosition","prevVecColor","isBallList","prevBallLabel","isRibbonList","prevRibbonPointLabel","isCaption","masterArray","labelArray","colorArray","indent","label1Array","label2Array","position1Array","position2Array","color1Array","color2Array","radiusArray","breakArray","splitLine","dominant","convertedLists","listObject","convertedRibbonObject","editedLabels","editedPositions","editedColors","editedBreaks","breakPointer","positionPointer","removePointBreaksTriangleArrays","ribbonObject","convertedLabels","convertedBreaks","convertedPositions","convertedColors","vector3Positions","convertKinTriangleArrays","SurfaceParser","getLoader","OBJLoader","regexp","vertex_pattern","normal_pattern","uv_pattern","face_vertex","face_vertex_uv","face_vertex_uv_normal","face_vertex_normal","object_pattern","smoothing_pattern","material_library_pattern","material_use_pattern","setPath","_createParserState","objects","startObject","fromDeclaration","parseVertexIndex","parseNormalIndex","addVertex","addVertexLine","addNormal","addFace","nd","vLen","ib","ic","nLen","addLineGeometry","vi","lineFirstChar","lineSecondChar","trimLeft","lineParts","lineVertices","lineUVs","llen","parts","buffergeometry","ObjParser","PLYLoader","propertyNameMapping","setPropertyNameMapping","bin2str","isASCII","parseHeader","parseASCII","parseBinary","headerText","headerLength","lineType","lineValues","propertValues","comments","countType","itemType","parseASCIINumber","parseASCIIElement","currentElementCount","useColor","handleElement","postProcess","elementsNeedUpdate","elementName","setRGB","vertexIndices","vertex_indices","Face3","binaryRead","dataview","binaryReadElement","loc","PlyParser","CsvParser","table","reDelimiter","JsonParser","MsgpackParser","msgpack","NetcdfParser","netcdf","TextParser","reStrip","reTag","reContent","reAttr","parseXml","declaration","root","tag","eos","is","prefix","XmlParser","useDomParser","__xmlParser","__domParser","DOMParser","parseFromString","Document","getNamedItem","getSele","useAltcode","icode","altcode","getResSele","setBitDict","bit","hasAttrValue","getProblemCount","clashDict","ga","clashes","getElementsByTagName","Validation","fromXml","atomDict","entries","chemicalShiftLists","randomCoilIndices","rcia","_clashDict","clashList","seleAttr","createAttribute","setNamedItem","atomSele","res1","res2","mogBondOutliers","mogAngleOutliers","clashSele","vPos1","vPos2","getAtomSele","dHalf","ValidationParser","shrinkBuf","arraySet","dest","src_offs","dest_offs","adler32","adler","crcTable","makeTable","crc32","crc","inflate_fast","strm","_in","last","dmax","wsize","whave","wnext","s_window","lcode","dcode","lmask","dmask","here","op","from_source","next_in","avail_in","next_out","avail_out","lencode","distcode","lenbits","distbits","dolen","dodist","sane","MAXBITS","lbase","lext","dbase","dext","inflate_table","lens","lens_index","codes","table_index","work","incr","fill","here_bits","here_op","here_val","curr","drop","used","huff","base_index","offs","extra","extra_index","Z_STREAM_ERROR","TYPE","BAD","zswap32","InflateState","havedict","check","total","wbits","ncode","nlen","ndist","have","lendyn","distdyn","was","inflateReset","total_in","total_out","inflateResetKeep","inflateInit2","windowBits","inflateReset2","lenfix","distfix","virgin","fixedtables","updatewindow","flush","put","last_bits","last_op","last_val","hbuf","inf_leave","xflags","os","extra_len","hcrc","data_type","inflateSetDictionary","dictionary","dictLength","STR_APPLY_OK","STR_APPLY_UIA_OK","__","_utf8len","string2buf","m_pos","str_len","buf_len","buf2string","c_len","utf16buf","_buf2binstring","utf8border","messages","ZStream","GZheader","Inflate","sources","source","raw","ended","next_out_utf8","tail","utf8str","allowBufError","binstring2buf","onEnd","onData","inflateEnd","flattenChunks","decompressedData","inflator","ungzip","Datasource","mmtfBaseUrl","mmtfFullUrl","RcsbDatasource","pdbid","baseUrl","suffixUrl","PubchemDatasource","PassThroughDatasource","suffixURL","AlphafoldDatasource","uniprotid","reProtocol","StaticDatasource","relativePath","pn","basePath","pathname","MdsrvDatasource","getListing","jsonData","frameIndex","getPathUrl","IntegerParam","NumberParam","RangeParam","SelectParam","UIStageParameters","_Promise","atomIndexDict","modelCount","structures","flatten","ListingDatasource","wait","previous","later","leading","trailing"],"mappings":"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AAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,EAAK,GAAIC,EAAK,GAAIC,GAAM,GAAIC,GAAM,GAAI9vD,EAAK,GAAI+vD,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,EAAK,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,EAAK,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAI72D,EAAK,GAAI82D,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,EAAK,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,EAAK,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,GAAIC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,IAAKC,GAAM,KAkBxpCC,GAAgD,CAC3D,EAAG,IAAK,EAAG,IAAK,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,IAAK,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,EAAK,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,IAAK,GAAI,EAAK,GAAI,IAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,GAouB5lCC,GAAqD,CAChE,EAAG,IAAM,EAAG,IAAM,EAAG,KAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,EAAG,IAAM,GAAI,IAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAI/mCC,GAAk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AO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACtE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,M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G,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,IAAK,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACpD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACvD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAClD,EAAG,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAA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"}